<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>File&nbsp;GEM5&nbsp;Wrapper: クラス TLB</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- 作成： Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>メインページ</span></a></li>
      <li><a href="pages.html"><span>関連ページ</span></a></li>
      <li><a href="modules.html"><span>モジュール</span></a></li>
      <li><a href="namespaces.html"><span>ネームスペース</span></a></li>
      <li class="current"><a href="annotated.html"><span>クラス</span></a></li>
      <li><a href="files.html"><span>ファイル</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>構成</span></a></li>
      <li><a href="classes.html"><span>構成索引</span></a></li>
      <li><a href="hierarchy.html"><span>クラス階層</span></a></li>
      <li><a href="functions.html"><span>構成メンバ</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="namespaceX86ISA.html">X86ISA</a>::<a class="el" href="classX86ISA_1_1TLB.html">TLB</a>
  </div>
</div>
<div class="contents">
<h1>クラス TLB</h1><!-- doxytag: class="X86ISA::TLB" --><!-- doxytag: inherits="BaseTLB" -->
<p><code>#include &lt;<a class="el" href="arch_2x86_2tlb_8hh_source.html">tlb.hh</a>&gt;</code></p>
<div class="dynheader">
TLBに対する継承グラフ</div>
<div class="dynsection">
 <div class="center">
  <img src="classX86ISA_1_1TLB.gif" usemap="#TLB_map" alt=""/>
  <map id="TLB_map" name="TLB_map">
<area href="classBaseTLB.html" alt="BaseTLB" shape="rect" coords="105,112,200,136"/>
<area href="classSimObject.html" alt="SimObject" shape="rect" coords="105,56,200,80"/>
<area href="classEventManager.html" alt="EventManager" shape="rect" coords="0,0,95,24"/>
<area href="classSerializable.html" alt="Serializable" shape="rect" coords="105,0,200,24"/>
<area href="classDrainable.html" alt="Drainable" shape="rect" coords="210,0,305,24"/>
</map>
 </div>
</div>

<p><a href="classX86ISA_1_1TLB-members.html">すべてのメンバ一覧</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Public 型</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef X86TLBParams&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classX86ISA_1_1TLB.html#a9122b46075a6970493519b96564e6356">Params</a></td></tr>
<tr><td colspan="2"><h2>Public メソッド</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classX86ISA_1_1TLB.html#acb886bd3c59f00c21be9ceaaf25dab97">TLB</a> (const <a class="el" href="classX86ISA_1_1TLB.html#a9122b46075a6970493519b96564e6356">Params</a> *<a class="el" href="namespaceX86ISA.html#af675c1d542a25b96e11164b80809a856">p</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classX86ISA_1_1TLB.html#a15b6c15c1be2ca4de3e65772a02aa29f">takeOverFrom</a> (<a class="el" href="classBaseTLB.html">BaseTLB</a> *otlb)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">TlbEntry *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classX86ISA_1_1TLB.html#ab71ae01bf6743de678ebdc212e7bb401">lookup</a> (<a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a> va, bool update_lru=true)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classX86ISA_1_1TLB.html#ae9a8e1a2483b506a07feeeea766ba43e">setConfigAddress</a> (<a class="el" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> <a class="el" href="namespaceX86ISA.html#ab705917f60c5566f9ce56a93f798b2e2">addr</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classX86ISA_1_1Walker.html">Walker</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classX86ISA_1_1TLB.html#a2f35a7f4b93d6ec096a0785e0d7113cd">getWalker</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classX86ISA_1_1TLB.html#aca1483a67aee5a91e442f7131d66bcbd">flushAll</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classX86ISA_1_1TLB.html#a31bf0dd34724a05bf42926ee68e516ef">flushNonGlobal</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classX86ISA_1_1TLB.html#a18477caae4a9699b99ee4f1ebca75c31">demapPage</a> (<a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a> va, uint64_t asn)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classX86ISA_1_1TLB.html#ae59fbc0829276a4cd557c908baf052f0">evictLRU</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint64_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classX86ISA_1_1TLB.html#ab150a470cb370c561702b113ede76c7d">nextSeq</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classRefCountingPtr.html">Fault</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classX86ISA_1_1TLB.html#ad54e01e3c0a1613098a76b7f92e5be93">translateAtomic</a> (<a class="el" href="classRequest.html">RequestPtr</a> req, <a class="el" href="classThreadContext.html">ThreadContext</a> *tc, <a class="el" href="classBaseTLB.html#a46c8a310cf4c094f8c80e1cb8dc1f911">Mode</a> mode)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classX86ISA_1_1TLB.html#ae52f7e465748883695d2b4f432a13652">translateTiming</a> (<a class="el" href="classRequest.html">RequestPtr</a> req, <a class="el" href="classThreadContext.html">ThreadContext</a> *tc, <a class="el" href="classBaseTLB_1_1Translation.html">Translation</a> *translation, <a class="el" href="classBaseTLB.html#a46c8a310cf4c094f8c80e1cb8dc1f911">Mode</a> mode)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classRefCountingPtr.html">Fault</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classX86ISA_1_1TLB.html#a26658814c6c9034665aae19cf25545bb">translateFunctional</a> (<a class="el" href="classRequest.html">RequestPtr</a> req, <a class="el" href="classThreadContext.html">ThreadContext</a> *tc, <a class="el" href="classBaseTLB.html#a46c8a310cf4c094f8c80e1cb8dc1f911">Mode</a> mode)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classRefCountingPtr.html">Fault</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classX86ISA_1_1TLB.html#ae199d95c42e036851a8a0543c6d6d2e3">finalizePhysical</a> (<a class="el" href="classRequest.html">RequestPtr</a> req, <a class="el" href="classThreadContext.html">ThreadContext</a> *tc, <a class="el" href="classBaseTLB.html#a46c8a310cf4c094f8c80e1cb8dc1f911">Mode</a> mode) const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">TlbEntry *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classX86ISA_1_1TLB.html#a1b0164809bc96e78b231ff2143eb3cfc">insert</a> (<a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a> vpn, TlbEntry &amp;entry)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classX86ISA_1_1TLB.html#a53e036786d17361be4c7320d39c99b84">serialize</a> (std::ostream &amp;<a class="el" href="namespaceX86ISA.html#a6b6e6ba763e7eaf46ac5b6372ca98d30">os</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classX86ISA_1_1TLB.html#af22e5d6d660b97db37003ac61ac4ee49">unserialize</a> (<a class="el" href="classCheckpoint.html">Checkpoint</a> *cp, const std::string &amp;section)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="classBaseMasterPort.html">BaseMasterPort</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classX86ISA_1_1TLB.html#a2ea87b216b1f58953a679590672be258">getMasterPort</a> ()</td></tr>
<tr><td colspan="2"><h2>Protected 型</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef <a class="el" href="classstd_1_1list.html">std::list</a>&lt; TlbEntry * &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classX86ISA_1_1TLB.html#ad1a39a8d54f6e4053979f8c24fe5dcfd">EntryList</a></td></tr>
<tr><td colspan="2"><h2>Protected メソッド</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EntryList::iterator&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classX86ISA_1_1TLB.html#ae73955fcefd34a6fab596ade6c99290f">lookupIt</a> (<a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a> va, bool update_lru=true)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classRefCountingPtr.html">Fault</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classX86ISA_1_1TLB.html#ad195b09fbba19be819ba87ce931fc31d">translateInt</a> (<a class="el" href="classRequest.html">RequestPtr</a> req, <a class="el" href="classThreadContext.html">ThreadContext</a> *tc)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classRefCountingPtr.html">Fault</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classX86ISA_1_1TLB.html#a8b22251fd759b80bb032b04e7f2fc68a">translate</a> (<a class="el" href="classRequest.html">RequestPtr</a> req, <a class="el" href="classThreadContext.html">ThreadContext</a> *tc, <a class="el" href="classBaseTLB_1_1Translation.html">Translation</a> *translation, <a class="el" href="classBaseTLB.html#a46c8a310cf4c094f8c80e1cb8dc1f911">Mode</a> mode, bool &amp;delayedResponse, bool timing)</td></tr>
<tr><td colspan="2"><h2>Protected 変数</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classX86ISA_1_1TLB.html#a2c2064456d968624c149f8658bcfee32">configAddress</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classX86ISA_1_1Walker.html">Walker</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classX86ISA_1_1TLB.html#a54537e5fcbe2d6f609ca4c90a48a06a8">walker</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classX86ISA_1_1TLB.html#ab2c6b258f02add8fdf4cfc7c371dd772">size</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">TlbEntry *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classX86ISA_1_1TLB.html#a4651b9a4f432960d77d8e3d30175aab3">tlb</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classstd_1_1list.html">EntryList</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classX86ISA_1_1TLB.html#a7c13435dc688d8e4d7600964147b5705">freeList</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classTrie.html">TlbEntryTrie</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classX86ISA_1_1TLB.html#aac73611ce3ddb38006a5c03e6ba91977">trie</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint64_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classX86ISA_1_1TLB.html#a5bea8f11255089115ad43ef4d83e7c7f">lruSeq</a></td></tr>
<tr><td colspan="2"><h2>フレンド</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classX86ISA_1_1TLB.html#a561951adc2bae72717df4b975c66f02f">Walker</a></td></tr>
</table>
<hr/><h2>型定義</h2>
<a class="anchor" id="ad1a39a8d54f6e4053979f8c24fe5dcfd"></a><!-- doxytag: member="X86ISA::TLB::EntryList" ref="ad1a39a8d54f6e4053979f8c24fe5dcfd" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="classstd_1_1list.html">std::list</a>&lt;TlbEntry *&gt; <a class="el" href="classstd_1_1list.html">EntryList</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a9122b46075a6970493519b96564e6356"></a><!-- doxytag: member="X86ISA::TLB::Params" ref="a9122b46075a6970493519b96564e6356" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef X86TLBParams <a class="el" href="classX86ISA_1_1TLB.html#a9122b46075a6970493519b96564e6356">Params</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><a class="el" href="classSimObject.html#a0f0761d2db586a23bb2a2880b8f387bb">SimObject</a>を再定義しています。</p>

</div>
</div>
<hr/><h2>コンストラクタとデストラクタ</h2>
<a class="anchor" id="acb886bd3c59f00c21be9ceaaf25dab97"></a><!-- doxytag: member="X86ISA::TLB::TLB" ref="acb886bd3c59f00c21be9ceaaf25dab97" args="(const Params *p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classX86ISA_1_1TLB.html">TLB</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classX86ISA_1_1TLB.html#a9122b46075a6970493519b96564e6356">Params</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00064"></a>00064                         : <a class="code" href="classBaseTLB.html#ac8e9bca1fe09b54b17069200cac8c9d3">BaseTLB</a>(<a class="code" href="namespaceX86ISA.html#af675c1d542a25b96e11164b80809a856">p</a>), <a class="code" href="classX86ISA_1_1TLB.html#a2c2064456d968624c149f8658bcfee32">configAddress</a>(0), <a class="code" href="classX86ISA_1_1TLB.html#ab2c6b258f02add8fdf4cfc7c371dd772">size</a>(<a class="code" href="namespaceX86ISA.html#af675c1d542a25b96e11164b80809a856">p</a>-&gt;size),
<a name="l00065"></a>00065     <a class="code" href="classX86ISA_1_1TLB.html#a5bea8f11255089115ad43ef4d83e7c7f">lruSeq</a>(0)
<a name="l00066"></a>00066 {
<a name="l00067"></a>00067     <span class="keywordflow">if</span> (!<a class="code" href="classX86ISA_1_1TLB.html#ab2c6b258f02add8fdf4cfc7c371dd772">size</a>)
<a name="l00068"></a>00068         <a class="code" href="base_2misc_8hh.html#acad519418dbfdd70c1208711e609c80e">fatal</a>(<span class="stringliteral">&quot;TLBs must have a non-zero size.\n&quot;</span>);
<a name="l00069"></a>00069     <a class="code" href="classX86ISA_1_1TLB.html#a4651b9a4f432960d77d8e3d30175aab3">tlb</a> = <span class="keyword">new</span> TlbEntry[<a class="code" href="classX86ISA_1_1TLB.html#ab2c6b258f02add8fdf4cfc7c371dd772">size</a>];
<a name="l00070"></a>00070     std::memset(<a class="code" href="classX86ISA_1_1TLB.html#a4651b9a4f432960d77d8e3d30175aab3">tlb</a>, 0, <span class="keyword">sizeof</span>(TlbEntry) * <a class="code" href="classX86ISA_1_1TLB.html#ab2c6b258f02add8fdf4cfc7c371dd772">size</a>);
<a name="l00071"></a>00071 
<a name="l00072"></a>00072     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespaceX86ISA.html#ab5f9a01fc40e47853ae9551b008afcbd">x</a> = 0; <a class="code" href="namespaceX86ISA.html#ab5f9a01fc40e47853ae9551b008afcbd">x</a> &lt; <a class="code" href="classX86ISA_1_1TLB.html#ab2c6b258f02add8fdf4cfc7c371dd772">size</a>; <a class="code" href="namespaceX86ISA.html#ab5f9a01fc40e47853ae9551b008afcbd">x</a>++) {
<a name="l00073"></a>00073         <a class="code" href="classX86ISA_1_1TLB.html#a4651b9a4f432960d77d8e3d30175aab3">tlb</a>[<a class="code" href="namespaceX86ISA.html#ab5f9a01fc40e47853ae9551b008afcbd">x</a>].trieHandle = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00074"></a>00074         <a class="code" href="classX86ISA_1_1TLB.html#a7c13435dc688d8e4d7600964147b5705">freeList</a>.push_back(&amp;<a class="code" href="classX86ISA_1_1TLB.html#a4651b9a4f432960d77d8e3d30175aab3">tlb</a>[<a class="code" href="namespaceX86ISA.html#ab5f9a01fc40e47853ae9551b008afcbd">x</a>]);
<a name="l00075"></a>00075     }
<a name="l00076"></a>00076 
<a name="l00077"></a>00077     <a class="code" href="classX86ISA_1_1TLB.html#a54537e5fcbe2d6f609ca4c90a48a06a8">walker</a> = <a class="code" href="namespaceX86ISA.html#af675c1d542a25b96e11164b80809a856">p</a>-&gt;walker;
<a name="l00078"></a>00078     <a class="code" href="classX86ISA_1_1TLB.html#a54537e5fcbe2d6f609ca4c90a48a06a8">walker</a>-&gt;setTLB(<span class="keyword">this</span>);
<a name="l00079"></a>00079 }
</pre></div></p>

</div>
</div>
<hr/><h2>関数</h2>
<a class="anchor" id="a18477caae4a9699b99ee4f1ebca75c31"></a><!-- doxytag: member="X86ISA::TLB::demapPage" ref="a18477caae4a9699b99ee4f1ebca75c31" args="(Addr va, uint64_t asn)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void demapPage </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a>&nbsp;</td>
          <td class="paramname"> <em>va</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&nbsp;</td>
          <td class="paramname"> <em>asn</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><a class="el" href="classBaseTLB.html#aff4b9d01b9a4712c699cfb2dd9b3b8cd">BaseTLB</a>を実装しています。</p>

<p><div class="fragment"><pre class="fragment"><a name="l00166"></a>00166 {
<a name="l00167"></a>00167     TlbEntry *entry = <a class="code" href="classX86ISA_1_1TLB.html#aac73611ce3ddb38006a5c03e6ba91977">trie</a>.<a class="code" href="classTrie.html#acb9c4b2b263f23de8efe4c043e82ea38">lookup</a>(<a class="code" href="namespaceArmISA.html#a441099e13f407fadb6bcb0447107de87">va</a>);
<a name="l00168"></a>00168     <span class="keywordflow">if</span> (entry) {
<a name="l00169"></a>00169         <a class="code" href="classX86ISA_1_1TLB.html#aac73611ce3ddb38006a5c03e6ba91977">trie</a>.<a class="code" href="classTrie.html#a9c941ee8c8702adb12e3e404fc275edb">remove</a>(entry-&gt;trieHandle);
<a name="l00170"></a>00170         entry-&gt;trieHandle = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00171"></a>00171         <a class="code" href="classX86ISA_1_1TLB.html#a7c13435dc688d8e4d7600964147b5705">freeList</a>.push_back(entry);
<a name="l00172"></a>00172     }
<a name="l00173"></a>00173 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae59fbc0829276a4cd557c908baf052f0"></a><!-- doxytag: member="X86ISA::TLB::evictLRU" ref="ae59fbc0829276a4cd557c908baf052f0" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void evictLRU </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00083"></a>00083 {
<a name="l00084"></a>00084     <span class="comment">// Find the entry with the lowest (and hence least recently updated)</span>
<a name="l00085"></a>00085     <span class="comment">// sequence number.</span>
<a name="l00086"></a>00086 
<a name="l00087"></a>00087     <span class="keywordtype">unsigned</span> lru = 0;
<a name="l00088"></a>00088     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> = 1; <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> &lt; <a class="code" href="classX86ISA_1_1TLB.html#ab2c6b258f02add8fdf4cfc7c371dd772">size</a>; <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>++) {
<a name="l00089"></a>00089         <span class="keywordflow">if</span> (<a class="code" href="classX86ISA_1_1TLB.html#a4651b9a4f432960d77d8e3d30175aab3">tlb</a>[<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>].<a class="code" href="classX86ISA_1_1TLB.html#a5bea8f11255089115ad43ef4d83e7c7f">lruSeq</a> &lt; <a class="code" href="classX86ISA_1_1TLB.html#a4651b9a4f432960d77d8e3d30175aab3">tlb</a>[lru].<a class="code" href="classX86ISA_1_1TLB.html#a5bea8f11255089115ad43ef4d83e7c7f">lruSeq</a>)
<a name="l00090"></a>00090             lru = <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>;
<a name="l00091"></a>00091     }
<a name="l00092"></a>00092 
<a name="l00093"></a>00093     assert(<a class="code" href="classX86ISA_1_1TLB.html#a4651b9a4f432960d77d8e3d30175aab3">tlb</a>[lru].trieHandle);
<a name="l00094"></a>00094     <a class="code" href="classX86ISA_1_1TLB.html#aac73611ce3ddb38006a5c03e6ba91977">trie</a>.<a class="code" href="classTrie.html#a9c941ee8c8702adb12e3e404fc275edb">remove</a>(<a class="code" href="classX86ISA_1_1TLB.html#a4651b9a4f432960d77d8e3d30175aab3">tlb</a>[lru].trieHandle);
<a name="l00095"></a>00095     <a class="code" href="classX86ISA_1_1TLB.html#a4651b9a4f432960d77d8e3d30175aab3">tlb</a>[lru].trieHandle = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00096"></a>00096     <a class="code" href="classX86ISA_1_1TLB.html#a7c13435dc688d8e4d7600964147b5705">freeList</a>.push_back(&amp;<a class="code" href="classX86ISA_1_1TLB.html#a4651b9a4f432960d77d8e3d30175aab3">tlb</a>[lru]);
<a name="l00097"></a>00097 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae199d95c42e036851a8a0543c6d6d2e3"></a><!-- doxytag: member="X86ISA::TLB::finalizePhysical" ref="ae199d95c42e036851a8a0543c6d6d2e3" args="(RequestPtr req, ThreadContext *tc, Mode mode) const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classRefCountingPtr.html">Fault</a> finalizePhysical </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classRequest.html">RequestPtr</a>&nbsp;</td>
          <td class="paramname"> <em>req</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classThreadContext.html">ThreadContext</a> *&nbsp;</td>
          <td class="paramname"> <em>tc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classBaseTLB.html#a46c8a310cf4c094f8c80e1cb8dc1f911">Mode</a>&nbsp;</td>
          <td class="paramname"> <em>mode</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td> const</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Do post-translation physical address finalization.</p>
<p>Some addresses, for example requests going to the APIC, need post-translation updates. Such physical addresses are remapped into a "magic" part of the physical address space by this method.</p>
<dl><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>req</em>&nbsp;</td><td><a class="el" href="classRequest.html">Request</a> to updated in-place. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>tc</em>&nbsp;</td><td>Thread context that created the request. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>mode</em>&nbsp;</td><td><a class="el" href="classRequest.html">Request</a> type (read/write/execute). </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>戻り値:</b></dt><dd>A fault on failure, NoFault otherwise. </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00231"></a>00231 {
<a name="l00232"></a>00232     <a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a> paddr = req-&gt;<a class="code" href="classRequest.html#a744ef11a5afe9d3651ce5f954259cb43">getPaddr</a>();
<a name="l00233"></a>00233 
<a name="l00234"></a>00234     <span class="comment">// Check for an access to the local APIC</span>
<a name="l00235"></a>00235     <span class="keywordflow">if</span> (<a class="code" href="full__system_8hh.html#af929576af6f85c8849704b66d04b8370">FullSystem</a>) {
<a name="l00236"></a>00236         LocalApicBase localApicBase =
<a name="l00237"></a>00237             tc-&gt;<a class="code" href="classThreadContext.html#a93c9c97261cb7289d5976b8222f70c4c">readMiscRegNoEffect</a>(<a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67aa140419207c4efa0ada78f30ac3e5589">MISCREG_APIC_BASE</a>);
<a name="l00238"></a>00238         <a class="code" href="classAddrRange.html">AddrRange</a> apicRange(localApicBase.base * <a class="code" href="namespaceX86ISA.html#a7a804a2139c455999786dede70a4467b">PageBytes</a>,
<a name="l00239"></a>00239                             (localApicBase.base + 1) * <a class="code" href="namespaceX86ISA.html#a7a804a2139c455999786dede70a4467b">PageBytes</a> - 1);
<a name="l00240"></a>00240 
<a name="l00241"></a>00241         <a class="code" href="classAddrRange.html">AddrRange</a> m5opRange(0xFFFF0000, 0xFFFFFFFF);
<a name="l00242"></a>00242 
<a name="l00243"></a>00243         <span class="keywordflow">if</span> (apicRange.contains(paddr)) {
<a name="l00244"></a>00244             <span class="comment">// The Intel developer&apos;s manuals say the below restrictions apply,</span>
<a name="l00245"></a>00245             <span class="comment">// but the linux kernel, because of a compiler optimization, breaks</span>
<a name="l00246"></a>00246             <span class="comment">// them.</span>
<a name="l00247"></a>00247             <span class="comment">/*</span>
<a name="l00248"></a>00248 <span class="comment">            // Check alignment</span>
<a name="l00249"></a>00249 <span class="comment">            if (paddr &amp; ((32/8) - 1))</span>
<a name="l00250"></a>00250 <span class="comment">                return new GeneralProtection(0);</span>
<a name="l00251"></a>00251 <span class="comment">            // Check access size</span>
<a name="l00252"></a>00252 <span class="comment">            if (req-&gt;getSize() != (32/8))</span>
<a name="l00253"></a>00253 <span class="comment">                return new GeneralProtection(0);</span>
<a name="l00254"></a>00254 <span class="comment">            */</span>
<a name="l00255"></a>00255             <span class="comment">// Force the access to be uncacheable.</span>
<a name="l00256"></a>00256             req-&gt;<a class="code" href="classRequest.html#a33971d22712c9c80177e4362dffd5580">setFlags</a>(<a class="code" href="classRequest.html#a0fc1d6bc92a0567b05130468e04f05f8">Request::UNCACHEABLE</a>);
<a name="l00257"></a>00257             req-&gt;<a class="code" href="classRequest.html#a688b841276b48f5c420569e62a090130">setPaddr</a>(<a class="code" href="namespaceX86ISA.html#afe1cfa1e015d1bc9a1aaa13453e9af92">x86LocalAPICAddress</a>(tc-&gt;<a class="code" href="classThreadContext.html#a5a3ce3f955d2ec16ac6f2aa21e42f3a0">contextId</a>(),
<a name="l00258"></a>00258                                               paddr - apicRange.start()));
<a name="l00259"></a>00259         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (m5opRange.contains(paddr)) {
<a name="l00260"></a>00260             req-&gt;<a class="code" href="classRequest.html#a33971d22712c9c80177e4362dffd5580">setFlags</a>(<a class="code" href="classRequest.html#a49ba1ff56158133aba02dce7a13952cb">Request::MMAPPED_IPR</a> | <a class="code" href="classRequest.html#accd8911f1ee38787b977ee8f122dcd5d">Request::GENERIC_IPR</a>);
<a name="l00261"></a>00261             req-&gt;<a class="code" href="classRequest.html#a688b841276b48f5c420569e62a090130">setPaddr</a>(<a class="code" href="namespaceGenericISA.html#a79a8335aadefb64d22e7fc06ac063ad0">GenericISA::iprAddressPseudoInst</a>(
<a name="l00262"></a>00262                               (paddr &gt;&gt; 8) &amp; 0xFF,
<a name="l00263"></a>00263                               paddr &amp; 0xFF));
<a name="l00264"></a>00264         }
<a name="l00265"></a>00265     }
<a name="l00266"></a>00266 
<a name="l00267"></a>00267     <span class="keywordflow">return</span> <a class="code" href="fault__fwd_8hh.html#ab8ce3b69a6737f63fcdcf99910feb153">NoFault</a>;
<a name="l00268"></a>00268 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aca1483a67aee5a91e442f7131d66bcbd"></a><!-- doxytag: member="X86ISA::TLB::flushAll" ref="aca1483a67aee5a91e442f7131d66bcbd" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void flushAll </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Remove all entries from the <a class="el" href="classX86ISA_1_1TLB.html">TLB</a> </p>

<p><a class="el" href="classBaseTLB.html#a5958bc92949a47d1be1088468abdc006">BaseTLB</a>を実装しています。</p>

<p><div class="fragment"><pre class="fragment"><a name="l00134"></a>00134 {
<a name="l00135"></a>00135     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classX86ISA_1_1TLB.html#acb886bd3c59f00c21be9ceaaf25dab97">TLB</a>, <span class="stringliteral">&quot;Invalidating all entries.\n&quot;</span>);
<a name="l00136"></a>00136     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> = 0; <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> &lt; <a class="code" href="classX86ISA_1_1TLB.html#ab2c6b258f02add8fdf4cfc7c371dd772">size</a>; <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>++) {
<a name="l00137"></a>00137         <span class="keywordflow">if</span> (<a class="code" href="classX86ISA_1_1TLB.html#a4651b9a4f432960d77d8e3d30175aab3">tlb</a>[<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>].trieHandle) {
<a name="l00138"></a>00138             <a class="code" href="classX86ISA_1_1TLB.html#aac73611ce3ddb38006a5c03e6ba91977">trie</a>.<a class="code" href="classTrie.html#a9c941ee8c8702adb12e3e404fc275edb">remove</a>(<a class="code" href="classX86ISA_1_1TLB.html#a4651b9a4f432960d77d8e3d30175aab3">tlb</a>[<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>].trieHandle);
<a name="l00139"></a>00139             <a class="code" href="classX86ISA_1_1TLB.html#a4651b9a4f432960d77d8e3d30175aab3">tlb</a>[<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>].trieHandle = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00140"></a>00140             <a class="code" href="classX86ISA_1_1TLB.html#a7c13435dc688d8e4d7600964147b5705">freeList</a>.push_back(&amp;<a class="code" href="classX86ISA_1_1TLB.html#a4651b9a4f432960d77d8e3d30175aab3">tlb</a>[<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>]);
<a name="l00141"></a>00141         }
<a name="l00142"></a>00142     }
<a name="l00143"></a>00143 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a31bf0dd34724a05bf42926ee68e516ef"></a><!-- doxytag: member="X86ISA::TLB::flushNonGlobal" ref="a31bf0dd34724a05bf42926ee68e516ef" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void flushNonGlobal </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00153"></a>00153 {
<a name="l00154"></a>00154     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classX86ISA_1_1TLB.html#acb886bd3c59f00c21be9ceaaf25dab97">TLB</a>, <span class="stringliteral">&quot;Invalidating all non global entries.\n&quot;</span>);
<a name="l00155"></a>00155     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> = 0; <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> &lt; <a class="code" href="classX86ISA_1_1TLB.html#ab2c6b258f02add8fdf4cfc7c371dd772">size</a>; <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>++) {
<a name="l00156"></a>00156         <span class="keywordflow">if</span> (<a class="code" href="classX86ISA_1_1TLB.html#a4651b9a4f432960d77d8e3d30175aab3">tlb</a>[<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>].trieHandle &amp;&amp; !<a class="code" href="classX86ISA_1_1TLB.html#a4651b9a4f432960d77d8e3d30175aab3">tlb</a>[<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>].global) {
<a name="l00157"></a>00157             <a class="code" href="classX86ISA_1_1TLB.html#aac73611ce3ddb38006a5c03e6ba91977">trie</a>.<a class="code" href="classTrie.html#a9c941ee8c8702adb12e3e404fc275edb">remove</a>(<a class="code" href="classX86ISA_1_1TLB.html#a4651b9a4f432960d77d8e3d30175aab3">tlb</a>[<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>].trieHandle);
<a name="l00158"></a>00158             <a class="code" href="classX86ISA_1_1TLB.html#a4651b9a4f432960d77d8e3d30175aab3">tlb</a>[<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>].trieHandle = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00159"></a>00159             <a class="code" href="classX86ISA_1_1TLB.html#a7c13435dc688d8e4d7600964147b5705">freeList</a>.push_back(&amp;<a class="code" href="classX86ISA_1_1TLB.html#a4651b9a4f432960d77d8e3d30175aab3">tlb</a>[<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>]);
<a name="l00160"></a>00160         }
<a name="l00161"></a>00161     }
<a name="l00162"></a>00162 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2ea87b216b1f58953a679590672be258"></a><!-- doxytag: member="X86ISA::TLB::getMasterPort" ref="a2ea87b216b1f58953a679590672be258" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classBaseMasterPort.html">BaseMasterPort</a> * getMasterPort </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Get the table walker master port. This is used for migrating port connections during a CPU <a class="el" href="classX86ISA_1_1TLB.html#a15b6c15c1be2ca4de3e65772a02aa29f">takeOverFrom()</a> call. For architectures that do not have a table walker, NULL is returned, hence the use of a pointer rather than a reference. For X86 this method will always return a valid port pointer.</p>
<dl class="return"><dt><b>戻り値:</b></dt><dd>A pointer to the walker master port </dd></dl>

<p><a class="el" href="classBaseTLB.html#a5125451589673cb85c7cab06c2ac5434">BaseTLB</a>を再定義しています。</p>

<p><div class="fragment"><pre class="fragment"><a name="l00490"></a>00490 {
<a name="l00491"></a>00491     <span class="keywordflow">return</span> &amp;<a class="code" href="classX86ISA_1_1TLB.html#a54537e5fcbe2d6f609ca4c90a48a06a8">walker</a>-&gt;getMasterPort(<span class="stringliteral">&quot;port&quot;</span>);
<a name="l00492"></a>00492 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2f35a7f4b93d6ec096a0785e0d7113cd"></a><!-- doxytag: member="X86ISA::TLB::getWalker" ref="a2f35a7f4b93d6ec096a0785e0d7113cd" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classX86ISA_1_1Walker.html">Walker</a> * getWalker </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00443"></a>00443 {
<a name="l00444"></a>00444     <span class="keywordflow">return</span> <a class="code" href="classX86ISA_1_1TLB.html#a54537e5fcbe2d6f609ca4c90a48a06a8">walker</a>;
<a name="l00445"></a>00445 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1b0164809bc96e78b231ff2143eb3cfc"></a><!-- doxytag: member="X86ISA::TLB::insert" ref="a1b0164809bc96e78b231ff2143eb3cfc" args="(Addr vpn, TlbEntry &amp;entry)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TlbEntry * insert </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a>&nbsp;</td>
          <td class="paramname"> <em>vpn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">TlbEntry &amp;&nbsp;</td>
          <td class="paramname"> <em>entry</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00101"></a>00101 {
<a name="l00102"></a>00102     <span class="comment">// If somebody beat us to it, just use that existing entry.</span>
<a name="l00103"></a>00103     TlbEntry *newEntry = <a class="code" href="classX86ISA_1_1TLB.html#aac73611ce3ddb38006a5c03e6ba91977">trie</a>.<a class="code" href="classTrie.html#acb9c4b2b263f23de8efe4c043e82ea38">lookup</a>(vpn);
<a name="l00104"></a>00104     <span class="keywordflow">if</span> (newEntry) {
<a name="l00105"></a>00105         assert(newEntry-&gt;vaddr == vpn);
<a name="l00106"></a>00106         <span class="keywordflow">return</span> newEntry;
<a name="l00107"></a>00107     }
<a name="l00108"></a>00108 
<a name="l00109"></a>00109     <span class="keywordflow">if</span> (<a class="code" href="classX86ISA_1_1TLB.html#a7c13435dc688d8e4d7600964147b5705">freeList</a>.empty())
<a name="l00110"></a>00110         <a class="code" href="classX86ISA_1_1TLB.html#ae59fbc0829276a4cd557c908baf052f0">evictLRU</a>();
<a name="l00111"></a>00111 
<a name="l00112"></a>00112     newEntry = <a class="code" href="classX86ISA_1_1TLB.html#a7c13435dc688d8e4d7600964147b5705">freeList</a>.front();
<a name="l00113"></a>00113     <a class="code" href="classX86ISA_1_1TLB.html#a7c13435dc688d8e4d7600964147b5705">freeList</a>.pop_front();
<a name="l00114"></a>00114 
<a name="l00115"></a>00115     *newEntry = entry;
<a name="l00116"></a>00116     newEntry-&gt;lruSeq = <a class="code" href="classX86ISA_1_1TLB.html#ab150a470cb370c561702b113ede76c7d">nextSeq</a>();
<a name="l00117"></a>00117     newEntry-&gt;vaddr = vpn;
<a name="l00118"></a>00118     newEntry-&gt;trieHandle =
<a name="l00119"></a>00119     <a class="code" href="classX86ISA_1_1TLB.html#aac73611ce3ddb38006a5c03e6ba91977">trie</a>.<a class="code" href="classTrie.html#ae59d2fa56f1f1cdc960689dd80bd1dbb">insert</a>(vpn, <a class="code" href="classTrie.html#a053e1542a5279ab920fa8fa174e9eda9">TlbEntryTrie::MaxBits</a> - entry.logBytes, newEntry);
<a name="l00120"></a>00120     <span class="keywordflow">return</span> newEntry;
<a name="l00121"></a>00121 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab71ae01bf6743de678ebdc212e7bb401"></a><!-- doxytag: member="X86ISA::TLB::lookup" ref="ab71ae01bf6743de678ebdc212e7bb401" args="(Addr va, bool update_lru=true)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TlbEntry * lookup </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a>&nbsp;</td>
          <td class="paramname"> <em>va</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>update_lru</em> = <code>true</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00125"></a>00125 {
<a name="l00126"></a>00126     TlbEntry *entry = <a class="code" href="classX86ISA_1_1TLB.html#aac73611ce3ddb38006a5c03e6ba91977">trie</a>.<a class="code" href="classTrie.html#acb9c4b2b263f23de8efe4c043e82ea38">lookup</a>(<a class="code" href="namespaceArmISA.html#a441099e13f407fadb6bcb0447107de87">va</a>);
<a name="l00127"></a>00127     <span class="keywordflow">if</span> (entry &amp;&amp; update_lru)
<a name="l00128"></a>00128         entry-&gt;lruSeq = <a class="code" href="classX86ISA_1_1TLB.html#ab150a470cb370c561702b113ede76c7d">nextSeq</a>();
<a name="l00129"></a>00129     <span class="keywordflow">return</span> entry;
<a name="l00130"></a>00130 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae73955fcefd34a6fab596ade6c99290f"></a><!-- doxytag: member="X86ISA::TLB::lookupIt" ref="ae73955fcefd34a6fab596ade6c99290f" args="(Addr va, bool update_lru=true)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">EntryList::iterator lookupIt </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a>&nbsp;</td>
          <td class="paramname"> <em>va</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>update_lru</em> = <code>true</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ab150a470cb370c561702b113ede76c7d"></a><!-- doxytag: member="X86ISA::TLB::nextSeq" ref="ab150a470cb370c561702b113ede76c7d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t nextSeq </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00121"></a>00121         {
<a name="l00122"></a>00122             <span class="keywordflow">return</span> ++<a class="code" href="classX86ISA_1_1TLB.html#a5bea8f11255089115ad43ef4d83e7c7f">lruSeq</a>;
<a name="l00123"></a>00123         }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a53e036786d17361be4c7320d39c99b84"></a><!-- doxytag: member="X86ISA::TLB::serialize" ref="a53e036786d17361be4c7320d39c99b84" args="(std::ostream &amp;os)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void serialize </td>
          <td>(</td>
          <td class="paramtype">std::ostream &amp;&nbsp;</td>
          <td class="paramname"> <em>os</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><a class="el" href="classSerializable.html#ad6272f80ae37e8331e3969b3f072a801">Serializable</a>を再定義しています。</p>

<p><div class="fragment"><pre class="fragment"><a name="l00449"></a>00449 {
<a name="l00450"></a>00450     <span class="comment">// Only store the entries in use.</span>
<a name="l00451"></a>00451     <a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> _size = <a class="code" href="classX86ISA_1_1TLB.html#ab2c6b258f02add8fdf4cfc7c371dd772">size</a> - <a class="code" href="classX86ISA_1_1TLB.html#a7c13435dc688d8e4d7600964147b5705">freeList</a>.size();
<a name="l00452"></a>00452     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(_size);
<a name="l00453"></a>00453     <a class="code" href="serialize_8hh.html#a49163149ec656ffecff0e46aee418e29">SERIALIZE_SCALAR</a>(<a class="code" href="classX86ISA_1_1TLB.html#a5bea8f11255089115ad43ef4d83e7c7f">lruSeq</a>);
<a name="l00454"></a>00454 
<a name="l00455"></a>00455     <a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> _count = 0;
<a name="l00456"></a>00456 
<a name="l00457"></a>00457     <span class="keywordflow">for</span> (<a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> <a class="code" href="namespaceX86ISA.html#ab5f9a01fc40e47853ae9551b008afcbd">x</a> = 0; <a class="code" href="namespaceX86ISA.html#ab5f9a01fc40e47853ae9551b008afcbd">x</a> &lt; <a class="code" href="classX86ISA_1_1TLB.html#ab2c6b258f02add8fdf4cfc7c371dd772">size</a>; <a class="code" href="namespaceX86ISA.html#ab5f9a01fc40e47853ae9551b008afcbd">x</a>++) {
<a name="l00458"></a>00458         <span class="keywordflow">if</span> (<a class="code" href="classX86ISA_1_1TLB.html#a4651b9a4f432960d77d8e3d30175aab3">tlb</a>[<a class="code" href="namespaceX86ISA.html#ab5f9a01fc40e47853ae9551b008afcbd">x</a>].trieHandle != <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>) {
<a name="l00459"></a>00459             <a class="code" href="namespaceX86ISA.html#a6b6e6ba763e7eaf46ac5b6372ca98d30">os</a> &lt;&lt; <span class="stringliteral">&quot;\n[&quot;</span> &lt;&lt; <a class="code" href="cprintf_8hh.html#ace22d1c39f2df58e593bc49d1613eca2">csprintf</a>(<span class="stringliteral">&quot;%s.Entry%d&quot;</span>, <a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>(), _count) &lt;&lt; <span class="stringliteral">&quot;]\n&quot;</span>;
<a name="l00460"></a>00460             <a class="code" href="classX86ISA_1_1TLB.html#a4651b9a4f432960d77d8e3d30175aab3">tlb</a>[<a class="code" href="namespaceX86ISA.html#ab5f9a01fc40e47853ae9551b008afcbd">x</a>].serialize(<a class="code" href="namespaceX86ISA.html#a6b6e6ba763e7eaf46ac5b6372ca98d30">os</a>);
<a name="l00461"></a>00461             _count++;
<a name="l00462"></a>00462         }
<a name="l00463"></a>00463     }
<a name="l00464"></a>00464 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae9a8e1a2483b506a07feeeea766ba43e"></a><!-- doxytag: member="X86ISA::TLB::setConfigAddress" ref="ae9a8e1a2483b506a07feeeea766ba43e" args="(uint32_t addr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void setConfigAddress </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&nbsp;</td>
          <td class="paramname"> <em>addr</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00147"></a>00147 {
<a name="l00148"></a>00148     <a class="code" href="classX86ISA_1_1TLB.html#a2c2064456d968624c149f8658bcfee32">configAddress</a> = <a class="code" href="namespaceX86ISA.html#ab705917f60c5566f9ce56a93f798b2e2">addr</a>;
<a name="l00149"></a>00149 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a15b6c15c1be2ca4de3e65772a02aa29f"></a><!-- doxytag: member="X86ISA::TLB::takeOverFrom" ref="a15b6c15c1be2ca4de3e65772a02aa29f" args="(BaseTLB *otlb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void takeOverFrom </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classBaseTLB.html">BaseTLB</a> *&nbsp;</td>
          <td class="paramname"> <em>otlb</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00078"></a>00078 {}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8b22251fd759b80bb032b04e7f2fc68a"></a><!-- doxytag: member="X86ISA::TLB::translate" ref="a8b22251fd759b80bb032b04e7f2fc68a" args="(RequestPtr req, ThreadContext *tc, Translation *translation, Mode mode, bool &amp;delayedResponse, bool timing)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classRefCountingPtr.html">Fault</a> translate </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classRequest.html">RequestPtr</a>&nbsp;</td>
          <td class="paramname"> <em>req</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classThreadContext.html">ThreadContext</a> *&nbsp;</td>
          <td class="paramname"> <em>tc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classBaseTLB_1_1Translation.html">Translation</a> *&nbsp;</td>
          <td class="paramname"> <em>translation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classBaseTLB.html#a46c8a310cf4c094f8c80e1cb8dc1f911">Mode</a>&nbsp;</td>
          <td class="paramname"> <em>mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool &amp;&nbsp;</td>
          <td class="paramname"> <em>delayedResponse</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>timing</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00273"></a>00273 {
<a name="l00274"></a>00274     <a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> <a class="code" href="namespacem5_1_1debug.html#a9ceb38153d5c0f156fbeada6dc00ff4f">flags</a> = req-&gt;<a class="code" href="classRequest.html#a8552aa8d45c9ba10449d51ac08e7d490">getFlags</a>();
<a name="l00275"></a>00275     <span class="keywordtype">int</span> <a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a> = flags &amp; <a class="code" href="namespaceX86ISA.html#a77dc1966203d85366152637f9b44877f">SegmentFlagMask</a>;
<a name="l00276"></a>00276     <span class="keywordtype">bool</span> storeCheck = flags &amp; (<a class="code" href="namespaceX86ISA.html#a90b19ab669542957b0c2b1b5e2187319a9d1043ebef8fbb774d391dc600c9828f">StoreCheck</a> &lt;&lt; <a class="code" href="namespaceX86ISA.html#aa3993f768fd6f39c79856c9039c7523f">FlagShift</a>);
<a name="l00277"></a>00277 
<a name="l00278"></a>00278     delayedResponse = <span class="keyword">false</span>;
<a name="l00279"></a>00279 
<a name="l00280"></a>00280     <span class="comment">// If this is true, we&apos;re dealing with a request to a non-memory address</span>
<a name="l00281"></a>00281     <span class="comment">// space.</span>
<a name="l00282"></a>00282     <span class="keywordflow">if</span> (seg == <a class="code" href="namespaceX86ISA.html#acea32b07c2303d31296b1c07a16c4795afb3d9f8594226898b30603db62c1552f">SEGMENT_REG_MS</a>) {
<a name="l00283"></a>00283         <span class="keywordflow">return</span> <a class="code" href="classX86ISA_1_1TLB.html#ad195b09fbba19be819ba87ce931fc31d">translateInt</a>(req, tc);
<a name="l00284"></a>00284     }
<a name="l00285"></a>00285 
<a name="l00286"></a>00286     <a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a> <a class="code" href="namespaceMipsISA.html#ac78d9788b3f9a366df64485c9afaf1b1">vaddr</a> = req-&gt;<a class="code" href="classRequest.html#a68d2230b37b30d25462093fefdd813ac">getVaddr</a>();
<a name="l00287"></a>00287     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classX86ISA_1_1TLB.html#acb886bd3c59f00c21be9ceaaf25dab97">TLB</a>, <span class="stringliteral">&quot;Translating vaddr %#x.\n&quot;</span>, vaddr);
<a name="l00288"></a>00288 
<a name="l00289"></a>00289     HandyM5Reg m5Reg = tc-&gt;<a class="code" href="classThreadContext.html#a93c9c97261cb7289d5976b8222f70c4c">readMiscRegNoEffect</a>(<a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67a82930abd37514e1c9a8ca58861ae5fe5">MISCREG_M5_REG</a>);
<a name="l00290"></a>00290 
<a name="l00291"></a>00291     <span class="comment">// If protected mode has been enabled...</span>
<a name="l00292"></a>00292     <span class="keywordflow">if</span> (m5Reg.prot) {
<a name="l00293"></a>00293         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classX86ISA_1_1TLB.html#acb886bd3c59f00c21be9ceaaf25dab97">TLB</a>, <span class="stringliteral">&quot;In protected mode.\n&quot;</span>);
<a name="l00294"></a>00294         <span class="comment">// If we&apos;re not in 64-bit mode, do protection/limit checks</span>
<a name="l00295"></a>00295         <span class="keywordflow">if</span> (m5Reg.mode != LongMode) {
<a name="l00296"></a>00296             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classX86ISA_1_1TLB.html#acb886bd3c59f00c21be9ceaaf25dab97">TLB</a>, <span class="stringliteral">&quot;Not in long mode. Checking segment protection.\n&quot;</span>);
<a name="l00297"></a>00297             <span class="comment">// Check for a NULL segment selector.</span>
<a name="l00298"></a>00298             <span class="keywordflow">if</span> (!(seg == <a class="code" href="namespaceX86ISA.html#acea32b07c2303d31296b1c07a16c4795a8943a9a57238f28dee122ccd9044433c">SEGMENT_REG_TSG</a> || seg == <a class="code" href="namespaceX86ISA.html#acea32b07c2303d31296b1c07a16c4795ac023d4308917b4ec9903ea747a402436">SYS_SEGMENT_REG_IDTR</a> ||
<a name="l00299"></a>00299                         seg == <a class="code" href="namespaceX86ISA.html#acea32b07c2303d31296b1c07a16c4795a0d1dfaa56ad432fa2f754bf2ebe0f318">SEGMENT_REG_HS</a> || seg == <a class="code" href="namespaceX86ISA.html#acea32b07c2303d31296b1c07a16c4795aafe026a2af8de6147a444e0171b09abb">SEGMENT_REG_LS</a>)
<a name="l00300"></a>00300                     &amp;&amp; !tc-&gt;<a class="code" href="classThreadContext.html#a93c9c97261cb7289d5976b8222f70c4c">readMiscRegNoEffect</a>(<a class="code" href="namespaceX86ISA.html#a7a287359d6688cb50477df97dcbdd196">MISCREG_SEG_SEL</a>(seg)))
<a name="l00301"></a>00301                 <span class="keywordflow">return</span> <span class="keyword">new</span> GeneralProtection(0);
<a name="l00302"></a>00302             <span class="keywordtype">bool</span> <a class="code" href="namespaceX86ISA.html#a33304412ade61b5bca30e94dc472de6b">expandDown</a> = <span class="keyword">false</span>;
<a name="l00303"></a>00303             SegAttr <a class="code" href="namespaceArmISA.html#a710acfac10f0042826d2d6d9c213ae7b">attr</a> = tc-&gt;<a class="code" href="classThreadContext.html#a93c9c97261cb7289d5976b8222f70c4c">readMiscRegNoEffect</a>(<a class="code" href="namespaceX86ISA.html#abb8ec3742a54286da349c98a1a9c9755">MISCREG_SEG_ATTR</a>(seg));
<a name="l00304"></a>00304             <span class="keywordflow">if</span> (seg &gt;= <a class="code" href="namespaceX86ISA.html#acea32b07c2303d31296b1c07a16c4795ad24d586eb77e26eb5161e8fbd7316ecb">SEGMENT_REG_ES</a> &amp;&amp; seg &lt;= <a class="code" href="namespaceX86ISA.html#acea32b07c2303d31296b1c07a16c4795a0d1dfaa56ad432fa2f754bf2ebe0f318">SEGMENT_REG_HS</a>) {
<a name="l00305"></a>00305                 <span class="keywordflow">if</span> (!attr.writable &amp;&amp; (<a class="code" href="namespaceArmISA.html#a5f3b9b97eb2dfa29d33e74878455f90d">mode</a> == <a class="code" href="classBaseTLB.html#a46c8a310cf4c094f8c80e1cb8dc1f911aa56670174817e3fed92bfd8182d7c0d1">Write</a> || storeCheck))
<a name="l00306"></a>00306                     <span class="keywordflow">return</span> <span class="keyword">new</span> GeneralProtection(0);
<a name="l00307"></a>00307                 <span class="keywordflow">if</span> (!attr.readable &amp;&amp; <a class="code" href="namespaceArmISA.html#a5f3b9b97eb2dfa29d33e74878455f90d">mode</a> == <a class="code" href="classBaseTLB.html#a46c8a310cf4c094f8c80e1cb8dc1f911a809abe96853e69894bbf8e5730b31348">Read</a>)
<a name="l00308"></a>00308                     <span class="keywordflow">return</span> <span class="keyword">new</span> GeneralProtection(0);
<a name="l00309"></a>00309                 expandDown = attr.expandDown;
<a name="l00310"></a>00310 
<a name="l00311"></a>00311             }
<a name="l00312"></a>00312             <a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a> <a class="code" href="namespaceX86ISA.html#a22fd87812cbb48f6d80b6cc7957490cf">base</a> = tc-&gt;<a class="code" href="classThreadContext.html#a93c9c97261cb7289d5976b8222f70c4c">readMiscRegNoEffect</a>(<a class="code" href="namespaceX86ISA.html#a310d36d3d8ec55a84d807cb7e1edf7d6">MISCREG_SEG_BASE</a>(seg));
<a name="l00313"></a>00313             <a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a> limit = tc-&gt;<a class="code" href="classThreadContext.html#a93c9c97261cb7289d5976b8222f70c4c">readMiscRegNoEffect</a>(<a class="code" href="namespaceX86ISA.html#af93c7fd7ac0d329975952ac0c2a97f98">MISCREG_SEG_LIMIT</a>(seg));
<a name="l00314"></a>00314             <span class="keywordtype">bool</span> sizeOverride = (flags &amp; (<a class="code" href="namespaceX86ISA.html#a90b19ab669542957b0c2b1b5e2187319abf51f7fb18e3e6695e45f0308c065067">AddrSizeFlagBit</a> &lt;&lt; <a class="code" href="namespaceX86ISA.html#aa3993f768fd6f39c79856c9039c7523f">FlagShift</a>));
<a name="l00315"></a>00315             <span class="keywordtype">unsigned</span> logSize = sizeOverride ? (unsigned)m5Reg.altAddr
<a name="l00316"></a>00316                                             : (<span class="keywordtype">unsigned</span>)m5Reg.defAddr;
<a name="l00317"></a>00317             <span class="keywordtype">int</span> <a class="code" href="classX86ISA_1_1TLB.html#ab2c6b258f02add8fdf4cfc7c371dd772">size</a> = (1 &lt;&lt; logSize) * 8;
<a name="l00318"></a>00318             <a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a> <a class="code" href="namespaceArmISA.html#a87b7a740701cddafb930a9460e9f4eba">offset</a> = <a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123">bits</a>(vaddr - base, size - 1, 0);
<a name="l00319"></a>00319             <a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a> endOffset = offset + req-&gt;<a class="code" href="classRequest.html#a3c4029b904a61a9873e6d12785ce19a1">getSize</a>() - 1;
<a name="l00320"></a>00320             <span class="keywordflow">if</span> (expandDown) {
<a name="l00321"></a>00321                 <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classX86ISA_1_1TLB.html#acb886bd3c59f00c21be9ceaaf25dab97">TLB</a>, <span class="stringliteral">&quot;Checking an expand down segment.\n&quot;</span>);
<a name="l00322"></a>00322                 <a class="code" href="base_2misc_8hh.html#abb243c15dfbeedf4ae64aa213f4f18c7">warn_once</a>(<span class="stringliteral">&quot;Expand down segments are untested.\n&quot;</span>);
<a name="l00323"></a>00323                 <span class="keywordflow">if</span> (offset &lt;= limit || endOffset &lt;= limit)
<a name="l00324"></a>00324                     <span class="keywordflow">return</span> <span class="keyword">new</span> GeneralProtection(0);
<a name="l00325"></a>00325             } <span class="keywordflow">else</span> {
<a name="l00326"></a>00326                 <span class="keywordflow">if</span> (offset &gt; limit || endOffset &gt; limit)
<a name="l00327"></a>00327                     <span class="keywordflow">return</span> <span class="keyword">new</span> GeneralProtection(0);
<a name="l00328"></a>00328             }
<a name="l00329"></a>00329         }
<a name="l00330"></a>00330         <span class="keywordflow">if</span> (m5Reg.submode != <a class="code" href="namespaceX86ISA.html#a88701044b173f3a3f9c0d8b09e63eb1baf4b5a2e57762ba0a4b89a8f5dacbbf5b">SixtyFourBitMode</a> ||
<a name="l00331"></a>00331                 (flags &amp; (<a class="code" href="namespaceX86ISA.html#a90b19ab669542957b0c2b1b5e2187319abf51f7fb18e3e6695e45f0308c065067">AddrSizeFlagBit</a> &lt;&lt; <a class="code" href="namespaceX86ISA.html#aa3993f768fd6f39c79856c9039c7523f">FlagShift</a>)))
<a name="l00332"></a>00332             vaddr &amp;= <a class="code" href="namespaceX86ISA.html#a5d76cc2129e79ba1941d2cc2f53b9e8e">mask</a>(32);
<a name="l00333"></a>00333         <span class="comment">// If paging is enabled, do the translation.</span>
<a name="l00334"></a>00334         <span class="keywordflow">if</span> (m5Reg.paging) {
<a name="l00335"></a>00335             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classX86ISA_1_1TLB.html#acb886bd3c59f00c21be9ceaaf25dab97">TLB</a>, <span class="stringliteral">&quot;Paging enabled.\n&quot;</span>);
<a name="l00336"></a>00336             <span class="comment">// The vaddr already has the segment base applied.</span>
<a name="l00337"></a>00337             TlbEntry *entry = <a class="code" href="classX86ISA_1_1TLB.html#ab71ae01bf6743de678ebdc212e7bb401">lookup</a>(vaddr);
<a name="l00338"></a>00338             <span class="keywordflow">if</span> (!entry) {
<a name="l00339"></a>00339                 <span class="keywordflow">if</span> (<a class="code" href="full__system_8hh.html#af929576af6f85c8849704b66d04b8370">FullSystem</a>) {
<a name="l00340"></a>00340                     <a class="code" href="classRefCountingPtr.html">Fault</a> fault = <a class="code" href="classX86ISA_1_1TLB.html#a54537e5fcbe2d6f609ca4c90a48a06a8">walker</a>-&gt;start(tc, translation, req, <a class="code" href="namespaceArmISA.html#a5f3b9b97eb2dfa29d33e74878455f90d">mode</a>);
<a name="l00341"></a>00341                     <span class="keywordflow">if</span> (timing || fault != <a class="code" href="fault__fwd_8hh.html#ab8ce3b69a6737f63fcdcf99910feb153">NoFault</a>) {
<a name="l00342"></a>00342                         <span class="comment">// This gets ignored in atomic mode.</span>
<a name="l00343"></a>00343                         delayedResponse = <span class="keyword">true</span>;
<a name="l00344"></a>00344                         <span class="keywordflow">return</span> fault;
<a name="l00345"></a>00345                     }
<a name="l00346"></a>00346                     entry = <a class="code" href="classX86ISA_1_1TLB.html#ab71ae01bf6743de678ebdc212e7bb401">lookup</a>(vaddr);
<a name="l00347"></a>00347                     assert(entry);
<a name="l00348"></a>00348                 } <span class="keywordflow">else</span> {
<a name="l00349"></a>00349                     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classX86ISA_1_1TLB.html#acb886bd3c59f00c21be9ceaaf25dab97">TLB</a>, <span class="stringliteral">&quot;Handling a TLB miss for &quot;</span>
<a name="l00350"></a>00350                             <span class="stringliteral">&quot;address %#x at pc %#x.\n&quot;</span>,
<a name="l00351"></a>00351                             vaddr, tc-&gt;<a class="code" href="classThreadContext.html#a899644592f5027a7951cfd87b1c548a2">instAddr</a>());
<a name="l00352"></a>00352 
<a name="l00353"></a>00353                     <a class="code" href="classProcess.html">Process</a> *<a class="code" href="namespaceX86ISA.html#af675c1d542a25b96e11164b80809a856">p</a> = tc-&gt;<a class="code" href="classThreadContext.html#a8725d0e5dce89a4a086c7de4bb9d4454">getProcessPtr</a>();
<a name="l00354"></a>00354                     TlbEntry newEntry;
<a name="l00355"></a>00355                     <span class="keywordtype">bool</span> success = p-&gt;<a class="code" href="classProcess.html#ad14ffa23ad731f6003755b643f999049">pTable</a>-&gt;<a class="code" href="classPageTable.html#a5a9bd017a274b26bec6d93084a06a786">lookup</a>(vaddr, newEntry);
<a name="l00356"></a>00356                     <span class="keywordflow">if</span> (!success &amp;&amp; <a class="code" href="namespaceArmISA.html#a5f3b9b97eb2dfa29d33e74878455f90d">mode</a> != <a class="code" href="classBaseTLB.html#a46c8a310cf4c094f8c80e1cb8dc1f911a31b7313c05d32519f3869a3de8be95e6">Execute</a>) {
<a name="l00357"></a>00357                         <span class="comment">// Check if we just need to grow the stack.</span>
<a name="l00358"></a>00358                         <span class="keywordflow">if</span> (p-&gt;fixupStackFault(vaddr)) {
<a name="l00359"></a>00359                             <span class="comment">// If we did, lookup the entry for the new page.</span>
<a name="l00360"></a>00360                             success = p-&gt;pTable-&gt;lookup(vaddr, newEntry);
<a name="l00361"></a>00361                         }
<a name="l00362"></a>00362                     }
<a name="l00363"></a>00363                     <span class="keywordflow">if</span> (!success) {
<a name="l00364"></a>00364                         <span class="keywordflow">return</span> <span class="keyword">new</span> PageFault(vaddr, <span class="keyword">true</span>, <a class="code" href="namespaceArmISA.html#a5f3b9b97eb2dfa29d33e74878455f90d">mode</a>, <span class="keyword">true</span>, <span class="keyword">false</span>);
<a name="l00365"></a>00365                     } <span class="keywordflow">else</span> {
<a name="l00366"></a>00366                         <a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a> alignedVaddr = p-&gt;pTable-&gt;pageAlign(vaddr);
<a name="l00367"></a>00367                         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classX86ISA_1_1TLB.html#acb886bd3c59f00c21be9ceaaf25dab97">TLB</a>, <span class="stringliteral">&quot;Mapping %#x to %#x\n&quot;</span>, alignedVaddr,
<a name="l00368"></a>00368                                 newEntry.pageStart());
<a name="l00369"></a>00369                         entry = <a class="code" href="classX86ISA_1_1TLB.html#a1b0164809bc96e78b231ff2143eb3cfc">insert</a>(alignedVaddr, newEntry);
<a name="l00370"></a>00370                     }
<a name="l00371"></a>00371                     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classX86ISA_1_1TLB.html#acb886bd3c59f00c21be9ceaaf25dab97">TLB</a>, <span class="stringliteral">&quot;Miss was serviced.\n&quot;</span>);
<a name="l00372"></a>00372                 }
<a name="l00373"></a>00373             }
<a name="l00374"></a>00374 
<a name="l00375"></a>00375             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classX86ISA_1_1TLB.html#acb886bd3c59f00c21be9ceaaf25dab97">TLB</a>, <span class="stringliteral">&quot;Entry found with paddr %#x, &quot;</span>
<a name="l00376"></a>00376                     <span class="stringliteral">&quot;doing protection checks.\n&quot;</span>, entry-&gt;paddr);
<a name="l00377"></a>00377             <span class="comment">// Do paging protection checks.</span>
<a name="l00378"></a>00378             <span class="keywordtype">bool</span> inUser = (m5Reg.cpl == 3 &amp;&amp;
<a name="l00379"></a>00379                     !(flags &amp; (<a class="code" href="namespaceX86ISA.html#a90b19ab669542957b0c2b1b5e2187319ab5daf509b6ab04e3fbb3452ebfc07f8a">CPL0FlagBit</a> &lt;&lt; <a class="code" href="namespaceX86ISA.html#aa3993f768fd6f39c79856c9039c7523f">FlagShift</a>)));
<a name="l00380"></a>00380             CR0 cr0 = tc-&gt;<a class="code" href="classThreadContext.html#a93c9c97261cb7289d5976b8222f70c4c">readMiscRegNoEffect</a>(<a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67ada26b29c24bab13bc6d77060ba44fb33">MISCREG_CR0</a>);
<a name="l00381"></a>00381             <span class="keywordtype">bool</span> badWrite = (!entry-&gt;writable &amp;&amp; (inUser || cr0.wp));
<a name="l00382"></a>00382             <span class="keywordflow">if</span> ((inUser &amp;&amp; !entry-&gt;user) || (<a class="code" href="namespaceArmISA.html#a5f3b9b97eb2dfa29d33e74878455f90d">mode</a> == <a class="code" href="classBaseTLB.html#a46c8a310cf4c094f8c80e1cb8dc1f911aa56670174817e3fed92bfd8182d7c0d1">Write</a> &amp;&amp; badWrite)) {
<a name="l00383"></a>00383                 <span class="comment">// The page must have been present to get into the TLB in</span>
<a name="l00384"></a>00384                 <span class="comment">// the first place. We&apos;ll assume the reserved bits are</span>
<a name="l00385"></a>00385                 <span class="comment">// fine even though we&apos;re not checking them.</span>
<a name="l00386"></a>00386                 <span class="keywordflow">return</span> <span class="keyword">new</span> PageFault(vaddr, <span class="keyword">true</span>, <a class="code" href="namespaceArmISA.html#a5f3b9b97eb2dfa29d33e74878455f90d">mode</a>, inUser, <span class="keyword">false</span>);
<a name="l00387"></a>00387             }
<a name="l00388"></a>00388             <span class="keywordflow">if</span> (storeCheck &amp;&amp; badWrite) {
<a name="l00389"></a>00389                 <span class="comment">// This would fault if this were a write, so return a page</span>
<a name="l00390"></a>00390                 <span class="comment">// fault that reflects that happening.</span>
<a name="l00391"></a>00391                 <span class="keywordflow">return</span> <span class="keyword">new</span> PageFault(vaddr, <span class="keyword">true</span>, <a class="code" href="classBaseTLB.html#a46c8a310cf4c094f8c80e1cb8dc1f911aa56670174817e3fed92bfd8182d7c0d1">Write</a>, inUser, <span class="keyword">false</span>);
<a name="l00392"></a>00392             }
<a name="l00393"></a>00393 
<a name="l00394"></a>00394             <a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a> paddr = entry-&gt;paddr | (vaddr &amp; <a class="code" href="namespaceX86ISA.html#a5d76cc2129e79ba1941d2cc2f53b9e8e">mask</a>(entry-&gt;logBytes));
<a name="l00395"></a>00395             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classX86ISA_1_1TLB.html#acb886bd3c59f00c21be9ceaaf25dab97">TLB</a>, <span class="stringliteral">&quot;Translated %#x -&gt; %#x.\n&quot;</span>, vaddr, paddr);
<a name="l00396"></a>00396             req-&gt;<a class="code" href="classRequest.html#a688b841276b48f5c420569e62a090130">setPaddr</a>(paddr);
<a name="l00397"></a>00397             <span class="keywordflow">if</span> (entry-&gt;uncacheable)
<a name="l00398"></a>00398                 req-&gt;<a class="code" href="classRequest.html#a33971d22712c9c80177e4362dffd5580">setFlags</a>(<a class="code" href="classRequest.html#a0fc1d6bc92a0567b05130468e04f05f8">Request::UNCACHEABLE</a>);
<a name="l00399"></a>00399         } <span class="keywordflow">else</span> {
<a name="l00400"></a>00400             <span class="comment">//Use the address which already has segmentation applied.</span>
<a name="l00401"></a>00401             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classX86ISA_1_1TLB.html#acb886bd3c59f00c21be9ceaaf25dab97">TLB</a>, <span class="stringliteral">&quot;Paging disabled.\n&quot;</span>);
<a name="l00402"></a>00402             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classX86ISA_1_1TLB.html#acb886bd3c59f00c21be9ceaaf25dab97">TLB</a>, <span class="stringliteral">&quot;Translated %#x -&gt; %#x.\n&quot;</span>, vaddr, vaddr);
<a name="l00403"></a>00403             req-&gt;<a class="code" href="classRequest.html#a688b841276b48f5c420569e62a090130">setPaddr</a>(vaddr);
<a name="l00404"></a>00404         }
<a name="l00405"></a>00405     } <span class="keywordflow">else</span> {
<a name="l00406"></a>00406         <span class="comment">// Real mode</span>
<a name="l00407"></a>00407         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classX86ISA_1_1TLB.html#acb886bd3c59f00c21be9ceaaf25dab97">TLB</a>, <span class="stringliteral">&quot;In real mode.\n&quot;</span>);
<a name="l00408"></a>00408         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classX86ISA_1_1TLB.html#acb886bd3c59f00c21be9ceaaf25dab97">TLB</a>, <span class="stringliteral">&quot;Translated %#x -&gt; %#x.\n&quot;</span>, vaddr, vaddr);
<a name="l00409"></a>00409         req-&gt;<a class="code" href="classRequest.html#a688b841276b48f5c420569e62a090130">setPaddr</a>(vaddr);
<a name="l00410"></a>00410     }
<a name="l00411"></a>00411 
<a name="l00412"></a>00412     <span class="keywordflow">return</span> <a class="code" href="classX86ISA_1_1TLB.html#ae199d95c42e036851a8a0543c6d6d2e3">finalizePhysical</a>(req, tc, <a class="code" href="namespaceArmISA.html#a5f3b9b97eb2dfa29d33e74878455f90d">mode</a>);
<a name="l00413"></a>00413 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad54e01e3c0a1613098a76b7f92e5be93"></a><!-- doxytag: member="X86ISA::TLB::translateAtomic" ref="ad54e01e3c0a1613098a76b7f92e5be93" args="(RequestPtr req, ThreadContext *tc, Mode mode)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classRefCountingPtr.html">Fault</a> translateAtomic </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classRequest.html">RequestPtr</a>&nbsp;</td>
          <td class="paramname"> <em>req</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classThreadContext.html">ThreadContext</a> *&nbsp;</td>
          <td class="paramname"> <em>tc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classBaseTLB.html#a46c8a310cf4c094f8c80e1cb8dc1f911">Mode</a>&nbsp;</td>
          <td class="paramname"> <em>mode</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00417"></a>00417 {
<a name="l00418"></a>00418     <span class="keywordtype">bool</span> delayedResponse;
<a name="l00419"></a>00419     <span class="keywordflow">return</span> <a class="code" href="classX86ISA_1_1TLB.html#a8b22251fd759b80bb032b04e7f2fc68a">TLB::translate</a>(req, tc, <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>, <a class="code" href="namespaceArmISA.html#a5f3b9b97eb2dfa29d33e74878455f90d">mode</a>, delayedResponse, <span class="keyword">false</span>);
<a name="l00420"></a>00420 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a26658814c6c9034665aae19cf25545bb"></a><!-- doxytag: member="X86ISA::TLB::translateFunctional" ref="a26658814c6c9034665aae19cf25545bb" args="(RequestPtr req, ThreadContext *tc, Mode mode)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classRefCountingPtr.html">Fault</a> translateFunctional </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classRequest.html">RequestPtr</a>&nbsp;</td>
          <td class="paramname"> <em>req</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classThreadContext.html">ThreadContext</a> *&nbsp;</td>
          <td class="paramname"> <em>tc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classBaseTLB.html#a46c8a310cf4c094f8c80e1cb8dc1f911">Mode</a>&nbsp;</td>
          <td class="paramname"> <em>mode</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Stub function for compilation support of <a class="el" href="classCheckerCPU.html">CheckerCPU</a>. x86 <a class="el" href="classX86ISA_1_1ISA.html">ISA</a> does not support <a class="el" href="classChecker.html">Checker</a> model at the moment </p>

<p><div class="fragment"><pre class="fragment"><a name="l00436"></a>00436 {
<a name="l00437"></a>00437     <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Not implemented\n&quot;</span>);
<a name="l00438"></a>00438     <span class="keywordflow">return</span> <a class="code" href="fault__fwd_8hh.html#ab8ce3b69a6737f63fcdcf99910feb153">NoFault</a>;
<a name="l00439"></a>00439 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad195b09fbba19be819ba87ce931fc31d"></a><!-- doxytag: member="X86ISA::TLB::translateInt" ref="ad195b09fbba19be819ba87ce931fc31d" args="(RequestPtr req, ThreadContext *tc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classRefCountingPtr.html">Fault</a> translateInt </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classRequest.html">RequestPtr</a>&nbsp;</td>
          <td class="paramname"> <em>req</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classThreadContext.html">ThreadContext</a> *&nbsp;</td>
          <td class="paramname"> <em>tc</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00177"></a>00177 {
<a name="l00178"></a>00178     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classX86ISA_1_1TLB.html#acb886bd3c59f00c21be9ceaaf25dab97">TLB</a>, <span class="stringliteral">&quot;Addresses references internal memory.\n&quot;</span>);
<a name="l00179"></a>00179     <a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a> <a class="code" href="namespaceMipsISA.html#ac78d9788b3f9a366df64485c9afaf1b1">vaddr</a> = req-&gt;<a class="code" href="classRequest.html#a68d2230b37b30d25462093fefdd813ac">getVaddr</a>();
<a name="l00180"></a>00180     <a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a> prefix = (vaddr &gt;&gt; 3) &amp; <a class="code" href="namespaceX86ISA.html#a62621fac9b93ee845449884ed6837442">IntAddrPrefixMask</a>;
<a name="l00181"></a>00181     <span class="keywordflow">if</span> (prefix == <a class="code" href="namespaceX86ISA.html#a19b7531b77e7cc62c0f9fc6ef2d533ff">IntAddrPrefixCPUID</a>) {
<a name="l00182"></a>00182         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;CPUID memory space not yet implemented!\n&quot;</span>);
<a name="l00183"></a>00183     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (prefix == <a class="code" href="namespaceX86ISA.html#ad4c44000b725a32955ce5a71dd748d6c">IntAddrPrefixMSR</a>) {
<a name="l00184"></a>00184         vaddr = (vaddr &gt;&gt; 3) &amp; ~<a class="code" href="namespaceX86ISA.html#a62621fac9b93ee845449884ed6837442">IntAddrPrefixMask</a>;
<a name="l00185"></a>00185         req-&gt;<a class="code" href="classRequest.html#a33971d22712c9c80177e4362dffd5580">setFlags</a>(<a class="code" href="classRequest.html#a49ba1ff56158133aba02dce7a13952cb">Request::MMAPPED_IPR</a>);
<a name="l00186"></a>00186 
<a name="l00187"></a>00187         <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67">MiscRegIndex</a> regNum;
<a name="l00188"></a>00188         <span class="keywordflow">if</span> (!<a class="code" href="namespaceX86ISA.html#a700421607b87243921222a0b4183eef3">msrAddrToIndex</a>(regNum, vaddr))
<a name="l00189"></a>00189             <span class="keywordflow">return</span> <span class="keyword">new</span> GeneralProtection(0);
<a name="l00190"></a>00190 
<a name="l00191"></a>00191         <span class="comment">//The index is multiplied by the size of a MiscReg so that</span>
<a name="l00192"></a>00192         <span class="comment">//any memory dependence calculations will not see these as</span>
<a name="l00193"></a>00193         <span class="comment">//overlapping.</span>
<a name="l00194"></a>00194         req-&gt;<a class="code" href="classRequest.html#a688b841276b48f5c420569e62a090130">setPaddr</a>((<a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a>)regNum * <span class="keyword">sizeof</span>(<a class="code" href="namespaceX86ISA.html#aa16539aa6584fd12f7d6fa868f75b4de">MiscReg</a>));
<a name="l00195"></a>00195         <span class="keywordflow">return</span> <a class="code" href="fault__fwd_8hh.html#ab8ce3b69a6737f63fcdcf99910feb153">NoFault</a>;
<a name="l00196"></a>00196     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (prefix == <a class="code" href="namespaceX86ISA.html#af68ed0db853c56ca0bc7d0761c54d275">IntAddrPrefixIO</a>) {
<a name="l00197"></a>00197         <span class="comment">// TODO If CPL &gt; IOPL or in virtual mode, check the I/O permission</span>
<a name="l00198"></a>00198         <span class="comment">// bitmap in the TSS.</span>
<a name="l00199"></a>00199 
<a name="l00200"></a>00200         <a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a> IOPort = vaddr &amp; ~<a class="code" href="namespaceX86ISA.html#a62621fac9b93ee845449884ed6837442">IntAddrPrefixMask</a>;
<a name="l00201"></a>00201         <span class="comment">// Make sure the address fits in the expected 16 bit IO address</span>
<a name="l00202"></a>00202         <span class="comment">// space.</span>
<a name="l00203"></a>00203         assert(!(IOPort &amp; ~0xFFFF));
<a name="l00204"></a>00204         <span class="keywordflow">if</span> (IOPort == 0xCF8 &amp;&amp; req-&gt;<a class="code" href="classRequest.html#a3c4029b904a61a9873e6d12785ce19a1">getSize</a>() == 4) {
<a name="l00205"></a>00205             req-&gt;<a class="code" href="classRequest.html#a33971d22712c9c80177e4362dffd5580">setFlags</a>(<a class="code" href="classRequest.html#a49ba1ff56158133aba02dce7a13952cb">Request::MMAPPED_IPR</a>);
<a name="l00206"></a>00206             req-&gt;<a class="code" href="classRequest.html#a688b841276b48f5c420569e62a090130">setPaddr</a>(<a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67af11ef3cfce8ebc43fb6ee1e09fc4aa95">MISCREG_PCI_CONFIG_ADDRESS</a> * <span class="keyword">sizeof</span>(<a class="code" href="namespaceX86ISA.html#aa16539aa6584fd12f7d6fa868f75b4de">MiscReg</a>));
<a name="l00207"></a>00207         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((IOPort &amp; ~<a class="code" href="namespaceX86ISA.html#a5d76cc2129e79ba1941d2cc2f53b9e8e">mask</a>(2)) == 0xCFC) {
<a name="l00208"></a>00208             req-&gt;<a class="code" href="classRequest.html#a33971d22712c9c80177e4362dffd5580">setFlags</a>(<a class="code" href="classRequest.html#a0fc1d6bc92a0567b05130468e04f05f8">Request::UNCACHEABLE</a>);
<a name="l00209"></a>00209             <a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a> <a class="code" href="classX86ISA_1_1TLB.html#a2c2064456d968624c149f8658bcfee32">configAddress</a> =
<a name="l00210"></a>00210                 tc-&gt;<a class="code" href="classThreadContext.html#a93c9c97261cb7289d5976b8222f70c4c">readMiscRegNoEffect</a>(<a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67af11ef3cfce8ebc43fb6ee1e09fc4aa95">MISCREG_PCI_CONFIG_ADDRESS</a>);
<a name="l00211"></a>00211             <span class="keywordflow">if</span> (<a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123">bits</a>(configAddress, 31, 31)) {
<a name="l00212"></a>00212                 req-&gt;<a class="code" href="classRequest.html#a688b841276b48f5c420569e62a090130">setPaddr</a>(<a class="code" href="namespaceX86ISA.html#a384097e1e4d30dd3d5e988b21511cb1f">PhysAddrPrefixPciConfig</a> |
<a name="l00213"></a>00213                         <a class="code" href="bitfield_8hh.html#acaa3c424fec3407f14a01fe1ec22c2d4">mbits</a>(configAddress, 30, 2) |
<a name="l00214"></a>00214                         (IOPort &amp; <a class="code" href="namespaceX86ISA.html#a5d76cc2129e79ba1941d2cc2f53b9e8e">mask</a>(2)));
<a name="l00215"></a>00215             } <span class="keywordflow">else</span> {
<a name="l00216"></a>00216                 req-&gt;<a class="code" href="classRequest.html#a688b841276b48f5c420569e62a090130">setPaddr</a>(<a class="code" href="namespaceX86ISA.html#a170b5c7d48662ed4dbde16baa5f663ca">PhysAddrPrefixIO</a> | IOPort);
<a name="l00217"></a>00217             }
<a name="l00218"></a>00218         } <span class="keywordflow">else</span> {
<a name="l00219"></a>00219             req-&gt;<a class="code" href="classRequest.html#a33971d22712c9c80177e4362dffd5580">setFlags</a>(<a class="code" href="classRequest.html#a0fc1d6bc92a0567b05130468e04f05f8">Request::UNCACHEABLE</a>);
<a name="l00220"></a>00220             req-&gt;<a class="code" href="classRequest.html#a688b841276b48f5c420569e62a090130">setPaddr</a>(<a class="code" href="namespaceX86ISA.html#a170b5c7d48662ed4dbde16baa5f663ca">PhysAddrPrefixIO</a> | IOPort);
<a name="l00221"></a>00221         }
<a name="l00222"></a>00222         <span class="keywordflow">return</span> <a class="code" href="fault__fwd_8hh.html#ab8ce3b69a6737f63fcdcf99910feb153">NoFault</a>;
<a name="l00223"></a>00223     } <span class="keywordflow">else</span> {
<a name="l00224"></a>00224         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Access to unrecognized internal address space %#x.\n&quot;</span>,
<a name="l00225"></a>00225                 prefix);
<a name="l00226"></a>00226     }
<a name="l00227"></a>00227 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae52f7e465748883695d2b4f432a13652"></a><!-- doxytag: member="X86ISA::TLB::translateTiming" ref="ae52f7e465748883695d2b4f432a13652" args="(RequestPtr req, ThreadContext *tc, Translation *translation, Mode mode)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void translateTiming </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classRequest.html">RequestPtr</a>&nbsp;</td>
          <td class="paramname"> <em>req</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classThreadContext.html">ThreadContext</a> *&nbsp;</td>
          <td class="paramname"> <em>tc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classBaseTLB_1_1Translation.html">Translation</a> *&nbsp;</td>
          <td class="paramname"> <em>translation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classBaseTLB.html#a46c8a310cf4c094f8c80e1cb8dc1f911">Mode</a>&nbsp;</td>
          <td class="paramname"> <em>mode</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00425"></a>00425 {
<a name="l00426"></a>00426     <span class="keywordtype">bool</span> delayedResponse;
<a name="l00427"></a>00427     assert(translation);
<a name="l00428"></a>00428     <a class="code" href="classRefCountingPtr.html">Fault</a> fault =
<a name="l00429"></a>00429         <a class="code" href="classX86ISA_1_1TLB.html#a8b22251fd759b80bb032b04e7f2fc68a">TLB::translate</a>(req, tc, translation, <a class="code" href="namespaceArmISA.html#a5f3b9b97eb2dfa29d33e74878455f90d">mode</a>, delayedResponse, <span class="keyword">true</span>);
<a name="l00430"></a>00430     <span class="keywordflow">if</span> (!delayedResponse)
<a name="l00431"></a>00431         translation-&gt;finish(fault, req, tc, <a class="code" href="namespaceArmISA.html#a5f3b9b97eb2dfa29d33e74878455f90d">mode</a>);
<a name="l00432"></a>00432 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af22e5d6d660b97db37003ac61ac4ee49"></a><!-- doxytag: member="X86ISA::TLB::unserialize" ref="af22e5d6d660b97db37003ac61ac4ee49" args="(Checkpoint *cp, const std::string &amp;section)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void unserialize </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classCheckpoint.html">Checkpoint</a> *&nbsp;</td>
          <td class="paramname"> <em>cp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&nbsp;</td>
          <td class="paramname"> <em>section</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><a class="el" href="classSerializable.html#af100c4e9feabf3cd918619c88c718387">Serializable</a>を再定義しています。</p>

<p><div class="fragment"><pre class="fragment"><a name="l00468"></a>00468 {
<a name="l00469"></a>00469     <span class="comment">// Do not allow to restore with a smaller tlb.</span>
<a name="l00470"></a>00470     <a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> _size;
<a name="l00471"></a>00471     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(_size);
<a name="l00472"></a>00472     <span class="keywordflow">if</span> (_size &gt; <a class="code" href="classX86ISA_1_1TLB.html#ab2c6b258f02add8fdf4cfc7c371dd772">size</a>) {
<a name="l00473"></a>00473         <a class="code" href="base_2misc_8hh.html#acad519418dbfdd70c1208711e609c80e">fatal</a>(<span class="stringliteral">&quot;TLB size less than the one in checkpoint!&quot;</span>);
<a name="l00474"></a>00474     }
<a name="l00475"></a>00475 
<a name="l00476"></a>00476     <a class="code" href="serialize_8hh.html#a13d18ccba3d8bcbcd5aab2e37c380bff">UNSERIALIZE_SCALAR</a>(<a class="code" href="classX86ISA_1_1TLB.html#a5bea8f11255089115ad43ef4d83e7c7f">lruSeq</a>);
<a name="l00477"></a>00477 
<a name="l00478"></a>00478     <span class="keywordflow">for</span> (<a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> <a class="code" href="namespaceX86ISA.html#ab5f9a01fc40e47853ae9551b008afcbd">x</a> = 0; <a class="code" href="namespaceX86ISA.html#ab5f9a01fc40e47853ae9551b008afcbd">x</a> &lt; _size; <a class="code" href="namespaceX86ISA.html#ab5f9a01fc40e47853ae9551b008afcbd">x</a>++) {
<a name="l00479"></a>00479         TlbEntry *newEntry = <a class="code" href="classX86ISA_1_1TLB.html#a7c13435dc688d8e4d7600964147b5705">freeList</a>.front();
<a name="l00480"></a>00480         <a class="code" href="classX86ISA_1_1TLB.html#a7c13435dc688d8e4d7600964147b5705">freeList</a>.pop_front();
<a name="l00481"></a>00481 
<a name="l00482"></a>00482         newEntry-&gt;unserialize(cp, <a class="code" href="cprintf_8hh.html#ace22d1c39f2df58e593bc49d1613eca2">csprintf</a>(<span class="stringliteral">&quot;%s.Entry%d&quot;</span>, <a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>(), <a class="code" href="namespaceX86ISA.html#ab5f9a01fc40e47853ae9551b008afcbd">x</a>));
<a name="l00483"></a>00483         newEntry-&gt;trieHandle = <a class="code" href="classX86ISA_1_1TLB.html#aac73611ce3ddb38006a5c03e6ba91977">trie</a>.<a class="code" href="classTrie.html#ae59d2fa56f1f1cdc960689dd80bd1dbb">insert</a>(newEntry-&gt;vaddr,
<a name="l00484"></a>00484             <a class="code" href="classTrie.html#a053e1542a5279ab920fa8fa174e9eda9">TlbEntryTrie::MaxBits</a> - newEntry-&gt;logBytes, newEntry);
<a name="l00485"></a>00485     }
<a name="l00486"></a>00486 }
</pre></div></p>

</div>
</div>
<hr/><h2>フレンドと関連する関数</h2>
<a class="anchor" id="a561951adc2bae72717df4b975c66f02f"></a><!-- doxytag: member="X86ISA::TLB::Walker" ref="a561951adc2bae72717df4b975c66f02f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">friend class <a class="el" href="classX86ISA_1_1Walker.html">Walker</a><code> [friend]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/><h2>変数</h2>
<a class="anchor" id="a2c2064456d968624c149f8658bcfee32"></a><!-- doxytag: member="X86ISA::TLB::configAddress" ref="a2c2064456d968624c149f8658bcfee32" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> <a class="el" href="classX86ISA_1_1TLB.html#a2c2064456d968624c149f8658bcfee32">configAddress</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a7c13435dc688d8e4d7600964147b5705"></a><!-- doxytag: member="X86ISA::TLB::freeList" ref="a7c13435dc688d8e4d7600964147b5705" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classstd_1_1list.html">EntryList</a> <a class="el" href="classX86ISA_1_1TLB.html#a7c13435dc688d8e4d7600964147b5705">freeList</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a5bea8f11255089115ad43ef4d83e7c7f"></a><!-- doxytag: member="X86ISA::TLB::lruSeq" ref="a5bea8f11255089115ad43ef4d83e7c7f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t <a class="el" href="classX86ISA_1_1TLB.html#a5bea8f11255089115ad43ef4d83e7c7f">lruSeq</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ab2c6b258f02add8fdf4cfc7c371dd772"></a><!-- doxytag: member="X86ISA::TLB::size" ref="ab2c6b258f02add8fdf4cfc7c371dd772" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> <a class="el" href="classX86ISA_1_1TLB.html#ab2c6b258f02add8fdf4cfc7c371dd772">size</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a4651b9a4f432960d77d8e3d30175aab3"></a><!-- doxytag: member="X86ISA::TLB::tlb" ref="a4651b9a4f432960d77d8e3d30175aab3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TlbEntry* <a class="el" href="classX86ISA_1_1TLB.html#a4651b9a4f432960d77d8e3d30175aab3">tlb</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="aac73611ce3ddb38006a5c03e6ba91977"></a><!-- doxytag: member="X86ISA::TLB::trie" ref="aac73611ce3ddb38006a5c03e6ba91977" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classTrie.html">TlbEntryTrie</a> <a class="el" href="classX86ISA_1_1TLB.html#aac73611ce3ddb38006a5c03e6ba91977">trie</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a54537e5fcbe2d6f609ca4c90a48a06a8"></a><!-- doxytag: member="X86ISA::TLB::walker" ref="a54537e5fcbe2d6f609ca4c90a48a06a8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classX86ISA_1_1Walker.html">Walker</a>* <a class="el" href="classX86ISA_1_1TLB.html#a54537e5fcbe2d6f609ca4c90a48a06a8">walker</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/>このクラスの説明は次のファイルから生成されました:<ul>
<li>arch/x86/<a class="el" href="arch_2x86_2tlb_8hh_source.html">tlb.hh</a></li>
<li>arch/x86/<a class="el" href="arch_2x86_2tlb_8cc.html">tlb.cc</a></li>
</ul>
</div>
<hr size="1"/><address style="text-align: right;"><small>File&nbsp;GEM5&nbsp;Wrapperに対して25 May 2015に生成されました。&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
