<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>File&nbsp;GEM5&nbsp;Wrapper: クラス PseudoLRUPolicy</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- 作成： Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>メインページ</span></a></li>
      <li><a href="pages.html"><span>関連ページ</span></a></li>
      <li><a href="modules.html"><span>モジュール</span></a></li>
      <li><a href="namespaces.html"><span>ネームスペース</span></a></li>
      <li class="current"><a href="annotated.html"><span>クラス</span></a></li>
      <li><a href="files.html"><span>ファイル</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>構成</span></a></li>
      <li><a href="classes.html"><span>構成索引</span></a></li>
      <li><a href="hierarchy.html"><span>クラス階層</span></a></li>
      <li><a href="functions.html"><span>構成メンバ</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>クラス PseudoLRUPolicy</h1><!-- doxytag: class="PseudoLRUPolicy" --><!-- doxytag: inherits="AbstractReplacementPolicy" -->
<p><code>#include &lt;<a class="el" href="PseudoLRUPolicy_8hh_source.html">PseudoLRUPolicy.hh</a>&gt;</code></p>
<div class="dynheader">
PseudoLRUPolicyに対する継承グラフ</div>
<div class="dynsection">
 <div class="center">
  <img src="classPseudoLRUPolicy.gif" usemap="#PseudoLRUPolicy_map" alt=""/>
  <map id="PseudoLRUPolicy_map" name="PseudoLRUPolicy_map">
<area href="classAbstractReplacementPolicy.html" alt="AbstractReplacementPolicy" shape="rect" coords="0,0,166,24"/>
</map>
 </div>
</div>

<p><a href="classPseudoLRUPolicy-members.html">すべてのメンバ一覧</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Public メソッド</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPseudoLRUPolicy.html#a586be6f6d9e79f655d6166c91088204d">PseudoLRUPolicy</a> (<a class="el" href="TypeDefines_8hh.html#a39642de41f3574937f399f4fab25ba18">Index</a> num_sets, <a class="el" href="TypeDefines_8hh.html#a39642de41f3574937f399f4fab25ba18">Index</a> assoc)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPseudoLRUPolicy.html#a46c39a4b2f695e5fdc2d31a75e579d98">~PseudoLRUPolicy</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPseudoLRUPolicy.html#a6d3ff52feacdaba90c7c0bfbe9f7f58a">touch</a> (<a class="el" href="TypeDefines_8hh.html#a39642de41f3574937f399f4fab25ba18">Index</a> set, <a class="el" href="TypeDefines_8hh.html#a39642de41f3574937f399f4fab25ba18">Index</a> way, <a class="el" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> time)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="TypeDefines_8hh.html#a39642de41f3574937f399f4fab25ba18">Index</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPseudoLRUPolicy.html#aad2c302009bdae8c2f86d7c4e0ed2c8f">getVictim</a> (<a class="el" href="TypeDefines_8hh.html#a39642de41f3574937f399f4fab25ba18">Index</a> set) const </td></tr>
<tr><td colspan="2"><h2>Private 変数</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPseudoLRUPolicy.html#a7715ac656545d5c327a5bbe21e48e4c1">m_effective_assoc</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPseudoLRUPolicy.html#a27b35e9f12570ea06bb2a060bba1ff6b">m_num_levels</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="TypeDefines_8hh.html#a29940ae63ec06c9998bba873e25407ad">uint64</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPseudoLRUPolicy.html#ac97202b70d0180f4854d13627ce86978">m_trees</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>説明</h2>
<p>Implementation of tree-based pseudo-LRU replacement</p>
<p>Works for any associativity between 1 and 128.</p>
<p>Also implements associativities that are not a power of 2 by ignoring paths that lead to a larger index (i.e. truncating the tree). Note that when this occurs, the algorithm becomes less fair, as it will favor indicies in the larger (by index) half of the associative set. This is most unfair when the nearest power of 2 is one below the associativy, and most fair when it is one above. </p>
<hr/><h2>コンストラクタとデストラクタ</h2>
<a class="anchor" id="a586be6f6d9e79f655d6166c91088204d"></a><!-- doxytag: member="PseudoLRUPolicy::PseudoLRUPolicy" ref="a586be6f6d9e79f655d6166c91088204d" args="(Index num_sets, Index assoc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classPseudoLRUPolicy.html">PseudoLRUPolicy</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="TypeDefines_8hh.html#a39642de41f3574937f399f4fab25ba18">Index</a>&nbsp;</td>
          <td class="paramname"> <em>num_sets</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="TypeDefines_8hh.html#a39642de41f3574937f399f4fab25ba18">Index</a>&nbsp;</td>
          <td class="paramname"> <em>assoc</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00065"></a>00065     : <a class="code" href="classAbstractReplacementPolicy.html#a5a97664620a36d345954e66ae7cdbfb0">AbstractReplacementPolicy</a>(num_sets, assoc)
<a name="l00066"></a>00066 {
<a name="l00067"></a>00067     <span class="comment">// associativity cannot exceed capacity of tree representation</span>
<a name="l00068"></a>00068     assert(num_sets &gt; 0 &amp;&amp; assoc &gt; 1 &amp;&amp; assoc &lt;= (<a class="code" href="TypeDefines_8hh.html#a39642de41f3574937f399f4fab25ba18">Index</a>) <span class="keyword">sizeof</span>(<a class="code" href="TypeDefines_8hh.html#a29940ae63ec06c9998bba873e25407ad">uint64</a>)*4);
<a name="l00069"></a>00069 
<a name="l00070"></a>00070     <a class="code" href="classPseudoLRUPolicy.html#ac97202b70d0180f4854d13627ce86978">m_trees</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00071"></a>00071     <a class="code" href="classPseudoLRUPolicy.html#a27b35e9f12570ea06bb2a060bba1ff6b">m_num_levels</a> = 0;
<a name="l00072"></a>00072 
<a name="l00073"></a>00073     <a class="code" href="classPseudoLRUPolicy.html#a7715ac656545d5c327a5bbe21e48e4c1">m_effective_assoc</a> = 1;
<a name="l00074"></a>00074     <span class="keywordflow">while</span> (<a class="code" href="classPseudoLRUPolicy.html#a7715ac656545d5c327a5bbe21e48e4c1">m_effective_assoc</a> &lt; assoc) {
<a name="l00075"></a>00075         <span class="comment">// effective associativity is ceiling power of 2</span>
<a name="l00076"></a>00076         <a class="code" href="classPseudoLRUPolicy.html#a7715ac656545d5c327a5bbe21e48e4c1">m_effective_assoc</a> &lt;&lt;= 1;
<a name="l00077"></a>00077     }
<a name="l00078"></a>00078     assoc = <a class="code" href="classPseudoLRUPolicy.html#a7715ac656545d5c327a5bbe21e48e4c1">m_effective_assoc</a>;
<a name="l00079"></a>00079     <span class="keywordflow">while</span> (<span class="keyword">true</span>) {
<a name="l00080"></a>00080         assoc /= 2;
<a name="l00081"></a>00081         <span class="keywordflow">if</span>(!assoc) <span class="keywordflow">break</span>;
<a name="l00082"></a>00082         <a class="code" href="classPseudoLRUPolicy.html#a27b35e9f12570ea06bb2a060bba1ff6b">m_num_levels</a>++;
<a name="l00083"></a>00083     }
<a name="l00084"></a>00084     assert(<a class="code" href="classPseudoLRUPolicy.html#a27b35e9f12570ea06bb2a060bba1ff6b">m_num_levels</a> &lt; <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)*4);
<a name="l00085"></a>00085     <a class="code" href="classPseudoLRUPolicy.html#ac97202b70d0180f4854d13627ce86978">m_trees</a> = <span class="keyword">new</span> <a class="code" href="TypeDefines_8hh.html#a29940ae63ec06c9998bba873e25407ad">uint64</a>[<a class="code" href="classAbstractReplacementPolicy.html#a02f70f06d6633b7809066c8bd63a6a3e">m_num_sets</a>];
<a name="l00086"></a>00086     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> = 0; <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> &lt; <a class="code" href="classAbstractReplacementPolicy.html#a02f70f06d6633b7809066c8bd63a6a3e">m_num_sets</a>; <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>++) {
<a name="l00087"></a>00087         <a class="code" href="classPseudoLRUPolicy.html#ac97202b70d0180f4854d13627ce86978">m_trees</a>[<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>] = 0;
<a name="l00088"></a>00088     }
<a name="l00089"></a>00089 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a46c39a4b2f695e5fdc2d31a75e579d98"></a><!-- doxytag: member="PseudoLRUPolicy::~PseudoLRUPolicy" ref="a46c39a4b2f695e5fdc2d31a75e579d98" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">~<a class="el" href="classPseudoLRUPolicy.html">PseudoLRUPolicy</a> </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00093"></a>00093 {
<a name="l00094"></a>00094     <span class="keywordflow">if</span> (<a class="code" href="classPseudoLRUPolicy.html#ac97202b70d0180f4854d13627ce86978">m_trees</a> != <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>)
<a name="l00095"></a>00095         <span class="keyword">delete</span>[] <a class="code" href="classPseudoLRUPolicy.html#ac97202b70d0180f4854d13627ce86978">m_trees</a>;
<a name="l00096"></a>00096 }
</pre></div></p>

</div>
</div>
<hr/><h2>関数</h2>
<a class="anchor" id="aad2c302009bdae8c2f86d7c4e0ed2c8f"></a><!-- doxytag: member="PseudoLRUPolicy::getVictim" ref="aad2c302009bdae8c2f86d7c4e0ed2c8f" args="(Index set) const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="TypeDefines_8hh.html#a39642de41f3574937f399f4fab25ba18">Index</a> getVictim </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="TypeDefines_8hh.html#a39642de41f3574937f399f4fab25ba18">Index</a>&nbsp;</td>
          <td class="paramname"> <em>set</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td> const<code> [inline, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><a class="el" href="classAbstractReplacementPolicy.html#a100bd69954d47ece014cbd697a1f8d7f">AbstractReplacementPolicy</a>を実装しています。</p>

<p><div class="fragment"><pre class="fragment"><a name="l00119"></a>00119 {
<a name="l00120"></a>00120     <span class="comment">// assert(m_assoc != 0);</span>
<a name="l00121"></a>00121     <a class="code" href="TypeDefines_8hh.html#a39642de41f3574937f399f4fab25ba18">Index</a> <a class="code" href="namespaceMipsISA.html#ae6714ce3c5ef82205cecbd410556edf3">index</a> = 0;
<a name="l00122"></a>00122 
<a name="l00123"></a>00123     <span class="keywordtype">int</span> tree_index = 0;
<a name="l00124"></a>00124     <span class="keywordtype">int</span> node_val;
<a name="l00125"></a>00125     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> = 0; <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> &lt; <a class="code" href="classPseudoLRUPolicy.html#a27b35e9f12570ea06bb2a060bba1ff6b">m_num_levels</a>; <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>++){
<a name="l00126"></a>00126         node_val = (<a class="code" href="classPseudoLRUPolicy.html#ac97202b70d0180f4854d13627ce86978">m_trees</a>[<span class="keyword">set</span>] &gt;&gt; tree_index) &amp; 1;
<a name="l00127"></a>00127         index += node_val ? 0 : (<a class="code" href="classPseudoLRUPolicy.html#a7715ac656545d5c327a5bbe21e48e4c1">m_effective_assoc</a> &gt;&gt; (<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> + 1));
<a name="l00128"></a>00128         tree_index = node_val ? (tree_index * 2) + 1 : (tree_index * 2) + 2;
<a name="l00129"></a>00129     }
<a name="l00130"></a>00130     assert(index &gt;= 0 &amp;&amp; index &lt; <a class="code" href="classPseudoLRUPolicy.html#a7715ac656545d5c327a5bbe21e48e4c1">m_effective_assoc</a>);
<a name="l00131"></a>00131 
<a name="l00132"></a>00132     <span class="comment">/* return either the found index or the max possible index */</span>
<a name="l00133"></a>00133     <span class="comment">/* NOTE: this is not a fair replacement when assoc is not a power of 2 */</span>
<a name="l00134"></a>00134     <span class="keywordflow">return</span> (index &gt; (<a class="code" href="classAbstractReplacementPolicy.html#a8ad9d20c98fe601aa72716ddc5b97f2d">m_assoc</a> - 1)) ? <a class="code" href="classAbstractReplacementPolicy.html#a8ad9d20c98fe601aa72716ddc5b97f2d">m_assoc</a> - 1 : index;
<a name="l00135"></a>00135 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6d3ff52feacdaba90c7c0bfbe9f7f58a"></a><!-- doxytag: member="PseudoLRUPolicy::touch" ref="a6d3ff52feacdaba90c7c0bfbe9f7f58a" args="(Index set, Index way, Tick time)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void touch </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="TypeDefines_8hh.html#a39642de41f3574937f399f4fab25ba18">Index</a>&nbsp;</td>
          <td class="paramname"> <em>set</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="TypeDefines_8hh.html#a39642de41f3574937f399f4fab25ba18">Index</a>&nbsp;</td>
          <td class="paramname"> <em>way</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a>&nbsp;</td>
          <td class="paramname"> <em>time</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><a class="el" href="classAbstractReplacementPolicy.html#a6354174153ace07b8cef20f36b20357a">AbstractReplacementPolicy</a>を実装しています。</p>

<p><div class="fragment"><pre class="fragment"><a name="l00100"></a>00100 {
<a name="l00101"></a>00101     assert(<a class="code" href="namespaceMipsISA.html#ae6714ce3c5ef82205cecbd410556edf3">index</a> &gt;= 0 &amp;&amp; <a class="code" href="namespaceMipsISA.html#ae6714ce3c5ef82205cecbd410556edf3">index</a> &lt; <a class="code" href="classAbstractReplacementPolicy.html#a8ad9d20c98fe601aa72716ddc5b97f2d">m_assoc</a>);
<a name="l00102"></a>00102     assert(<span class="keyword">set</span> &gt;= 0 &amp;&amp; <span class="keyword">set</span> &lt; <a class="code" href="classAbstractReplacementPolicy.html#a02f70f06d6633b7809066c8bd63a6a3e">m_num_sets</a>);
<a name="l00103"></a>00103 
<a name="l00104"></a>00104     <span class="keywordtype">int</span> tree_index = 0;
<a name="l00105"></a>00105     <span class="keywordtype">int</span> node_val;
<a name="l00106"></a>00106     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> = <a class="code" href="classPseudoLRUPolicy.html#a27b35e9f12570ea06bb2a060bba1ff6b">m_num_levels</a> - 1; <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> &gt;= 0; <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>--) {
<a name="l00107"></a>00107         node_val = (<a class="code" href="namespaceMipsISA.html#ae6714ce3c5ef82205cecbd410556edf3">index</a> &gt;&gt; <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>)&amp;1;
<a name="l00108"></a>00108         <span class="keywordflow">if</span> (node_val)
<a name="l00109"></a>00109             <a class="code" href="classPseudoLRUPolicy.html#ac97202b70d0180f4854d13627ce86978">m_trees</a>[<span class="keyword">set</span>] |= node_val &lt;&lt; tree_index;
<a name="l00110"></a>00110         <span class="keywordflow">else</span>
<a name="l00111"></a>00111             <a class="code" href="classPseudoLRUPolicy.html#ac97202b70d0180f4854d13627ce86978">m_trees</a>[<span class="keyword">set</span>] &amp;= ~(1 &lt;&lt; tree_index);
<a name="l00112"></a>00112         tree_index = node_val ? (tree_index*2)+2 : (tree_index*2)+1;
<a name="l00113"></a>00113     }
<a name="l00114"></a>00114     <a class="code" href="classAbstractReplacementPolicy.html#a24a457a2854b5f62404b18272f5a3da3">m_last_ref_ptr</a>[<span class="keyword">set</span>][<a class="code" href="namespaceMipsISA.html#ae6714ce3c5ef82205cecbd410556edf3">index</a>] = time;
<a name="l00115"></a>00115 }
</pre></div></p>

</div>
</div>
<hr/><h2>変数</h2>
<a class="anchor" id="a7715ac656545d5c327a5bbe21e48e4c1"></a><!-- doxytag: member="PseudoLRUPolicy::m_effective_assoc" ref="a7715ac656545d5c327a5bbe21e48e4c1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int <a class="el" href="classPseudoLRUPolicy.html#a7715ac656545d5c327a5bbe21e48e4c1">m_effective_assoc</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a27b35e9f12570ea06bb2a060bba1ff6b"></a><!-- doxytag: member="PseudoLRUPolicy::m_num_levels" ref="a27b35e9f12570ea06bb2a060bba1ff6b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int <a class="el" href="classPseudoLRUPolicy.html#a27b35e9f12570ea06bb2a060bba1ff6b">m_num_levels</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>nearest (to ceiling) power of 2 </p>

</div>
</div>
<a class="anchor" id="ac97202b70d0180f4854d13627ce86978"></a><!-- doxytag: member="PseudoLRUPolicy::m_trees" ref="ac97202b70d0180f4854d13627ce86978" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="TypeDefines_8hh.html#a29940ae63ec06c9998bba873e25407ad">uint64</a>* <a class="el" href="classPseudoLRUPolicy.html#ac97202b70d0180f4854d13627ce86978">m_trees</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>number of levels in the tree </p>

</div>
</div>
<hr/>このクラスの説明は次のファイルから生成されました:<ul>
<li>mem/ruby/system/<a class="el" href="PseudoLRUPolicy_8hh_source.html">PseudoLRUPolicy.hh</a></li>
</ul>
</div>
<hr size="1"/><address style="text-align: right;"><small>File&nbsp;GEM5&nbsp;Wrapperに対して25 May 2015に生成されました。&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
