<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>File&nbsp;GEM5&nbsp;Wrapper: クラス TableWalker</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- 作成： Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>メインページ</span></a></li>
      <li><a href="pages.html"><span>関連ページ</span></a></li>
      <li><a href="modules.html"><span>モジュール</span></a></li>
      <li><a href="namespaces.html"><span>ネームスペース</span></a></li>
      <li class="current"><a href="annotated.html"><span>クラス</span></a></li>
      <li><a href="files.html"><span>ファイル</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>構成</span></a></li>
      <li><a href="classes.html"><span>構成索引</span></a></li>
      <li><a href="hierarchy.html"><span>クラス階層</span></a></li>
      <li><a href="functions.html"><span>構成メンバ</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="namespaceArmISA.html">ArmISA</a>::<a class="el" href="classArmISA_1_1TableWalker.html">TableWalker</a>
  </div>
</div>
<div class="contents">
<h1>クラス TableWalker</h1><!-- doxytag: class="ArmISA::TableWalker" --><!-- doxytag: inherits="MemObject" -->
<p><code>#include &lt;<a class="el" href="table__walker_8hh_source.html">table_walker.hh</a>&gt;</code></p>
<div class="dynheader">
TableWalkerに対する継承グラフ</div>
<div class="dynsection">
 <div class="center">
  <img src="classArmISA_1_1TableWalker.gif" usemap="#TableWalker_map" alt=""/>
  <map id="TableWalker_map" name="TableWalker_map">
<area href="classMemObject.html" alt="MemObject" shape="rect" coords="105,168,200,192"/>
<area href="classClockedObject.html" alt="ClockedObject" shape="rect" coords="105,112,200,136"/>
<area href="classSimObject.html" alt="SimObject" shape="rect" coords="105,56,200,80"/>
<area href="classEventManager.html" alt="EventManager" shape="rect" coords="0,0,95,24"/>
<area href="classSerializable.html" alt="Serializable" shape="rect" coords="105,0,200,24"/>
<area href="classDrainable.html" alt="Drainable" shape="rect" coords="210,0,305,24"/>
</map>
 </div>
</div>

<p><a href="classArmISA_1_1TableWalker-members.html">すべてのメンバ一覧</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>構成</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker_1_1DescriptorBase.html">DescriptorBase</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker_1_1L1Descriptor.html">L1Descriptor</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker_1_1L2Descriptor.html">L2Descriptor</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker_1_1LongDescriptor.html">LongDescriptor</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker_1_1SnoopingDmaPort.html">SnoopingDmaPort</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker_1_1WalkerState.html">WalkerState</a></td></tr>
<tr><td colspan="2"><h2>Public 型</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef ArmTableWalkerParams&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#a422d0236f689cd69d42b3163a521ea15">Params</a></td></tr>
<tr><td colspan="2"><h2>Public メソッド</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#a94df4bedd6f27d12a3573b5169aa0db6">TableWalker</a> (const <a class="el" href="classArmISA_1_1TableWalker.html#a422d0236f689cd69d42b3163a521ea15">Params</a> *p)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#ab934d192b45cb722aa800d73bbb65f41">~TableWalker</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const <a class="el" href="classArmISA_1_1TableWalker.html#a422d0236f689cd69d42b3163a521ea15">Params</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#acd3c3feb78ae7a8f88fe0f110a718dff">params</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#a39b5e5d6cff3c8f5a248143a702d8f1a">haveLPAE</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#afef641e959fe33dee8702b9bb5e1b9e4">haveVirtualization</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#a47958664a46869f3fb4f9b043da32be5">haveLargeAsid64</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#a5807f306df98d17f68f466ded6d7799f">completeDrain</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#aa8a18d230dba7a674ac8a0b4f35bc36a">drain</a> (<a class="el" href="classDrainManager.html">DrainManager</a> *dm)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#a8f020d3237536fe007fc488c4125c5d8">drainResume</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="classBaseMasterPort.html">BaseMasterPort</a> &amp;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#adc4e675e51defbdd1e354dac729d0703">getMasterPort</a> (const std::string &amp;if_name, <a class="el" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a> idx=<a class="el" href="base_2types_8hh.html#a65bf40f138cf863f0c5e2d8ca1144126">InvalidPortID</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classDmaPort.html">DmaPort</a> &amp;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#aab28913130b30d21077d9a054c46b81f">getWalkerPort</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classRefCountingPtr.html">Fault</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#ae5ef435aac9ac661f33937b2254718b1">walk</a> (<a class="el" href="classRequest.html">RequestPtr</a> req, <a class="el" href="classThreadContext.html">ThreadContext</a> *<a class="el" href="namespaceArmISA.html#a5aff829af55e65b802d83dfcef4e9dd0">tc</a>, uint16_t <a class="el" href="namespaceArmISA.html#a92720268bdaf1e0e53fc66152af0ff18">asid</a>, uint8_t _vmid, bool _isHyp, <a class="el" href="classBaseTLB.html#a46c8a310cf4c094f8c80e1cb8dc1f911">TLB::Mode</a> <a class="el" href="namespaceArmISA.html#a5f3b9b97eb2dfa29d33e74878455f90d">mode</a>, <a class="el" href="classBaseTLB_1_1Translation.html">TLB::Translation</a> *_trans, bool timing, bool functional, bool secure, <a class="el" href="classArmISA_1_1TLB.html#ad6f5d480df151d5bddeefc6271793f08">TLB::ArmTranslationType</a> tranType)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#a0a70f006e7adf20d47920ac6286a2bcb">setTlb</a> (<a class="el" href="classArmISA_1_1TLB.html">TLB</a> *_tlb)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classArmISA_1_1TLB.html">TLB</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#a93d3a5cc8edcf04b6e62ce3ce3eb215c">getTlb</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#ae888fc9d1a9bad8784469601dcf8d436">setMMU</a> (<a class="el" href="classArmISA_1_1Stage2MMU.html">Stage2MMU</a> *<a class="el" href="namespaceArmISA.html#afb747b54d0c5e3e4e1763be19ca9373b">m</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#a43ff5c97155cc958074f6212824d8890">memAttrs</a> (<a class="el" href="classThreadContext.html">ThreadContext</a> *<a class="el" href="namespaceArmISA.html#a5aff829af55e65b802d83dfcef4e9dd0">tc</a>, <a class="el" href="structArmISA_1_1TlbEntry.html">TlbEntry</a> &amp;te, SCTLR <a class="el" href="classArmISA_1_1TableWalker.html#a43c4d132ca97c6cc5358f7be3c2b5a69">sctlr</a>, uint8_t texcb, bool <a class="el" href="namespaceArmISA.html#afaeb18e17f862d8fcb76dfb68a18854f">s</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#ae00bd2d40b63721817ec582dbf4022a5">memAttrsLPAE</a> (<a class="el" href="classThreadContext.html">ThreadContext</a> *<a class="el" href="namespaceArmISA.html#a5aff829af55e65b802d83dfcef4e9dd0">tc</a>, <a class="el" href="structArmISA_1_1TlbEntry.html">TlbEntry</a> &amp;te, <a class="el" href="classArmISA_1_1TableWalker_1_1LongDescriptor.html">LongDescriptor</a> &amp;lDescriptor)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#ae90661ceebb345173d8a0e9306fa9a82">memAttrsAArch64</a> (<a class="el" href="classThreadContext.html">ThreadContext</a> *<a class="el" href="namespaceArmISA.html#a5aff829af55e65b802d83dfcef4e9dd0">tc</a>, <a class="el" href="structArmISA_1_1TlbEntry.html">TlbEntry</a> &amp;te, uint8_t attrIndx, uint8_t <a class="el" href="namespaceArmISA.html#ae375ae4bca8c4da631387855d380343d">sh</a>)</td></tr>
<tr><td colspan="2"><h2>Static Public メソッド</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bd">LookupLevel</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#aea45aff83099165fcb29b3c3df3de9c2">toLookupLevel</a> (uint8_t lookup_level_as_int)</td></tr>
<tr><td colspan="2"><h2>Protected 変数</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classstd_1_1list.html">std::list</a>&lt; <a class="el" href="classArmISA_1_1TableWalker_1_1WalkerState.html">WalkerState</a> * &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#af819b2b862d892da5df10248b6d72787">stateQueues</a> [MAX_LOOKUP_LEVELS]</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classstd_1_1list.html">std::list</a>&lt; <a class="el" href="classArmISA_1_1TableWalker_1_1WalkerState.html">WalkerState</a> * &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#a53a70edbb255426f7f2729f482c7109b">pendingQueue</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classArmISA_1_1TableWalker_1_1SnoopingDmaPort.html">SnoopingDmaPort</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#a9305ff92238d7360a5ee86168e00407b">port</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classDrainManager.html">DrainManager</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#a329b71fb934a93312ca0aacbf5a3f982">drainManager</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classArmISA_1_1Stage2MMU.html">Stage2MMU</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#a21ea64a0a6d9600fb09fff0854fd55d7">stage2Mmu</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#a475f8007920fb01f7f8aa1730b3016bb">isStage2</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classArmISA_1_1TLB.html">TLB</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#a9f0e11329a702fd34819769c899e4bd3">tlb</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">SCTLR&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#a43c4d132ca97c6cc5358f7be3c2b5a69">sctlr</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classArmISA_1_1TableWalker_1_1WalkerState.html">WalkerState</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#a39f16d585c4531d2bf2562631a775d73">pending</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="request_8hh.html#ac366b729262fd8e7cbd3283da6f775cf">MasterID</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#a96ec6a422ac492d05f8b3edc5b58532b">masterId</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#acd34c708c5a97f4ce631bb3b00404045">numSquashable</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#a9f135583566fb70bba3c10395368f2e4">haveSecurity</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#a74ac6c840c516a9b8a6eb63ed9ef1185">_haveLPAE</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#a8327a5b4e38733a0d77ae856ba67725f">_haveVirtualization</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#af85538fbb375410b2750035ab34dc88a">physAddrRange</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#af7d46e1faf4b0edb95f404a28e31902d">_haveLargeAsid64</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classArmSystem.html">ArmSystem</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#a937afcdcc940e8070627553eaebfa58a">armSys</a></td></tr>
<tr><td colspan="2"><h2>Private メソッド</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#a837a539f5e07e8785902d5854efde98d">doL1Descriptor</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#a0498be5140a67703440d5ebdc2916173">doL1DescriptorWrapper</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#a45b9877779ac070b7779f7e1eccdd05e">doL2Descriptor</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#a87d50eb887f4953c0b6881863b71df37">doL2DescriptorWrapper</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#abba315db7bc859eeb10035be0dcc1168">doLongDescriptor</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#a5c436908eca38a39cb98c4dedbf7228c">doL0LongDescriptorWrapper</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#adbdea710854a60040764157e313f730c">doL1LongDescriptorWrapper</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#adf9dfadd21c55c07039abb1f1931be60">doL2LongDescriptorWrapper</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#acc94f58219aff10336e1a78c77604dbb">doL3LongDescriptorWrapper</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#a6a293b1492cb952d30d4b0de42aa9e7e">doLongDescriptorWrapper</a> (<a class="el" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bd">LookupLevel</a> curr_lookup_level)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#a583b81ca3090f4eb8014ec261cadeb6e">fetchDescriptor</a> (<a class="el" href="classm5_1_1params_1_1Addr.html">Addr</a> descAddr, uint8_t *data, int numBytes, <a class="el" href="classFlags.html">Request::Flags</a> flags, int queueIndex, Event *event, void(TableWalker::*doDescriptor)())</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#aad13c1fc4ab80d03d2af5ac43f41be23">insertTableEntry</a> (<a class="el" href="classArmISA_1_1TableWalker_1_1DescriptorBase.html">DescriptorBase</a> &amp;descriptor, bool longDescriptor)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classRefCountingPtr.html">Fault</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#a13d6e703bfb2074a12535d21689a16d5">processWalk</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classRefCountingPtr.html">Fault</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#a81c7003e58d3e96e25e66f221701669e">processWalkLPAE</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classRefCountingPtr.html">Fault</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#a8530d760b97c61b1bf18de8228c3aa90">processWalkAArch64</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#a3e744e2a92a9edac5d9859823bb1ccc8">processWalkWrapper</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#ae126e9ab023c3e4659836daa8f5364be">nextWalk</a> (<a class="el" href="classThreadContext.html">ThreadContext</a> *<a class="el" href="namespaceArmISA.html#a5aff829af55e65b802d83dfcef4e9dd0">tc</a>)</td></tr>
<tr><td colspan="2"><h2>Static Private メソッド</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static unsigned&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#a60f480f39c21ef312d34cb3c8702e9a6">adjustTableSizeAArch64</a> (unsigned tsz)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#a40ad630985e7888b542e819ed09e0551">checkAddrSizeFaultAArch64</a> (<a class="el" href="classm5_1_1params_1_1Addr.html">Addr</a> addr, int currPhysAddrRange)</td></tr>
<tr><td colspan="2"><h2>Private 変数</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classEventWrapper.html">EventWrapper</a>&lt; <a class="el" href="classArmISA_1_1TableWalker.html">TableWalker</a>,&amp;TableWalker::doL1DescriptorWrapper &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#a896d858298222a8d8c96bc69f7db1d84">doL1DescEvent</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classEventWrapper.html">EventWrapper</a>&lt; <a class="el" href="classArmISA_1_1TableWalker.html">TableWalker</a>,&amp;TableWalker::doL2DescriptorWrapper &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#ad6bd6e623ae7ab7d1cbbe0173e9562f4">doL2DescEvent</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classEventWrapper.html">EventWrapper</a>&lt; <a class="el" href="classArmISA_1_1TableWalker.html">TableWalker</a>,&amp;TableWalker::doL0LongDescriptorWrapper &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#a263fa19a40da797a24e51a5edafd9215">doL0LongDescEvent</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classEventWrapper.html">EventWrapper</a>&lt; <a class="el" href="classArmISA_1_1TableWalker.html">TableWalker</a>,&amp;TableWalker::doL1LongDescriptorWrapper &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#a5ab01b63bbaded2920f4e72569b63759">doL1LongDescEvent</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classEventWrapper.html">EventWrapper</a>&lt; <a class="el" href="classArmISA_1_1TableWalker.html">TableWalker</a>,&amp;TableWalker::doL2LongDescriptorWrapper &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#a987d9ee7304c356462000428178c6c5e">doL2LongDescEvent</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classEventWrapper.html">EventWrapper</a>&lt; <a class="el" href="classArmISA_1_1TableWalker.html">TableWalker</a>,&amp;TableWalker::doL3LongDescriptorWrapper &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#a6a30037030613a33f5a056cd7c9af535">doL3LongDescEvent</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classEventWrapper.html">EventWrapper</a>&lt; <a class="el" href="classArmISA_1_1TableWalker.html">TableWalker</a>,&amp;TableWalker::processWalkWrapper &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArmISA_1_1TableWalker.html#ac0fab25a73916f1bf677990e67557b5a">doProcessEvent</a></td></tr>
</table>
<hr/><h2>型定義</h2>
<a class="anchor" id="a422d0236f689cd69d42b3163a521ea15"></a><!-- doxytag: member="ArmISA::TableWalker::Params" ref="a422d0236f689cd69d42b3163a521ea15" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef ArmTableWalkerParams <a class="el" href="classArmISA_1_1TableWalker.html#a422d0236f689cd69d42b3163a521ea15">Params</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><a class="el" href="classMemObject.html#a905bbc621eeec0ed08859e21c8c95412">MemObject</a>を再定義しています。</p>

</div>
</div>
<hr/><h2>コンストラクタとデストラクタ</h2>
<a class="anchor" id="a94df4bedd6f27d12a3573b5169aa0db6"></a><!-- doxytag: member="ArmISA::TableWalker::TableWalker" ref="a94df4bedd6f27d12a3573b5169aa0db6" args="(const Params *p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classArmISA_1_1TableWalker.html">TableWalker</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classArmISA_1_1TableWalker.html#a422d0236f689cd69d42b3163a521ea15">Params</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00057"></a>00057     : <a class="code" href="classMemObject.html#a0390aa3eb5acd29074fac67b8d6472bd">MemObject</a>(<a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a>), <a class="code" href="classArmISA_1_1TableWalker.html#a9305ff92238d7360a5ee86168e00407b">port</a>(<span class="keyword">this</span>, <a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a>-&gt;sys), <a class="code" href="classArmISA_1_1TableWalker.html#a329b71fb934a93312ca0aacbf5a3f982">drainManager</a>(<a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>),
<a name="l00058"></a>00058       <a class="code" href="classArmISA_1_1TableWalker.html#a21ea64a0a6d9600fb09fff0854fd55d7">stage2Mmu</a>(<a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>), <a class="code" href="classArmISA_1_1TableWalker.html#a475f8007920fb01f7f8aa1730b3016bb">isStage2</a>(<a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a>-&gt;is_stage2), <a class="code" href="classArmISA_1_1TableWalker.html#a9f0e11329a702fd34819769c899e4bd3">tlb</a>(<a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>),
<a name="l00059"></a>00059       <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>(<a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>), <a class="code" href="classArmISA_1_1TableWalker.html#a39f16d585c4531d2bf2562631a775d73">pending</a>(<span class="keyword">false</span>), <a class="code" href="classArmISA_1_1TableWalker.html#a96ec6a422ac492d05f8b3edc5b58532b">masterId</a>(<a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a>-&gt;sys-&gt;getMasterId(<a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>())),
<a name="l00060"></a>00060       <a class="code" href="classArmISA_1_1TableWalker.html#acd34c708c5a97f4ce631bb3b00404045">numSquashable</a>(<a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a>-&gt;num_squash_per_cycle),
<a name="l00061"></a>00061       <a class="code" href="classArmISA_1_1TableWalker.html#a896d858298222a8d8c96bc69f7db1d84">doL1DescEvent</a>(<span class="keyword">this</span>), <a class="code" href="classArmISA_1_1TableWalker.html#ad6bd6e623ae7ab7d1cbbe0173e9562f4">doL2DescEvent</a>(<span class="keyword">this</span>),
<a name="l00062"></a>00062       <a class="code" href="classArmISA_1_1TableWalker.html#a263fa19a40da797a24e51a5edafd9215">doL0LongDescEvent</a>(<span class="keyword">this</span>), <a class="code" href="classArmISA_1_1TableWalker.html#a5ab01b63bbaded2920f4e72569b63759">doL1LongDescEvent</a>(<span class="keyword">this</span>), <a class="code" href="classArmISA_1_1TableWalker.html#a987d9ee7304c356462000428178c6c5e">doL2LongDescEvent</a>(<span class="keyword">this</span>),
<a name="l00063"></a>00063       <a class="code" href="classArmISA_1_1TableWalker.html#a6a30037030613a33f5a056cd7c9af535">doL3LongDescEvent</a>(<span class="keyword">this</span>),
<a name="l00064"></a>00064       <a class="code" href="classArmISA_1_1TableWalker.html#ac0fab25a73916f1bf677990e67557b5a">doProcessEvent</a>(<span class="keyword">this</span>)
<a name="l00065"></a>00065 {
<a name="l00066"></a>00066     <a class="code" href="classArmISA_1_1TableWalker.html#a43c4d132ca97c6cc5358f7be3c2b5a69">sctlr</a> = 0;
<a name="l00067"></a>00067 
<a name="l00068"></a>00068     <span class="comment">// Cache system-level properties</span>
<a name="l00069"></a>00069     <span class="keywordflow">if</span> (<a class="code" href="full__system_8hh.html#af929576af6f85c8849704b66d04b8370">FullSystem</a>) {
<a name="l00070"></a>00070         <a class="code" href="classArmISA_1_1TableWalker.html#a937afcdcc940e8070627553eaebfa58a">armSys</a> = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classArmSystem.html">ArmSystem</a> *<span class="keyword">&gt;</span>(<a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a>-&gt;sys);
<a name="l00071"></a>00071         assert(<a class="code" href="classArmISA_1_1TableWalker.html#a937afcdcc940e8070627553eaebfa58a">armSys</a>);
<a name="l00072"></a>00072         <a class="code" href="classArmISA_1_1TableWalker.html#a9f135583566fb70bba3c10395368f2e4">haveSecurity</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a937afcdcc940e8070627553eaebfa58a">armSys</a>-&gt;<a class="code" href="classArmSystem.html#ae08900555a461016d6648524cba6e74c">haveSecurity</a>();
<a name="l00073"></a>00073         <a class="code" href="classArmISA_1_1TableWalker.html#a74ac6c840c516a9b8a6eb63ed9ef1185">_haveLPAE</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a937afcdcc940e8070627553eaebfa58a">armSys</a>-&gt;<a class="code" href="classArmSystem.html#a39b5e5d6cff3c8f5a248143a702d8f1a">haveLPAE</a>();
<a name="l00074"></a>00074         <a class="code" href="classArmISA_1_1TableWalker.html#a8327a5b4e38733a0d77ae856ba67725f">_haveVirtualization</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a937afcdcc940e8070627553eaebfa58a">armSys</a>-&gt;<a class="code" href="classArmSystem.html#afef641e959fe33dee8702b9bb5e1b9e4">haveVirtualization</a>();
<a name="l00075"></a>00075         <a class="code" href="classArmISA_1_1TableWalker.html#af85538fbb375410b2750035ab34dc88a">physAddrRange</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a937afcdcc940e8070627553eaebfa58a">armSys</a>-&gt;<a class="code" href="classArmSystem.html#aecc15d8d848b1cee0bbe7dac86d01ec1">physAddrRange</a>();
<a name="l00076"></a>00076         <a class="code" href="classArmISA_1_1TableWalker.html#af7d46e1faf4b0edb95f404a28e31902d">_haveLargeAsid64</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a937afcdcc940e8070627553eaebfa58a">armSys</a>-&gt;<a class="code" href="classArmSystem.html#a47958664a46869f3fb4f9b043da32be5">haveLargeAsid64</a>();
<a name="l00077"></a>00077     } <span class="keywordflow">else</span> {
<a name="l00078"></a>00078         <a class="code" href="classArmISA_1_1TableWalker.html#a937afcdcc940e8070627553eaebfa58a">armSys</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00079"></a>00079         <a class="code" href="classArmISA_1_1TableWalker.html#a9f135583566fb70bba3c10395368f2e4">haveSecurity</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a74ac6c840c516a9b8a6eb63ed9ef1185">_haveLPAE</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a8327a5b4e38733a0d77ae856ba67725f">_haveVirtualization</a> = <span class="keyword">false</span>;
<a name="l00080"></a>00080         <a class="code" href="classArmISA_1_1TableWalker.html#af7d46e1faf4b0edb95f404a28e31902d">_haveLargeAsid64</a> = <span class="keyword">false</span>;
<a name="l00081"></a>00081         <a class="code" href="classArmISA_1_1TableWalker.html#af85538fbb375410b2750035ab34dc88a">physAddrRange</a> = 32;
<a name="l00082"></a>00082     }
<a name="l00083"></a>00083 
<a name="l00084"></a>00084 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab934d192b45cb722aa800d73bbb65f41"></a><!-- doxytag: member="ArmISA::TableWalker::~TableWalker" ref="ab934d192b45cb722aa800d73bbb65f41" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">~<a class="el" href="classArmISA_1_1TableWalker.html">TableWalker</a> </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00087"></a>00087 {
<a name="l00088"></a>00088     ;
<a name="l00089"></a>00089 }
</pre></div></p>

</div>
</div>
<hr/><h2>関数</h2>
<a class="anchor" id="a60f480f39c21ef312d34cb3c8702e9a6"></a><!-- doxytag: member="ArmISA::TableWalker::adjustTableSizeAArch64" ref="a60f480f39c21ef312d34cb3c8702e9a6" args="(unsigned tsz)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned adjustTableSizeAArch64 </td>
          <td>(</td>
          <td class="paramtype">unsigned&nbsp;</td>
          <td class="paramname"> <em>tsz</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static, private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00646"></a>00646 {
<a name="l00647"></a>00647     <span class="keywordflow">if</span> (tsz &lt; 25)
<a name="l00648"></a>00648         <span class="keywordflow">return</span> 25;
<a name="l00649"></a>00649     <span class="keywordflow">if</span> (tsz &gt; 48)
<a name="l00650"></a>00650         <span class="keywordflow">return</span> 48;
<a name="l00651"></a>00651     <span class="keywordflow">return</span> tsz;
<a name="l00652"></a>00652 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a40ad630985e7888b542e819ed09e0551"></a><!-- doxytag: member="ArmISA::TableWalker::checkAddrSizeFaultAArch64" ref="a40ad630985e7888b542e819ed09e0551" args="(Addr addr, int currPhysAddrRange)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool checkAddrSizeFaultAArch64 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classm5_1_1params_1_1Addr.html">Addr</a>&nbsp;</td>
          <td class="paramname"> <em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>currPhysAddrRange</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Returns true if the address exceeds the range permitted by the system-wide setting or by the TCR_ELx IPS/PS setting </p>

<p><div class="fragment"><pre class="fragment"><a name="l00656"></a>00656 {
<a name="l00657"></a>00657     <span class="keywordflow">return</span> (currPhysAddrRange != <a class="code" href="namespaceArmISA.html#ad202388a6cecd23caabbe7496f81e8d4">MaxPhysAddrRange</a> &amp;&amp;
<a name="l00658"></a>00658             <a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123">bits</a>(addr, <a class="code" href="namespaceArmISA.html#ad202388a6cecd23caabbe7496f81e8d4">MaxPhysAddrRange</a> - 1, currPhysAddrRange));
<a name="l00659"></a>00659 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5807f306df98d17f68f466ded6d7799f"></a><!-- doxytag: member="ArmISA::TableWalker::completeDrain" ref="a5807f306df98d17f68f466ded6d7799f" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void completeDrain </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Checks if all state is cleared and if so, completes drain </p>

<p><div class="fragment"><pre class="fragment"><a name="l00097"></a>00097 {
<a name="l00098"></a>00098     <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a329b71fb934a93312ca0aacbf5a3f982">drainManager</a> &amp;&amp; <a class="code" href="classArmISA_1_1TableWalker.html#af819b2b862d892da5df10248b6d72787">stateQueues</a>[<a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bdae5bc7ee7d6dda5340a28f91834f10543">L1</a>].empty() &amp;&amp; <a class="code" href="classArmISA_1_1TableWalker.html#af819b2b862d892da5df10248b6d72787">stateQueues</a>[<a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bda0adffb24dae0c41be5b803f4d444f066">L2</a>].empty() &amp;&amp;
<a name="l00099"></a>00099         <a class="code" href="classArmISA_1_1TableWalker.html#a53a70edbb255426f7f2729f482c7109b">pendingQueue</a>.empty()) {
<a name="l00100"></a>00100         <a class="code" href="classDrainable.html#ad800905390fe03e850cf996e914038f9">setDrainState</a>(<a class="code" href="classDrainable.html#a5d74787dedbc4e11c1ab15bf487e61f8a5656955cb808502a2ec75b367e2c1e82">Drainable::Drained</a>);
<a name="l00101"></a>00101         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Drain, <span class="stringliteral">&quot;TableWalker done draining, processing drain event\n&quot;</span>);
<a name="l00102"></a>00102         <a class="code" href="classArmISA_1_1TableWalker.html#a329b71fb934a93312ca0aacbf5a3f982">drainManager</a>-&gt;<a class="code" href="classDrainManager.html#ab89d10e368d2e82061eddb9e40022382">signalDrainDone</a>();
<a name="l00103"></a>00103         <a class="code" href="classArmISA_1_1TableWalker.html#a329b71fb934a93312ca0aacbf5a3f982">drainManager</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00104"></a>00104     }
<a name="l00105"></a>00105 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5c436908eca38a39cb98c4dedbf7228c"></a><!-- doxytag: member="ArmISA::TableWalker::doL0LongDescriptorWrapper" ref="a5c436908eca38a39cb98c4dedbf7228c" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void doL0LongDescriptorWrapper </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l01716"></a>01716 {
<a name="l01717"></a>01717     <a class="code" href="classArmISA_1_1TableWalker.html#a6a293b1492cb952d30d4b0de42aa9e7e">doLongDescriptorWrapper</a>(<a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bda51451264203360e0ffacec9b6d8ef7c9">L0</a>);
<a name="l01718"></a>01718 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a837a539f5e07e8785902d5854efde98d"></a><!-- doxytag: member="ArmISA::TableWalker::doL1Descriptor" ref="a837a539f5e07e8785902d5854efde98d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void doL1Descriptor </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><dl class="todo"><dt><b><a class="el" href="todo.html#_todo000003">TODO:</a></b></dt><dd>: check sctlr.ha (bit[17]) if Hardware Access Flag is enabled if set, do l1.Desc.setAp0() instead of generating AccessFlag0 </dd></dl>
</p>

<p><div class="fragment"><pre class="fragment"><a name="l01276"></a>01276 {
<a name="l01277"></a>01277     <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a68714ceb74c60ea7ef5dec335bb6c5d7">fault</a> != <a class="code" href="fault__fwd_8hh.html#ab8ce3b69a6737f63fcdcf99910feb153">NoFault</a>) {
<a name="l01278"></a>01278         <span class="keywordflow">return</span>;
<a name="l01279"></a>01279     }
<a name="l01280"></a>01280 
<a name="l01281"></a>01281     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classArmISA_1_1TLB.html">TLB</a>, <span class="stringliteral">&quot;L1 descriptor for %#x is %#x\n&quot;</span>,
<a name="l01282"></a>01282             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a1ebff4da206a1799d70b4ec129c33c5a">vaddr_tainted</a>, <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a7ab0bc1bc2c0b56484b750ffd1004d9c">l1Desc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1L1Descriptor.html#a1e43bf7d608e87228b625cca2c04d641">data</a>);
<a name="l01283"></a>01283     <a class="code" href="structArmISA_1_1TlbEntry.html">TlbEntry</a> <a class="code" href="namespaceMipsISA.html#a49c5c4308a3fe2af210c807bd186b780">te</a>;
<a name="l01284"></a>01284 
<a name="l01285"></a>01285     <span class="keywordflow">switch</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a7ab0bc1bc2c0b56484b750ffd1004d9c">l1Desc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1L1Descriptor.html#afeee2b784cb2b021c06cdde9c98130d0">type</a>()) {
<a name="l01286"></a>01286       <span class="keywordflow">case</span> <a class="code" href="classArmISA_1_1TableWalker_1_1L1Descriptor.html#a9ed8d16c9ae7fae285dd2146c3159023a4228a8c9f9b740ebe4269b084a41bcc1">L1Descriptor::Ignore</a>:
<a name="l01287"></a>01287       <span class="keywordflow">case</span> <a class="code" href="classArmISA_1_1TableWalker_1_1L1Descriptor.html#a9ed8d16c9ae7fae285dd2146c3159023a6136a0872216f91100b42ea04333af70">L1Descriptor::Reserved</a>:
<a name="l01288"></a>01288         <span class="keywordflow">if</span> (!<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a20f65ad56869382ed8681b9dd1aa85d6">timing</a>) {
<a name="l01289"></a>01289             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l01290"></a>01290             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a956cd41d82347558b9c0a5b0474903f2">req</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l01291"></a>01291         }
<a name="l01292"></a>01292         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classArmISA_1_1TLB.html">TLB</a>, <span class="stringliteral">&quot;L1 Descriptor Reserved/Ignore, causing fault\n&quot;</span>);
<a name="l01293"></a>01293         <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#aa863dbd5a3e20baa5acb07e373c42ddc">isFetch</a>)
<a name="l01294"></a>01294             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a68714ceb74c60ea7ef5dec335bb6c5d7">fault</a> =
<a name="l01295"></a>01295                 <span class="keyword">new</span> <a class="code" href="classArmISA_1_1PrefetchAbort.html">PrefetchAbort</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a1ebff4da206a1799d70b4ec129c33c5a">vaddr_tainted</a>,
<a name="l01296"></a>01296                                   <a class="code" href="classArmISA_1_1ArmFault.html#a8771a605c5b916759188c3a191bb6202a36a8d822dd25492d60c859de5400455b">ArmFault::TranslationLL</a> + <a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bdae5bc7ee7d6dda5340a28f91834f10543">L1</a>,
<a name="l01297"></a>01297                                   <a class="code" href="classArmISA_1_1TableWalker.html#a475f8007920fb01f7f8aa1730b3016bb">isStage2</a>,
<a name="l01298"></a>01298                                   <a class="code" href="classArmISA_1_1ArmFault.html#ad78237d6390becbe8bdf9e73979c56aeabfef4fbb52d72e0c89f660f2d501a488">ArmFault::VmsaTran</a>);
<a name="l01299"></a>01299         <span class="keywordflow">else</span>
<a name="l01300"></a>01300             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a68714ceb74c60ea7ef5dec335bb6c5d7">fault</a> =
<a name="l01301"></a>01301                 <span class="keyword">new</span> <a class="code" href="classArmISA_1_1DataAbort.html">DataAbort</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a1ebff4da206a1799d70b4ec129c33c5a">vaddr_tainted</a>,
<a name="l01302"></a>01302                               TlbEntry::DomainType::NoAccess,
<a name="l01303"></a>01303                               <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a0775ef609f39793da4e2adb3a0e2ded1">isWrite</a>,
<a name="l01304"></a>01304                               <a class="code" href="classArmISA_1_1ArmFault.html#a8771a605c5b916759188c3a191bb6202a36a8d822dd25492d60c859de5400455b">ArmFault::TranslationLL</a> + <a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bdae5bc7ee7d6dda5340a28f91834f10543">L1</a>, <a class="code" href="classArmISA_1_1TableWalker.html#a475f8007920fb01f7f8aa1730b3016bb">isStage2</a>,
<a name="l01305"></a>01305                               <a class="code" href="classArmISA_1_1ArmFault.html#ad78237d6390becbe8bdf9e73979c56aeabfef4fbb52d72e0c89f660f2d501a488">ArmFault::VmsaTran</a>);
<a name="l01306"></a>01306         <span class="keywordflow">return</span>;
<a name="l01307"></a>01307       <span class="keywordflow">case</span> <a class="code" href="classArmISA_1_1TableWalker_1_1L1Descriptor.html#a9ed8d16c9ae7fae285dd2146c3159023a53f0e1278b0ddeedcb004b781f90f4f0">L1Descriptor::Section</a>:
<a name="l01308"></a>01308         <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a43c4d132ca97c6cc5358f7be3c2b5a69">sctlr</a>.afe &amp;&amp; <a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123">bits</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a7ab0bc1bc2c0b56484b750ffd1004d9c">l1Desc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1L1Descriptor.html#a4fc87654615da601dbbc3cb6dd1046ee">ap</a>(), 0) == 0) {
<a name="l01314"></a>01314             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a68714ceb74c60ea7ef5dec335bb6c5d7">fault</a> = <span class="keyword">new</span> <a class="code" href="classArmISA_1_1DataAbort.html">DataAbort</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a1ebff4da206a1799d70b4ec129c33c5a">vaddr_tainted</a>,
<a name="l01315"></a>01315                                              <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a7ab0bc1bc2c0b56484b750ffd1004d9c">l1Desc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1L1Descriptor.html#a949a36eac4ce1b6aa2afd933e7e74710">domain</a>(),
<a name="l01316"></a>01316                                              <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a0775ef609f39793da4e2adb3a0e2ded1">isWrite</a>,
<a name="l01317"></a>01317                                              <a class="code" href="classArmISA_1_1ArmFault.html#a8771a605c5b916759188c3a191bb6202a86a18fce3ed059dd524ccc7f8f337137">ArmFault::AccessFlagLL</a> + <a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bdae5bc7ee7d6dda5340a28f91834f10543">L1</a>,
<a name="l01318"></a>01318                                              <a class="code" href="classArmISA_1_1TableWalker.html#a475f8007920fb01f7f8aa1730b3016bb">isStage2</a>,
<a name="l01319"></a>01319                                              <a class="code" href="classArmISA_1_1ArmFault.html#ad78237d6390becbe8bdf9e73979c56aeabfef4fbb52d72e0c89f660f2d501a488">ArmFault::VmsaTran</a>);
<a name="l01320"></a>01320         }
<a name="l01321"></a>01321         <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a7ab0bc1bc2c0b56484b750ffd1004d9c">l1Desc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1L1Descriptor.html#ab5c6c732aec03fe793fb2f885ecebdb5">supersection</a>()) {
<a name="l01322"></a>01322             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Haven&apos;t implemented supersections\n&quot;</span>);
<a name="l01323"></a>01323         }
<a name="l01324"></a>01324         <a class="code" href="classArmISA_1_1TableWalker.html#aad13c1fc4ab80d03d2af5ac43f41be23">insertTableEntry</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a7ab0bc1bc2c0b56484b750ffd1004d9c">l1Desc</a>, <span class="keyword">false</span>);
<a name="l01325"></a>01325         <span class="keywordflow">return</span>;
<a name="l01326"></a>01326       <span class="keywordflow">case</span> <a class="code" href="classArmISA_1_1TableWalker_1_1L1Descriptor.html#a9ed8d16c9ae7fae285dd2146c3159023abf5659cc171b92fece0428763b4c793c">L1Descriptor::PageTable</a>:
<a name="l01327"></a>01327         {
<a name="l01328"></a>01328             <a class="code" href="classm5_1_1params_1_1Addr.html">Addr</a> l2desc_addr;
<a name="l01329"></a>01329             l2desc_addr = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a7ab0bc1bc2c0b56484b750ffd1004d9c">l1Desc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1L1Descriptor.html#ad41ce35ecb10e8814bcc8829ad89a508">l2Addr</a>() |
<a name="l01330"></a>01330                 (<a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123">bits</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a9f933b300ef63eea367ca82f8da31025">vaddr</a>, 19, 12) &lt;&lt; 2);
<a name="l01331"></a>01331             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classArmISA_1_1TLB.html">TLB</a>, <span class="stringliteral">&quot;L1 descriptor points to page table at: %#x (%s)\n&quot;</span>,
<a name="l01332"></a>01332                     l2desc_addr, <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a62bc84f4251f16cf0cfa0f8d96e00c37">isSecure</a> ? <span class="stringliteral">&quot;s&quot;</span> : <span class="stringliteral">&quot;ns&quot;</span>);
<a name="l01333"></a>01333 
<a name="l01334"></a>01334             <span class="comment">// Trickbox address check</span>
<a name="l01335"></a>01335             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a68714ceb74c60ea7ef5dec335bb6c5d7">fault</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a9f0e11329a702fd34819769c899e4bd3">tlb</a>-&gt;<a class="code" href="classArmISA_1_1TLB.html#a19bf31f32ec6125d85acc1feeee28e47">walkTrickBoxCheck</a>(
<a name="l01336"></a>01336                 l2desc_addr, <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a62bc84f4251f16cf0cfa0f8d96e00c37">isSecure</a>, <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a9f933b300ef63eea367ca82f8da31025">vaddr</a>,
<a name="l01337"></a>01337                 <span class="keyword">sizeof</span>(<a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>), <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#aa863dbd5a3e20baa5acb07e373c42ddc">isFetch</a>, <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a0775ef609f39793da4e2adb3a0e2ded1">isWrite</a>,
<a name="l01338"></a>01338                 <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a7ab0bc1bc2c0b56484b750ffd1004d9c">l1Desc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1L1Descriptor.html#a949a36eac4ce1b6aa2afd933e7e74710">domain</a>(), <a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bda0adffb24dae0c41be5b803f4d444f066">L2</a>);
<a name="l01339"></a>01339 
<a name="l01340"></a>01340             <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a68714ceb74c60ea7ef5dec335bb6c5d7">fault</a>) {
<a name="l01341"></a>01341                 <span class="keywordflow">if</span> (!<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a20f65ad56869382ed8681b9dd1aa85d6">timing</a>) {
<a name="l01342"></a>01342                     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l01343"></a>01343                     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a956cd41d82347558b9c0a5b0474903f2">req</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l01344"></a>01344                 }
<a name="l01345"></a>01345                 <span class="keywordflow">return</span>;
<a name="l01346"></a>01346             }
<a name="l01347"></a>01347 
<a name="l01348"></a>01348             <a class="code" href="classFlags.html">Request::Flags</a> flag = 0;
<a name="l01349"></a>01349             <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a62bc84f4251f16cf0cfa0f8d96e00c37">isSecure</a>)
<a name="l01350"></a>01350                 flag.<a class="code" href="classFlags.html#a8bf75cf89ee252c33f05dd2e8e06d351">set</a>(<a class="code" href="classRequest.html#a096bc7521755b6680d9a1988a6c9b109">Request::SECURE</a>);
<a name="l01351"></a>01351 
<a name="l01352"></a>01352             <span class="keywordtype">bool</span> delayed;
<a name="l01353"></a>01353             delayed = <a class="code" href="classArmISA_1_1TableWalker.html#a583b81ca3090f4eb8014ec261cadeb6e">fetchDescriptor</a>(l2desc_addr,
<a name="l01354"></a>01354                                       (uint8_t*)&amp;<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4549132cc3bf5f52bc2020e271706c40">l2Desc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1L2Descriptor.html#a1e43bf7d608e87228b625cca2c04d641">data</a>,
<a name="l01355"></a>01355                                       <span class="keyword">sizeof</span>(<a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>), flag, -1, &amp;<a class="code" href="classArmISA_1_1TableWalker.html#ad6bd6e623ae7ab7d1cbbe0173e9562f4">doL2DescEvent</a>,
<a name="l01356"></a>01356                                       &amp;<a class="code" href="classArmISA_1_1TableWalker.html#a45b9877779ac070b7779f7e1eccdd05e">TableWalker::doL2Descriptor</a>);
<a name="l01357"></a>01357             <span class="keywordflow">if</span> (delayed) {
<a name="l01358"></a>01358                 <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a08a9405038cd3486ef2ff99cdad274a0">delayed</a> = <span class="keyword">true</span>;
<a name="l01359"></a>01359             }
<a name="l01360"></a>01360 
<a name="l01361"></a>01361             <span class="keywordflow">return</span>;
<a name="l01362"></a>01362         }
<a name="l01363"></a>01363       <span class="keywordflow">default</span>:
<a name="l01364"></a>01364         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;A new type in a 2 bit field?\n&quot;</span>);
<a name="l01365"></a>01365     }
<a name="l01366"></a>01366 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0498be5140a67703440d5ebdc2916173"></a><!-- doxytag: member="ArmISA::TableWalker::doL1DescriptorWrapper" ref="a0498be5140a67703440d5ebdc2916173" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void doL1DescriptorWrapper </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l01617"></a>01617 {
<a name="l01618"></a>01618     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a> = <a class="code" href="classArmISA_1_1TableWalker.html#af819b2b862d892da5df10248b6d72787">stateQueues</a>[<a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bdae5bc7ee7d6dda5340a28f91834f10543">L1</a>].front();
<a name="l01619"></a>01619     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a08a9405038cd3486ef2ff99cdad274a0">delayed</a> = <span class="keyword">false</span>;
<a name="l01620"></a>01620     <span class="comment">// if there&apos;s a stage2 translation object we don&apos;t need it any more</span>
<a name="l01621"></a>01621     <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab65d5f856546ee4e3a9610df9672d39a">stage2Tran</a>) {
<a name="l01622"></a>01622         <span class="keyword">delete</span> <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab65d5f856546ee4e3a9610df9672d39a">stage2Tran</a>;
<a name="l01623"></a>01623         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab65d5f856546ee4e3a9610df9672d39a">stage2Tran</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l01624"></a>01624     }
<a name="l01625"></a>01625 
<a name="l01626"></a>01626 
<a name="l01627"></a>01627     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(TLBVerbose, <span class="stringliteral">&quot;L1 Desc object host addr: %p\n&quot;</span>,&amp;<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a7ab0bc1bc2c0b56484b750ffd1004d9c">l1Desc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1L1Descriptor.html#a1e43bf7d608e87228b625cca2c04d641">data</a>);
<a name="l01628"></a>01628     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(TLBVerbose, <span class="stringliteral">&quot;L1 Desc object      data: %08x\n&quot;</span>,<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a7ab0bc1bc2c0b56484b750ffd1004d9c">l1Desc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1L1Descriptor.html#a1e43bf7d608e87228b625cca2c04d641">data</a>);
<a name="l01629"></a>01629 
<a name="l01630"></a>01630     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(TLBVerbose, <span class="stringliteral">&quot;calling doL1Descriptor for vaddr:%#x\n&quot;</span>, <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a1ebff4da206a1799d70b4ec129c33c5a">vaddr_tainted</a>);
<a name="l01631"></a>01631     <a class="code" href="classArmISA_1_1TableWalker.html#a837a539f5e07e8785902d5854efde98d">doL1Descriptor</a>();
<a name="l01632"></a>01632 
<a name="l01633"></a>01633     <a class="code" href="classArmISA_1_1TableWalker.html#af819b2b862d892da5df10248b6d72787">stateQueues</a>[<a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bdae5bc7ee7d6dda5340a28f91834f10543">L1</a>].pop_front();
<a name="l01634"></a>01634     <a class="code" href="classArmISA_1_1TableWalker.html#a5807f306df98d17f68f466ded6d7799f">completeDrain</a>();
<a name="l01635"></a>01635     <span class="comment">// Check if fault was generated</span>
<a name="l01636"></a>01636     <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a68714ceb74c60ea7ef5dec335bb6c5d7">fault</a> != <a class="code" href="fault__fwd_8hh.html#ab8ce3b69a6737f63fcdcf99910feb153">NoFault</a>) {
<a name="l01637"></a>01637         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab84349f9e7472233bc23dfdc0968ba57">transState</a>-&gt;finish(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a68714ceb74c60ea7ef5dec335bb6c5d7">fault</a>, <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a956cd41d82347558b9c0a5b0474903f2">req</a>,
<a name="l01638"></a>01638                                       <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>, <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ae9b5adf8be89a72128708c7e621e7211">mode</a>);
<a name="l01639"></a>01639 
<a name="l01640"></a>01640         <a class="code" href="classArmISA_1_1TableWalker.html#a39f16d585c4531d2bf2562631a775d73">pending</a> = <span class="keyword">false</span>;
<a name="l01641"></a>01641         <a class="code" href="classArmISA_1_1TableWalker.html#ae126e9ab023c3e4659836daa8f5364be">nextWalk</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>);
<a name="l01642"></a>01642 
<a name="l01643"></a>01643         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a956cd41d82347558b9c0a5b0474903f2">req</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l01644"></a>01644         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l01645"></a>01645         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a08a9405038cd3486ef2ff99cdad274a0">delayed</a> = <span class="keyword">false</span>;
<a name="l01646"></a>01646         <span class="keyword">delete</span> <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>;
<a name="l01647"></a>01647     }
<a name="l01648"></a>01648     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a08a9405038cd3486ef2ff99cdad274a0">delayed</a>) {
<a name="l01649"></a>01649         <span class="comment">// delay is not set so there is no L2 to do</span>
<a name="l01650"></a>01650         <span class="comment">// Don&apos;t finish the translation if a stage 2 look up is underway</span>
<a name="l01651"></a>01651         <span class="keywordflow">if</span> (!<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a8277e995719b58e8da5a0aa5bba2e623">doingStage2</a>) {
<a name="l01652"></a>01652             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(TLBVerbose, <span class="stringliteral">&quot;calling translateTiming again\n&quot;</span>);
<a name="l01653"></a>01653             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a68714ceb74c60ea7ef5dec335bb6c5d7">fault</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a9f0e11329a702fd34819769c899e4bd3">tlb</a>-&gt;<a class="code" href="classArmISA_1_1TLB.html#aece4eb62debdc9703b211d68ce771521">translateTiming</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a956cd41d82347558b9c0a5b0474903f2">req</a>, <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>,
<a name="l01654"></a>01654                 <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab84349f9e7472233bc23dfdc0968ba57">transState</a>, <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ae9b5adf8be89a72128708c7e621e7211">mode</a>);
<a name="l01655"></a>01655         }
<a name="l01656"></a>01656 
<a name="l01657"></a>01657         <a class="code" href="classArmISA_1_1TableWalker.html#a39f16d585c4531d2bf2562631a775d73">pending</a> = <span class="keyword">false</span>;
<a name="l01658"></a>01658         <a class="code" href="classArmISA_1_1TableWalker.html#ae126e9ab023c3e4659836daa8f5364be">nextWalk</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>);
<a name="l01659"></a>01659 
<a name="l01660"></a>01660         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a956cd41d82347558b9c0a5b0474903f2">req</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l01661"></a>01661         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l01662"></a>01662         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a08a9405038cd3486ef2ff99cdad274a0">delayed</a> = <span class="keyword">false</span>;
<a name="l01663"></a>01663         <span class="keyword">delete</span> <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>;
<a name="l01664"></a>01664     } <span class="keywordflow">else</span> {
<a name="l01665"></a>01665         <span class="comment">// need to do L2 descriptor</span>
<a name="l01666"></a>01666         <a class="code" href="classArmISA_1_1TableWalker.html#af819b2b862d892da5df10248b6d72787">stateQueues</a>[<a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bda0adffb24dae0c41be5b803f4d444f066">L2</a>].push_back(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>);
<a name="l01667"></a>01667     }
<a name="l01668"></a>01668     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l01669"></a>01669 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="adbdea710854a60040764157e313f730c"></a><!-- doxytag: member="ArmISA::TableWalker::doL1LongDescriptorWrapper" ref="adbdea710854a60040764157e313f730c" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void doL1LongDescriptorWrapper </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l01722"></a>01722 {
<a name="l01723"></a>01723     <a class="code" href="classArmISA_1_1TableWalker.html#a6a293b1492cb952d30d4b0de42aa9e7e">doLongDescriptorWrapper</a>(<a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bdae5bc7ee7d6dda5340a28f91834f10543">L1</a>);
<a name="l01724"></a>01724 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a45b9877779ac070b7779f7e1eccdd05e"></a><!-- doxytag: member="ArmISA::TableWalker::doL2Descriptor" ref="a45b9877779ac070b7779f7e1eccdd05e" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void doL2Descriptor </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><dl class="todo"><dt><b><a class="el" href="todo.html#_todo000004">TODO:</a></b></dt><dd>: check sctlr.ha (bit[17]) if Hardware Access Flag is enabled if set, do l2.Desc.setAp0() instead of generating AccessFlag0 </dd></dl>
</p>

<p><div class="fragment"><pre class="fragment"><a name="l01568"></a>01568 {
<a name="l01569"></a>01569     <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a68714ceb74c60ea7ef5dec335bb6c5d7">fault</a> != <a class="code" href="fault__fwd_8hh.html#ab8ce3b69a6737f63fcdcf99910feb153">NoFault</a>) {
<a name="l01570"></a>01570         <span class="keywordflow">return</span>;
<a name="l01571"></a>01571     }
<a name="l01572"></a>01572 
<a name="l01573"></a>01573     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classArmISA_1_1TLB.html">TLB</a>, <span class="stringliteral">&quot;L2 descriptor for %#x is %#x\n&quot;</span>,
<a name="l01574"></a>01574             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a1ebff4da206a1799d70b4ec129c33c5a">vaddr_tainted</a>, <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4549132cc3bf5f52bc2020e271706c40">l2Desc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1L2Descriptor.html#a1e43bf7d608e87228b625cca2c04d641">data</a>);
<a name="l01575"></a>01575     <a class="code" href="structArmISA_1_1TlbEntry.html">TlbEntry</a> <a class="code" href="namespaceMipsISA.html#a49c5c4308a3fe2af210c807bd186b780">te</a>;
<a name="l01576"></a>01576 
<a name="l01577"></a>01577     <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4549132cc3bf5f52bc2020e271706c40">l2Desc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1L2Descriptor.html#a93deb127eda8dffa42203f689ecc97ca">invalid</a>()) {
<a name="l01578"></a>01578         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classArmISA_1_1TLB.html">TLB</a>, <span class="stringliteral">&quot;L2 descriptor invalid, causing fault\n&quot;</span>);
<a name="l01579"></a>01579         <span class="keywordflow">if</span> (!<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a20f65ad56869382ed8681b9dd1aa85d6">timing</a>) {
<a name="l01580"></a>01580             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l01581"></a>01581             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a956cd41d82347558b9c0a5b0474903f2">req</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l01582"></a>01582         }
<a name="l01583"></a>01583         <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#aa863dbd5a3e20baa5acb07e373c42ddc">isFetch</a>)
<a name="l01584"></a>01584             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a68714ceb74c60ea7ef5dec335bb6c5d7">fault</a> =
<a name="l01585"></a>01585                 <span class="keyword">new</span> <a class="code" href="classArmISA_1_1PrefetchAbort.html">PrefetchAbort</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a1ebff4da206a1799d70b4ec129c33c5a">vaddr_tainted</a>,
<a name="l01586"></a>01586                                   <a class="code" href="classArmISA_1_1ArmFault.html#a8771a605c5b916759188c3a191bb6202a36a8d822dd25492d60c859de5400455b">ArmFault::TranslationLL</a> + <a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bda0adffb24dae0c41be5b803f4d444f066">L2</a>,
<a name="l01587"></a>01587                                   <a class="code" href="classArmISA_1_1TableWalker.html#a475f8007920fb01f7f8aa1730b3016bb">isStage2</a>,
<a name="l01588"></a>01588                                   <a class="code" href="classArmISA_1_1ArmFault.html#ad78237d6390becbe8bdf9e73979c56aeabfef4fbb52d72e0c89f660f2d501a488">ArmFault::VmsaTran</a>);
<a name="l01589"></a>01589         <span class="keywordflow">else</span>
<a name="l01590"></a>01590             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a68714ceb74c60ea7ef5dec335bb6c5d7">fault</a> =
<a name="l01591"></a>01591                 <span class="keyword">new</span> <a class="code" href="classArmISA_1_1DataAbort.html">DataAbort</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a1ebff4da206a1799d70b4ec129c33c5a">vaddr_tainted</a>, <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a7ab0bc1bc2c0b56484b750ffd1004d9c">l1Desc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1L1Descriptor.html#a949a36eac4ce1b6aa2afd933e7e74710">domain</a>(),
<a name="l01592"></a>01592                               <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a0775ef609f39793da4e2adb3a0e2ded1">isWrite</a>, <a class="code" href="classArmISA_1_1ArmFault.html#a8771a605c5b916759188c3a191bb6202a36a8d822dd25492d60c859de5400455b">ArmFault::TranslationLL</a> + <a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bda0adffb24dae0c41be5b803f4d444f066">L2</a>,
<a name="l01593"></a>01593                               <a class="code" href="classArmISA_1_1TableWalker.html#a475f8007920fb01f7f8aa1730b3016bb">isStage2</a>,
<a name="l01594"></a>01594                               <a class="code" href="classArmISA_1_1ArmFault.html#ad78237d6390becbe8bdf9e73979c56aeabfef4fbb52d72e0c89f660f2d501a488">ArmFault::VmsaTran</a>);
<a name="l01595"></a>01595         <span class="keywordflow">return</span>;
<a name="l01596"></a>01596     }
<a name="l01597"></a>01597 
<a name="l01598"></a>01598     <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a43c4d132ca97c6cc5358f7be3c2b5a69">sctlr</a>.afe &amp;&amp; <a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123">bits</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4549132cc3bf5f52bc2020e271706c40">l2Desc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1L2Descriptor.html#a4fc87654615da601dbbc3cb6dd1046ee">ap</a>(), 0) == 0) {
<a name="l01602"></a>01602          <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classArmISA_1_1TLB.html">TLB</a>, <span class="stringliteral">&quot;Generating access fault at L2, afe: %d, ap: %d\n&quot;</span>,
<a name="l01603"></a>01603                  <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a43c4d132ca97c6cc5358f7be3c2b5a69">sctlr</a>.afe, <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4549132cc3bf5f52bc2020e271706c40">l2Desc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1L2Descriptor.html#a4fc87654615da601dbbc3cb6dd1046ee">ap</a>());
<a name="l01604"></a>01604 
<a name="l01605"></a>01605         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a68714ceb74c60ea7ef5dec335bb6c5d7">fault</a> =
<a name="l01606"></a>01606             <span class="keyword">new</span> <a class="code" href="classArmISA_1_1DataAbort.html">DataAbort</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a1ebff4da206a1799d70b4ec129c33c5a">vaddr_tainted</a>,
<a name="l01607"></a>01607                           TlbEntry::DomainType::NoAccess, <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a0775ef609f39793da4e2adb3a0e2ded1">isWrite</a>,
<a name="l01608"></a>01608                           <a class="code" href="classArmISA_1_1ArmFault.html#a8771a605c5b916759188c3a191bb6202a86a18fce3ed059dd524ccc7f8f337137">ArmFault::AccessFlagLL</a> + <a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bda0adffb24dae0c41be5b803f4d444f066">L2</a>, <a class="code" href="classArmISA_1_1TableWalker.html#a475f8007920fb01f7f8aa1730b3016bb">isStage2</a>,
<a name="l01609"></a>01609                           <a class="code" href="classArmISA_1_1ArmFault.html#ad78237d6390becbe8bdf9e73979c56aeabfef4fbb52d72e0c89f660f2d501a488">ArmFault::VmsaTran</a>);
<a name="l01610"></a>01610     }
<a name="l01611"></a>01611 
<a name="l01612"></a>01612     <a class="code" href="classArmISA_1_1TableWalker.html#aad13c1fc4ab80d03d2af5ac43f41be23">insertTableEntry</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4549132cc3bf5f52bc2020e271706c40">l2Desc</a>, <span class="keyword">false</span>);
<a name="l01613"></a>01613 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a87d50eb887f4953c0b6881863b71df37"></a><!-- doxytag: member="ArmISA::TableWalker::doL2DescriptorWrapper" ref="a87d50eb887f4953c0b6881863b71df37" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void doL2DescriptorWrapper </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l01673"></a>01673 {
<a name="l01674"></a>01674     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a> = <a class="code" href="classArmISA_1_1TableWalker.html#af819b2b862d892da5df10248b6d72787">stateQueues</a>[<a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bda0adffb24dae0c41be5b803f4d444f066">L2</a>].front();
<a name="l01675"></a>01675     assert(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a08a9405038cd3486ef2ff99cdad274a0">delayed</a>);
<a name="l01676"></a>01676     <span class="comment">// if there&apos;s a stage2 translation object we don&apos;t need it any more</span>
<a name="l01677"></a>01677     <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab65d5f856546ee4e3a9610df9672d39a">stage2Tran</a>) {
<a name="l01678"></a>01678         <span class="keyword">delete</span> <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab65d5f856546ee4e3a9610df9672d39a">stage2Tran</a>;
<a name="l01679"></a>01679         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab65d5f856546ee4e3a9610df9672d39a">stage2Tran</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l01680"></a>01680     }
<a name="l01681"></a>01681 
<a name="l01682"></a>01682     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(TLBVerbose, <span class="stringliteral">&quot;calling doL2Descriptor for vaddr:%#x\n&quot;</span>,
<a name="l01683"></a>01683             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a1ebff4da206a1799d70b4ec129c33c5a">vaddr_tainted</a>);
<a name="l01684"></a>01684     <a class="code" href="classArmISA_1_1TableWalker.html#a45b9877779ac070b7779f7e1eccdd05e">doL2Descriptor</a>();
<a name="l01685"></a>01685 
<a name="l01686"></a>01686     <span class="comment">// Check if fault was generated</span>
<a name="l01687"></a>01687     <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a68714ceb74c60ea7ef5dec335bb6c5d7">fault</a> != <a class="code" href="fault__fwd_8hh.html#ab8ce3b69a6737f63fcdcf99910feb153">NoFault</a>) {
<a name="l01688"></a>01688         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab84349f9e7472233bc23dfdc0968ba57">transState</a>-&gt;finish(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a68714ceb74c60ea7ef5dec335bb6c5d7">fault</a>, <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a956cd41d82347558b9c0a5b0474903f2">req</a>,
<a name="l01689"></a>01689                                       <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>, <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ae9b5adf8be89a72128708c7e621e7211">mode</a>);
<a name="l01690"></a>01690     }
<a name="l01691"></a>01691     <span class="keywordflow">else</span> {
<a name="l01692"></a>01692         <span class="comment">// Don&apos;t finish the translation if a stage 2 look up is underway</span>
<a name="l01693"></a>01693         <span class="keywordflow">if</span> (!<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a8277e995719b58e8da5a0aa5bba2e623">doingStage2</a>) {
<a name="l01694"></a>01694             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(TLBVerbose, <span class="stringliteral">&quot;calling translateTiming again\n&quot;</span>);
<a name="l01695"></a>01695             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a68714ceb74c60ea7ef5dec335bb6c5d7">fault</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a9f0e11329a702fd34819769c899e4bd3">tlb</a>-&gt;<a class="code" href="classArmISA_1_1TLB.html#aece4eb62debdc9703b211d68ce771521">translateTiming</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a956cd41d82347558b9c0a5b0474903f2">req</a>,
<a name="l01696"></a>01696                 <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>, <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab84349f9e7472233bc23dfdc0968ba57">transState</a>, <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ae9b5adf8be89a72128708c7e621e7211">mode</a>);
<a name="l01697"></a>01697         }
<a name="l01698"></a>01698     }
<a name="l01699"></a>01699 
<a name="l01700"></a>01700 
<a name="l01701"></a>01701     <a class="code" href="classArmISA_1_1TableWalker.html#af819b2b862d892da5df10248b6d72787">stateQueues</a>[<a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bda0adffb24dae0c41be5b803f4d444f066">L2</a>].pop_front();
<a name="l01702"></a>01702     <a class="code" href="classArmISA_1_1TableWalker.html#a5807f306df98d17f68f466ded6d7799f">completeDrain</a>();
<a name="l01703"></a>01703     <a class="code" href="classArmISA_1_1TableWalker.html#a39f16d585c4531d2bf2562631a775d73">pending</a> = <span class="keyword">false</span>;
<a name="l01704"></a>01704     <a class="code" href="classArmISA_1_1TableWalker.html#ae126e9ab023c3e4659836daa8f5364be">nextWalk</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>);
<a name="l01705"></a>01705 
<a name="l01706"></a>01706     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a956cd41d82347558b9c0a5b0474903f2">req</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l01707"></a>01707     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l01708"></a>01708     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a08a9405038cd3486ef2ff99cdad274a0">delayed</a> = <span class="keyword">false</span>;
<a name="l01709"></a>01709 
<a name="l01710"></a>01710     <span class="keyword">delete</span> <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>;
<a name="l01711"></a>01711     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l01712"></a>01712 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="adf9dfadd21c55c07039abb1f1931be60"></a><!-- doxytag: member="ArmISA::TableWalker::doL2LongDescriptorWrapper" ref="adf9dfadd21c55c07039abb1f1931be60" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void doL2LongDescriptorWrapper </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l01728"></a>01728 {
<a name="l01729"></a>01729     <a class="code" href="classArmISA_1_1TableWalker.html#a6a293b1492cb952d30d4b0de42aa9e7e">doLongDescriptorWrapper</a>(<a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bda0adffb24dae0c41be5b803f4d444f066">L2</a>);
<a name="l01730"></a>01730 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="acc94f58219aff10336e1a78c77604dbb"></a><!-- doxytag: member="ArmISA::TableWalker::doL3LongDescriptorWrapper" ref="acc94f58219aff10336e1a78c77604dbb" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void doL3LongDescriptorWrapper </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l01734"></a>01734 {
<a name="l01735"></a>01735     <a class="code" href="classArmISA_1_1TableWalker.html#a6a293b1492cb952d30d4b0de42aa9e7e">doLongDescriptorWrapper</a>(<a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bda78d20b793a10e7c2f1012114803147c3">L3</a>);
<a name="l01736"></a>01736 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="abba315db7bc859eeb10035be0dcc1168"></a><!-- doxytag: member="ArmISA::TableWalker::doLongDescriptor" ref="abba315db7bc859eeb10035be0dcc1168" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void doLongDescriptor </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l01370"></a>01370 {
<a name="l01371"></a>01371     <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a68714ceb74c60ea7ef5dec335bb6c5d7">fault</a> != <a class="code" href="fault__fwd_8hh.html#ab8ce3b69a6737f63fcdcf99910feb153">NoFault</a>) {
<a name="l01372"></a>01372         <span class="keywordflow">return</span>;
<a name="l01373"></a>01373     }
<a name="l01374"></a>01374 
<a name="l01375"></a>01375     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classArmISA_1_1TLB.html">TLB</a>, <span class="stringliteral">&quot;L%d descriptor for %#llx is %#llx (%s)\n&quot;</span>,
<a name="l01376"></a>01376             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1DescriptorBase.html#a88477771eb7d27741455a8035678c67a">lookupLevel</a>, <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a1ebff4da206a1799d70b4ec129c33c5a">vaddr_tainted</a>,
<a name="l01377"></a>01377             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1LongDescriptor.html#ae421a8889820e685feae3e58e1d5fca0">data</a>,
<a name="l01378"></a>01378             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a52c06c8a54293998f3e1f71cdbd916f7">aarch64</a> ? <span class="stringliteral">&quot;AArch64&quot;</span> : <span class="stringliteral">&quot;long-desc.&quot;</span>);
<a name="l01379"></a>01379 
<a name="l01380"></a>01380     <span class="keywordflow">if</span> ((<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1LongDescriptor.html#afeee2b784cb2b021c06cdde9c98130d0">type</a>() == <a class="code" href="classArmISA_1_1TableWalker_1_1LongDescriptor.html#a9ed8d16c9ae7fae285dd2146c3159023aa00f801460e81f86eab56d86fe627551">LongDescriptor::Block</a>) ||
<a name="l01381"></a>01381         (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1LongDescriptor.html#afeee2b784cb2b021c06cdde9c98130d0">type</a>() == <a class="code" href="classArmISA_1_1TableWalker_1_1LongDescriptor.html#a9ed8d16c9ae7fae285dd2146c3159023a9d1a03a60ec11b699d2dd9dce1133327">LongDescriptor::Page</a>)) {
<a name="l01382"></a>01382         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(TLBVerbose, <span class="stringliteral">&quot;Analyzing L%d descriptor: %#llx, pxn: %d, &quot;</span>
<a name="l01383"></a>01383                 <span class="stringliteral">&quot;xn: %d, ap: %d, af: %d, type: %d\n&quot;</span>,
<a name="l01384"></a>01384                 <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1DescriptorBase.html#a88477771eb7d27741455a8035678c67a">lookupLevel</a>,
<a name="l01385"></a>01385                 <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1LongDescriptor.html#ae421a8889820e685feae3e58e1d5fca0">data</a>,
<a name="l01386"></a>01386                 <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1LongDescriptor.html#a2f27c1539208f00f43df19d64c5841ff">pxn</a>(),
<a name="l01387"></a>01387                 <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1LongDescriptor.html#a88a5985b2a6224e7b546fa088b101d66">xn</a>(),
<a name="l01388"></a>01388                 <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1LongDescriptor.html#a4fc87654615da601dbbc3cb6dd1046ee">ap</a>(),
<a name="l01389"></a>01389                 <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1LongDescriptor.html#a8f028be885d2543df6e8a1278a54d30b">af</a>(),
<a name="l01390"></a>01390                 <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1LongDescriptor.html#afeee2b784cb2b021c06cdde9c98130d0">type</a>());
<a name="l01391"></a>01391     } <span class="keywordflow">else</span> {
<a name="l01392"></a>01392         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(TLBVerbose, <span class="stringliteral">&quot;Analyzing L%d descriptor: %#llx, type: %d\n&quot;</span>,
<a name="l01393"></a>01393                 <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1DescriptorBase.html#a88477771eb7d27741455a8035678c67a">lookupLevel</a>,
<a name="l01394"></a>01394                 <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1LongDescriptor.html#ae421a8889820e685feae3e58e1d5fca0">data</a>,
<a name="l01395"></a>01395                 <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1LongDescriptor.html#afeee2b784cb2b021c06cdde9c98130d0">type</a>());
<a name="l01396"></a>01396     }
<a name="l01397"></a>01397 
<a name="l01398"></a>01398     <a class="code" href="structArmISA_1_1TlbEntry.html">TlbEntry</a> <a class="code" href="namespaceMipsISA.html#a49c5c4308a3fe2af210c807bd186b780">te</a>;
<a name="l01399"></a>01399 
<a name="l01400"></a>01400     <span class="keywordflow">switch</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1LongDescriptor.html#afeee2b784cb2b021c06cdde9c98130d0">type</a>()) {
<a name="l01401"></a>01401       <span class="keywordflow">case</span> <a class="code" href="classArmISA_1_1TableWalker_1_1LongDescriptor.html#a9ed8d16c9ae7fae285dd2146c3159023ae962ea8b0b3a376575ad0e616eeac474">LongDescriptor::Invalid</a>:
<a name="l01402"></a>01402         <span class="keywordflow">if</span> (!<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a20f65ad56869382ed8681b9dd1aa85d6">timing</a>) {
<a name="l01403"></a>01403             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l01404"></a>01404             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a956cd41d82347558b9c0a5b0474903f2">req</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l01405"></a>01405         }
<a name="l01406"></a>01406 
<a name="l01407"></a>01407         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classArmISA_1_1TLB.html">TLB</a>, <span class="stringliteral">&quot;L%d descriptor Invalid, causing fault type %d\n&quot;</span>,
<a name="l01408"></a>01408                 <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1DescriptorBase.html#a88477771eb7d27741455a8035678c67a">lookupLevel</a>,
<a name="l01409"></a>01409                 <a class="code" href="classArmISA_1_1ArmFault.html#a8771a605c5b916759188c3a191bb6202a36a8d822dd25492d60c859de5400455b">ArmFault::TranslationLL</a> + <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1DescriptorBase.html#a88477771eb7d27741455a8035678c67a">lookupLevel</a>);
<a name="l01410"></a>01410         <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#aa863dbd5a3e20baa5acb07e373c42ddc">isFetch</a>)
<a name="l01411"></a>01411             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a68714ceb74c60ea7ef5dec335bb6c5d7">fault</a> = <span class="keyword">new</span> <a class="code" href="classArmISA_1_1PrefetchAbort.html">PrefetchAbort</a>(
<a name="l01412"></a>01412                 <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a1ebff4da206a1799d70b4ec129c33c5a">vaddr_tainted</a>,
<a name="l01413"></a>01413                 <a class="code" href="classArmISA_1_1ArmFault.html#a8771a605c5b916759188c3a191bb6202a36a8d822dd25492d60c859de5400455b">ArmFault::TranslationLL</a> + <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1DescriptorBase.html#a88477771eb7d27741455a8035678c67a">lookupLevel</a>,
<a name="l01414"></a>01414                 <a class="code" href="classArmISA_1_1TableWalker.html#a475f8007920fb01f7f8aa1730b3016bb">isStage2</a>,
<a name="l01415"></a>01415                 <a class="code" href="classArmISA_1_1ArmFault.html#ad78237d6390becbe8bdf9e73979c56aea307d48bbc198c224e04bf57415c05dcd">ArmFault::LpaeTran</a>);
<a name="l01416"></a>01416         <span class="keywordflow">else</span>
<a name="l01417"></a>01417             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a68714ceb74c60ea7ef5dec335bb6c5d7">fault</a> = <span class="keyword">new</span> <a class="code" href="classArmISA_1_1DataAbort.html">DataAbort</a>(
<a name="l01418"></a>01418                 <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a1ebff4da206a1799d70b4ec129c33c5a">vaddr_tainted</a>,
<a name="l01419"></a>01419                 TlbEntry::DomainType::NoAccess,
<a name="l01420"></a>01420                 <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a0775ef609f39793da4e2adb3a0e2ded1">isWrite</a>,
<a name="l01421"></a>01421                 <a class="code" href="classArmISA_1_1ArmFault.html#a8771a605c5b916759188c3a191bb6202a36a8d822dd25492d60c859de5400455b">ArmFault::TranslationLL</a> + <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1DescriptorBase.html#a88477771eb7d27741455a8035678c67a">lookupLevel</a>,
<a name="l01422"></a>01422                 <a class="code" href="classArmISA_1_1TableWalker.html#a475f8007920fb01f7f8aa1730b3016bb">isStage2</a>,
<a name="l01423"></a>01423                 <a class="code" href="classArmISA_1_1ArmFault.html#ad78237d6390becbe8bdf9e73979c56aea307d48bbc198c224e04bf57415c05dcd">ArmFault::LpaeTran</a>);
<a name="l01424"></a>01424         <span class="keywordflow">return</span>;
<a name="l01425"></a>01425       <span class="keywordflow">case</span> <a class="code" href="classArmISA_1_1TableWalker_1_1LongDescriptor.html#a9ed8d16c9ae7fae285dd2146c3159023aa00f801460e81f86eab56d86fe627551">LongDescriptor::Block</a>:
<a name="l01426"></a>01426       <span class="keywordflow">case</span> <a class="code" href="classArmISA_1_1TableWalker_1_1LongDescriptor.html#a9ed8d16c9ae7fae285dd2146c3159023a9d1a03a60ec11b699d2dd9dce1133327">LongDescriptor::Page</a>:
<a name="l01427"></a>01427         {
<a name="l01428"></a>01428             <span class="keywordtype">bool</span> fault = <span class="keyword">false</span>;
<a name="l01429"></a>01429             <span class="keywordtype">bool</span> aff = <span class="keyword">false</span>;
<a name="l01430"></a>01430             <span class="comment">// Check for address size fault</span>
<a name="l01431"></a>01431             <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a40ad630985e7888b542e819ed09e0551">checkAddrSizeFaultAArch64</a>(
<a name="l01432"></a>01432                     <a class="code" href="bitfield_8hh.html#acaa3c424fec3407f14a01fe1ec22c2d4">mbits</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1LongDescriptor.html#ae421a8889820e685feae3e58e1d5fca0">data</a>, <a class="code" href="namespaceArmISA.html#ad202388a6cecd23caabbe7496f81e8d4">MaxPhysAddrRange</a> - 1,
<a name="l01433"></a>01433                           <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1LongDescriptor.html#ae34090e6c4584fabe4d885ae7b2e31d0">offsetBits</a>()),
<a name="l01434"></a>01434                     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a54248d4ad3bc4c54e33a04257ee09280">physAddrRange</a>)) {
<a name="l01435"></a>01435                 fault = <span class="keyword">true</span>;
<a name="l01436"></a>01436                 <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classArmISA_1_1TLB.html">TLB</a>, <span class="stringliteral">&quot;L%d descriptor causing Address Size Fault\n&quot;</span>,
<a name="l01437"></a>01437                         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1DescriptorBase.html#a88477771eb7d27741455a8035678c67a">lookupLevel</a>);
<a name="l01438"></a>01438             <span class="comment">// Check for access fault</span>
<a name="l01439"></a>01439             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1LongDescriptor.html#a8f028be885d2543df6e8a1278a54d30b">af</a>() == 0) {
<a name="l01440"></a>01440                 fault = <span class="keyword">true</span>;
<a name="l01441"></a>01441                 <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classArmISA_1_1TLB.html">TLB</a>, <span class="stringliteral">&quot;L%d descriptor causing Access Fault\n&quot;</span>,
<a name="l01442"></a>01442                         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1DescriptorBase.html#a88477771eb7d27741455a8035678c67a">lookupLevel</a>);
<a name="l01443"></a>01443                 aff = <span class="keyword">true</span>;
<a name="l01444"></a>01444             }
<a name="l01445"></a>01445             <span class="keywordflow">if</span> (fault) {
<a name="l01446"></a>01446                 <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#aa863dbd5a3e20baa5acb07e373c42ddc">isFetch</a>)
<a name="l01447"></a>01447                     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a68714ceb74c60ea7ef5dec335bb6c5d7">fault</a> = <span class="keyword">new</span> <a class="code" href="classArmISA_1_1PrefetchAbort.html">PrefetchAbort</a>(
<a name="l01448"></a>01448                         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a1ebff4da206a1799d70b4ec129c33c5a">vaddr_tainted</a>,
<a name="l01449"></a>01449                         (aff ? <a class="code" href="classArmISA_1_1ArmFault.html#a8771a605c5b916759188c3a191bb6202a86a18fce3ed059dd524ccc7f8f337137">ArmFault::AccessFlagLL</a> : <a class="code" href="classArmISA_1_1ArmFault.html#a8771a605c5b916759188c3a191bb6202ad3e0e83e6ccbaae6110e0312eb6a5280">ArmFault::AddressSizeLL</a>) +
<a name="l01450"></a>01450                         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1DescriptorBase.html#a88477771eb7d27741455a8035678c67a">lookupLevel</a>,
<a name="l01451"></a>01451                         <a class="code" href="classArmISA_1_1TableWalker.html#a475f8007920fb01f7f8aa1730b3016bb">isStage2</a>,
<a name="l01452"></a>01452                         <a class="code" href="classArmISA_1_1ArmFault.html#ad78237d6390becbe8bdf9e73979c56aea307d48bbc198c224e04bf57415c05dcd">ArmFault::LpaeTran</a>);
<a name="l01453"></a>01453                 <span class="keywordflow">else</span>
<a name="l01454"></a>01454                     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a68714ceb74c60ea7ef5dec335bb6c5d7">fault</a> = <span class="keyword">new</span> <a class="code" href="classArmISA_1_1DataAbort.html">DataAbort</a>(
<a name="l01455"></a>01455                         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a1ebff4da206a1799d70b4ec129c33c5a">vaddr_tainted</a>,
<a name="l01456"></a>01456                         TlbEntry::DomainType::NoAccess, <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a0775ef609f39793da4e2adb3a0e2ded1">isWrite</a>,
<a name="l01457"></a>01457                         (aff ? <a class="code" href="classArmISA_1_1ArmFault.html#a8771a605c5b916759188c3a191bb6202a86a18fce3ed059dd524ccc7f8f337137">ArmFault::AccessFlagLL</a> : <a class="code" href="classArmISA_1_1ArmFault.html#a8771a605c5b916759188c3a191bb6202ad3e0e83e6ccbaae6110e0312eb6a5280">ArmFault::AddressSizeLL</a>) +
<a name="l01458"></a>01458                         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1DescriptorBase.html#a88477771eb7d27741455a8035678c67a">lookupLevel</a>,
<a name="l01459"></a>01459                         <a class="code" href="classArmISA_1_1TableWalker.html#a475f8007920fb01f7f8aa1730b3016bb">isStage2</a>,
<a name="l01460"></a>01460                         <a class="code" href="classArmISA_1_1ArmFault.html#ad78237d6390becbe8bdf9e73979c56aea307d48bbc198c224e04bf57415c05dcd">ArmFault::LpaeTran</a>);
<a name="l01461"></a>01461             } <span class="keywordflow">else</span> {
<a name="l01462"></a>01462                 <a class="code" href="classArmISA_1_1TableWalker.html#aad13c1fc4ab80d03d2af5ac43f41be23">insertTableEntry</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>, <span class="keyword">true</span>);
<a name="l01463"></a>01463             }
<a name="l01464"></a>01464         }
<a name="l01465"></a>01465         <span class="keywordflow">return</span>;
<a name="l01466"></a>01466       <span class="keywordflow">case</span> <a class="code" href="classArmISA_1_1TableWalker_1_1LongDescriptor.html#a9ed8d16c9ae7fae285dd2146c3159023abdc82221e2bc2a210036a9bf0bb088b3">LongDescriptor::Table</a>:
<a name="l01467"></a>01467         {
<a name="l01468"></a>01468             <span class="comment">// Set hierarchical permission flags</span>
<a name="l01469"></a>01469             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#aa8accf2e55a1d194420c61e85b53efb5">secureLookup</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#aa8accf2e55a1d194420c61e85b53efb5">secureLookup</a> &amp;&amp;
<a name="l01470"></a>01470                 <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1LongDescriptor.html#aadb8f0e48c9256e28618be47ef61f681">secureTable</a>();
<a name="l01471"></a>01471             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a419a9be86581a6eba5d7f4a22f0f6e76">rwTable</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a419a9be86581a6eba5d7f4a22f0f6e76">rwTable</a> &amp;&amp;
<a name="l01472"></a>01472                 <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1LongDescriptor.html#a478caeac81ef334cf6698c8ba3f027fb">rwTable</a>();
<a name="l01473"></a>01473             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab4be9ffb2fe22576e2f587374fdd20e6">userTable</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab4be9ffb2fe22576e2f587374fdd20e6">userTable</a> &amp;&amp;
<a name="l01474"></a>01474                 <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1LongDescriptor.html#a8d695176b203e8d330ab60017cfb8e24">userTable</a>();
<a name="l01475"></a>01475             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a34b92e09eece01cfa45e9b9d0b7f74c6">xnTable</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a34b92e09eece01cfa45e9b9d0b7f74c6">xnTable</a> ||
<a name="l01476"></a>01476                 <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1LongDescriptor.html#a918336097d9455741b30786d6e46f73d">xnTable</a>();
<a name="l01477"></a>01477             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a92af2e7b7b80463a6bbf8ccead3af087">pxnTable</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a92af2e7b7b80463a6bbf8ccead3af087">pxnTable</a> ||
<a name="l01478"></a>01478                 <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1LongDescriptor.html#a4cabfe03c27a0613a975eb34f5dc311a">pxnTable</a>();
<a name="l01479"></a>01479 
<a name="l01480"></a>01480             <span class="comment">// Set up next level lookup</span>
<a name="l01481"></a>01481             <a class="code" href="classm5_1_1params_1_1Addr.html">Addr</a> next_desc_addr = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1LongDescriptor.html#a0464bb8a36a7df5b95a949f1cdb5d68c">nextDescAddr</a>(
<a name="l01482"></a>01482                 <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a9f933b300ef63eea367ca82f8da31025">vaddr</a>);
<a name="l01483"></a>01483 
<a name="l01484"></a>01484             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classArmISA_1_1TLB.html">TLB</a>, <span class="stringliteral">&quot;L%d descriptor points to L%d descriptor at: %#x (%s)\n&quot;</span>,
<a name="l01485"></a>01485                     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1DescriptorBase.html#a88477771eb7d27741455a8035678c67a">lookupLevel</a>,
<a name="l01486"></a>01486                     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1DescriptorBase.html#a88477771eb7d27741455a8035678c67a">lookupLevel</a> + 1,
<a name="l01487"></a>01487                     next_desc_addr,
<a name="l01488"></a>01488                     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#aa8accf2e55a1d194420c61e85b53efb5">secureLookup</a> ? <span class="stringliteral">&quot;s&quot;</span> : <span class="stringliteral">&quot;ns&quot;</span>);
<a name="l01489"></a>01489 
<a name="l01490"></a>01490             <span class="comment">// Check for address size fault</span>
<a name="l01491"></a>01491             <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a52c06c8a54293998f3e1f71cdbd916f7">aarch64</a> &amp;&amp; <a class="code" href="classArmISA_1_1TableWalker.html#a40ad630985e7888b542e819ed09e0551">checkAddrSizeFaultAArch64</a>(
<a name="l01492"></a>01492                     next_desc_addr, <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a54248d4ad3bc4c54e33a04257ee09280">physAddrRange</a>)) {
<a name="l01493"></a>01493                 <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classArmISA_1_1TLB.html">TLB</a>, <span class="stringliteral">&quot;L%d descriptor causing Address Size Fault\n&quot;</span>,
<a name="l01494"></a>01494                         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1DescriptorBase.html#a88477771eb7d27741455a8035678c67a">lookupLevel</a>);
<a name="l01495"></a>01495                 <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#aa863dbd5a3e20baa5acb07e373c42ddc">isFetch</a>)
<a name="l01496"></a>01496                     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a68714ceb74c60ea7ef5dec335bb6c5d7">fault</a> = <span class="keyword">new</span> <a class="code" href="classArmISA_1_1PrefetchAbort.html">PrefetchAbort</a>(
<a name="l01497"></a>01497                         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a1ebff4da206a1799d70b4ec129c33c5a">vaddr_tainted</a>,
<a name="l01498"></a>01498                         <a class="code" href="classArmISA_1_1ArmFault.html#a8771a605c5b916759188c3a191bb6202ad3e0e83e6ccbaae6110e0312eb6a5280">ArmFault::AddressSizeLL</a>
<a name="l01499"></a>01499                         + <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1DescriptorBase.html#a88477771eb7d27741455a8035678c67a">lookupLevel</a>,
<a name="l01500"></a>01500                         <a class="code" href="classArmISA_1_1TableWalker.html#a475f8007920fb01f7f8aa1730b3016bb">isStage2</a>,
<a name="l01501"></a>01501                         <a class="code" href="classArmISA_1_1ArmFault.html#ad78237d6390becbe8bdf9e73979c56aea307d48bbc198c224e04bf57415c05dcd">ArmFault::LpaeTran</a>);
<a name="l01502"></a>01502                 <span class="keywordflow">else</span>
<a name="l01503"></a>01503                     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a68714ceb74c60ea7ef5dec335bb6c5d7">fault</a> = <span class="keyword">new</span> <a class="code" href="classArmISA_1_1DataAbort.html">DataAbort</a>(
<a name="l01504"></a>01504                         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a1ebff4da206a1799d70b4ec129c33c5a">vaddr_tainted</a>,
<a name="l01505"></a>01505                         TlbEntry::DomainType::NoAccess, <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a0775ef609f39793da4e2adb3a0e2ded1">isWrite</a>,
<a name="l01506"></a>01506                         <a class="code" href="classArmISA_1_1ArmFault.html#a8771a605c5b916759188c3a191bb6202ad3e0e83e6ccbaae6110e0312eb6a5280">ArmFault::AddressSizeLL</a>
<a name="l01507"></a>01507                         + <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1DescriptorBase.html#a88477771eb7d27741455a8035678c67a">lookupLevel</a>,
<a name="l01508"></a>01508                         <a class="code" href="classArmISA_1_1TableWalker.html#a475f8007920fb01f7f8aa1730b3016bb">isStage2</a>,
<a name="l01509"></a>01509                         <a class="code" href="classArmISA_1_1ArmFault.html#ad78237d6390becbe8bdf9e73979c56aea307d48bbc198c224e04bf57415c05dcd">ArmFault::LpaeTran</a>);
<a name="l01510"></a>01510                 <span class="keywordflow">return</span>;
<a name="l01511"></a>01511             }
<a name="l01512"></a>01512 
<a name="l01513"></a>01513             <span class="comment">// Trickbox address check</span>
<a name="l01514"></a>01514             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a68714ceb74c60ea7ef5dec335bb6c5d7">fault</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a9f0e11329a702fd34819769c899e4bd3">tlb</a>-&gt;<a class="code" href="classArmISA_1_1TLB.html#a19bf31f32ec6125d85acc1feeee28e47">walkTrickBoxCheck</a>(
<a name="l01515"></a>01515                             next_desc_addr, <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a9f933b300ef63eea367ca82f8da31025">vaddr</a>,
<a name="l01516"></a>01516                             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a9f933b300ef63eea367ca82f8da31025">vaddr</a>, <span class="keyword">sizeof</span>(uint64_t),
<a name="l01517"></a>01517                             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#aa863dbd5a3e20baa5acb07e373c42ddc">isFetch</a>, <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a0775ef609f39793da4e2adb3a0e2ded1">isWrite</a>,
<a name="l01518"></a>01518                             TlbEntry::DomainType::Client,
<a name="l01519"></a>01519                             <a class="code" href="classArmISA_1_1TableWalker.html#aea45aff83099165fcb29b3c3df3de9c2">toLookupLevel</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1DescriptorBase.html#a88477771eb7d27741455a8035678c67a">lookupLevel</a> +1));
<a name="l01520"></a>01520 
<a name="l01521"></a>01521             <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a68714ceb74c60ea7ef5dec335bb6c5d7">fault</a>) {
<a name="l01522"></a>01522                 <span class="keywordflow">if</span> (!<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a20f65ad56869382ed8681b9dd1aa85d6">timing</a>) {
<a name="l01523"></a>01523                     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l01524"></a>01524                     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a956cd41d82347558b9c0a5b0474903f2">req</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l01525"></a>01525                 }
<a name="l01526"></a>01526                 <span class="keywordflow">return</span>;
<a name="l01527"></a>01527             }
<a name="l01528"></a>01528 
<a name="l01529"></a>01529             <a class="code" href="classFlags.html">Request::Flags</a> flag = 0;
<a name="l01530"></a>01530             <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#aa8accf2e55a1d194420c61e85b53efb5">secureLookup</a>)
<a name="l01531"></a>01531                 flag.<a class="code" href="classFlags.html#a8bf75cf89ee252c33f05dd2e8e06d351">set</a>(<a class="code" href="classRequest.html#a096bc7521755b6680d9a1988a6c9b109">Request::SECURE</a>);
<a name="l01532"></a>01532 
<a name="l01533"></a>01533             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1DescriptorBase.html#a88477771eb7d27741455a8035678c67a">lookupLevel</a> =
<a name="l01534"></a>01534                 (<a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bd">LookupLevel</a>) (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1DescriptorBase.html#a88477771eb7d27741455a8035678c67a">lookupLevel</a> + 1);
<a name="l01535"></a>01535             Event *<span class="keyword">event</span> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l01536"></a>01536             <span class="keywordflow">switch</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1DescriptorBase.html#a88477771eb7d27741455a8035678c67a">lookupLevel</a>) {
<a name="l01537"></a>01537               <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bdae5bc7ee7d6dda5340a28f91834f10543">L1</a>:
<a name="l01538"></a>01538                 assert(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a52c06c8a54293998f3e1f71cdbd916f7">aarch64</a>);
<a name="l01539"></a>01539                 <span class="keyword">event</span> = &amp;<a class="code" href="classArmISA_1_1TableWalker.html#a5ab01b63bbaded2920f4e72569b63759">doL1LongDescEvent</a>;
<a name="l01540"></a>01540                 <span class="keywordflow">break</span>;
<a name="l01541"></a>01541               <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bda0adffb24dae0c41be5b803f4d444f066">L2</a>:
<a name="l01542"></a>01542                 <span class="keyword">event</span> = &amp;<a class="code" href="classArmISA_1_1TableWalker.html#a987d9ee7304c356462000428178c6c5e">doL2LongDescEvent</a>;
<a name="l01543"></a>01543                 <span class="keywordflow">break</span>;
<a name="l01544"></a>01544               <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bda78d20b793a10e7c2f1012114803147c3">L3</a>:
<a name="l01545"></a>01545                 <span class="keyword">event</span> = &amp;<a class="code" href="classArmISA_1_1TableWalker.html#a6a30037030613a33f5a056cd7c9af535">doL3LongDescEvent</a>;
<a name="l01546"></a>01546                 <span class="keywordflow">break</span>;
<a name="l01547"></a>01547               <span class="keywordflow">default</span>:
<a name="l01548"></a>01548                 <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Wrong lookup level in table walk\n&quot;</span>);
<a name="l01549"></a>01549                 <span class="keywordflow">break</span>;
<a name="l01550"></a>01550             }
<a name="l01551"></a>01551 
<a name="l01552"></a>01552             <span class="keywordtype">bool</span> delayed;
<a name="l01553"></a>01553             delayed = <a class="code" href="classArmISA_1_1TableWalker.html#a583b81ca3090f4eb8014ec261cadeb6e">fetchDescriptor</a>(next_desc_addr, (uint8_t*)&amp;<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1LongDescriptor.html#ae421a8889820e685feae3e58e1d5fca0">data</a>,
<a name="l01554"></a>01554                                       <span class="keyword">sizeof</span>(uint64_t), flag, -1, <a class="code" href="namespaceMipsISA.html#aa3b803f4777161a2825178dabfb154f0">event</a>,
<a name="l01555"></a>01555                                       &amp;<a class="code" href="classArmISA_1_1TableWalker.html#abba315db7bc859eeb10035be0dcc1168">TableWalker::doLongDescriptor</a>);
<a name="l01556"></a>01556             <span class="keywordflow">if</span> (delayed) {
<a name="l01557"></a>01557                  <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a08a9405038cd3486ef2ff99cdad274a0">delayed</a> = <span class="keyword">true</span>;
<a name="l01558"></a>01558             }
<a name="l01559"></a>01559         }
<a name="l01560"></a>01560         <span class="keywordflow">return</span>;
<a name="l01561"></a>01561       <span class="keywordflow">default</span>:
<a name="l01562"></a>01562         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;A new type in a 2 bit field?\n&quot;</span>);
<a name="l01563"></a>01563     }
<a name="l01564"></a>01564 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6a293b1492cb952d30d4b0de42aa9e7e"></a><!-- doxytag: member="ArmISA::TableWalker::doLongDescriptorWrapper" ref="a6a293b1492cb952d30d4b0de42aa9e7e" args="(LookupLevel curr_lookup_level)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void doLongDescriptorWrapper </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bd">LookupLevel</a>&nbsp;</td>
          <td class="paramname"> <em>curr_lookup_level</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l01740"></a>01740 {
<a name="l01741"></a>01741     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a> = <a class="code" href="classArmISA_1_1TableWalker.html#af819b2b862d892da5df10248b6d72787">stateQueues</a>[curr_lookup_level].front();
<a name="l01742"></a>01742     assert(curr_lookup_level == <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1DescriptorBase.html#a88477771eb7d27741455a8035678c67a">lookupLevel</a>);
<a name="l01743"></a>01743     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a08a9405038cd3486ef2ff99cdad274a0">delayed</a> = <span class="keyword">false</span>;
<a name="l01744"></a>01744 
<a name="l01745"></a>01745     <span class="comment">// if there&apos;s a stage2 translation object we don&apos;t need it any more</span>
<a name="l01746"></a>01746     <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab65d5f856546ee4e3a9610df9672d39a">stage2Tran</a>) {
<a name="l01747"></a>01747         <span class="keyword">delete</span> <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab65d5f856546ee4e3a9610df9672d39a">stage2Tran</a>;
<a name="l01748"></a>01748         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab65d5f856546ee4e3a9610df9672d39a">stage2Tran</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l01749"></a>01749     }
<a name="l01750"></a>01750 
<a name="l01751"></a>01751     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(TLBVerbose, <span class="stringliteral">&quot;calling doLongDescriptor for vaddr:%#x\n&quot;</span>,
<a name="l01752"></a>01752             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a1ebff4da206a1799d70b4ec129c33c5a">vaddr_tainted</a>);
<a name="l01753"></a>01753     <a class="code" href="classArmISA_1_1TableWalker.html#abba315db7bc859eeb10035be0dcc1168">doLongDescriptor</a>();
<a name="l01754"></a>01754 
<a name="l01755"></a>01755     <a class="code" href="classArmISA_1_1TableWalker.html#af819b2b862d892da5df10248b6d72787">stateQueues</a>[curr_lookup_level].pop_front();
<a name="l01756"></a>01756 
<a name="l01757"></a>01757     <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a68714ceb74c60ea7ef5dec335bb6c5d7">fault</a> != <a class="code" href="fault__fwd_8hh.html#ab8ce3b69a6737f63fcdcf99910feb153">NoFault</a>) {
<a name="l01758"></a>01758         <span class="comment">// A fault was generated</span>
<a name="l01759"></a>01759         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab84349f9e7472233bc23dfdc0968ba57">transState</a>-&gt;finish(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a68714ceb74c60ea7ef5dec335bb6c5d7">fault</a>, <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a956cd41d82347558b9c0a5b0474903f2">req</a>,
<a name="l01760"></a>01760                                       <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>, <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ae9b5adf8be89a72128708c7e621e7211">mode</a>);
<a name="l01761"></a>01761 
<a name="l01762"></a>01762         <a class="code" href="classArmISA_1_1TableWalker.html#a39f16d585c4531d2bf2562631a775d73">pending</a> = <span class="keyword">false</span>;
<a name="l01763"></a>01763         <a class="code" href="classArmISA_1_1TableWalker.html#ae126e9ab023c3e4659836daa8f5364be">nextWalk</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>);
<a name="l01764"></a>01764 
<a name="l01765"></a>01765         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a956cd41d82347558b9c0a5b0474903f2">req</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l01766"></a>01766         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l01767"></a>01767         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a08a9405038cd3486ef2ff99cdad274a0">delayed</a> = <span class="keyword">false</span>;
<a name="l01768"></a>01768         <span class="keyword">delete</span> <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>;
<a name="l01769"></a>01769     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a08a9405038cd3486ef2ff99cdad274a0">delayed</a>) {
<a name="l01770"></a>01770         <span class="comment">// No additional lookups required</span>
<a name="l01771"></a>01771         <span class="comment">// Don&apos;t finish the translation if a stage 2 look up is underway</span>
<a name="l01772"></a>01772         <span class="keywordflow">if</span> (!<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a8277e995719b58e8da5a0aa5bba2e623">doingStage2</a>) {
<a name="l01773"></a>01773             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(TLBVerbose, <span class="stringliteral">&quot;calling translateTiming again\n&quot;</span>);
<a name="l01774"></a>01774             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a68714ceb74c60ea7ef5dec335bb6c5d7">fault</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a9f0e11329a702fd34819769c899e4bd3">tlb</a>-&gt;<a class="code" href="classArmISA_1_1TLB.html#aece4eb62debdc9703b211d68ce771521">translateTiming</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a956cd41d82347558b9c0a5b0474903f2">req</a>, <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>,
<a name="l01775"></a>01775                                                     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab84349f9e7472233bc23dfdc0968ba57">transState</a>,
<a name="l01776"></a>01776                                                     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ae9b5adf8be89a72128708c7e621e7211">mode</a>);
<a name="l01777"></a>01777         }
<a name="l01778"></a>01778 
<a name="l01779"></a>01779         <a class="code" href="classArmISA_1_1TableWalker.html#a39f16d585c4531d2bf2562631a775d73">pending</a> = <span class="keyword">false</span>;
<a name="l01780"></a>01780         <a class="code" href="classArmISA_1_1TableWalker.html#ae126e9ab023c3e4659836daa8f5364be">nextWalk</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>);
<a name="l01781"></a>01781 
<a name="l01782"></a>01782         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a956cd41d82347558b9c0a5b0474903f2">req</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l01783"></a>01783         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l01784"></a>01784         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a08a9405038cd3486ef2ff99cdad274a0">delayed</a> = <span class="keyword">false</span>;
<a name="l01785"></a>01785         <span class="keyword">delete</span> <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>;
<a name="l01786"></a>01786     } <span class="keywordflow">else</span> {
<a name="l01787"></a>01787         <span class="keywordflow">if</span> (curr_lookup_level &gt;= <a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bdac130f49c8efeba8c4f65928f5f03a1db">MAX_LOOKUP_LEVELS</a> - 1)
<a name="l01788"></a>01788             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Max. number of lookups already reached in table walk\n&quot;</span>);
<a name="l01789"></a>01789         <span class="comment">// Need to perform additional lookups</span>
<a name="l01790"></a>01790         <a class="code" href="classArmISA_1_1TableWalker.html#af819b2b862d892da5df10248b6d72787">stateQueues</a>[<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1DescriptorBase.html#a88477771eb7d27741455a8035678c67a">lookupLevel</a>].push_back(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>);
<a name="l01791"></a>01791     }
<a name="l01792"></a>01792     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l01793"></a>01793 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa8a18d230dba7a674ac8a0b4f35bc36a"></a><!-- doxytag: member="ArmISA::TableWalker::drain" ref="aa8a18d230dba7a674ac8a0b4f35bc36a" args="(DrainManager *dm)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int drain </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classDrainManager.html">DrainManager</a> *&nbsp;</td>
          <td class="paramname"> <em>drainManger</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Provide a default implementation of the drain interface that simply returns 0 (draining completed) and sets the drain state to Drained. </p>

<p><a class="el" href="classSimObject.html#a6bf479c521c7c3eb473822d953275b26">SimObject</a>を再定義しています。</p>

<p><div class="fragment"><pre class="fragment"><a name="l00109"></a>00109 {
<a name="l00110"></a>00110     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespaceX86ISA.html#a668f84c330035fdb72824eb18e09cd09">count</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a9305ff92238d7360a5ee86168e00407b">port</a>.<a class="code" href="classDmaPort.html#a6bf479c521c7c3eb473822d953275b26">drain</a>(<a class="code" href="namespaceMipsISA.html#a2575c29e7f4617b6076486f340b6fe19">dm</a>);
<a name="l00111"></a>00111 
<a name="l00112"></a>00112     <span class="keywordtype">bool</span> state_queues_not_empty = <span class="keyword">false</span>;
<a name="l00113"></a>00113 
<a name="l00114"></a>00114     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> = 0; <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> &lt; <a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bdac130f49c8efeba8c4f65928f5f03a1db">MAX_LOOKUP_LEVELS</a>; ++<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>) {
<a name="l00115"></a>00115         <span class="keywordflow">if</span> (!<a class="code" href="classArmISA_1_1TableWalker.html#af819b2b862d892da5df10248b6d72787">stateQueues</a>[<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>].empty()) {
<a name="l00116"></a>00116             state_queues_not_empty = <span class="keyword">true</span>;
<a name="l00117"></a>00117             <span class="keywordflow">break</span>;
<a name="l00118"></a>00118         }
<a name="l00119"></a>00119     }
<a name="l00120"></a>00120 
<a name="l00121"></a>00121     <span class="keywordflow">if</span> (state_queues_not_empty || <a class="code" href="classArmISA_1_1TableWalker.html#a53a70edbb255426f7f2729f482c7109b">pendingQueue</a>.size()) {
<a name="l00122"></a>00122         <a class="code" href="classArmISA_1_1TableWalker.html#a329b71fb934a93312ca0aacbf5a3f982">drainManager</a> = <a class="code" href="namespaceMipsISA.html#a2575c29e7f4617b6076486f340b6fe19">dm</a>;
<a name="l00123"></a>00123         <a class="code" href="classDrainable.html#ad800905390fe03e850cf996e914038f9">setDrainState</a>(<a class="code" href="classDrainable.html#a5d74787dedbc4e11c1ab15bf487e61f8a929d17847bfad0d4689c9ab8540d5134">Drainable::Draining</a>);
<a name="l00124"></a>00124         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Drain, <span class="stringliteral">&quot;TableWalker not drained\n&quot;</span>);
<a name="l00125"></a>00125 
<a name="l00126"></a>00126         <span class="comment">// return port drain count plus the table walker itself needs to drain</span>
<a name="l00127"></a>00127         <span class="keywordflow">return</span> count + 1;
<a name="l00128"></a>00128     } <span class="keywordflow">else</span> {
<a name="l00129"></a>00129         <a class="code" href="classDrainable.html#ad800905390fe03e850cf996e914038f9">setDrainState</a>(<a class="code" href="classDrainable.html#a5d74787dedbc4e11c1ab15bf487e61f8a5656955cb808502a2ec75b367e2c1e82">Drainable::Drained</a>);
<a name="l00130"></a>00130         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Drain, <span class="stringliteral">&quot;TableWalker free, no need to drain\n&quot;</span>);
<a name="l00131"></a>00131 
<a name="l00132"></a>00132         <span class="comment">// table walker is drained, but its ports may still need to be drained</span>
<a name="l00133"></a>00133         <span class="keywordflow">return</span> count;
<a name="l00134"></a>00134     }
<a name="l00135"></a>00135 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8f020d3237536fe007fc488c4125c5d8"></a><!-- doxytag: member="ArmISA::TableWalker::drainResume" ref="a8f020d3237536fe007fc488c4125c5d8" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void drainResume </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Resume execution after a successful drain.</p>
<dl class="note"><dt><b>覚え書き:</b></dt><dd>This method is normally only called from the simulation scripts. </dd></dl>

<p><a class="el" href="classDrainable.html#a8f020d3237536fe007fc488c4125c5d8">Drainable</a>を再定義しています。</p>

<p><div class="fragment"><pre class="fragment"><a name="l00139"></a>00139 {
<a name="l00140"></a>00140     <a class="code" href="classArmISA_1_1TableWalker.html#a8f020d3237536fe007fc488c4125c5d8">Drainable::drainResume</a>();
<a name="l00141"></a>00141     <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#acd3c3feb78ae7a8f88fe0f110a718dff">params</a>()-&gt;sys-&gt;isTimingMode() &amp;&amp; <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>) {
<a name="l00142"></a>00142         <span class="keyword">delete</span> <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>;
<a name="l00143"></a>00143         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00144"></a>00144     }
<a name="l00145"></a>00145 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a583b81ca3090f4eb8014ec261cadeb6e"></a><!-- doxytag: member="ArmISA::TableWalker::fetchDescriptor" ref="a583b81ca3090f4eb8014ec261cadeb6e" args="(Addr descAddr, uint8_t *data, int numBytes, Request::Flags flags, int queueIndex, Event *event, void(TableWalker::*doDescriptor)())" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool fetchDescriptor </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classm5_1_1params_1_1Addr.html">Addr</a>&nbsp;</td>
          <td class="paramname"> <em>descAddr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>numBytes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classFlags.html">Request::Flags</a>&nbsp;</td>
          <td class="paramname"> <em>flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>queueIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Event *&nbsp;</td>
          <td class="paramname"> <em>event</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void(TableWalker::*)()&nbsp;</td>
          <td class="paramname"> <em>doDescriptor</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l01807"></a>01807 {
<a name="l01808"></a>01808     <span class="keywordtype">bool</span> isTiming = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a20f65ad56869382ed8681b9dd1aa85d6">timing</a>;
<a name="l01809"></a>01809 
<a name="l01810"></a>01810     <span class="comment">// do the requests for the page table descriptors have to go through the</span>
<a name="l01811"></a>01811     <span class="comment">// second stage MMU</span>
<a name="l01812"></a>01812     <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a52120124577a3b7c28a4e8876cd36a8b">stage2Req</a>) {
<a name="l01813"></a>01813         <a class="code" href="classRefCountingPtr.html">Fault</a> fault;
<a name="l01814"></a>01814         flags = flags | <a class="code" href="classArmISA_1_1TLB.html#a1e31c6b4a233c7e98a3e85eba0c84f0daf6e40c9fd5825f3b3a4f2d45d4a64c68">TLB::MustBeOne</a>;
<a name="l01815"></a>01815 
<a name="l01816"></a>01816         <span class="keywordflow">if</span> (isTiming) {
<a name="l01817"></a>01817             <a class="code" href="classArmISA_1_1Stage2MMU_1_1Stage2Translation.html">Stage2MMU::Stage2Translation</a> *tran = <span class="keyword">new</span>
<a name="l01818"></a>01818                 <a class="code" href="classArmISA_1_1Stage2MMU_1_1Stage2Translation.html">Stage2MMU::Stage2Translation</a>(*<a class="code" href="classArmISA_1_1TableWalker.html#a21ea64a0a6d9600fb09fff0854fd55d7">stage2Mmu</a>, data, <a class="code" href="namespaceMipsISA.html#aa3b803f4777161a2825178dabfb154f0">event</a>,
<a name="l01819"></a>01819                                              <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a9f933b300ef63eea367ca82f8da31025">vaddr</a>);
<a name="l01820"></a>01820             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab65d5f856546ee4e3a9610df9672d39a">stage2Tran</a> = tran;
<a name="l01821"></a>01821             <a class="code" href="classArmISA_1_1TableWalker.html#a21ea64a0a6d9600fb09fff0854fd55d7">stage2Mmu</a>-&gt;<a class="code" href="classArmISA_1_1Stage2MMU.html#a3798cb9b2fe75e8f40a2d2810824dd12">readDataTimed</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>, descAddr, tran, numBytes,
<a name="l01822"></a>01822                                      flags, <a class="code" href="classArmISA_1_1TableWalker.html#a96ec6a422ac492d05f8b3edc5b58532b">masterId</a>);
<a name="l01823"></a>01823             fault = tran-&gt;<a class="code" href="classArmISA_1_1Stage2MMU_1_1Stage2Translation.html#a68714ceb74c60ea7ef5dec335bb6c5d7">fault</a>;
<a name="l01824"></a>01824         } <span class="keywordflow">else</span> {
<a name="l01825"></a>01825             fault = <a class="code" href="classArmISA_1_1TableWalker.html#a21ea64a0a6d9600fb09fff0854fd55d7">stage2Mmu</a>-&gt;<a class="code" href="classArmISA_1_1Stage2MMU.html#ac040aef55a7ff520560957793f33f2d0">readDataUntimed</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>,
<a name="l01826"></a>01826                 <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a9f933b300ef63eea367ca82f8da31025">vaddr</a>, descAddr, data, numBytes, flags, <a class="code" href="classArmISA_1_1TableWalker.html#a96ec6a422ac492d05f8b3edc5b58532b">masterId</a>,
<a name="l01827"></a>01827                 <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4f60754b74e2d1584c06199ae5b75f21">functional</a>);
<a name="l01828"></a>01828         }
<a name="l01829"></a>01829 
<a name="l01830"></a>01830         <span class="keywordflow">if</span> (fault != <a class="code" href="fault__fwd_8hh.html#ab8ce3b69a6737f63fcdcf99910feb153">NoFault</a>) {
<a name="l01831"></a>01831             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a68714ceb74c60ea7ef5dec335bb6c5d7">fault</a> = fault;
<a name="l01832"></a>01832         }
<a name="l01833"></a>01833         <span class="keywordflow">if</span> (isTiming) {
<a name="l01834"></a>01834             <span class="keywordflow">if</span> (queueIndex &gt;= 0) {
<a name="l01835"></a>01835                 <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(TLBVerbose, <span class="stringliteral">&quot;Adding to walker fifo: queue size before adding: %d\n&quot;</span>,
<a name="l01836"></a>01836                         <a class="code" href="classArmISA_1_1TableWalker.html#af819b2b862d892da5df10248b6d72787">stateQueues</a>[queueIndex].size());
<a name="l01837"></a>01837                 <a class="code" href="classArmISA_1_1TableWalker.html#af819b2b862d892da5df10248b6d72787">stateQueues</a>[queueIndex].push_back(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>);
<a name="l01838"></a>01838                 <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l01839"></a>01839             }
<a name="l01840"></a>01840         } <span class="keywordflow">else</span> {
<a name="l01841"></a>01841             (this-&gt;*doDescriptor)();
<a name="l01842"></a>01842         }
<a name="l01843"></a>01843     } <span class="keywordflow">else</span> {
<a name="l01844"></a>01844         <span class="keywordflow">if</span> (isTiming) {
<a name="l01845"></a>01845             <a class="code" href="classArmISA_1_1TableWalker.html#a9305ff92238d7360a5ee86168e00407b">port</a>.<a class="code" href="classDmaPort.html#ac9a04fe85b8cb0292631680073eddb86">dmaAction</a>(<a class="code" href="classMemCmd.html#a2afce0a47a93eee73a314d53e4890153a96120c772a9cb695fe62ca81ec93a53b">MemCmd::ReadReq</a>, descAddr, numBytes, <a class="code" href="namespaceMipsISA.html#aa3b803f4777161a2825178dabfb154f0">event</a>, data,
<a name="l01846"></a>01846                            <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>-&gt;<a class="code" href="classThreadContext.html#ad10a7ef049c2d2ffadfc809341e66d4e">getCpuPtr</a>()-&gt;clockPeriod(), flags);
<a name="l01847"></a>01847             <span class="keywordflow">if</span> (queueIndex &gt;= 0) {
<a name="l01848"></a>01848                 <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(TLBVerbose, <span class="stringliteral">&quot;Adding to walker fifo: queue size before adding: %d\n&quot;</span>,
<a name="l01849"></a>01849                         <a class="code" href="classArmISA_1_1TableWalker.html#af819b2b862d892da5df10248b6d72787">stateQueues</a>[queueIndex].size());
<a name="l01850"></a>01850                 <a class="code" href="classArmISA_1_1TableWalker.html#af819b2b862d892da5df10248b6d72787">stateQueues</a>[queueIndex].push_back(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>);
<a name="l01851"></a>01851                 <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l01852"></a>01852             }
<a name="l01853"></a>01853         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4f60754b74e2d1584c06199ae5b75f21">functional</a>) {
<a name="l01854"></a>01854             <a class="code" href="classArmISA_1_1TableWalker.html#a9305ff92238d7360a5ee86168e00407b">port</a>.<a class="code" href="classDmaPort.html#ac9a04fe85b8cb0292631680073eddb86">dmaAction</a>(<a class="code" href="classMemCmd.html#a2afce0a47a93eee73a314d53e4890153a96120c772a9cb695fe62ca81ec93a53b">MemCmd::ReadReq</a>, descAddr, numBytes, <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>, data,
<a name="l01855"></a>01855                            <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>-&gt;<a class="code" href="classThreadContext.html#ad10a7ef049c2d2ffadfc809341e66d4e">getCpuPtr</a>()-&gt;clockPeriod(), flags);
<a name="l01856"></a>01856             (this-&gt;*doDescriptor)();
<a name="l01857"></a>01857         } <span class="keywordflow">else</span> {
<a name="l01858"></a>01858             <a class="code" href="classRequest.html">RequestPtr</a> req = <span class="keyword">new</span> <a class="code" href="classRequest.html">Request</a>(descAddr, numBytes, flags, <a class="code" href="classArmISA_1_1TableWalker.html#a96ec6a422ac492d05f8b3edc5b58532b">masterId</a>);
<a name="l01859"></a>01859             req-&gt;<a class="code" href="classRequest.html#a7abf15d67b3fbd53236fde58eecb3f34">taskId</a>(<a class="code" href="namespaceContextSwitchTaskId.html#aa8dd388981e62e592eb420a58ab290b7a6537a62f6f155792bb9a320ee2ec4d68">ContextSwitchTaskId::DMA</a>);
<a name="l01860"></a>01860             <a class="code" href="classPacket.html">PacketPtr</a>  pkt = <span class="keyword">new</span> <a class="code" href="classPacket.html">Packet</a>(req, <a class="code" href="classMemCmd.html#a2afce0a47a93eee73a314d53e4890153a96120c772a9cb695fe62ca81ec93a53b">MemCmd::ReadReq</a>);
<a name="l01861"></a>01861             pkt-&gt;<a class="code" href="classPacket.html#a60621b00d6ecd49b3e336087aca2eda0">dataStatic</a>(data);
<a name="l01862"></a>01862             <a class="code" href="classArmISA_1_1TableWalker.html#a9305ff92238d7360a5ee86168e00407b">port</a>.<a class="code" href="classMasterPort.html#aef8a57d30c0da6a2d2a599a14a9b8751">sendFunctional</a>(pkt);
<a name="l01863"></a>01863             (this-&gt;*doDescriptor)();
<a name="l01864"></a>01864             <span class="keyword">delete</span> req;
<a name="l01865"></a>01865             <span class="keyword">delete</span> pkt;
<a name="l01866"></a>01866         }
<a name="l01867"></a>01867     }
<a name="l01868"></a>01868     <span class="keywordflow">return</span> (isTiming);
<a name="l01869"></a>01869 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="adc4e675e51defbdd1e354dac729d0703"></a><!-- doxytag: member="ArmISA::TableWalker::getMasterPort" ref="adc4e675e51defbdd1e354dac729d0703" args="(const std::string &amp;if_name, PortID idx=InvalidPortID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classBaseMasterPort.html">BaseMasterPort</a> &amp; getMasterPort </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&nbsp;</td>
          <td class="paramname"> <em>if_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a>&nbsp;</td>
          <td class="paramname"> <em>idx</em> = <code><a class="el" href="base_2types_8hh.html#a65bf40f138cf863f0c5e2d8ca1144126">InvalidPortID</a></code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Get a master port with a given name and index. This is used at binding time and returns a reference to a protocol-agnostic base master port.</p>
<dl><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>if_name</em>&nbsp;</td><td><a class="el" href="classPort.html">Port</a> name </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>idx</em>&nbsp;</td><td>Index in the case of a VectorPort</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>戻り値:</b></dt><dd>A reference to the given port </dd></dl>

<p><a class="el" href="classMemObject.html#adc4e675e51defbdd1e354dac729d0703">MemObject</a>を再定義しています。</p>

<p><div class="fragment"><pre class="fragment"><a name="l00149"></a>00149 {
<a name="l00150"></a>00150     <span class="keywordflow">if</span> (if_name == <span class="stringliteral">&quot;port&quot;</span>) {
<a name="l00151"></a>00151         <span class="keywordflow">return</span> <a class="code" href="classArmISA_1_1TableWalker.html#a9305ff92238d7360a5ee86168e00407b">port</a>;
<a name="l00152"></a>00152     }
<a name="l00153"></a>00153     <span class="keywordflow">return</span> <a class="code" href="classArmISA_1_1TableWalker.html#adc4e675e51defbdd1e354dac729d0703">MemObject::getMasterPort</a>(if_name, idx);
<a name="l00154"></a>00154 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a93d3a5cc8edcf04b6e62ce3ce3eb215c"></a><!-- doxytag: member="ArmISA::TableWalker::getTlb" ref="a93d3a5cc8edcf04b6e62ce3ce3eb215c" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classArmISA_1_1TLB.html">TLB</a>* getTlb </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00900"></a>00900 { <span class="keywordflow">return</span> <a class="code" href="classArmISA_1_1TableWalker.html#a9f0e11329a702fd34819769c899e4bd3">tlb</a>; }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aab28913130b30d21077d9a054c46b81f"></a><!-- doxytag: member="ArmISA::TableWalker::getWalkerPort" ref="aab28913130b30d21077d9a054c46b81f" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classDmaPort.html">DmaPort</a>&amp; getWalkerPort </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Allow the MMU (overseeing both stage 1 and stage 2 TLBs) to access the table walker port through the <a class="el" href="classArmISA_1_1TLB.html">TLB</a> so that it can orchestrate staged translations.</p>
<dl class="return"><dt><b>戻り値:</b></dt><dd>Our DMA port </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00892"></a>00892 { <span class="keywordflow">return</span> <a class="code" href="classArmISA_1_1TableWalker.html#a9305ff92238d7360a5ee86168e00407b">port</a>; }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a47958664a46869f3fb4f9b043da32be5"></a><!-- doxytag: member="ArmISA::TableWalker::haveLargeAsid64" ref="a47958664a46869f3fb4f9b043da32be5" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool haveLargeAsid64 </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00877"></a>00877 { <span class="keywordflow">return</span> <a class="code" href="classArmISA_1_1TableWalker.html#af7d46e1faf4b0edb95f404a28e31902d">_haveLargeAsid64</a>; }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a39b5e5d6cff3c8f5a248143a702d8f1a"></a><!-- doxytag: member="ArmISA::TableWalker::haveLPAE" ref="a39b5e5d6cff3c8f5a248143a702d8f1a" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool haveLPAE </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00875"></a>00875 { <span class="keywordflow">return</span> <a class="code" href="classArmISA_1_1TableWalker.html#a74ac6c840c516a9b8a6eb63ed9ef1185">_haveLPAE</a>; }
</pre></div></p>

</div>
</div>
<a class="anchor" id="afef641e959fe33dee8702b9bb5e1b9e4"></a><!-- doxytag: member="ArmISA::TableWalker::haveVirtualization" ref="afef641e959fe33dee8702b9bb5e1b9e4" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool haveVirtualization </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00876"></a>00876 { <span class="keywordflow">return</span> <a class="code" href="classArmISA_1_1TableWalker.html#a8327a5b4e38733a0d77ae856ba67725f">_haveVirtualization</a>; }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aad13c1fc4ab80d03d2af5ac43f41be23"></a><!-- doxytag: member="ArmISA::TableWalker::insertTableEntry" ref="aad13c1fc4ab80d03d2af5ac43f41be23" args="(DescriptorBase &amp;descriptor, bool longDescriptor)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void insertTableEntry </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classArmISA_1_1TableWalker_1_1DescriptorBase.html">DescriptorBase</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>descriptor</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>longDescriptor</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l01873"></a>01873 {
<a name="l01874"></a>01874     <a class="code" href="structArmISA_1_1TlbEntry.html">TlbEntry</a> <a class="code" href="namespaceMipsISA.html#a49c5c4308a3fe2af210c807bd186b780">te</a>;
<a name="l01875"></a>01875 
<a name="l01876"></a>01876     <span class="comment">// Create and fill a new page table entry</span>
<a name="l01877"></a>01877     te.<a class="code" href="structArmISA_1_1TlbEntry.html#a28e3c179a86f337095088b3ca02a2b2a">valid</a>          = <span class="keyword">true</span>;
<a name="l01878"></a>01878     te.<a class="code" href="structArmISA_1_1TlbEntry.html#a4e71e701ab0aa7cfed27f93c7b4646f3">longDescFormat</a> = longDescriptor;
<a name="l01879"></a>01879     te.<a class="code" href="structArmISA_1_1TlbEntry.html#a104c09577173edc4f8ce6814cc33f0ae">isHyp</a>          = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a104c09577173edc4f8ce6814cc33f0ae">isHyp</a>;
<a name="l01880"></a>01880     te.<a class="code" href="structArmISA_1_1TlbEntry.html#a984a2dcfd9509ab586bee117bb2a7cfb">asid</a>           = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a984a2dcfd9509ab586bee117bb2a7cfb">asid</a>;
<a name="l01881"></a>01881     te.<a class="code" href="structArmISA_1_1TlbEntry.html#add293169f7f2ac526b3fa14f950cf0bb">vmid</a>           = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#add293169f7f2ac526b3fa14f950cf0bb">vmid</a>;
<a name="l01882"></a>01882     te.<a class="code" href="structArmISA_1_1TlbEntry.html#a77200420e0e4a3db85d736b7a0b91f64">N</a>              = descriptor.offsetBits();
<a name="l01883"></a>01883     te.<a class="code" href="structArmISA_1_1TlbEntry.html#ad378f7d20675898b2a5994600528fa9a">vpn</a>            = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a9f933b300ef63eea367ca82f8da31025">vaddr</a> &gt;&gt; te.<a class="code" href="structArmISA_1_1TlbEntry.html#a77200420e0e4a3db85d736b7a0b91f64">N</a>;
<a name="l01884"></a>01884     te.<a class="code" href="structArmISA_1_1TlbEntry.html#a8ce507144b5ef53350af753eafb669f0">size</a>           = (1&lt;&lt;te.<a class="code" href="structArmISA_1_1TlbEntry.html#a77200420e0e4a3db85d736b7a0b91f64">N</a>) - 1;
<a name="l01885"></a>01885     te.<a class="code" href="structArmISA_1_1TlbEntry.html#a66f77e20f7d5ff3157c4ee9eaf72adfc">pfn</a>            = descriptor.pfn();
<a name="l01886"></a>01886     te.<a class="code" href="structArmISA_1_1TlbEntry.html#accddad3ef7d0db5aa7c34d730fc03a33">domain</a>         = descriptor.domain();
<a name="l01887"></a>01887     te.<a class="code" href="structArmISA_1_1TlbEntry.html#a88477771eb7d27741455a8035678c67a">lookupLevel</a>    = descriptor.lookupLevel;
<a name="l01888"></a>01888     te.<a class="code" href="structArmISA_1_1TlbEntry.html#aa3ca0c504f321d3657985faf35740bbe">ns</a>             = !descriptor.secure(<a class="code" href="classArmISA_1_1TableWalker.html#a9f135583566fb70bba3c10395368f2e4">haveSecurity</a>, <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>) || <a class="code" href="classArmISA_1_1TableWalker.html#a475f8007920fb01f7f8aa1730b3016bb">isStage2</a>;
<a name="l01889"></a>01889     te.<a class="code" href="structArmISA_1_1TlbEntry.html#ac54510c3105727d94588b3fdb109ab42">nstid</a>          = !<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a62bc84f4251f16cf0cfa0f8d96e00c37">isSecure</a>;
<a name="l01890"></a>01890     te.<a class="code" href="structArmISA_1_1TlbEntry.html#aa0cd1c167e9b1ae45c71739eaf0460a6">xn</a>             = descriptor.xn();
<a name="l01891"></a>01891     <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a52c06c8a54293998f3e1f71cdbd916f7">aarch64</a>)
<a name="l01892"></a>01892         te.<a class="code" href="structArmISA_1_1TlbEntry.html#a3755c7b1c4844077396e8156639f0709">el</a>         = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a878510cdbf1a6438f83754acbdbf759a">el</a>;
<a name="l01893"></a>01893     <span class="keywordflow">else</span>
<a name="l01894"></a>01894         te.<a class="code" href="structArmISA_1_1TlbEntry.html#a3755c7b1c4844077396e8156639f0709">el</a>         = 1;
<a name="l01895"></a>01895 
<a name="l01896"></a>01896     <span class="comment">// ASID has no meaning for stage 2 TLB entries, so mark all stage 2 entries</span>
<a name="l01897"></a>01897     <span class="comment">// as global</span>
<a name="l01898"></a>01898     te.<a class="code" href="structArmISA_1_1TlbEntry.html#a86004534684821212245555e66ec1d09">global</a>         = descriptor.global(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>) || <a class="code" href="classArmISA_1_1TableWalker.html#a475f8007920fb01f7f8aa1730b3016bb">isStage2</a>;
<a name="l01899"></a>01899     <span class="keywordflow">if</span> (longDescriptor) {
<a name="l01900"></a>01900         LongDescriptor lDescriptor =
<a name="l01901"></a>01901             <span class="keyword">dynamic_cast&lt;</span>LongDescriptor &amp;<span class="keyword">&gt;</span>(descriptor);
<a name="l01902"></a>01902 
<a name="l01903"></a>01903         te.<a class="code" href="structArmISA_1_1TlbEntry.html#aa0cd1c167e9b1ae45c71739eaf0460a6">xn</a> |= <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a34b92e09eece01cfa45e9b9d0b7f74c6">xnTable</a>;
<a name="l01904"></a>01904         te.<a class="code" href="structArmISA_1_1TlbEntry.html#a565f62bb51651c298732bb3e9f1fabcd">pxn</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a92af2e7b7b80463a6bbf8ccead3af087">pxnTable</a> || lDescriptor.pxn();
<a name="l01905"></a>01905         <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a475f8007920fb01f7f8aa1730b3016bb">isStage2</a>) {
<a name="l01906"></a>01906             <span class="comment">// this is actually the HAP field, but its stored in the same bit</span>
<a name="l01907"></a>01907             <span class="comment">// possitions as the AP field in a stage 1 translation.</span>
<a name="l01908"></a>01908             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a8652932397f601905aff0b8327951acc">hap</a> = lDescriptor.ap();
<a name="l01909"></a>01909         } <span class="keywordflow">else</span> {
<a name="l01910"></a>01910            te.<a class="code" href="structArmISA_1_1TlbEntry.html#af0965a83f15ef1c7fae65446c4b6b86d">ap</a> = ((!<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a419a9be86581a6eba5d7f4a22f0f6e76">rwTable</a> || descriptor.ap() &gt;&gt; 1) &lt;&lt; 1) |
<a name="l01911"></a>01911                (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab4be9ffb2fe22576e2f587374fdd20e6">userTable</a> &amp;&amp; (descriptor.ap() &amp; 0x1));
<a name="l01912"></a>01912         }
<a name="l01913"></a>01913         <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a52c06c8a54293998f3e1f71cdbd916f7">aarch64</a>)
<a name="l01914"></a>01914             <a class="code" href="classArmISA_1_1TableWalker.html#ae90661ceebb345173d8a0e9306fa9a82">memAttrsAArch64</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>, te, <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1LongDescriptor.html#a4aa987f33acae31f584caac0c5243b4b">attrIndx</a>(),
<a name="l01915"></a>01915                             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1LongDescriptor.html#a3446eaca4d3fe88011cc2ed1aceba481">sh</a>());
<a name="l01916"></a>01916         <span class="keywordflow">else</span>
<a name="l01917"></a>01917             <a class="code" href="classArmISA_1_1TableWalker.html#ae00bd2d40b63721817ec582dbf4022a5">memAttrsLPAE</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>, te, lDescriptor);
<a name="l01918"></a>01918     } <span class="keywordflow">else</span> {
<a name="l01919"></a>01919         te.<a class="code" href="structArmISA_1_1TlbEntry.html#af0965a83f15ef1c7fae65446c4b6b86d">ap</a> = descriptor.ap();
<a name="l01920"></a>01920         <a class="code" href="classArmISA_1_1TableWalker.html#a43ff5c97155cc958074f6212824d8890">memAttrs</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>, te, <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a43c4d132ca97c6cc5358f7be3c2b5a69">sctlr</a>, descriptor.texcb(),
<a name="l01921"></a>01921                  descriptor.shareable());
<a name="l01922"></a>01922     }
<a name="l01923"></a>01923 
<a name="l01924"></a>01924     <span class="comment">// Debug output</span>
<a name="l01925"></a>01925     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classArmISA_1_1TLB.html">TLB</a>, descriptor.dbgHeader().c_str());
<a name="l01926"></a>01926     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classArmISA_1_1TLB.html">TLB</a>, <span class="stringliteral">&quot; - N:%d pfn:%#x size:%#x global:%d valid:%d\n&quot;</span>,
<a name="l01927"></a>01927             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a77200420e0e4a3db85d736b7a0b91f64">N</a>, te.<a class="code" href="structArmISA_1_1TlbEntry.html#a66f77e20f7d5ff3157c4ee9eaf72adfc">pfn</a>, te.<a class="code" href="structArmISA_1_1TlbEntry.html#a8ce507144b5ef53350af753eafb669f0">size</a>, te.<a class="code" href="structArmISA_1_1TlbEntry.html#a86004534684821212245555e66ec1d09">global</a>, te.<a class="code" href="structArmISA_1_1TlbEntry.html#a28e3c179a86f337095088b3ca02a2b2a">valid</a>);
<a name="l01928"></a>01928     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classArmISA_1_1TLB.html">TLB</a>, <span class="stringliteral">&quot; - vpn:%#x xn:%d pxn:%d ap:%d domain:%d asid:%d &quot;</span>
<a name="l01929"></a>01929             <span class="stringliteral">&quot;vmid:%d hyp:%d nc:%d ns:%d\n&quot;</span>, te.<a class="code" href="structArmISA_1_1TlbEntry.html#ad378f7d20675898b2a5994600528fa9a">vpn</a>, te.<a class="code" href="structArmISA_1_1TlbEntry.html#aa0cd1c167e9b1ae45c71739eaf0460a6">xn</a>, te.<a class="code" href="structArmISA_1_1TlbEntry.html#a565f62bb51651c298732bb3e9f1fabcd">pxn</a>,
<a name="l01930"></a>01930             te.<a class="code" href="structArmISA_1_1TlbEntry.html#af0965a83f15ef1c7fae65446c4b6b86d">ap</a>, static_cast&lt;uint8_t&gt;(te.<a class="code" href="structArmISA_1_1TlbEntry.html#accddad3ef7d0db5aa7c34d730fc03a33">domain</a>), te.<a class="code" href="structArmISA_1_1TlbEntry.html#a984a2dcfd9509ab586bee117bb2a7cfb">asid</a>, te.<a class="code" href="structArmISA_1_1TlbEntry.html#add293169f7f2ac526b3fa14f950cf0bb">vmid</a>, te.<a class="code" href="structArmISA_1_1TlbEntry.html#a104c09577173edc4f8ce6814cc33f0ae">isHyp</a>,
<a name="l01931"></a>01931             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a4f3ea4eb06b83de0e16cc771374db506">nonCacheable</a>, te.<a class="code" href="structArmISA_1_1TlbEntry.html#aa3ca0c504f321d3657985faf35740bbe">ns</a>);
<a name="l01932"></a>01932     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classArmISA_1_1TLB.html">TLB</a>, <span class="stringliteral">&quot; - domain from L%d desc:%d data:%#x\n&quot;</span>,
<a name="l01933"></a>01933             descriptor.lookupLevel, static_cast&lt;uint8_t&gt;(descriptor.domain()),
<a name="l01934"></a>01934             descriptor.getRawData());
<a name="l01935"></a>01935 
<a name="l01936"></a>01936     <span class="comment">// Insert the entry into the TLB</span>
<a name="l01937"></a>01937     <a class="code" href="classArmISA_1_1TableWalker.html#a9f0e11329a702fd34819769c899e4bd3">tlb</a>-&gt;<a class="code" href="classArmISA_1_1TLB.html#a0a32b96ef1142ca48fa347d06b5d2436">insert</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a9f933b300ef63eea367ca82f8da31025">vaddr</a>, te);
<a name="l01938"></a>01938     <span class="keywordflow">if</span> (!<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a20f65ad56869382ed8681b9dd1aa85d6">timing</a>) {
<a name="l01939"></a>01939         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>  = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l01940"></a>01940         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a956cd41d82347558b9c0a5b0474903f2">req</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l01941"></a>01941     }
<a name="l01942"></a>01942 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a43ff5c97155cc958074f6212824d8890"></a><!-- doxytag: member="ArmISA::TableWalker::memAttrs" ref="a43ff5c97155cc958074f6212824d8890" args="(ThreadContext *tc, TlbEntry &amp;te, SCTLR sctlr, uint8_t texcb, bool s)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void memAttrs </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classThreadContext.html">ThreadContext</a> *&nbsp;</td>
          <td class="paramname"> <em>tc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structArmISA_1_1TlbEntry.html">TlbEntry</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>te</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SCTLR&nbsp;</td>
          <td class="paramname"> <em>sctlr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&nbsp;</td>
          <td class="paramname"> <em>texcb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>s</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00896"></a>00896 {
<a name="l00897"></a>00897     <span class="comment">// Note: tc and sctlr local variables are hiding tc and sctrl class</span>
<a name="l00898"></a>00898     <span class="comment">// variables</span>
<a name="l00899"></a>00899     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(TLBVerbose, <span class="stringliteral">&quot;memAttrs texcb:%d s:%d\n&quot;</span>, texcb, <a class="code" href="namespaceArmISA.html#afaeb18e17f862d8fcb76dfb68a18854f">s</a>);
<a name="l00900"></a>00900     te.<a class="code" href="structArmISA_1_1TlbEntry.html#a8595b2218cf2d99d0987a204f511f3f2">shareable</a> = <span class="keyword">false</span>; <span class="comment">// default value</span>
<a name="l00901"></a>00901     te.<a class="code" href="structArmISA_1_1TlbEntry.html#a4f3ea4eb06b83de0e16cc771374db506">nonCacheable</a> = <span class="keyword">false</span>;
<a name="l00902"></a>00902     te.<a class="code" href="structArmISA_1_1TlbEntry.html#a6ad80a1d32b73f10c744decc24ca7cd5">outerShareable</a> = <span class="keyword">false</span>;
<a name="l00903"></a>00903     <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a43c4d132ca97c6cc5358f7be3c2b5a69">sctlr</a>.tre == 0 || ((<a class="code" href="classArmISA_1_1TableWalker.html#a43c4d132ca97c6cc5358f7be3c2b5a69">sctlr</a>.tre == 1) &amp;&amp; (<a class="code" href="classArmISA_1_1TableWalker.html#a43c4d132ca97c6cc5358f7be3c2b5a69">sctlr</a>.m == 0))) {
<a name="l00904"></a>00904         <span class="keywordflow">switch</span>(texcb) {
<a name="l00905"></a>00905           <span class="keywordflow">case</span> 0: <span class="comment">// Stongly-ordered</span>
<a name="l00906"></a>00906             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a4f3ea4eb06b83de0e16cc771374db506">nonCacheable</a> = <span class="keyword">true</span>;
<a name="l00907"></a>00907             te.<a class="code" href="structArmISA_1_1TlbEntry.html#adf9797b2466c7c1b82e0b738b75d8fab">mtype</a> = TlbEntry::MemoryType::StronglyOrdered;
<a name="l00908"></a>00908             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a8595b2218cf2d99d0987a204f511f3f2">shareable</a> = <span class="keyword">true</span>;
<a name="l00909"></a>00909             te.<a class="code" href="structArmISA_1_1TlbEntry.html#acf1e099a3b1f79dcf9db2007bdfd4c51">innerAttrs</a> = 1;
<a name="l00910"></a>00910             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a8f3ab6c1b3ebb9db965b8cc788b0dab4">outerAttrs</a> = 0;
<a name="l00911"></a>00911             <span class="keywordflow">break</span>;
<a name="l00912"></a>00912           <span class="keywordflow">case</span> 1: <span class="comment">// Shareable Device</span>
<a name="l00913"></a>00913             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a4f3ea4eb06b83de0e16cc771374db506">nonCacheable</a> = <span class="keyword">true</span>;
<a name="l00914"></a>00914             te.<a class="code" href="structArmISA_1_1TlbEntry.html#adf9797b2466c7c1b82e0b738b75d8fab">mtype</a> = TlbEntry::MemoryType::Device;
<a name="l00915"></a>00915             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a8595b2218cf2d99d0987a204f511f3f2">shareable</a> = <span class="keyword">true</span>;
<a name="l00916"></a>00916             te.<a class="code" href="structArmISA_1_1TlbEntry.html#acf1e099a3b1f79dcf9db2007bdfd4c51">innerAttrs</a> = 3;
<a name="l00917"></a>00917             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a8f3ab6c1b3ebb9db965b8cc788b0dab4">outerAttrs</a> = 0;
<a name="l00918"></a>00918             <span class="keywordflow">break</span>;
<a name="l00919"></a>00919           <span class="keywordflow">case</span> 2: <span class="comment">// Outer and Inner Write-Through, no Write-Allocate</span>
<a name="l00920"></a>00920             te.<a class="code" href="structArmISA_1_1TlbEntry.html#adf9797b2466c7c1b82e0b738b75d8fab">mtype</a> = TlbEntry::MemoryType::Normal;
<a name="l00921"></a>00921             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a8595b2218cf2d99d0987a204f511f3f2">shareable</a> = <a class="code" href="namespaceArmISA.html#afaeb18e17f862d8fcb76dfb68a18854f">s</a>;
<a name="l00922"></a>00922             te.<a class="code" href="structArmISA_1_1TlbEntry.html#acf1e099a3b1f79dcf9db2007bdfd4c51">innerAttrs</a> = 6;
<a name="l00923"></a>00923             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a8f3ab6c1b3ebb9db965b8cc788b0dab4">outerAttrs</a> = <a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123">bits</a>(texcb, 1, 0);
<a name="l00924"></a>00924             <span class="keywordflow">break</span>;
<a name="l00925"></a>00925           <span class="keywordflow">case</span> 3: <span class="comment">// Outer and Inner Write-Back, no Write-Allocate</span>
<a name="l00926"></a>00926             te.<a class="code" href="structArmISA_1_1TlbEntry.html#adf9797b2466c7c1b82e0b738b75d8fab">mtype</a> = TlbEntry::MemoryType::Normal;
<a name="l00927"></a>00927             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a8595b2218cf2d99d0987a204f511f3f2">shareable</a> = <a class="code" href="namespaceArmISA.html#afaeb18e17f862d8fcb76dfb68a18854f">s</a>;
<a name="l00928"></a>00928             te.<a class="code" href="structArmISA_1_1TlbEntry.html#acf1e099a3b1f79dcf9db2007bdfd4c51">innerAttrs</a> = 7;
<a name="l00929"></a>00929             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a8f3ab6c1b3ebb9db965b8cc788b0dab4">outerAttrs</a> = <a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123">bits</a>(texcb, 1, 0);
<a name="l00930"></a>00930             <span class="keywordflow">break</span>;
<a name="l00931"></a>00931           <span class="keywordflow">case</span> 4: <span class="comment">// Outer and Inner Non-cacheable</span>
<a name="l00932"></a>00932             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a4f3ea4eb06b83de0e16cc771374db506">nonCacheable</a> = <span class="keyword">true</span>;
<a name="l00933"></a>00933             te.<a class="code" href="structArmISA_1_1TlbEntry.html#adf9797b2466c7c1b82e0b738b75d8fab">mtype</a> = TlbEntry::MemoryType::Normal;
<a name="l00934"></a>00934             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a8595b2218cf2d99d0987a204f511f3f2">shareable</a> = <a class="code" href="namespaceArmISA.html#afaeb18e17f862d8fcb76dfb68a18854f">s</a>;
<a name="l00935"></a>00935             te.<a class="code" href="structArmISA_1_1TlbEntry.html#acf1e099a3b1f79dcf9db2007bdfd4c51">innerAttrs</a> = 0;
<a name="l00936"></a>00936             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a8f3ab6c1b3ebb9db965b8cc788b0dab4">outerAttrs</a> = <a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123">bits</a>(texcb, 1, 0);
<a name="l00937"></a>00937             <span class="keywordflow">break</span>;
<a name="l00938"></a>00938           <span class="keywordflow">case</span> 5: <span class="comment">// Reserved</span>
<a name="l00939"></a>00939             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Reserved texcb value!\n&quot;</span>);
<a name="l00940"></a>00940             <span class="keywordflow">break</span>;
<a name="l00941"></a>00941           <span class="keywordflow">case</span> 6: <span class="comment">// Implementation Defined</span>
<a name="l00942"></a>00942             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Implementation-defined texcb value!\n&quot;</span>);
<a name="l00943"></a>00943             <span class="keywordflow">break</span>;
<a name="l00944"></a>00944           <span class="keywordflow">case</span> 7: <span class="comment">// Outer and Inner Write-Back, Write-Allocate</span>
<a name="l00945"></a>00945             te.<a class="code" href="structArmISA_1_1TlbEntry.html#adf9797b2466c7c1b82e0b738b75d8fab">mtype</a> = TlbEntry::MemoryType::Normal;
<a name="l00946"></a>00946             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a8595b2218cf2d99d0987a204f511f3f2">shareable</a> = <a class="code" href="namespaceArmISA.html#afaeb18e17f862d8fcb76dfb68a18854f">s</a>;
<a name="l00947"></a>00947             te.<a class="code" href="structArmISA_1_1TlbEntry.html#acf1e099a3b1f79dcf9db2007bdfd4c51">innerAttrs</a> = 5;
<a name="l00948"></a>00948             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a8f3ab6c1b3ebb9db965b8cc788b0dab4">outerAttrs</a> = 1;
<a name="l00949"></a>00949             <span class="keywordflow">break</span>;
<a name="l00950"></a>00950           <span class="keywordflow">case</span> 8: <span class="comment">// Non-shareable Device</span>
<a name="l00951"></a>00951             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a4f3ea4eb06b83de0e16cc771374db506">nonCacheable</a> = <span class="keyword">true</span>;
<a name="l00952"></a>00952             te.<a class="code" href="structArmISA_1_1TlbEntry.html#adf9797b2466c7c1b82e0b738b75d8fab">mtype</a> = TlbEntry::MemoryType::Device;
<a name="l00953"></a>00953             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a8595b2218cf2d99d0987a204f511f3f2">shareable</a> = <span class="keyword">false</span>;
<a name="l00954"></a>00954             te.<a class="code" href="structArmISA_1_1TlbEntry.html#acf1e099a3b1f79dcf9db2007bdfd4c51">innerAttrs</a> = 3;
<a name="l00955"></a>00955             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a8f3ab6c1b3ebb9db965b8cc788b0dab4">outerAttrs</a> = 0;
<a name="l00956"></a>00956             <span class="keywordflow">break</span>;
<a name="l00957"></a>00957           <span class="keywordflow">case</span> 9 ... 15:  <span class="comment">// Reserved</span>
<a name="l00958"></a>00958             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Reserved texcb value!\n&quot;</span>);
<a name="l00959"></a>00959             <span class="keywordflow">break</span>;
<a name="l00960"></a>00960           <span class="keywordflow">case</span> 16 ... 31: <span class="comment">// Cacheable Memory</span>
<a name="l00961"></a>00961             te.<a class="code" href="structArmISA_1_1TlbEntry.html#adf9797b2466c7c1b82e0b738b75d8fab">mtype</a> = TlbEntry::MemoryType::Normal;
<a name="l00962"></a>00962             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a8595b2218cf2d99d0987a204f511f3f2">shareable</a> = <a class="code" href="namespaceArmISA.html#afaeb18e17f862d8fcb76dfb68a18854f">s</a>;
<a name="l00963"></a>00963             <span class="keywordflow">if</span> (<a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123">bits</a>(texcb, 1,0) == 0 || <a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123">bits</a>(texcb, 3,2) == 0)
<a name="l00964"></a>00964                 te.<a class="code" href="structArmISA_1_1TlbEntry.html#a4f3ea4eb06b83de0e16cc771374db506">nonCacheable</a> = <span class="keyword">true</span>;
<a name="l00965"></a>00965             te.<a class="code" href="structArmISA_1_1TlbEntry.html#acf1e099a3b1f79dcf9db2007bdfd4c51">innerAttrs</a> = <a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123">bits</a>(texcb, 1, 0);
<a name="l00966"></a>00966             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a8f3ab6c1b3ebb9db965b8cc788b0dab4">outerAttrs</a> = <a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123">bits</a>(texcb, 3, 2);
<a name="l00967"></a>00967             <span class="keywordflow">break</span>;
<a name="l00968"></a>00968           <span class="keywordflow">default</span>:
<a name="l00969"></a>00969             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;More than 32 states for 5 bits?\n&quot;</span>);
<a name="l00970"></a>00970         }
<a name="l00971"></a>00971     } <span class="keywordflow">else</span> {
<a name="l00972"></a>00972         assert(tc);
<a name="l00973"></a>00973         PRRR prrr = tc-&gt;<a class="code" href="classThreadContext.html#a6888f4bff21e34892e59654ea80073b2">readMiscReg</a>(<a class="code" href="namespaceArmISA.html#a939d9e820fe2a05cb16413fe88dc1887">flattenMiscRegNsBanked</a>(<a class="code" href="namespaceArmISA.html#a1e522017e015d4c7efd6b2360143aa67a2dd4330c32e639766e4084a25bed61fd">MISCREG_PRRR</a>,
<a name="l00974"></a>00974                                     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>, !<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a62bc84f4251f16cf0cfa0f8d96e00c37">isSecure</a>));
<a name="l00975"></a>00975         NMRR nmrr = tc-&gt;<a class="code" href="classThreadContext.html#a6888f4bff21e34892e59654ea80073b2">readMiscReg</a>(<a class="code" href="namespaceArmISA.html#a939d9e820fe2a05cb16413fe88dc1887">flattenMiscRegNsBanked</a>(<a class="code" href="namespaceArmISA.html#a1e522017e015d4c7efd6b2360143aa67a6fb4be4fd646a683f615c3bb4925fc01">MISCREG_NMRR</a>,
<a name="l00976"></a>00976                                     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>, !<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a62bc84f4251f16cf0cfa0f8d96e00c37">isSecure</a>));
<a name="l00977"></a>00977         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(TLBVerbose, <span class="stringliteral">&quot;memAttrs PRRR:%08x NMRR:%08x\n&quot;</span>, prrr, nmrr);
<a name="l00978"></a>00978         uint8_t curr_tr = 0, curr_ir = 0, curr_or = 0;
<a name="l00979"></a>00979         <span class="keywordflow">switch</span>(<a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123">bits</a>(texcb, 2,0)) {
<a name="l00980"></a>00980           <span class="keywordflow">case</span> 0:
<a name="l00981"></a>00981             curr_tr = prrr.tr0;
<a name="l00982"></a>00982             curr_ir = nmrr.ir0;
<a name="l00983"></a>00983             curr_or = nmrr.or0;
<a name="l00984"></a>00984             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a6ad80a1d32b73f10c744decc24ca7cd5">outerShareable</a> = (prrr.nos0 == 0);
<a name="l00985"></a>00985             <span class="keywordflow">break</span>;
<a name="l00986"></a>00986           <span class="keywordflow">case</span> 1:
<a name="l00987"></a>00987             curr_tr = prrr.tr1;
<a name="l00988"></a>00988             curr_ir = nmrr.ir1;
<a name="l00989"></a>00989             curr_or = nmrr.or1;
<a name="l00990"></a>00990             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a6ad80a1d32b73f10c744decc24ca7cd5">outerShareable</a> = (prrr.nos1 == 0);
<a name="l00991"></a>00991             <span class="keywordflow">break</span>;
<a name="l00992"></a>00992           <span class="keywordflow">case</span> 2:
<a name="l00993"></a>00993             curr_tr = prrr.tr2;
<a name="l00994"></a>00994             curr_ir = nmrr.ir2;
<a name="l00995"></a>00995             curr_or = nmrr.or2;
<a name="l00996"></a>00996             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a6ad80a1d32b73f10c744decc24ca7cd5">outerShareable</a> = (prrr.nos2 == 0);
<a name="l00997"></a>00997             <span class="keywordflow">break</span>;
<a name="l00998"></a>00998           <span class="keywordflow">case</span> 3:
<a name="l00999"></a>00999             curr_tr = prrr.tr3;
<a name="l01000"></a>01000             curr_ir = nmrr.ir3;
<a name="l01001"></a>01001             curr_or = nmrr.or3;
<a name="l01002"></a>01002             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a6ad80a1d32b73f10c744decc24ca7cd5">outerShareable</a> = (prrr.nos3 == 0);
<a name="l01003"></a>01003             <span class="keywordflow">break</span>;
<a name="l01004"></a>01004           <span class="keywordflow">case</span> 4:
<a name="l01005"></a>01005             curr_tr = prrr.tr4;
<a name="l01006"></a>01006             curr_ir = nmrr.ir4;
<a name="l01007"></a>01007             curr_or = nmrr.or4;
<a name="l01008"></a>01008             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a6ad80a1d32b73f10c744decc24ca7cd5">outerShareable</a> = (prrr.nos4 == 0);
<a name="l01009"></a>01009             <span class="keywordflow">break</span>;
<a name="l01010"></a>01010           <span class="keywordflow">case</span> 5:
<a name="l01011"></a>01011             curr_tr = prrr.tr5;
<a name="l01012"></a>01012             curr_ir = nmrr.ir5;
<a name="l01013"></a>01013             curr_or = nmrr.or5;
<a name="l01014"></a>01014             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a6ad80a1d32b73f10c744decc24ca7cd5">outerShareable</a> = (prrr.nos5 == 0);
<a name="l01015"></a>01015             <span class="keywordflow">break</span>;
<a name="l01016"></a>01016           <span class="keywordflow">case</span> 6:
<a name="l01017"></a>01017             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Imp defined type\n&quot;</span>);
<a name="l01018"></a>01018           <span class="keywordflow">case</span> 7:
<a name="l01019"></a>01019             curr_tr = prrr.tr7;
<a name="l01020"></a>01020             curr_ir = nmrr.ir7;
<a name="l01021"></a>01021             curr_or = nmrr.or7;
<a name="l01022"></a>01022             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a6ad80a1d32b73f10c744decc24ca7cd5">outerShareable</a> = (prrr.nos7 == 0);
<a name="l01023"></a>01023             <span class="keywordflow">break</span>;
<a name="l01024"></a>01024         }
<a name="l01025"></a>01025 
<a name="l01026"></a>01026         <span class="keywordflow">switch</span>(curr_tr) {
<a name="l01027"></a>01027           <span class="keywordflow">case</span> 0:
<a name="l01028"></a>01028             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(TLBVerbose, <span class="stringliteral">&quot;StronglyOrdered\n&quot;</span>);
<a name="l01029"></a>01029             te.<a class="code" href="structArmISA_1_1TlbEntry.html#adf9797b2466c7c1b82e0b738b75d8fab">mtype</a> = TlbEntry::MemoryType::StronglyOrdered;
<a name="l01030"></a>01030             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a4f3ea4eb06b83de0e16cc771374db506">nonCacheable</a> = <span class="keyword">true</span>;
<a name="l01031"></a>01031             te.<a class="code" href="structArmISA_1_1TlbEntry.html#acf1e099a3b1f79dcf9db2007bdfd4c51">innerAttrs</a> = 1;
<a name="l01032"></a>01032             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a8f3ab6c1b3ebb9db965b8cc788b0dab4">outerAttrs</a> = 0;
<a name="l01033"></a>01033             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a8595b2218cf2d99d0987a204f511f3f2">shareable</a> = <span class="keyword">true</span>;
<a name="l01034"></a>01034             <span class="keywordflow">break</span>;
<a name="l01035"></a>01035           <span class="keywordflow">case</span> 1:
<a name="l01036"></a>01036             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(TLBVerbose, <span class="stringliteral">&quot;Device ds1:%d ds0:%d s:%d\n&quot;</span>,
<a name="l01037"></a>01037                     prrr.ds1, prrr.ds0, <a class="code" href="namespaceArmISA.html#afaeb18e17f862d8fcb76dfb68a18854f">s</a>);
<a name="l01038"></a>01038             te.<a class="code" href="structArmISA_1_1TlbEntry.html#adf9797b2466c7c1b82e0b738b75d8fab">mtype</a> = TlbEntry::MemoryType::Device;
<a name="l01039"></a>01039             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a4f3ea4eb06b83de0e16cc771374db506">nonCacheable</a> = <span class="keyword">true</span>;
<a name="l01040"></a>01040             te.<a class="code" href="structArmISA_1_1TlbEntry.html#acf1e099a3b1f79dcf9db2007bdfd4c51">innerAttrs</a> = 3;
<a name="l01041"></a>01041             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a8f3ab6c1b3ebb9db965b8cc788b0dab4">outerAttrs</a> = 0;
<a name="l01042"></a>01042             <span class="keywordflow">if</span> (prrr.ds1 &amp;&amp; <a class="code" href="namespaceArmISA.html#afaeb18e17f862d8fcb76dfb68a18854f">s</a>)
<a name="l01043"></a>01043                 te.<a class="code" href="structArmISA_1_1TlbEntry.html#a8595b2218cf2d99d0987a204f511f3f2">shareable</a> = <span class="keyword">true</span>;
<a name="l01044"></a>01044             <span class="keywordflow">if</span> (prrr.ds0 &amp;&amp; !<a class="code" href="namespaceArmISA.html#afaeb18e17f862d8fcb76dfb68a18854f">s</a>)
<a name="l01045"></a>01045                 te.<a class="code" href="structArmISA_1_1TlbEntry.html#a8595b2218cf2d99d0987a204f511f3f2">shareable</a> = <span class="keyword">true</span>;
<a name="l01046"></a>01046             <span class="keywordflow">break</span>;
<a name="l01047"></a>01047           <span class="keywordflow">case</span> 2:
<a name="l01048"></a>01048             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(TLBVerbose, <span class="stringliteral">&quot;Normal ns1:%d ns0:%d s:%d\n&quot;</span>,
<a name="l01049"></a>01049                     prrr.ns1, prrr.ns0, <a class="code" href="namespaceArmISA.html#afaeb18e17f862d8fcb76dfb68a18854f">s</a>);
<a name="l01050"></a>01050             te.<a class="code" href="structArmISA_1_1TlbEntry.html#adf9797b2466c7c1b82e0b738b75d8fab">mtype</a> = TlbEntry::MemoryType::Normal;
<a name="l01051"></a>01051             <span class="keywordflow">if</span> (prrr.ns1 &amp;&amp; <a class="code" href="namespaceArmISA.html#afaeb18e17f862d8fcb76dfb68a18854f">s</a>)
<a name="l01052"></a>01052                 te.<a class="code" href="structArmISA_1_1TlbEntry.html#a8595b2218cf2d99d0987a204f511f3f2">shareable</a> = <span class="keyword">true</span>;
<a name="l01053"></a>01053             <span class="keywordflow">if</span> (prrr.ns0 &amp;&amp; !<a class="code" href="namespaceArmISA.html#afaeb18e17f862d8fcb76dfb68a18854f">s</a>)
<a name="l01054"></a>01054                 te.<a class="code" href="structArmISA_1_1TlbEntry.html#a8595b2218cf2d99d0987a204f511f3f2">shareable</a> = <span class="keyword">true</span>;
<a name="l01055"></a>01055             <span class="keywordflow">break</span>;
<a name="l01056"></a>01056           <span class="keywordflow">case</span> 3:
<a name="l01057"></a>01057             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Reserved type&quot;</span>);
<a name="l01058"></a>01058         }
<a name="l01059"></a>01059 
<a name="l01060"></a>01060         <span class="keywordflow">if</span> (te.<a class="code" href="structArmISA_1_1TlbEntry.html#adf9797b2466c7c1b82e0b738b75d8fab">mtype</a> == TlbEntry::MemoryType::Normal){
<a name="l01061"></a>01061             <span class="keywordflow">switch</span>(curr_ir) {
<a name="l01062"></a>01062               <span class="keywordflow">case</span> 0:
<a name="l01063"></a>01063                 te.<a class="code" href="structArmISA_1_1TlbEntry.html#a4f3ea4eb06b83de0e16cc771374db506">nonCacheable</a> = <span class="keyword">true</span>;
<a name="l01064"></a>01064                 te.<a class="code" href="structArmISA_1_1TlbEntry.html#acf1e099a3b1f79dcf9db2007bdfd4c51">innerAttrs</a> = 0;
<a name="l01065"></a>01065                 <span class="keywordflow">break</span>;
<a name="l01066"></a>01066               <span class="keywordflow">case</span> 1:
<a name="l01067"></a>01067                 te.<a class="code" href="structArmISA_1_1TlbEntry.html#acf1e099a3b1f79dcf9db2007bdfd4c51">innerAttrs</a> = 5;
<a name="l01068"></a>01068                 <span class="keywordflow">break</span>;
<a name="l01069"></a>01069               <span class="keywordflow">case</span> 2:
<a name="l01070"></a>01070                 te.<a class="code" href="structArmISA_1_1TlbEntry.html#acf1e099a3b1f79dcf9db2007bdfd4c51">innerAttrs</a> = 6;
<a name="l01071"></a>01071                 <span class="keywordflow">break</span>;
<a name="l01072"></a>01072               <span class="keywordflow">case</span> 3:
<a name="l01073"></a>01073                 te.<a class="code" href="structArmISA_1_1TlbEntry.html#acf1e099a3b1f79dcf9db2007bdfd4c51">innerAttrs</a> = 7;
<a name="l01074"></a>01074                 <span class="keywordflow">break</span>;
<a name="l01075"></a>01075             }
<a name="l01076"></a>01076 
<a name="l01077"></a>01077             <span class="keywordflow">switch</span>(curr_or) {
<a name="l01078"></a>01078               <span class="keywordflow">case</span> 0:
<a name="l01079"></a>01079                 te.<a class="code" href="structArmISA_1_1TlbEntry.html#a4f3ea4eb06b83de0e16cc771374db506">nonCacheable</a> = <span class="keyword">true</span>;
<a name="l01080"></a>01080                 te.<a class="code" href="structArmISA_1_1TlbEntry.html#a8f3ab6c1b3ebb9db965b8cc788b0dab4">outerAttrs</a> = 0;
<a name="l01081"></a>01081                 <span class="keywordflow">break</span>;
<a name="l01082"></a>01082               <span class="keywordflow">case</span> 1:
<a name="l01083"></a>01083                 te.<a class="code" href="structArmISA_1_1TlbEntry.html#a8f3ab6c1b3ebb9db965b8cc788b0dab4">outerAttrs</a> = 1;
<a name="l01084"></a>01084                 <span class="keywordflow">break</span>;
<a name="l01085"></a>01085               <span class="keywordflow">case</span> 2:
<a name="l01086"></a>01086                 te.<a class="code" href="structArmISA_1_1TlbEntry.html#a8f3ab6c1b3ebb9db965b8cc788b0dab4">outerAttrs</a> = 2;
<a name="l01087"></a>01087                 <span class="keywordflow">break</span>;
<a name="l01088"></a>01088               <span class="keywordflow">case</span> 3:
<a name="l01089"></a>01089                 te.<a class="code" href="structArmISA_1_1TlbEntry.html#a8f3ab6c1b3ebb9db965b8cc788b0dab4">outerAttrs</a> = 3;
<a name="l01090"></a>01090                 <span class="keywordflow">break</span>;
<a name="l01091"></a>01091             }
<a name="l01092"></a>01092         }
<a name="l01093"></a>01093     }
<a name="l01094"></a>01094     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(TLBVerbose, <span class="stringliteral">&quot;memAttrs: shareable: %d, innerAttrs: %d, \</span>
<a name="l01095"></a>01095 <span class="stringliteral">            outerAttrs: %d\n&quot;</span>,
<a name="l01096"></a>01096             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a8595b2218cf2d99d0987a204f511f3f2">shareable</a>, te.<a class="code" href="structArmISA_1_1TlbEntry.html#acf1e099a3b1f79dcf9db2007bdfd4c51">innerAttrs</a>, te.<a class="code" href="structArmISA_1_1TlbEntry.html#a8f3ab6c1b3ebb9db965b8cc788b0dab4">outerAttrs</a>);
<a name="l01097"></a>01097     te.<a class="code" href="structArmISA_1_1TlbEntry.html#ad4a13c759d4108dc9d0914a81b8d6703">setAttributes</a>(<span class="keyword">false</span>);
<a name="l01098"></a>01098 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae90661ceebb345173d8a0e9306fa9a82"></a><!-- doxytag: member="ArmISA::TableWalker::memAttrsAArch64" ref="ae90661ceebb345173d8a0e9306fa9a82" args="(ThreadContext *tc, TlbEntry &amp;te, uint8_t attrIndx, uint8_t sh)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void memAttrsAArch64 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classThreadContext.html">ThreadContext</a> *&nbsp;</td>
          <td class="paramname"> <em>tc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structArmISA_1_1TlbEntry.html">TlbEntry</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>te</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&nbsp;</td>
          <td class="paramname"> <em>attrIndx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&nbsp;</td>
          <td class="paramname"> <em>sh</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l01228"></a>01228 {
<a name="l01229"></a>01229     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(TLBVerbose, <span class="stringliteral">&quot;memAttrsAArch64 AttrIndx:%#x sh:%#x\n&quot;</span>, attrIndx, <a class="code" href="namespaceArmISA.html#ae375ae4bca8c4da631387855d380343d">sh</a>);
<a name="l01230"></a>01230 
<a name="l01231"></a>01231     <span class="comment">// Select MAIR</span>
<a name="l01232"></a>01232     uint64_t mair;
<a name="l01233"></a>01233     <span class="keywordflow">switch</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a878510cdbf1a6438f83754acbdbf759a">el</a>) {
<a name="l01234"></a>01234       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a16588a7a92eb985c3341b7f706c81dd5a1808d294e1d965cd8d1a3060e2f411ef">EL0</a>:
<a name="l01235"></a>01235       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a16588a7a92eb985c3341b7f706c81dd5ab5e42aaf40f117fdce042d02976bf090">EL1</a>:
<a name="l01236"></a>01236         mair = tc-&gt;<a class="code" href="classThreadContext.html#a6888f4bff21e34892e59654ea80073b2">readMiscReg</a>(<a class="code" href="namespaceArmISA.html#a1e522017e015d4c7efd6b2360143aa67a481297878540cc92dd8ded5b2238f0a8">MISCREG_MAIR_EL1</a>);
<a name="l01237"></a>01237         <span class="keywordflow">break</span>;
<a name="l01238"></a>01238       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a16588a7a92eb985c3341b7f706c81dd5a5f6f6ced63893d592951c91f7489857f">EL2</a>:
<a name="l01239"></a>01239         mair = tc-&gt;<a class="code" href="classThreadContext.html#a6888f4bff21e34892e59654ea80073b2">readMiscReg</a>(<a class="code" href="namespaceArmISA.html#a1e522017e015d4c7efd6b2360143aa67a252ff3d354e316055486d3ac950e5b9a">MISCREG_MAIR_EL2</a>);
<a name="l01240"></a>01240         <span class="keywordflow">break</span>;
<a name="l01241"></a>01241       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a16588a7a92eb985c3341b7f706c81dd5a44bf3e9d5387a706bdc96b1ec9a2fc15">EL3</a>:
<a name="l01242"></a>01242         mair = tc-&gt;<a class="code" href="classThreadContext.html#a6888f4bff21e34892e59654ea80073b2">readMiscReg</a>(<a class="code" href="namespaceArmISA.html#a1e522017e015d4c7efd6b2360143aa67a43927a2ecf2263caec94922abe2c147a">MISCREG_MAIR_EL3</a>);
<a name="l01243"></a>01243         <span class="keywordflow">break</span>;
<a name="l01244"></a>01244       <span class="keywordflow">default</span>:
<a name="l01245"></a>01245         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Invalid exception level&quot;</span>);
<a name="l01246"></a>01246         <span class="keywordflow">break</span>;
<a name="l01247"></a>01247     }
<a name="l01248"></a>01248 
<a name="l01249"></a>01249     <span class="comment">// Select attributes</span>
<a name="l01250"></a>01250     uint8_t <a class="code" href="namespaceArmISA.html#a710acfac10f0042826d2d6d9c213ae7b">attr</a> = <a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123">bits</a>(mair, 8 * attrIndx + 7, 8 * attrIndx);
<a name="l01251"></a>01251     uint8_t attr_lo = <a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123">bits</a>(attr, 3, 0);
<a name="l01252"></a>01252     uint8_t attr_hi = <a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123">bits</a>(attr, 7, 4);
<a name="l01253"></a>01253 
<a name="l01254"></a>01254     <span class="comment">// Memory type</span>
<a name="l01255"></a>01255     te.<a class="code" href="structArmISA_1_1TlbEntry.html#adf9797b2466c7c1b82e0b738b75d8fab">mtype</a> = attr_hi == 0 ? TlbEntry::MemoryType::Device : TlbEntry::MemoryType::Normal;
<a name="l01256"></a>01256 
<a name="l01257"></a>01257     <span class="comment">// Cacheability</span>
<a name="l01258"></a>01258     te.<a class="code" href="structArmISA_1_1TlbEntry.html#a4f3ea4eb06b83de0e16cc771374db506">nonCacheable</a> = <span class="keyword">false</span>;
<a name="l01259"></a>01259     <span class="keywordflow">if</span> (te.<a class="code" href="structArmISA_1_1TlbEntry.html#adf9797b2466c7c1b82e0b738b75d8fab">mtype</a> == TlbEntry::MemoryType::Device ||  <span class="comment">// Device memory</span>
<a name="l01260"></a>01260         attr_hi == 0x8 ||  <span class="comment">// Normal memory, Outer Non-cacheable</span>
<a name="l01261"></a>01261         attr_lo == 0x8) {  <span class="comment">// Normal memory, Inner Non-cacheable</span>
<a name="l01262"></a>01262         te.<a class="code" href="structArmISA_1_1TlbEntry.html#a4f3ea4eb06b83de0e16cc771374db506">nonCacheable</a> = <span class="keyword">true</span>;
<a name="l01263"></a>01263     }
<a name="l01264"></a>01264 
<a name="l01265"></a>01265     te.<a class="code" href="structArmISA_1_1TlbEntry.html#a8595b2218cf2d99d0987a204f511f3f2">shareable</a>       = <a class="code" href="namespaceArmISA.html#ae375ae4bca8c4da631387855d380343d">sh</a> == 2;
<a name="l01266"></a>01266     te.<a class="code" href="structArmISA_1_1TlbEntry.html#a6ad80a1d32b73f10c744decc24ca7cd5">outerShareable</a> = (<a class="code" href="namespaceArmISA.html#ae375ae4bca8c4da631387855d380343d">sh</a> &amp; 0x2) ? <span class="keyword">true</span> : <span class="keyword">false</span>;
<a name="l01267"></a>01267     <span class="comment">// Attributes formatted according to the 64-bit PAR</span>
<a name="l01268"></a>01268     te.<a class="code" href="structArmISA_1_1TlbEntry.html#af2477a97f3d64421167ca09818993a8d">attributes</a> = ((uint64_t) attr &lt;&lt; 56) |
<a name="l01269"></a>01269         (1 &lt;&lt; 11) |     <span class="comment">// LPAE bit</span>
<a name="l01270"></a>01270         (te.<a class="code" href="structArmISA_1_1TlbEntry.html#aa3ca0c504f321d3657985faf35740bbe">ns</a> &lt;&lt; 9) |  <span class="comment">// NS bit</span>
<a name="l01271"></a>01271         (<a class="code" href="namespaceArmISA.html#ae375ae4bca8c4da631387855d380343d">sh</a> &lt;&lt; 7);
<a name="l01272"></a>01272 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae00bd2d40b63721817ec582dbf4022a5"></a><!-- doxytag: member="ArmISA::TableWalker::memAttrsLPAE" ref="ae00bd2d40b63721817ec582dbf4022a5" args="(ThreadContext *tc, TlbEntry &amp;te, LongDescriptor &amp;lDescriptor)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void memAttrsLPAE </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classThreadContext.html">ThreadContext</a> *&nbsp;</td>
          <td class="paramname"> <em>tc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structArmISA_1_1TlbEntry.html">TlbEntry</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>te</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classArmISA_1_1TableWalker_1_1LongDescriptor.html">LongDescriptor</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>lDescriptor</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l01103"></a>01103 {
<a name="l01104"></a>01104     assert(<a class="code" href="classArmISA_1_1TableWalker.html#a74ac6c840c516a9b8a6eb63ed9ef1185">_haveLPAE</a>);
<a name="l01105"></a>01105 
<a name="l01106"></a>01106     uint8_t <a class="code" href="namespaceArmISA.html#a710acfac10f0042826d2d6d9c213ae7b">attr</a>;
<a name="l01107"></a>01107     uint8_t <a class="code" href="namespaceArmISA.html#ae375ae4bca8c4da631387855d380343d">sh</a> = lDescriptor.sh();
<a name="l01108"></a>01108     <span class="comment">// Different format and source of attributes if this is a stage 2</span>
<a name="l01109"></a>01109     <span class="comment">// translation</span>
<a name="l01110"></a>01110     <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a475f8007920fb01f7f8aa1730b3016bb">isStage2</a>) {
<a name="l01111"></a>01111         attr = lDescriptor.memAttr();
<a name="l01112"></a>01112         uint8_t attr_3_2 = (attr &gt;&gt; 2) &amp; 0x3;
<a name="l01113"></a>01113         uint8_t attr_1_0 =  attr       &amp; 0x3;
<a name="l01114"></a>01114 
<a name="l01115"></a>01115         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(TLBVerbose, <span class="stringliteral">&quot;memAttrsLPAE MemAttr:%#x sh:%#x\n&quot;</span>, attr, sh);
<a name="l01116"></a>01116 
<a name="l01117"></a>01117         <span class="keywordflow">if</span> (attr_3_2 == 0) {
<a name="l01118"></a>01118             te.<a class="code" href="structArmISA_1_1TlbEntry.html#adf9797b2466c7c1b82e0b738b75d8fab">mtype</a>        = attr_1_0 == 0 ? TlbEntry::MemoryType::StronglyOrdered
<a name="l01119"></a>01119                                             : TlbEntry::MemoryType::Device;
<a name="l01120"></a>01120             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a8f3ab6c1b3ebb9db965b8cc788b0dab4">outerAttrs</a>   = 0;
<a name="l01121"></a>01121             te.<a class="code" href="structArmISA_1_1TlbEntry.html#acf1e099a3b1f79dcf9db2007bdfd4c51">innerAttrs</a>   = attr_1_0 == 0 ? 1 : 3;
<a name="l01122"></a>01122             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a4f3ea4eb06b83de0e16cc771374db506">nonCacheable</a> = <span class="keyword">true</span>;
<a name="l01123"></a>01123         } <span class="keywordflow">else</span> {
<a name="l01124"></a>01124             te.<a class="code" href="structArmISA_1_1TlbEntry.html#adf9797b2466c7c1b82e0b738b75d8fab">mtype</a>        = TlbEntry::MemoryType::Normal;
<a name="l01125"></a>01125             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a8f3ab6c1b3ebb9db965b8cc788b0dab4">outerAttrs</a>   = attr_3_2 == 1 ? 0 :
<a name="l01126"></a>01126                               attr_3_2 == 2 ? 2 : 1;
<a name="l01127"></a>01127             te.<a class="code" href="structArmISA_1_1TlbEntry.html#acf1e099a3b1f79dcf9db2007bdfd4c51">innerAttrs</a>   = attr_1_0 == 1 ? 0 :
<a name="l01128"></a>01128                               attr_1_0 == 2 ? 6 : 5;
<a name="l01129"></a>01129             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a4f3ea4eb06b83de0e16cc771374db506">nonCacheable</a> = (attr_3_2 == 1) || (attr_1_0 == 1);
<a name="l01130"></a>01130         }
<a name="l01131"></a>01131     } <span class="keywordflow">else</span> {
<a name="l01132"></a>01132         uint8_t attrIndx = lDescriptor.attrIndx();
<a name="l01133"></a>01133 
<a name="l01134"></a>01134         <span class="comment">// LPAE always uses remapping of memory attributes, irrespective of the</span>
<a name="l01135"></a>01135         <span class="comment">// value of SCTLR.TRE</span>
<a name="l01136"></a>01136         <span class="keywordtype">int</span> <a class="code" href="namespaceX86ISA.html#aeeb02ad833ab76f3430553ef93213a6b">reg</a> = attrIndx &amp; 0x4 ? <a class="code" href="namespaceArmISA.html#a1e522017e015d4c7efd6b2360143aa67aca7760d3a79feaa4118b9698bf5365a3">MISCREG_MAIR1</a> : <a class="code" href="namespaceArmISA.html#a1e522017e015d4c7efd6b2360143aa67a56e98434ad8972b7ea266287f37cb6c6">MISCREG_MAIR0</a>;
<a name="l01137"></a>01137         reg     = <a class="code" href="namespaceArmISA.html#a939d9e820fe2a05cb16413fe88dc1887">flattenMiscRegNsBanked</a>(reg, <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>, !<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a62bc84f4251f16cf0cfa0f8d96e00c37">isSecure</a>);
<a name="l01138"></a>01138         <a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> mair = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>-&gt;<a class="code" href="classThreadContext.html#a6888f4bff21e34892e59654ea80073b2">readMiscReg</a>(reg);
<a name="l01139"></a>01139         attr = (mair &gt;&gt; (8 * (attrIndx % 4))) &amp; 0xff;
<a name="l01140"></a>01140         uint8_t attr_7_4 = <a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123">bits</a>(attr, 7, 4);
<a name="l01141"></a>01141         uint8_t attr_3_0 = <a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123">bits</a>(attr, 3, 0);
<a name="l01142"></a>01142         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(TLBVerbose, <span class="stringliteral">&quot;memAttrsLPAE AttrIndx:%#x sh:%#x, attr %#x\n&quot;</span>, attrIndx, sh, attr);
<a name="l01143"></a>01143 
<a name="l01144"></a>01144         <span class="comment">// Note: the memory subsystem only cares about the &apos;cacheable&apos; memory</span>
<a name="l01145"></a>01145         <span class="comment">// attribute. The other attributes are only used to fill the PAR register</span>
<a name="l01146"></a>01146         <span class="comment">// accordingly to provide the illusion of full support</span>
<a name="l01147"></a>01147         te.<a class="code" href="structArmISA_1_1TlbEntry.html#a4f3ea4eb06b83de0e16cc771374db506">nonCacheable</a> = <span class="keyword">false</span>;
<a name="l01148"></a>01148 
<a name="l01149"></a>01149         <span class="keywordflow">switch</span> (attr_7_4) {
<a name="l01150"></a>01150           <span class="keywordflow">case</span> 0x0:
<a name="l01151"></a>01151             <span class="comment">// Strongly-ordered or Device memory</span>
<a name="l01152"></a>01152             <span class="keywordflow">if</span> (attr_3_0 == 0x0)
<a name="l01153"></a>01153                 te.<a class="code" href="structArmISA_1_1TlbEntry.html#adf9797b2466c7c1b82e0b738b75d8fab">mtype</a> = TlbEntry::MemoryType::StronglyOrdered;
<a name="l01154"></a>01154             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (attr_3_0 == 0x4)
<a name="l01155"></a>01155                 te.<a class="code" href="structArmISA_1_1TlbEntry.html#adf9797b2466c7c1b82e0b738b75d8fab">mtype</a> = TlbEntry::MemoryType::Device;
<a name="l01156"></a>01156             <span class="keywordflow">else</span>
<a name="l01157"></a>01157                 <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Unpredictable behavior\n&quot;</span>);
<a name="l01158"></a>01158             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a4f3ea4eb06b83de0e16cc771374db506">nonCacheable</a> = <span class="keyword">true</span>;
<a name="l01159"></a>01159             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a8f3ab6c1b3ebb9db965b8cc788b0dab4">outerAttrs</a>   = 0;
<a name="l01160"></a>01160             <span class="keywordflow">break</span>;
<a name="l01161"></a>01161           <span class="keywordflow">case</span> 0x4:
<a name="l01162"></a>01162             <span class="comment">// Normal memory, Outer Non-cacheable</span>
<a name="l01163"></a>01163             te.<a class="code" href="structArmISA_1_1TlbEntry.html#adf9797b2466c7c1b82e0b738b75d8fab">mtype</a> = TlbEntry::MemoryType::Normal;
<a name="l01164"></a>01164             te.<a class="code" href="structArmISA_1_1TlbEntry.html#a8f3ab6c1b3ebb9db965b8cc788b0dab4">outerAttrs</a> = 0;
<a name="l01165"></a>01165             <span class="keywordflow">if</span> (attr_3_0 == 0x4)
<a name="l01166"></a>01166                 <span class="comment">// Inner Non-cacheable</span>
<a name="l01167"></a>01167                 te.<a class="code" href="structArmISA_1_1TlbEntry.html#a4f3ea4eb06b83de0e16cc771374db506">nonCacheable</a> = <span class="keyword">true</span>;
<a name="l01168"></a>01168             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (attr_3_0 &lt; 0x8)
<a name="l01169"></a>01169                 <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Unpredictable behavior\n&quot;</span>);
<a name="l01170"></a>01170             <span class="keywordflow">break</span>;
<a name="l01171"></a>01171           <span class="keywordflow">case</span> 0x8:
<a name="l01172"></a>01172           <span class="keywordflow">case</span> 0x9:
<a name="l01173"></a>01173           <span class="keywordflow">case</span> 0xa:
<a name="l01174"></a>01174           <span class="keywordflow">case</span> 0xb:
<a name="l01175"></a>01175           <span class="keywordflow">case</span> 0xc:
<a name="l01176"></a>01176           <span class="keywordflow">case</span> 0xd:
<a name="l01177"></a>01177           <span class="keywordflow">case</span> 0xe:
<a name="l01178"></a>01178           <span class="keywordflow">case</span> 0xf:
<a name="l01179"></a>01179             <span class="keywordflow">if</span> (attr_7_4 &amp; 0x4) {
<a name="l01180"></a>01180                 te.<a class="code" href="structArmISA_1_1TlbEntry.html#a8f3ab6c1b3ebb9db965b8cc788b0dab4">outerAttrs</a> = (attr_7_4 &amp; 1) ? 1 : 3;
<a name="l01181"></a>01181             } <span class="keywordflow">else</span> {
<a name="l01182"></a>01182                 te.<a class="code" href="structArmISA_1_1TlbEntry.html#a8f3ab6c1b3ebb9db965b8cc788b0dab4">outerAttrs</a> = 0x2;
<a name="l01183"></a>01183             }
<a name="l01184"></a>01184             <span class="comment">// Normal memory, Outer Cacheable</span>
<a name="l01185"></a>01185             te.<a class="code" href="structArmISA_1_1TlbEntry.html#adf9797b2466c7c1b82e0b738b75d8fab">mtype</a> = TlbEntry::MemoryType::Normal;
<a name="l01186"></a>01186             <span class="keywordflow">if</span> (attr_3_0 != 0x4 &amp;&amp; attr_3_0 &lt; 0x8)
<a name="l01187"></a>01187                 <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Unpredictable behavior\n&quot;</span>);
<a name="l01188"></a>01188             <span class="keywordflow">break</span>;
<a name="l01189"></a>01189           <span class="keywordflow">default</span>:
<a name="l01190"></a>01190             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Unpredictable behavior\n&quot;</span>);
<a name="l01191"></a>01191             <span class="keywordflow">break</span>;
<a name="l01192"></a>01192         }
<a name="l01193"></a>01193 
<a name="l01194"></a>01194         <span class="keywordflow">switch</span> (attr_3_0) {
<a name="l01195"></a>01195           <span class="keywordflow">case</span> 0x0:
<a name="l01196"></a>01196             te.<a class="code" href="structArmISA_1_1TlbEntry.html#acf1e099a3b1f79dcf9db2007bdfd4c51">innerAttrs</a> = 0x1;
<a name="l01197"></a>01197             <span class="keywordflow">break</span>;
<a name="l01198"></a>01198           <span class="keywordflow">case</span> 0x4:
<a name="l01199"></a>01199             te.<a class="code" href="structArmISA_1_1TlbEntry.html#acf1e099a3b1f79dcf9db2007bdfd4c51">innerAttrs</a> = attr_7_4 == 0 ? 0x3 : 0;
<a name="l01200"></a>01200             <span class="keywordflow">break</span>;
<a name="l01201"></a>01201           <span class="keywordflow">case</span> 0x8:
<a name="l01202"></a>01202           <span class="keywordflow">case</span> 0x9:
<a name="l01203"></a>01203           <span class="keywordflow">case</span> 0xA:
<a name="l01204"></a>01204           <span class="keywordflow">case</span> 0xB:
<a name="l01205"></a>01205             te.<a class="code" href="structArmISA_1_1TlbEntry.html#acf1e099a3b1f79dcf9db2007bdfd4c51">innerAttrs</a> = 6;
<a name="l01206"></a>01206             <span class="keywordflow">break</span>;
<a name="l01207"></a>01207           <span class="keywordflow">case</span> 0xC:
<a name="l01208"></a>01208           <span class="keywordflow">case</span> 0xD:
<a name="l01209"></a>01209           <span class="keywordflow">case</span> 0xE:
<a name="l01210"></a>01210           <span class="keywordflow">case</span> 0xF:
<a name="l01211"></a>01211             te.<a class="code" href="structArmISA_1_1TlbEntry.html#acf1e099a3b1f79dcf9db2007bdfd4c51">innerAttrs</a> = attr_3_0 &amp; 1 ? 0x5 : 0x7;
<a name="l01212"></a>01212             <span class="keywordflow">break</span>;
<a name="l01213"></a>01213           <span class="keywordflow">default</span>:
<a name="l01214"></a>01214             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Unpredictable behavior\n&quot;</span>);
<a name="l01215"></a>01215             <span class="keywordflow">break</span>;
<a name="l01216"></a>01216         }
<a name="l01217"></a>01217     }
<a name="l01218"></a>01218 
<a name="l01219"></a>01219     te.<a class="code" href="structArmISA_1_1TlbEntry.html#a6ad80a1d32b73f10c744decc24ca7cd5">outerShareable</a> = sh == 2;
<a name="l01220"></a>01220     te.<a class="code" href="structArmISA_1_1TlbEntry.html#a8595b2218cf2d99d0987a204f511f3f2">shareable</a>       = (sh &amp; 0x2) ? <span class="keyword">true</span> : <span class="keyword">false</span>;
<a name="l01221"></a>01221     te.<a class="code" href="structArmISA_1_1TlbEntry.html#ad4a13c759d4108dc9d0914a81b8d6703">setAttributes</a>(<span class="keyword">true</span>);
<a name="l01222"></a>01222     te.<a class="code" href="structArmISA_1_1TlbEntry.html#af2477a97f3d64421167ca09818993a8d">attributes</a> |= (uint64_t) attr &lt;&lt; 56;
<a name="l01223"></a>01223 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae126e9ab023c3e4659836daa8f5364be"></a><!-- doxytag: member="ArmISA::TableWalker::nextWalk" ref="ae126e9ab023c3e4659836daa8f5364be" args="(ThreadContext *tc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void nextWalk </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classThreadContext.html">ThreadContext</a> *&nbsp;</td>
          <td class="paramname"> <em>tc</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l01798"></a>01798 {
<a name="l01799"></a>01799     <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a53a70edbb255426f7f2729f482c7109b">pendingQueue</a>.size())
<a name="l01800"></a>01800         <a class="code" href="classEventManager.html#a4ddebbfe9a12b95be6fb993ce892dcd3">schedule</a>(<a class="code" href="classArmISA_1_1TableWalker.html#ac0fab25a73916f1bf677990e67557b5a">doProcessEvent</a>, <a class="code" href="classClockedObject.html#a773956693f216cafb7d4cad92ad582e5">clockEdge</a>(<a class="code" href="classm5_1_1params_1_1Cycles.html">Cycles</a>(1)));
<a name="l01801"></a>01801 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="acd3c3feb78ae7a8f88fe0f110a718dff"></a><!-- doxytag: member="ArmISA::TableWalker::params" ref="acd3c3feb78ae7a8f88fe0f110a718dff" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="classArmISA_1_1TableWalker.html#a422d0236f689cd69d42b3163a521ea15">Params</a>* params </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><a class="el" href="classMemObject.html#acd3c3feb78ae7a8f88fe0f110a718dff">MemObject</a>を再定義しています。</p>

<p><div class="fragment"><pre class="fragment"><a name="l00871"></a>00871     {
<a name="l00872"></a>00872         <span class="keywordflow">return</span> <span class="keyword">dynamic_cast&lt;</span><span class="keyword">const </span><a class="code" href="classArmISA_1_1TableWalker.html#a422d0236f689cd69d42b3163a521ea15">Params</a> *<span class="keyword">&gt;</span>(<a class="code" href="classSimObject.html#acaf6024ae9dda44bfb1c67e05ad70aef">_params</a>);
<a name="l00873"></a>00873     }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a13d6e703bfb2074a12535d21689a16d5"></a><!-- doxytag: member="ArmISA::TableWalker::processWalk" ref="a13d6e703bfb2074a12535d21689a16d5" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classRefCountingPtr.html">Fault</a> processWalk </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00393"></a>00393 {
<a name="l00394"></a>00394     <a class="code" href="classm5_1_1params_1_1Addr.html">Addr</a> ttbr = 0;
<a name="l00395"></a>00395 
<a name="l00396"></a>00396     <span class="comment">// If translation isn&apos;t enabled, we shouldn&apos;t be here</span>
<a name="l00397"></a>00397     assert(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a43c4d132ca97c6cc5358f7be3c2b5a69">sctlr</a>.m || <a class="code" href="classArmISA_1_1TableWalker.html#a475f8007920fb01f7f8aa1730b3016bb">isStage2</a>);
<a name="l00398"></a>00398 
<a name="l00399"></a>00399     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classArmISA_1_1TLB.html">TLB</a>, <span class="stringliteral">&quot;Beginning table walk for address %#x, TTBCR: %#x, bits:%#x\n&quot;</span>,
<a name="l00400"></a>00400             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a1ebff4da206a1799d70b4ec129c33c5a">vaddr_tainted</a>, <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ad6762be565087b4bfb87f5bcb42673e7">ttbcr</a>, <a class="code" href="bitfield_8hh.html#acaa3c424fec3407f14a01fe1ec22c2d4">mbits</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a9f933b300ef63eea367ca82f8da31025">vaddr</a>, 31,
<a name="l00401"></a>00401                                                       32 - <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ad6762be565087b4bfb87f5bcb42673e7">ttbcr</a>.n));
<a name="l00402"></a>00402 
<a name="l00403"></a>00403     <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ad6762be565087b4bfb87f5bcb42673e7">ttbcr</a>.n == 0 || !<a class="code" href="bitfield_8hh.html#acaa3c424fec3407f14a01fe1ec22c2d4">mbits</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a9f933b300ef63eea367ca82f8da31025">vaddr</a>, 31,
<a name="l00404"></a>00404                                           32 - <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ad6762be565087b4bfb87f5bcb42673e7">ttbcr</a>.n)) {
<a name="l00405"></a>00405         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classArmISA_1_1TLB.html">TLB</a>, <span class="stringliteral">&quot; - Selecting TTBR0\n&quot;</span>);
<a name="l00406"></a>00406         <span class="comment">// Check if table walk is allowed when Security Extensions are enabled</span>
<a name="l00407"></a>00407         <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a9f135583566fb70bba3c10395368f2e4">haveSecurity</a> &amp;&amp; <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ad6762be565087b4bfb87f5bcb42673e7">ttbcr</a>.pd0) {
<a name="l00408"></a>00408             <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#aa863dbd5a3e20baa5acb07e373c42ddc">isFetch</a>)
<a name="l00409"></a>00409                 <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classArmISA_1_1PrefetchAbort.html">PrefetchAbort</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a1ebff4da206a1799d70b4ec129c33c5a">vaddr_tainted</a>,
<a name="l00410"></a>00410                                          <a class="code" href="classArmISA_1_1ArmFault.html#a8771a605c5b916759188c3a191bb6202a36a8d822dd25492d60c859de5400455b">ArmFault::TranslationLL</a> + <a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bdae5bc7ee7d6dda5340a28f91834f10543">L1</a>,
<a name="l00411"></a>00411                                          <a class="code" href="classArmISA_1_1TableWalker.html#a475f8007920fb01f7f8aa1730b3016bb">isStage2</a>,
<a name="l00412"></a>00412                                          <a class="code" href="classArmISA_1_1ArmFault.html#ad78237d6390becbe8bdf9e73979c56aeabfef4fbb52d72e0c89f660f2d501a488">ArmFault::VmsaTran</a>);
<a name="l00413"></a>00413             <span class="keywordflow">else</span>
<a name="l00414"></a>00414                 <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classArmISA_1_1DataAbort.html">DataAbort</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a1ebff4da206a1799d70b4ec129c33c5a">vaddr_tainted</a>,
<a name="l00415"></a>00415                         TlbEntry::DomainType::NoAccess, <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a0775ef609f39793da4e2adb3a0e2ded1">isWrite</a>,
<a name="l00416"></a>00416                                      <a class="code" href="classArmISA_1_1ArmFault.html#a8771a605c5b916759188c3a191bb6202a36a8d822dd25492d60c859de5400455b">ArmFault::TranslationLL</a> + <a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bdae5bc7ee7d6dda5340a28f91834f10543">L1</a>, <a class="code" href="classArmISA_1_1TableWalker.html#a475f8007920fb01f7f8aa1730b3016bb">isStage2</a>,
<a name="l00417"></a>00417                                      <a class="code" href="classArmISA_1_1ArmFault.html#ad78237d6390becbe8bdf9e73979c56aeabfef4fbb52d72e0c89f660f2d501a488">ArmFault::VmsaTran</a>);
<a name="l00418"></a>00418         }
<a name="l00419"></a>00419         ttbr = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>-&gt;<a class="code" href="classThreadContext.html#a6888f4bff21e34892e59654ea80073b2">readMiscReg</a>(<a class="code" href="namespaceArmISA.html#a939d9e820fe2a05cb16413fe88dc1887">flattenMiscRegNsBanked</a>(
<a name="l00420"></a>00420             <a class="code" href="namespaceArmISA.html#a1e522017e015d4c7efd6b2360143aa67af04fed84f7396af659248bb67d59cf57">MISCREG_TTBR0</a>, <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>, !<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a62bc84f4251f16cf0cfa0f8d96e00c37">isSecure</a>));
<a name="l00421"></a>00421     } <span class="keywordflow">else</span> {
<a name="l00422"></a>00422         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classArmISA_1_1TLB.html">TLB</a>, <span class="stringliteral">&quot; - Selecting TTBR1\n&quot;</span>);
<a name="l00423"></a>00423         <span class="comment">// Check if table walk is allowed when Security Extensions are enabled</span>
<a name="l00424"></a>00424         <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a9f135583566fb70bba3c10395368f2e4">haveSecurity</a> &amp;&amp; <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ad6762be565087b4bfb87f5bcb42673e7">ttbcr</a>.pd1) {
<a name="l00425"></a>00425             <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#aa863dbd5a3e20baa5acb07e373c42ddc">isFetch</a>)
<a name="l00426"></a>00426                 <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classArmISA_1_1PrefetchAbort.html">PrefetchAbort</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a1ebff4da206a1799d70b4ec129c33c5a">vaddr_tainted</a>,
<a name="l00427"></a>00427                                          <a class="code" href="classArmISA_1_1ArmFault.html#a8771a605c5b916759188c3a191bb6202a36a8d822dd25492d60c859de5400455b">ArmFault::TranslationLL</a> + <a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bdae5bc7ee7d6dda5340a28f91834f10543">L1</a>,
<a name="l00428"></a>00428                                          <a class="code" href="classArmISA_1_1TableWalker.html#a475f8007920fb01f7f8aa1730b3016bb">isStage2</a>,
<a name="l00429"></a>00429                                          <a class="code" href="classArmISA_1_1ArmFault.html#ad78237d6390becbe8bdf9e73979c56aeabfef4fbb52d72e0c89f660f2d501a488">ArmFault::VmsaTran</a>);
<a name="l00430"></a>00430             <span class="keywordflow">else</span>
<a name="l00431"></a>00431                 <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classArmISA_1_1DataAbort.html">DataAbort</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a1ebff4da206a1799d70b4ec129c33c5a">vaddr_tainted</a>,
<a name="l00432"></a>00432                         TlbEntry::DomainType::NoAccess, <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a0775ef609f39793da4e2adb3a0e2ded1">isWrite</a>,
<a name="l00433"></a>00433                                      <a class="code" href="classArmISA_1_1ArmFault.html#a8771a605c5b916759188c3a191bb6202a36a8d822dd25492d60c859de5400455b">ArmFault::TranslationLL</a> + <a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bdae5bc7ee7d6dda5340a28f91834f10543">L1</a>, <a class="code" href="classArmISA_1_1TableWalker.html#a475f8007920fb01f7f8aa1730b3016bb">isStage2</a>,
<a name="l00434"></a>00434                                      <a class="code" href="classArmISA_1_1ArmFault.html#ad78237d6390becbe8bdf9e73979c56aeabfef4fbb52d72e0c89f660f2d501a488">ArmFault::VmsaTran</a>);
<a name="l00435"></a>00435         }
<a name="l00436"></a>00436         ttbr = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>-&gt;<a class="code" href="classThreadContext.html#a6888f4bff21e34892e59654ea80073b2">readMiscReg</a>(<a class="code" href="namespaceArmISA.html#a939d9e820fe2a05cb16413fe88dc1887">flattenMiscRegNsBanked</a>(
<a name="l00437"></a>00437             <a class="code" href="namespaceArmISA.html#a1e522017e015d4c7efd6b2360143aa67a8fcade2139fd8facbbeefb69cc2ad774">MISCREG_TTBR1</a>, <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>, !<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a62bc84f4251f16cf0cfa0f8d96e00c37">isSecure</a>));
<a name="l00438"></a>00438         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ad6762be565087b4bfb87f5bcb42673e7">ttbcr</a>.n = 0;
<a name="l00439"></a>00439     }
<a name="l00440"></a>00440 
<a name="l00441"></a>00441     <a class="code" href="classm5_1_1params_1_1Addr.html">Addr</a> l1desc_addr = <a class="code" href="bitfield_8hh.html#acaa3c424fec3407f14a01fe1ec22c2d4">mbits</a>(ttbr, 31, 14 - <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ad6762be565087b4bfb87f5bcb42673e7">ttbcr</a>.n) |
<a name="l00442"></a>00442         (<a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123">bits</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a9f933b300ef63eea367ca82f8da31025">vaddr</a>, 31 - <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ad6762be565087b4bfb87f5bcb42673e7">ttbcr</a>.n, 20) &lt;&lt; 2);
<a name="l00443"></a>00443     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classArmISA_1_1TLB.html">TLB</a>, <span class="stringliteral">&quot; - Descriptor at address %#x (%s)\n&quot;</span>, l1desc_addr,
<a name="l00444"></a>00444             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a62bc84f4251f16cf0cfa0f8d96e00c37">isSecure</a> ? <span class="stringliteral">&quot;s&quot;</span> : <span class="stringliteral">&quot;ns&quot;</span>);
<a name="l00445"></a>00445 
<a name="l00446"></a>00446     <span class="comment">// Trickbox address check</span>
<a name="l00447"></a>00447     <a class="code" href="classRefCountingPtr.html">Fault</a> <a class="code" href="namespaceArmISA.html#ac1e4a6891d41a331cd7184329e5416ec">f</a>;
<a name="l00448"></a>00448     f = <a class="code" href="classArmISA_1_1TableWalker.html#a9f0e11329a702fd34819769c899e4bd3">tlb</a>-&gt;<a class="code" href="classArmISA_1_1TLB.html#a19bf31f32ec6125d85acc1feeee28e47">walkTrickBoxCheck</a>(l1desc_addr, <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a62bc84f4251f16cf0cfa0f8d96e00c37">isSecure</a>,
<a name="l00449"></a>00449             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a9f933b300ef63eea367ca82f8da31025">vaddr</a>, <span class="keyword">sizeof</span>(<a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>), <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#aa863dbd5a3e20baa5acb07e373c42ddc">isFetch</a>,
<a name="l00450"></a>00450             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a0775ef609f39793da4e2adb3a0e2ded1">isWrite</a>, TlbEntry::DomainType::NoAccess, <a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bdae5bc7ee7d6dda5340a28f91834f10543">L1</a>);
<a name="l00451"></a>00451     <span class="keywordflow">if</span> (f) {
<a name="l00452"></a>00452         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classArmISA_1_1TLB.html">TLB</a>, <span class="stringliteral">&quot;Trickbox check caused fault on %#x\n&quot;</span>, <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a1ebff4da206a1799d70b4ec129c33c5a">vaddr_tainted</a>);
<a name="l00453"></a>00453         <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a20f65ad56869382ed8681b9dd1aa85d6">timing</a>) {
<a name="l00454"></a>00454             <a class="code" href="classArmISA_1_1TableWalker.html#a39f16d585c4531d2bf2562631a775d73">pending</a> = <span class="keyword">false</span>;
<a name="l00455"></a>00455             <a class="code" href="classArmISA_1_1TableWalker.html#ae126e9ab023c3e4659836daa8f5364be">nextWalk</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>);
<a name="l00456"></a>00456             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00457"></a>00457         } <span class="keywordflow">else</span> {
<a name="l00458"></a>00458             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00459"></a>00459             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a956cd41d82347558b9c0a5b0474903f2">req</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00460"></a>00460         }
<a name="l00461"></a>00461         <span class="keywordflow">return</span> f;
<a name="l00462"></a>00462     }
<a name="l00463"></a>00463 
<a name="l00464"></a>00464     <a class="code" href="classFlags.html">Request::Flags</a> flag = 0;
<a name="l00465"></a>00465     <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a43c4d132ca97c6cc5358f7be3c2b5a69">sctlr</a>.c == 0) {
<a name="l00466"></a>00466         flag = <a class="code" href="classRequest.html#a0fc1d6bc92a0567b05130468e04f05f8">Request::UNCACHEABLE</a>;
<a name="l00467"></a>00467     }
<a name="l00468"></a>00468 
<a name="l00469"></a>00469     <span class="keywordtype">bool</span> delayed;
<a name="l00470"></a>00470     delayed = <a class="code" href="classArmISA_1_1TableWalker.html#a583b81ca3090f4eb8014ec261cadeb6e">fetchDescriptor</a>(l1desc_addr, (uint8_t*)&amp;<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a7ab0bc1bc2c0b56484b750ffd1004d9c">l1Desc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1L1Descriptor.html#a1e43bf7d608e87228b625cca2c04d641">data</a>,
<a name="l00471"></a>00471                               <span class="keyword">sizeof</span>(<a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>), flag, <a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bdae5bc7ee7d6dda5340a28f91834f10543">L1</a>, &amp;<a class="code" href="classArmISA_1_1TableWalker.html#a896d858298222a8d8c96bc69f7db1d84">doL1DescEvent</a>,
<a name="l00472"></a>00472                               &amp;<a class="code" href="classArmISA_1_1TableWalker.html#a837a539f5e07e8785902d5854efde98d">TableWalker::doL1Descriptor</a>);
<a name="l00473"></a>00473     <span class="keywordflow">if</span> (!delayed) {
<a name="l00474"></a>00474        f = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a68714ceb74c60ea7ef5dec335bb6c5d7">fault</a>;
<a name="l00475"></a>00475     }
<a name="l00476"></a>00476 
<a name="l00477"></a>00477     <span class="keywordflow">return</span> f;
<a name="l00478"></a>00478 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8530d760b97c61b1bf18de8228c3aa90"></a><!-- doxytag: member="ArmISA::TableWalker::processWalkAArch64" ref="a8530d760b97c61b1bf18de8228c3aa90" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classRefCountingPtr.html">Fault</a> processWalkAArch64 </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00663"></a>00663 {
<a name="l00664"></a>00664     assert(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a52c06c8a54293998f3e1f71cdbd916f7">aarch64</a>);
<a name="l00665"></a>00665 
<a name="l00666"></a>00666     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classArmISA_1_1TLB.html">TLB</a>, <span class="stringliteral">&quot;Beginning table walk for address %#llx, TTBCR: %#llx\n&quot;</span>,
<a name="l00667"></a>00667             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a1ebff4da206a1799d70b4ec129c33c5a">vaddr_tainted</a>, <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ad6762be565087b4bfb87f5bcb42673e7">ttbcr</a>);
<a name="l00668"></a>00668 
<a name="l00669"></a>00669     <span class="comment">// Determine TTBR, table size, granule size and phys. address range</span>
<a name="l00670"></a>00670     <a class="code" href="classm5_1_1params_1_1Addr.html">Addr</a> ttbr = 0;
<a name="l00671"></a>00671     <span class="keywordtype">int</span> tsz = 0, <a class="code" href="namespaceArmISA.html#a605ede8bf0f2ccf5b3928adf311a964a">ps</a> = 0;
<a name="l00672"></a>00672     <span class="keywordtype">bool</span> large_grain = <span class="keyword">false</span>;
<a name="l00673"></a>00673     <span class="keywordtype">bool</span> fault = <span class="keyword">false</span>;
<a name="l00674"></a>00674     <span class="keywordflow">switch</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a878510cdbf1a6438f83754acbdbf759a">el</a>) {
<a name="l00675"></a>00675       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a16588a7a92eb985c3341b7f706c81dd5a1808d294e1d965cd8d1a3060e2f411ef">EL0</a>:
<a name="l00676"></a>00676       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a16588a7a92eb985c3341b7f706c81dd5ab5e42aaf40f117fdce042d02976bf090">EL1</a>:
<a name="l00677"></a>00677         <span class="keywordflow">switch</span> (<a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123">bits</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a9f933b300ef63eea367ca82f8da31025">vaddr</a>, 63,48)) {
<a name="l00678"></a>00678           <span class="keywordflow">case</span> 0:
<a name="l00679"></a>00679             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classArmISA_1_1TLB.html">TLB</a>, <span class="stringliteral">&quot; - Selecting TTBR0 (AArch64)\n&quot;</span>);
<a name="l00680"></a>00680             ttbr = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>-&gt;<a class="code" href="classThreadContext.html#a6888f4bff21e34892e59654ea80073b2">readMiscReg</a>(<a class="code" href="namespaceArmISA.html#a1e522017e015d4c7efd6b2360143aa67ab061e5a58c89419b5e5e4044bac12532">MISCREG_TTBR0_EL1</a>);
<a name="l00681"></a>00681             tsz = <a class="code" href="classArmISA_1_1TableWalker.html#a60f480f39c21ef312d34cb3c8702e9a6">adjustTableSizeAArch64</a>(64 - <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ad6762be565087b4bfb87f5bcb42673e7">ttbcr</a>.t0sz);
<a name="l00682"></a>00682             large_grain = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ad6762be565087b4bfb87f5bcb42673e7">ttbcr</a>.tg0;
<a name="l00683"></a>00683             <span class="keywordflow">if</span> (<a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123">bits</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a9f933b300ef63eea367ca82f8da31025">vaddr</a>, 63, tsz) != 0x0 ||
<a name="l00684"></a>00684                 <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ad6762be565087b4bfb87f5bcb42673e7">ttbcr</a>.epd0)
<a name="l00685"></a>00685               fault = <span class="keyword">true</span>;
<a name="l00686"></a>00686             <span class="keywordflow">break</span>;
<a name="l00687"></a>00687           <span class="keywordflow">case</span> 0xffff:
<a name="l00688"></a>00688             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classArmISA_1_1TLB.html">TLB</a>, <span class="stringliteral">&quot; - Selecting TTBR1 (AArch64)\n&quot;</span>);
<a name="l00689"></a>00689             ttbr = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>-&gt;<a class="code" href="classThreadContext.html#a6888f4bff21e34892e59654ea80073b2">readMiscReg</a>(<a class="code" href="namespaceArmISA.html#a1e522017e015d4c7efd6b2360143aa67ab1e490523d083a21f2b740b450a650d6">MISCREG_TTBR1_EL1</a>);
<a name="l00690"></a>00690             tsz = <a class="code" href="classArmISA_1_1TableWalker.html#a60f480f39c21ef312d34cb3c8702e9a6">adjustTableSizeAArch64</a>(64 - <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ad6762be565087b4bfb87f5bcb42673e7">ttbcr</a>.t1sz);
<a name="l00691"></a>00691             large_grain = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ad6762be565087b4bfb87f5bcb42673e7">ttbcr</a>.tg1;
<a name="l00692"></a>00692             <span class="keywordflow">if</span> (<a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123">bits</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a9f933b300ef63eea367ca82f8da31025">vaddr</a>, 63, tsz) != <a class="code" href="namespaceArmISA.html#a9534dbda5e7db9881c7955c6e08cfdc0">mask</a>(64-tsz) ||
<a name="l00693"></a>00693                 <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ad6762be565087b4bfb87f5bcb42673e7">ttbcr</a>.epd1)
<a name="l00694"></a>00694               fault = <span class="keyword">true</span>;
<a name="l00695"></a>00695             <span class="keywordflow">break</span>;
<a name="l00696"></a>00696           <span class="keywordflow">default</span>:
<a name="l00697"></a>00697             <span class="comment">// top two bytes must be all 0s or all 1s, else invalid addr</span>
<a name="l00698"></a>00698             fault = <span class="keyword">true</span>;
<a name="l00699"></a>00699         }
<a name="l00700"></a>00700         <a class="code" href="namespaceArmISA.html#a605ede8bf0f2ccf5b3928adf311a964a">ps</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ad6762be565087b4bfb87f5bcb42673e7">ttbcr</a>.ips;
<a name="l00701"></a>00701         <span class="keywordflow">break</span>;
<a name="l00702"></a>00702       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a16588a7a92eb985c3341b7f706c81dd5a5f6f6ced63893d592951c91f7489857f">EL2</a>:
<a name="l00703"></a>00703       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a16588a7a92eb985c3341b7f706c81dd5a44bf3e9d5387a706bdc96b1ec9a2fc15">EL3</a>:
<a name="l00704"></a>00704         <span class="keywordflow">switch</span>(<a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123">bits</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a9f933b300ef63eea367ca82f8da31025">vaddr</a>, 63,48)) {
<a name="l00705"></a>00705             <span class="keywordflow">case</span> 0:
<a name="l00706"></a>00706         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classArmISA_1_1TLB.html">TLB</a>, <span class="stringliteral">&quot; - Selecting TTBR0 (AArch64)\n&quot;</span>);
<a name="l00707"></a>00707         <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a878510cdbf1a6438f83754acbdbf759a">el</a> == <a class="code" href="namespaceArmISA.html#a16588a7a92eb985c3341b7f706c81dd5a5f6f6ced63893d592951c91f7489857f">EL2</a>)
<a name="l00708"></a>00708             ttbr = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>-&gt;<a class="code" href="classThreadContext.html#a6888f4bff21e34892e59654ea80073b2">readMiscReg</a>(<a class="code" href="namespaceArmISA.html#a1e522017e015d4c7efd6b2360143aa67ae3fc24762c807b79f9e589bd63d51ca0">MISCREG_TTBR0_EL2</a>);
<a name="l00709"></a>00709         <span class="keywordflow">else</span>
<a name="l00710"></a>00710             ttbr = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>-&gt;<a class="code" href="classThreadContext.html#a6888f4bff21e34892e59654ea80073b2">readMiscReg</a>(<a class="code" href="namespaceArmISA.html#a1e522017e015d4c7efd6b2360143aa67a9c90551c1a59c5948b3c7bb51ba3126f">MISCREG_TTBR0_EL3</a>);
<a name="l00711"></a>00711         tsz = <a class="code" href="classArmISA_1_1TableWalker.html#a60f480f39c21ef312d34cb3c8702e9a6">adjustTableSizeAArch64</a>(64 - <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ad6762be565087b4bfb87f5bcb42673e7">ttbcr</a>.t0sz);
<a name="l00712"></a>00712         large_grain = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ad6762be565087b4bfb87f5bcb42673e7">ttbcr</a>.tg0;
<a name="l00713"></a>00713                 <span class="keywordflow">break</span>;
<a name="l00714"></a>00714             <span class="keywordflow">default</span>:
<a name="l00715"></a>00715                 <span class="comment">// invalid addr if top two bytes are not all 0s</span>
<a name="l00716"></a>00716             fault = <span class="keyword">true</span>;
<a name="l00717"></a>00717         }
<a name="l00718"></a>00718         <a class="code" href="namespaceArmISA.html#a605ede8bf0f2ccf5b3928adf311a964a">ps</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ad6762be565087b4bfb87f5bcb42673e7">ttbcr</a>.ps;
<a name="l00719"></a>00719         <span class="keywordflow">break</span>;
<a name="l00720"></a>00720     }
<a name="l00721"></a>00721 
<a name="l00722"></a>00722     <span class="keywordflow">if</span> (fault) {
<a name="l00723"></a>00723         <a class="code" href="classRefCountingPtr.html">Fault</a> <a class="code" href="namespaceArmISA.html#ac1e4a6891d41a331cd7184329e5416ec">f</a>;
<a name="l00724"></a>00724         <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#aa863dbd5a3e20baa5acb07e373c42ddc">isFetch</a>)
<a name="l00725"></a>00725             f =  <span class="keyword">new</span> <a class="code" href="classArmISA_1_1PrefetchAbort.html">PrefetchAbort</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a1ebff4da206a1799d70b4ec129c33c5a">vaddr_tainted</a>,
<a name="l00726"></a>00726                                      <a class="code" href="classArmISA_1_1ArmFault.html#a8771a605c5b916759188c3a191bb6202a36a8d822dd25492d60c859de5400455b">ArmFault::TranslationLL</a> + <a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bda51451264203360e0ffacec9b6d8ef7c9">L0</a>, <a class="code" href="classArmISA_1_1TableWalker.html#a475f8007920fb01f7f8aa1730b3016bb">isStage2</a>,
<a name="l00727"></a>00727                                      <a class="code" href="classArmISA_1_1ArmFault.html#ad78237d6390becbe8bdf9e73979c56aea307d48bbc198c224e04bf57415c05dcd">ArmFault::LpaeTran</a>);
<a name="l00728"></a>00728         <span class="keywordflow">else</span>
<a name="l00729"></a>00729             f = <span class="keyword">new</span> <a class="code" href="classArmISA_1_1DataAbort.html">DataAbort</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a1ebff4da206a1799d70b4ec129c33c5a">vaddr_tainted</a>,
<a name="l00730"></a>00730                                  TlbEntry::DomainType::NoAccess,
<a name="l00731"></a>00731                                  <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a0775ef609f39793da4e2adb3a0e2ded1">isWrite</a>,
<a name="l00732"></a>00732                                  <a class="code" href="classArmISA_1_1ArmFault.html#a8771a605c5b916759188c3a191bb6202a36a8d822dd25492d60c859de5400455b">ArmFault::TranslationLL</a> + <a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bda51451264203360e0ffacec9b6d8ef7c9">L0</a>,
<a name="l00733"></a>00733                                  <a class="code" href="classArmISA_1_1TableWalker.html#a475f8007920fb01f7f8aa1730b3016bb">isStage2</a>, <a class="code" href="classArmISA_1_1ArmFault.html#ad78237d6390becbe8bdf9e73979c56aea307d48bbc198c224e04bf57415c05dcd">ArmFault::LpaeTran</a>);
<a name="l00734"></a>00734 
<a name="l00735"></a>00735         <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a20f65ad56869382ed8681b9dd1aa85d6">timing</a>) {
<a name="l00736"></a>00736             <a class="code" href="classArmISA_1_1TableWalker.html#a39f16d585c4531d2bf2562631a775d73">pending</a> = <span class="keyword">false</span>;
<a name="l00737"></a>00737             <a class="code" href="classArmISA_1_1TableWalker.html#ae126e9ab023c3e4659836daa8f5364be">nextWalk</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>);
<a name="l00738"></a>00738             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00739"></a>00739         } <span class="keywordflow">else</span> {
<a name="l00740"></a>00740             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00741"></a>00741             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a956cd41d82347558b9c0a5b0474903f2">req</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00742"></a>00742         }
<a name="l00743"></a>00743         <span class="keywordflow">return</span> f;
<a name="l00744"></a>00744 
<a name="l00745"></a>00745     }
<a name="l00746"></a>00746 
<a name="l00747"></a>00747     <span class="comment">// Determine starting lookup level</span>
<a name="l00748"></a>00748     <a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bd">LookupLevel</a> start_lookup_level;
<a name="l00749"></a>00749     <span class="keywordtype">int</span> grain_size, <a class="code" href="namespaceArmISA.html#a37eb53a9544702853d40d1e014ba88ea">stride</a>;
<a name="l00750"></a>00750     <span class="keywordflow">if</span> (large_grain) {  <span class="comment">// 64 KB granule</span>
<a name="l00751"></a>00751         grain_size = 16;
<a name="l00752"></a>00752         stride = grain_size - 3;
<a name="l00753"></a>00753         <span class="keywordflow">if</span> (tsz &gt; grain_size + 2 * stride)
<a name="l00754"></a>00754             start_lookup_level = <a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bdae5bc7ee7d6dda5340a28f91834f10543">L1</a>;
<a name="l00755"></a>00755         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tsz &gt; grain_size + stride)
<a name="l00756"></a>00756             start_lookup_level = <a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bda0adffb24dae0c41be5b803f4d444f066">L2</a>;
<a name="l00757"></a>00757         <span class="keywordflow">else</span>
<a name="l00758"></a>00758             start_lookup_level = <a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bda78d20b793a10e7c2f1012114803147c3">L3</a>;
<a name="l00759"></a>00759     } <span class="keywordflow">else</span> {  <span class="comment">// 4 KB granule</span>
<a name="l00760"></a>00760         grain_size = 12;
<a name="l00761"></a>00761         stride = grain_size - 3;
<a name="l00762"></a>00762         <span class="keywordflow">if</span> (tsz &gt; grain_size + 3 * stride)
<a name="l00763"></a>00763             start_lookup_level = <a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bda51451264203360e0ffacec9b6d8ef7c9">L0</a>;
<a name="l00764"></a>00764         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tsz &gt; grain_size + 2 * stride)
<a name="l00765"></a>00765             start_lookup_level = <a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bdae5bc7ee7d6dda5340a28f91834f10543">L1</a>;
<a name="l00766"></a>00766         <span class="keywordflow">else</span>
<a name="l00767"></a>00767             start_lookup_level = <a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bda0adffb24dae0c41be5b803f4d444f066">L2</a>;
<a name="l00768"></a>00768     }
<a name="l00769"></a>00769 
<a name="l00770"></a>00770     <span class="comment">// Determine table base address</span>
<a name="l00771"></a>00771     <span class="keywordtype">int</span> base_addr_lo = 3 + tsz - stride * (3 - start_lookup_level) -
<a name="l00772"></a>00772         grain_size;
<a name="l00773"></a>00773     <a class="code" href="classm5_1_1params_1_1Addr.html">Addr</a> base_addr = <a class="code" href="bitfield_8hh.html#acaa3c424fec3407f14a01fe1ec22c2d4">mbits</a>(ttbr, 47, base_addr_lo);
<a name="l00774"></a>00774 
<a name="l00775"></a>00775     <span class="comment">// Determine physical address size and raise an Address Size Fault if</span>
<a name="l00776"></a>00776     <span class="comment">// necessary</span>
<a name="l00777"></a>00777     <span class="keywordtype">int</span> pa_range = <a class="code" href="namespaceArmISA.html#a6604aa91f07e901f32fdc217cdf99d09">decodePhysAddrRange64</a>(<a class="code" href="namespaceArmISA.html#a605ede8bf0f2ccf5b3928adf311a964a">ps</a>);
<a name="l00778"></a>00778     <span class="comment">// Clamp to lower limit</span>
<a name="l00779"></a>00779     <span class="keywordflow">if</span> (pa_range &gt; <a class="code" href="classArmISA_1_1TableWalker.html#af85538fbb375410b2750035ab34dc88a">physAddrRange</a>)
<a name="l00780"></a>00780         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a54248d4ad3bc4c54e33a04257ee09280">physAddrRange</a> = <a class="code" href="classArmISA_1_1TableWalker.html#af85538fbb375410b2750035ab34dc88a">physAddrRange</a>;
<a name="l00781"></a>00781     <span class="keywordflow">else</span>
<a name="l00782"></a>00782         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a54248d4ad3bc4c54e33a04257ee09280">physAddrRange</a> = pa_range;
<a name="l00783"></a>00783     <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a40ad630985e7888b542e819ed09e0551">checkAddrSizeFaultAArch64</a>(base_addr, <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a54248d4ad3bc4c54e33a04257ee09280">physAddrRange</a>)) {
<a name="l00784"></a>00784         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classArmISA_1_1TLB.html">TLB</a>, <span class="stringliteral">&quot;Address size fault before any lookup\n&quot;</span>);
<a name="l00785"></a>00785         <a class="code" href="classRefCountingPtr.html">Fault</a> f;
<a name="l00786"></a>00786         <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#aa863dbd5a3e20baa5acb07e373c42ddc">isFetch</a>)
<a name="l00787"></a>00787             f = <span class="keyword">new</span> <a class="code" href="classArmISA_1_1PrefetchAbort.html">PrefetchAbort</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a1ebff4da206a1799d70b4ec129c33c5a">vaddr_tainted</a>,
<a name="l00788"></a>00788                                      <a class="code" href="classArmISA_1_1ArmFault.html#a8771a605c5b916759188c3a191bb6202ad3e0e83e6ccbaae6110e0312eb6a5280">ArmFault::AddressSizeLL</a> + start_lookup_level,
<a name="l00789"></a>00789                                      <a class="code" href="classArmISA_1_1TableWalker.html#a475f8007920fb01f7f8aa1730b3016bb">isStage2</a>,
<a name="l00790"></a>00790                                      <a class="code" href="classArmISA_1_1ArmFault.html#ad78237d6390becbe8bdf9e73979c56aea307d48bbc198c224e04bf57415c05dcd">ArmFault::LpaeTran</a>);
<a name="l00791"></a>00791         <span class="keywordflow">else</span>
<a name="l00792"></a>00792             f = <span class="keyword">new</span> <a class="code" href="classArmISA_1_1DataAbort.html">DataAbort</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a1ebff4da206a1799d70b4ec129c33c5a">vaddr_tainted</a>,
<a name="l00793"></a>00793                                  TlbEntry::DomainType::NoAccess,
<a name="l00794"></a>00794                                  <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a0775ef609f39793da4e2adb3a0e2ded1">isWrite</a>,
<a name="l00795"></a>00795                                  <a class="code" href="classArmISA_1_1ArmFault.html#a8771a605c5b916759188c3a191bb6202ad3e0e83e6ccbaae6110e0312eb6a5280">ArmFault::AddressSizeLL</a> + start_lookup_level,
<a name="l00796"></a>00796                                  <a class="code" href="classArmISA_1_1TableWalker.html#a475f8007920fb01f7f8aa1730b3016bb">isStage2</a>,
<a name="l00797"></a>00797                                  <a class="code" href="classArmISA_1_1ArmFault.html#ad78237d6390becbe8bdf9e73979c56aea307d48bbc198c224e04bf57415c05dcd">ArmFault::LpaeTran</a>);
<a name="l00798"></a>00798 
<a name="l00799"></a>00799 
<a name="l00800"></a>00800         <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a20f65ad56869382ed8681b9dd1aa85d6">timing</a>) {
<a name="l00801"></a>00801             <a class="code" href="classArmISA_1_1TableWalker.html#a39f16d585c4531d2bf2562631a775d73">pending</a> = <span class="keyword">false</span>;
<a name="l00802"></a>00802             <a class="code" href="classArmISA_1_1TableWalker.html#ae126e9ab023c3e4659836daa8f5364be">nextWalk</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>);
<a name="l00803"></a>00803             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00804"></a>00804         } <span class="keywordflow">else</span> {
<a name="l00805"></a>00805             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00806"></a>00806             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a956cd41d82347558b9c0a5b0474903f2">req</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00807"></a>00807         }
<a name="l00808"></a>00808         <span class="keywordflow">return</span> f;
<a name="l00809"></a>00809 
<a name="l00810"></a>00810    }
<a name="l00811"></a>00811 
<a name="l00812"></a>00812     <span class="comment">// Determine descriptor address</span>
<a name="l00813"></a>00813     <a class="code" href="classm5_1_1params_1_1Addr.html">Addr</a> desc_addr = base_addr |
<a name="l00814"></a>00814         (<a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123">bits</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a9f933b300ef63eea367ca82f8da31025">vaddr</a>, tsz - 1,
<a name="l00815"></a>00815               stride * (3 - start_lookup_level) + grain_size) &lt;&lt; 3);
<a name="l00816"></a>00816 
<a name="l00817"></a>00817     <span class="comment">// Trickbox address check</span>
<a name="l00818"></a>00818     <a class="code" href="classRefCountingPtr.html">Fault</a> f = <a class="code" href="classArmISA_1_1TableWalker.html#a9f0e11329a702fd34819769c899e4bd3">tlb</a>-&gt;<a class="code" href="classArmISA_1_1TLB.html#a19bf31f32ec6125d85acc1feeee28e47">walkTrickBoxCheck</a>(desc_addr, <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a62bc84f4251f16cf0cfa0f8d96e00c37">isSecure</a>,
<a name="l00819"></a>00819                         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a9f933b300ef63eea367ca82f8da31025">vaddr</a>, <span class="keyword">sizeof</span>(uint64_t), <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#aa863dbd5a3e20baa5acb07e373c42ddc">isFetch</a>,
<a name="l00820"></a>00820                         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a0775ef609f39793da4e2adb3a0e2ded1">isWrite</a>, TlbEntry::DomainType::NoAccess,
<a name="l00821"></a>00821                         start_lookup_level);
<a name="l00822"></a>00822     <span class="keywordflow">if</span> (f) {
<a name="l00823"></a>00823         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classArmISA_1_1TLB.html">TLB</a>, <span class="stringliteral">&quot;Trickbox check caused fault on %#x\n&quot;</span>, <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a1ebff4da206a1799d70b4ec129c33c5a">vaddr_tainted</a>);
<a name="l00824"></a>00824         <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a20f65ad56869382ed8681b9dd1aa85d6">timing</a>) {
<a name="l00825"></a>00825             <a class="code" href="classArmISA_1_1TableWalker.html#a39f16d585c4531d2bf2562631a775d73">pending</a> = <span class="keyword">false</span>;
<a name="l00826"></a>00826             <a class="code" href="classArmISA_1_1TableWalker.html#ae126e9ab023c3e4659836daa8f5364be">nextWalk</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>);
<a name="l00827"></a>00827             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00828"></a>00828         } <span class="keywordflow">else</span> {
<a name="l00829"></a>00829             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00830"></a>00830             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a956cd41d82347558b9c0a5b0474903f2">req</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00831"></a>00831         }
<a name="l00832"></a>00832         <span class="keywordflow">return</span> f;
<a name="l00833"></a>00833     }
<a name="l00834"></a>00834 
<a name="l00835"></a>00835     <a class="code" href="classFlags.html">Request::Flags</a> flag = 0;
<a name="l00836"></a>00836     <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a43c4d132ca97c6cc5358f7be3c2b5a69">sctlr</a>.c == 0) {
<a name="l00837"></a>00837         flag = <a class="code" href="classRequest.html#a0fc1d6bc92a0567b05130468e04f05f8">Request::UNCACHEABLE</a>;
<a name="l00838"></a>00838     }
<a name="l00839"></a>00839 
<a name="l00840"></a>00840     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1DescriptorBase.html#a88477771eb7d27741455a8035678c67a">lookupLevel</a> = start_lookup_level;
<a name="l00841"></a>00841     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1LongDescriptor.html#a52c06c8a54293998f3e1f71cdbd916f7">aarch64</a> = <span class="keyword">true</span>;
<a name="l00842"></a>00842     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1LongDescriptor.html#a0147ae2ff00e021ff30ba60e73de3e09">largeGrain</a> = large_grain;
<a name="l00843"></a>00843     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1LongDescriptor.html#a887606cb7c0d8e19afb1a67ac7293519">grainSize</a> = grain_size;
<a name="l00844"></a>00844 
<a name="l00845"></a>00845     <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a20f65ad56869382ed8681b9dd1aa85d6">timing</a>) {
<a name="l00846"></a>00846         Event *<a class="code" href="namespaceMipsISA.html#aa3b803f4777161a2825178dabfb154f0">event</a>;
<a name="l00847"></a>00847         <span class="keywordflow">switch</span> (start_lookup_level) {
<a name="l00848"></a>00848           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bda51451264203360e0ffacec9b6d8ef7c9">L0</a>:
<a name="l00849"></a>00849             <span class="keyword">event</span> = (Event *) &amp;<a class="code" href="classArmISA_1_1TableWalker.html#a263fa19a40da797a24e51a5edafd9215">doL0LongDescEvent</a>;
<a name="l00850"></a>00850             <span class="keywordflow">break</span>;
<a name="l00851"></a>00851           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bdae5bc7ee7d6dda5340a28f91834f10543">L1</a>:
<a name="l00852"></a>00852             <span class="keyword">event</span> = (Event *) &amp;<a class="code" href="classArmISA_1_1TableWalker.html#a5ab01b63bbaded2920f4e72569b63759">doL1LongDescEvent</a>;
<a name="l00853"></a>00853             <span class="keywordflow">break</span>;
<a name="l00854"></a>00854           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bda0adffb24dae0c41be5b803f4d444f066">L2</a>:
<a name="l00855"></a>00855             <span class="keyword">event</span> = (Event *) &amp;<a class="code" href="classArmISA_1_1TableWalker.html#a987d9ee7304c356462000428178c6c5e">doL2LongDescEvent</a>;
<a name="l00856"></a>00856             <span class="keywordflow">break</span>;
<a name="l00857"></a>00857           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bda78d20b793a10e7c2f1012114803147c3">L3</a>:
<a name="l00858"></a>00858             <span class="keyword">event</span> = (Event *) &amp;<a class="code" href="classArmISA_1_1TableWalker.html#a6a30037030613a33f5a056cd7c9af535">doL3LongDescEvent</a>;
<a name="l00859"></a>00859             <span class="keywordflow">break</span>;
<a name="l00860"></a>00860           <span class="keywordflow">default</span>:
<a name="l00861"></a>00861             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Invalid table lookup level&quot;</span>);
<a name="l00862"></a>00862             <span class="keywordflow">break</span>;
<a name="l00863"></a>00863         }
<a name="l00864"></a>00864         <a class="code" href="classArmISA_1_1TableWalker.html#a9305ff92238d7360a5ee86168e00407b">port</a>.<a class="code" href="classDmaPort.html#ac9a04fe85b8cb0292631680073eddb86">dmaAction</a>(<a class="code" href="classMemCmd.html#a2afce0a47a93eee73a314d53e4890153a96120c772a9cb695fe62ca81ec93a53b">MemCmd::ReadReq</a>, desc_addr, <span class="keyword">sizeof</span>(uint64_t), event,
<a name="l00865"></a>00865                        (uint8_t*) &amp;<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1LongDescriptor.html#ae421a8889820e685feae3e58e1d5fca0">data</a>,
<a name="l00866"></a>00866                        <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>-&gt;<a class="code" href="classThreadContext.html#ad10a7ef049c2d2ffadfc809341e66d4e">getCpuPtr</a>()-&gt;clockPeriod(), flag);
<a name="l00867"></a>00867         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(TLBVerbose,
<a name="l00868"></a>00868                 <span class="stringliteral">&quot;Adding to walker fifo: queue size before adding: %d\n&quot;</span>,
<a name="l00869"></a>00869                 <a class="code" href="classArmISA_1_1TableWalker.html#af819b2b862d892da5df10248b6d72787">stateQueues</a>[start_lookup_level].size());
<a name="l00870"></a>00870         <a class="code" href="classArmISA_1_1TableWalker.html#af819b2b862d892da5df10248b6d72787">stateQueues</a>[start_lookup_level].push_back(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>);
<a name="l00871"></a>00871         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00872"></a>00872     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4f60754b74e2d1584c06199ae5b75f21">functional</a>) {
<a name="l00873"></a>00873         <a class="code" href="classArmISA_1_1TableWalker.html#a9305ff92238d7360a5ee86168e00407b">port</a>.<a class="code" href="classDmaPort.html#ac9a04fe85b8cb0292631680073eddb86">dmaAction</a>(<a class="code" href="classMemCmd.html#a2afce0a47a93eee73a314d53e4890153a96120c772a9cb695fe62ca81ec93a53b">MemCmd::ReadReq</a>, desc_addr, <span class="keyword">sizeof</span>(uint64_t),
<a name="l00874"></a>00874                        <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>, (uint8_t*) &amp;<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1LongDescriptor.html#ae421a8889820e685feae3e58e1d5fca0">data</a>,
<a name="l00875"></a>00875                        <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>-&gt;<a class="code" href="classThreadContext.html#ad10a7ef049c2d2ffadfc809341e66d4e">getCpuPtr</a>()-&gt;clockPeriod(), flag);
<a name="l00876"></a>00876         <a class="code" href="classArmISA_1_1TableWalker.html#abba315db7bc859eeb10035be0dcc1168">doLongDescriptor</a>();
<a name="l00877"></a>00877         f = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a68714ceb74c60ea7ef5dec335bb6c5d7">fault</a>;
<a name="l00878"></a>00878     } <span class="keywordflow">else</span> {
<a name="l00879"></a>00879         <a class="code" href="classRequest.html">RequestPtr</a> req = <span class="keyword">new</span> <a class="code" href="classRequest.html">Request</a>(desc_addr, <span class="keyword">sizeof</span>(uint64_t), flag,
<a name="l00880"></a>00880                                      <a class="code" href="classArmISA_1_1TableWalker.html#a96ec6a422ac492d05f8b3edc5b58532b">masterId</a>);
<a name="l00881"></a>00881         <a class="code" href="classPacket.html">PacketPtr</a> pkt = <span class="keyword">new</span> <a class="code" href="classPacket.html">Packet</a>(req, <a class="code" href="classMemCmd.html#a2afce0a47a93eee73a314d53e4890153a96120c772a9cb695fe62ca81ec93a53b">MemCmd::ReadReq</a>);
<a name="l00882"></a>00882         pkt-&gt;<a class="code" href="classPacket.html#a60621b00d6ecd49b3e336087aca2eda0">dataStatic</a>((uint8_t*) &amp;<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1LongDescriptor.html#ae421a8889820e685feae3e58e1d5fca0">data</a>);
<a name="l00883"></a>00883         <a class="code" href="classArmISA_1_1TableWalker.html#a9305ff92238d7360a5ee86168e00407b">port</a>.<a class="code" href="classMasterPort.html#aef8a57d30c0da6a2d2a599a14a9b8751">sendFunctional</a>(pkt);
<a name="l00884"></a>00884         <a class="code" href="classArmISA_1_1TableWalker.html#abba315db7bc859eeb10035be0dcc1168">doLongDescriptor</a>();
<a name="l00885"></a>00885         <span class="keyword">delete</span> req;
<a name="l00886"></a>00886         <span class="keyword">delete</span> pkt;
<a name="l00887"></a>00887         f = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a68714ceb74c60ea7ef5dec335bb6c5d7">fault</a>;
<a name="l00888"></a>00888     }
<a name="l00889"></a>00889 
<a name="l00890"></a>00890     <span class="keywordflow">return</span> f;
<a name="l00891"></a>00891 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a81c7003e58d3e96e25e66f221701669e"></a><!-- doxytag: member="ArmISA::TableWalker::processWalkLPAE" ref="a81c7003e58d3e96e25e66f221701669e" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classRefCountingPtr.html">Fault</a> processWalkLPAE </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00482"></a>00482 {
<a name="l00483"></a>00483     <a class="code" href="classm5_1_1params_1_1Addr.html">Addr</a> ttbr, ttbr0_max, ttbr1_min, desc_addr;
<a name="l00484"></a>00484     <span class="keywordtype">int</span> tsz, <a class="code" href="namespaceArmISA.html#aeab71244afb687f16d8c4f5ee9d6ef0e">n</a>;
<a name="l00485"></a>00485     <a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bd">LookupLevel</a> start_lookup_level = <a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bdae5bc7ee7d6dda5340a28f91834f10543">L1</a>;
<a name="l00486"></a>00486 
<a name="l00487"></a>00487     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classArmISA_1_1TLB.html">TLB</a>, <span class="stringliteral">&quot;Beginning table walk for address %#x, TTBCR: %#x\n&quot;</span>,
<a name="l00488"></a>00488             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a1ebff4da206a1799d70b4ec129c33c5a">vaddr_tainted</a>, <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ad6762be565087b4bfb87f5bcb42673e7">ttbcr</a>);
<a name="l00489"></a>00489 
<a name="l00490"></a>00490     <a class="code" href="classFlags.html">Request::Flags</a> flag = 0;
<a name="l00491"></a>00491     <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a62bc84f4251f16cf0cfa0f8d96e00c37">isSecure</a>)
<a name="l00492"></a>00492         flag.<a class="code" href="classFlags.html#a8bf75cf89ee252c33f05dd2e8e06d351">set</a>(<a class="code" href="classRequest.html#a096bc7521755b6680d9a1988a6c9b109">Request::SECURE</a>);
<a name="l00493"></a>00493 
<a name="l00494"></a>00494     <span class="comment">// work out which base address register to use, if in hyp mode we always</span>
<a name="l00495"></a>00495     <span class="comment">// use HTTBR</span>
<a name="l00496"></a>00496     <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a475f8007920fb01f7f8aa1730b3016bb">isStage2</a>) {
<a name="l00497"></a>00497         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classArmISA_1_1TLB.html">TLB</a>, <span class="stringliteral">&quot; - Selecting VTTBR (long-desc.)\n&quot;</span>);
<a name="l00498"></a>00498         ttbr = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>-&gt;<a class="code" href="classThreadContext.html#a6888f4bff21e34892e59654ea80073b2">readMiscReg</a>(<a class="code" href="namespaceArmISA.html#a1e522017e015d4c7efd6b2360143aa67ac9524cc0611872d06658233eba2df7a4">MISCREG_VTTBR</a>);
<a name="l00499"></a>00499         tsz  = sext&lt;4&gt;(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a284bfeb0db142a055935ae3d133893d1">vtcr</a>.t0sz);
<a name="l00500"></a>00500         start_lookup_level = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a284bfeb0db142a055935ae3d133893d1">vtcr</a>.sl0 ? <a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bdae5bc7ee7d6dda5340a28f91834f10543">L1</a> : <a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bda0adffb24dae0c41be5b803f4d444f066">L2</a>;
<a name="l00501"></a>00501     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a104c09577173edc4f8ce6814cc33f0ae">isHyp</a>) {
<a name="l00502"></a>00502         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classArmISA_1_1TLB.html">TLB</a>, <span class="stringliteral">&quot; - Selecting HTTBR (long-desc.)\n&quot;</span>);
<a name="l00503"></a>00503         ttbr = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>-&gt;<a class="code" href="classThreadContext.html#a6888f4bff21e34892e59654ea80073b2">readMiscReg</a>(<a class="code" href="namespaceArmISA.html#a1e522017e015d4c7efd6b2360143aa67a7052f2c0e20955a0df26e1ae5c4ff385">MISCREG_HTTBR</a>);
<a name="l00504"></a>00504         tsz  = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a1ee934c0734a2ed4bd4d867f55aa3d97">htcr</a>.t0sz;
<a name="l00505"></a>00505     } <span class="keywordflow">else</span> {
<a name="l00506"></a>00506         assert(<a class="code" href="classArmISA_1_1TableWalker.html#a74ac6c840c516a9b8a6eb63ed9ef1185">_haveLPAE</a> &amp;&amp; <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ad6762be565087b4bfb87f5bcb42673e7">ttbcr</a>.eae);
<a name="l00507"></a>00507 
<a name="l00508"></a>00508         <span class="comment">// Determine boundaries of TTBR0/1 regions</span>
<a name="l00509"></a>00509         <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ad6762be565087b4bfb87f5bcb42673e7">ttbcr</a>.t0sz)
<a name="l00510"></a>00510             ttbr0_max = (1<a class="code" href="base_2types_8hh.html#adcc3cf526a71c0dfaae020d432c78b83">ULL</a> &lt;&lt; (32 - <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ad6762be565087b4bfb87f5bcb42673e7">ttbcr</a>.t0sz)) - 1;
<a name="l00511"></a>00511         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ad6762be565087b4bfb87f5bcb42673e7">ttbcr</a>.t1sz)
<a name="l00512"></a>00512             ttbr0_max = (1<a class="code" href="base_2types_8hh.html#adcc3cf526a71c0dfaae020d432c78b83">ULL</a> &lt;&lt; 32) -
<a name="l00513"></a>00513                 (1<a class="code" href="base_2types_8hh.html#adcc3cf526a71c0dfaae020d432c78b83">ULL</a> &lt;&lt; (32 - <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ad6762be565087b4bfb87f5bcb42673e7">ttbcr</a>.t1sz)) - 1;
<a name="l00514"></a>00514         <span class="keywordflow">else</span>
<a name="l00515"></a>00515             ttbr0_max = (1<a class="code" href="base_2types_8hh.html#adcc3cf526a71c0dfaae020d432c78b83">ULL</a> &lt;&lt; 32) - 1;
<a name="l00516"></a>00516         <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ad6762be565087b4bfb87f5bcb42673e7">ttbcr</a>.t1sz)
<a name="l00517"></a>00517             ttbr1_min = (1<a class="code" href="base_2types_8hh.html#adcc3cf526a71c0dfaae020d432c78b83">ULL</a> &lt;&lt; 32) - (1<a class="code" href="base_2types_8hh.html#adcc3cf526a71c0dfaae020d432c78b83">ULL</a> &lt;&lt; (32 - <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ad6762be565087b4bfb87f5bcb42673e7">ttbcr</a>.t1sz));
<a name="l00518"></a>00518         <span class="keywordflow">else</span>
<a name="l00519"></a>00519             ttbr1_min = (1<a class="code" href="base_2types_8hh.html#adcc3cf526a71c0dfaae020d432c78b83">ULL</a> &lt;&lt; (32 - <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ad6762be565087b4bfb87f5bcb42673e7">ttbcr</a>.t0sz));
<a name="l00520"></a>00520 
<a name="l00521"></a>00521         <span class="comment">// The following code snippet selects the appropriate translation table base</span>
<a name="l00522"></a>00522         <span class="comment">// address (TTBR0 or TTBR1) and the appropriate starting lookup level</span>
<a name="l00523"></a>00523         <span class="comment">// depending on the address range supported by the translation table (ARM</span>
<a name="l00524"></a>00524         <span class="comment">// ARM issue C B3.6.4)</span>
<a name="l00525"></a>00525         <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a9f933b300ef63eea367ca82f8da31025">vaddr</a> &lt;= ttbr0_max) {
<a name="l00526"></a>00526             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classArmISA_1_1TLB.html">TLB</a>, <span class="stringliteral">&quot; - Selecting TTBR0 (long-desc.)\n&quot;</span>);
<a name="l00527"></a>00527             <span class="comment">// Check if table walk is allowed</span>
<a name="l00528"></a>00528             <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ad6762be565087b4bfb87f5bcb42673e7">ttbcr</a>.epd0) {
<a name="l00529"></a>00529                 <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#aa863dbd5a3e20baa5acb07e373c42ddc">isFetch</a>)
<a name="l00530"></a>00530                     <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classArmISA_1_1PrefetchAbort.html">PrefetchAbort</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a1ebff4da206a1799d70b4ec129c33c5a">vaddr_tainted</a>,
<a name="l00531"></a>00531                                              <a class="code" href="classArmISA_1_1ArmFault.html#a8771a605c5b916759188c3a191bb6202a36a8d822dd25492d60c859de5400455b">ArmFault::TranslationLL</a> + <a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bdae5bc7ee7d6dda5340a28f91834f10543">L1</a>,
<a name="l00532"></a>00532                                              <a class="code" href="classArmISA_1_1TableWalker.html#a475f8007920fb01f7f8aa1730b3016bb">isStage2</a>,
<a name="l00533"></a>00533                                              <a class="code" href="classArmISA_1_1ArmFault.html#ad78237d6390becbe8bdf9e73979c56aea307d48bbc198c224e04bf57415c05dcd">ArmFault::LpaeTran</a>);
<a name="l00534"></a>00534                 <span class="keywordflow">else</span>
<a name="l00535"></a>00535                     <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classArmISA_1_1DataAbort.html">DataAbort</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a1ebff4da206a1799d70b4ec129c33c5a">vaddr_tainted</a>,
<a name="l00536"></a>00536                                          TlbEntry::DomainType::NoAccess,
<a name="l00537"></a>00537                                          <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a0775ef609f39793da4e2adb3a0e2ded1">isWrite</a>,
<a name="l00538"></a>00538                                          <a class="code" href="classArmISA_1_1ArmFault.html#a8771a605c5b916759188c3a191bb6202a36a8d822dd25492d60c859de5400455b">ArmFault::TranslationLL</a> + <a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bdae5bc7ee7d6dda5340a28f91834f10543">L1</a>,
<a name="l00539"></a>00539                                          <a class="code" href="classArmISA_1_1TableWalker.html#a475f8007920fb01f7f8aa1730b3016bb">isStage2</a>,
<a name="l00540"></a>00540                                          <a class="code" href="classArmISA_1_1ArmFault.html#ad78237d6390becbe8bdf9e73979c56aea307d48bbc198c224e04bf57415c05dcd">ArmFault::LpaeTran</a>);
<a name="l00541"></a>00541             }
<a name="l00542"></a>00542             ttbr = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>-&gt;<a class="code" href="classThreadContext.html#a6888f4bff21e34892e59654ea80073b2">readMiscReg</a>(<a class="code" href="namespaceArmISA.html#a939d9e820fe2a05cb16413fe88dc1887">flattenMiscRegNsBanked</a>(
<a name="l00543"></a>00543                 <a class="code" href="namespaceArmISA.html#a1e522017e015d4c7efd6b2360143aa67af04fed84f7396af659248bb67d59cf57">MISCREG_TTBR0</a>, <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>, !<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a62bc84f4251f16cf0cfa0f8d96e00c37">isSecure</a>));
<a name="l00544"></a>00544             tsz = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ad6762be565087b4bfb87f5bcb42673e7">ttbcr</a>.t0sz;
<a name="l00545"></a>00545             <span class="keywordflow">if</span> (ttbr0_max &lt; (1<a class="code" href="base_2types_8hh.html#adcc3cf526a71c0dfaae020d432c78b83">ULL</a> &lt;&lt; 30))  <span class="comment">// Upper limit &lt; 1 GB</span>
<a name="l00546"></a>00546                 start_lookup_level = <a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bda0adffb24dae0c41be5b803f4d444f066">L2</a>;
<a name="l00547"></a>00547         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a9f933b300ef63eea367ca82f8da31025">vaddr</a> &gt;= ttbr1_min) {
<a name="l00548"></a>00548             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classArmISA_1_1TLB.html">TLB</a>, <span class="stringliteral">&quot; - Selecting TTBR1 (long-desc.)\n&quot;</span>);
<a name="l00549"></a>00549             <span class="comment">// Check if table walk is allowed</span>
<a name="l00550"></a>00550             <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ad6762be565087b4bfb87f5bcb42673e7">ttbcr</a>.epd1) {
<a name="l00551"></a>00551                 <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#aa863dbd5a3e20baa5acb07e373c42ddc">isFetch</a>)
<a name="l00552"></a>00552                     <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classArmISA_1_1PrefetchAbort.html">PrefetchAbort</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a1ebff4da206a1799d70b4ec129c33c5a">vaddr_tainted</a>,
<a name="l00553"></a>00553                                              <a class="code" href="classArmISA_1_1ArmFault.html#a8771a605c5b916759188c3a191bb6202a36a8d822dd25492d60c859de5400455b">ArmFault::TranslationLL</a> + <a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bdae5bc7ee7d6dda5340a28f91834f10543">L1</a>,
<a name="l00554"></a>00554                                              <a class="code" href="classArmISA_1_1TableWalker.html#a475f8007920fb01f7f8aa1730b3016bb">isStage2</a>,
<a name="l00555"></a>00555                                              <a class="code" href="classArmISA_1_1ArmFault.html#ad78237d6390becbe8bdf9e73979c56aea307d48bbc198c224e04bf57415c05dcd">ArmFault::LpaeTran</a>);
<a name="l00556"></a>00556                 <span class="keywordflow">else</span>
<a name="l00557"></a>00557                     <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classArmISA_1_1DataAbort.html">DataAbort</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a1ebff4da206a1799d70b4ec129c33c5a">vaddr_tainted</a>,
<a name="l00558"></a>00558                                          TlbEntry::DomainType::NoAccess,
<a name="l00559"></a>00559                                          <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a0775ef609f39793da4e2adb3a0e2ded1">isWrite</a>,
<a name="l00560"></a>00560                                          <a class="code" href="classArmISA_1_1ArmFault.html#a8771a605c5b916759188c3a191bb6202a36a8d822dd25492d60c859de5400455b">ArmFault::TranslationLL</a> + <a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bdae5bc7ee7d6dda5340a28f91834f10543">L1</a>,
<a name="l00561"></a>00561                                          <a class="code" href="classArmISA_1_1TableWalker.html#a475f8007920fb01f7f8aa1730b3016bb">isStage2</a>,
<a name="l00562"></a>00562                                          <a class="code" href="classArmISA_1_1ArmFault.html#ad78237d6390becbe8bdf9e73979c56aea307d48bbc198c224e04bf57415c05dcd">ArmFault::LpaeTran</a>);
<a name="l00563"></a>00563             }
<a name="l00564"></a>00564             ttbr = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>-&gt;<a class="code" href="classThreadContext.html#a6888f4bff21e34892e59654ea80073b2">readMiscReg</a>(<a class="code" href="namespaceArmISA.html#a939d9e820fe2a05cb16413fe88dc1887">flattenMiscRegNsBanked</a>(
<a name="l00565"></a>00565                 <a class="code" href="namespaceArmISA.html#a1e522017e015d4c7efd6b2360143aa67a8fcade2139fd8facbbeefb69cc2ad774">MISCREG_TTBR1</a>, <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>, !<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a62bc84f4251f16cf0cfa0f8d96e00c37">isSecure</a>));
<a name="l00566"></a>00566             tsz = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ad6762be565087b4bfb87f5bcb42673e7">ttbcr</a>.t1sz;
<a name="l00567"></a>00567             <span class="keywordflow">if</span> (ttbr1_min &gt;= (1<a class="code" href="base_2types_8hh.html#adcc3cf526a71c0dfaae020d432c78b83">ULL</a> &lt;&lt; 31) + (1<a class="code" href="base_2types_8hh.html#adcc3cf526a71c0dfaae020d432c78b83">ULL</a> &lt;&lt; 30))  <span class="comment">// Lower limit &gt;= 3 GB</span>
<a name="l00568"></a>00568                 start_lookup_level = <a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bda0adffb24dae0c41be5b803f4d444f066">L2</a>;
<a name="l00569"></a>00569         } <span class="keywordflow">else</span> {
<a name="l00570"></a>00570             <span class="comment">// Out of boundaries -&gt; translation fault</span>
<a name="l00571"></a>00571             <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#aa863dbd5a3e20baa5acb07e373c42ddc">isFetch</a>)
<a name="l00572"></a>00572                 <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classArmISA_1_1PrefetchAbort.html">PrefetchAbort</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a1ebff4da206a1799d70b4ec129c33c5a">vaddr_tainted</a>,
<a name="l00573"></a>00573                                          <a class="code" href="classArmISA_1_1ArmFault.html#a8771a605c5b916759188c3a191bb6202a36a8d822dd25492d60c859de5400455b">ArmFault::TranslationLL</a> + <a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bdae5bc7ee7d6dda5340a28f91834f10543">L1</a>,
<a name="l00574"></a>00574                                          <a class="code" href="classArmISA_1_1TableWalker.html#a475f8007920fb01f7f8aa1730b3016bb">isStage2</a>,
<a name="l00575"></a>00575                                          <a class="code" href="classArmISA_1_1ArmFault.html#ad78237d6390becbe8bdf9e73979c56aea307d48bbc198c224e04bf57415c05dcd">ArmFault::LpaeTran</a>);
<a name="l00576"></a>00576             <span class="keywordflow">else</span>
<a name="l00577"></a>00577                 <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classArmISA_1_1DataAbort.html">DataAbort</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a1ebff4da206a1799d70b4ec129c33c5a">vaddr_tainted</a>,
<a name="l00578"></a>00578                                      TlbEntry::DomainType::NoAccess,
<a name="l00579"></a>00579                                      <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a0775ef609f39793da4e2adb3a0e2ded1">isWrite</a>, <a class="code" href="classArmISA_1_1ArmFault.html#a8771a605c5b916759188c3a191bb6202a36a8d822dd25492d60c859de5400455b">ArmFault::TranslationLL</a> + <a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bdae5bc7ee7d6dda5340a28f91834f10543">L1</a>,
<a name="l00580"></a>00580                                      <a class="code" href="classArmISA_1_1TableWalker.html#a475f8007920fb01f7f8aa1730b3016bb">isStage2</a>, <a class="code" href="classArmISA_1_1ArmFault.html#ad78237d6390becbe8bdf9e73979c56aea307d48bbc198c224e04bf57415c05dcd">ArmFault::LpaeTran</a>);
<a name="l00581"></a>00581         }
<a name="l00582"></a>00582 
<a name="l00583"></a>00583     }
<a name="l00584"></a>00584 
<a name="l00585"></a>00585     <span class="comment">// Perform lookup (ARM ARM issue C B3.6.6)</span>
<a name="l00586"></a>00586     <span class="keywordflow">if</span> (start_lookup_level == <a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bdae5bc7ee7d6dda5340a28f91834f10543">L1</a>) {
<a name="l00587"></a>00587         n = 5 - tsz;
<a name="l00588"></a>00588         desc_addr = <a class="code" href="bitfield_8hh.html#acaa3c424fec3407f14a01fe1ec22c2d4">mbits</a>(ttbr, 39, n) |
<a name="l00589"></a>00589             (<a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123">bits</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a9f933b300ef63eea367ca82f8da31025">vaddr</a>, n + 26, 30) &lt;&lt; 3);
<a name="l00590"></a>00590         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classArmISA_1_1TLB.html">TLB</a>, <span class="stringliteral">&quot; - Descriptor at address %#x (%s) (long-desc.)\n&quot;</span>,
<a name="l00591"></a>00591                 desc_addr, <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a62bc84f4251f16cf0cfa0f8d96e00c37">isSecure</a> ? <span class="stringliteral">&quot;s&quot;</span> : <span class="stringliteral">&quot;ns&quot;</span>);
<a name="l00592"></a>00592     } <span class="keywordflow">else</span> {
<a name="l00593"></a>00593         <span class="comment">// Skip first-level lookup</span>
<a name="l00594"></a>00594         n = (tsz &gt;= 2 ? 14 - tsz : 12);
<a name="l00595"></a>00595         desc_addr = <a class="code" href="bitfield_8hh.html#acaa3c424fec3407f14a01fe1ec22c2d4">mbits</a>(ttbr, 39, n) |
<a name="l00596"></a>00596             (<a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123">bits</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a9f933b300ef63eea367ca82f8da31025">vaddr</a>, n + 17, 21) &lt;&lt; 3);
<a name="l00597"></a>00597         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classArmISA_1_1TLB.html">TLB</a>, <span class="stringliteral">&quot; - Descriptor at address %#x (%s) (long-desc.)\n&quot;</span>,
<a name="l00598"></a>00598                 desc_addr, <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a62bc84f4251f16cf0cfa0f8d96e00c37">isSecure</a> ? <span class="stringliteral">&quot;s&quot;</span> : <span class="stringliteral">&quot;ns&quot;</span>);
<a name="l00599"></a>00599     }
<a name="l00600"></a>00600 
<a name="l00601"></a>00601     <span class="comment">// Trickbox address check</span>
<a name="l00602"></a>00602     <a class="code" href="classRefCountingPtr.html">Fault</a> <a class="code" href="namespaceArmISA.html#ac1e4a6891d41a331cd7184329e5416ec">f</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a9f0e11329a702fd34819769c899e4bd3">tlb</a>-&gt;<a class="code" href="classArmISA_1_1TLB.html#a19bf31f32ec6125d85acc1feeee28e47">walkTrickBoxCheck</a>(desc_addr, <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a62bc84f4251f16cf0cfa0f8d96e00c37">isSecure</a>,
<a name="l00603"></a>00603                         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a9f933b300ef63eea367ca82f8da31025">vaddr</a>, <span class="keyword">sizeof</span>(uint64_t), <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#aa863dbd5a3e20baa5acb07e373c42ddc">isFetch</a>,
<a name="l00604"></a>00604                         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a0775ef609f39793da4e2adb3a0e2ded1">isWrite</a>, TlbEntry::DomainType::NoAccess,
<a name="l00605"></a>00605                         start_lookup_level);
<a name="l00606"></a>00606     <span class="keywordflow">if</span> (f) {
<a name="l00607"></a>00607         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classArmISA_1_1TLB.html">TLB</a>, <span class="stringliteral">&quot;Trickbox check caused fault on %#x\n&quot;</span>, <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a1ebff4da206a1799d70b4ec129c33c5a">vaddr_tainted</a>);
<a name="l00608"></a>00608         <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a20f65ad56869382ed8681b9dd1aa85d6">timing</a>) {
<a name="l00609"></a>00609             <a class="code" href="classArmISA_1_1TableWalker.html#a39f16d585c4531d2bf2562631a775d73">pending</a> = <span class="keyword">false</span>;
<a name="l00610"></a>00610             <a class="code" href="classArmISA_1_1TableWalker.html#ae126e9ab023c3e4659836daa8f5364be">nextWalk</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>);
<a name="l00611"></a>00611             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00612"></a>00612         } <span class="keywordflow">else</span> {
<a name="l00613"></a>00613             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00614"></a>00614             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a956cd41d82347558b9c0a5b0474903f2">req</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00615"></a>00615         }
<a name="l00616"></a>00616         <span class="keywordflow">return</span> f;
<a name="l00617"></a>00617     }
<a name="l00618"></a>00618 
<a name="l00619"></a>00619     <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a43c4d132ca97c6cc5358f7be3c2b5a69">sctlr</a>.c == 0) {
<a name="l00620"></a>00620         flag = <a class="code" href="classRequest.html#a0fc1d6bc92a0567b05130468e04f05f8">Request::UNCACHEABLE</a>;
<a name="l00621"></a>00621     }
<a name="l00622"></a>00622 
<a name="l00623"></a>00623     <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a62bc84f4251f16cf0cfa0f8d96e00c37">isSecure</a>)
<a name="l00624"></a>00624         flag.<a class="code" href="classFlags.html#a8bf75cf89ee252c33f05dd2e8e06d351">set</a>(<a class="code" href="classRequest.html#a096bc7521755b6680d9a1988a6c9b109">Request::SECURE</a>);
<a name="l00625"></a>00625 
<a name="l00626"></a>00626     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1DescriptorBase.html#a88477771eb7d27741455a8035678c67a">lookupLevel</a> = start_lookup_level;
<a name="l00627"></a>00627     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1LongDescriptor.html#a52c06c8a54293998f3e1f71cdbd916f7">aarch64</a> = <span class="keyword">false</span>;
<a name="l00628"></a>00628     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1LongDescriptor.html#a0147ae2ff00e021ff30ba60e73de3e09">largeGrain</a> = <span class="keyword">false</span>;
<a name="l00629"></a>00629     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1LongDescriptor.html#a887606cb7c0d8e19afb1a67ac7293519">grainSize</a> = 12;
<a name="l00630"></a>00630 
<a name="l00631"></a>00631     Event *<span class="keyword">event</span> = start_lookup_level == <a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bdae5bc7ee7d6dda5340a28f91834f10543">L1</a> ? (Event *) &amp;<a class="code" href="classArmISA_1_1TableWalker.html#a5ab01b63bbaded2920f4e72569b63759">doL1LongDescEvent</a>
<a name="l00632"></a>00632                                             : (Event *) &amp;<a class="code" href="classArmISA_1_1TableWalker.html#a987d9ee7304c356462000428178c6c5e">doL2LongDescEvent</a>;
<a name="l00633"></a>00633 
<a name="l00634"></a>00634     <span class="keywordtype">bool</span> delayed = <a class="code" href="classArmISA_1_1TableWalker.html#a583b81ca3090f4eb8014ec261cadeb6e">fetchDescriptor</a>(desc_addr, (uint8_t*)&amp;<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab6842b95aee60fd76eb273b80bcc566a">longDesc</a>.<a class="code" href="classArmISA_1_1TableWalker_1_1LongDescriptor.html#ae421a8889820e685feae3e58e1d5fca0">data</a>,
<a name="l00635"></a>00635                                    <span class="keyword">sizeof</span>(uint64_t), flag, start_lookup_level,
<a name="l00636"></a>00636                                    <a class="code" href="namespaceMipsISA.html#aa3b803f4777161a2825178dabfb154f0">event</a>, &amp;<a class="code" href="classArmISA_1_1TableWalker.html#abba315db7bc859eeb10035be0dcc1168">TableWalker::doLongDescriptor</a>);
<a name="l00637"></a>00637     <span class="keywordflow">if</span> (!delayed) {
<a name="l00638"></a>00638         f = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a68714ceb74c60ea7ef5dec335bb6c5d7">fault</a>;
<a name="l00639"></a>00639     }
<a name="l00640"></a>00640 
<a name="l00641"></a>00641     <span class="keywordflow">return</span> f;
<a name="l00642"></a>00642 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3e744e2a92a9edac5d9859823bb1ccc8"></a><!-- doxytag: member="ArmISA::TableWalker::processWalkWrapper" ref="a3e744e2a92a9edac5d9859823bb1ccc8" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void processWalkWrapper </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00311"></a>00311 {
<a name="l00312"></a>00312     assert(!<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>);
<a name="l00313"></a>00313     assert(<a class="code" href="classArmISA_1_1TableWalker.html#a53a70edbb255426f7f2729f482c7109b">pendingQueue</a>.size());
<a name="l00314"></a>00314     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a53a70edbb255426f7f2729f482c7109b">pendingQueue</a>.front();
<a name="l00315"></a>00315 
<a name="l00316"></a>00316     <a class="code" href="namespaceArmISA.html#a16588a7a92eb985c3341b7f706c81dd5">ExceptionLevel</a> target_el = <a class="code" href="namespaceArmISA.html#a16588a7a92eb985c3341b7f706c81dd5a1808d294e1d965cd8d1a3060e2f411ef">EL0</a>;
<a name="l00317"></a>00317     <span class="keywordflow">if</span> (currState-&gt;aarch64)
<a name="l00318"></a>00318         target_el = <a class="code" href="namespaceArmISA.html#a7d0efb0cabf7164c98bf8eddda31c1a8">currEL</a>(currState-&gt;tc);
<a name="l00319"></a>00319     <span class="keywordflow">else</span>
<a name="l00320"></a>00320         target_el = <a class="code" href="namespaceArmISA.html#a16588a7a92eb985c3341b7f706c81dd5ab5e42aaf40f117fdce042d02976bf090">EL1</a>;
<a name="l00321"></a>00321 
<a name="l00322"></a>00322     <span class="comment">// Check if a previous walk filled this request already</span>
<a name="l00323"></a>00323     <span class="comment">// @TODO Should this always be the TLB or should we look in the stage2 TLB?</span>
<a name="l00324"></a>00324     <a class="code" href="structArmISA_1_1TlbEntry.html">TlbEntry</a>* <a class="code" href="namespaceMipsISA.html#a49c5c4308a3fe2af210c807bd186b780">te</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a9f0e11329a702fd34819769c899e4bd3">tlb</a>-&gt;<a class="code" href="classArmISA_1_1TLB.html#a16c4d359f56a027d2e6afe6af85c81e4">lookup</a>(currState-&gt;vaddr, currState-&gt;asid,
<a name="l00325"></a>00325             currState-&gt;vmid, currState-&gt;isHyp, currState-&gt;isSecure, <span class="keyword">true</span>, <span class="keyword">false</span>,
<a name="l00326"></a>00326             target_el);
<a name="l00327"></a>00327 
<a name="l00328"></a>00328     <span class="comment">// Check if we still need to have a walk for this request. If the requesting</span>
<a name="l00329"></a>00329     <span class="comment">// instruction has been squashed, or a previous walk has filled the TLB with</span>
<a name="l00330"></a>00330     <span class="comment">// a match, we just want to get rid of the walk. The latter could happen</span>
<a name="l00331"></a>00331     <span class="comment">// when there are multiple outstanding misses to a single page and a</span>
<a name="l00332"></a>00332     <span class="comment">// previous request has been successfully translated.</span>
<a name="l00333"></a>00333     <span class="keywordflow">if</span> (!currState-&gt;transState-&gt;squashed() &amp;&amp; !te) {
<a name="l00334"></a>00334         <span class="comment">// We&apos;ve got a valid request, lets process it</span>
<a name="l00335"></a>00335         <a class="code" href="classArmISA_1_1TableWalker.html#a39f16d585c4531d2bf2562631a775d73">pending</a> = <span class="keyword">true</span>;
<a name="l00336"></a>00336         <a class="code" href="classArmISA_1_1TableWalker.html#a53a70edbb255426f7f2729f482c7109b">pendingQueue</a>.pop_front();
<a name="l00337"></a>00337         <span class="keywordflow">if</span> (currState-&gt;aarch64)
<a name="l00338"></a>00338             <a class="code" href="classArmISA_1_1TableWalker.html#a8530d760b97c61b1bf18de8228c3aa90">processWalkAArch64</a>();
<a name="l00339"></a>00339         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code" href="classArmISA_1_1TableWalker.html#a74ac6c840c516a9b8a6eb63ed9ef1185">_haveLPAE</a> &amp;&amp; currState-&gt;ttbcr.eae) || currState-&gt;isHyp || <a class="code" href="classArmISA_1_1TableWalker.html#a475f8007920fb01f7f8aa1730b3016bb">isStage2</a>)
<a name="l00340"></a>00340             <a class="code" href="classArmISA_1_1TableWalker.html#a81c7003e58d3e96e25e66f221701669e">processWalkLPAE</a>();
<a name="l00341"></a>00341         <span class="keywordflow">else</span>
<a name="l00342"></a>00342             <a class="code" href="classArmISA_1_1TableWalker.html#a13d6e703bfb2074a12535d21689a16d5">processWalk</a>();
<a name="l00343"></a>00343         <span class="keywordflow">return</span>;
<a name="l00344"></a>00344     }
<a name="l00345"></a>00345 
<a name="l00346"></a>00346 
<a name="l00347"></a>00347     <span class="comment">// If the instruction that we were translating for has been</span>
<a name="l00348"></a>00348     <span class="comment">// squashed we shouldn&apos;t bother.</span>
<a name="l00349"></a>00349     <span class="keywordtype">unsigned</span> num_squashed = 0;
<a name="l00350"></a>00350     <a class="code" href="classThreadContext.html">ThreadContext</a> *<a class="code" href="namespaceArmISA.html#a5aff829af55e65b802d83dfcef4e9dd0">tc</a> = currState-&gt;tc;
<a name="l00351"></a>00351     <span class="keywordflow">while</span> ((num_squashed &lt; <a class="code" href="classArmISA_1_1TableWalker.html#acd34c708c5a97f4ce631bb3b00404045">numSquashable</a>) &amp;&amp; currState &amp;&amp;
<a name="l00352"></a>00352            (currState-&gt;transState-&gt;squashed() || te)) {
<a name="l00353"></a>00353         <a class="code" href="classArmISA_1_1TableWalker.html#a53a70edbb255426f7f2729f482c7109b">pendingQueue</a>.pop_front();
<a name="l00354"></a>00354         num_squashed++;
<a name="l00355"></a>00355 
<a name="l00356"></a>00356         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classArmISA_1_1TLB.html">TLB</a>, <span class="stringliteral">&quot;Squashing table walk for address %#x\n&quot;</span>,
<a name="l00357"></a>00357                       currState-&gt;vaddr_tainted);
<a name="l00358"></a>00358 
<a name="l00359"></a>00359         <span class="keywordflow">if</span> (currState-&gt;transState-&gt;squashed()) {
<a name="l00360"></a>00360             <span class="comment">// finish the translation which will delete the translation object</span>
<a name="l00361"></a>00361             currState-&gt;transState-&gt;finish(<span class="keyword">new</span> <a class="code" href="classUnimpFault.html">UnimpFault</a>(<span class="stringliteral">&quot;Squashed Inst&quot;</span>),
<a name="l00362"></a>00362                     currState-&gt;req, currState-&gt;tc, currState-&gt;mode);
<a name="l00363"></a>00363         } <span class="keywordflow">else</span> {
<a name="l00364"></a>00364             <span class="comment">// translate the request now that we know it will work</span>
<a name="l00365"></a>00365             <a class="code" href="classArmISA_1_1TableWalker.html#a9f0e11329a702fd34819769c899e4bd3">tlb</a>-&gt;<a class="code" href="classArmISA_1_1TLB.html#aece4eb62debdc9703b211d68ce771521">translateTiming</a>(currState-&gt;req, currState-&gt;tc,
<a name="l00366"></a>00366                         currState-&gt;transState, currState-&gt;mode);
<a name="l00367"></a>00367 
<a name="l00368"></a>00368         }
<a name="l00369"></a>00369 
<a name="l00370"></a>00370         <span class="comment">// delete the current request</span>
<a name="l00371"></a>00371         <span class="keyword">delete</span> currState;
<a name="l00372"></a>00372 
<a name="l00373"></a>00373         <span class="comment">// peak at the next one</span>
<a name="l00374"></a>00374         <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a53a70edbb255426f7f2729f482c7109b">pendingQueue</a>.size()) {
<a name="l00375"></a>00375             currState = <a class="code" href="classArmISA_1_1TableWalker.html#a53a70edbb255426f7f2729f482c7109b">pendingQueue</a>.front();
<a name="l00376"></a>00376             te = <a class="code" href="classArmISA_1_1TableWalker.html#a9f0e11329a702fd34819769c899e4bd3">tlb</a>-&gt;<a class="code" href="classArmISA_1_1TLB.html#a16c4d359f56a027d2e6afe6af85c81e4">lookup</a>(currState-&gt;vaddr, currState-&gt;asid,
<a name="l00377"></a>00377                 currState-&gt;vmid, currState-&gt;isHyp, currState-&gt;isSecure, <span class="keyword">true</span>,
<a name="l00378"></a>00378                 <span class="keyword">false</span>, target_el);
<a name="l00379"></a>00379         } <span class="keywordflow">else</span> {
<a name="l00380"></a>00380             <span class="comment">// Terminate the loop, nothing more to do</span>
<a name="l00381"></a>00381             currState = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00382"></a>00382         }
<a name="l00383"></a>00383     }
<a name="l00384"></a>00384 
<a name="l00385"></a>00385     <span class="comment">// if we&apos;ve still got pending translations schedule more work</span>
<a name="l00386"></a>00386     <a class="code" href="classArmISA_1_1TableWalker.html#ae126e9ab023c3e4659836daa8f5364be">nextWalk</a>(tc);
<a name="l00387"></a>00387     currState = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00388"></a>00388     <a class="code" href="classArmISA_1_1TableWalker.html#a5807f306df98d17f68f466ded6d7799f">completeDrain</a>();
<a name="l00389"></a>00389 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae888fc9d1a9bad8784469601dcf8d436"></a><!-- doxytag: member="ArmISA::TableWalker::setMMU" ref="ae888fc9d1a9bad8784469601dcf8d436" args="(Stage2MMU *m)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void setMMU </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classArmISA_1_1Stage2MMU.html">Stage2MMU</a> *&nbsp;</td>
          <td class="paramname"> <em>m</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00901"></a>00901 { <a class="code" href="classArmISA_1_1TableWalker.html#a21ea64a0a6d9600fb09fff0854fd55d7">stage2Mmu</a> = m; }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0a70f006e7adf20d47920ac6286a2bcb"></a><!-- doxytag: member="ArmISA::TableWalker::setTlb" ref="a0a70f006e7adf20d47920ac6286a2bcb" args="(TLB *_tlb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void setTlb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classArmISA_1_1TLB.html">TLB</a> *&nbsp;</td>
          <td class="paramname"> <em>_tlb</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00899"></a>00899 { <a class="code" href="classArmISA_1_1TableWalker.html#a9f0e11329a702fd34819769c899e4bd3">tlb</a> = _tlb; }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aea45aff83099165fcb29b3c3df3de9c2"></a><!-- doxytag: member="ArmISA::TableWalker::toLookupLevel" ref="aea45aff83099165fcb29b3c3df3de9c2" args="(uint8_t lookup_level_as_int)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bd">LookupLevel</a> toLookupLevel </td>
          <td>(</td>
          <td class="paramtype">uint8_t&nbsp;</td>
          <td class="paramname"> <em>lookup_level_as_int</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l01952"></a>01952 {
<a name="l01953"></a>01953     <span class="keywordflow">switch</span> (lookup_level_as_int) {
<a name="l01954"></a>01954       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bdae5bc7ee7d6dda5340a28f91834f10543">L1</a>:
<a name="l01955"></a>01955         <span class="keywordflow">return</span> <a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bdae5bc7ee7d6dda5340a28f91834f10543">L1</a>;
<a name="l01956"></a>01956       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bda0adffb24dae0c41be5b803f4d444f066">L2</a>:
<a name="l01957"></a>01957         <span class="keywordflow">return</span> <a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bda0adffb24dae0c41be5b803f4d444f066">L2</a>;
<a name="l01958"></a>01958       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bda78d20b793a10e7c2f1012114803147c3">L3</a>:
<a name="l01959"></a>01959         <span class="keywordflow">return</span> <a class="code" href="namespaceArmISA.html#aefa4213b348e38ee69f2a6109563a7bda78d20b793a10e7c2f1012114803147c3">L3</a>;
<a name="l01960"></a>01960       <span class="keywordflow">default</span>:
<a name="l01961"></a>01961         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Invalid lookup level conversion&quot;</span>);
<a name="l01962"></a>01962     }
<a name="l01963"></a>01963 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae5ef435aac9ac661f33937b2254718b1"></a><!-- doxytag: member="ArmISA::TableWalker::walk" ref="ae5ef435aac9ac661f33937b2254718b1" args="(RequestPtr req, ThreadContext *tc, uint16_t asid, uint8_t _vmid, bool _isHyp, TLB::Mode mode, TLB::Translation *_trans, bool timing, bool functional, bool secure, TLB::ArmTranslationType tranType)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classRefCountingPtr.html">Fault</a> walk </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classRequest.html">RequestPtr</a>&nbsp;</td>
          <td class="paramname"> <em>req</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classThreadContext.html">ThreadContext</a> *&nbsp;</td>
          <td class="paramname"> <em>tc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&nbsp;</td>
          <td class="paramname"> <em>asid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&nbsp;</td>
          <td class="paramname"> <em>_vmid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>_isHyp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classBaseTLB.html#a46c8a310cf4c094f8c80e1cb8dc1f911">TLB::Mode</a>&nbsp;</td>
          <td class="paramname"> <em>mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classBaseTLB_1_1Translation.html">TLB::Translation</a> *&nbsp;</td>
          <td class="paramname"> <em>_trans</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>timing</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>functional</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>secure</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classArmISA_1_1TLB.html#ad6f5d480df151d5bddeefc6271793f08">TLB::ArmTranslationType</a>&nbsp;</td>
          <td class="paramname"> <em>tranType</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><dl class="todo"><dt><b><a class="el" href="todo.html#_todo000002">TODO:</a></b></dt><dd>These should be cached or grabbed from cached copies in the <a class="el" href="classArmISA_1_1TLB.html">TLB</a>, all these miscreg reads are expensive </dd></dl>
</p>

<p><div class="fragment"><pre class="fragment"><a name="l00161"></a>00161 {
<a name="l00162"></a>00162     assert(!(_functional &amp;&amp; _timing));
<a name="l00163"></a>00163     WalkerState *savedCurrState = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00164"></a>00164 
<a name="l00165"></a>00165     <span class="keywordflow">if</span> (!<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a> &amp;&amp; !_functional) {
<a name="l00166"></a>00166         <span class="comment">// For atomic mode, a new WalkerState instance should be only created</span>
<a name="l00167"></a>00167         <span class="comment">// once per TLB. For timing mode, a new instance is generated for every</span>
<a name="l00168"></a>00168         <span class="comment">// TLB miss.</span>
<a name="l00169"></a>00169         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(TLBVerbose, <span class="stringliteral">&quot;creating new instance of WalkerState\n&quot;</span>);
<a name="l00170"></a>00170 
<a name="l00171"></a>00171         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a> = <span class="keyword">new</span> WalkerState();
<a name="l00172"></a>00172         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ae4dec2d4d5730361d51d9f4b24dee89c">tableWalker</a> = <span class="keyword">this</span>;
<a name="l00173"></a>00173     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (_functional) {
<a name="l00174"></a>00174         <span class="comment">// If we are mixing functional mode with timing (or even</span>
<a name="l00175"></a>00175         <span class="comment">// atomic), we need to to be careful and clean up after</span>
<a name="l00176"></a>00176         <span class="comment">// ourselves to not risk getting into an inconsistent state.</span>
<a name="l00177"></a>00177         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(TLBVerbose, <span class="stringliteral">&quot;creating functional instance of WalkerState\n&quot;</span>);
<a name="l00178"></a>00178         savedCurrState = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>;
<a name="l00179"></a>00179         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a> = <span class="keyword">new</span> WalkerState();
<a name="l00180"></a>00180         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ae4dec2d4d5730361d51d9f4b24dee89c">tableWalker</a> = <span class="keyword">this</span>;
<a name="l00181"></a>00181     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (_timing) {
<a name="l00182"></a>00182         <span class="comment">// This is a translation that was completed and then faulted again</span>
<a name="l00183"></a>00183         <span class="comment">// because some underlying parameters that affect the translation</span>
<a name="l00184"></a>00184         <span class="comment">// changed out from under us (e.g. asid). It will either be a</span>
<a name="l00185"></a>00185         <span class="comment">// misprediction, in which case nothing will happen or we&apos;ll use</span>
<a name="l00186"></a>00186         <span class="comment">// this fault to re-execute the faulting instruction which should clean</span>
<a name="l00187"></a>00187         <span class="comment">// up everything.</span>
<a name="l00188"></a>00188         <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a1ebff4da206a1799d70b4ec129c33c5a">vaddr_tainted</a> == _req-&gt;getVaddr()) {
<a name="l00189"></a>00189             <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classReExec.html">ReExec</a>;
<a name="l00190"></a>00190         }
<a name="l00191"></a>00191     }
<a name="l00192"></a>00192 
<a name="l00193"></a>00193     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a> = _tc;
<a name="l00194"></a>00194     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a52c06c8a54293998f3e1f71cdbd916f7">aarch64</a> = opModeIs64(<a class="code" href="namespaceArmISA.html#a89bff2ee523d372c456087b77df1a43b">currOpMode</a>(_tc));
<a name="l00195"></a>00195     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a878510cdbf1a6438f83754acbdbf759a">el</a> = <a class="code" href="namespaceArmISA.html#a7d0efb0cabf7164c98bf8eddda31c1a8">currEL</a>(_tc);
<a name="l00196"></a>00196     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab84349f9e7472233bc23dfdc0968ba57">transState</a> = _trans;
<a name="l00197"></a>00197     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a956cd41d82347558b9c0a5b0474903f2">req</a> = _req;
<a name="l00198"></a>00198     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a68714ceb74c60ea7ef5dec335bb6c5d7">fault</a> = <a class="code" href="fault__fwd_8hh.html#ab8ce3b69a6737f63fcdcf99910feb153">NoFault</a>;
<a name="l00199"></a>00199     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a984a2dcfd9509ab586bee117bb2a7cfb">asid</a> = _asid;
<a name="l00200"></a>00200     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#add293169f7f2ac526b3fa14f950cf0bb">vmid</a> = _vmid;
<a name="l00201"></a>00201     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a104c09577173edc4f8ce6814cc33f0ae">isHyp</a> = _isHyp;
<a name="l00202"></a>00202     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a20f65ad56869382ed8681b9dd1aa85d6">timing</a> = _timing;
<a name="l00203"></a>00203     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4f60754b74e2d1584c06199ae5b75f21">functional</a> = _functional;
<a name="l00204"></a>00204     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ae9b5adf8be89a72128708c7e621e7211">mode</a> = _mode;
<a name="l00205"></a>00205     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4dbccde8be57f0db41d7dd786c199318">tranType</a> = tranType;
<a name="l00206"></a>00206     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a62bc84f4251f16cf0cfa0f8d96e00c37">isSecure</a> = secure;
<a name="l00207"></a>00207     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a54248d4ad3bc4c54e33a04257ee09280">physAddrRange</a> = <a class="code" href="classArmISA_1_1TableWalker.html#af85538fbb375410b2750035ab34dc88a">physAddrRange</a>;
<a name="l00208"></a>00208 
<a name="l00211"></a>00211     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a1ebff4da206a1799d70b4ec129c33c5a">vaddr_tainted</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a956cd41d82347558b9c0a5b0474903f2">req</a>-&gt;<a class="code" href="classRequest.html#a68d2230b37b30d25462093fefdd813ac">getVaddr</a>();
<a name="l00212"></a>00212     <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a52c06c8a54293998f3e1f71cdbd916f7">aarch64</a>)
<a name="l00213"></a>00213         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a9f933b300ef63eea367ca82f8da31025">vaddr</a> = <a class="code" href="namespaceArmISA.html#a52481fc8af3df3627260833f83bd5a83">purifyTaggedAddr</a>(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a1ebff4da206a1799d70b4ec129c33c5a">vaddr_tainted</a>,
<a name="l00214"></a>00214                                             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>, <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a878510cdbf1a6438f83754acbdbf759a">el</a>);
<a name="l00215"></a>00215     <span class="keywordflow">else</span>
<a name="l00216"></a>00216         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a9f933b300ef63eea367ca82f8da31025">vaddr</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a1ebff4da206a1799d70b4ec129c33c5a">vaddr_tainted</a>;
<a name="l00217"></a>00217 
<a name="l00218"></a>00218     <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a52c06c8a54293998f3e1f71cdbd916f7">aarch64</a>) {
<a name="l00219"></a>00219         <span class="keywordflow">switch</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a878510cdbf1a6438f83754acbdbf759a">el</a>) {
<a name="l00220"></a>00220           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a16588a7a92eb985c3341b7f706c81dd5a1808d294e1d965cd8d1a3060e2f411ef">EL0</a>:
<a name="l00221"></a>00221           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a16588a7a92eb985c3341b7f706c81dd5ab5e42aaf40f117fdce042d02976bf090">EL1</a>:
<a name="l00222"></a>00222             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a43c4d132ca97c6cc5358f7be3c2b5a69">sctlr</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>-&gt;<a class="code" href="classThreadContext.html#a6888f4bff21e34892e59654ea80073b2">readMiscReg</a>(<a class="code" href="namespaceArmISA.html#a1e522017e015d4c7efd6b2360143aa67a1a506d32b88375eba1e5b6441a03deee">MISCREG_SCTLR_EL1</a>);
<a name="l00223"></a>00223             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ad6762be565087b4bfb87f5bcb42673e7">ttbcr</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>-&gt;<a class="code" href="classThreadContext.html#a6888f4bff21e34892e59654ea80073b2">readMiscReg</a>(<a class="code" href="namespaceArmISA.html#a1e522017e015d4c7efd6b2360143aa67aeab19dfbe4749ed1d0ef5e502fcdece3">MISCREG_TCR_EL1</a>);
<a name="l00224"></a>00224             <span class="keywordflow">break</span>;
<a name="l00225"></a>00225           <span class="comment">// @todo: uncomment this to enable Virtualization</span>
<a name="l00226"></a>00226           <span class="comment">// case EL2:</span>
<a name="l00227"></a>00227           <span class="comment">//   assert(haveVirtualization);</span>
<a name="l00228"></a>00228           <span class="comment">//   currState-&gt;sctlr = currState-&gt;tc-&gt;readMiscReg(MISCREG_SCTLR_EL2);</span>
<a name="l00229"></a>00229           <span class="comment">//   currState-&gt;ttbcr = currState-&gt;tc-&gt;readMiscReg(MISCREG_TCR_EL2);</span>
<a name="l00230"></a>00230           <span class="comment">//   break;</span>
<a name="l00231"></a>00231           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a16588a7a92eb985c3341b7f706c81dd5a44bf3e9d5387a706bdc96b1ec9a2fc15">EL3</a>:
<a name="l00232"></a>00232             assert(<a class="code" href="classArmISA_1_1TableWalker.html#a9f135583566fb70bba3c10395368f2e4">haveSecurity</a>);
<a name="l00233"></a>00233             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a43c4d132ca97c6cc5358f7be3c2b5a69">sctlr</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>-&gt;<a class="code" href="classThreadContext.html#a6888f4bff21e34892e59654ea80073b2">readMiscReg</a>(<a class="code" href="namespaceArmISA.html#a1e522017e015d4c7efd6b2360143aa67ada649d9bf9edebc6d6987cd11e43312c">MISCREG_SCTLR_EL3</a>);
<a name="l00234"></a>00234             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ad6762be565087b4bfb87f5bcb42673e7">ttbcr</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>-&gt;<a class="code" href="classThreadContext.html#a6888f4bff21e34892e59654ea80073b2">readMiscReg</a>(<a class="code" href="namespaceArmISA.html#a1e522017e015d4c7efd6b2360143aa67a2f6ba1cbb6b8d7df1e2cad05d59605d4">MISCREG_TCR_EL3</a>);
<a name="l00235"></a>00235             <span class="keywordflow">break</span>;
<a name="l00236"></a>00236           <span class="keywordflow">default</span>:
<a name="l00237"></a>00237             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Invalid exception level&quot;</span>);
<a name="l00238"></a>00238             <span class="keywordflow">break</span>;
<a name="l00239"></a>00239         }
<a name="l00240"></a>00240     } <span class="keywordflow">else</span> {
<a name="l00241"></a>00241         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a43c4d132ca97c6cc5358f7be3c2b5a69">sctlr</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>-&gt;<a class="code" href="classThreadContext.html#a6888f4bff21e34892e59654ea80073b2">readMiscReg</a>(<a class="code" href="namespaceArmISA.html#a939d9e820fe2a05cb16413fe88dc1887">flattenMiscRegNsBanked</a>(
<a name="l00242"></a>00242             <a class="code" href="namespaceArmISA.html#a1e522017e015d4c7efd6b2360143aa67a6ccaca13fd4f971f5d736c2abab6bb2e">MISCREG_SCTLR</a>, <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>, !<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a62bc84f4251f16cf0cfa0f8d96e00c37">isSecure</a>));
<a name="l00243"></a>00243         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ad6762be565087b4bfb87f5bcb42673e7">ttbcr</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>-&gt;<a class="code" href="classThreadContext.html#a6888f4bff21e34892e59654ea80073b2">readMiscReg</a>(<a class="code" href="namespaceArmISA.html#a939d9e820fe2a05cb16413fe88dc1887">flattenMiscRegNsBanked</a>(
<a name="l00244"></a>00244             <a class="code" href="namespaceArmISA.html#a1e522017e015d4c7efd6b2360143aa67a713784be56a50e1dd69613088bb6af38">MISCREG_TTBCR</a>, <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>, !<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a62bc84f4251f16cf0cfa0f8d96e00c37">isSecure</a>));
<a name="l00245"></a>00245         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a1ee934c0734a2ed4bd4d867f55aa3d97">htcr</a>  = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>-&gt;<a class="code" href="classThreadContext.html#a6888f4bff21e34892e59654ea80073b2">readMiscReg</a>(<a class="code" href="namespaceArmISA.html#a1e522017e015d4c7efd6b2360143aa67aba0b3e31d11ca5dabf11b8244f9f86cf">MISCREG_HTCR</a>);
<a name="l00246"></a>00246         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ad0d8df2e2be956266458221c23763b4c">hcr</a>   = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>-&gt;<a class="code" href="classThreadContext.html#a6888f4bff21e34892e59654ea80073b2">readMiscReg</a>(<a class="code" href="namespaceArmISA.html#a1e522017e015d4c7efd6b2360143aa67a0ace8ce99b1d3c9ac0a0046e0d3db777">MISCREG_HCR</a>);
<a name="l00247"></a>00247         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a284bfeb0db142a055935ae3d133893d1">vtcr</a>  = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>-&gt;<a class="code" href="classThreadContext.html#a6888f4bff21e34892e59654ea80073b2">readMiscReg</a>(<a class="code" href="namespaceArmISA.html#a1e522017e015d4c7efd6b2360143aa67a279d125afc274e2b675caf77b79615be">MISCREG_VTCR</a>);
<a name="l00248"></a>00248     }
<a name="l00249"></a>00249     <a class="code" href="classArmISA_1_1TableWalker.html#a43c4d132ca97c6cc5358f7be3c2b5a69">sctlr</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a43c4d132ca97c6cc5358f7be3c2b5a69">sctlr</a>;
<a name="l00250"></a>00250 
<a name="l00251"></a>00251     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#aa863dbd5a3e20baa5acb07e373c42ddc">isFetch</a> = (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ae9b5adf8be89a72128708c7e621e7211">mode</a> == <a class="code" href="classBaseTLB.html#a46c8a310cf4c094f8c80e1cb8dc1f911a31b7313c05d32519f3869a3de8be95e6">TLB::Execute</a>);
<a name="l00252"></a>00252     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a0775ef609f39793da4e2adb3a0e2ded1">isWrite</a> = (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ae9b5adf8be89a72128708c7e621e7211">mode</a> == <a class="code" href="classBaseTLB.html#a46c8a310cf4c094f8c80e1cb8dc1f911aa56670174817e3fed92bfd8182d7c0d1">TLB::Write</a>);
<a name="l00253"></a>00253 
<a name="l00254"></a>00254     <span class="comment">// We only do a second stage of translation if we&apos;re not secure, or in</span>
<a name="l00255"></a>00255     <span class="comment">// hyp mode, the second stage MMU is enabled, and this table walker</span>
<a name="l00256"></a>00256     <span class="comment">// instance is the first stage.</span>
<a name="l00257"></a>00257     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a8277e995719b58e8da5a0aa5bba2e623">doingStage2</a> = <span class="keyword">false</span>;
<a name="l00258"></a>00258     <span class="comment">// @todo: for now disable this in AArch64 (HCR is not set)</span>
<a name="l00259"></a>00259     <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a52120124577a3b7c28a4e8876cd36a8b">stage2Req</a> = !<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a52c06c8a54293998f3e1f71cdbd916f7">aarch64</a> &amp;&amp; <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ad0d8df2e2be956266458221c23763b4c">hcr</a>.vm &amp;&amp;
<a name="l00260"></a>00260                            !<a class="code" href="classArmISA_1_1TableWalker.html#a475f8007920fb01f7f8aa1730b3016bb">isStage2</a> &amp;&amp; !<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a62bc84f4251f16cf0cfa0f8d96e00c37">isSecure</a> &amp;&amp; !<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a104c09577173edc4f8ce6814cc33f0ae">isHyp</a>;
<a name="l00261"></a>00261 
<a name="l00262"></a>00262     <span class="keywordtype">bool</span> long_desc_format = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a52c06c8a54293998f3e1f71cdbd916f7">aarch64</a> ||
<a name="l00263"></a>00263                             (<a class="code" href="classArmISA_1_1TableWalker.html#a74ac6c840c516a9b8a6eb63ed9ef1185">_haveLPAE</a> &amp;&amp; <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ad6762be565087b4bfb87f5bcb42673e7">ttbcr</a>.eae) ||
<a name="l00264"></a>00264                             _isHyp || <a class="code" href="classArmISA_1_1TableWalker.html#a475f8007920fb01f7f8aa1730b3016bb">isStage2</a>;
<a name="l00265"></a>00265 
<a name="l00266"></a>00266     <span class="keywordflow">if</span> (long_desc_format) {
<a name="l00267"></a>00267         <span class="comment">// Helper variables used for hierarchical permissions</span>
<a name="l00268"></a>00268         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#aa8accf2e55a1d194420c61e85b53efb5">secureLookup</a> = <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a62bc84f4251f16cf0cfa0f8d96e00c37">isSecure</a>;
<a name="l00269"></a>00269         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a419a9be86581a6eba5d7f4a22f0f6e76">rwTable</a> = <span class="keyword">true</span>;
<a name="l00270"></a>00270         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#ab4be9ffb2fe22576e2f587374fdd20e6">userTable</a> = <span class="keyword">true</span>;
<a name="l00271"></a>00271         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a34b92e09eece01cfa45e9b9d0b7f74c6">xnTable</a> = <span class="keyword">false</span>;
<a name="l00272"></a>00272         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a92af2e7b7b80463a6bbf8ccead3af087">pxnTable</a> = <span class="keyword">false</span>;
<a name="l00273"></a>00273     }
<a name="l00274"></a>00274 
<a name="l00275"></a>00275     <span class="keywordflow">if</span> (!<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a20f65ad56869382ed8681b9dd1aa85d6">timing</a>) {
<a name="l00276"></a>00276         <a class="code" href="classRefCountingPtr.html">Fault</a> fault = <a class="code" href="fault__fwd_8hh.html#ab8ce3b69a6737f63fcdcf99910feb153">NoFault</a>;
<a name="l00277"></a>00277         <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a52c06c8a54293998f3e1f71cdbd916f7">aarch64</a>)
<a name="l00278"></a>00278             fault = <a class="code" href="classArmISA_1_1TableWalker.html#a8530d760b97c61b1bf18de8228c3aa90">processWalkAArch64</a>();
<a name="l00279"></a>00279         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (long_desc_format)
<a name="l00280"></a>00280             fault = <a class="code" href="classArmISA_1_1TableWalker.html#a81c7003e58d3e96e25e66f221701669e">processWalkLPAE</a>();
<a name="l00281"></a>00281         <span class="keywordflow">else</span>
<a name="l00282"></a>00282             fault = <a class="code" href="classArmISA_1_1TableWalker.html#a13d6e703bfb2074a12535d21689a16d5">processWalk</a>();
<a name="l00283"></a>00283 
<a name="l00284"></a>00284         <span class="comment">// If this was a functional non-timing access restore state to</span>
<a name="l00285"></a>00285         <span class="comment">// how we found it.</span>
<a name="l00286"></a>00286         <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a4f60754b74e2d1584c06199ae5b75f21">functional</a>) {
<a name="l00287"></a>00287             <span class="keyword">delete</span> <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>;
<a name="l00288"></a>00288             <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a> = savedCurrState;
<a name="l00289"></a>00289         }
<a name="l00290"></a>00290         <span class="keywordflow">return</span> fault;
<a name="l00291"></a>00291     }
<a name="l00292"></a>00292 
<a name="l00293"></a>00293     <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a39f16d585c4531d2bf2562631a775d73">pending</a> || <a class="code" href="classArmISA_1_1TableWalker.html#a53a70edbb255426f7f2729f482c7109b">pendingQueue</a>.size()) {
<a name="l00294"></a>00294         <a class="code" href="classArmISA_1_1TableWalker.html#a53a70edbb255426f7f2729f482c7109b">pendingQueue</a>.push_back(<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>);
<a name="l00295"></a>00295         <a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00296"></a>00296     } <span class="keywordflow">else</span> {
<a name="l00297"></a>00297         <a class="code" href="classArmISA_1_1TableWalker.html#a39f16d585c4531d2bf2562631a775d73">pending</a> = <span class="keyword">true</span>;
<a name="l00298"></a>00298         <span class="keywordflow">if</span> (<a class="code" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a>-&gt;<a class="code" href="classArmISA_1_1TableWalker_1_1WalkerState.html#a52c06c8a54293998f3e1f71cdbd916f7">aarch64</a>)
<a name="l00299"></a>00299             <span class="keywordflow">return</span> <a class="code" href="classArmISA_1_1TableWalker.html#a8530d760b97c61b1bf18de8228c3aa90">processWalkAArch64</a>();
<a name="l00300"></a>00300         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (long_desc_format)
<a name="l00301"></a>00301             <span class="keywordflow">return</span> <a class="code" href="classArmISA_1_1TableWalker.html#a81c7003e58d3e96e25e66f221701669e">processWalkLPAE</a>();
<a name="l00302"></a>00302         <span class="keywordflow">else</span>
<a name="l00303"></a>00303             <span class="keywordflow">return</span> <a class="code" href="classArmISA_1_1TableWalker.html#a13d6e703bfb2074a12535d21689a16d5">processWalk</a>();
<a name="l00304"></a>00304     }
<a name="l00305"></a>00305 
<a name="l00306"></a>00306     <span class="keywordflow">return</span> <a class="code" href="fault__fwd_8hh.html#ab8ce3b69a6737f63fcdcf99910feb153">NoFault</a>;
<a name="l00307"></a>00307 }
</pre></div></p>

</div>
</div>
<hr/><h2>変数</h2>
<a class="anchor" id="af7d46e1faf4b0edb95f404a28e31902d"></a><!-- doxytag: member="ArmISA::TableWalker::_haveLargeAsid64" ref="af7d46e1faf4b0edb95f404a28e31902d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classArmISA_1_1TableWalker.html#af7d46e1faf4b0edb95f404a28e31902d">_haveLargeAsid64</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a74ac6c840c516a9b8a6eb63ed9ef1185"></a><!-- doxytag: member="ArmISA::TableWalker::_haveLPAE" ref="a74ac6c840c516a9b8a6eb63ed9ef1185" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classArmISA_1_1TableWalker.html#a74ac6c840c516a9b8a6eb63ed9ef1185">_haveLPAE</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a8327a5b4e38733a0d77ae856ba67725f"></a><!-- doxytag: member="ArmISA::TableWalker::_haveVirtualization" ref="a8327a5b4e38733a0d77ae856ba67725f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classArmISA_1_1TableWalker.html#a8327a5b4e38733a0d77ae856ba67725f">_haveVirtualization</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a937afcdcc940e8070627553eaebfa58a"></a><!-- doxytag: member="ArmISA::TableWalker::armSys" ref="a937afcdcc940e8070627553eaebfa58a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classArmSystem.html">ArmSystem</a>* <a class="el" href="classArmISA_1_1TableWalker.html#a937afcdcc940e8070627553eaebfa58a">armSys</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a5d1a85a0248e318a8191d54988c8782d"></a><!-- doxytag: member="ArmISA::TableWalker::currState" ref="a5d1a85a0248e318a8191d54988c8782d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classArmISA_1_1TableWalker_1_1WalkerState.html">WalkerState</a>* <a class="el" href="classArmISA_1_1TableWalker.html#a5d1a85a0248e318a8191d54988c8782d">currState</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a263fa19a40da797a24e51a5edafd9215"></a><!-- doxytag: member="ArmISA::TableWalker::doL0LongDescEvent" ref="a263fa19a40da797a24e51a5edafd9215" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classEventWrapper.html">EventWrapper</a>&lt;<a class="el" href="classArmISA_1_1TableWalker.html">TableWalker</a>, &amp;TableWalker::doL0LongDescriptorWrapper&gt; <a class="el" href="classArmISA_1_1TableWalker.html#a263fa19a40da797a24e51a5edafd9215">doL0LongDescEvent</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a896d858298222a8d8c96bc69f7db1d84"></a><!-- doxytag: member="ArmISA::TableWalker::doL1DescEvent" ref="a896d858298222a8d8c96bc69f7db1d84" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classEventWrapper.html">EventWrapper</a>&lt;<a class="el" href="classArmISA_1_1TableWalker.html">TableWalker</a>, &amp;TableWalker::doL1DescriptorWrapper&gt; <a class="el" href="classArmISA_1_1TableWalker.html#a896d858298222a8d8c96bc69f7db1d84">doL1DescEvent</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a5ab01b63bbaded2920f4e72569b63759"></a><!-- doxytag: member="ArmISA::TableWalker::doL1LongDescEvent" ref="a5ab01b63bbaded2920f4e72569b63759" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classEventWrapper.html">EventWrapper</a>&lt;<a class="el" href="classArmISA_1_1TableWalker.html">TableWalker</a>, &amp;TableWalker::doL1LongDescriptorWrapper&gt; <a class="el" href="classArmISA_1_1TableWalker.html#a5ab01b63bbaded2920f4e72569b63759">doL1LongDescEvent</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ad6bd6e623ae7ab7d1cbbe0173e9562f4"></a><!-- doxytag: member="ArmISA::TableWalker::doL2DescEvent" ref="ad6bd6e623ae7ab7d1cbbe0173e9562f4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classEventWrapper.html">EventWrapper</a>&lt;<a class="el" href="classArmISA_1_1TableWalker.html">TableWalker</a>, &amp;TableWalker::doL2DescriptorWrapper&gt; <a class="el" href="classArmISA_1_1TableWalker.html#ad6bd6e623ae7ab7d1cbbe0173e9562f4">doL2DescEvent</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a987d9ee7304c356462000428178c6c5e"></a><!-- doxytag: member="ArmISA::TableWalker::doL2LongDescEvent" ref="a987d9ee7304c356462000428178c6c5e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classEventWrapper.html">EventWrapper</a>&lt;<a class="el" href="classArmISA_1_1TableWalker.html">TableWalker</a>, &amp;TableWalker::doL2LongDescriptorWrapper&gt; <a class="el" href="classArmISA_1_1TableWalker.html#a987d9ee7304c356462000428178c6c5e">doL2LongDescEvent</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a6a30037030613a33f5a056cd7c9af535"></a><!-- doxytag: member="ArmISA::TableWalker::doL3LongDescEvent" ref="a6a30037030613a33f5a056cd7c9af535" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classEventWrapper.html">EventWrapper</a>&lt;<a class="el" href="classArmISA_1_1TableWalker.html">TableWalker</a>, &amp;TableWalker::doL3LongDescriptorWrapper&gt; <a class="el" href="classArmISA_1_1TableWalker.html#a6a30037030613a33f5a056cd7c9af535">doL3LongDescEvent</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ac0fab25a73916f1bf677990e67557b5a"></a><!-- doxytag: member="ArmISA::TableWalker::doProcessEvent" ref="ac0fab25a73916f1bf677990e67557b5a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classEventWrapper.html">EventWrapper</a>&lt;<a class="el" href="classArmISA_1_1TableWalker.html">TableWalker</a>, &amp;TableWalker::processWalkWrapper&gt; <a class="el" href="classArmISA_1_1TableWalker.html#ac0fab25a73916f1bf677990e67557b5a">doProcessEvent</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a329b71fb934a93312ca0aacbf5a3f982"></a><!-- doxytag: member="ArmISA::TableWalker::drainManager" ref="a329b71fb934a93312ca0aacbf5a3f982" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classDrainManager.html">DrainManager</a>* <a class="el" href="classArmISA_1_1TableWalker.html#a329b71fb934a93312ca0aacbf5a3f982">drainManager</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>If we're draining keep the drain event around until we're drained </p>

</div>
</div>
<a class="anchor" id="a9f135583566fb70bba3c10395368f2e4"></a><!-- doxytag: member="ArmISA::TableWalker::haveSecurity" ref="a9f135583566fb70bba3c10395368f2e4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classArmISA_1_1TableWalker.html#a9f135583566fb70bba3c10395368f2e4">haveSecurity</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Cached copies of system-level properties </p>

</div>
</div>
<a class="anchor" id="a475f8007920fb01f7f8aa1730b3016bb"></a><!-- doxytag: member="ArmISA::TableWalker::isStage2" ref="a475f8007920fb01f7f8aa1730b3016bb" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const bool <a class="el" href="classArmISA_1_1TableWalker.html#a475f8007920fb01f7f8aa1730b3016bb">isStage2</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Indicates whether this table walker is part of the stage 2 mmu </p>

</div>
</div>
<a class="anchor" id="a96ec6a422ac492d05f8b3edc5b58532b"></a><!-- doxytag: member="ArmISA::TableWalker::masterId" ref="a96ec6a422ac492d05f8b3edc5b58532b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="request_8hh.html#ac366b729262fd8e7cbd3283da6f775cf">MasterID</a> <a class="el" href="classArmISA_1_1TableWalker.html#a96ec6a422ac492d05f8b3edc5b58532b">masterId</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p><a class="el" href="classRequest.html">Request</a> id for requests generated by this walker </p>

</div>
</div>
<a class="anchor" id="acd34c708c5a97f4ce631bb3b00404045"></a><!-- doxytag: member="ArmISA::TableWalker::numSquashable" ref="acd34c708c5a97f4ce631bb3b00404045" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned <a class="el" href="classArmISA_1_1TableWalker.html#acd34c708c5a97f4ce631bb3b00404045">numSquashable</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>The number of walks belonging to squashed instructions that can be removed from the pendingQueue per cycle. </p>

</div>
</div>
<a class="anchor" id="a39f16d585c4531d2bf2562631a775d73"></a><!-- doxytag: member="ArmISA::TableWalker::pending" ref="a39f16d585c4531d2bf2562631a775d73" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classArmISA_1_1TableWalker.html#a39f16d585c4531d2bf2562631a775d73">pending</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>If a timing translation is currently in progress </p>

</div>
</div>
<a class="anchor" id="a53a70edbb255426f7f2729f482c7109b"></a><!-- doxytag: member="ArmISA::TableWalker::pendingQueue" ref="a53a70edbb255426f7f2729f482c7109b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classstd_1_1list.html">std::list</a>&lt;<a class="el" href="classArmISA_1_1TableWalker_1_1WalkerState.html">WalkerState</a> *&gt; <a class="el" href="classArmISA_1_1TableWalker.html#a53a70edbb255426f7f2729f482c7109b">pendingQueue</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Queue of requests that have passed are waiting because the walker is currently busy. </p>

</div>
</div>
<a class="anchor" id="af85538fbb375410b2750035ab34dc88a"></a><!-- doxytag: member="ArmISA::TableWalker::physAddrRange" ref="af85538fbb375410b2750035ab34dc88a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t <a class="el" href="classArmISA_1_1TableWalker.html#af85538fbb375410b2750035ab34dc88a">physAddrRange</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a9305ff92238d7360a5ee86168e00407b"></a><!-- doxytag: member="ArmISA::TableWalker::port" ref="a9305ff92238d7360a5ee86168e00407b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classArmISA_1_1TableWalker_1_1SnoopingDmaPort.html">SnoopingDmaPort</a> <a class="el" href="classArmISA_1_1TableWalker.html#a9305ff92238d7360a5ee86168e00407b">port</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p><a class="el" href="classPort.html">Port</a> to issue translation requests from </p>

</div>
</div>
<a class="anchor" id="a43c4d132ca97c6cc5358f7be3c2b5a69"></a><!-- doxytag: member="ArmISA::TableWalker::sctlr" ref="a43c4d132ca97c6cc5358f7be3c2b5a69" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">SCTLR <a class="el" href="classArmISA_1_1TableWalker.html#a43c4d132ca97c6cc5358f7be3c2b5a69">sctlr</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Cached copy of the sctlr as it existed when translation began </p>

</div>
</div>
<a class="anchor" id="a21ea64a0a6d9600fb09fff0854fd55d7"></a><!-- doxytag: member="ArmISA::TableWalker::stage2Mmu" ref="a21ea64a0a6d9600fb09fff0854fd55d7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classArmISA_1_1Stage2MMU.html">Stage2MMU</a>* <a class="el" href="classArmISA_1_1TableWalker.html#a21ea64a0a6d9600fb09fff0854fd55d7">stage2Mmu</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>The MMU to forward second stage look upts to </p>

</div>
</div>
<a class="anchor" id="af819b2b862d892da5df10248b6d72787"></a><!-- doxytag: member="ArmISA::TableWalker::stateQueues" ref="af819b2b862d892da5df10248b6d72787" args="[MAX_LOOKUP_LEVELS]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classstd_1_1list.html">std::list</a>&lt;<a class="el" href="classArmISA_1_1TableWalker_1_1WalkerState.html">WalkerState</a> *&gt; <a class="el" href="classArmISA_1_1TableWalker.html#af819b2b862d892da5df10248b6d72787">stateQueues</a>[MAX_LOOKUP_LEVELS]<code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Queues of requests for all the different lookup levels </p>

</div>
</div>
<a class="anchor" id="a9f0e11329a702fd34819769c899e4bd3"></a><!-- doxytag: member="ArmISA::TableWalker::tlb" ref="a9f0e11329a702fd34819769c899e4bd3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classArmISA_1_1TLB.html">TLB</a>* <a class="el" href="classArmISA_1_1TableWalker.html#a9f0e11329a702fd34819769c899e4bd3">tlb</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p><a class="el" href="classArmISA_1_1TLB.html">TLB</a> that is initiating these table walks </p>

</div>
</div>
<hr/>このクラスの説明は次のファイルから生成されました:<ul>
<li>arch/arm/<a class="el" href="table__walker_8hh_source.html">table_walker.hh</a></li>
<li>arch/arm/<a class="el" href="table__walker_8cc.html">table_walker.cc</a></li>
</ul>
</div>
<hr size="1"/><address style="text-align: right;"><small>File&nbsp;GEM5&nbsp;Wrapperに対して25 May 2015に生成されました。&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
