<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>File&nbsp;GEM5&nbsp;Wrapper: クラス PerfKvmCounter</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- 作成： Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>メインページ</span></a></li>
      <li><a href="pages.html"><span>関連ページ</span></a></li>
      <li><a href="modules.html"><span>モジュール</span></a></li>
      <li><a href="namespaces.html"><span>ネームスペース</span></a></li>
      <li class="current"><a href="annotated.html"><span>クラス</span></a></li>
      <li><a href="files.html"><span>ファイル</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>構成</span></a></li>
      <li><a href="classes.html"><span>構成索引</span></a></li>
      <li><a href="hierarchy.html"><span>クラス階層</span></a></li>
      <li><a href="functions.html"><span>構成メンバ</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>クラス PerfKvmCounter</h1><!-- doxytag: class="PerfKvmCounter" -->
<p><code>#include &lt;<a class="el" href="perfevent_8hh_source.html">perfevent.hh</a>&gt;</code></p>

<p><a href="classPerfKvmCounter-members.html">すべてのメンバ一覧</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Public メソッド</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPerfKvmCounter.html#a3efef81d1d840ff948b8fd501310c981">PerfKvmCounter</a> (<a class="el" href="classPerfKvmCounterConfig.html">PerfKvmCounterConfig</a> &amp;config, pid_t tid)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPerfKvmCounter.html#a6e10b934e1d000c59742d748b42824bd">PerfKvmCounter</a> (<a class="el" href="classPerfKvmCounterConfig.html">PerfKvmCounterConfig</a> &amp;config, pid_t tid, const <a class="el" href="classPerfKvmCounter.html">PerfKvmCounter</a> &amp;parent)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPerfKvmCounter.html#a48fc3925e8430dcead140f4c27a1e4ce">PerfKvmCounter</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPerfKvmCounter.html#afadd01640b4cbc3b749f702d60e7a04b">~PerfKvmCounter</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPerfKvmCounter.html#a162e5b205959ecba29def7e7e0bf92dd">attach</a> (<a class="el" href="classPerfKvmCounterConfig.html">PerfKvmCounterConfig</a> &amp;config, pid_t tid)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPerfKvmCounter.html#aff7cff5a84dcc4e3155c42b9b3f35574">attach</a> (<a class="el" href="classPerfKvmCounterConfig.html">PerfKvmCounterConfig</a> &amp;config, pid_t tid, const <a class="el" href="classPerfKvmCounter.html">PerfKvmCounter</a> &amp;parent)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPerfKvmCounter.html#ac295bade8aee589f6718dfa79edc2a34">detach</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPerfKvmCounter.html#aa828991b44e099ad372a7833c34d3e24">attached</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPerfKvmCounter.html#a60de64d75454385b23995437f1d72669">start</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPerfKvmCounter.html#a8c528baf37154d347366083f0f816846">stop</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPerfKvmCounter.html#a08ec1e452f32c7b0e573d63f126a2bbf">period</a> (uint64_t period)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPerfKvmCounter.html#a6af1a045627841dd5b66f15c28cb48e7">refresh</a> (int refresh)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint64_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPerfKvmCounter.html#af2c9c37fc5a5bcdac6d97825066ce801">read</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPerfKvmCounter.html#adcb1192220b2f38f9e05b5c8a0f3ab30">enableSignals</a> (pid_t tid, int signal)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPerfKvmCounter.html#ab176640bca1358eda4cd412c3be7d746">enableSignals</a> (int signal)</td></tr>
<tr><td colspan="2"><h2>Private メソッド</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPerfKvmCounter.html#a68c89e9e7ce1cbe5b5b7111307f16b61">PerfKvmCounter</a> (const <a class="el" href="classPerfKvmCounter.html">PerfKvmCounter</a> &amp;that)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classPerfKvmCounter.html">PerfKvmCounter</a> &amp;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPerfKvmCounter.html#a11a80ba1c558b286f8459d8bbe60fe3f">operator=</a> (const <a class="el" href="classPerfKvmCounter.html">PerfKvmCounter</a> &amp;that)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPerfKvmCounter.html#a82b3eaa20dc8f83c4ea69352954c2e7d">attach</a> (<a class="el" href="classPerfKvmCounterConfig.html">PerfKvmCounterConfig</a> &amp;config, pid_t tid, int group_fd)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">pid_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPerfKvmCounter.html#af0449193b7cded86e600f052d0aabd39">gettid</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPerfKvmCounter.html#a32358ddbb202e0319d138e8cb3749ed9">mmapPerf</a> (int pages)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPerfKvmCounter.html#a382308644478e0220390350cc53c1a4a">read</a> (void *buf, size_t size) const </td></tr>
<tr><td colspan="2"><div class="groupHeader"></div></td></tr>
<tr><td colspan="2"><div class="groupText"><p><a class="anchor" id="amgrpd41d8cd98f00b204e9800998ecf8427e"></a> </p>
<br/><br/></div></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPerfKvmCounter.html#a59e734a4d9a204be38f0af7d82091648">fcntl</a> (int cmd, long p1)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPerfKvmCounter.html#a801e1d8b832b7d2ea829411655d3d001">fcntl</a> (int cmd, void *p1)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPerfKvmCounter.html#a5b8772915b1f8991ad9f3f9afcd681b8">ioctl</a> (int request, long p1)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPerfKvmCounter.html#aa59d1d5b429119949c0a1e386cb760e4">ioctl</a> (int request, void *p1)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPerfKvmCounter.html#af07e229bfb88ad702cdbc617b3b46578">ioctl</a> (int request)</td></tr>
<tr><td colspan="2"><h2>Private 変数</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPerfKvmCounter.html#a6f8059414f0228f0256115e024eeed4b">fd</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct perf_event_mmap_page *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPerfKvmCounter.html#ab87c9aa7bfe943c16292c643bf6ceb58">ringBuffer</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPerfKvmCounter.html#ab445fb16e36d61f54c9c6ca0a9d8c8db">ringNumPages</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">long&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPerfKvmCounter.html#a055d35409d0ddd7689a36c45a8d9b89b">pageSize</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>説明</h2>
<p>An instance of a performance counter. </p>
<hr/><h2>コンストラクタとデストラクタ</h2>
<a class="anchor" id="a3efef81d1d840ff948b8fd501310c981"></a><!-- doxytag: member="PerfKvmCounter::PerfKvmCounter" ref="a3efef81d1d840ff948b8fd501310c981" args="(PerfKvmCounterConfig &amp;config, pid_t tid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classPerfKvmCounter.html">PerfKvmCounter</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classPerfKvmCounterConfig.html">PerfKvmCounterConfig</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pid_t&nbsp;</td>
          <td class="paramname"> <em>tid</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Create and attach a new counter group.</p>
<dl><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>config</em>&nbsp;</td><td>Counter configuration </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>tid</em>&nbsp;</td><td>Thread to sample (0 indicates current thread) </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l00071"></a>00071     : <a class="code" href="classPerfKvmCounter.html#a6f8059414f0228f0256115e024eeed4b">fd</a>(-1), <a class="code" href="classPerfKvmCounter.html#ab87c9aa7bfe943c16292c643bf6ceb58">ringBuffer</a>(<a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>), <a class="code" href="classPerfKvmCounter.html#a055d35409d0ddd7689a36c45a8d9b89b">pageSize</a>(-1)
<a name="l00072"></a>00072 {
<a name="l00073"></a>00073     <a class="code" href="classPerfKvmCounter.html#a162e5b205959ecba29def7e7e0bf92dd">attach</a>(config, tid, -1);
<a name="l00074"></a>00074 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6e10b934e1d000c59742d748b42824bd"></a><!-- doxytag: member="PerfKvmCounter::PerfKvmCounter" ref="a6e10b934e1d000c59742d748b42824bd" args="(PerfKvmCounterConfig &amp;config, pid_t tid, const PerfKvmCounter &amp;parent)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classPerfKvmCounter.html">PerfKvmCounter</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classPerfKvmCounterConfig.html">PerfKvmCounterConfig</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pid_t&nbsp;</td>
          <td class="paramname"> <em>tid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classPerfKvmCounter.html">PerfKvmCounter</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>parent</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Create and attach a new counter and make it a member of an exist counter group.</p>
<dl><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>config</em>&nbsp;</td><td>Counter configuration </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>tid</em>&nbsp;</td><td>Thread to sample (0 indicates current thread) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>parent</em>&nbsp;</td><td>Group leader </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l00078"></a>00078     : <a class="code" href="classPerfKvmCounter.html#a6f8059414f0228f0256115e024eeed4b">fd</a>(-1), <a class="code" href="classPerfKvmCounter.html#ab87c9aa7bfe943c16292c643bf6ceb58">ringBuffer</a>(<a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>), <a class="code" href="classPerfKvmCounter.html#a055d35409d0ddd7689a36c45a8d9b89b">pageSize</a>(-1)
<a name="l00079"></a>00079 {
<a name="l00080"></a>00080     <a class="code" href="classPerfKvmCounter.html#a162e5b205959ecba29def7e7e0bf92dd">attach</a>(config, tid, parent);
<a name="l00081"></a>00081 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a48fc3925e8430dcead140f4c27a1e4ce"></a><!-- doxytag: member="PerfKvmCounter::PerfKvmCounter" ref="a48fc3925e8430dcead140f4c27a1e4ce" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classPerfKvmCounter.html">PerfKvmCounter</a> </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Create a new counter, but don't attach it. </p>

<p><div class="fragment"><pre class="fragment"><a name="l00084"></a>00084     : <a class="code" href="classPerfKvmCounter.html#a6f8059414f0228f0256115e024eeed4b">fd</a>(-1), <a class="code" href="classPerfKvmCounter.html#ab87c9aa7bfe943c16292c643bf6ceb58">ringBuffer</a>(<a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>), <a class="code" href="classPerfKvmCounter.html#a055d35409d0ddd7689a36c45a8d9b89b">pageSize</a>(-1)
<a name="l00085"></a>00085 {
<a name="l00086"></a>00086 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="afadd01640b4cbc3b749f702d60e7a04b"></a><!-- doxytag: member="PerfKvmCounter::~PerfKvmCounter" ref="afadd01640b4cbc3b749f702d60e7a04b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">~<a class="el" href="classPerfKvmCounter.html">PerfKvmCounter</a> </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00089"></a>00089 {
<a name="l00090"></a>00090     <span class="keywordflow">if</span> (<a class="code" href="classPerfKvmCounter.html#aa828991b44e099ad372a7833c34d3e24">attached</a>())
<a name="l00091"></a>00091         <a class="code" href="classPerfKvmCounter.html#ac295bade8aee589f6718dfa79edc2a34">detach</a>();
<a name="l00092"></a>00092 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a68c89e9e7ce1cbe5b5b7111307f16b61"></a><!-- doxytag: member="PerfKvmCounter::PerfKvmCounter" ref="a68c89e9e7ce1cbe5b5b7111307f16b61" args="(const PerfKvmCounter &amp;that)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classPerfKvmCounter.html">PerfKvmCounter</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classPerfKvmCounter.html">PerfKvmCounter</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>that</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/><h2>関数</h2>
<a class="anchor" id="a82b3eaa20dc8f83c4ea69352954c2e7d"></a><!-- doxytag: member="PerfKvmCounter::attach" ref="a82b3eaa20dc8f83c4ea69352954c2e7d" args="(PerfKvmCounterConfig &amp;config, pid_t tid, int group_fd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void attach </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classPerfKvmCounterConfig.html">PerfKvmCounterConfig</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pid_t&nbsp;</td>
          <td class="paramname"> <em>tid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>group_fd</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00163"></a>00163 {
<a name="l00164"></a>00164     assert(!<a class="code" href="classPerfKvmCounter.html#aa828991b44e099ad372a7833c34d3e24">attached</a>());
<a name="l00165"></a>00165 
<a name="l00166"></a>00166     <a class="code" href="classPerfKvmCounter.html#a6f8059414f0228f0256115e024eeed4b">fd</a> = syscall(__NR_perf_event_open,
<a name="l00167"></a>00167                  &amp;config.<a class="code" href="classPerfKvmCounterConfig.html#aeae272195c5a5879b216cef6c7c909b2">attr</a>, tid,
<a name="l00168"></a>00168                  -1, <span class="comment">// CPU (-1 =&gt; Any CPU that the task happens to run on)</span>
<a name="l00169"></a>00169                  group_fd,
<a name="l00170"></a>00170                  0); <span class="comment">// Flags</span>
<a name="l00171"></a>00171     <span class="keywordflow">if</span> (<a class="code" href="classPerfKvmCounter.html#a6f8059414f0228f0256115e024eeed4b">fd</a> == -1)
<a name="l00172"></a>00172         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;PerfKvmCounter::open failed (%i)\n&quot;</span>, errno);
<a name="l00173"></a>00173 
<a name="l00174"></a>00174     <a class="code" href="classPerfKvmCounter.html#a32358ddbb202e0319d138e8cb3749ed9">mmapPerf</a>(1);
<a name="l00175"></a>00175 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aff7cff5a84dcc4e3155c42b9b3f35574"></a><!-- doxytag: member="PerfKvmCounter::attach" ref="aff7cff5a84dcc4e3155c42b9b3f35574" args="(PerfKvmCounterConfig &amp;config, pid_t tid, const PerfKvmCounter &amp;parent)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void attach </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classPerfKvmCounterConfig.html">PerfKvmCounterConfig</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pid_t&nbsp;</td>
          <td class="paramname"> <em>tid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classPerfKvmCounter.html">PerfKvmCounter</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>parent</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Attach a counter and make it a member of an existing counter group.</p>
<dl class="note"><dt><b>覚え書き:</b></dt><dd>This operation is only supported if the counter isn't already attached.</dd></dl>
<dl><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>config</em>&nbsp;</td><td>Counter configuration </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>tid</em>&nbsp;</td><td>Thread to sample (0 indicates current thread) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>parent</em>&nbsp;</td><td>Group leader </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l00222"></a>00222                                                          {
<a name="l00223"></a>00223         <a class="code" href="classPerfKvmCounter.html#a162e5b205959ecba29def7e7e0bf92dd">attach</a>(config, tid, parent.<a class="code" href="classPerfKvmCounter.html#a6f8059414f0228f0256115e024eeed4b">fd</a>);
<a name="l00224"></a>00224     }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a162e5b205959ecba29def7e7e0bf92dd"></a><!-- doxytag: member="PerfKvmCounter::attach" ref="a162e5b205959ecba29def7e7e0bf92dd" args="(PerfKvmCounterConfig &amp;config, pid_t tid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void attach </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classPerfKvmCounterConfig.html">PerfKvmCounterConfig</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pid_t&nbsp;</td>
          <td class="paramname"> <em>tid</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Attach a counter.</p>
<dl class="note"><dt><b>覚え書き:</b></dt><dd>This operation is only supported if the counter isn't already attached.</dd></dl>
<dl><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>config</em>&nbsp;</td><td>Counter configuration </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>tid</em>&nbsp;</td><td>Thread to sample (0 indicates current thread) </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l00206"></a>00206                                                          {
<a name="l00207"></a>00207         <a class="code" href="classPerfKvmCounter.html#a162e5b205959ecba29def7e7e0bf92dd">attach</a>(config, tid, -1);
<a name="l00208"></a>00208     }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa828991b44e099ad372a7833c34d3e24"></a><!-- doxytag: member="PerfKvmCounter::attached" ref="aa828991b44e099ad372a7833c34d3e24" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool attached </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p><a class="el" href="classCheck.html">Check</a> if a counter is attached. </p>

<p><div class="fragment"><pre class="fragment"><a name="l00230"></a>00230 { <span class="keywordflow">return</span> <a class="code" href="classPerfKvmCounter.html#a6f8059414f0228f0256115e024eeed4b">fd</a> != -1; }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac295bade8aee589f6718dfa79edc2a34"></a><!-- doxytag: member="PerfKvmCounter::detach" ref="ac295bade8aee589f6718dfa79edc2a34" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void detach </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Detach a counter from PerfEvent. </p>

<p><div class="fragment"><pre class="fragment"><a name="l00096"></a>00096 {
<a name="l00097"></a>00097     assert(<a class="code" href="classPerfKvmCounter.html#aa828991b44e099ad372a7833c34d3e24">attached</a>());
<a name="l00098"></a>00098 
<a name="l00099"></a>00099     <span class="keywordflow">if</span> (munmap(<a class="code" href="classPerfKvmCounter.html#ab87c9aa7bfe943c16292c643bf6ceb58">ringBuffer</a>, <a class="code" href="classPerfKvmCounter.html#ab445fb16e36d61f54c9c6ca0a9d8c8db">ringNumPages</a> * <a class="code" href="classPerfKvmCounter.html#a055d35409d0ddd7689a36c45a8d9b89b">pageSize</a>) == -1)
<a name="l00100"></a>00100         <a class="code" href="base_2misc_8hh.html#a8224a361dddd2ad59b411982e5ea746f">warn</a>(<span class="stringliteral">&quot;PerfKvmCounter: Failed to unmap ring buffer (%i)\n&quot;</span>,
<a name="l00101"></a>00101              errno);
<a name="l00102"></a>00102     close(<a class="code" href="classPerfKvmCounter.html#a6f8059414f0228f0256115e024eeed4b">fd</a>);
<a name="l00103"></a>00103 
<a name="l00104"></a>00104     <a class="code" href="classPerfKvmCounter.html#a6f8059414f0228f0256115e024eeed4b">fd</a> = -1;
<a name="l00105"></a>00105     <a class="code" href="classPerfKvmCounter.html#ab87c9aa7bfe943c16292c643bf6ceb58">ringBuffer</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00106"></a>00106 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab176640bca1358eda4cd412c3be7d746"></a><!-- doxytag: member="PerfKvmCounter::enableSignals" ref="ab176640bca1358eda4cd412c3be7d746" args="(int signal)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void enableSignals </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>signal</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Enable signal delivery on counter overflow. Identical to enableSignals(pid_t) when called with the current TID as its parameter.</p>
<dl><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>signal</em>&nbsp;</td><td>Signal to send upon overflow </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l00300"></a>00300 { <a class="code" href="classPerfKvmCounter.html#adcb1192220b2f38f9e05b5c8a0f3ab30">enableSignals</a>(<a class="code" href="classPerfKvmCounter.html#af0449193b7cded86e600f052d0aabd39">gettid</a>(), signal); }
</pre></div></p>

</div>
</div>
<a class="anchor" id="adcb1192220b2f38f9e05b5c8a0f3ab30"></a><!-- doxytag: member="PerfKvmCounter::enableSignals" ref="adcb1192220b2f38f9e05b5c8a0f3ab30" args="(pid_t tid, int signal)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void enableSignals </td>
          <td>(</td>
          <td class="paramtype">pid_t&nbsp;</td>
          <td class="paramname"> <em>tid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>signal</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Enable signal delivery to a thread on counter overflow.</p>
<dl><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>tid</em>&nbsp;</td><td>Thread to deliver signal to </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>signal</em>&nbsp;</td><td>Signal to send upon overflow </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l00147"></a>00147 {
<a name="l00148"></a>00148     <span class="keyword">struct </span>f_owner_ex sigowner;
<a name="l00149"></a>00149 
<a name="l00150"></a>00150     sigowner.type = F_OWNER_TID;
<a name="l00151"></a>00151     sigowner.pid = tid;
<a name="l00152"></a>00152 
<a name="l00153"></a>00153     <span class="keywordflow">if</span> (<a class="code" href="classPerfKvmCounter.html#a59e734a4d9a204be38f0af7d82091648">fcntl</a>(F_SETOWN_EX, &amp;sigowner) == -1 ||
<a name="l00154"></a>00154         <a class="code" href="classPerfKvmCounter.html#a59e734a4d9a204be38f0af7d82091648">fcntl</a>(F_SETSIG, signal) == -1 ||
<a name="l00155"></a>00155         <a class="code" href="classPerfKvmCounter.html#a59e734a4d9a204be38f0af7d82091648">fcntl</a>(F_SETFL, O_ASYNC) == -1)
<a name="l00156"></a>00156         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;PerfKvmCounter: Failed to enable signals for counter (%i)\n&quot;</span>,
<a name="l00157"></a>00157               errno);
<a name="l00158"></a>00158 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a801e1d8b832b7d2ea829411655d3d001"></a><!-- doxytag: member="PerfKvmCounter::fcntl" ref="a801e1d8b832b7d2ea829411655d3d001" args="(int cmd, void *p1)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fcntl </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>p1</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline, private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00342"></a>00342 { <span class="keywordflow">return</span> <a class="code" href="classPerfKvmCounter.html#a59e734a4d9a204be38f0af7d82091648">fcntl</a>(cmd, (<span class="keywordtype">long</span>)p1); }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a59e734a4d9a204be38f0af7d82091648"></a><!-- doxytag: member="PerfKvmCounter::fcntl" ref="a59e734a4d9a204be38f0af7d82091648" args="(int cmd, long p1)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fcntl </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long&nbsp;</td>
          <td class="paramname"> <em>p1</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>PerfEvent fnctl interface.</p>
<dl><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>cmd</em>&nbsp;</td><td>fcntl command </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>p1</em>&nbsp;</td><td><a class="el" href="classRequest.html">Request</a> parameter</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>戻り値:</b></dt><dd>-1 on error (error number in errno), ioctl dependent value otherwise. </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00208"></a>00208 {
<a name="l00209"></a>00209     assert(<a class="code" href="classPerfKvmCounter.html#aa828991b44e099ad372a7833c34d3e24">attached</a>());
<a name="l00210"></a>00210     <a class="code" href="classPerfKvmCounter.html#a59e734a4d9a204be38f0af7d82091648">return ::fcntl</a>(<a class="code" href="classPerfKvmCounter.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, cmd, p1);
<a name="l00211"></a>00211 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af0449193b7cded86e600f052d0aabd39"></a><!-- doxytag: member="PerfKvmCounter::gettid" ref="af0449193b7cded86e600f052d0aabd39" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pid_t gettid </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Get the TID of the current thread.</p>
<dl class="return"><dt><b>戻り値:</b></dt><dd>Current thread's TID </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00179"></a>00179 {
<a name="l00180"></a>00180     <span class="keywordflow">return</span> syscall(__NR_gettid);
<a name="l00181"></a>00181 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af07e229bfb88ad702cdbc617b3b46578"></a><!-- doxytag: member="PerfKvmCounter::ioctl" ref="af07e229bfb88ad702cdbc617b3b46578" args="(int request)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ioctl </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>request</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00357"></a>00357 { <span class="keywordflow">return</span> <a class="code" href="classPerfKvmCounter.html#a5b8772915b1f8991ad9f3f9afcd681b8">ioctl</a>(request, 0<a class="code" href="namespaceX86ISA.html#a0485da3ef528ce3058f6f335248c0764">L</a>); }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa59d1d5b429119949c0a1e386cb760e4"></a><!-- doxytag: member="PerfKvmCounter::ioctl" ref="aa59d1d5b429119949c0a1e386cb760e4" args="(int request, void *p1)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ioctl </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>p1</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline, private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00356"></a>00356 { <span class="keywordflow">return</span> <a class="code" href="classPerfKvmCounter.html#a5b8772915b1f8991ad9f3f9afcd681b8">ioctl</a>(request, (<span class="keywordtype">long</span>)p1); }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5b8772915b1f8991ad9f3f9afcd681b8"></a><!-- doxytag: member="PerfKvmCounter::ioctl" ref="a5b8772915b1f8991ad9f3f9afcd681b8" args="(int request, long p1)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ioctl </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long&nbsp;</td>
          <td class="paramname"> <em>p1</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>PerfEvent ioctl interface.</p>
<dl><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>request</em>&nbsp;</td><td>PerfEvent request </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>p1</em>&nbsp;</td><td>Optional request parameter</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>戻り値:</b></dt><dd>-1 on error (error number in errno), ioctl dependent value otherwise. </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00215"></a>00215 {
<a name="l00216"></a>00216     assert(<a class="code" href="classPerfKvmCounter.html#aa828991b44e099ad372a7833c34d3e24">attached</a>());
<a name="l00217"></a>00217     <a class="code" href="classPerfKvmCounter.html#a5b8772915b1f8991ad9f3f9afcd681b8">return ::ioctl</a>(<a class="code" href="classPerfKvmCounter.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, request, p1);
<a name="l00218"></a>00218 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a32358ddbb202e0319d138e8cb3749ed9"></a><!-- doxytag: member="PerfKvmCounter::mmapPerf" ref="a32358ddbb202e0319d138e8cb3749ed9" args="(int pages)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mmapPerf </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>pages</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>MMAP the PerfEvent file descriptor.</p>
<dl class="note"><dt><b>覚え書き:</b></dt><dd>We currently don't use the ring buffer, but PerfEvent requires this to be mapped for overflow handling to work.</dd>
<dd>
Overflow handling requires at least one buf_page to be mapped.</dd></dl>
<dl><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pages</em>&nbsp;</td><td>number of pages in circular sample buffer. Must be an even power of 2. </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l00185"></a>00185 {
<a name="l00186"></a>00186     assert(<a class="code" href="classPerfKvmCounter.html#aa828991b44e099ad372a7833c34d3e24">attached</a>());
<a name="l00187"></a>00187     assert(<a class="code" href="classPerfKvmCounter.html#ab87c9aa7bfe943c16292c643bf6ceb58">ringBuffer</a> == <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>);
<a name="l00188"></a>00188 
<a name="l00189"></a>00189     <span class="keywordflow">if</span> (<a class="code" href="classPerfKvmCounter.html#a055d35409d0ddd7689a36c45a8d9b89b">pageSize</a> == -1) {
<a name="l00190"></a>00190         <a class="code" href="classPerfKvmCounter.html#a055d35409d0ddd7689a36c45a8d9b89b">pageSize</a> = sysconf(_SC_PAGE_SIZE);
<a name="l00191"></a>00191         <span class="keywordflow">if</span> (<a class="code" href="classPerfKvmCounter.html#a055d35409d0ddd7689a36c45a8d9b89b">pageSize</a> == -1)
<a name="l00192"></a>00192             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;PerfKvmCounter: Failed to determine page size (%i)\n&quot;</span>,
<a name="l00193"></a>00193                   errno);
<a name="l00194"></a>00194     }
<a name="l00195"></a>00195 
<a name="l00196"></a>00196     <a class="code" href="classPerfKvmCounter.html#ab445fb16e36d61f54c9c6ca0a9d8c8db">ringNumPages</a> = pages + 1;
<a name="l00197"></a>00197     <a class="code" href="classPerfKvmCounter.html#ab87c9aa7bfe943c16292c643bf6ceb58">ringBuffer</a> = (<span class="keyword">struct </span>perf_event_mmap_page *)mmap(
<a name="l00198"></a>00198         <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>, <a class="code" href="classPerfKvmCounter.html#ab445fb16e36d61f54c9c6ca0a9d8c8db">ringNumPages</a> * 4096,
<a name="l00199"></a>00199         PROT_READ | PROT_WRITE, MAP_SHARED,
<a name="l00200"></a>00200         <a class="code" href="classPerfKvmCounter.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, 0);
<a name="l00201"></a>00201     <span class="keywordflow">if</span> (<a class="code" href="classPerfKvmCounter.html#ab87c9aa7bfe943c16292c643bf6ceb58">ringBuffer</a> == MAP_FAILED)
<a name="l00202"></a>00202         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;PerfKvmCounter: MMAP failed (%i)\n&quot;</span>,
<a name="l00203"></a>00203               errno);
<a name="l00204"></a>00204 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a11a80ba1c558b286f8459d8bbe60fe3f"></a><!-- doxytag: member="PerfKvmCounter::operator=" ref="a11a80ba1c558b286f8459d8bbe60fe3f" args="(const PerfKvmCounter &amp;that)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classPerfKvmCounter.html">PerfKvmCounter</a>&amp; operator= </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classPerfKvmCounter.html">PerfKvmCounter</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>that</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a08ec1e452f32c7b0e573d63f126a2bbf"></a><!-- doxytag: member="PerfKvmCounter::period" ref="a08ec1e452f32c7b0e573d63f126a2bbf" args="(uint64_t period)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void period </td>
          <td>(</td>
          <td class="paramtype">uint64_t&nbsp;</td>
          <td class="paramname"> <em>period</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Update the period of an overflow counter.</p>
<dl class="warning"><dt><b>警告:</b></dt><dd>This ioctl has some pretty bizarre semantics. It seems like the new period isn't effective until after the next counter overflow. If you use this method to change the sample period, you will see one sample with the old period and then start sampling with the new period. This problem was fixed for ARM in version 3.7 of the kernel.</dd>
<dd>
This method doesn't work at all on some 2.6.3x kernels since it has inverted check for the return value when copying parameters from userspace.</dd></dl>
<dl><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>period</em>&nbsp;</td><td>Overflow period in events </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l00124"></a>00124 {
<a name="l00125"></a>00125     <span class="keywordflow">if</span> (<a class="code" href="classPerfKvmCounter.html#a5b8772915b1f8991ad9f3f9afcd681b8">ioctl</a>(PERF_EVENT_IOC_PERIOD, &amp;<a class="code" href="classPerfKvmCounter.html#a08ec1e452f32c7b0e573d63f126a2bbf">period</a>) == -1)
<a name="l00126"></a>00126         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;KVM: Failed to set period of performance counter (%i)\n&quot;</span>, errno);
<a name="l00127"></a>00127 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a382308644478e0220390350cc53c1a4a"></a><!-- doxytag: member="PerfKvmCounter::read" ref="a382308644478e0220390350cc53c1a4a" args="(void *buf, size_t size) const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void read </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>size</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td> const<code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Perform a read from the counter file descriptor.</p>
<dl><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>buf</em>&nbsp;</td><td>Destination buffer </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>size</em>&nbsp;</td><td>Amount of data to read </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l00222"></a>00222 {
<a name="l00223"></a>00223     <span class="keywordtype">char</span> *_buf = (<span class="keywordtype">char</span> *)buf;
<a name="l00224"></a>00224     <span class="keywordtype">size_t</span> _size = size;
<a name="l00225"></a>00225 
<a name="l00226"></a>00226     assert(<a class="code" href="classPerfKvmCounter.html#aa828991b44e099ad372a7833c34d3e24">attached</a>());
<a name="l00227"></a>00227 
<a name="l00228"></a>00228     <span class="keywordflow">do</span> {
<a name="l00229"></a>00229         ssize_t ret;
<a name="l00230"></a>00230         ret =<a class="code" href="classPerfKvmCounter.html#af2c9c37fc5a5bcdac6d97825066ce801"> ::read</a>(<a class="code" href="classPerfKvmCounter.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, _buf, _size);
<a name="l00231"></a>00231         <span class="keywordflow">switch</span> (ret) {
<a name="l00232"></a>00232           <span class="keywordflow">case</span> -1:
<a name="l00233"></a>00233             <span class="keywordflow">if</span> (errno != EAGAIN)
<a name="l00234"></a>00234                 <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;PerfKvmCounter::read failed (%i)\n&quot;</span>, errno);
<a name="l00235"></a>00235             <span class="keywordflow">break</span>;
<a name="l00236"></a>00236 
<a name="l00237"></a>00237           <span class="keywordflow">case</span> 0:
<a name="l00238"></a>00238             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;PerfKvmCounter::read unexpected EOF.\n&quot;</span>);
<a name="l00239"></a>00239 
<a name="l00240"></a>00240           <span class="keywordflow">default</span>:
<a name="l00241"></a>00241             _size -= ret;
<a name="l00242"></a>00242             _buf += ret;
<a name="l00243"></a>00243             <span class="keywordflow">break</span>;
<a name="l00244"></a>00244         }
<a name="l00245"></a>00245     } <span class="keywordflow">while</span>(_size);
<a name="l00246"></a>00246 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af2c9c37fc5a5bcdac6d97825066ce801"></a><!-- doxytag: member="PerfKvmCounter::read" ref="af2c9c37fc5a5bcdac6d97825066ce801" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t read </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td> const</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Read the current value of a counter. </p>

<p><div class="fragment"><pre class="fragment"><a name="l00138"></a>00138 {
<a name="l00139"></a>00139     uint64_t <a class="code" href="namespacegenini.html#a7e5f482a3a8a4f98bd1a9c124485f572">value</a>;
<a name="l00140"></a>00140 
<a name="l00141"></a>00141     <a class="code" href="classPerfKvmCounter.html#af2c9c37fc5a5bcdac6d97825066ce801">read</a>(&amp;value, <span class="keyword">sizeof</span>(uint64_t));
<a name="l00142"></a>00142     <span class="keywordflow">return</span> value;
<a name="l00143"></a>00143 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6af1a045627841dd5b66f15c28cb48e7"></a><!-- doxytag: member="PerfKvmCounter::refresh" ref="a6af1a045627841dd5b66f15c28cb48e7" args="(int refresh)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void refresh </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>refresh</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Enable a counter for a fixed number of events.</p>
<p>When this method is called, perf event enables the counter if it was disabled. It then leaves the counter enabled until it has overflowed a refresh times.</p>
<dl class="note"><dt><b>覚え書き:</b></dt><dd>This does not update the period of the counter.</dd></dl>
<dl><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>refresh</em>&nbsp;</td><td>Number of overflows before disabling the counter. </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l00131"></a>00131 {
<a name="l00132"></a>00132     <span class="keywordflow">if</span> (<a class="code" href="classPerfKvmCounter.html#a5b8772915b1f8991ad9f3f9afcd681b8">ioctl</a>(PERF_EVENT_IOC_REFRESH, <a class="code" href="classPerfKvmCounter.html#a6af1a045627841dd5b66f15c28cb48e7">refresh</a>) == -1)
<a name="l00133"></a>00133         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;KVM: Failed to refresh performance counter (%i)\n&quot;</span>, errno);
<a name="l00134"></a>00134 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a60de64d75454385b23995437f1d72669"></a><!-- doxytag: member="PerfKvmCounter::start" ref="a60de64d75454385b23995437f1d72669" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void start </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Start counting.</p>
<dl class="note"><dt><b>覚え書き:</b></dt><dd>If this counter is a group leader, it will start the entire group. </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00110"></a>00110 {
<a name="l00111"></a>00111     <span class="keywordflow">if</span> (<a class="code" href="classPerfKvmCounter.html#a5b8772915b1f8991ad9f3f9afcd681b8">ioctl</a>(PERF_EVENT_IOC_ENABLE, PERF_IOC_FLAG_GROUP) == -1)
<a name="l00112"></a>00112         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;KVM: Failed to enable performance counters (%i)\n&quot;</span>, errno);
<a name="l00113"></a>00113 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8c528baf37154d347366083f0f816846"></a><!-- doxytag: member="PerfKvmCounter::stop" ref="a8c528baf37154d347366083f0f816846" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void stop </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Stop counting.</p>
<dl class="note"><dt><b>覚え書き:</b></dt><dd>If this counter is a group leader, it will stop the entire group. </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00117"></a>00117 {
<a name="l00118"></a>00118     <span class="keywordflow">if</span> (<a class="code" href="classPerfKvmCounter.html#a5b8772915b1f8991ad9f3f9afcd681b8">ioctl</a>(PERF_EVENT_IOC_DISABLE, PERF_IOC_FLAG_GROUP) == -1)
<a name="l00119"></a>00119         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;KVM: Failed to disable performance counters (%i)\n&quot;</span>, errno);
<a name="l00120"></a>00120 }
</pre></div></p>

</div>
</div>
<hr/><h2>変数</h2>
<a class="anchor" id="a6f8059414f0228f0256115e024eeed4b"></a><!-- doxytag: member="PerfKvmCounter::fd" ref="a6f8059414f0228f0256115e024eeed4b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classPerfKvmCounter.html#a6f8059414f0228f0256115e024eeed4b">fd</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>PerfEvent file descriptor associated with counter. -1 if not attached to PerfEvent. </p>

</div>
</div>
<a class="anchor" id="a055d35409d0ddd7689a36c45a8d9b89b"></a><!-- doxytag: member="PerfKvmCounter::pageSize" ref="a055d35409d0ddd7689a36c45a8d9b89b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">long <a class="el" href="classPerfKvmCounter.html#a055d35409d0ddd7689a36c45a8d9b89b">pageSize</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Cached host page size </p>

</div>
</div>
<a class="anchor" id="ab87c9aa7bfe943c16292c643bf6ceb58"></a><!-- doxytag: member="PerfKvmCounter::ringBuffer" ref="ab87c9aa7bfe943c16292c643bf6ceb58" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct perf_event_mmap_page* <a class="el" href="classPerfKvmCounter.html#ab87c9aa7bfe943c16292c643bf6ceb58">ringBuffer</a><code> [read, private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Memory mapped PerfEvent sample ring buffer </p>

</div>
</div>
<a class="anchor" id="ab445fb16e36d61f54c9c6ca0a9d8c8db"></a><!-- doxytag: member="PerfKvmCounter::ringNumPages" ref="ab445fb16e36d61f54c9c6ca0a9d8c8db" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classPerfKvmCounter.html#ab445fb16e36d61f54c9c6ca0a9d8c8db">ringNumPages</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Total number of pages in ring buffer </p>

</div>
</div>
<hr/>このクラスの説明は次のファイルから生成されました:<ul>
<li>cpu/kvm/<a class="el" href="perfevent_8hh_source.html">perfevent.hh</a></li>
<li>cpu/kvm/<a class="el" href="perfevent_8cc.html">perfevent.cc</a></li>
</ul>
</div>
<hr size="1"/><address style="text-align: right;"><small>File&nbsp;GEM5&nbsp;Wrapperに対して25 May 2015に生成されました。&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
