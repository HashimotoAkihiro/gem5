\hypertarget{classRawDiskImage}{
\section{クラス RawDiskImage}
\label{classRawDiskImage}\index{RawDiskImage@{RawDiskImage}}
}


{\ttfamily \#include $<$disk\_\-image.hh$>$}RawDiskImageに対する継承グラフ:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=4cm]{classRawDiskImage}
\end{center}
\end{figure}
\subsection*{Public 型}
\begin{DoxyCompactItemize}
\item 
typedef RawDiskImageParams \hyperlink{classRawDiskImage_af714565806621f1401c71701d4c88e71}{Params}
\end{DoxyCompactItemize}
\subsection*{Public メソッド}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classRawDiskImage_a945e6d30a2216c70e181eb80cf249d52}{RawDiskImage} (const \hyperlink{classRawDiskImage_af714565806621f1401c71701d4c88e71}{Params} $\ast$p)
\item 
\hyperlink{classRawDiskImage_a28b4c60baee37ef27cf858eeef06d632}{$\sim$RawDiskImage} ()
\item 
void \hyperlink{classRawDiskImage_a5ae591df94fc66ccb85cbb6565368bca}{close} ()
\item 
void \hyperlink{classRawDiskImage_ab55319ad8c062fa8b3b36096d8d62014}{open} (const std::string \&filename, bool rd\_\-only=false)
\item 
virtual std::streampos \hyperlink{classRawDiskImage_ac47c8c9bb5ae5fbfa7e05b464d3e20d4}{size} () const 
\item 
virtual std::streampos \hyperlink{classRawDiskImage_ab2e0b5adfb9d2c78b1e534efa2af6e45}{read} (uint8\_\-t $\ast$data, std::streampos offset) const 
\item 
virtual std::streampos \hyperlink{classRawDiskImage_aadff68e91a6ca912a1878d79af3d0692}{write} (const uint8\_\-t $\ast$data, std::streampos offset)
\end{DoxyCompactItemize}
\subsection*{Protected 変数}
\begin{DoxyCompactItemize}
\item 
std::fstream \hyperlink{classRawDiskImage_a8858ebba853bebec63897a055877c296}{stream}
\item 
std::string \hyperlink{classRawDiskImage_aefc35c7944eed319c89bc1b399f0eb67}{file}
\item 
bool \hyperlink{classRawDiskImage_ae04692b1a934bc6b8c48b43c95add0fa}{readonly}
\item 
std::streampos \hyperlink{classRawDiskImage_a242120545024c17e9854e58aa7496c08}{disk\_\-size}
\end{DoxyCompactItemize}


\subsection{説明}
Specialization for accessing a raw disk image 

\subsection{型定義}
\hypertarget{classRawDiskImage_af714565806621f1401c71701d4c88e71}{
\index{RawDiskImage@{RawDiskImage}!Params@{Params}}
\index{Params@{Params}!RawDiskImage@{RawDiskImage}}
\subsubsection[{Params}]{\setlength{\rightskip}{0pt plus 5cm}typedef RawDiskImageParams {\bf Params}}}
\label{classRawDiskImage_af714565806621f1401c71701d4c88e71}


\hyperlink{classDiskImage_a7fcdce57df9801d7eebcb65f9ad2e0c0}{DiskImage}を再定義しています。

\subsection{コンストラクタとデストラクタ}
\hypertarget{classRawDiskImage_a945e6d30a2216c70e181eb80cf249d52}{
\index{RawDiskImage@{RawDiskImage}!RawDiskImage@{RawDiskImage}}
\index{RawDiskImage@{RawDiskImage}!RawDiskImage@{RawDiskImage}}
\subsubsection[{RawDiskImage}]{\setlength{\rightskip}{0pt plus 5cm}{\bf RawDiskImage} (const {\bf Params} $\ast$ {\em p})}}
\label{classRawDiskImage_a945e6d30a2216c70e181eb80cf249d52}



\begin{DoxyCode}
60     : DiskImage(p), disk_size(0)
61 { open(p->image_file, p->read_only); }
\end{DoxyCode}
\hypertarget{classRawDiskImage_a28b4c60baee37ef27cf858eeef06d632}{
\index{RawDiskImage@{RawDiskImage}!$\sim$RawDiskImage@{$\sim$RawDiskImage}}
\index{$\sim$RawDiskImage@{$\sim$RawDiskImage}!RawDiskImage@{RawDiskImage}}
\subsubsection[{$\sim$RawDiskImage}]{\setlength{\rightskip}{0pt plus 5cm}$\sim${\bf RawDiskImage} ()}}
\label{classRawDiskImage_a28b4c60baee37ef27cf858eeef06d632}



\begin{DoxyCode}
64 { close(); }
\end{DoxyCode}


\subsection{関数}
\hypertarget{classRawDiskImage_a5ae591df94fc66ccb85cbb6565368bca}{
\index{RawDiskImage@{RawDiskImage}!close@{close}}
\index{close@{close}!RawDiskImage@{RawDiskImage}}
\subsubsection[{close}]{\setlength{\rightskip}{0pt plus 5cm}void close ()}}
\label{classRawDiskImage_a5ae591df94fc66ccb85cbb6565368bca}



\begin{DoxyCode}
85 {
86     stream.close();
87 }
\end{DoxyCode}
\hypertarget{classRawDiskImage_ab55319ad8c062fa8b3b36096d8d62014}{
\index{RawDiskImage@{RawDiskImage}!open@{open}}
\index{open@{open}!RawDiskImage@{RawDiskImage}}
\subsubsection[{open}]{\setlength{\rightskip}{0pt plus 5cm}void open (const std::string \& {\em filename}, \/  bool {\em rd\_\-only} = {\ttfamily false})}}
\label{classRawDiskImage_ab55319ad8c062fa8b3b36096d8d62014}
\hypertarget{classRawDiskImage_ab2e0b5adfb9d2c78b1e534efa2af6e45}{
\index{RawDiskImage@{RawDiskImage}!read@{read}}
\index{read@{read}!RawDiskImage@{RawDiskImage}}
\subsubsection[{read}]{\setlength{\rightskip}{0pt plus 5cm}std::streampos read (uint8\_\-t $\ast$ {\em data}, \/  std::streampos {\em offset}) const\hspace{0.3cm}{\ttfamily  \mbox{[}virtual\mbox{]}}}}
\label{classRawDiskImage_ab2e0b5adfb9d2c78b1e534efa2af6e45}


\hyperlink{classDiskImage_afcf02c1fffcb16ed79ac38bb87fb572c}{DiskImage}を実装しています。


\begin{DoxyCode}
104 {
105     if (!initialized)
106         panic("RawDiskImage not initialized");
107 
108     if (!stream.is_open())
109         panic("file not open!\n");
110 
111     stream.seekg(offset * SectorSize, ios::beg);
112     if (!stream.good())
113         panic("Could not seek to location in file");
114 
115     streampos pos = stream.tellg();
116     stream.read((char *)data, SectorSize);
117 
118     DPRINTF(DiskImageRead, "read: offset=%d\n", (uint64_t)offset);
119     DDUMP(DiskImageRead, data, SectorSize);
120 
121     return stream.tellg() - pos;
122 }
\end{DoxyCode}
\hypertarget{classRawDiskImage_ac47c8c9bb5ae5fbfa7e05b464d3e20d4}{
\index{RawDiskImage@{RawDiskImage}!size@{size}}
\index{size@{size}!RawDiskImage@{RawDiskImage}}
\subsubsection[{size}]{\setlength{\rightskip}{0pt plus 5cm}std::streampos size () const\hspace{0.3cm}{\ttfamily  \mbox{[}virtual\mbox{]}}}}
\label{classRawDiskImage_ac47c8c9bb5ae5fbfa7e05b464d3e20d4}


\hyperlink{classDiskImage_a0e772d58951a6696fce770bd4c390e9f}{DiskImage}を実装しています。


\begin{DoxyCode}
91 {
92     if (disk_size == 0) {
93         if (!stream.is_open())
94             panic("file not open!\n");
95         stream.seekg(0, ios::end);
96         disk_size = stream.tellg();
97     }
98 
99     return disk_size / SectorSize;
100 }
\end{DoxyCode}
\hypertarget{classRawDiskImage_aadff68e91a6ca912a1878d79af3d0692}{
\index{RawDiskImage@{RawDiskImage}!write@{write}}
\index{write@{write}!RawDiskImage@{RawDiskImage}}
\subsubsection[{write}]{\setlength{\rightskip}{0pt plus 5cm}std::streampos write (const uint8\_\-t $\ast$ {\em data}, \/  std::streampos {\em offset})\hspace{0.3cm}{\ttfamily  \mbox{[}virtual\mbox{]}}}}
\label{classRawDiskImage_aadff68e91a6ca912a1878d79af3d0692}


\hyperlink{classDiskImage_a42c90a80133a988d65ab33cc4d31d168}{DiskImage}を実装しています。


\begin{DoxyCode}
126 {
127     if (!initialized)
128         panic("RawDiskImage not initialized");
129 
130     if (readonly)
131         panic("Cannot write to a read only disk image");
132 
133     if (!stream.is_open())
134         panic("file not open!\n");
135 
136     stream.seekp(offset * SectorSize, ios::beg);
137     if (!stream.good())
138         panic("Could not seek to location in file");
139 
140     DPRINTF(DiskImageWrite, "write: offset=%d\n", (uint64_t)offset);
141     DDUMP(DiskImageWrite, data, SectorSize);
142 
143     streampos pos = stream.tellp();
144     stream.write((const char *)data, SectorSize);
145     return stream.tellp() - pos;
146 }
\end{DoxyCode}


\subsection{変数}
\hypertarget{classRawDiskImage_a242120545024c17e9854e58aa7496c08}{
\index{RawDiskImage@{RawDiskImage}!disk\_\-size@{disk\_\-size}}
\index{disk\_\-size@{disk\_\-size}!RawDiskImage@{RawDiskImage}}
\subsubsection[{disk\_\-size}]{\setlength{\rightskip}{0pt plus 5cm}std::streampos {\bf disk\_\-size}\hspace{0.3cm}{\ttfamily  \mbox{[}mutable, protected\mbox{]}}}}
\label{classRawDiskImage_a242120545024c17e9854e58aa7496c08}
\hypertarget{classRawDiskImage_aefc35c7944eed319c89bc1b399f0eb67}{
\index{RawDiskImage@{RawDiskImage}!file@{file}}
\index{file@{file}!RawDiskImage@{RawDiskImage}}
\subsubsection[{file}]{\setlength{\rightskip}{0pt plus 5cm}std::string {\bf file}\hspace{0.3cm}{\ttfamily  \mbox{[}protected\mbox{]}}}}
\label{classRawDiskImage_aefc35c7944eed319c89bc1b399f0eb67}
\hypertarget{classRawDiskImage_ae04692b1a934bc6b8c48b43c95add0fa}{
\index{RawDiskImage@{RawDiskImage}!readonly@{readonly}}
\index{readonly@{readonly}!RawDiskImage@{RawDiskImage}}
\subsubsection[{readonly}]{\setlength{\rightskip}{0pt plus 5cm}bool {\bf readonly}\hspace{0.3cm}{\ttfamily  \mbox{[}protected\mbox{]}}}}
\label{classRawDiskImage_ae04692b1a934bc6b8c48b43c95add0fa}
\hypertarget{classRawDiskImage_a8858ebba853bebec63897a055877c296}{
\index{RawDiskImage@{RawDiskImage}!stream@{stream}}
\index{stream@{stream}!RawDiskImage@{RawDiskImage}}
\subsubsection[{stream}]{\setlength{\rightskip}{0pt plus 5cm}std::fstream {\bf stream}\hspace{0.3cm}{\ttfamily  \mbox{[}mutable, protected\mbox{]}}}}
\label{classRawDiskImage_a8858ebba853bebec63897a055877c296}


このクラスの説明は次のファイルから生成されました:\begin{DoxyCompactItemize}
\item 
dev/\hyperlink{disk__image_8hh}{disk\_\-image.hh}\item 
dev/\hyperlink{disk__image_8cc}{disk\_\-image.cc}\end{DoxyCompactItemize}
