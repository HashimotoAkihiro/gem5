\hypertarget{classCopyEngine_1_1CopyEngineChannel}{
\section{クラス CopyEngineChannel}
\label{classCopyEngine_1_1CopyEngineChannel}\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
}
CopyEngineChannelに対する継承グラフ:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2cm]{classCopyEngine_1_1CopyEngineChannel}
\end{center}
\end{figure}
\subsection*{Public メソッド}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classCopyEngine_1_1CopyEngineChannel_a407c12791405657ab18510c2141828fe}{CopyEngineChannel} (\hyperlink{classCopyEngine_1_1CopyEngine}{CopyEngine} $\ast$\_\-ce, int cid)
\item 
virtual \hyperlink{classCopyEngine_1_1CopyEngineChannel_a9d13764944deaf17eb431f30157545ca}{$\sim$CopyEngineChannel} ()
\item 
\hyperlink{classBaseMasterPort}{BaseMasterPort} \& \hyperlink{classCopyEngine_1_1CopyEngineChannel_a4e826c60c407af047c6cfdcba5f79467}{getMasterPort} ()
\item 
std::string \hyperlink{classCopyEngine_1_1CopyEngineChannel_af1801e31af6399bccce114ab12575168}{name} ()
\item 
virtual \hyperlink{base_2types_8hh_a5c8ed81b7d238c9083e1037ba6d61643}{Tick} \hyperlink{classCopyEngine_1_1CopyEngineChannel_a3848226950f14efe17b2b251384cde95}{read} (\hyperlink{classPacket}{PacketPtr} pkt)
\item 
virtual \hyperlink{base_2types_8hh_a5c8ed81b7d238c9083e1037ba6d61643}{Tick} \hyperlink{classCopyEngine_1_1CopyEngineChannel_aeda092863c7ed5e4523d9b705d0d8c15}{write} (\hyperlink{classPacket}{PacketPtr} pkt)
\item 
void \hyperlink{classCopyEngine_1_1CopyEngineChannel_a0d7e053ca25cc1b216632397c95161b7}{channelRead} (\hyperlink{classPacket}{PacketPtr} pkt, \hyperlink{base_2types_8hh_af1bb03d6a4ee096394a6749f0a169232}{Addr} daddr, int size)
\item 
void \hyperlink{classCopyEngine_1_1CopyEngineChannel_a2ba2036c031e913ac61e918218159eaa}{channelWrite} (\hyperlink{classPacket}{PacketPtr} pkt, \hyperlink{base_2types_8hh_af1bb03d6a4ee096394a6749f0a169232}{Addr} daddr, int size)
\item 
unsigned int \hyperlink{classCopyEngine_1_1CopyEngineChannel_a6bf479c521c7c3eb473822d953275b26}{drain} (\hyperlink{classDrainManager}{DrainManager} $\ast$drainManger)
\item 
void \hyperlink{classCopyEngine_1_1CopyEngineChannel_a8f020d3237536fe007fc488c4125c5d8}{drainResume} ()
\item 
void \hyperlink{classCopyEngine_1_1CopyEngineChannel_a53e036786d17361be4c7320d39c99b84}{serialize} (std::ostream \&os)
\item 
void \hyperlink{classCopyEngine_1_1CopyEngineChannel_af22e5d6d660b97db37003ac61ac4ee49}{unserialize} (\hyperlink{classCheckpoint}{Checkpoint} $\ast$cp, const std::string \&section)
\end{DoxyCompactItemize}
\subsection*{Private 型}
\begin{DoxyCompactItemize}
\item 
enum \hyperlink{classCopyEngine_1_1CopyEngineChannel_ac41ef28e0083b7345bf0f53f33934a73}{ChannelState} \{ \par
\hyperlink{classCopyEngine_1_1CopyEngineChannel_ac41ef28e0083b7345bf0f53f33934a73ad3fa9ae9431d6cb1772f9d9df48cab19}{Idle}, 
\hyperlink{classCopyEngine_1_1CopyEngineChannel_ac41ef28e0083b7345bf0f53f33934a73a9f5a96909ad4740fa07395d9482859b0}{AddressFetch}, 
\hyperlink{classCopyEngine_1_1CopyEngineChannel_ac41ef28e0083b7345bf0f53f33934a73a2e5e9f9afcc849fb4b26d2dc676713f6}{DescriptorFetch}, 
\hyperlink{classCopyEngine_1_1CopyEngineChannel_ac41ef28e0083b7345bf0f53f33934a73a625468fb1b5afee8d3524833e1511286}{DMARead}, 
\par
\hyperlink{classCopyEngine_1_1CopyEngineChannel_ac41ef28e0083b7345bf0f53f33934a73a95a1c91ff83ac2d556d87cc16d23924e}{DMAWrite}, 
\hyperlink{classCopyEngine_1_1CopyEngineChannel_ac41ef28e0083b7345bf0f53f33934a73ab1dcef87eab1fcd5ea4a9e215aa45f25}{CompletionWrite}
 \}
\end{DoxyCompactItemize}
\subsection*{Private メソッド}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{classCopyEngine_1_1CopyEngineChannel_ade0b28ef4d83eab52f66f236473fb486}{fetchDescriptor} (\hyperlink{base_2types_8hh_af1bb03d6a4ee096394a6749f0a169232}{Addr} address)
\item 
void \hyperlink{classCopyEngine_1_1CopyEngineChannel_a603f8a373e26c50ac5daa350afde3355}{fetchDescComplete} ()
\item 
void \hyperlink{classCopyEngine_1_1CopyEngineChannel_a2569cf33044109a5a992ef1452cf7a7c}{fetchNextAddr} (\hyperlink{base_2types_8hh_af1bb03d6a4ee096394a6749f0a169232}{Addr} address)
\item 
void \hyperlink{classCopyEngine_1_1CopyEngineChannel_a35f044598c449411508cd2592e06ff8e}{fetchAddrComplete} ()
\item 
void \hyperlink{classCopyEngine_1_1CopyEngineChannel_a366c54487857e85b17043ef81def74ee}{readCopyBytes} ()
\item 
void \hyperlink{classCopyEngine_1_1CopyEngineChannel_a9bb5ef45f6e13dccc565640d1ccb8cdd}{readCopyBytesComplete} ()
\item 
void \hyperlink{classCopyEngine_1_1CopyEngineChannel_aa538c330f51ea59fafe7a1d37a776111}{writeCopyBytes} ()
\item 
void \hyperlink{classCopyEngine_1_1CopyEngineChannel_a34b0271502a103b28409e1796b16b95b}{writeCopyBytesComplete} ()
\item 
void \hyperlink{classCopyEngine_1_1CopyEngineChannel_ad307f71461c646a5e9cd24579611f827}{writeCompletionStatus} ()
\item 
void \hyperlink{classCopyEngine_1_1CopyEngineChannel_abbbcfb2dd0fad92c68dfda56b4b334b8}{writeStatusComplete} ()
\item 
void \hyperlink{classCopyEngine_1_1CopyEngineChannel_ac8396f8f0fe67599f56c870c45cd4bf7}{continueProcessing} ()
\item 
void \hyperlink{classCopyEngine_1_1CopyEngineChannel_a29f4846167c0833db565e7848de4c3a2}{recvCommand} ()
\item 
bool \hyperlink{classCopyEngine_1_1CopyEngineChannel_ae377b3f8babf5878cbeded1e190a4893}{inDrain} ()
\item 
void \hyperlink{classCopyEngine_1_1CopyEngineChannel_a9504930bccd8ae4e8593d3aefaba7548}{restartStateMachine} ()
\item 
void \hyperlink{classCopyEngine_1_1CopyEngineChannel_a8000b4835a66b0ff75fa7f5512f727a2}{anBegin} (const char $\ast$s)
\item 
void \hyperlink{classCopyEngine_1_1CopyEngineChannel_a34885371096072728525cff5eaae0c8c}{anWait} ()
\item 
void \hyperlink{classCopyEngine_1_1CopyEngineChannel_a6d48da71893149c635dac1dfb9db7cc9}{anDq} ()
\item 
void \hyperlink{classCopyEngine_1_1CopyEngineChannel_a404a8353a35bc56b38afd5a5f6733bee}{anPq} ()
\item 
void \hyperlink{classCopyEngine_1_1CopyEngineChannel_aa754a1b36810cef759e3c709a3d941e3}{anQ} (const char $\ast$s, uint64\_\-t id, int size=1)
\end{DoxyCompactItemize}
\subsection*{Private 変数}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classDmaPort}{DmaPort} \hyperlink{classCopyEngine_1_1CopyEngineChannel_af65ef939be20997afb5d546cbe2fa253}{cePort}
\item 
\hyperlink{classCopyEngine_1_1CopyEngine}{CopyEngine} $\ast$ \hyperlink{classCopyEngine_1_1CopyEngineChannel_ae925c50266b3cf6452dc9726999e1adc}{ce}
\item 
\hyperlink{structCopyEngineReg_1_1ChanRegs}{CopyEngineReg::ChanRegs} \hyperlink{classCopyEngine_1_1CopyEngineChannel_af1b40caebc370f0d226cb1a52483ddfc}{cr}
\item 
int \hyperlink{classCopyEngine_1_1CopyEngineChannel_a2ee325435cb56082296ff4412aede290}{channelId}
\item 
\hyperlink{structCopyEngineReg_1_1DmaDesc}{CopyEngineReg::DmaDesc} $\ast$ \hyperlink{classCopyEngine_1_1CopyEngineChannel_af8c0eaac54803b25f0dfdbb89600093b}{curDmaDesc}
\item 
uint8\_\-t $\ast$ \hyperlink{classCopyEngine_1_1CopyEngineChannel_afbda594180f4eaeac0026b69add1ca2f}{copyBuffer}
\item 
bool \hyperlink{classCopyEngine_1_1CopyEngineChannel_abbe792bb2cf67584b86443440a194f46}{busy}
\item 
bool \hyperlink{classCopyEngine_1_1CopyEngineChannel_a667d5cc444aa1980eba330fa927415d5}{underReset}
\item 
bool \hyperlink{classCopyEngine_1_1CopyEngineChannel_abfea5a69e8c7ebdb60f68225310d7c6e}{refreshNext}
\item 
\hyperlink{base_2types_8hh_af1bb03d6a4ee096394a6749f0a169232}{Addr} \hyperlink{classCopyEngine_1_1CopyEngineChannel_adc111744ad979f12ef5d0f7afd26c69d}{lastDescriptorAddr}
\item 
\hyperlink{base_2types_8hh_af1bb03d6a4ee096394a6749f0a169232}{Addr} \hyperlink{classCopyEngine_1_1CopyEngineChannel_a5eeb3d755d58eb24d74f92245bf18d2a}{fetchAddress}
\item 
\hyperlink{base_2types_8hh_a5c8ed81b7d238c9083e1037ba6d61643}{Tick} \hyperlink{classCopyEngine_1_1CopyEngineChannel_a34a95aa4b855102c3be97544c155e75a}{latBeforeBegin}
\item 
\hyperlink{base_2types_8hh_a5c8ed81b7d238c9083e1037ba6d61643}{Tick} \hyperlink{classCopyEngine_1_1CopyEngineChannel_aa97db4f2f9c86194366807cd2bd05ae8}{latAfterCompletion}
\item 
uint64\_\-t \hyperlink{classCopyEngine_1_1CopyEngineChannel_a939f73db208ee37ef7d262c44123d65a}{completionDataReg}
\item 
\hyperlink{classCopyEngine_1_1CopyEngineChannel_ac41ef28e0083b7345bf0f53f33934a73}{ChannelState} \hyperlink{classCopyEngine_1_1CopyEngineChannel_ab24b7ded83b7736b1f4f707b95109e5d}{nextState}
\item 
\hyperlink{classDrainManager}{DrainManager} $\ast$ \hyperlink{classCopyEngine_1_1CopyEngineChannel_a329b71fb934a93312ca0aacbf5a3f982}{drainManager}
\item 
\hyperlink{classEventWrapper}{EventWrapper}$<$ \hyperlink{classCopyEngine_1_1CopyEngineChannel}{CopyEngineChannel},\&CopyEngineChannel::fetchDescComplete $>$ \hyperlink{classCopyEngine_1_1CopyEngineChannel_a1534deeb56a4db6a811c7c5b42c192ca}{fetchCompleteEvent}
\item 
\hyperlink{classEventWrapper}{EventWrapper}$<$ \hyperlink{classCopyEngine_1_1CopyEngineChannel}{CopyEngineChannel},\&CopyEngineChannel::fetchAddrComplete $>$ \hyperlink{classCopyEngine_1_1CopyEngineChannel_a8d993ab6d140cbb64e18dd8e6e24fcc2}{addrCompleteEvent}
\item 
\hyperlink{classEventWrapper}{EventWrapper}$<$ \hyperlink{classCopyEngine_1_1CopyEngineChannel}{CopyEngineChannel},\&CopyEngineChannel::readCopyBytesComplete $>$ \hyperlink{classCopyEngine_1_1CopyEngineChannel_aa23ca1b4c066edc88d3770f275f1b250}{readCompleteEvent}
\item 
\hyperlink{classEventWrapper}{EventWrapper}$<$ \hyperlink{classCopyEngine_1_1CopyEngineChannel}{CopyEngineChannel},\&CopyEngineChannel::writeCopyBytesComplete $>$ \hyperlink{classCopyEngine_1_1CopyEngineChannel_a1008f08d5b6c9e1e72e6736909f23bbb}{writeCompleteEvent}
\item 
\hyperlink{classEventWrapper}{EventWrapper}$<$ \hyperlink{classCopyEngine_1_1CopyEngineChannel}{CopyEngineChannel},\&CopyEngineChannel::writeStatusComplete $>$ \hyperlink{classCopyEngine_1_1CopyEngineChannel_a311433f834e73820b65afccaadc60cf3}{statusCompleteEvent}
\end{DoxyCompactItemize}


\subsection{列挙型}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_ac41ef28e0083b7345bf0f53f33934a73}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!ChannelState@{ChannelState}}
\index{ChannelState@{ChannelState}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{ChannelState}]{\setlength{\rightskip}{0pt plus 5cm}enum {\bf ChannelState}\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classCopyEngine_1_1CopyEngineChannel_ac41ef28e0083b7345bf0f53f33934a73}
\begin{Desc}
\item[列挙型の値: ]\par
\begin{description}
\index{Idle@{Idle}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!Idle@{Idle}}\item[{\em 
\hypertarget{classCopyEngine_1_1CopyEngineChannel_ac41ef28e0083b7345bf0f53f33934a73ad3fa9ae9431d6cb1772f9d9df48cab19}{
Idle}
\label{classCopyEngine_1_1CopyEngineChannel_ac41ef28e0083b7345bf0f53f33934a73ad3fa9ae9431d6cb1772f9d9df48cab19}
}]\index{AddressFetch@{AddressFetch}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!AddressFetch@{AddressFetch}}\item[{\em 
\hypertarget{classCopyEngine_1_1CopyEngineChannel_ac41ef28e0083b7345bf0f53f33934a73a9f5a96909ad4740fa07395d9482859b0}{
AddressFetch}
\label{classCopyEngine_1_1CopyEngineChannel_ac41ef28e0083b7345bf0f53f33934a73a9f5a96909ad4740fa07395d9482859b0}
}]\index{DescriptorFetch@{DescriptorFetch}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!DescriptorFetch@{DescriptorFetch}}\item[{\em 
\hypertarget{classCopyEngine_1_1CopyEngineChannel_ac41ef28e0083b7345bf0f53f33934a73a2e5e9f9afcc849fb4b26d2dc676713f6}{
DescriptorFetch}
\label{classCopyEngine_1_1CopyEngineChannel_ac41ef28e0083b7345bf0f53f33934a73a2e5e9f9afcc849fb4b26d2dc676713f6}
}]\index{DMARead@{DMARead}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!DMARead@{DMARead}}\item[{\em 
\hypertarget{classCopyEngine_1_1CopyEngineChannel_ac41ef28e0083b7345bf0f53f33934a73a625468fb1b5afee8d3524833e1511286}{
DMARead}
\label{classCopyEngine_1_1CopyEngineChannel_ac41ef28e0083b7345bf0f53f33934a73a625468fb1b5afee8d3524833e1511286}
}]\index{DMAWrite@{DMAWrite}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!DMAWrite@{DMAWrite}}\item[{\em 
\hypertarget{classCopyEngine_1_1CopyEngineChannel_ac41ef28e0083b7345bf0f53f33934a73a95a1c91ff83ac2d556d87cc16d23924e}{
DMAWrite}
\label{classCopyEngine_1_1CopyEngineChannel_ac41ef28e0083b7345bf0f53f33934a73a95a1c91ff83ac2d556d87cc16d23924e}
}]\index{CompletionWrite@{CompletionWrite}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!CompletionWrite@{CompletionWrite}}\item[{\em 
\hypertarget{classCopyEngine_1_1CopyEngineChannel_ac41ef28e0083b7345bf0f53f33934a73ab1dcef87eab1fcd5ea4a9e215aa45f25}{
CompletionWrite}
\label{classCopyEngine_1_1CopyEngineChannel_ac41ef28e0083b7345bf0f53f33934a73ab1dcef87eab1fcd5ea4a9e215aa45f25}
}]\end{description}
\end{Desc}




\begin{DoxyCode}
84                           {
85             Idle,
86             AddressFetch,
87             DescriptorFetch,
88             DMARead,
89             DMAWrite,
90             CompletionWrite
91         };
\end{DoxyCode}


\subsection{コンストラクタとデストラクタ}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_a407c12791405657ab18510c2141828fe}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!CopyEngineChannel@{CopyEngineChannel}}
\index{CopyEngineChannel@{CopyEngineChannel}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{CopyEngineChannel}]{\setlength{\rightskip}{0pt plus 5cm}{\bf CopyEngineChannel} ({\bf CopyEngine} $\ast$ {\em \_\-ce}, \/  int {\em cid})}}
\label{classCopyEngine_1_1CopyEngineChannel_a407c12791405657ab18510c2141828fe}



\begin{DoxyCode}
81     : cePort(_ce, _ce->sys),
82       ce(_ce), channelId(cid), busy(false), underReset(false),
83     refreshNext(false), latBeforeBegin(ce->params()->latBeforeBegin),
84     latAfterCompletion(ce->params()->latAfterCompletion),
85     completionDataReg(0), nextState(Idle), drainManager(NULL),
86     fetchCompleteEvent(this), addrCompleteEvent(this),
87     readCompleteEvent(this), writeCompleteEvent(this),
88     statusCompleteEvent(this)
89 
90 {
91         cr.status.dma_transfer_status(3);
92         cr.descChainAddr = 0;
93         cr.completionAddr = 0;
94 
95         curDmaDesc = new DmaDesc;
96         memset(curDmaDesc, 0, sizeof(DmaDesc));
97         copyBuffer = new uint8_t[ce->params()->XferCap];
98 }
\end{DoxyCode}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_a9d13764944deaf17eb431f30157545ca}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!$\sim$CopyEngineChannel@{$\sim$CopyEngineChannel}}
\index{$\sim$CopyEngineChannel@{$\sim$CopyEngineChannel}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{$\sim$CopyEngineChannel}]{\setlength{\rightskip}{0pt plus 5cm}$\sim${\bf CopyEngineChannel} ()\hspace{0.3cm}{\ttfamily  \mbox{[}virtual\mbox{]}}}}
\label{classCopyEngine_1_1CopyEngineChannel_a9d13764944deaf17eb431f30157545ca}



\begin{DoxyCode}
108 {
109     delete curDmaDesc;
110     delete [] copyBuffer;
111 }
\end{DoxyCode}


\subsection{関数}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_a8000b4835a66b0ff75fa7f5512f727a2}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!anBegin@{anBegin}}
\index{anBegin@{anBegin}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{anBegin}]{\setlength{\rightskip}{0pt plus 5cm}void anBegin (const char $\ast$ {\em s})\hspace{0.3cm}{\ttfamily  \mbox{[}inline, private\mbox{]}}}}
\label{classCopyEngine_1_1CopyEngineChannel_a8000b4835a66b0ff75fa7f5512f727a2}



\begin{DoxyCode}
148         {
149             CPA::cpa()->hwBegin(CPA::FL_NONE, ce->sys,
150                          channelId, "CopyEngine", s);
151         }
\end{DoxyCode}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_a6d48da71893149c635dac1dfb9db7cc9}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!anDq@{anDq}}
\index{anDq@{anDq}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{anDq}]{\setlength{\rightskip}{0pt plus 5cm}void anDq ()\hspace{0.3cm}{\ttfamily  \mbox{[}inline, private\mbox{]}}}}
\label{classCopyEngine_1_1CopyEngineChannel_a6d48da71893149c635dac1dfb9db7cc9}



\begin{DoxyCode}
160         {
161             CPA::cpa()->hwDq(CPA::FL_NONE, ce->sys,
162                       channelId, "CopyEngine", "DMAUnusedDescQ", channelId);
163         }
\end{DoxyCode}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_a404a8353a35bc56b38afd5a5f6733bee}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!anPq@{anPq}}
\index{anPq@{anPq}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{anPq}]{\setlength{\rightskip}{0pt plus 5cm}void anPq ()\hspace{0.3cm}{\ttfamily  \mbox{[}inline, private\mbox{]}}}}
\label{classCopyEngine_1_1CopyEngineChannel_a404a8353a35bc56b38afd5a5f6733bee}



\begin{DoxyCode}
166         {
167             CPA::cpa()->hwDq(CPA::FL_NONE, ce->sys,
168                       channelId, "CopyEngine", "DMAUnusedDescQ", channelId);
169         }
\end{DoxyCode}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_aa754a1b36810cef759e3c709a3d941e3}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!anQ@{anQ}}
\index{anQ@{anQ}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{anQ}]{\setlength{\rightskip}{0pt plus 5cm}void anQ (const char $\ast$ {\em s}, \/  uint64\_\-t {\em id}, \/  int {\em size} = {\ttfamily 1})\hspace{0.3cm}{\ttfamily  \mbox{[}inline, private\mbox{]}}}}
\label{classCopyEngine_1_1CopyEngineChannel_aa754a1b36810cef759e3c709a3d941e3}



\begin{DoxyCode}
172         {
173             CPA::cpa()->hwQ(CPA::FL_NONE, ce->sys, channelId,
174                     "CopyEngine", s, id, NULL, size);
175         }
\end{DoxyCode}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_a34885371096072728525cff5eaae0c8c}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!anWait@{anWait}}
\index{anWait@{anWait}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{anWait}]{\setlength{\rightskip}{0pt plus 5cm}void anWait ()\hspace{0.3cm}{\ttfamily  \mbox{[}inline, private\mbox{]}}}}
\label{classCopyEngine_1_1CopyEngineChannel_a34885371096072728525cff5eaae0c8c}



\begin{DoxyCode}
154         {
155             CPA::cpa()->hwWe(CPA::FL_NONE, ce->sys,
156                      channelId, "CopyEngine", "DMAUnusedDescQ", channelId);
157         }
\end{DoxyCode}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_a0d7e053ca25cc1b216632397c95161b7}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!channelRead@{channelRead}}
\index{channelRead@{channelRead}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{channelRead}]{\setlength{\rightskip}{0pt plus 5cm}void channelRead ({\bf PacketPtr} {\em pkt}, \/  {\bf Addr} {\em daddr}, \/  int {\em size})}}
\label{classCopyEngine_1_1CopyEngineChannel_a0d7e053ca25cc1b216632397c95161b7}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_a2ba2036c031e913ac61e918218159eaa}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!channelWrite@{channelWrite}}
\index{channelWrite@{channelWrite}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{channelWrite}]{\setlength{\rightskip}{0pt plus 5cm}void channelWrite ({\bf PacketPtr} {\em pkt}, \/  {\bf Addr} {\em daddr}, \/  int {\em size})}}
\label{classCopyEngine_1_1CopyEngineChannel_a2ba2036c031e913ac61e918218159eaa}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_ac8396f8f0fe67599f56c870c45cd4bf7}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!continueProcessing@{continueProcessing}}
\index{continueProcessing@{continueProcessing}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{continueProcessing}]{\setlength{\rightskip}{0pt plus 5cm}void continueProcessing ()\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classCopyEngine_1_1CopyEngineChannel_ac8396f8f0fe67599f56c870c45cd4bf7}



\begin{DoxyCode}
553 {
554     busy = false;
555 
556     if (underReset) {
557         anBegin("Reset");
558         anWait();
559         underReset = false;
560         refreshNext = false;
561         busy = false;
562         nextState = Idle;
563         return;
564     }
565 
566     if (curDmaDesc->next) {
567         nextState = DescriptorFetch;
568         fetchAddress = curDmaDesc->next;
569         if (inDrain()) return;
570         fetchDescriptor(curDmaDesc->next);
571     } else if (refreshNext) {
572         nextState = AddressFetch;
573         refreshNext = false;
574         if (inDrain()) return;
575         fetchNextAddr(lastDescriptorAddr);
576     } else {
577         inDrain();
578         nextState = Idle;
579         anWait();
580         anBegin("Idle");
581     }
582 }
\end{DoxyCode}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_a6bf479c521c7c3eb473822d953275b26}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!drain@{drain}}
\index{drain@{drain}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{drain}]{\setlength{\rightskip}{0pt plus 5cm}unsigned int drain ({\bf DrainManager} $\ast$ {\em drainManager})\hspace{0.3cm}{\ttfamily  \mbox{[}virtual\mbox{]}}}}
\label{classCopyEngine_1_1CopyEngineChannel_a6bf479c521c7c3eb473822d953275b26}
Determine if an object needs draining and register a \hyperlink{classDrainManager}{DrainManager}.

When draining the state of an object, the simulator calls drain with a pointer to a drain manager. If the object does not need further simulation to drain internal buffers, it switched to the Drained state and returns 0, otherwise it switches to the Draining state and returns the number of times that it will call \hyperlink{classEvent_a142b75b68a6291400e20fb0dd905b1c8}{Event::process()} on the drain event. Most objects are expected to return either 0 or 1.

\begin{DoxyNote}{覚え書き}
An object that has entered the Drained state can be disturbed by other objects in the system and consequently be forced to enter the Draining state again. The simulator therefore repeats the draining process until all objects return 0 on the first call to \hyperlink{classCopyEngine_1_1CopyEngineChannel_a6bf479c521c7c3eb473822d953275b26}{drain()}.
\end{DoxyNote}

\begin{DoxyParams}{引数}
\item[{\em drainManager}]\hyperlink{classDrainManager}{DrainManager} to use to inform the simulator when draining has completed.\end{DoxyParams}
\begin{DoxyReturn}{戻り値}
0 if the object is ready for serialization now, $>$0 if it needs further simulation. 
\end{DoxyReturn}


\hyperlink{classDrainable_a1ed42c14f2f622ea6b0df3865e89c8b4}{Drainable}を実装しています。


\begin{DoxyCode}
652 {
653     if (nextState == Idle || ce->getDrainState() != Drainable::Running)
654         return 0;
655     unsigned int count = 1;
656     count += cePort.drain(dm);
657 
658     DPRINTF(Drain, "CopyEngineChannel not drained\n");
659     this->drainManager = dm;
660     return count;
661 }
\end{DoxyCode}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_a8f020d3237536fe007fc488c4125c5d8}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!drainResume@{drainResume}}
\index{drainResume@{drainResume}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{drainResume}]{\setlength{\rightskip}{0pt plus 5cm}void drainResume ()\hspace{0.3cm}{\ttfamily  \mbox{[}virtual\mbox{]}}}}
\label{classCopyEngine_1_1CopyEngineChannel_a8f020d3237536fe007fc488c4125c5d8}
Resume execution after a successful drain.

\begin{DoxyNote}{覚え書き}
This method is normally only called from the simulation scripts. 
\end{DoxyNote}


\hyperlink{classDrainable_a8f020d3237536fe007fc488c4125c5d8}{Drainable}を再定義しています。


\begin{DoxyCode}
773 {
774     DPRINTF(DMACopyEngine, "Restarting state machine at state %d\n", nextState);
775     restartStateMachine();
776 }
\end{DoxyCode}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_a35f044598c449411508cd2592e06ff8e}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!fetchAddrComplete@{fetchAddrComplete}}
\index{fetchAddrComplete@{fetchAddrComplete}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{fetchAddrComplete}]{\setlength{\rightskip}{0pt plus 5cm}void fetchAddrComplete ()\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classCopyEngine_1_1CopyEngineChannel_a35f044598c449411508cd2592e06ff8e}



\begin{DoxyCode}
619 {
620     DPRINTF(DMACopyEngine, "Fetching next address complete: %#x\n",
621             curDmaDesc->next);
622     if (!curDmaDesc->next) {
623         DPRINTF(DMACopyEngine, "Got NULL descriptor, nothing more to do\n");
624         busy = false;
625         nextState = Idle;
626         anWait();
627         anBegin("Idle");
628         inDrain();
629         return;
630     }
631     nextState = DescriptorFetch;
632     fetchAddress = curDmaDesc->next;
633     if (inDrain()) return;
634     fetchDescriptor(curDmaDesc->next);
635 }
\end{DoxyCode}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_a603f8a373e26c50ac5daa350afde3355}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!fetchDescComplete@{fetchDescComplete}}
\index{fetchDescComplete@{fetchDescComplete}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{fetchDescComplete}]{\setlength{\rightskip}{0pt plus 5cm}void fetchDescComplete ()\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classCopyEngine_1_1CopyEngineChannel_a603f8a373e26c50ac5daa350afde3355}



\begin{DoxyCode}
465 {
466     DPRINTF(DMACopyEngine, "Read of descriptor complete\n");
467 
468     if ((curDmaDesc->command & DESC_CTRL_NULL)) {
469         DPRINTF(DMACopyEngine, "Got NULL descriptor, skipping\n");
470         assert(!(curDmaDesc->command & DESC_CTRL_CP_STS));
471         if (curDmaDesc->command & DESC_CTRL_CP_STS) {
472             panic("Shouldn't be able to get here\n");
473             nextState = CompletionWrite;
474             if (inDrain()) return;
475             writeCompletionStatus();
476         } else {
477             anBegin("Idle");
478             anWait();
479             busy = false;
480             nextState = Idle;
481             inDrain();
482         }
483         return;
484     }
485 
486     if (curDmaDesc->command & ~DESC_CTRL_CP_STS)
487         panic("Descriptor has flag other that completion status set\n");
488 
489     nextState = DMARead;
490     if (inDrain()) return;
491     readCopyBytes();
492 }
\end{DoxyCode}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_ade0b28ef4d83eab52f66f236473fb486}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!fetchDescriptor@{fetchDescriptor}}
\index{fetchDescriptor@{fetchDescriptor}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{fetchDescriptor}]{\setlength{\rightskip}{0pt plus 5cm}void fetchDescriptor ({\bf Addr} {\em address})\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classCopyEngine_1_1CopyEngineChannel_ade0b28ef4d83eab52f66f236473fb486}



\begin{DoxyCode}
446 {
447     anDq();
448     anBegin("FetchDescriptor");
449     DPRINTF(DMACopyEngine, "Reading descriptor from at memory location %#x(%#x)\n
      ",
450            address, ce->platform->pciToDma(address));
451     assert(address);
452     busy = true;
453 
454     DPRINTF(DMACopyEngine, "dmaAction: %#x, %d bytes, to addr %#x\n",
455             ce->platform->pciToDma(address), sizeof(DmaDesc), curDmaDesc);
456 
457     cePort.dmaAction(MemCmd::ReadReq, ce->platform->pciToDma(address),
458                      sizeof(DmaDesc), &fetchCompleteEvent,
459                      (uint8_t*)curDmaDesc, latBeforeBegin);
460     lastDescriptorAddr = address;
461 }
\end{DoxyCode}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_a2569cf33044109a5a992ef1452cf7a7c}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!fetchNextAddr@{fetchNextAddr}}
\index{fetchNextAddr@{fetchNextAddr}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{fetchNextAddr}]{\setlength{\rightskip}{0pt plus 5cm}void fetchNextAddr ({\bf Addr} {\em address})\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classCopyEngine_1_1CopyEngineChannel_a2569cf33044109a5a992ef1452cf7a7c}



\begin{DoxyCode}
607 {
608     anBegin("FetchNextAddr");
609     DPRINTF(DMACopyEngine, "Fetching next address...\n");
610     busy = true;
611     cePort.dmaAction(MemCmd::ReadReq,
612                      ce->platform->pciToDma(address + offsetof(DmaDesc, next)),
613                      sizeof(Addr), &addrCompleteEvent,
614                      (uint8_t*)curDmaDesc + offsetof(DmaDesc, next), 0);
615 }
\end{DoxyCode}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_a4e826c60c407af047c6cfdcba5f79467}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!getMasterPort@{getMasterPort}}
\index{getMasterPort@{getMasterPort}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{getMasterPort}]{\setlength{\rightskip}{0pt plus 5cm}{\bf BaseMasterPort} \& getMasterPort ()}}
\label{classCopyEngine_1_1CopyEngineChannel_a4e826c60c407af047c6cfdcba5f79467}



\begin{DoxyCode}
131 {
132     return cePort;
133 }
\end{DoxyCode}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_ae377b3f8babf5878cbeded1e190a4893}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!inDrain@{inDrain}}
\index{inDrain@{inDrain}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{inDrain}]{\setlength{\rightskip}{0pt plus 5cm}bool inDrain ()\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classCopyEngine_1_1CopyEngineChannel_ae377b3f8babf5878cbeded1e190a4893}



\begin{DoxyCode}
639 {
640     if (ce->getDrainState() == Drainable::Draining) {
641         DPRINTF(Drain, "CopyEngine done draining, processing drain event\n");
642         assert(drainManager);
643         drainManager->signalDrainDone();
644         drainManager = NULL;
645     }
646 
647     return ce->getDrainState() != Drainable::Running;
648 }
\end{DoxyCode}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_af1801e31af6399bccce114ab12575168}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!name@{name}}
\index{name@{name}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{name}]{\setlength{\rightskip}{0pt plus 5cm}std::string name ()\hspace{0.3cm}{\ttfamily  \mbox{[}inline\mbox{]}}}}
\label{classCopyEngine_1_1CopyEngineChannel_af1801e31af6399bccce114ab12575168}



\begin{DoxyCode}
101 { assert(ce); return ce->name() + csprintf("-chan%d", channelId); }
\end{DoxyCode}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_a3848226950f14efe17b2b251384cde95}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!read@{read}}
\index{read@{read}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{read}]{\setlength{\rightskip}{0pt plus 5cm}virtual {\bf Tick} read ({\bf PacketPtr} {\em pkt})\hspace{0.3cm}{\ttfamily  \mbox{[}inline, virtual\mbox{]}}}}
\label{classCopyEngine_1_1CopyEngineChannel_a3848226950f14efe17b2b251384cde95}



\begin{DoxyCode}
103                         { panic("CopyEngineChannel has no I/O access\n");}
\end{DoxyCode}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_a366c54487857e85b17043ef81def74ee}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!readCopyBytes@{readCopyBytes}}
\index{readCopyBytes@{readCopyBytes}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{readCopyBytes}]{\setlength{\rightskip}{0pt plus 5cm}void readCopyBytes ()\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classCopyEngine_1_1CopyEngineChannel_a366c54487857e85b17043ef81def74ee}



\begin{DoxyCode}
496 {
497     anBegin("ReadCopyBytes");
498     DPRINTF(DMACopyEngine, "Reading %d bytes from buffer to memory location %#x(%
      #x)\n",
499            curDmaDesc->len, curDmaDesc->dest,
500            ce->platform->pciToDma(curDmaDesc->src));
501     cePort.dmaAction(MemCmd::ReadReq, ce->platform->pciToDma(curDmaDesc->src),
502                      curDmaDesc->len, &readCompleteEvent, copyBuffer, 0);
503 }
\end{DoxyCode}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_a9bb5ef45f6e13dccc565640d1ccb8cdd}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!readCopyBytesComplete@{readCopyBytesComplete}}
\index{readCopyBytesComplete@{readCopyBytesComplete}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{readCopyBytesComplete}]{\setlength{\rightskip}{0pt plus 5cm}void readCopyBytesComplete ()\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classCopyEngine_1_1CopyEngineChannel_a9bb5ef45f6e13dccc565640d1ccb8cdd}



\begin{DoxyCode}
507 {
508     DPRINTF(DMACopyEngine, "Read of bytes to copy complete\n");
509 
510     nextState = DMAWrite;
511     if (inDrain()) return;
512     writeCopyBytes();
513 }
\end{DoxyCode}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_a29f4846167c0833db565e7848de4c3a2}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!recvCommand@{recvCommand}}
\index{recvCommand@{recvCommand}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{recvCommand}]{\setlength{\rightskip}{0pt plus 5cm}void recvCommand ()\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classCopyEngine_1_1CopyEngineChannel_a29f4846167c0833db565e7848de4c3a2}



\begin{DoxyCode}
137 {
138     if (cr.command.start_dma()) {
139         assert(!busy);
140         cr.status.dma_transfer_status(0);
141         nextState = DescriptorFetch;
142         fetchAddress = cr.descChainAddr;
143         if (ce->getDrainState() == Drainable::Running)
144             fetchDescriptor(cr.descChainAddr);
145     } else if (cr.command.append_dma()) {
146         if (!busy) {
147             nextState = AddressFetch;
148             if (ce->getDrainState() == Drainable::Running)
149                 fetchNextAddr(lastDescriptorAddr);
150         } else
151             refreshNext = true;
152     } else if (cr.command.reset_dma()) {
153         if (busy)
154             underReset = true;
155         else {
156             cr.status.dma_transfer_status(3);
157             nextState = Idle;
158         }
159     } else if (cr.command.resume_dma() || cr.command.abort_dma() ||
160             cr.command.suspend_dma())
161         panic("Resume, Abort, and Suspend are not supported\n");
162     cr.command(0);
163 }
\end{DoxyCode}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_a9504930bccd8ae4e8593d3aefaba7548}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!restartStateMachine@{restartStateMachine}}
\index{restartStateMachine@{restartStateMachine}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{restartStateMachine}]{\setlength{\rightskip}{0pt plus 5cm}void restartStateMachine ()\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classCopyEngine_1_1CopyEngineChannel_a9504930bccd8ae4e8593d3aefaba7548}



\begin{DoxyCode}
738 {
739     switch(nextState) {
740       case AddressFetch:
741         fetchNextAddr(lastDescriptorAddr);
742         break;
743       case DescriptorFetch:
744         fetchDescriptor(fetchAddress);
745         break;
746       case DMARead:
747         readCopyBytes();
748         break;
749       case DMAWrite:
750         writeCopyBytes();
751         break;
752       case CompletionWrite:
753         writeCompletionStatus();
754         break;
755       case Idle:
756         break;
757       default:
758         panic("Unknown state for CopyEngineChannel\n");
759     }
760 }
\end{DoxyCode}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_a53e036786d17361be4c7320d39c99b84}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!serialize@{serialize}}
\index{serialize@{serialize}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{serialize}]{\setlength{\rightskip}{0pt plus 5cm}void serialize (std::ostream \& {\em os})}}
\label{classCopyEngine_1_1CopyEngineChannel_a53e036786d17361be4c7320d39c99b84}



\begin{DoxyCode}
702 {
703     SERIALIZE_SCALAR(channelId);
704     SERIALIZE_SCALAR(busy);
705     SERIALIZE_SCALAR(underReset);
706     SERIALIZE_SCALAR(refreshNext);
707     SERIALIZE_SCALAR(lastDescriptorAddr);
708     SERIALIZE_SCALAR(completionDataReg);
709     SERIALIZE_SCALAR(fetchAddress);
710     int nextState = this->nextState;
711     SERIALIZE_SCALAR(nextState);
712     arrayParamOut(os, "curDmaDesc", (uint8_t*)curDmaDesc, sizeof(DmaDesc));
713     SERIALIZE_ARRAY(copyBuffer, ce->params()->XferCap);
714     cr.serialize(os);
715 
716 }
\end{DoxyCode}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_af22e5d6d660b97db37003ac61ac4ee49}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!unserialize@{unserialize}}
\index{unserialize@{unserialize}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{unserialize}]{\setlength{\rightskip}{0pt plus 5cm}void unserialize ({\bf Checkpoint} $\ast$ {\em cp}, \/  const std::string \& {\em section})}}
\label{classCopyEngine_1_1CopyEngineChannel_af22e5d6d660b97db37003ac61ac4ee49}



\begin{DoxyCode}
719 {
720     UNSERIALIZE_SCALAR(channelId);
721     UNSERIALIZE_SCALAR(busy);
722     UNSERIALIZE_SCALAR(underReset);
723     UNSERIALIZE_SCALAR(refreshNext);
724     UNSERIALIZE_SCALAR(lastDescriptorAddr);
725     UNSERIALIZE_SCALAR(completionDataReg);
726     UNSERIALIZE_SCALAR(fetchAddress);
727     int nextState;
728     UNSERIALIZE_SCALAR(nextState);
729     this->nextState = (ChannelState)nextState;
730     arrayParamIn(cp, section, "curDmaDesc", (uint8_t*)curDmaDesc, sizeof(DmaDesc)
      );
731     UNSERIALIZE_ARRAY(copyBuffer, ce->params()->XferCap);
732     cr.unserialize(cp, section);
733 
734 }
\end{DoxyCode}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_aeda092863c7ed5e4523d9b705d0d8c15}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!write@{write}}
\index{write@{write}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{write}]{\setlength{\rightskip}{0pt plus 5cm}virtual {\bf Tick} write ({\bf PacketPtr} {\em pkt})\hspace{0.3cm}{\ttfamily  \mbox{[}inline, virtual\mbox{]}}}}
\label{classCopyEngine_1_1CopyEngineChannel_aeda092863c7ed5e4523d9b705d0d8c15}



\begin{DoxyCode}
105                         { panic("CopyEngineChannel has no I/O access\n"); }
\end{DoxyCode}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_ad307f71461c646a5e9cd24579611f827}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!writeCompletionStatus@{writeCompletionStatus}}
\index{writeCompletionStatus@{writeCompletionStatus}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{writeCompletionStatus}]{\setlength{\rightskip}{0pt plus 5cm}void writeCompletionStatus ()\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classCopyEngine_1_1CopyEngineChannel_ad307f71461c646a5e9cd24579611f827}



\begin{DoxyCode}
586 {
587     anBegin("WriteCompletionStatus");
588     DPRINTF(DMACopyEngine, "Writing completion status %#x to address %#x(%#x)\n",
      
589             completionDataReg, cr.completionAddr,
590             ce->platform->pciToDma(cr.completionAddr));
591 
592     cePort.dmaAction(MemCmd::WriteReq,
593                      ce->platform->pciToDma(cr.completionAddr),
594                      sizeof(completionDataReg), &statusCompleteEvent,
595                      (uint8_t*)&completionDataReg, latAfterCompletion);
596 }
\end{DoxyCode}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_aa538c330f51ea59fafe7a1d37a776111}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!writeCopyBytes@{writeCopyBytes}}
\index{writeCopyBytes@{writeCopyBytes}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{writeCopyBytes}]{\setlength{\rightskip}{0pt plus 5cm}void writeCopyBytes ()\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classCopyEngine_1_1CopyEngineChannel_aa538c330f51ea59fafe7a1d37a776111}



\begin{DoxyCode}
517 {
518     anBegin("WriteCopyBytes");
519     DPRINTF(DMACopyEngine, "Writing %d bytes from buffer to memory location %#x(%
      #x)\n",
520            curDmaDesc->len, curDmaDesc->dest,
521            ce->platform->pciToDma(curDmaDesc->dest));
522 
523     cePort.dmaAction(MemCmd::WriteReq, ce->platform->pciToDma(curDmaDesc->dest),
524                      curDmaDesc->len, &writeCompleteEvent, copyBuffer, 0);
525 
526     ce->bytesCopied[channelId] += curDmaDesc->len;
527     ce->copiesProcessed[channelId]++;
528 }
\end{DoxyCode}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_a34b0271502a103b28409e1796b16b95b}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!writeCopyBytesComplete@{writeCopyBytesComplete}}
\index{writeCopyBytesComplete@{writeCopyBytesComplete}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{writeCopyBytesComplete}]{\setlength{\rightskip}{0pt plus 5cm}void writeCopyBytesComplete ()\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classCopyEngine_1_1CopyEngineChannel_a34b0271502a103b28409e1796b16b95b}



\begin{DoxyCode}
532 {
533     DPRINTF(DMACopyEngine, "Write of bytes to copy complete user1: %#x\n",
534             curDmaDesc->user1);
535 
536     cr.status.compl_desc_addr(lastDescriptorAddr >> 6);
537     completionDataReg = cr.status() | 1;
538 
539     anQ("DMAUsedDescQ", channelId, 1);
540     anQ("AppRecvQ", curDmaDesc->user1, curDmaDesc->len);
541     if (curDmaDesc->command & DESC_CTRL_CP_STS) {
542         nextState = CompletionWrite;
543         if (inDrain()) return;
544         writeCompletionStatus();
545         return;
546     }
547 
548     continueProcessing();
549 }
\end{DoxyCode}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_abbbcfb2dd0fad92c68dfda56b4b334b8}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!writeStatusComplete@{writeStatusComplete}}
\index{writeStatusComplete@{writeStatusComplete}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{writeStatusComplete}]{\setlength{\rightskip}{0pt plus 5cm}void writeStatusComplete ()\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classCopyEngine_1_1CopyEngineChannel_abbbcfb2dd0fad92c68dfda56b4b334b8}



\begin{DoxyCode}
600 {
601     DPRINTF(DMACopyEngine, "Writing completion status complete\n");
602     continueProcessing();
603 }
\end{DoxyCode}


\subsection{変数}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_a8d993ab6d140cbb64e18dd8e6e24fcc2}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!addrCompleteEvent@{addrCompleteEvent}}
\index{addrCompleteEvent@{addrCompleteEvent}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{addrCompleteEvent}]{\setlength{\rightskip}{0pt plus 5cm}{\bf EventWrapper}$<${\bf CopyEngineChannel}, \&CopyEngineChannel::fetchAddrComplete$>$ {\bf addrCompleteEvent}\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classCopyEngine_1_1CopyEngineChannel_a8d993ab6d140cbb64e18dd8e6e24fcc2}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_abbe792bb2cf67584b86443440a194f46}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!busy@{busy}}
\index{busy@{busy}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{busy}]{\setlength{\rightskip}{0pt plus 5cm}bool {\bf busy}\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classCopyEngine_1_1CopyEngineChannel_abbe792bb2cf67584b86443440a194f46}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_ae925c50266b3cf6452dc9726999e1adc}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!ce@{ce}}
\index{ce@{ce}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{ce}]{\setlength{\rightskip}{0pt plus 5cm}{\bf CopyEngine}$\ast$ {\bf ce}\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classCopyEngine_1_1CopyEngineChannel_ae925c50266b3cf6452dc9726999e1adc}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_af65ef939be20997afb5d546cbe2fa253}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!cePort@{cePort}}
\index{cePort@{cePort}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{cePort}]{\setlength{\rightskip}{0pt plus 5cm}{\bf DmaPort} {\bf cePort}\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classCopyEngine_1_1CopyEngineChannel_af65ef939be20997afb5d546cbe2fa253}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_a2ee325435cb56082296ff4412aede290}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!channelId@{channelId}}
\index{channelId@{channelId}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{channelId}]{\setlength{\rightskip}{0pt plus 5cm}int {\bf channelId}\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classCopyEngine_1_1CopyEngineChannel_a2ee325435cb56082296ff4412aede290}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_a939f73db208ee37ef7d262c44123d65a}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!completionDataReg@{completionDataReg}}
\index{completionDataReg@{completionDataReg}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{completionDataReg}]{\setlength{\rightskip}{0pt plus 5cm}uint64\_\-t {\bf completionDataReg}\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classCopyEngine_1_1CopyEngineChannel_a939f73db208ee37ef7d262c44123d65a}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_afbda594180f4eaeac0026b69add1ca2f}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!copyBuffer@{copyBuffer}}
\index{copyBuffer@{copyBuffer}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{copyBuffer}]{\setlength{\rightskip}{0pt plus 5cm}uint8\_\-t$\ast$ {\bf copyBuffer}\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classCopyEngine_1_1CopyEngineChannel_afbda594180f4eaeac0026b69add1ca2f}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_af1b40caebc370f0d226cb1a52483ddfc}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!cr@{cr}}
\index{cr@{cr}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{cr}]{\setlength{\rightskip}{0pt plus 5cm}{\bf CopyEngineReg::ChanRegs} {\bf cr}\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classCopyEngine_1_1CopyEngineChannel_af1b40caebc370f0d226cb1a52483ddfc}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_af8c0eaac54803b25f0dfdbb89600093b}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!curDmaDesc@{curDmaDesc}}
\index{curDmaDesc@{curDmaDesc}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{curDmaDesc}]{\setlength{\rightskip}{0pt plus 5cm}{\bf CopyEngineReg::DmaDesc}$\ast$ {\bf curDmaDesc}\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classCopyEngine_1_1CopyEngineChannel_af8c0eaac54803b25f0dfdbb89600093b}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_a329b71fb934a93312ca0aacbf5a3f982}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!drainManager@{drainManager}}
\index{drainManager@{drainManager}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{drainManager}]{\setlength{\rightskip}{0pt plus 5cm}{\bf DrainManager}$\ast$ {\bf drainManager}\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classCopyEngine_1_1CopyEngineChannel_a329b71fb934a93312ca0aacbf5a3f982}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_a5eeb3d755d58eb24d74f92245bf18d2a}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!fetchAddress@{fetchAddress}}
\index{fetchAddress@{fetchAddress}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{fetchAddress}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Addr} {\bf fetchAddress}\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classCopyEngine_1_1CopyEngineChannel_a5eeb3d755d58eb24d74f92245bf18d2a}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_a1534deeb56a4db6a811c7c5b42c192ca}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!fetchCompleteEvent@{fetchCompleteEvent}}
\index{fetchCompleteEvent@{fetchCompleteEvent}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{fetchCompleteEvent}]{\setlength{\rightskip}{0pt plus 5cm}{\bf EventWrapper}$<${\bf CopyEngineChannel}, \&CopyEngineChannel::fetchDescComplete$>$ {\bf fetchCompleteEvent}\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classCopyEngine_1_1CopyEngineChannel_a1534deeb56a4db6a811c7c5b42c192ca}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_adc111744ad979f12ef5d0f7afd26c69d}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!lastDescriptorAddr@{lastDescriptorAddr}}
\index{lastDescriptorAddr@{lastDescriptorAddr}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{lastDescriptorAddr}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Addr} {\bf lastDescriptorAddr}\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classCopyEngine_1_1CopyEngineChannel_adc111744ad979f12ef5d0f7afd26c69d}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_aa97db4f2f9c86194366807cd2bd05ae8}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!latAfterCompletion@{latAfterCompletion}}
\index{latAfterCompletion@{latAfterCompletion}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{latAfterCompletion}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Tick} {\bf latAfterCompletion}\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classCopyEngine_1_1CopyEngineChannel_aa97db4f2f9c86194366807cd2bd05ae8}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_a34a95aa4b855102c3be97544c155e75a}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!latBeforeBegin@{latBeforeBegin}}
\index{latBeforeBegin@{latBeforeBegin}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{latBeforeBegin}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Tick} {\bf latBeforeBegin}\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classCopyEngine_1_1CopyEngineChannel_a34a95aa4b855102c3be97544c155e75a}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_ab24b7ded83b7736b1f4f707b95109e5d}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!nextState@{nextState}}
\index{nextState@{nextState}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{nextState}]{\setlength{\rightskip}{0pt plus 5cm}{\bf ChannelState} {\bf nextState}\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classCopyEngine_1_1CopyEngineChannel_ab24b7ded83b7736b1f4f707b95109e5d}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_aa23ca1b4c066edc88d3770f275f1b250}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!readCompleteEvent@{readCompleteEvent}}
\index{readCompleteEvent@{readCompleteEvent}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{readCompleteEvent}]{\setlength{\rightskip}{0pt plus 5cm}{\bf EventWrapper}$<${\bf CopyEngineChannel}, \&CopyEngineChannel::readCopyBytesComplete$>$ {\bf readCompleteEvent}\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classCopyEngine_1_1CopyEngineChannel_aa23ca1b4c066edc88d3770f275f1b250}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_abfea5a69e8c7ebdb60f68225310d7c6e}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!refreshNext@{refreshNext}}
\index{refreshNext@{refreshNext}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{refreshNext}]{\setlength{\rightskip}{0pt plus 5cm}bool {\bf refreshNext}\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classCopyEngine_1_1CopyEngineChannel_abfea5a69e8c7ebdb60f68225310d7c6e}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_a311433f834e73820b65afccaadc60cf3}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!statusCompleteEvent@{statusCompleteEvent}}
\index{statusCompleteEvent@{statusCompleteEvent}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{statusCompleteEvent}]{\setlength{\rightskip}{0pt plus 5cm}{\bf EventWrapper}$<${\bf CopyEngineChannel}, \&CopyEngineChannel::writeStatusComplete$>$ {\bf statusCompleteEvent}\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classCopyEngine_1_1CopyEngineChannel_a311433f834e73820b65afccaadc60cf3}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_a667d5cc444aa1980eba330fa927415d5}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!underReset@{underReset}}
\index{underReset@{underReset}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{underReset}]{\setlength{\rightskip}{0pt plus 5cm}bool {\bf underReset}\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classCopyEngine_1_1CopyEngineChannel_a667d5cc444aa1980eba330fa927415d5}
\hypertarget{classCopyEngine_1_1CopyEngineChannel_a1008f08d5b6c9e1e72e6736909f23bbb}{
\index{CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}!writeCompleteEvent@{writeCompleteEvent}}
\index{writeCompleteEvent@{writeCompleteEvent}!CopyEngine::CopyEngineChannel@{CopyEngine::CopyEngineChannel}}
\subsubsection[{writeCompleteEvent}]{\setlength{\rightskip}{0pt plus 5cm}{\bf EventWrapper}$<${\bf CopyEngineChannel}, \&CopyEngineChannel::writeCopyBytesComplete$>$ {\bf writeCompleteEvent}\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classCopyEngine_1_1CopyEngineChannel_a1008f08d5b6c9e1e72e6736909f23bbb}


このクラスの説明は次のファイルから生成されました:\begin{DoxyCompactItemize}
\item 
dev/\hyperlink{copy__engine_8hh}{copy\_\-engine.hh}\item 
dev/\hyperlink{copy__engine_8cc}{copy\_\-engine.cc}\end{DoxyCompactItemize}
