<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>File&nbsp;GEM5&nbsp;Wrapper: クラス TrafficGen</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- 作成： Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>メインページ</span></a></li>
      <li><a href="pages.html"><span>関連ページ</span></a></li>
      <li><a href="modules.html"><span>モジュール</span></a></li>
      <li><a href="namespaces.html"><span>ネームスペース</span></a></li>
      <li class="current"><a href="annotated.html"><span>クラス</span></a></li>
      <li><a href="files.html"><span>ファイル</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>構成</span></a></li>
      <li><a href="classes.html"><span>構成索引</span></a></li>
      <li><a href="hierarchy.html"><span>クラス階層</span></a></li>
      <li><a href="functions.html"><span>構成メンバ</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>クラス TrafficGen</h1><!-- doxytag: class="TrafficGen" --><!-- doxytag: inherits="MemObject" -->
<p><code>#include &lt;<a class="el" href="traffic__gen_8hh_source.html">traffic_gen.hh</a>&gt;</code></p>
<div class="dynheader">
TrafficGenに対する継承グラフ</div>
<div class="dynsection">
 <div class="center">
  <img src="classTrafficGen.gif" usemap="#TrafficGen_map" alt=""/>
  <map id="TrafficGen_map" name="TrafficGen_map">
<area href="classMemObject.html" alt="MemObject" shape="rect" coords="105,168,200,192"/>
<area href="classClockedObject.html" alt="ClockedObject" shape="rect" coords="105,112,200,136"/>
<area href="classSimObject.html" alt="SimObject" shape="rect" coords="105,56,200,80"/>
<area href="classEventManager.html" alt="EventManager" shape="rect" coords="0,0,95,24"/>
<area href="classSerializable.html" alt="Serializable" shape="rect" coords="105,0,200,24"/>
<area href="classDrainable.html" alt="Drainable" shape="rect" coords="210,0,305,24"/>
</map>
 </div>
</div>

<p><a href="classTrafficGen-members.html">すべてのメンバ一覧</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>構成</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTrafficGen_1_1TrafficGen.html">TrafficGen</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTrafficGen_1_1TrafficGenPort.html">TrafficGenPort</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structTrafficGen_1_1Transition.html">Transition</a></td></tr>
<tr><td colspan="2"><h2>Public メソッド</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTrafficGen.html#a146890cf5f9e59c2f8c33edfb1502488">TrafficGen</a> (const TrafficGenParams *p)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTrafficGen.html#a5667988c9607ce8d7e3eabd0ebe860f6">~TrafficGen</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="classBaseMasterPort.html">BaseMasterPort</a> &amp;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTrafficGen.html#a54ebb5edc195c159b56a39e6f15b9932">getMasterPort</a> (const std::string &amp;if_name, <a class="el" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a> idx=<a class="el" href="base_2types_8hh.html#a65bf40f138cf863f0c5e2d8ca1144126">InvalidPortID</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTrafficGen.html#a02fd73d861ef2e4aabb38c0c9ff82947">init</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTrafficGen.html#a3c34ea9b29f410748d4435a667484924">initState</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTrafficGen.html#aa8a18d230dba7a674ac8a0b4f35bc36a">drain</a> (<a class="el" href="classDrainManager.html">DrainManager</a> *dm)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTrafficGen.html#a53e036786d17361be4c7320d39c99b84">serialize</a> (std::ostream &amp;os)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTrafficGen.html#af22e5d6d660b97db37003ac61ac4ee49">unserialize</a> (<a class="el" href="classCheckpoint.html">Checkpoint</a> *cp, const std::string &amp;section)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTrafficGen.html#a4dc637449366fcdfc4e764cdf12d9b11">regStats</a> ()</td></tr>
<tr><td colspan="2"><h2>Private メソッド</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTrafficGen.html#aab0a81b788e7282586c12953fa5e0c37">transition</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTrafficGen.html#a1346cf8b75d4ba67a861233a8651601d">enterState</a> (<a class="el" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> newState)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTrafficGen.html#a7719d247662a43429aac025090db5704">parseConfig</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTrafficGen.html#ac5c54df7ed3b930268c8d7752c101725">update</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTrafficGen.html#a29cb5a4f98063ce6e9210eacbdb35298">recvRetry</a> ()</td></tr>
<tr><td colspan="2"><h2>Private 変数</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classSystem.html">System</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTrafficGen.html#af27ccd765f13a4b7bd119dc7579e2746">system</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="request_8hh.html#ac366b729262fd8e7cbd3283da6f775cf">MasterID</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTrafficGen.html#aa8528db52f6eb976baecb2291d1b408a">masterID</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const std::string&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTrafficGen.html#ad5835f1d2646493dafb2c5ac6244a93f">configFile</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTrafficGen.html#a42af28607a09ff1b95b5e848bf73f915">elasticReq</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTrafficGen.html#aaa2a440da39850c0d2d678fd2ee844af">nextTransitionTick</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTrafficGen.html#a52d98e2f5ed0bf508db823995ad4940f">nextPacketTick</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classstd_1_1vector.html">std::vector</a>&lt; <a class="el" href="classstd_1_1vector.html">std::vector</a><br class="typebreak"/>
&lt; double &gt; &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTrafficGen.html#a14f30e68ecada24867b46bcc8093f4f5">transitionMatrix</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTrafficGen.html#a8428fe009627d1dd49ef98a54587830e">currState</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">m5::hash_map&lt; <a class="el" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>, <a class="el" href="classBaseGen.html">BaseGen</a> * &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTrafficGen.html#a033c23b252da5264e1f864277711e5e1">states</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classTrafficGen_1_1TrafficGenPort.html">TrafficGenPort</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTrafficGen.html#a51d5c08451d2b2b8b99fe3fda83f05d8">port</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classPacket.html">PacketPtr</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTrafficGen.html#a314ae93c04b3ca96e79e1b1f39a8e478">retryPkt</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTrafficGen.html#a770dcab4388a8d55911cb6f29d9bb692">retryPktTick</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classEventWrapper.html">EventWrapper</a>&lt; <a class="el" href="classTrafficGen_1_1TrafficGen.html">TrafficGen</a>,&amp;TrafficGen::update &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTrafficGen.html#ab779474477fa217dd5483711dec2bf13">updateEvent</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classDrainManager.html">DrainManager</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTrafficGen.html#a329b71fb934a93312ca0aacbf5a3f982">drainManager</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classStats_1_1Scalar.html">Stats::Scalar</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTrafficGen.html#a5ffd7b0e5641784cc4c40547e51c6cbc">numPackets</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classStats_1_1Scalar.html">Stats::Scalar</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTrafficGen.html#a166f92adc8967f926459ca64c92d6a66">numRetries</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classStats_1_1Scalar.html">Stats::Scalar</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTrafficGen.html#a2d1dee1e20aeb0205ae665d7ad08b822">retryTicks</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>説明</h2>
<p>The traffic generator is a master module that generates stimuli for the memory system, based on a collection of simple generator behaviours that are either probabilistic or based on traces. It can be used stand alone for creating test cases for interconnect and memory controllers, or function as a black box replacement for system components that are not yet modelled in detail, e.g. a video engine or baseband subsystem. </p>
<hr/><h2>コンストラクタとデストラクタ</h2>
<a class="anchor" id="a146890cf5f9e59c2f8c33edfb1502488"></a><!-- doxytag: member="TrafficGen::TrafficGen" ref="a146890cf5f9e59c2f8c33edfb1502488" args="(const TrafficGenParams *p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classTrafficGen_1_1TrafficGen.html">TrafficGen</a> </td>
          <td>(</td>
          <td class="paramtype">const TrafficGenParams *&nbsp;</td>
          <td class="paramname"> <em>p</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00055"></a>00055     : <a class="code" href="classMemObject.html#a0390aa3eb5acd29074fac67b8d6472bd">MemObject</a>(<a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a>),
<a name="l00056"></a>00056       <a class="code" href="classTrafficGen.html#af27ccd765f13a4b7bd119dc7579e2746">system</a>(<a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a>-&gt;system),
<a name="l00057"></a>00057       <a class="code" href="classTrafficGen.html#aa8528db52f6eb976baecb2291d1b408a">masterID</a>(<a class="code" href="classTrafficGen.html#af27ccd765f13a4b7bd119dc7579e2746">system</a>-&gt;<a class="code" href="classSystem.html#a906e073613d8d8e76e11c1bf9310a25c">getMasterId</a>(<a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>())),
<a name="l00058"></a>00058       <a class="code" href="classTrafficGen.html#ad5835f1d2646493dafb2c5ac6244a93f">configFile</a>(<a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a>-&gt;config_file),
<a name="l00059"></a>00059       <a class="code" href="classTrafficGen.html#a42af28607a09ff1b95b5e848bf73f915">elasticReq</a>(<a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a>-&gt;elastic_req),
<a name="l00060"></a>00060       <a class="code" href="classTrafficGen.html#aaa2a440da39850c0d2d678fd2ee844af">nextTransitionTick</a>(0),
<a name="l00061"></a>00061       <a class="code" href="classTrafficGen.html#a52d98e2f5ed0bf508db823995ad4940f">nextPacketTick</a>(0),
<a name="l00062"></a>00062       <a class="code" href="classTrafficGen.html#a51d5c08451d2b2b8b99fe3fda83f05d8">port</a>(<a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>() + <span class="stringliteral">&quot;.port&quot;</span>, *<span class="keyword">this</span>),
<a name="l00063"></a>00063       <a class="code" href="classTrafficGen.html#a314ae93c04b3ca96e79e1b1f39a8e478">retryPkt</a>(<a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>),
<a name="l00064"></a>00064       <a class="code" href="classTrafficGen.html#a770dcab4388a8d55911cb6f29d9bb692">retryPktTick</a>(0),
<a name="l00065"></a>00065       <a class="code" href="classTrafficGen.html#ab779474477fa217dd5483711dec2bf13">updateEvent</a>(<span class="keyword">this</span>),
<a name="l00066"></a>00066       <a class="code" href="classTrafficGen.html#a329b71fb934a93312ca0aacbf5a3f982">drainManager</a>(<a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>)
<a name="l00067"></a>00067 {
<a name="l00068"></a>00068 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5667988c9607ce8d7e3eabd0ebe860f6"></a><!-- doxytag: member="TrafficGen::~TrafficGen" ref="a5667988c9607ce8d7e3eabd0ebe860f6" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">~<a class="el" href="classTrafficGen_1_1TrafficGen.html">TrafficGen</a> </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00189"></a>00189 {}
</pre></div></p>

</div>
</div>
<hr/><h2>関数</h2>
<a class="anchor" id="aa8a18d230dba7a674ac8a0b4f35bc36a"></a><!-- doxytag: member="TrafficGen::drain" ref="aa8a18d230dba7a674ac8a0b4f35bc36a" args="(DrainManager *dm)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int drain </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classDrainManager.html">DrainManager</a> *&nbsp;</td>
          <td class="paramname"> <em>drainManger</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Provide a default implementation of the drain interface that simply returns 0 (draining completed) and sets the drain state to Drained. </p>

<p><a class="el" href="classSimObject.html#a6bf479c521c7c3eb473822d953275b26">SimObject</a>を再定義しています。</p>

<p><div class="fragment"><pre class="fragment"><a name="l00122"></a>00122 {
<a name="l00123"></a>00123     <span class="keywordflow">if</span> (!<a class="code" href="classTrafficGen.html#ab779474477fa217dd5483711dec2bf13">updateEvent</a>.<a class="code" href="classEvent.html#a9cd69a6b10cb037550943f177a0da688" title="Determine if the current event is scheduled.">scheduled</a>()) {
<a name="l00124"></a>00124         <span class="comment">// no event has been scheduled yet (e.g. switched from atomic mode)</span>
<a name="l00125"></a>00125         <span class="keywordflow">return</span> 0;
<a name="l00126"></a>00126     }
<a name="l00127"></a>00127 
<a name="l00128"></a>00128     <span class="keywordflow">if</span> (<a class="code" href="classTrafficGen.html#a314ae93c04b3ca96e79e1b1f39a8e478">retryPkt</a> == <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>) {
<a name="l00129"></a>00129         <span class="comment">// shut things down</span>
<a name="l00130"></a>00130         <a class="code" href="classTrafficGen.html#a52d98e2f5ed0bf508db823995ad4940f">nextPacketTick</a> = <a class="code" href="base_2types_8hh.html#abe940b1b328825e234da719447e15ca5">MaxTick</a>;
<a name="l00131"></a>00131         <a class="code" href="classTrafficGen.html#aaa2a440da39850c0d2d678fd2ee844af">nextTransitionTick</a> = <a class="code" href="base_2types_8hh.html#abe940b1b328825e234da719447e15ca5">MaxTick</a>;
<a name="l00132"></a>00132         <a class="code" href="classEventManager.html#a720e34da4db679fb3f30b20e55c23605">deschedule</a>(<a class="code" href="classTrafficGen.html#ab779474477fa217dd5483711dec2bf13">updateEvent</a>);
<a name="l00133"></a>00133         <span class="keywordflow">return</span> 0;
<a name="l00134"></a>00134     } <span class="keywordflow">else</span> {
<a name="l00135"></a>00135         <a class="code" href="classTrafficGen.html#a329b71fb934a93312ca0aacbf5a3f982">drainManager</a> = <a class="code" href="namespaceMipsISA.html#a2575c29e7f4617b6076486f340b6fe19">dm</a>;
<a name="l00136"></a>00136         <span class="keywordflow">return</span> 1;
<a name="l00137"></a>00137     }
<a name="l00138"></a>00138 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1346cf8b75d4ba67a861233a8651601d"></a><!-- doxytag: member="TrafficGen::enterState" ref="a1346cf8b75d4ba67a861233a8651601d" args="(uint32_t newState)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void enterState </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&nbsp;</td>
          <td class="paramname"> <em>newState</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Enter a new state.</p>
<dl><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>newState</em>&nbsp;</td><td>identifier of state to enter </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l00432"></a>00432 {
<a name="l00433"></a>00433     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classTrafficGen.html">TrafficGen</a>, <span class="stringliteral">&quot;Transition to state %d\n&quot;</span>, newState);
<a name="l00434"></a>00434 
<a name="l00435"></a>00435     <a class="code" href="classTrafficGen.html#a8428fe009627d1dd49ef98a54587830e">currState</a> = newState;
<a name="l00436"></a>00436     <span class="comment">// we could have been delayed and not transitioned on the exact</span>
<a name="l00437"></a>00437     <span class="comment">// tick when we were supposed to (due to back pressure when</span>
<a name="l00438"></a>00438     <span class="comment">// sending a packet)</span>
<a name="l00439"></a>00439     <a class="code" href="classTrafficGen.html#aaa2a440da39850c0d2d678fd2ee844af">nextTransitionTick</a> = <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The universal simulation clock.">curTick</a>() + <a class="code" href="classTrafficGen.html#a033c23b252da5264e1f864277711e5e1">states</a>[<a class="code" href="classTrafficGen.html#a8428fe009627d1dd49ef98a54587830e">currState</a>]-&gt;duration;
<a name="l00440"></a>00440     <a class="code" href="classTrafficGen.html#a033c23b252da5264e1f864277711e5e1">states</a>[<a class="code" href="classTrafficGen.html#a8428fe009627d1dd49ef98a54587830e">currState</a>]-&gt;enter();
<a name="l00441"></a>00441 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a54ebb5edc195c159b56a39e6f15b9932"></a><!-- doxytag: member="TrafficGen::getMasterPort" ref="a54ebb5edc195c159b56a39e6f15b9932" args="(const std::string &amp;if_name, PortID idx=InvalidPortID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual <a class="el" href="classBaseMasterPort.html">BaseMasterPort</a>&amp; getMasterPort </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&nbsp;</td>
          <td class="paramname"> <em>if_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a>&nbsp;</td>
          <td class="paramname"> <em>idx</em> = <code><a class="el" href="base_2types_8hh.html#a65bf40f138cf863f0c5e2d8ca1144126">InvalidPortID</a></code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Get a master port with a given name and index. This is used at binding time and returns a reference to a protocol-agnostic base master port.</p>
<dl><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>if_name</em>&nbsp;</td><td><a class="el" href="classPort.html">Port</a> name </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>idx</em>&nbsp;</td><td>Index in the case of a VectorPort</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>戻り値:</b></dt><dd>A reference to the given port </dd></dl>

<p><a class="el" href="classMemObject.html#adc4e675e51defbdd1e354dac729d0703">MemObject</a>を再定義しています。</p>

</div>
</div>
<a class="anchor" id="a02fd73d861ef2e4aabb38c0c9ff82947"></a><!-- doxytag: member="TrafficGen::init" ref="a02fd73d861ef2e4aabb38c0c9ff82947" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void init </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p><a class="el" href="classTrafficGen.html#a02fd73d861ef2e4aabb38c0c9ff82947">init()</a> is called after all C++ SimObjects have been created and all ports are connected. Initializations that are independent of unserialization but rely on a fully instantiated and connected <a class="el" href="classSimObject.html">SimObject</a> graph should be done here. </p>

<p><a class="el" href="classSimObject.html#a02fd73d861ef2e4aabb38c0c9ff82947">SimObject</a>を再定義しています。</p>

<p><div class="fragment"><pre class="fragment"><a name="l00088"></a>00088 {
<a name="l00089"></a>00089     <span class="keywordflow">if</span> (!<a class="code" href="classTrafficGen.html#a51d5c08451d2b2b8b99fe3fda83f05d8">port</a>.<a class="code" href="classBaseMasterPort.html#a180fa55a4bf36580963bed9e3e09c227">isConnected</a>())
<a name="l00090"></a>00090         <a class="code" href="base_2misc_8hh.html#acad519418dbfdd70c1208711e609c80e">fatal</a>(<span class="stringliteral">&quot;The port of %s is not connected!\n&quot;</span>, <a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>());
<a name="l00091"></a>00091 
<a name="l00092"></a>00092     <span class="comment">// if the system is in timing mode active the request generator</span>
<a name="l00093"></a>00093     <span class="keywordflow">if</span> (<a class="code" href="classTrafficGen.html#af27ccd765f13a4b7bd119dc7579e2746">system</a>-&gt;<a class="code" href="classSystem.html#ae04bdd25f4dde1cc1b58b22505aa869c">isTimingMode</a>()) {
<a name="l00094"></a>00094         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classTrafficGen.html">TrafficGen</a>, <span class="stringliteral">&quot;Timing mode, activating request generator\n&quot;</span>);
<a name="l00095"></a>00095 
<a name="l00096"></a>00096         <a class="code" href="classTrafficGen.html#a7719d247662a43429aac025090db5704">parseConfig</a>();
<a name="l00097"></a>00097 
<a name="l00098"></a>00098         <span class="comment">// enter initial state</span>
<a name="l00099"></a>00099         <a class="code" href="classTrafficGen.html#a1346cf8b75d4ba67a861233a8651601d">enterState</a>(<a class="code" href="classTrafficGen.html#a8428fe009627d1dd49ef98a54587830e">currState</a>);
<a name="l00100"></a>00100     } <span class="keywordflow">else</span> {
<a name="l00101"></a>00101         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classTrafficGen.html">TrafficGen</a>,
<a name="l00102"></a>00102                 <span class="stringliteral">&quot;Traffic generator is only active in timing mode\n&quot;</span>);
<a name="l00103"></a>00103     }
<a name="l00104"></a>00104 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3c34ea9b29f410748d4435a667484924"></a><!-- doxytag: member="TrafficGen::initState" ref="a3c34ea9b29f410748d4435a667484924" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void initState </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p><a class="el" href="classTrafficGen.html#a3c34ea9b29f410748d4435a667484924">initState()</a> is called on each <a class="el" href="classSimObject.html">SimObject</a> when *not* restoring from a checkpoint. This provides a hook for state initializations that are only required for a "cold start". </p>

<p><a class="el" href="classSimObject.html#a3c34ea9b29f410748d4435a667484924">SimObject</a>を再定義しています。</p>

<p><div class="fragment"><pre class="fragment"><a name="l00108"></a>00108 {
<a name="l00109"></a>00109     <span class="comment">// when not restoring from a checkpoint, make sure we kick things off</span>
<a name="l00110"></a>00110     <span class="keywordflow">if</span> (<a class="code" href="classTrafficGen.html#af27ccd765f13a4b7bd119dc7579e2746">system</a>-&gt;<a class="code" href="classSystem.html#ae04bdd25f4dde1cc1b58b22505aa869c">isTimingMode</a>()) {
<a name="l00111"></a>00111         <span class="comment">// call nextPacketTick on the state to advance it</span>
<a name="l00112"></a>00112         <a class="code" href="classTrafficGen.html#a52d98e2f5ed0bf508db823995ad4940f">nextPacketTick</a> = <a class="code" href="classTrafficGen.html#a033c23b252da5264e1f864277711e5e1">states</a>[<a class="code" href="classTrafficGen.html#a8428fe009627d1dd49ef98a54587830e">currState</a>]-&gt;nextPacketTick(<a class="code" href="classTrafficGen.html#a42af28607a09ff1b95b5e848bf73f915">elasticReq</a>, 0);
<a name="l00113"></a>00113         <a class="code" href="classEventManager.html#a4ddebbfe9a12b95be6fb993ce892dcd3">schedule</a>(<a class="code" href="classTrafficGen.html#ab779474477fa217dd5483711dec2bf13">updateEvent</a>, std::min(<a class="code" href="classTrafficGen.html#a52d98e2f5ed0bf508db823995ad4940f">nextPacketTick</a>, <a class="code" href="classTrafficGen.html#aaa2a440da39850c0d2d678fd2ee844af">nextTransitionTick</a>));
<a name="l00114"></a>00114     } <span class="keywordflow">else</span> {
<a name="l00115"></a>00115         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classTrafficGen.html">TrafficGen</a>,
<a name="l00116"></a>00116                 <span class="stringliteral">&quot;Traffic generator is only active in timing mode\n&quot;</span>);
<a name="l00117"></a>00117     }
<a name="l00118"></a>00118 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7719d247662a43429aac025090db5704"></a><!-- doxytag: member="TrafficGen::parseConfig" ref="a7719d247662a43429aac025090db5704" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void parseConfig </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Parse the config file and build the state map and transition matrix. </p>

<p><div class="fragment"><pre class="fragment"><a name="l00212"></a>00212 {
<a name="l00213"></a>00213     <span class="comment">// keep track of the transitions parsed to create the matrix when</span>
<a name="l00214"></a>00214     <span class="comment">// done</span>
<a name="l00215"></a>00215     <a class="code" href="classstd_1_1vector.html">vector&lt;Transition&gt;</a> transitions;
<a name="l00216"></a>00216 
<a name="l00217"></a>00217     <span class="comment">// open input file</span>
<a name="l00218"></a>00218     ifstream infile;
<a name="l00219"></a>00219     infile.open(<a class="code" href="classTrafficGen.html#ad5835f1d2646493dafb2c5ac6244a93f">configFile</a>.c_str(), ifstream::in);
<a name="l00220"></a>00220     <span class="keywordflow">if</span> (!infile.is_open()) {
<a name="l00221"></a>00221         <a class="code" href="base_2misc_8hh.html#acad519418dbfdd70c1208711e609c80e">fatal</a>(<span class="stringliteral">&quot;Traffic generator %s config file not found at %s\n&quot;</span>,
<a name="l00222"></a>00222               <a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>(), <a class="code" href="classTrafficGen.html#ad5835f1d2646493dafb2c5ac6244a93f">configFile</a>);
<a name="l00223"></a>00223     }
<a name="l00224"></a>00224 
<a name="l00225"></a>00225     <span class="keywordtype">bool</span> init_state_set = <span class="keyword">false</span>;
<a name="l00226"></a>00226 
<a name="l00227"></a>00227     <span class="comment">// read line by line and determine the action based on the first</span>
<a name="l00228"></a>00228     <span class="comment">// keyword</span>
<a name="l00229"></a>00229     <span class="keywordtype">string</span> keyword;
<a name="l00230"></a>00230     <span class="keywordtype">string</span> line;
<a name="l00231"></a>00231 
<a name="l00232"></a>00232     <span class="keywordflow">while</span> (getline(infile, line).good()) {
<a name="l00233"></a>00233         <span class="comment">// see if this line is a comment line, and if so skip it</span>
<a name="l00234"></a>00234         <span class="keywordflow">if</span> (line.find(<span class="charliteral">&apos;#&apos;</span>) != 1) {
<a name="l00235"></a>00235             <span class="comment">// create an input stream for the tokenization</span>
<a name="l00236"></a>00236             istringstream <a class="code" href="namespaceMipsISA.html#a366f619fc9b4d8c3e351029137f7ad30">is</a>(line);
<a name="l00237"></a>00237 
<a name="l00238"></a>00238             <span class="comment">// determine the keyword</span>
<a name="l00239"></a>00239             <a class="code" href="namespaceMipsISA.html#a366f619fc9b4d8c3e351029137f7ad30">is</a> &gt;&gt; keyword;
<a name="l00240"></a>00240 
<a name="l00241"></a>00241             <span class="keywordflow">if</span> (keyword == <span class="stringliteral">&quot;STATE&quot;</span>) {
<a name="l00242"></a>00242                 <span class="comment">// parse the behaviour of this state</span>
<a name="l00243"></a>00243                 <a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> <a class="code" href="namespaceSparcISA.html#a2b4cf644f5af9ebaec502fb09986f302">id</a>;
<a name="l00244"></a>00244                 <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> duration;
<a name="l00245"></a>00245                 <span class="keywordtype">string</span> <a class="code" href="namespaceArmISA.html#a5f3b9b97eb2dfa29d33e74878455f90d">mode</a>;
<a name="l00246"></a>00246 
<a name="l00247"></a>00247                 <a class="code" href="namespaceMipsISA.html#a366f619fc9b4d8c3e351029137f7ad30">is</a> &gt;&gt; <span class="keywordtype">id</span> &gt;&gt; duration &gt;&gt; mode;
<a name="l00248"></a>00248 
<a name="l00249"></a>00249                 <span class="keywordflow">if</span> (mode == <span class="stringliteral">&quot;TRACE&quot;</span>) {
<a name="l00250"></a>00250                     <span class="keywordtype">string</span> traceFile;
<a name="l00251"></a>00251                     <a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a> addrOffset;
<a name="l00252"></a>00252 
<a name="l00253"></a>00253                     <a class="code" href="namespaceMipsISA.html#a366f619fc9b4d8c3e351029137f7ad30">is</a> &gt;&gt; traceFile &gt;&gt; addrOffset;
<a name="l00254"></a>00254 
<a name="l00255"></a>00255                     <a class="code" href="classTrafficGen.html#a033c23b252da5264e1f864277711e5e1">states</a>[id] = <span class="keyword">new</span> <a class="code" href="classTraceGen.html">TraceGen</a>(<a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>(), <a class="code" href="classTrafficGen.html#aa8528db52f6eb976baecb2291d1b408a">masterID</a>, duration,
<a name="l00256"></a>00256                                               traceFile, addrOffset);
<a name="l00257"></a>00257                     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classTrafficGen.html">TrafficGen</a>, <span class="stringliteral">&quot;State: %d TraceGen\n&quot;</span>, <span class="keywordtype">id</span>);
<a name="l00258"></a>00258                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mode == <span class="stringliteral">&quot;IDLE&quot;</span>) {
<a name="l00259"></a>00259                     <a class="code" href="classTrafficGen.html#a033c23b252da5264e1f864277711e5e1">states</a>[id] = <span class="keyword">new</span> <a class="code" href="classIdleGen.html">IdleGen</a>(<a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>(), <a class="code" href="classTrafficGen.html#aa8528db52f6eb976baecb2291d1b408a">masterID</a>, duration);
<a name="l00260"></a>00260                     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classTrafficGen.html">TrafficGen</a>, <span class="stringliteral">&quot;State: %d IdleGen\n&quot;</span>, <span class="keywordtype">id</span>);
<a name="l00261"></a>00261                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mode == <span class="stringliteral">&quot;LINEAR&quot;</span> || mode == <span class="stringliteral">&quot;RANDOM&quot;</span> ||
<a name="l00262"></a>00262                            mode == <span class="stringliteral">&quot;DRAM&quot;</span>) {
<a name="l00263"></a>00263                     <a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> read_percent;
<a name="l00264"></a>00264                     <a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a> start_addr;
<a name="l00265"></a>00265                     <a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a> end_addr;
<a name="l00266"></a>00266                     <a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a> blocksize;
<a name="l00267"></a>00267                     <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> min_period;
<a name="l00268"></a>00268                     <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> max_period;
<a name="l00269"></a>00269                     <a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a> data_limit;
<a name="l00270"></a>00270 
<a name="l00271"></a>00271                     <a class="code" href="namespaceMipsISA.html#a366f619fc9b4d8c3e351029137f7ad30">is</a> &gt;&gt; read_percent &gt;&gt; start_addr &gt;&gt; end_addr &gt;&gt;
<a name="l00272"></a>00272                         blocksize &gt;&gt; min_period &gt;&gt; max_period &gt;&gt; data_limit;
<a name="l00273"></a>00273 
<a name="l00274"></a>00274                     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classTrafficGen.html">TrafficGen</a>, <span class="stringliteral">&quot;%s, addr %x to %x, size %d,&quot;</span>
<a name="l00275"></a>00275                             <span class="stringliteral">&quot; period %d to %d, %d%% reads\n&quot;</span>,
<a name="l00276"></a>00276                             mode, start_addr, end_addr, blocksize, min_period,
<a name="l00277"></a>00277                             max_period, read_percent);
<a name="l00278"></a>00278 
<a name="l00279"></a>00279 
<a name="l00280"></a>00280                     <span class="keywordflow">if</span> (blocksize &gt; <a class="code" href="classTrafficGen.html#af27ccd765f13a4b7bd119dc7579e2746">system</a>-&gt;<a class="code" href="classSystem.html#ac1f842b56d922c001dda5262b4cccbc6">cacheLineSize</a>())
<a name="l00281"></a>00281                         <a class="code" href="base_2misc_8hh.html#acad519418dbfdd70c1208711e609c80e">fatal</a>(<span class="stringliteral">&quot;TrafficGen %s block size (%d) is larger than &quot;</span>
<a name="l00282"></a>00282                               <span class="stringliteral">&quot;cache line size (%d)\n&quot;</span>, <a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>(),
<a name="l00283"></a>00283                               blocksize, <a class="code" href="classTrafficGen.html#af27ccd765f13a4b7bd119dc7579e2746">system</a>-&gt;<a class="code" href="classSystem.html#ac1f842b56d922c001dda5262b4cccbc6">cacheLineSize</a>());
<a name="l00284"></a>00284 
<a name="l00285"></a>00285                     <span class="keywordflow">if</span> (read_percent &gt; 100)
<a name="l00286"></a>00286                         <a class="code" href="base_2misc_8hh.html#acad519418dbfdd70c1208711e609c80e">fatal</a>(<span class="stringliteral">&quot;%s cannot have more than 100% reads&quot;</span>, <a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>());
<a name="l00287"></a>00287 
<a name="l00288"></a>00288                     <span class="keywordflow">if</span> (min_period &gt; max_period)
<a name="l00289"></a>00289                         <a class="code" href="base_2misc_8hh.html#acad519418dbfdd70c1208711e609c80e">fatal</a>(<span class="stringliteral">&quot;%s cannot have min_period &gt; max_period&quot;</span>, <a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>());
<a name="l00290"></a>00290 
<a name="l00291"></a>00291                     <span class="keywordflow">if</span> (mode == <span class="stringliteral">&quot;LINEAR&quot;</span>) {
<a name="l00292"></a>00292                         <a class="code" href="classTrafficGen.html#a033c23b252da5264e1f864277711e5e1">states</a>[id] = <span class="keyword">new</span> <a class="code" href="classLinearGen.html">LinearGen</a>(<a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>(), <a class="code" href="classTrafficGen.html#aa8528db52f6eb976baecb2291d1b408a">masterID</a>,
<a name="l00293"></a>00293                                                    duration, start_addr,
<a name="l00294"></a>00294                                                    end_addr, blocksize,
<a name="l00295"></a>00295                                                    min_period, max_period,
<a name="l00296"></a>00296                                                    read_percent, data_limit);
<a name="l00297"></a>00297                         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classTrafficGen.html">TrafficGen</a>, <span class="stringliteral">&quot;State: %d LinearGen\n&quot;</span>, <span class="keywordtype">id</span>);
<a name="l00298"></a>00298                     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mode == <span class="stringliteral">&quot;RANDOM&quot;</span>) {
<a name="l00299"></a>00299                         <a class="code" href="classTrafficGen.html#a033c23b252da5264e1f864277711e5e1">states</a>[id] = <span class="keyword">new</span> <a class="code" href="classRandomGen.html">RandomGen</a>(<a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>(), <a class="code" href="classTrafficGen.html#aa8528db52f6eb976baecb2291d1b408a">masterID</a>,
<a name="l00300"></a>00300                                                    duration, start_addr,
<a name="l00301"></a>00301                                                    end_addr, blocksize,
<a name="l00302"></a>00302                                                    min_period, max_period,
<a name="l00303"></a>00303                                                    read_percent, data_limit);
<a name="l00304"></a>00304                         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classTrafficGen.html">TrafficGen</a>, <span class="stringliteral">&quot;State: %d RandomGen\n&quot;</span>, <span class="keywordtype">id</span>);
<a name="l00305"></a>00305                     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mode == <span class="stringliteral">&quot;DRAM&quot;</span>) {
<a name="l00306"></a>00306                         <span class="comment">// stride size (bytes) of the request for achieving</span>
<a name="l00307"></a>00307                         <span class="comment">// required hit length</span>
<a name="l00308"></a>00308                         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> stride_size;
<a name="l00309"></a>00309                         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> page_size;
<a name="l00310"></a>00310                         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nbr_of_banks_DRAM;
<a name="l00311"></a>00311                         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nbr_of_banks_util;
<a name="l00312"></a>00312                         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> addr_mapping;
<a name="l00313"></a>00313 
<a name="l00314"></a>00314                         <a class="code" href="namespaceMipsISA.html#a366f619fc9b4d8c3e351029137f7ad30">is</a> &gt;&gt; stride_size &gt;&gt; page_size &gt;&gt; nbr_of_banks_DRAM &gt;&gt;
<a name="l00315"></a>00315                             nbr_of_banks_util &gt;&gt; addr_mapping;
<a name="l00316"></a>00316 
<a name="l00317"></a>00317                         <span class="keywordflow">if</span> (stride_size &gt; page_size)
<a name="l00318"></a>00318                             <a class="code" href="base_2misc_8hh.html#a8224a361dddd2ad59b411982e5ea746f">warn</a>(<span class="stringliteral">&quot;DRAM generator stride size (%d) is greater &quot;</span>
<a name="l00319"></a>00319                                  <span class="stringliteral">&quot;than page size (%d)  of the memory\n&quot;</span>,
<a name="l00320"></a>00320                                  blocksize, page_size);
<a name="l00321"></a>00321 
<a name="l00322"></a>00322                         <span class="keywordflow">if</span> (nbr_of_banks_util &gt; nbr_of_banks_DRAM)
<a name="l00323"></a>00323                             <a class="code" href="base_2misc_8hh.html#acad519418dbfdd70c1208711e609c80e">fatal</a>(<span class="stringliteral">&quot;Attempting to use more banks (%) than &quot;</span>
<a name="l00324"></a>00324                                   <span class="stringliteral">&quot;what is available (%)\n&quot;</span>,
<a name="l00325"></a>00325                                   nbr_of_banks_util, nbr_of_banks_DRAM);
<a name="l00326"></a>00326 
<a name="l00327"></a>00327                         <span class="keywordflow">if</span> (nbr_of_banks_util &gt; nbr_of_banks_DRAM)
<a name="l00328"></a>00328                             <a class="code" href="base_2misc_8hh.html#acad519418dbfdd70c1208711e609c80e">fatal</a>(<span class="stringliteral">&quot;Attempting to use more banks (%) than &quot;</span>
<a name="l00329"></a>00329                                   <span class="stringliteral">&quot;what is available (%)\n&quot;</span>,
<a name="l00330"></a>00330                                   nbr_of_banks_util, nbr_of_banks_DRAM);
<a name="l00331"></a>00331 
<a name="l00332"></a>00332                         <span class="comment">// count the number of sequential packets to</span>
<a name="l00333"></a>00333                         <span class="comment">// generate</span>
<a name="l00334"></a>00334                         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> num_seq_pkts = 1;
<a name="l00335"></a>00335 
<a name="l00336"></a>00336                         <span class="keywordflow">if</span> (stride_size &gt; blocksize) {
<a name="l00337"></a>00337                             num_seq_pkts = <a class="code" href="intmath_8hh.html#ae842b412d3570df97a944085b8f85850">divCeil</a>(stride_size, blocksize);
<a name="l00338"></a>00338                             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classTrafficGen.html">TrafficGen</a>, <span class="stringliteral">&quot;stride size: %d &quot;</span>
<a name="l00339"></a>00339                                     <span class="stringliteral">&quot;block size: %d, num_seq_pkts: %d\n&quot;</span>,
<a name="l00340"></a>00340                                     stride_size, blocksize, num_seq_pkts);
<a name="l00341"></a>00341                         }
<a name="l00342"></a>00342 
<a name="l00343"></a>00343                         <a class="code" href="classTrafficGen.html#a033c23b252da5264e1f864277711e5e1">states</a>[id] = <span class="keyword">new</span> <a class="code" href="classDramGen.html">DramGen</a>(<a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>(), <a class="code" href="classTrafficGen.html#aa8528db52f6eb976baecb2291d1b408a">masterID</a>,
<a name="l00344"></a>00344                                                  duration, start_addr,
<a name="l00345"></a>00345                                                  end_addr, blocksize,
<a name="l00346"></a>00346                                                  min_period, max_period,
<a name="l00347"></a>00347                                                  read_percent, data_limit,
<a name="l00348"></a>00348                                                  num_seq_pkts, page_size,
<a name="l00349"></a>00349                                                  nbr_of_banks_DRAM,
<a name="l00350"></a>00350                                                  nbr_of_banks_util,
<a name="l00351"></a>00351                                                  addr_mapping);
<a name="l00352"></a>00352                         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classTrafficGen.html">TrafficGen</a>, <span class="stringliteral">&quot;State: %d DramGen\n&quot;</span>, <span class="keywordtype">id</span>);
<a name="l00353"></a>00353                     }
<a name="l00354"></a>00354                 } <span class="keywordflow">else</span> {
<a name="l00355"></a>00355                     <a class="code" href="base_2misc_8hh.html#acad519418dbfdd70c1208711e609c80e">fatal</a>(<span class="stringliteral">&quot;%s: Unknown traffic generator mode: %s&quot;</span>,
<a name="l00356"></a>00356                           <a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>(), mode);
<a name="l00357"></a>00357                 }
<a name="l00358"></a>00358             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (keyword == <span class="stringliteral">&quot;TRANSITION&quot;</span>) {
<a name="l00359"></a>00359                 Transition <a class="code" href="classTrafficGen.html#aab0a81b788e7282586c12953fa5e0c37">transition</a>;
<a name="l00360"></a>00360 
<a name="l00361"></a>00361                 <a class="code" href="namespaceMipsISA.html#a366f619fc9b4d8c3e351029137f7ad30">is</a> &gt;&gt; transition.from &gt;&gt; transition.to &gt;&gt; transition.p;
<a name="l00362"></a>00362 
<a name="l00363"></a>00363                 transitions.push_back(transition);
<a name="l00364"></a>00364 
<a name="l00365"></a>00365                 <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classTrafficGen.html">TrafficGen</a>, <span class="stringliteral">&quot;Transition: %d -&gt; %d\n&quot;</span>, transition.from,
<a name="l00366"></a>00366                         transition.to);
<a name="l00367"></a>00367             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (keyword == <span class="stringliteral">&quot;INIT&quot;</span>) {
<a name="l00368"></a>00368                 <span class="comment">// set the initial state as the active state</span>
<a name="l00369"></a>00369                 <a class="code" href="namespaceMipsISA.html#a366f619fc9b4d8c3e351029137f7ad30">is</a> &gt;&gt; <a class="code" href="classTrafficGen.html#a8428fe009627d1dd49ef98a54587830e">currState</a>;
<a name="l00370"></a>00370 
<a name="l00371"></a>00371                 init_state_set = <span class="keyword">true</span>;
<a name="l00372"></a>00372 
<a name="l00373"></a>00373                 <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classTrafficGen.html">TrafficGen</a>, <span class="stringliteral">&quot;Initial state: %d\n&quot;</span>, currState);
<a name="l00374"></a>00374             }
<a name="l00375"></a>00375         }
<a name="l00376"></a>00376     }
<a name="l00377"></a>00377 
<a name="l00378"></a>00378     <span class="keywordflow">if</span> (!init_state_set)
<a name="l00379"></a>00379         <a class="code" href="base_2misc_8hh.html#acad519418dbfdd70c1208711e609c80e">fatal</a>(<span class="stringliteral">&quot;%s: initial state not specified (add &apos;INIT &lt;id&gt;&apos; line &quot;</span>
<a name="l00380"></a>00380               <span class="stringliteral">&quot;to the config file)\n&quot;</span>, <a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>());
<a name="l00381"></a>00381 
<a name="l00382"></a>00382     <span class="comment">// resize and populate state transition matrix</span>
<a name="l00383"></a>00383     <a class="code" href="classTrafficGen.html#a14f30e68ecada24867b46bcc8093f4f5">transitionMatrix</a>.resize(<a class="code" href="classTrafficGen.html#a033c23b252da5264e1f864277711e5e1">states</a>.size());
<a name="l00384"></a>00384     <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> = 0; <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> &lt; <a class="code" href="classTrafficGen.html#a033c23b252da5264e1f864277711e5e1">states</a>.size(); <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>++) {
<a name="l00385"></a>00385         <a class="code" href="classTrafficGen.html#a14f30e68ecada24867b46bcc8093f4f5">transitionMatrix</a>[<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>].resize(<a class="code" href="classTrafficGen.html#a033c23b252da5264e1f864277711e5e1">states</a>.size());
<a name="l00386"></a>00386     }
<a name="l00387"></a>00387 
<a name="l00388"></a>00388     <span class="keywordflow">for</span> (<a class="code" href="classstd_1_1vector.html">vector&lt;Transition&gt;::iterator</a> <a class="code" href="namespaceArmISA.html#af5dfd7e551f8c5b461816e813dab252f">t</a> = transitions.begin();
<a name="l00389"></a>00389          <a class="code" href="namespaceArmISA.html#af5dfd7e551f8c5b461816e813dab252f">t</a> != transitions.end(); ++<a class="code" href="namespaceArmISA.html#af5dfd7e551f8c5b461816e813dab252f">t</a>) {
<a name="l00390"></a>00390         <a class="code" href="classTrafficGen.html#a14f30e68ecada24867b46bcc8093f4f5">transitionMatrix</a>[<a class="code" href="namespaceArmISA.html#af5dfd7e551f8c5b461816e813dab252f">t</a>-&gt;from][<a class="code" href="namespaceArmISA.html#af5dfd7e551f8c5b461816e813dab252f">t</a>-&gt;to] = <a class="code" href="namespaceArmISA.html#af5dfd7e551f8c5b461816e813dab252f">t</a>-&gt;p;
<a name="l00391"></a>00391     }
<a name="l00392"></a>00392 
<a name="l00393"></a>00393     <span class="comment">// ensure the egress edges do not have a probability larger than</span>
<a name="l00394"></a>00394     <span class="comment">// one</span>
<a name="l00395"></a>00395     <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> = 0; <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> &lt; <a class="code" href="classTrafficGen.html#a033c23b252da5264e1f864277711e5e1">states</a>.size(); <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>++) {
<a name="l00396"></a>00396         <span class="keywordtype">double</span> <a class="code" href="namespaceStats.html#adb8b0b9d553e52514e3db14f6bf7c449">sum</a> = 0;
<a name="l00397"></a>00397         <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespaceArmISA.html#adda8322536e2853111a71e4e2f911762">j</a> = 0; <a class="code" href="namespaceArmISA.html#adda8322536e2853111a71e4e2f911762">j</a> &lt; <a class="code" href="classTrafficGen.html#a033c23b252da5264e1f864277711e5e1">states</a>.size(); <a class="code" href="namespaceArmISA.html#adda8322536e2853111a71e4e2f911762">j</a>++) {
<a name="l00398"></a>00398             sum += <a class="code" href="classTrafficGen.html#a14f30e68ecada24867b46bcc8093f4f5">transitionMatrix</a>[<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>][<a class="code" href="namespaceArmISA.html#adda8322536e2853111a71e4e2f911762">j</a>];
<a name="l00399"></a>00399         }
<a name="l00400"></a>00400 
<a name="l00401"></a>00401         <span class="comment">// avoid comparing floating point numbers</span>
<a name="l00402"></a>00402         <span class="keywordflow">if</span> (abs(sum - 1.0) &gt; 0.001)
<a name="l00403"></a>00403             <a class="code" href="base_2misc_8hh.html#acad519418dbfdd70c1208711e609c80e">fatal</a>(<span class="stringliteral">&quot;%s has transition probability != 1 for state %d\n&quot;</span>,
<a name="l00404"></a>00404                   <a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>(), <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>);
<a name="l00405"></a>00405     }
<a name="l00406"></a>00406 
<a name="l00407"></a>00407     <span class="comment">// close input file</span>
<a name="l00408"></a>00408     infile.close();
<a name="l00409"></a>00409 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a29cb5a4f98063ce6e9210eacbdb35298"></a><!-- doxytag: member="TrafficGen::recvRetry" ref="a29cb5a4f98063ce6e9210eacbdb35298" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void recvRetry </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Receive a retry from the neighbouring port and attempt to resend the waiting packet. </p>

<p><div class="fragment"><pre class="fragment"><a name="l00445"></a>00445 {
<a name="l00446"></a>00446     assert(<a class="code" href="classTrafficGen.html#a314ae93c04b3ca96e79e1b1f39a8e478">retryPkt</a> != <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>);
<a name="l00447"></a>00447 
<a name="l00448"></a>00448     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classTrafficGen.html">TrafficGen</a>, <span class="stringliteral">&quot;Received retry\n&quot;</span>);
<a name="l00449"></a>00449     <a class="code" href="classTrafficGen.html#a166f92adc8967f926459ca64c92d6a66">numRetries</a>++;
<a name="l00450"></a>00450     <span class="comment">// attempt to send the packet, and if we are successful start up</span>
<a name="l00451"></a>00451     <span class="comment">// the machinery again</span>
<a name="l00452"></a>00452     <span class="keywordflow">if</span> (<a class="code" href="classTrafficGen.html#a51d5c08451d2b2b8b99fe3fda83f05d8">port</a>.<a class="code" href="classMasterPort.html#aafaf979005392447714384794f1a8610">sendTimingReq</a>(<a class="code" href="classTrafficGen.html#a314ae93c04b3ca96e79e1b1f39a8e478">retryPkt</a>)) {
<a name="l00453"></a>00453         <a class="code" href="classTrafficGen.html#a314ae93c04b3ca96e79e1b1f39a8e478">retryPkt</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00454"></a>00454         <span class="comment">// remember how much delay was incurred due to back-pressure</span>
<a name="l00455"></a>00455         <span class="comment">// when sending the request, we also use this to derive</span>
<a name="l00456"></a>00456         <span class="comment">// the tick for the next packet</span>
<a name="l00457"></a>00457         <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> delay = <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The universal simulation clock.">curTick</a>() - <a class="code" href="classTrafficGen.html#a770dcab4388a8d55911cb6f29d9bb692">retryPktTick</a>;
<a name="l00458"></a>00458         <a class="code" href="classTrafficGen.html#a770dcab4388a8d55911cb6f29d9bb692">retryPktTick</a> = 0;
<a name="l00459"></a>00459         <a class="code" href="classTrafficGen.html#a2d1dee1e20aeb0205ae665d7ad08b822">retryTicks</a> += delay;
<a name="l00460"></a>00460 
<a name="l00461"></a>00461         <span class="keywordflow">if</span> (<a class="code" href="classTrafficGen.html#a329b71fb934a93312ca0aacbf5a3f982">drainManager</a> == <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>) {
<a name="l00462"></a>00462             <span class="comment">// packet is sent, so find out when the next one is due</span>
<a name="l00463"></a>00463             <a class="code" href="classTrafficGen.html#a52d98e2f5ed0bf508db823995ad4940f">nextPacketTick</a> = <a class="code" href="classTrafficGen.html#a033c23b252da5264e1f864277711e5e1">states</a>[<a class="code" href="classTrafficGen.html#a8428fe009627d1dd49ef98a54587830e">currState</a>]-&gt;nextPacketTick(<a class="code" href="classTrafficGen.html#a42af28607a09ff1b95b5e848bf73f915">elasticReq</a>,
<a name="l00464"></a>00464                                                                delay);
<a name="l00465"></a>00465             <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> nextEventTick = std::min(<a class="code" href="classTrafficGen.html#a52d98e2f5ed0bf508db823995ad4940f">nextPacketTick</a>, <a class="code" href="classTrafficGen.html#aaa2a440da39850c0d2d678fd2ee844af">nextTransitionTick</a>);
<a name="l00466"></a>00466             <a class="code" href="classEventManager.html#a4ddebbfe9a12b95be6fb993ce892dcd3">schedule</a>(<a class="code" href="classTrafficGen.html#ab779474477fa217dd5483711dec2bf13">updateEvent</a>, std::max(<a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The universal simulation clock.">curTick</a>(), nextEventTick));
<a name="l00467"></a>00467         } <span class="keywordflow">else</span> {
<a name="l00468"></a>00468             <span class="comment">// shut things down</span>
<a name="l00469"></a>00469             <a class="code" href="classTrafficGen.html#a52d98e2f5ed0bf508db823995ad4940f">nextPacketTick</a> = <a class="code" href="base_2types_8hh.html#abe940b1b328825e234da719447e15ca5">MaxTick</a>;
<a name="l00470"></a>00470             <a class="code" href="classTrafficGen.html#aaa2a440da39850c0d2d678fd2ee844af">nextTransitionTick</a> = <a class="code" href="base_2types_8hh.html#abe940b1b328825e234da719447e15ca5">MaxTick</a>;
<a name="l00471"></a>00471             <a class="code" href="classTrafficGen.html#a329b71fb934a93312ca0aacbf5a3f982">drainManager</a>-&gt;<a class="code" href="classDrainManager.html#ab89d10e368d2e82061eddb9e40022382">signalDrainDone</a>();
<a name="l00472"></a>00472             <span class="comment">// Clear the drain event once we&apos;re done with it.</span>
<a name="l00473"></a>00473             <a class="code" href="classTrafficGen.html#a329b71fb934a93312ca0aacbf5a3f982">drainManager</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00474"></a>00474         }
<a name="l00475"></a>00475     }
<a name="l00476"></a>00476 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4dc637449366fcdfc4e764cdf12d9b11"></a><!-- doxytag: member="TrafficGen::regStats" ref="a4dc637449366fcdfc4e764cdf12d9b11" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void regStats </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p><a class="el" href="classRegister.html">Register</a> statistics </p>

<p><a class="el" href="classSimObject.html#a4dc637449366fcdfc4e764cdf12d9b11">SimObject</a>を再定義しています。</p>

<p><div class="fragment"><pre class="fragment"><a name="l00480"></a>00480 {
<a name="l00481"></a>00481     <span class="comment">// Initialise all the stats</span>
<a name="l00482"></a>00482     <span class="keyword">using namespace </span>Stats;
<a name="l00483"></a>00483 
<a name="l00484"></a>00484     <a class="code" href="classTrafficGen.html#a5ffd7b0e5641784cc4c40547e51c6cbc">numPackets</a>
<a name="l00485"></a>00485         .<a class="code" href="classStats_1_1DataWrap.html#a8eaf5c2b92132dfcacd7d9b10afb1726">name</a>(<a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>() + <span class="stringliteral">&quot;.numPackets&quot;</span>)
<a name="l00486"></a>00486         .desc(<span class="stringliteral">&quot;Number of packets generated&quot;</span>);
<a name="l00487"></a>00487 
<a name="l00488"></a>00488     <a class="code" href="classTrafficGen.html#a166f92adc8967f926459ca64c92d6a66">numRetries</a>
<a name="l00489"></a>00489         .<a class="code" href="classStats_1_1DataWrap.html#a8eaf5c2b92132dfcacd7d9b10afb1726">name</a>(<a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>() + <span class="stringliteral">&quot;.numRetries&quot;</span>)
<a name="l00490"></a>00490         .desc(<span class="stringliteral">&quot;Number of retries&quot;</span>);
<a name="l00491"></a>00491 
<a name="l00492"></a>00492     <a class="code" href="classTrafficGen.html#a2d1dee1e20aeb0205ae665d7ad08b822">retryTicks</a>
<a name="l00493"></a>00493         .<a class="code" href="classStats_1_1DataWrap.html#a8eaf5c2b92132dfcacd7d9b10afb1726">name</a>(<a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>() + <span class="stringliteral">&quot;.retryTicks&quot;</span>)
<a name="l00494"></a>00494         .desc(<span class="stringliteral">&quot;Time spent waiting due to back-pressure (ticks)&quot;</span>);
<a name="l00495"></a>00495 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a53e036786d17361be4c7320d39c99b84"></a><!-- doxytag: member="TrafficGen::serialize" ref="a53e036786d17361be4c7320d39c99b84" args="(std::ostream &amp;os)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void serialize </td>
          <td>(</td>
          <td class="paramtype">std::ostream &amp;&nbsp;</td>
          <td class="paramname"> <em>os</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><a class="el" href="classSerializable.html#ad6272f80ae37e8331e3969b3f072a801">Serializable</a>を再定義しています。</p>

</div>
</div>
<a class="anchor" id="aab0a81b788e7282586c12953fa5e0c37"></a><!-- doxytag: member="TrafficGen::transition" ref="aab0a81b788e7282586c12953fa5e0c37" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void transition </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Determine next state and perform the transition. </p>

<p><div class="fragment"><pre class="fragment"><a name="l00413"></a>00413 {
<a name="l00414"></a>00414     <span class="comment">// exit the current state</span>
<a name="l00415"></a>00415     <a class="code" href="classTrafficGen.html#a033c23b252da5264e1f864277711e5e1">states</a>[<a class="code" href="classTrafficGen.html#a8428fe009627d1dd49ef98a54587830e">currState</a>]-&gt;exit();
<a name="l00416"></a>00416 
<a name="l00417"></a>00417     <span class="comment">// determine next state</span>
<a name="l00418"></a>00418     <span class="keywordtype">double</span> <a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a> = <a class="code" href="random_8cc.html#afc426934ee11701464501fa46e24e041">random_mt</a>.<a class="code" href="classRandom.html#a495fb8d7ce08a0109503ad1d078c6a05">gen_real1</a>();
<a name="l00419"></a>00419     assert(<a class="code" href="classTrafficGen.html#a8428fe009627d1dd49ef98a54587830e">currState</a> &lt; <a class="code" href="classTrafficGen.html#a14f30e68ecada24867b46bcc8093f4f5">transitionMatrix</a>.size());
<a name="l00420"></a>00420     <span class="keywordtype">double</span> cumulative = 0.0;
<a name="l00421"></a>00421     <span class="keywordtype">size_t</span> <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> = 0;
<a name="l00422"></a>00422     <span class="keywordflow">do</span> {
<a name="l00423"></a>00423         cumulative += <a class="code" href="classTrafficGen.html#a14f30e68ecada24867b46bcc8093f4f5">transitionMatrix</a>[<a class="code" href="classTrafficGen.html#a8428fe009627d1dd49ef98a54587830e">currState</a>][i];
<a name="l00424"></a>00424         ++i;
<a name="l00425"></a>00425     } <span class="keywordflow">while</span> (cumulative &lt; p &amp;&amp; i &lt; <a class="code" href="classTrafficGen.html#a14f30e68ecada24867b46bcc8093f4f5">transitionMatrix</a>[<a class="code" href="classTrafficGen.html#a8428fe009627d1dd49ef98a54587830e">currState</a>].size());
<a name="l00426"></a>00426 
<a name="l00427"></a>00427     <a class="code" href="classTrafficGen.html#a1346cf8b75d4ba67a861233a8651601d">enterState</a>(i - 1);
<a name="l00428"></a>00428 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af22e5d6d660b97db37003ac61ac4ee49"></a><!-- doxytag: member="TrafficGen::unserialize" ref="af22e5d6d660b97db37003ac61ac4ee49" args="(Checkpoint *cp, const std::string &amp;section)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void unserialize </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classCheckpoint.html">Checkpoint</a> *&nbsp;</td>
          <td class="paramname"> <em>cp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&nbsp;</td>
          <td class="paramname"> <em>section</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><a class="el" href="classSerializable.html#af100c4e9feabf3cd918619c88c718387">Serializable</a>を再定義しています。</p>

</div>
</div>
<a class="anchor" id="ac5c54df7ed3b930268c8d7752c101725"></a><!-- doxytag: member="TrafficGen::update" ref="ac5c54df7ed3b930268c8d7752c101725" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void update </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Schedules event for next update and executes an update on the state graph, either performing a state transition or executing the current state, depending on the current time. </p>

<p><div class="fragment"><pre class="fragment"><a name="l00181"></a>00181 {
<a name="l00182"></a>00182     <span class="comment">// if we have reached the time for the next state transition, then</span>
<a name="l00183"></a>00183     <span class="comment">// perform the transition</span>
<a name="l00184"></a>00184     <span class="keywordflow">if</span> (<a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The universal simulation clock.">curTick</a>() &gt;= <a class="code" href="classTrafficGen.html#aaa2a440da39850c0d2d678fd2ee844af">nextTransitionTick</a>) {
<a name="l00185"></a>00185         <a class="code" href="classTrafficGen.html#aab0a81b788e7282586c12953fa5e0c37">transition</a>();
<a name="l00186"></a>00186     } <span class="keywordflow">else</span> {
<a name="l00187"></a>00187         assert(<a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The universal simulation clock.">curTick</a>() &gt;= <a class="code" href="classTrafficGen.html#a52d98e2f5ed0bf508db823995ad4940f">nextPacketTick</a>);
<a name="l00188"></a>00188         <span class="comment">// get the next packet and try to send it</span>
<a name="l00189"></a>00189         <a class="code" href="classPacket.html">PacketPtr</a> pkt = <a class="code" href="classTrafficGen.html#a033c23b252da5264e1f864277711e5e1">states</a>[<a class="code" href="classTrafficGen.html#a8428fe009627d1dd49ef98a54587830e">currState</a>]-&gt;getNextPacket();
<a name="l00190"></a>00190         <a class="code" href="classTrafficGen.html#a5ffd7b0e5641784cc4c40547e51c6cbc">numPackets</a>++;
<a name="l00191"></a>00191         <span class="keywordflow">if</span> (!<a class="code" href="classTrafficGen.html#a51d5c08451d2b2b8b99fe3fda83f05d8">port</a>.<a class="code" href="classMasterPort.html#aafaf979005392447714384794f1a8610">sendTimingReq</a>(pkt)) {
<a name="l00192"></a>00192             <a class="code" href="classTrafficGen.html#a314ae93c04b3ca96e79e1b1f39a8e478">retryPkt</a> = pkt;
<a name="l00193"></a>00193             <a class="code" href="classTrafficGen.html#a770dcab4388a8d55911cb6f29d9bb692">retryPktTick</a> = <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The universal simulation clock.">curTick</a>();
<a name="l00194"></a>00194         }
<a name="l00195"></a>00195     }
<a name="l00196"></a>00196 
<a name="l00197"></a>00197     <span class="comment">// if we are waiting for a retry, do not schedule any further</span>
<a name="l00198"></a>00198     <span class="comment">// events, in the case of a transition or a successful send, go</span>
<a name="l00199"></a>00199     <span class="comment">// ahead and determine when the next update should take place</span>
<a name="l00200"></a>00200     <span class="keywordflow">if</span> (<a class="code" href="classTrafficGen.html#a314ae93c04b3ca96e79e1b1f39a8e478">retryPkt</a> == <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>) {
<a name="l00201"></a>00201         <span class="comment">// schedule next update event based on either the next execute</span>
<a name="l00202"></a>00202         <span class="comment">// tick or the next transition, which ever comes first</span>
<a name="l00203"></a>00203         <a class="code" href="classTrafficGen.html#a52d98e2f5ed0bf508db823995ad4940f">nextPacketTick</a> = <a class="code" href="classTrafficGen.html#a033c23b252da5264e1f864277711e5e1">states</a>[<a class="code" href="classTrafficGen.html#a8428fe009627d1dd49ef98a54587830e">currState</a>]-&gt;nextPacketTick(<a class="code" href="classTrafficGen.html#a42af28607a09ff1b95b5e848bf73f915">elasticReq</a>, 0);
<a name="l00204"></a>00204         <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> nextEventTick = std::min(<a class="code" href="classTrafficGen.html#a52d98e2f5ed0bf508db823995ad4940f">nextPacketTick</a>, <a class="code" href="classTrafficGen.html#aaa2a440da39850c0d2d678fd2ee844af">nextTransitionTick</a>);
<a name="l00205"></a>00205         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classTrafficGen.html">TrafficGen</a>, <span class="stringliteral">&quot;Next event scheduled at %lld\n&quot;</span>, nextEventTick);
<a name="l00206"></a>00206         <a class="code" href="classEventManager.html#a4ddebbfe9a12b95be6fb993ce892dcd3">schedule</a>(<a class="code" href="classTrafficGen.html#ab779474477fa217dd5483711dec2bf13">updateEvent</a>, nextEventTick);
<a name="l00207"></a>00207     }
<a name="l00208"></a>00208 }
</pre></div></p>

</div>
</div>
<hr/><h2>変数</h2>
<a class="anchor" id="ad5835f1d2646493dafb2c5ac6244a93f"></a><!-- doxytag: member="TrafficGen::configFile" ref="ad5835f1d2646493dafb2c5ac6244a93f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const std::string <a class="el" href="classTrafficGen.html#ad5835f1d2646493dafb2c5ac6244a93f">configFile</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>The config file to parse. </p>

</div>
</div>
<a class="anchor" id="a8428fe009627d1dd49ef98a54587830e"></a><!-- doxytag: member="TrafficGen::currState" ref="a8428fe009627d1dd49ef98a54587830e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> <a class="el" href="classTrafficGen.html#a8428fe009627d1dd49ef98a54587830e">currState</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Index of the current state </p>

</div>
</div>
<a class="anchor" id="a329b71fb934a93312ca0aacbf5a3f982"></a><!-- doxytag: member="TrafficGen::drainManager" ref="a329b71fb934a93312ca0aacbf5a3f982" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classDrainManager.html">DrainManager</a>* <a class="el" href="classTrafficGen.html#a329b71fb934a93312ca0aacbf5a3f982">drainManager</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Manager to signal when drained </p>

</div>
</div>
<a class="anchor" id="a42af28607a09ff1b95b5e848bf73f915"></a><!-- doxytag: member="TrafficGen::elasticReq" ref="a42af28607a09ff1b95b5e848bf73f915" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const bool <a class="el" href="classTrafficGen.html#a42af28607a09ff1b95b5e848bf73f915">elasticReq</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Determine whether to add elasticity in the request injection, thus responding to backpressure by slowing things down. </p>

</div>
</div>
<a class="anchor" id="aa8528db52f6eb976baecb2291d1b408a"></a><!-- doxytag: member="TrafficGen::masterID" ref="aa8528db52f6eb976baecb2291d1b408a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="request_8hh.html#ac366b729262fd8e7cbd3283da6f775cf">MasterID</a> <a class="el" href="classTrafficGen.html#aa8528db52f6eb976baecb2291d1b408a">masterID</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>MasterID used in generated requests. </p>

</div>
</div>
<a class="anchor" id="a52d98e2f5ed0bf508db823995ad4940f"></a><!-- doxytag: member="TrafficGen::nextPacketTick" ref="a52d98e2f5ed0bf508db823995ad4940f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> <a class="el" href="classTrafficGen.html#a52d98e2f5ed0bf508db823995ad4940f">nextPacketTick</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p><a class="el" href="classTime.html">Time</a> of the next packet. </p>

</div>
</div>
<a class="anchor" id="aaa2a440da39850c0d2d678fd2ee844af"></a><!-- doxytag: member="TrafficGen::nextTransitionTick" ref="aaa2a440da39850c0d2d678fd2ee844af" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> <a class="el" href="classTrafficGen.html#aaa2a440da39850c0d2d678fd2ee844af">nextTransitionTick</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p><a class="el" href="classTime.html">Time</a> of next transition </p>

</div>
</div>
<a class="anchor" id="a5ffd7b0e5641784cc4c40547e51c6cbc"></a><!-- doxytag: member="TrafficGen::numPackets" ref="a5ffd7b0e5641784cc4c40547e51c6cbc" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classStats_1_1Scalar.html">Stats::Scalar</a> <a class="el" href="classTrafficGen.html#a5ffd7b0e5641784cc4c40547e51c6cbc">numPackets</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Count the number of generated packets. </p>

</div>
</div>
<a class="anchor" id="a166f92adc8967f926459ca64c92d6a66"></a><!-- doxytag: member="TrafficGen::numRetries" ref="a166f92adc8967f926459ca64c92d6a66" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classStats_1_1Scalar.html">Stats::Scalar</a> <a class="el" href="classTrafficGen.html#a166f92adc8967f926459ca64c92d6a66">numRetries</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Count the number of retries. </p>

</div>
</div>
<a class="anchor" id="a51d5c08451d2b2b8b99fe3fda83f05d8"></a><!-- doxytag: member="TrafficGen::port" ref="a51d5c08451d2b2b8b99fe3fda83f05d8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classTrafficGen_1_1TrafficGenPort.html">TrafficGenPort</a> <a class="el" href="classTrafficGen.html#a51d5c08451d2b2b8b99fe3fda83f05d8">port</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>The instance of master port used by the traffic generator. </p>

</div>
</div>
<a class="anchor" id="a314ae93c04b3ca96e79e1b1f39a8e478"></a><!-- doxytag: member="TrafficGen::retryPkt" ref="a314ae93c04b3ca96e79e1b1f39a8e478" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classPacket.html">PacketPtr</a> <a class="el" href="classTrafficGen.html#a314ae93c04b3ca96e79e1b1f39a8e478">retryPkt</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p><a class="el" href="classPacket.html">Packet</a> waiting to be sent. </p>

</div>
</div>
<a class="anchor" id="a770dcab4388a8d55911cb6f29d9bb692"></a><!-- doxytag: member="TrafficGen::retryPktTick" ref="a770dcab4388a8d55911cb6f29d9bb692" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> <a class="el" href="classTrafficGen.html#a770dcab4388a8d55911cb6f29d9bb692">retryPktTick</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Tick when the stalled packet was meant to be sent. </p>

</div>
</div>
<a class="anchor" id="a2d1dee1e20aeb0205ae665d7ad08b822"></a><!-- doxytag: member="TrafficGen::retryTicks" ref="a2d1dee1e20aeb0205ae665d7ad08b822" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classStats_1_1Scalar.html">Stats::Scalar</a> <a class="el" href="classTrafficGen.html#a2d1dee1e20aeb0205ae665d7ad08b822">retryTicks</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Count the time incurred from back-pressure. </p>

</div>
</div>
<a class="anchor" id="a033c23b252da5264e1f864277711e5e1"></a><!-- doxytag: member="TrafficGen::states" ref="a033c23b252da5264e1f864277711e5e1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">m5::hash_map&lt;<a class="el" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>, <a class="el" href="classBaseGen.html">BaseGen</a>*&gt; <a class="el" href="classTrafficGen.html#a033c23b252da5264e1f864277711e5e1">states</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Map of generator states </p>

</div>
</div>
<a class="anchor" id="af27ccd765f13a4b7bd119dc7579e2746"></a><!-- doxytag: member="TrafficGen::system" ref="af27ccd765f13a4b7bd119dc7579e2746" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classSystem.html">System</a>* <a class="el" href="classTrafficGen.html#af27ccd765f13a4b7bd119dc7579e2746">system</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>The system used to determine which mode we are currently operating in. </p>

</div>
</div>
<a class="anchor" id="a14f30e68ecada24867b46bcc8093f4f5"></a><!-- doxytag: member="TrafficGen::transitionMatrix" ref="a14f30e68ecada24867b46bcc8093f4f5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classstd_1_1vector.html">std::vector</a>&lt;<a class="el" href="classstd_1_1vector.html">std::vector</a>&lt;double&gt; &gt; <a class="el" href="classTrafficGen.html#a14f30e68ecada24867b46bcc8093f4f5">transitionMatrix</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>State transition matrix </p>

</div>
</div>
<a class="anchor" id="ab779474477fa217dd5483711dec2bf13"></a><!-- doxytag: member="TrafficGen::updateEvent" ref="ab779474477fa217dd5483711dec2bf13" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classEventWrapper.html">EventWrapper</a>&lt;<a class="el" href="classTrafficGen_1_1TrafficGen.html">TrafficGen</a>, &amp;TrafficGen::update&gt; <a class="el" href="classTrafficGen.html#ab779474477fa217dd5483711dec2bf13">updateEvent</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p><a class="el" href="classEvent.html">Event</a> for scheduling updates </p>

</div>
</div>
<hr/>このクラスの説明は次のファイルから生成されました:<ul>
<li>cpu/testers/traffic_gen/<a class="el" href="traffic__gen_8hh_source.html">traffic_gen.hh</a></li>
<li>cpu/testers/traffic_gen/<a class="el" href="traffic__gen_8cc.html">traffic_gen.cc</a></li>
</ul>
</div>
<hr size="1"/><address style="text-align: right;"><small>File&nbsp;GEM5&nbsp;Wrapperに対して25 May 2015に生成されました。&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
