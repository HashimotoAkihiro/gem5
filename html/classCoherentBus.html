<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>File&nbsp;GEM5&nbsp;Wrapper: クラス CoherentBus</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- 作成： Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>メインページ</span></a></li>
      <li><a href="pages.html"><span>関連ページ</span></a></li>
      <li><a href="modules.html"><span>モジュール</span></a></li>
      <li><a href="namespaces.html"><span>ネームスペース</span></a></li>
      <li class="current"><a href="annotated.html"><span>クラス</span></a></li>
      <li><a href="files.html"><span>ファイル</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>構成</span></a></li>
      <li><a href="classes.html"><span>構成索引</span></a></li>
      <li><a href="hierarchy.html"><span>クラス階層</span></a></li>
      <li><a href="functions.html"><span>構成メンバ</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>クラス CoherentBus</h1><!-- doxytag: class="CoherentBus" --><!-- doxytag: inherits="BaseBus" -->
<p><code>#include &lt;<a class="el" href="coherent__bus_8hh_source.html">coherent_bus.hh</a>&gt;</code></p>
<div class="dynheader">
CoherentBusに対する継承グラフ</div>
<div class="dynsection">
 <div class="center">
  <img src="classCoherentBus.gif" usemap="#CoherentBus_map" alt=""/>
  <map id="CoherentBus_map" name="CoherentBus_map">
<area href="classBaseBus.html" alt="BaseBus" shape="rect" coords="105,224,200,248"/>
<area href="classMemObject.html" alt="MemObject" shape="rect" coords="105,168,200,192"/>
<area href="classClockedObject.html" alt="ClockedObject" shape="rect" coords="105,112,200,136"/>
<area href="classSimObject.html" alt="SimObject" shape="rect" coords="105,56,200,80"/>
<area href="classEventManager.html" alt="EventManager" shape="rect" coords="0,0,95,24"/>
<area href="classSerializable.html" alt="Serializable" shape="rect" coords="105,0,200,24"/>
<area href="classDrainable.html" alt="Drainable" shape="rect" coords="210,0,305,24"/>
</map>
 </div>
</div>

<p><a href="classCoherentBus-members.html">すべてのメンバ一覧</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>構成</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCoherentBus_1_1CoherentBusMasterPort.html">CoherentBusMasterPort</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCoherentBus_1_1CoherentBusSlavePort.html">CoherentBusSlavePort</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCoherentBus_1_1SnoopRespPort.html">SnoopRespPort</a></td></tr>
<tr><td colspan="2"><h2>Public メソッド</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCoherentBus.html#a02fd73d861ef2e4aabb38c0c9ff82947">init</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCoherentBus.html#a0ca3474701c095c96854cb430f4f6bba">CoherentBus</a> (const CoherentBusParams *p)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCoherentBus.html#a9f68bdf0f3ed90b32cf54e32f4bfc0b2">~CoherentBus</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCoherentBus.html#aa8a18d230dba7a674ac8a0b4f35bc36a">drain</a> (<a class="el" href="classDrainManager.html">DrainManager</a> *dm)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCoherentBus.html#a4dc637449366fcdfc4e764cdf12d9b11">regStats</a> ()</td></tr>
<tr><td colspan="2"><h2>Protected 型</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef <a class="el" href="classBaseBus_1_1Layer.html">Layer</a>&lt; <a class="el" href="classSlavePort.html">SlavePort</a>, <br class="typebreak"/>
<a class="el" href="classMasterPort.html">MasterPort</a> &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCoherentBus.html#ae15f02c0dca186fbfbd2f7b732e5b441">ReqLayer</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef <a class="el" href="classBaseBus_1_1Layer.html">Layer</a>&lt; <a class="el" href="classMasterPort.html">MasterPort</a>, <br class="typebreak"/>
<a class="el" href="classSlavePort.html">SlavePort</a> &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCoherentBus.html#a40797c56ea5eaf481f56dfdc3ab1b399">RespLayer</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef <a class="el" href="classBaseBus_1_1Layer.html">Layer</a>&lt; <a class="el" href="classSlavePort.html">SlavePort</a>, <br class="typebreak"/>
<a class="el" href="classMasterPort.html">MasterPort</a> &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCoherentBus.html#a73f554be8ad7076f9403bb35d6af14f1">SnoopLayer</a></td></tr>
<tr><td colspan="2"><h2>Protected メソッド</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCoherentBus.html#a8e2d7ccc3adb605e763f2bd1c64e5128">recvTimingReq</a> (<a class="el" href="classPacket.html">PacketPtr</a> pkt, <a class="el" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a> slave_port_id)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCoherentBus.html#a47ba09f9a3b3998cac9c14ab596a7515">recvTimingResp</a> (<a class="el" href="classPacket.html">PacketPtr</a> pkt, <a class="el" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a> master_port_id)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCoherentBus.html#a8a06090652319e21031b8bc2f8018e2b">recvTimingSnoopReq</a> (<a class="el" href="classPacket.html">PacketPtr</a> pkt, <a class="el" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a> master_port_id)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCoherentBus.html#a29d5427944c6a4e363cf42eb70f480b1">recvTimingSnoopResp</a> (<a class="el" href="classPacket.html">PacketPtr</a> pkt, <a class="el" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a> slave_port_id)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCoherentBus.html#a96f9cd33bfb9a8b7fb2b25078eaf75a1">recvRetry</a> (<a class="el" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a> master_port_id)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCoherentBus.html#a63303c7524b820a7d0de62c07b097139">forwardTiming</a> (<a class="el" href="classPacket.html">PacketPtr</a> pkt, <a class="el" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a> exclude_slave_port_id)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCoherentBus.html#ab0e34155d341f5561834eca8e4c97759">recvAtomic</a> (<a class="el" href="classPacket.html">PacketPtr</a> pkt, <a class="el" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a> slave_port_id)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCoherentBus.html#a533893555a1e2a7727e380a4747c33fb">recvAtomicSnoop</a> (<a class="el" href="classPacket.html">PacketPtr</a> pkt, <a class="el" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a> master_port_id)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classstd_1_1pair.html">std::pair</a>&lt; <a class="el" href="classMemCmd.html">MemCmd</a>, <a class="el" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCoherentBus.html#aec73b2af9058f907bf2cf6c2773d46ba">forwardAtomic</a> (<a class="el" href="classPacket.html">PacketPtr</a> pkt, <a class="el" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a> exclude_slave_port_id)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCoherentBus.html#a5cdfa7d369ba37394403d3c2bd5cf6d1">recvFunctional</a> (<a class="el" href="classPacket.html">PacketPtr</a> pkt, <a class="el" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a> slave_port_id)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCoherentBus.html#aab366eefcf6b389a308a63c82e7b3116">recvFunctionalSnoop</a> (<a class="el" href="classPacket.html">PacketPtr</a> pkt, <a class="el" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a> master_port_id)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCoherentBus.html#a45d5f60100921e96c8635b20cd9e9fab">forwardFunctional</a> (<a class="el" href="classPacket.html">PacketPtr</a> pkt, <a class="el" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a> exclude_slave_port_id)</td></tr>
<tr><td colspan="2"><h2>Protected 変数</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classstd_1_1vector.html">std::vector</a>&lt; <a class="el" href="classBaseBus_1_1Layer.html">ReqLayer</a> * &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCoherentBus.html#ab124575386549f77de080cd9fcaf2ba0">reqLayers</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classstd_1_1vector.html">std::vector</a>&lt; <a class="el" href="classBaseBus_1_1Layer.html">RespLayer</a> * &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCoherentBus.html#a2f42dda70e78f1e5e9574f11b465d173">respLayers</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classstd_1_1vector.html">std::vector</a>&lt; <a class="el" href="classBaseBus_1_1Layer.html">SnoopLayer</a> * &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCoherentBus.html#ae6f8cf70846d8ee4b2314816863efbca">snoopLayers</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classstd_1_1vector.html">std::vector</a>&lt; <a class="el" href="classCoherentBus_1_1SnoopRespPort.html">SnoopRespPort</a> * &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCoherentBus.html#ae876574c554fa099bcd063e2e188b95b">snoopRespPorts</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classstd_1_1vector.html">std::vector</a>&lt; <a class="el" href="classSlavePort.html">SlavePort</a> * &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCoherentBus.html#acdbc947756de5f5071b88ce0702d557d">snoopPorts</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">m5::hash_set&lt; <a class="el" href="classRequest.html">RequestPtr</a> &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCoherentBus.html#a8b5de6798515d1ac1236592c5ad7c521">outstandingReq</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classSystem.html">System</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCoherentBus.html#af27ccd765f13a4b7bd119dc7579e2746">system</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classStats_1_1Scalar.html">Stats::Scalar</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCoherentBus.html#a7040fa8d9fb24afb9f4fe245b135da19">dataThroughBus</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classStats_1_1Scalar.html">Stats::Scalar</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCoherentBus.html#a576c4936ce7bed70cd1751024670e75f">snoopDataThroughBus</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>説明</h2>
<p>A coherent bus connects a number of (potentially) snooping masters and slaves, and routes the request and response packets based on the address, and also forwards all requests to the snoopers and deals with the snoop responses.</p>
<p>The coherent bus can be used as a template for modelling QPI, HyperTransport, ACE and coherent OCP buses, and is typically used for the L1-to-L2 buses and as the main system interconnect. </p>
<dl class="see"><dt><b>参照:</b></dt><dd>gem5 Memory System </dd></dl>
<hr/><h2>型定義</h2>
<a class="anchor" id="ae15f02c0dca186fbfbd2f7b732e5b441"></a><!-- doxytag: member="CoherentBus::ReqLayer" ref="ae15f02c0dca186fbfbd2f7b732e5b441" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="classBaseBus_1_1Layer.html">Layer</a>&lt;<a class="el" href="classSlavePort.html">SlavePort</a>,<a class="el" href="classMasterPort.html">MasterPort</a>&gt; <a class="el" href="classBaseBus_1_1Layer.html">ReqLayer</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Declare the layers of this bus, one vector for requests, one for responses, and one for snoop responses </p>

</div>
</div>
<a class="anchor" id="a40797c56ea5eaf481f56dfdc3ab1b399"></a><!-- doxytag: member="CoherentBus::RespLayer" ref="a40797c56ea5eaf481f56dfdc3ab1b399" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="classBaseBus_1_1Layer.html">Layer</a>&lt;<a class="el" href="classMasterPort.html">MasterPort</a>,<a class="el" href="classSlavePort.html">SlavePort</a>&gt; <a class="el" href="classBaseBus_1_1Layer.html">RespLayer</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a73f554be8ad7076f9403bb35d6af14f1"></a><!-- doxytag: member="CoherentBus::SnoopLayer" ref="a73f554be8ad7076f9403bb35d6af14f1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="classBaseBus_1_1Layer.html">Layer</a>&lt;<a class="el" href="classSlavePort.html">SlavePort</a>,<a class="el" href="classMasterPort.html">MasterPort</a>&gt; <a class="el" href="classBaseBus_1_1Layer.html">SnoopLayer</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/><h2>コンストラクタとデストラクタ</h2>
<a class="anchor" id="a0ca3474701c095c96854cb430f4f6bba"></a><!-- doxytag: member="CoherentBus::CoherentBus" ref="a0ca3474701c095c96854cb430f4f6bba" args="(const CoherentBusParams *p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classCoherentBus.html">CoherentBus</a> </td>
          <td>(</td>
          <td class="paramtype">const CoherentBusParams *&nbsp;</td>
          <td class="paramname"> <em>p</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00058"></a>00058     : <a class="code" href="classBaseBus.html#aafbb881b411bf8ecd7696a6b6c9fbf5c">BaseBus</a>(<a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a>), <a class="code" href="classCoherentBus.html#af27ccd765f13a4b7bd119dc7579e2746">system</a>(<a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a>-&gt;system)
<a name="l00059"></a>00059 {
<a name="l00060"></a>00060     <span class="comment">// create the ports based on the size of the master and slave</span>
<a name="l00061"></a>00061     <span class="comment">// vector ports, and the presence of the default port, the ports</span>
<a name="l00062"></a>00062     <span class="comment">// are enumerated starting from zero</span>
<a name="l00063"></a>00063     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> = 0; <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> &lt; <a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a>-&gt;port_master_connection_count; ++<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>) {
<a name="l00064"></a>00064         std::string portName = <a class="code" href="cprintf_8hh.html#ace22d1c39f2df58e593bc49d1613eca2">csprintf</a>(<span class="stringliteral">&quot;%s.master[%d]&quot;</span>, <a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>(), <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>);
<a name="l00065"></a>00065         <a class="code" href="classMasterPort.html">MasterPort</a>* bp = <span class="keyword">new</span> CoherentBusMasterPort(portName, *<span class="keyword">this</span>, <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>);
<a name="l00066"></a>00066         <a class="code" href="classBaseBus.html#a0f7b2e1619b03085b0a28bb3216cd562">masterPorts</a>.push_back(bp);
<a name="l00067"></a>00067         <a class="code" href="classCoherentBus.html#ab124575386549f77de080cd9fcaf2ba0">reqLayers</a>.push_back(<span class="keyword">new</span> <a class="code" href="classCoherentBus.html#ae15f02c0dca186fbfbd2f7b732e5b441">ReqLayer</a>(*bp, *<span class="keyword">this</span>,
<a name="l00068"></a>00068                                          <a class="code" href="cprintf_8hh.html#ace22d1c39f2df58e593bc49d1613eca2">csprintf</a>(<span class="stringliteral">&quot;.reqLayer%d&quot;</span>, <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>)));
<a name="l00069"></a>00069         <a class="code" href="classCoherentBus.html#ae6f8cf70846d8ee4b2314816863efbca">snoopLayers</a>.push_back(<span class="keyword">new</span> <a class="code" href="classCoherentBus.html#a73f554be8ad7076f9403bb35d6af14f1">SnoopLayer</a>(*bp, *<span class="keyword">this</span>,
<a name="l00070"></a>00070                                              <a class="code" href="cprintf_8hh.html#ace22d1c39f2df58e593bc49d1613eca2">csprintf</a>(<span class="stringliteral">&quot;.snoopLayer%d&quot;</span>, <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>)));
<a name="l00071"></a>00071     }
<a name="l00072"></a>00072 
<a name="l00073"></a>00073     <span class="comment">// see if we have a default slave device connected and if so add</span>
<a name="l00074"></a>00074     <span class="comment">// our corresponding master port</span>
<a name="l00075"></a>00075     <span class="keywordflow">if</span> (<a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a>-&gt;port_default_connection_count) {
<a name="l00076"></a>00076         <a class="code" href="classBaseBus.html#a769e7b27ddafebcc1228757f2c9ec1ba">defaultPortID</a> = <a class="code" href="classBaseBus.html#a0f7b2e1619b03085b0a28bb3216cd562">masterPorts</a>.size();
<a name="l00077"></a>00077         std::string portName = <a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>() + <span class="stringliteral">&quot;.default&quot;</span>;
<a name="l00078"></a>00078         <a class="code" href="classMasterPort.html">MasterPort</a>* bp = <span class="keyword">new</span> CoherentBusMasterPort(portName, *<span class="keyword">this</span>,
<a name="l00079"></a>00079                                                    <a class="code" href="classBaseBus.html#a769e7b27ddafebcc1228757f2c9ec1ba">defaultPortID</a>);
<a name="l00080"></a>00080         <a class="code" href="classBaseBus.html#a0f7b2e1619b03085b0a28bb3216cd562">masterPorts</a>.push_back(bp);
<a name="l00081"></a>00081         <a class="code" href="classCoherentBus.html#ab124575386549f77de080cd9fcaf2ba0">reqLayers</a>.push_back(<span class="keyword">new</span> <a class="code" href="classCoherentBus.html#ae15f02c0dca186fbfbd2f7b732e5b441">ReqLayer</a>(*bp, *<span class="keyword">this</span>, <a class="code" href="cprintf_8hh.html#ace22d1c39f2df58e593bc49d1613eca2">csprintf</a>(<span class="stringliteral">&quot;.reqLayer%d&quot;</span>,
<a name="l00082"></a>00082                                              <a class="code" href="classBaseBus.html#a769e7b27ddafebcc1228757f2c9ec1ba">defaultPortID</a>)));
<a name="l00083"></a>00083         <a class="code" href="classCoherentBus.html#ae6f8cf70846d8ee4b2314816863efbca">snoopLayers</a>.push_back(<span class="keyword">new</span> <a class="code" href="classCoherentBus.html#a73f554be8ad7076f9403bb35d6af14f1">SnoopLayer</a>(*bp, *<span class="keyword">this</span>,
<a name="l00084"></a>00084                                              <a class="code" href="cprintf_8hh.html#ace22d1c39f2df58e593bc49d1613eca2">csprintf</a>(<span class="stringliteral">&quot;.snoopLayer%d&quot;</span>,
<a name="l00085"></a>00085                                                       <a class="code" href="classBaseBus.html#a769e7b27ddafebcc1228757f2c9ec1ba">defaultPortID</a>)));
<a name="l00086"></a>00086     }
<a name="l00087"></a>00087 
<a name="l00088"></a>00088     <span class="comment">// create the slave ports, once again starting at zero</span>
<a name="l00089"></a>00089     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> = 0; <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> &lt; <a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a>-&gt;port_slave_connection_count; ++<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>) {
<a name="l00090"></a>00090         std::string portName = <a class="code" href="cprintf_8hh.html#ace22d1c39f2df58e593bc49d1613eca2">csprintf</a>(<span class="stringliteral">&quot;%s.slave[%d]&quot;</span>, <a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>(), <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>);
<a name="l00091"></a>00091         <a class="code" href="classSlavePort.html">SlavePort</a>* bp = <span class="keyword">new</span> CoherentBusSlavePort(portName, *<span class="keyword">this</span>, <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>);
<a name="l00092"></a>00092         <a class="code" href="classBaseBus.html#a9f084bf86a306772d84ad52e839cce97">slavePorts</a>.push_back(bp);
<a name="l00093"></a>00093         <a class="code" href="classCoherentBus.html#a2f42dda70e78f1e5e9574f11b465d173">respLayers</a>.push_back(<span class="keyword">new</span> <a class="code" href="classCoherentBus.html#a40797c56ea5eaf481f56dfdc3ab1b399">RespLayer</a>(*bp, *<span class="keyword">this</span>,
<a name="l00094"></a>00094                                            <a class="code" href="cprintf_8hh.html#ace22d1c39f2df58e593bc49d1613eca2">csprintf</a>(<span class="stringliteral">&quot;.respLayer%d&quot;</span>, <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>)));
<a name="l00095"></a>00095         <a class="code" href="classCoherentBus.html#ae876574c554fa099bcd063e2e188b95b">snoopRespPorts</a>.push_back(<span class="keyword">new</span> SnoopRespPort(*bp, *<span class="keyword">this</span>));
<a name="l00096"></a>00096     }
<a name="l00097"></a>00097 
<a name="l00098"></a>00098     <a class="code" href="classBaseBus.html#a2b259c34a080563d0e03d5a1fec2cd7a">clearPortCache</a>();
<a name="l00099"></a>00099 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9f68bdf0f3ed90b32cf54e32f4bfc0b2"></a><!-- doxytag: member="CoherentBus::~CoherentBus" ref="a9f68bdf0f3ed90b32cf54e32f4bfc0b2" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">~<a class="el" href="classCoherentBus.html">CoherentBus</a> </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00102"></a>00102 {
<a name="l00103"></a>00103     <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="namespaceMipsISA.html#a5818de049c10ffd7c1fea7d4dd69ed5c">l</a> = <a class="code" href="classCoherentBus.html#ab124575386549f77de080cd9fcaf2ba0">reqLayers</a>.begin(); <a class="code" href="namespaceMipsISA.html#a5818de049c10ffd7c1fea7d4dd69ed5c">l</a> != <a class="code" href="classCoherentBus.html#ab124575386549f77de080cd9fcaf2ba0">reqLayers</a>.end(); ++<a class="code" href="namespaceMipsISA.html#a5818de049c10ffd7c1fea7d4dd69ed5c">l</a>)
<a name="l00104"></a>00104         <span class="keyword">delete</span> *<a class="code" href="namespaceMipsISA.html#a5818de049c10ffd7c1fea7d4dd69ed5c">l</a>;
<a name="l00105"></a>00105     <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="namespaceMipsISA.html#a5818de049c10ffd7c1fea7d4dd69ed5c">l</a> = <a class="code" href="classCoherentBus.html#a2f42dda70e78f1e5e9574f11b465d173">respLayers</a>.begin(); <a class="code" href="namespaceMipsISA.html#a5818de049c10ffd7c1fea7d4dd69ed5c">l</a> != <a class="code" href="classCoherentBus.html#a2f42dda70e78f1e5e9574f11b465d173">respLayers</a>.end(); ++<a class="code" href="namespaceMipsISA.html#a5818de049c10ffd7c1fea7d4dd69ed5c">l</a>)
<a name="l00106"></a>00106         <span class="keyword">delete</span> *<a class="code" href="namespaceMipsISA.html#a5818de049c10ffd7c1fea7d4dd69ed5c">l</a>;
<a name="l00107"></a>00107     <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="namespaceMipsISA.html#a5818de049c10ffd7c1fea7d4dd69ed5c">l</a> = <a class="code" href="classCoherentBus.html#ae6f8cf70846d8ee4b2314816863efbca">snoopLayers</a>.begin(); <a class="code" href="namespaceMipsISA.html#a5818de049c10ffd7c1fea7d4dd69ed5c">l</a> != <a class="code" href="classCoherentBus.html#ae6f8cf70846d8ee4b2314816863efbca">snoopLayers</a>.end(); ++<a class="code" href="namespaceMipsISA.html#a5818de049c10ffd7c1fea7d4dd69ed5c">l</a>)
<a name="l00108"></a>00108         <span class="keyword">delete</span> *<a class="code" href="namespaceMipsISA.html#a5818de049c10ffd7c1fea7d4dd69ed5c">l</a>;
<a name="l00109"></a>00109     <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a> = <a class="code" href="classCoherentBus.html#ae876574c554fa099bcd063e2e188b95b">snoopRespPorts</a>.begin(); <a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a> != <a class="code" href="classCoherentBus.html#ae876574c554fa099bcd063e2e188b95b">snoopRespPorts</a>.end(); ++<a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a>)
<a name="l00110"></a>00110         <span class="keyword">delete</span> *<a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a>;
<a name="l00111"></a>00111 }
</pre></div></p>

</div>
</div>
<hr/><h2>関数</h2>
<a class="anchor" id="aa8a18d230dba7a674ac8a0b4f35bc36a"></a><!-- doxytag: member="CoherentBus::drain" ref="aa8a18d230dba7a674ac8a0b4f35bc36a" args="(DrainManager *dm)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int drain </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classDrainManager.html">DrainManager</a> *&nbsp;</td>
          <td class="paramname"> <em>drainManger</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Provide a default implementation of the drain interface that simply returns 0 (draining completed) and sets the drain state to Drained. </p>

<p><a class="el" href="classBaseBus.html#ac8c1510f7e1591e75a5c79b4b873f6b4">BaseBus</a>を実装しています。</p>

<p><div class="fragment"><pre class="fragment"><a name="l00636"></a>00636 {
<a name="l00637"></a>00637     <span class="comment">// sum up the individual layers</span>
<a name="l00638"></a>00638     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespaceStats.html#a4031dfee086a6a4cf1deea1fff2e0d5c">total</a> = 0;
<a name="l00639"></a>00639     <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="namespaceMipsISA.html#a5818de049c10ffd7c1fea7d4dd69ed5c">l</a> = <a class="code" href="classCoherentBus.html#ab124575386549f77de080cd9fcaf2ba0">reqLayers</a>.begin(); <a class="code" href="namespaceMipsISA.html#a5818de049c10ffd7c1fea7d4dd69ed5c">l</a> != <a class="code" href="classCoherentBus.html#ab124575386549f77de080cd9fcaf2ba0">reqLayers</a>.end(); ++<a class="code" href="namespaceMipsISA.html#a5818de049c10ffd7c1fea7d4dd69ed5c">l</a>)
<a name="l00640"></a>00640         total += (*l)-&gt;drain(<a class="code" href="namespaceMipsISA.html#a2575c29e7f4617b6076486f340b6fe19">dm</a>);
<a name="l00641"></a>00641     <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="namespaceMipsISA.html#a5818de049c10ffd7c1fea7d4dd69ed5c">l</a> = <a class="code" href="classCoherentBus.html#a2f42dda70e78f1e5e9574f11b465d173">respLayers</a>.begin(); <a class="code" href="namespaceMipsISA.html#a5818de049c10ffd7c1fea7d4dd69ed5c">l</a> != <a class="code" href="classCoherentBus.html#a2f42dda70e78f1e5e9574f11b465d173">respLayers</a>.end(); ++<a class="code" href="namespaceMipsISA.html#a5818de049c10ffd7c1fea7d4dd69ed5c">l</a>)
<a name="l00642"></a>00642         total += (*l)-&gt;drain(<a class="code" href="namespaceMipsISA.html#a2575c29e7f4617b6076486f340b6fe19">dm</a>);
<a name="l00643"></a>00643     <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="namespaceMipsISA.html#a5818de049c10ffd7c1fea7d4dd69ed5c">l</a> = <a class="code" href="classCoherentBus.html#ae6f8cf70846d8ee4b2314816863efbca">snoopLayers</a>.begin(); <a class="code" href="namespaceMipsISA.html#a5818de049c10ffd7c1fea7d4dd69ed5c">l</a> != <a class="code" href="classCoherentBus.html#ae6f8cf70846d8ee4b2314816863efbca">snoopLayers</a>.end(); ++<a class="code" href="namespaceMipsISA.html#a5818de049c10ffd7c1fea7d4dd69ed5c">l</a>)
<a name="l00644"></a>00644         total += (*l)-&gt;drain(<a class="code" href="namespaceMipsISA.html#a2575c29e7f4617b6076486f340b6fe19">dm</a>);
<a name="l00645"></a>00645     <span class="keywordflow">return</span> total;
<a name="l00646"></a>00646 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aec73b2af9058f907bf2cf6c2773d46ba"></a><!-- doxytag: member="CoherentBus::forwardAtomic" ref="aec73b2af9058f907bf2cf6c2773d46ba" args="(PacketPtr pkt, PortID exclude_slave_port_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classstd_1_1pair.html">std::pair</a>&lt; <a class="el" href="classMemCmd.html">MemCmd</a>, <a class="el" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> &gt; forwardAtomic </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classPacket.html">PacketPtr</a>&nbsp;</td>
          <td class="paramname"> <em>pkt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a>&nbsp;</td>
          <td class="paramname"> <em>exclude_slave_port_id</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Forward an atomic packet to our snoopers, potentially excluding one of the connected coherent masters to avoid sending a packet back to where it came from.</p>
<dl><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pkt</em>&nbsp;</td><td><a class="el" href="classPacket.html">Packet</a> to forward </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>exclude_slave_port_id</em>&nbsp;</td><td>Id of slave port to exclude</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>戻り値:</b></dt><dd>a pair containing the snoop response and snoop latency </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00527"></a>00527 {
<a name="l00528"></a>00528     <span class="comment">// the packet may be changed on snoops, record the original</span>
<a name="l00529"></a>00529     <span class="comment">// command to enable us to restore it between snoops so that</span>
<a name="l00530"></a>00530     <span class="comment">// additional snoops can take place properly</span>
<a name="l00531"></a>00531     <a class="code" href="classMemCmd.html">MemCmd</a> orig_cmd = pkt-&gt;<a class="code" href="classPacket.html#af88eb56d484b750933cd2ea86594f001" title="The command field of the packet.">cmd</a>;
<a name="l00532"></a>00532     <a class="code" href="classMemCmd.html">MemCmd</a> snoop_response_cmd = <a class="code" href="classMemCmd.html#a2afce0a47a93eee73a314d53e4890153a47dcc37c58138c184357ccbe13373b51">MemCmd::InvalidCmd</a>;
<a name="l00533"></a>00533     <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> snoop_response_latency = 0;
<a name="l00534"></a>00534 
<a name="l00535"></a>00535     <span class="comment">// snoops should only happen if the system isn&apos;t bypassing caches</span>
<a name="l00536"></a>00536     assert(!<a class="code" href="classCoherentBus.html#af27ccd765f13a4b7bd119dc7579e2746">system</a>-&gt;<a class="code" href="classSystem.html#a613d9d917b0e950cd322026de403d702">bypassCaches</a>());
<a name="l00537"></a>00537 
<a name="l00538"></a>00538     <span class="keywordflow">for</span> (<a class="code" href="classBaseBus.html#a2b00f9fc9ba7e236c9757ea764cda19d">SlavePortIter</a> <a class="code" href="namespaceArmISA.html#afaeb18e17f862d8fcb76dfb68a18854f">s</a> = <a class="code" href="classCoherentBus.html#acdbc947756de5f5071b88ce0702d557d">snoopPorts</a>.begin(); <a class="code" href="namespaceArmISA.html#afaeb18e17f862d8fcb76dfb68a18854f">s</a> != <a class="code" href="classCoherentBus.html#acdbc947756de5f5071b88ce0702d557d">snoopPorts</a>.end(); ++<a class="code" href="namespaceArmISA.html#afaeb18e17f862d8fcb76dfb68a18854f">s</a>) {
<a name="l00539"></a>00539         <a class="code" href="classSlavePort.html">SlavePort</a> *<a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a> = *<a class="code" href="namespaceArmISA.html#afaeb18e17f862d8fcb76dfb68a18854f">s</a>;
<a name="l00540"></a>00540         <span class="comment">// we could have gotten this request from a snooping master</span>
<a name="l00541"></a>00541         <span class="comment">// (corresponding to our own slave port that is also in</span>
<a name="l00542"></a>00542         <span class="comment">// snoopPorts) and should not send it back to where it came</span>
<a name="l00543"></a>00543         <span class="comment">// from</span>
<a name="l00544"></a>00544         <span class="keywordflow">if</span> (exclude_slave_port_id == <a class="code" href="base_2types_8hh.html#a65bf40f138cf863f0c5e2d8ca1144126">InvalidPortID</a> ||
<a name="l00545"></a>00545             p-&gt;<a class="code" href="classPort.html#ad95169ead4fa2bd3241b2bbb1bc7b420">getId</a>() != exclude_slave_port_id) {
<a name="l00546"></a>00546             <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> latency = p-&gt;<a class="code" href="classSlavePort.html#a4cc4d76bd3aaf333980c232125c8acc8">sendAtomicSnoop</a>(pkt);
<a name="l00547"></a>00547             <span class="comment">// in contrast to a functional access, we have to keep on</span>
<a name="l00548"></a>00548             <span class="comment">// going as all snoopers must be updated even if we get a</span>
<a name="l00549"></a>00549             <span class="comment">// response</span>
<a name="l00550"></a>00550             <span class="keywordflow">if</span> (pkt-&gt;<a class="code" href="classPacket.html#a5f89a108755a6cb3e8185d85c850a816">isResponse</a>()) {
<a name="l00551"></a>00551                 <span class="comment">// response from snoop agent</span>
<a name="l00552"></a>00552                 assert(pkt-&gt;<a class="code" href="classPacket.html#af88eb56d484b750933cd2ea86594f001" title="The command field of the packet.">cmd</a> != orig_cmd);
<a name="l00553"></a>00553                 assert(pkt-&gt;<a class="code" href="classPacket.html#a9693a1ffeda326646443ab2a2a92be41">memInhibitAsserted</a>());
<a name="l00554"></a>00554                 <span class="comment">// should only happen once</span>
<a name="l00555"></a>00555                 assert(snoop_response_cmd == <a class="code" href="classMemCmd.html#a2afce0a47a93eee73a314d53e4890153a47dcc37c58138c184357ccbe13373b51">MemCmd::InvalidCmd</a>);
<a name="l00556"></a>00556                 <span class="comment">// save response state</span>
<a name="l00557"></a>00557                 snoop_response_cmd = pkt-&gt;<a class="code" href="classPacket.html#af88eb56d484b750933cd2ea86594f001" title="The command field of the packet.">cmd</a>;
<a name="l00558"></a>00558                 snoop_response_latency = latency;
<a name="l00559"></a>00559                 <span class="comment">// restore original packet state for remaining snoopers</span>
<a name="l00560"></a>00560                 pkt-&gt;<a class="code" href="classPacket.html#af88eb56d484b750933cd2ea86594f001" title="The command field of the packet.">cmd</a> = orig_cmd;
<a name="l00561"></a>00561             }
<a name="l00562"></a>00562         }
<a name="l00563"></a>00563     }
<a name="l00564"></a>00564 
<a name="l00565"></a>00565     <span class="comment">// the packet is restored as part of the loop and any potential</span>
<a name="l00566"></a>00566     <span class="comment">// snoop response is part of the returned pair</span>
<a name="l00567"></a>00567     <span class="keywordflow">return</span> std::make_pair(snoop_response_cmd, snoop_response_latency);
<a name="l00568"></a>00568 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a45d5f60100921e96c8635b20cd9e9fab"></a><!-- doxytag: member="CoherentBus::forwardFunctional" ref="a45d5f60100921e96c8635b20cd9e9fab" args="(PacketPtr pkt, PortID exclude_slave_port_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void forwardFunctional </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classPacket.html">PacketPtr</a>&nbsp;</td>
          <td class="paramname"> <em>pkt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a>&nbsp;</td>
          <td class="paramname"> <em>exclude_slave_port_id</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Forward a functional packet to our snoopers, potentially excluding one of the connected coherent masters to avoid sending a packet back to where it came from.</p>
<dl><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pkt</em>&nbsp;</td><td><a class="el" href="classPacket.html">Packet</a> to forward </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>exclude_slave_port_id</em>&nbsp;</td><td>Id of slave port to exclude </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l00613"></a>00613 {
<a name="l00614"></a>00614     <span class="comment">// snoops should only happen if the system isn&apos;t bypassing caches</span>
<a name="l00615"></a>00615     assert(!<a class="code" href="classCoherentBus.html#af27ccd765f13a4b7bd119dc7579e2746">system</a>-&gt;<a class="code" href="classSystem.html#a613d9d917b0e950cd322026de403d702">bypassCaches</a>());
<a name="l00616"></a>00616 
<a name="l00617"></a>00617     <span class="keywordflow">for</span> (<a class="code" href="classBaseBus.html#a2b00f9fc9ba7e236c9757ea764cda19d">SlavePortIter</a> <a class="code" href="namespaceArmISA.html#afaeb18e17f862d8fcb76dfb68a18854f">s</a> = <a class="code" href="classCoherentBus.html#acdbc947756de5f5071b88ce0702d557d">snoopPorts</a>.begin(); <a class="code" href="namespaceArmISA.html#afaeb18e17f862d8fcb76dfb68a18854f">s</a> != <a class="code" href="classCoherentBus.html#acdbc947756de5f5071b88ce0702d557d">snoopPorts</a>.end(); ++<a class="code" href="namespaceArmISA.html#afaeb18e17f862d8fcb76dfb68a18854f">s</a>) {
<a name="l00618"></a>00618         <a class="code" href="classSlavePort.html">SlavePort</a> *<a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a> = *<a class="code" href="namespaceArmISA.html#afaeb18e17f862d8fcb76dfb68a18854f">s</a>;
<a name="l00619"></a>00619         <span class="comment">// we could have gotten this request from a snooping master</span>
<a name="l00620"></a>00620         <span class="comment">// (corresponding to our own slave port that is also in</span>
<a name="l00621"></a>00621         <span class="comment">// snoopPorts) and should not send it back to where it came</span>
<a name="l00622"></a>00622         <span class="comment">// from</span>
<a name="l00623"></a>00623         <span class="keywordflow">if</span> (exclude_slave_port_id == <a class="code" href="base_2types_8hh.html#a65bf40f138cf863f0c5e2d8ca1144126">InvalidPortID</a> ||
<a name="l00624"></a>00624             p-&gt;<a class="code" href="classPort.html#ad95169ead4fa2bd3241b2bbb1bc7b420">getId</a>() != exclude_slave_port_id)
<a name="l00625"></a>00625             p-&gt;<a class="code" href="classSlavePort.html#a821cf873ae00e77f71d77505a63cfed7">sendFunctionalSnoop</a>(pkt);
<a name="l00626"></a>00626 
<a name="l00627"></a>00627         <span class="comment">// if we get a response we are done</span>
<a name="l00628"></a>00628         <span class="keywordflow">if</span> (pkt-&gt;<a class="code" href="classPacket.html#a5f89a108755a6cb3e8185d85c850a816">isResponse</a>()) {
<a name="l00629"></a>00629             <span class="keywordflow">break</span>;
<a name="l00630"></a>00630         }
<a name="l00631"></a>00631     }
<a name="l00632"></a>00632 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a63303c7524b820a7d0de62c07b097139"></a><!-- doxytag: member="CoherentBus::forwardTiming" ref="a63303c7524b820a7d0de62c07b097139" args="(PacketPtr pkt, PortID exclude_slave_port_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void forwardTiming </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classPacket.html">PacketPtr</a>&nbsp;</td>
          <td class="paramname"> <em>pkt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a>&nbsp;</td>
          <td class="paramname"> <em>exclude_slave_port_id</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Forward a timing packet to our snoopers, potentially excluding one of the connected coherent masters to avoid sending a packet back to where it came from.</p>
<dl><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pkt</em>&nbsp;</td><td><a class="el" href="classPacket.html">Packet</a> to forward </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>exclude_slave_port_id</em>&nbsp;</td><td>Id of slave port to exclude </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l00421"></a>00421 {
<a name="l00422"></a>00422     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classCoherentBus.html">CoherentBus</a>, <span class="stringliteral">&quot;%s for %s address %x size %d\n&quot;</span>, __func__,
<a name="l00423"></a>00423             pkt-&gt;<a class="code" href="classPacket.html#a863af57e28a01258236ea303155fc7ff">cmdString</a>(), pkt-&gt;<a class="code" href="classPacket.html#afca9af4d83a57836baba87603463a6e0">getAddr</a>(), pkt-&gt;<a class="code" href="classPacket.html#a1d18ba49c7be427da1f4a42d53e35f48">getSize</a>());
<a name="l00424"></a>00424 
<a name="l00425"></a>00425     <span class="comment">// snoops should only happen if the system isn&apos;t bypassing caches</span>
<a name="l00426"></a>00426     assert(!<a class="code" href="classCoherentBus.html#af27ccd765f13a4b7bd119dc7579e2746">system</a>-&gt;<a class="code" href="classSystem.html#a613d9d917b0e950cd322026de403d702">bypassCaches</a>());
<a name="l00427"></a>00427 
<a name="l00428"></a>00428     <span class="keywordflow">for</span> (<a class="code" href="classBaseBus.html#a2b00f9fc9ba7e236c9757ea764cda19d">SlavePortIter</a> <a class="code" href="namespaceArmISA.html#afaeb18e17f862d8fcb76dfb68a18854f">s</a> = <a class="code" href="classCoherentBus.html#acdbc947756de5f5071b88ce0702d557d">snoopPorts</a>.begin(); <a class="code" href="namespaceArmISA.html#afaeb18e17f862d8fcb76dfb68a18854f">s</a> != <a class="code" href="classCoherentBus.html#acdbc947756de5f5071b88ce0702d557d">snoopPorts</a>.end(); ++<a class="code" href="namespaceArmISA.html#afaeb18e17f862d8fcb76dfb68a18854f">s</a>) {
<a name="l00429"></a>00429         <a class="code" href="classSlavePort.html">SlavePort</a> *<a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a> = *<a class="code" href="namespaceArmISA.html#afaeb18e17f862d8fcb76dfb68a18854f">s</a>;
<a name="l00430"></a>00430         <span class="comment">// we could have gotten this request from a snooping master</span>
<a name="l00431"></a>00431         <span class="comment">// (corresponding to our own slave port that is also in</span>
<a name="l00432"></a>00432         <span class="comment">// snoopPorts) and should not send it back to where it came</span>
<a name="l00433"></a>00433         <span class="comment">// from</span>
<a name="l00434"></a>00434         <span class="keywordflow">if</span> (exclude_slave_port_id == <a class="code" href="base_2types_8hh.html#a65bf40f138cf863f0c5e2d8ca1144126">InvalidPortID</a> ||
<a name="l00435"></a>00435             p-&gt;<a class="code" href="classPort.html#ad95169ead4fa2bd3241b2bbb1bc7b420">getId</a>() != exclude_slave_port_id) {
<a name="l00436"></a>00436             <span class="comment">// cache is not allowed to refuse snoop</span>
<a name="l00437"></a>00437             p-&gt;<a class="code" href="classSlavePort.html#a44317ff11e2c240ae72ca2f5f1d9076d">sendTimingSnoopReq</a>(pkt);
<a name="l00438"></a>00438         }
<a name="l00439"></a>00439     }
<a name="l00440"></a>00440 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a02fd73d861ef2e4aabb38c0c9ff82947"></a><!-- doxytag: member="CoherentBus::init" ref="a02fd73d861ef2e4aabb38c0c9ff82947" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void init </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p><a class="el" href="classCoherentBus.html#a02fd73d861ef2e4aabb38c0c9ff82947">init()</a> is called after all C++ SimObjects have been created and all ports are connected. Initializations that are independent of unserialization but rely on a fully instantiated and connected <a class="el" href="classSimObject.html">SimObject</a> graph should be done here. </p>

<p><a class="el" href="classBaseBus.html#a02fd73d861ef2e4aabb38c0c9ff82947">BaseBus</a>を再定義しています。</p>

<p><div class="fragment"><pre class="fragment"><a name="l00115"></a>00115 {
<a name="l00116"></a>00116     <span class="comment">// the base class is responsible for determining the block size</span>
<a name="l00117"></a>00117     <a class="code" href="classCoherentBus.html#a02fd73d861ef2e4aabb38c0c9ff82947">BaseBus::init</a>();
<a name="l00118"></a>00118 
<a name="l00119"></a>00119     <span class="comment">// iterate over our slave ports and determine which of our</span>
<a name="l00120"></a>00120     <span class="comment">// neighbouring master ports are snooping and add them as snoopers</span>
<a name="l00121"></a>00121     <span class="keywordflow">for</span> (<a class="code" href="classBaseBus.html#a4cfbb26aa06c3132b77227f45f39e224">SlavePortConstIter</a> <a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a> = <a class="code" href="classBaseBus.html#a9f084bf86a306772d84ad52e839cce97">slavePorts</a>.begin(); <a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a> != <a class="code" href="classBaseBus.html#a9f084bf86a306772d84ad52e839cce97">slavePorts</a>.end();
<a name="l00122"></a>00122          ++<a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a>) {
<a name="l00123"></a>00123         <span class="comment">// check if the connected master port is snooping</span>
<a name="l00124"></a>00124         <span class="keywordflow">if</span> ((*p)-&gt;isSnooping()) {
<a name="l00125"></a>00125             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(BusAddrRanges, <span class="stringliteral">&quot;Adding snooping master %s\n&quot;</span>,
<a name="l00126"></a>00126                     (*p)-&gt;getMasterPort().name());
<a name="l00127"></a>00127             <a class="code" href="classCoherentBus.html#acdbc947756de5f5071b88ce0702d557d">snoopPorts</a>.push_back(*<a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a>);
<a name="l00128"></a>00128         }
<a name="l00129"></a>00129     }
<a name="l00130"></a>00130 
<a name="l00131"></a>00131     <span class="keywordflow">if</span> (<a class="code" href="classCoherentBus.html#acdbc947756de5f5071b88ce0702d557d">snoopPorts</a>.empty())
<a name="l00132"></a>00132         <a class="code" href="base_2misc_8hh.html#a8224a361dddd2ad59b411982e5ea746f">warn</a>(<span class="stringliteral">&quot;CoherentBus %s has no snooping ports attached!\n&quot;</span>, <a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>());
<a name="l00133"></a>00133 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab0e34155d341f5561834eca8e4c97759"></a><!-- doxytag: member="CoherentBus::recvAtomic" ref="ab0e34155d341f5561834eca8e4c97759" args="(PacketPtr pkt, PortID slave_port_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> recvAtomic </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classPacket.html">PacketPtr</a>&nbsp;</td>
          <td class="paramname"> <em>pkt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a>&nbsp;</td>
          <td class="paramname"> <em>slave_port_id</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function called by the port when the bus is recieving a Atomic transaction. </p>

<p><div class="fragment"><pre class="fragment"><a name="l00453"></a>00453 {
<a name="l00454"></a>00454     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classCoherentBus.html">CoherentBus</a>, <span class="stringliteral">&quot;recvAtomic: packet src %s addr 0x%x cmd %s\n&quot;</span>,
<a name="l00455"></a>00455             <a class="code" href="classBaseBus.html#a9f084bf86a306772d84ad52e839cce97">slavePorts</a>[slave_port_id]-&gt;<a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>(), pkt-&gt;<a class="code" href="classPacket.html#afca9af4d83a57836baba87603463a6e0">getAddr</a>(),
<a name="l00456"></a>00456             pkt-&gt;<a class="code" href="classPacket.html#a863af57e28a01258236ea303155fc7ff">cmdString</a>());
<a name="l00457"></a>00457 
<a name="l00458"></a>00458     <span class="comment">// add the request data</span>
<a name="l00459"></a>00459     <a class="code" href="classCoherentBus.html#a7040fa8d9fb24afb9f4fe245b135da19">dataThroughBus</a> += pkt-&gt;<a class="code" href="classPacket.html#a0effbd4cf91891700ac41e86defe4aa6">hasData</a>() ? pkt-&gt;<a class="code" href="classPacket.html#a1d18ba49c7be427da1f4a42d53e35f48">getSize</a>() : 0;
<a name="l00460"></a>00460 
<a name="l00461"></a>00461     <a class="code" href="classMemCmd.html">MemCmd</a> snoop_response_cmd = <a class="code" href="classMemCmd.html#a2afce0a47a93eee73a314d53e4890153a47dcc37c58138c184357ccbe13373b51">MemCmd::InvalidCmd</a>;
<a name="l00462"></a>00462     <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> snoop_response_latency = 0;
<a name="l00463"></a>00463 
<a name="l00464"></a>00464     <span class="comment">// uncacheable requests need never be snooped</span>
<a name="l00465"></a>00465     <span class="keywordflow">if</span> (!pkt-&gt;<a class="code" href="classPacket.html#a956cd41d82347558b9c0a5b0474903f2" title="A pointer to the original request.">req</a>-&gt;<a class="code" href="classRequest.html#a70c74b2809417ea8701dd6ba9e34312d">isUncacheable</a>() &amp;&amp; !<a class="code" href="classCoherentBus.html#af27ccd765f13a4b7bd119dc7579e2746">system</a>-&gt;<a class="code" href="classSystem.html#a613d9d917b0e950cd322026de403d702">bypassCaches</a>()) {
<a name="l00466"></a>00466         <span class="comment">// forward to all snoopers but the source</span>
<a name="l00467"></a>00467         <a class="code" href="classstd_1_1pair.html">std::pair&lt;MemCmd, Tick&gt;</a> snoop_result =
<a name="l00468"></a>00468             <a class="code" href="classCoherentBus.html#aec73b2af9058f907bf2cf6c2773d46ba">forwardAtomic</a>(pkt, slave_port_id);
<a name="l00469"></a>00469         snoop_response_cmd = snoop_result.first;
<a name="l00470"></a>00470         snoop_response_latency = snoop_result.second;
<a name="l00471"></a>00471     }
<a name="l00472"></a>00472 
<a name="l00473"></a>00473     <span class="comment">// even if we had a snoop response, we must continue and also</span>
<a name="l00474"></a>00474     <span class="comment">// perform the actual request at the destination</span>
<a name="l00475"></a>00475     <a class="code" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a> dest_id = <a class="code" href="classBaseBus.html#a16872a256ea6eae168abc47d498841cb">findPort</a>(pkt-&gt;<a class="code" href="classPacket.html#afca9af4d83a57836baba87603463a6e0">getAddr</a>());
<a name="l00476"></a>00476 
<a name="l00477"></a>00477     <span class="comment">// forward the request to the appropriate destination</span>
<a name="l00478"></a>00478     <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> response_latency = <a class="code" href="classBaseBus.html#a0f7b2e1619b03085b0a28bb3216cd562">masterPorts</a>[dest_id]-&gt;sendAtomic(pkt);
<a name="l00479"></a>00479 
<a name="l00480"></a>00480     <span class="comment">// if we got a response from a snooper, restore it here</span>
<a name="l00481"></a>00481     <span class="keywordflow">if</span> (snoop_response_cmd != <a class="code" href="classMemCmd.html#a2afce0a47a93eee73a314d53e4890153a47dcc37c58138c184357ccbe13373b51">MemCmd::InvalidCmd</a>) {
<a name="l00482"></a>00482         <span class="comment">// no one else should have responded</span>
<a name="l00483"></a>00483         assert(!pkt-&gt;<a class="code" href="classPacket.html#a5f89a108755a6cb3e8185d85c850a816">isResponse</a>());
<a name="l00484"></a>00484         pkt-&gt;<a class="code" href="classPacket.html#af88eb56d484b750933cd2ea86594f001" title="The command field of the packet.">cmd</a> = snoop_response_cmd;
<a name="l00485"></a>00485         response_latency = snoop_response_latency;
<a name="l00486"></a>00486     }
<a name="l00487"></a>00487 
<a name="l00488"></a>00488     <span class="comment">// add the response data</span>
<a name="l00489"></a>00489     <span class="keywordflow">if</span> (pkt-&gt;<a class="code" href="classPacket.html#a5f89a108755a6cb3e8185d85c850a816">isResponse</a>())
<a name="l00490"></a>00490         dataThroughBus += pkt-&gt;<a class="code" href="classPacket.html#a0effbd4cf91891700ac41e86defe4aa6">hasData</a>() ? pkt-&gt;<a class="code" href="classPacket.html#a1d18ba49c7be427da1f4a42d53e35f48">getSize</a>() : 0;
<a name="l00491"></a>00491 
<a name="l00492"></a>00492     <span class="comment">// @todo: Not setting first-word time</span>
<a name="l00493"></a>00493     pkt-&gt;<a class="code" href="classPacket.html#a7bf8ae0a056329f751eda8b39ca4c268">busLastWordDelay</a> = response_latency;
<a name="l00494"></a>00494     <span class="keywordflow">return</span> response_latency;
<a name="l00495"></a>00495 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a533893555a1e2a7727e380a4747c33fb"></a><!-- doxytag: member="CoherentBus::recvAtomicSnoop" ref="a533893555a1e2a7727e380a4747c33fb" args="(PacketPtr pkt, PortID master_port_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> recvAtomicSnoop </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classPacket.html">PacketPtr</a>&nbsp;</td>
          <td class="paramname"> <em>pkt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a>&nbsp;</td>
          <td class="paramname"> <em>master_port_id</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function called by the port when the bus is recieving an atomic snoop transaction. </p>

<p><div class="fragment"><pre class="fragment"><a name="l00499"></a>00499 {
<a name="l00500"></a>00500     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classCoherentBus.html">CoherentBus</a>, <span class="stringliteral">&quot;recvAtomicSnoop: packet src %s addr 0x%x cmd %s\n&quot;</span>,
<a name="l00501"></a>00501             <a class="code" href="classBaseBus.html#a0f7b2e1619b03085b0a28bb3216cd562">masterPorts</a>[master_port_id]-&gt;<a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>(), pkt-&gt;<a class="code" href="classPacket.html#afca9af4d83a57836baba87603463a6e0">getAddr</a>(),
<a name="l00502"></a>00502             pkt-&gt;<a class="code" href="classPacket.html#a863af57e28a01258236ea303155fc7ff">cmdString</a>());
<a name="l00503"></a>00503 
<a name="l00504"></a>00504     <span class="comment">// add the request snoop data</span>
<a name="l00505"></a>00505     <a class="code" href="classCoherentBus.html#a576c4936ce7bed70cd1751024670e75f">snoopDataThroughBus</a> += pkt-&gt;<a class="code" href="classPacket.html#a0effbd4cf91891700ac41e86defe4aa6">hasData</a>() ? pkt-&gt;<a class="code" href="classPacket.html#a1d18ba49c7be427da1f4a42d53e35f48">getSize</a>() : 0;
<a name="l00506"></a>00506 
<a name="l00507"></a>00507     <span class="comment">// forward to all snoopers</span>
<a name="l00508"></a>00508     <a class="code" href="classstd_1_1pair.html">std::pair&lt;MemCmd, Tick&gt;</a> snoop_result =
<a name="l00509"></a>00509         <a class="code" href="classCoherentBus.html#aec73b2af9058f907bf2cf6c2773d46ba">forwardAtomic</a>(pkt, <a class="code" href="base_2types_8hh.html#a65bf40f138cf863f0c5e2d8ca1144126">InvalidPortID</a>);
<a name="l00510"></a>00510     <a class="code" href="classMemCmd.html">MemCmd</a> snoop_response_cmd = snoop_result.first;
<a name="l00511"></a>00511     <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> snoop_response_latency = snoop_result.second;
<a name="l00512"></a>00512 
<a name="l00513"></a>00513     <span class="keywordflow">if</span> (snoop_response_cmd != <a class="code" href="classMemCmd.html#a2afce0a47a93eee73a314d53e4890153a47dcc37c58138c184357ccbe13373b51">MemCmd::InvalidCmd</a>)
<a name="l00514"></a>00514         pkt-&gt;<a class="code" href="classPacket.html#af88eb56d484b750933cd2ea86594f001" title="The command field of the packet.">cmd</a> = snoop_response_cmd;
<a name="l00515"></a>00515 
<a name="l00516"></a>00516     <span class="comment">// add the response snoop data</span>
<a name="l00517"></a>00517     <span class="keywordflow">if</span> (pkt-&gt;<a class="code" href="classPacket.html#a5f89a108755a6cb3e8185d85c850a816">isResponse</a>())
<a name="l00518"></a>00518         snoopDataThroughBus += pkt-&gt;<a class="code" href="classPacket.html#a0effbd4cf91891700ac41e86defe4aa6">hasData</a>() ? pkt-&gt;<a class="code" href="classPacket.html#a1d18ba49c7be427da1f4a42d53e35f48">getSize</a>() : 0;
<a name="l00519"></a>00519 
<a name="l00520"></a>00520     <span class="comment">// @todo: Not setting first-word time</span>
<a name="l00521"></a>00521     pkt-&gt;<a class="code" href="classPacket.html#a7bf8ae0a056329f751eda8b39ca4c268">busLastWordDelay</a> = snoop_response_latency;
<a name="l00522"></a>00522     <span class="keywordflow">return</span> snoop_response_latency;
<a name="l00523"></a>00523 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5cdfa7d369ba37394403d3c2bd5cf6d1"></a><!-- doxytag: member="CoherentBus::recvFunctional" ref="a5cdfa7d369ba37394403d3c2bd5cf6d1" args="(PacketPtr pkt, PortID slave_port_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void recvFunctional </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classPacket.html">PacketPtr</a>&nbsp;</td>
          <td class="paramname"> <em>pkt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a>&nbsp;</td>
          <td class="paramname"> <em>slave_port_id</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function called by the port when the bus is recieving a Functional transaction. </p>

<p><div class="fragment"><pre class="fragment"><a name="l00572"></a>00572 {
<a name="l00573"></a>00573     <span class="keywordflow">if</span> (!pkt-&gt;<a class="code" href="classPacket.html#ae56bb417ddf53e85cb389267590fe969">isPrint</a>()) {
<a name="l00574"></a>00574         <span class="comment">// don&apos;t do DPRINTFs on PrintReq as it clutters up the output</span>
<a name="l00575"></a>00575         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classCoherentBus.html">CoherentBus</a>,
<a name="l00576"></a>00576                 <span class="stringliteral">&quot;recvFunctional: packet src %s addr 0x%x cmd %s\n&quot;</span>,
<a name="l00577"></a>00577                 <a class="code" href="classBaseBus.html#a9f084bf86a306772d84ad52e839cce97">slavePorts</a>[slave_port_id]-&gt;<a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>(), pkt-&gt;<a class="code" href="classPacket.html#afca9af4d83a57836baba87603463a6e0">getAddr</a>(),
<a name="l00578"></a>00578                 pkt-&gt;<a class="code" href="classPacket.html#a863af57e28a01258236ea303155fc7ff">cmdString</a>());
<a name="l00579"></a>00579     }
<a name="l00580"></a>00580 
<a name="l00581"></a>00581     <span class="comment">// uncacheable requests need never be snooped</span>
<a name="l00582"></a>00582     <span class="keywordflow">if</span> (!pkt-&gt;<a class="code" href="classPacket.html#a956cd41d82347558b9c0a5b0474903f2" title="A pointer to the original request.">req</a>-&gt;<a class="code" href="classRequest.html#a70c74b2809417ea8701dd6ba9e34312d">isUncacheable</a>() &amp;&amp; !<a class="code" href="classCoherentBus.html#af27ccd765f13a4b7bd119dc7579e2746">system</a>-&gt;<a class="code" href="classSystem.html#a613d9d917b0e950cd322026de403d702">bypassCaches</a>()) {
<a name="l00583"></a>00583         <span class="comment">// forward to all snoopers but the source</span>
<a name="l00584"></a>00584         <a class="code" href="classCoherentBus.html#a45d5f60100921e96c8635b20cd9e9fab">forwardFunctional</a>(pkt, slave_port_id);
<a name="l00585"></a>00585     }
<a name="l00586"></a>00586 
<a name="l00587"></a>00587     <span class="comment">// there is no need to continue if the snooping has found what we</span>
<a name="l00588"></a>00588     <span class="comment">// were looking for and the packet is already a response</span>
<a name="l00589"></a>00589     <span class="keywordflow">if</span> (!pkt-&gt;<a class="code" href="classPacket.html#a5f89a108755a6cb3e8185d85c850a816">isResponse</a>()) {
<a name="l00590"></a>00590         <a class="code" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a> dest_id = <a class="code" href="classBaseBus.html#a16872a256ea6eae168abc47d498841cb">findPort</a>(pkt-&gt;<a class="code" href="classPacket.html#afca9af4d83a57836baba87603463a6e0">getAddr</a>());
<a name="l00591"></a>00591 
<a name="l00592"></a>00592         <a class="code" href="classBaseBus.html#a0f7b2e1619b03085b0a28bb3216cd562">masterPorts</a>[dest_id]-&gt;sendFunctional(pkt);
<a name="l00593"></a>00593     }
<a name="l00594"></a>00594 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aab366eefcf6b389a308a63c82e7b3116"></a><!-- doxytag: member="CoherentBus::recvFunctionalSnoop" ref="aab366eefcf6b389a308a63c82e7b3116" args="(PacketPtr pkt, PortID master_port_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void recvFunctionalSnoop </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classPacket.html">PacketPtr</a>&nbsp;</td>
          <td class="paramname"> <em>pkt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a>&nbsp;</td>
          <td class="paramname"> <em>master_port_id</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function called by the port when the bus is recieving a functional snoop transaction. </p>

<p><div class="fragment"><pre class="fragment"><a name="l00598"></a>00598 {
<a name="l00599"></a>00599     <span class="keywordflow">if</span> (!pkt-&gt;<a class="code" href="classPacket.html#ae56bb417ddf53e85cb389267590fe969">isPrint</a>()) {
<a name="l00600"></a>00600         <span class="comment">// don&apos;t do DPRINTFs on PrintReq as it clutters up the output</span>
<a name="l00601"></a>00601         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classCoherentBus.html">CoherentBus</a>,
<a name="l00602"></a>00602                 <span class="stringliteral">&quot;recvFunctionalSnoop: packet src %s addr 0x%x cmd %s\n&quot;</span>,
<a name="l00603"></a>00603                 <a class="code" href="classBaseBus.html#a0f7b2e1619b03085b0a28bb3216cd562">masterPorts</a>[master_port_id]-&gt;<a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>(), pkt-&gt;<a class="code" href="classPacket.html#afca9af4d83a57836baba87603463a6e0">getAddr</a>(),
<a name="l00604"></a>00604                 pkt-&gt;<a class="code" href="classPacket.html#a863af57e28a01258236ea303155fc7ff">cmdString</a>());
<a name="l00605"></a>00605     }
<a name="l00606"></a>00606 
<a name="l00607"></a>00607     <span class="comment">// forward to all snoopers</span>
<a name="l00608"></a>00608     <a class="code" href="classCoherentBus.html#a45d5f60100921e96c8635b20cd9e9fab">forwardFunctional</a>(pkt, <a class="code" href="base_2types_8hh.html#a65bf40f138cf863f0c5e2d8ca1144126">InvalidPortID</a>);
<a name="l00609"></a>00609 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a96f9cd33bfb9a8b7fb2b25078eaf75a1"></a><!-- doxytag: member="CoherentBus::recvRetry" ref="a96f9cd33bfb9a8b7fb2b25078eaf75a1" args="(PortID master_port_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void recvRetry </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a>&nbsp;</td>
          <td class="paramname"> <em>master_port_id</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Timing function called by port when it is once again able to process requests. </p>

<p><div class="fragment"><pre class="fragment"><a name="l00444"></a>00444 {
<a name="l00445"></a>00445     <span class="comment">// responses and snoop responses never block on forwarding them,</span>
<a name="l00446"></a>00446     <span class="comment">// so the retry will always be coming from a port to which we</span>
<a name="l00447"></a>00447     <span class="comment">// tried to forward a request</span>
<a name="l00448"></a>00448     <a class="code" href="classCoherentBus.html#ab124575386549f77de080cd9fcaf2ba0">reqLayers</a>[master_port_id]-&gt;recvRetry();
<a name="l00449"></a>00449 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8e2d7ccc3adb605e763f2bd1c64e5128"></a><!-- doxytag: member="CoherentBus::recvTimingReq" ref="a8e2d7ccc3adb605e763f2bd1c64e5128" args="(PacketPtr pkt, PortID slave_port_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool recvTimingReq </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classPacket.html">PacketPtr</a>&nbsp;</td>
          <td class="paramname"> <em>pkt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a>&nbsp;</td>
          <td class="paramname"> <em>slave_port_id</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function called by the port when the bus is recieving a Timing request packet. </p>

<p><div class="fragment"><pre class="fragment"><a name="l00137"></a>00137 {
<a name="l00138"></a>00138     <span class="comment">// determine the source port based on the id</span>
<a name="l00139"></a>00139     <a class="code" href="classSlavePort.html">SlavePort</a> *src_port = <a class="code" href="classBaseBus.html#a9f084bf86a306772d84ad52e839cce97">slavePorts</a>[slave_port_id];
<a name="l00140"></a>00140 
<a name="l00141"></a>00141     <span class="comment">// remember if the packet is an express snoop</span>
<a name="l00142"></a>00142     <span class="keywordtype">bool</span> is_express_snoop = pkt-&gt;<a class="code" href="classPacket.html#aa20026c596161a1efabde68c4a34e00b">isExpressSnoop</a>();
<a name="l00143"></a>00143 
<a name="l00144"></a>00144     <span class="comment">// determine the destination based on the address</span>
<a name="l00145"></a>00145     <a class="code" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a> master_port_id = <a class="code" href="classBaseBus.html#a16872a256ea6eae168abc47d498841cb">findPort</a>(pkt-&gt;<a class="code" href="classPacket.html#afca9af4d83a57836baba87603463a6e0">getAddr</a>());
<a name="l00146"></a>00146 
<a name="l00147"></a>00147     <span class="comment">// test if the bus should be considered occupied for the current</span>
<a name="l00148"></a>00148     <span class="comment">// port, and exclude express snoops from the check</span>
<a name="l00149"></a>00149     <span class="keywordflow">if</span> (!is_express_snoop &amp;&amp; !<a class="code" href="classCoherentBus.html#ab124575386549f77de080cd9fcaf2ba0">reqLayers</a>[master_port_id]-&gt;tryTiming(src_port)) {
<a name="l00150"></a>00150         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classCoherentBus.html">CoherentBus</a>, <span class="stringliteral">&quot;recvTimingReq: src %s %s 0x%x BUS BUSY\n&quot;</span>,
<a name="l00151"></a>00151                 src_port-&gt;<a class="code" href="classPort.html#a6490f765a824ced1cc94979609fe7e07">name</a>(), pkt-&gt;<a class="code" href="classPacket.html#a863af57e28a01258236ea303155fc7ff">cmdString</a>(), pkt-&gt;<a class="code" href="classPacket.html#afca9af4d83a57836baba87603463a6e0">getAddr</a>());
<a name="l00152"></a>00152         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00153"></a>00153     }
<a name="l00154"></a>00154 
<a name="l00155"></a>00155     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classCoherentBus.html">CoherentBus</a>, <span class="stringliteral">&quot;recvTimingReq: src %s %s expr %d 0x%x\n&quot;</span>,
<a name="l00156"></a>00156             src_port-&gt;<a class="code" href="classPort.html#a6490f765a824ced1cc94979609fe7e07">name</a>(), pkt-&gt;<a class="code" href="classPacket.html#a863af57e28a01258236ea303155fc7ff">cmdString</a>(), is_express_snoop,
<a name="l00157"></a>00157             pkt-&gt;<a class="code" href="classPacket.html#afca9af4d83a57836baba87603463a6e0">getAddr</a>());
<a name="l00158"></a>00158 
<a name="l00159"></a>00159     <span class="comment">// store size and command as they might be modified when</span>
<a name="l00160"></a>00160     <span class="comment">// forwarding the packet</span>
<a name="l00161"></a>00161     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pkt_size = pkt-&gt;<a class="code" href="classPacket.html#a0effbd4cf91891700ac41e86defe4aa6">hasData</a>() ? pkt-&gt;<a class="code" href="classPacket.html#a1d18ba49c7be427da1f4a42d53e35f48">getSize</a>() : 0;
<a name="l00162"></a>00162     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pkt_cmd = pkt-&gt;<a class="code" href="classPacket.html#a8db75870e65b9d86793f2805097c05a0" title="Return the index of this command.">cmdToIndex</a>();
<a name="l00163"></a>00163 
<a name="l00164"></a>00164     <span class="comment">// set the source port for routing of the response</span>
<a name="l00165"></a>00165     pkt-&gt;<a class="code" href="classPacket.html#a6e173cf473a751a0e969c1561a4184cc" title="Accessor function to set the source index of the packet.">setSrc</a>(slave_port_id);
<a name="l00166"></a>00166 
<a name="l00167"></a>00167     <a class="code" href="classBaseBus.html#a0e69bf0fe1b87ac59689c3807a942ee7">calcPacketTiming</a>(pkt);
<a name="l00168"></a>00168     <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> packetFinishTime = pkt-&gt;<a class="code" href="classPacket.html#a7bf8ae0a056329f751eda8b39ca4c268">busLastWordDelay</a> + <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The universal simulation clock.">curTick</a>();
<a name="l00169"></a>00169 
<a name="l00170"></a>00170     <span class="comment">// uncacheable requests need never be snooped</span>
<a name="l00171"></a>00171     <span class="keywordflow">if</span> (!pkt-&gt;<a class="code" href="classPacket.html#a956cd41d82347558b9c0a5b0474903f2" title="A pointer to the original request.">req</a>-&gt;<a class="code" href="classRequest.html#a70c74b2809417ea8701dd6ba9e34312d">isUncacheable</a>() &amp;&amp; !<a class="code" href="classCoherentBus.html#af27ccd765f13a4b7bd119dc7579e2746">system</a>-&gt;<a class="code" href="classSystem.html#a613d9d917b0e950cd322026de403d702">bypassCaches</a>()) {
<a name="l00172"></a>00172         <span class="comment">// the packet is a memory-mapped request and should be</span>
<a name="l00173"></a>00173         <span class="comment">// broadcasted to our snoopers but the source</span>
<a name="l00174"></a>00174         <a class="code" href="classCoherentBus.html#a63303c7524b820a7d0de62c07b097139">forwardTiming</a>(pkt, slave_port_id);
<a name="l00175"></a>00175     }
<a name="l00176"></a>00176 
<a name="l00177"></a>00177     <span class="comment">// remember if we add an outstanding req so we can undo it if</span>
<a name="l00178"></a>00178     <span class="comment">// necessary, if the packet needs a response, we should add it</span>
<a name="l00179"></a>00179     <span class="comment">// as outstanding and express snoops never fail so there is</span>
<a name="l00180"></a>00180     <span class="comment">// not need to worry about them</span>
<a name="l00181"></a>00181     <span class="keywordtype">bool</span> add_outstanding = !is_express_snoop &amp;&amp; pkt-&gt;<a class="code" href="classPacket.html#a390c6cced05593f0a2c75a38a7a24fa9">needsResponse</a>();
<a name="l00182"></a>00182 
<a name="l00183"></a>00183     <span class="comment">// keep track that we have an outstanding request packet</span>
<a name="l00184"></a>00184     <span class="comment">// matching this request, this is used by the coherency</span>
<a name="l00185"></a>00185     <span class="comment">// mechanism in determining what to do with snoop responses</span>
<a name="l00186"></a>00186     <span class="comment">// (in recvTimingSnoop)</span>
<a name="l00187"></a>00187     <span class="keywordflow">if</span> (add_outstanding) {
<a name="l00188"></a>00188         <span class="comment">// we should never have an exsiting request outstanding</span>
<a name="l00189"></a>00189         assert(<a class="code" href="classCoherentBus.html#a8b5de6798515d1ac1236592c5ad7c521">outstandingReq</a>.find(pkt-&gt;<a class="code" href="classPacket.html#a956cd41d82347558b9c0a5b0474903f2" title="A pointer to the original request.">req</a>) == <a class="code" href="classCoherentBus.html#a8b5de6798515d1ac1236592c5ad7c521">outstandingReq</a>.end());
<a name="l00190"></a>00190         <a class="code" href="classCoherentBus.html#a8b5de6798515d1ac1236592c5ad7c521">outstandingReq</a>.insert(pkt-&gt;<a class="code" href="classPacket.html#a956cd41d82347558b9c0a5b0474903f2" title="A pointer to the original request.">req</a>);
<a name="l00191"></a>00191     }
<a name="l00192"></a>00192 
<a name="l00193"></a>00193     <span class="comment">// since it is a normal request, attempt to send the packet</span>
<a name="l00194"></a>00194     <span class="keywordtype">bool</span> success = <a class="code" href="classBaseBus.html#a0f7b2e1619b03085b0a28bb3216cd562">masterPorts</a>[master_port_id]-&gt;sendTimingReq(pkt);
<a name="l00195"></a>00195 
<a name="l00196"></a>00196     <span class="comment">// if this is an express snoop, we are done at this point</span>
<a name="l00197"></a>00197     <span class="keywordflow">if</span> (is_express_snoop) {
<a name="l00198"></a>00198         assert(success);
<a name="l00199"></a>00199         <a class="code" href="classCoherentBus.html#a576c4936ce7bed70cd1751024670e75f">snoopDataThroughBus</a> += pkt_size;
<a name="l00200"></a>00200     } <span class="keywordflow">else</span> {
<a name="l00201"></a>00201         <span class="comment">// for normal requests, check if successful</span>
<a name="l00202"></a>00202         <span class="keywordflow">if</span> (!success)  {
<a name="l00203"></a>00203             <span class="comment">// inhibited packets should never be forced to retry</span>
<a name="l00204"></a>00204             assert(!pkt-&gt;<a class="code" href="classPacket.html#a9693a1ffeda326646443ab2a2a92be41">memInhibitAsserted</a>());
<a name="l00205"></a>00205 
<a name="l00206"></a>00206             <span class="comment">// if it was added as outstanding and the send failed, then</span>
<a name="l00207"></a>00207             <span class="comment">// erase it again</span>
<a name="l00208"></a>00208             <span class="keywordflow">if</span> (add_outstanding)
<a name="l00209"></a>00209                 <a class="code" href="classCoherentBus.html#a8b5de6798515d1ac1236592c5ad7c521">outstandingReq</a>.erase(pkt-&gt;<a class="code" href="classPacket.html#a956cd41d82347558b9c0a5b0474903f2" title="A pointer to the original request.">req</a>);
<a name="l00210"></a>00210 
<a name="l00211"></a>00211             <span class="comment">// undo the calculation so we can check for 0 again</span>
<a name="l00212"></a>00212             pkt-&gt;<a class="code" href="classPacket.html#af8986a05caa6c5b96b0b01bb6cf47772">busFirstWordDelay</a> = pkt-&gt;<a class="code" href="classPacket.html#a7bf8ae0a056329f751eda8b39ca4c268">busLastWordDelay</a> = 0;
<a name="l00213"></a>00213 
<a name="l00214"></a>00214             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classCoherentBus.html">CoherentBus</a>, <span class="stringliteral">&quot;recvTimingReq: src %s %s 0x%x RETRY\n&quot;</span>,
<a name="l00215"></a>00215                     src_port-&gt;<a class="code" href="classPort.html#a6490f765a824ced1cc94979609fe7e07">name</a>(), pkt-&gt;<a class="code" href="classPacket.html#a863af57e28a01258236ea303155fc7ff">cmdString</a>(), pkt-&gt;<a class="code" href="classPacket.html#afca9af4d83a57836baba87603463a6e0">getAddr</a>());
<a name="l00216"></a>00216 
<a name="l00217"></a>00217             <span class="comment">// update the bus state and schedule an idle event</span>
<a name="l00218"></a>00218             <a class="code" href="classCoherentBus.html#ab124575386549f77de080cd9fcaf2ba0">reqLayers</a>[master_port_id]-&gt;failedTiming(src_port,
<a name="l00219"></a>00219                                                     <a class="code" href="classClockedObject.html#a773956693f216cafb7d4cad92ad582e5">clockEdge</a>(<a class="code" href="classBaseBus.html#ab9c87c91aa592a3542152117cdb99c9b">headerCycles</a>));
<a name="l00220"></a>00220         } <span class="keywordflow">else</span> {
<a name="l00221"></a>00221             <span class="comment">// update the bus state and schedule an idle event</span>
<a name="l00222"></a>00222             <a class="code" href="classCoherentBus.html#ab124575386549f77de080cd9fcaf2ba0">reqLayers</a>[master_port_id]-&gt;succeededTiming(packetFinishTime);
<a name="l00223"></a>00223             <a class="code" href="classCoherentBus.html#a7040fa8d9fb24afb9f4fe245b135da19">dataThroughBus</a> += pkt_size;
<a name="l00224"></a>00224         }
<a name="l00225"></a>00225     }
<a name="l00226"></a>00226 
<a name="l00227"></a>00227     <span class="comment">// stats updates only consider packets that were successfully sent</span>
<a name="l00228"></a>00228     <span class="keywordflow">if</span> (success) {
<a name="l00229"></a>00229         <a class="code" href="classBaseBus.html#a1444e1d672a8bfe518b9c3d05412985a">pktCount</a>[slave_port_id][master_port_id]++;
<a name="l00230"></a>00230         <a class="code" href="classBaseBus.html#a1b2222f1cfbd8c191ad8d1099fd24848">totPktSize</a>[slave_port_id][master_port_id] += pkt_size;
<a name="l00231"></a>00231         <a class="code" href="classBaseBus.html#a3eb88cd36449bb56229422858d34194d">transDist</a>[pkt_cmd]++;
<a name="l00232"></a>00232     }
<a name="l00233"></a>00233 
<a name="l00234"></a>00234     <span class="keywordflow">return</span> success;
<a name="l00235"></a>00235 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a47ba09f9a3b3998cac9c14ab596a7515"></a><!-- doxytag: member="CoherentBus::recvTimingResp" ref="a47ba09f9a3b3998cac9c14ab596a7515" args="(PacketPtr pkt, PortID master_port_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool recvTimingResp </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classPacket.html">PacketPtr</a>&nbsp;</td>
          <td class="paramname"> <em>pkt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a>&nbsp;</td>
          <td class="paramname"> <em>master_port_id</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function called by the port when the bus is recieving a Timing response packet. </p>

<p><div class="fragment"><pre class="fragment"><a name="l00239"></a>00239 {
<a name="l00240"></a>00240     <span class="comment">// determine the source port based on the id</span>
<a name="l00241"></a>00241     <a class="code" href="classMasterPort.html">MasterPort</a> *src_port = <a class="code" href="classBaseBus.html#a0f7b2e1619b03085b0a28bb3216cd562">masterPorts</a>[master_port_id];
<a name="l00242"></a>00242 
<a name="l00243"></a>00243     <span class="comment">// determine the destination based on what is stored in the packet</span>
<a name="l00244"></a>00244     <a class="code" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a> slave_port_id = pkt-&gt;<a class="code" href="classPacket.html#a8c4564a96830dffcc13f56b716afa674" title="Accessor function for the destination index of the packet.">getDest</a>();
<a name="l00245"></a>00245 
<a name="l00246"></a>00246     <span class="comment">// test if the bus should be considered occupied for the current</span>
<a name="l00247"></a>00247     <span class="comment">// port</span>
<a name="l00248"></a>00248     <span class="keywordflow">if</span> (!<a class="code" href="classCoherentBus.html#a2f42dda70e78f1e5e9574f11b465d173">respLayers</a>[slave_port_id]-&gt;tryTiming(src_port)) {
<a name="l00249"></a>00249         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classCoherentBus.html">CoherentBus</a>, <span class="stringliteral">&quot;recvTimingResp: src %s %s 0x%x BUSY\n&quot;</span>,
<a name="l00250"></a>00250                 src_port-&gt;<a class="code" href="classPort.html#a6490f765a824ced1cc94979609fe7e07">name</a>(), pkt-&gt;<a class="code" href="classPacket.html#a863af57e28a01258236ea303155fc7ff">cmdString</a>(), pkt-&gt;<a class="code" href="classPacket.html#afca9af4d83a57836baba87603463a6e0">getAddr</a>());
<a name="l00251"></a>00251         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00252"></a>00252     }
<a name="l00253"></a>00253 
<a name="l00254"></a>00254     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classCoherentBus.html">CoherentBus</a>, <span class="stringliteral">&quot;recvTimingResp: src %s %s 0x%x\n&quot;</span>,
<a name="l00255"></a>00255             src_port-&gt;<a class="code" href="classPort.html#a6490f765a824ced1cc94979609fe7e07">name</a>(), pkt-&gt;<a class="code" href="classPacket.html#a863af57e28a01258236ea303155fc7ff">cmdString</a>(), pkt-&gt;<a class="code" href="classPacket.html#afca9af4d83a57836baba87603463a6e0">getAddr</a>());
<a name="l00256"></a>00256 
<a name="l00257"></a>00257     <span class="comment">// store size and command as they might be modified when</span>
<a name="l00258"></a>00258     <span class="comment">// forwarding the packet</span>
<a name="l00259"></a>00259     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pkt_size = pkt-&gt;<a class="code" href="classPacket.html#a0effbd4cf91891700ac41e86defe4aa6">hasData</a>() ? pkt-&gt;<a class="code" href="classPacket.html#a1d18ba49c7be427da1f4a42d53e35f48">getSize</a>() : 0;
<a name="l00260"></a>00260     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pkt_cmd = pkt-&gt;<a class="code" href="classPacket.html#a8db75870e65b9d86793f2805097c05a0" title="Return the index of this command.">cmdToIndex</a>();
<a name="l00261"></a>00261 
<a name="l00262"></a>00262     <a class="code" href="classBaseBus.html#a0e69bf0fe1b87ac59689c3807a942ee7">calcPacketTiming</a>(pkt);
<a name="l00263"></a>00263     <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> packetFinishTime = pkt-&gt;<a class="code" href="classPacket.html#a7bf8ae0a056329f751eda8b39ca4c268">busLastWordDelay</a> + <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The universal simulation clock.">curTick</a>();
<a name="l00264"></a>00264 
<a name="l00265"></a>00265     <span class="comment">// the packet is a normal response to a request that we should</span>
<a name="l00266"></a>00266     <span class="comment">// have seen passing through the bus</span>
<a name="l00267"></a>00267     assert(<a class="code" href="classCoherentBus.html#a8b5de6798515d1ac1236592c5ad7c521">outstandingReq</a>.find(pkt-&gt;<a class="code" href="classPacket.html#a956cd41d82347558b9c0a5b0474903f2" title="A pointer to the original request.">req</a>) != <a class="code" href="classCoherentBus.html#a8b5de6798515d1ac1236592c5ad7c521">outstandingReq</a>.end());
<a name="l00268"></a>00268 
<a name="l00269"></a>00269     <span class="comment">// remove it as outstanding</span>
<a name="l00270"></a>00270     <a class="code" href="classCoherentBus.html#a8b5de6798515d1ac1236592c5ad7c521">outstandingReq</a>.erase(pkt-&gt;<a class="code" href="classPacket.html#a956cd41d82347558b9c0a5b0474903f2" title="A pointer to the original request.">req</a>);
<a name="l00271"></a>00271 
<a name="l00272"></a>00272     <span class="comment">// send the packet through the destination slave port</span>
<a name="l00273"></a>00273     <span class="keywordtype">bool</span> success M5_VAR_USED = <a class="code" href="classBaseBus.html#a9f084bf86a306772d84ad52e839cce97">slavePorts</a>[slave_port_id]-&gt;sendTimingResp(pkt);
<a name="l00274"></a>00274 
<a name="l00275"></a>00275     <span class="comment">// currently it is illegal to block responses... can lead to</span>
<a name="l00276"></a>00276     <span class="comment">// deadlock</span>
<a name="l00277"></a>00277     assert(success);
<a name="l00278"></a>00278 
<a name="l00279"></a>00279     <a class="code" href="classCoherentBus.html#a2f42dda70e78f1e5e9574f11b465d173">respLayers</a>[slave_port_id]-&gt;succeededTiming(packetFinishTime);
<a name="l00280"></a>00280 
<a name="l00281"></a>00281     <span class="comment">// stats updates</span>
<a name="l00282"></a>00282     <a class="code" href="classCoherentBus.html#a7040fa8d9fb24afb9f4fe245b135da19">dataThroughBus</a> += pkt_size;
<a name="l00283"></a>00283     <a class="code" href="classBaseBus.html#a1444e1d672a8bfe518b9c3d05412985a">pktCount</a>[slave_port_id][master_port_id]++;
<a name="l00284"></a>00284     <a class="code" href="classBaseBus.html#a1b2222f1cfbd8c191ad8d1099fd24848">totPktSize</a>[slave_port_id][master_port_id] += pkt_size;
<a name="l00285"></a>00285     <a class="code" href="classBaseBus.html#a3eb88cd36449bb56229422858d34194d">transDist</a>[pkt_cmd]++;
<a name="l00286"></a>00286 
<a name="l00287"></a>00287     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00288"></a>00288 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8a06090652319e21031b8bc2f8018e2b"></a><!-- doxytag: member="CoherentBus::recvTimingSnoopReq" ref="a8a06090652319e21031b8bc2f8018e2b" args="(PacketPtr pkt, PortID master_port_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void recvTimingSnoopReq </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classPacket.html">PacketPtr</a>&nbsp;</td>
          <td class="paramname"> <em>pkt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a>&nbsp;</td>
          <td class="paramname"> <em>master_port_id</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function called by the port when the bus is recieving a timing snoop request. </p>

<p><div class="fragment"><pre class="fragment"><a name="l00292"></a>00292 {
<a name="l00293"></a>00293     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classCoherentBus.html">CoherentBus</a>, <span class="stringliteral">&quot;recvTimingSnoopReq: src %s %s 0x%x\n&quot;</span>,
<a name="l00294"></a>00294             <a class="code" href="classBaseBus.html#a0f7b2e1619b03085b0a28bb3216cd562">masterPorts</a>[master_port_id]-&gt;<a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>(), pkt-&gt;<a class="code" href="classPacket.html#a863af57e28a01258236ea303155fc7ff">cmdString</a>(),
<a name="l00295"></a>00295             pkt-&gt;<a class="code" href="classPacket.html#afca9af4d83a57836baba87603463a6e0">getAddr</a>());
<a name="l00296"></a>00296 
<a name="l00297"></a>00297     <span class="comment">// update stats here as we know the forwarding will succeed</span>
<a name="l00298"></a>00298     <a class="code" href="classBaseBus.html#a3eb88cd36449bb56229422858d34194d">transDist</a>[pkt-&gt;<a class="code" href="classPacket.html#a8db75870e65b9d86793f2805097c05a0" title="Return the index of this command.">cmdToIndex</a>()]++;
<a name="l00299"></a>00299     <a class="code" href="classCoherentBus.html#a576c4936ce7bed70cd1751024670e75f">snoopDataThroughBus</a> += pkt-&gt;<a class="code" href="classPacket.html#a0effbd4cf91891700ac41e86defe4aa6">hasData</a>() ? pkt-&gt;<a class="code" href="classPacket.html#a1d18ba49c7be427da1f4a42d53e35f48">getSize</a>() : 0;
<a name="l00300"></a>00300 
<a name="l00301"></a>00301     <span class="comment">// we should only see express snoops from caches</span>
<a name="l00302"></a>00302     assert(pkt-&gt;<a class="code" href="classPacket.html#aa20026c596161a1efabde68c4a34e00b">isExpressSnoop</a>());
<a name="l00303"></a>00303 
<a name="l00304"></a>00304     <span class="comment">// set the source port for routing of the response</span>
<a name="l00305"></a>00305     pkt-&gt;<a class="code" href="classPacket.html#a6e173cf473a751a0e969c1561a4184cc" title="Accessor function to set the source index of the packet.">setSrc</a>(master_port_id);
<a name="l00306"></a>00306 
<a name="l00307"></a>00307     <span class="comment">// forward to all snoopers</span>
<a name="l00308"></a>00308     <a class="code" href="classCoherentBus.html#a63303c7524b820a7d0de62c07b097139">forwardTiming</a>(pkt, <a class="code" href="base_2types_8hh.html#a65bf40f138cf863f0c5e2d8ca1144126">InvalidPortID</a>);
<a name="l00309"></a>00309 
<a name="l00310"></a>00310     <span class="comment">// a snoop request came from a connected slave device (one of</span>
<a name="l00311"></a>00311     <span class="comment">// our master ports), and if it is not coming from the slave</span>
<a name="l00312"></a>00312     <span class="comment">// device responsible for the address range something is</span>
<a name="l00313"></a>00313     <span class="comment">// wrong, hence there is nothing further to do as the packet</span>
<a name="l00314"></a>00314     <span class="comment">// would be going back to where it came from</span>
<a name="l00315"></a>00315     assert(master_port_id == <a class="code" href="classBaseBus.html#a16872a256ea6eae168abc47d498841cb">findPort</a>(pkt-&gt;<a class="code" href="classPacket.html#afca9af4d83a57836baba87603463a6e0">getAddr</a>()));
<a name="l00316"></a>00316 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a29d5427944c6a4e363cf42eb70f480b1"></a><!-- doxytag: member="CoherentBus::recvTimingSnoopResp" ref="a29d5427944c6a4e363cf42eb70f480b1" args="(PacketPtr pkt, PortID slave_port_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool recvTimingSnoopResp </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classPacket.html">PacketPtr</a>&nbsp;</td>
          <td class="paramname"> <em>pkt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a>&nbsp;</td>
          <td class="paramname"> <em>slave_port_id</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function called by the port when the bus is recieving a timing snoop response. </p>

<p><div class="fragment"><pre class="fragment"><a name="l00320"></a>00320 {
<a name="l00321"></a>00321     <span class="comment">// determine the source port based on the id</span>
<a name="l00322"></a>00322     <a class="code" href="classSlavePort.html">SlavePort</a>* src_port = <a class="code" href="classBaseBus.html#a9f084bf86a306772d84ad52e839cce97">slavePorts</a>[slave_port_id];
<a name="l00323"></a>00323 
<a name="l00324"></a>00324     <span class="comment">// get the destination from the packet</span>
<a name="l00325"></a>00325     <a class="code" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a> dest_port_id = pkt-&gt;<a class="code" href="classPacket.html#a8c4564a96830dffcc13f56b716afa674" title="Accessor function for the destination index of the packet.">getDest</a>();
<a name="l00326"></a>00326 
<a name="l00327"></a>00327     <span class="comment">// determine if the response is from a snoop request we</span>
<a name="l00328"></a>00328     <span class="comment">// created as the result of a normal request (in which case it</span>
<a name="l00329"></a>00329     <span class="comment">// should be in the outstandingReq), or if we merely forwarded</span>
<a name="l00330"></a>00330     <span class="comment">// someone else&apos;s snoop request</span>
<a name="l00331"></a>00331     <span class="keywordtype">bool</span> forwardAsSnoop = <a class="code" href="classCoherentBus.html#a8b5de6798515d1ac1236592c5ad7c521">outstandingReq</a>.find(pkt-&gt;<a class="code" href="classPacket.html#a956cd41d82347558b9c0a5b0474903f2" title="A pointer to the original request.">req</a>) ==
<a name="l00332"></a>00332         <a class="code" href="classCoherentBus.html#a8b5de6798515d1ac1236592c5ad7c521">outstandingReq</a>.end();
<a name="l00333"></a>00333 
<a name="l00334"></a>00334     <span class="comment">// test if the bus should be considered occupied for the current</span>
<a name="l00335"></a>00335     <span class="comment">// port, note that the check is bypassed if the response is being</span>
<a name="l00336"></a>00336     <span class="comment">// passed on as a normal response since this is occupying the</span>
<a name="l00337"></a>00337     <span class="comment">// response layer rather than the snoop response layer</span>
<a name="l00338"></a>00338     <span class="keywordflow">if</span> (forwardAsSnoop) {
<a name="l00339"></a>00339         <span class="keywordflow">if</span> (!<a class="code" href="classCoherentBus.html#ae6f8cf70846d8ee4b2314816863efbca">snoopLayers</a>[dest_port_id]-&gt;tryTiming(src_port)) {
<a name="l00340"></a>00340             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classCoherentBus.html">CoherentBus</a>, <span class="stringliteral">&quot;recvTimingSnoopResp: src %s %s 0x%x BUSY\n&quot;</span>,
<a name="l00341"></a>00341                     src_port-&gt;<a class="code" href="classPort.html#a6490f765a824ced1cc94979609fe7e07">name</a>(), pkt-&gt;<a class="code" href="classPacket.html#a863af57e28a01258236ea303155fc7ff">cmdString</a>(), pkt-&gt;<a class="code" href="classPacket.html#afca9af4d83a57836baba87603463a6e0">getAddr</a>());
<a name="l00342"></a>00342             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00343"></a>00343         }
<a name="l00344"></a>00344     } <span class="keywordflow">else</span> {
<a name="l00345"></a>00345         <span class="comment">// get the master port that mirrors this slave port internally</span>
<a name="l00346"></a>00346         <a class="code" href="classMasterPort.html">MasterPort</a>* snoop_port = <a class="code" href="classCoherentBus.html#ae876574c554fa099bcd063e2e188b95b">snoopRespPorts</a>[slave_port_id];
<a name="l00347"></a>00347         <span class="keywordflow">if</span> (!<a class="code" href="classCoherentBus.html#a2f42dda70e78f1e5e9574f11b465d173">respLayers</a>[dest_port_id]-&gt;tryTiming(snoop_port)) {
<a name="l00348"></a>00348             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classCoherentBus.html">CoherentBus</a>, <span class="stringliteral">&quot;recvTimingSnoopResp: src %s %s 0x%x BUSY\n&quot;</span>,
<a name="l00349"></a>00349                     snoop_port-&gt;<a class="code" href="classPort.html#a6490f765a824ced1cc94979609fe7e07">name</a>(), pkt-&gt;<a class="code" href="classPacket.html#a863af57e28a01258236ea303155fc7ff">cmdString</a>(), pkt-&gt;<a class="code" href="classPacket.html#afca9af4d83a57836baba87603463a6e0">getAddr</a>());
<a name="l00350"></a>00350             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00351"></a>00351         }
<a name="l00352"></a>00352     }
<a name="l00353"></a>00353 
<a name="l00354"></a>00354     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classCoherentBus.html">CoherentBus</a>, <span class="stringliteral">&quot;recvTimingSnoopResp: src %s %s 0x%x\n&quot;</span>,
<a name="l00355"></a>00355             src_port-&gt;<a class="code" href="classPort.html#a6490f765a824ced1cc94979609fe7e07">name</a>(), pkt-&gt;<a class="code" href="classPacket.html#a863af57e28a01258236ea303155fc7ff">cmdString</a>(), pkt-&gt;<a class="code" href="classPacket.html#afca9af4d83a57836baba87603463a6e0">getAddr</a>());
<a name="l00356"></a>00356 
<a name="l00357"></a>00357     <span class="comment">// store size and command as they might be modified when</span>
<a name="l00358"></a>00358     <span class="comment">// forwarding the packet</span>
<a name="l00359"></a>00359     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pkt_size = pkt-&gt;<a class="code" href="classPacket.html#a0effbd4cf91891700ac41e86defe4aa6">hasData</a>() ? pkt-&gt;<a class="code" href="classPacket.html#a1d18ba49c7be427da1f4a42d53e35f48">getSize</a>() : 0;
<a name="l00360"></a>00360     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pkt_cmd = pkt-&gt;<a class="code" href="classPacket.html#a8db75870e65b9d86793f2805097c05a0" title="Return the index of this command.">cmdToIndex</a>();
<a name="l00361"></a>00361 
<a name="l00362"></a>00362     <span class="comment">// responses are never express snoops</span>
<a name="l00363"></a>00363     assert(!pkt-&gt;<a class="code" href="classPacket.html#aa20026c596161a1efabde68c4a34e00b">isExpressSnoop</a>());
<a name="l00364"></a>00364 
<a name="l00365"></a>00365     <a class="code" href="classBaseBus.html#a0e69bf0fe1b87ac59689c3807a942ee7">calcPacketTiming</a>(pkt);
<a name="l00366"></a>00366     <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> packetFinishTime = pkt-&gt;<a class="code" href="classPacket.html#a7bf8ae0a056329f751eda8b39ca4c268">busLastWordDelay</a> + <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The universal simulation clock.">curTick</a>();
<a name="l00367"></a>00367 
<a name="l00368"></a>00368     <span class="comment">// forward it either as a snoop response or a normal response</span>
<a name="l00369"></a>00369     <span class="keywordflow">if</span> (forwardAsSnoop) {
<a name="l00370"></a>00370         <span class="comment">// this is a snoop response to a snoop request we forwarded,</span>
<a name="l00371"></a>00371         <span class="comment">// e.g. coming from the L1 and going to the L2, and it should</span>
<a name="l00372"></a>00372         <span class="comment">// be forwarded as a snoop response</span>
<a name="l00373"></a>00373         <span class="keywordtype">bool</span> success M5_VAR_USED =
<a name="l00374"></a>00374             <a class="code" href="classBaseBus.html#a0f7b2e1619b03085b0a28bb3216cd562">masterPorts</a>[dest_port_id]-&gt;sendTimingSnoopResp(pkt);
<a name="l00375"></a>00375         <a class="code" href="classBaseBus.html#a1444e1d672a8bfe518b9c3d05412985a">pktCount</a>[slave_port_id][dest_port_id]++;
<a name="l00376"></a>00376         <a class="code" href="classBaseBus.html#a1b2222f1cfbd8c191ad8d1099fd24848">totPktSize</a>[slave_port_id][dest_port_id] += pkt_size;
<a name="l00377"></a>00377         assert(success);
<a name="l00378"></a>00378 
<a name="l00379"></a>00379         <a class="code" href="classCoherentBus.html#ae6f8cf70846d8ee4b2314816863efbca">snoopLayers</a>[dest_port_id]-&gt;succeededTiming(packetFinishTime);
<a name="l00380"></a>00380     } <span class="keywordflow">else</span> {
<a name="l00381"></a>00381         <span class="comment">// we got a snoop response on one of our slave ports,</span>
<a name="l00382"></a>00382         <span class="comment">// i.e. from a coherent master connected to the bus, and</span>
<a name="l00383"></a>00383         <span class="comment">// since we created the snoop request as part of</span>
<a name="l00384"></a>00384         <span class="comment">// recvTiming, this should now be a normal response again</span>
<a name="l00385"></a>00385         <a class="code" href="classCoherentBus.html#a8b5de6798515d1ac1236592c5ad7c521">outstandingReq</a>.erase(pkt-&gt;<a class="code" href="classPacket.html#a956cd41d82347558b9c0a5b0474903f2" title="A pointer to the original request.">req</a>);
<a name="l00386"></a>00386 
<a name="l00387"></a>00387         <span class="comment">// this is a snoop response from a coherent master, with a</span>
<a name="l00388"></a>00388         <span class="comment">// destination field set on its way through the bus as</span>
<a name="l00389"></a>00389         <span class="comment">// request, hence it should never go back to where the</span>
<a name="l00390"></a>00390         <span class="comment">// snoop response came from, but instead to where the</span>
<a name="l00391"></a>00391         <span class="comment">// original request came from</span>
<a name="l00392"></a>00392         assert(slave_port_id != dest_port_id);
<a name="l00393"></a>00393 
<a name="l00394"></a>00394         <span class="comment">// as a normal response, it should go back to a master through</span>
<a name="l00395"></a>00395         <span class="comment">// one of our slave ports, at this point we are ignoring the</span>
<a name="l00396"></a>00396         <span class="comment">// fact that the response layer could be busy and do not touch</span>
<a name="l00397"></a>00397         <span class="comment">// its state</span>
<a name="l00398"></a>00398         <span class="keywordtype">bool</span> success M5_VAR_USED =
<a name="l00399"></a>00399             <a class="code" href="classBaseBus.html#a9f084bf86a306772d84ad52e839cce97">slavePorts</a>[dest_port_id]-&gt;sendTimingResp(pkt);
<a name="l00400"></a>00400 
<a name="l00401"></a>00401         <span class="comment">// @todo Put the response in an internal FIFO and pass it on</span>
<a name="l00402"></a>00402         <span class="comment">// to the response layer from there</span>
<a name="l00403"></a>00403 
<a name="l00404"></a>00404         <span class="comment">// currently it is illegal to block responses... can lead</span>
<a name="l00405"></a>00405         <span class="comment">// to deadlock</span>
<a name="l00406"></a>00406         assert(success);
<a name="l00407"></a>00407 
<a name="l00408"></a>00408         <a class="code" href="classCoherentBus.html#a2f42dda70e78f1e5e9574f11b465d173">respLayers</a>[dest_port_id]-&gt;succeededTiming(packetFinishTime);
<a name="l00409"></a>00409     }
<a name="l00410"></a>00410 
<a name="l00411"></a>00411     <span class="comment">// stats updates</span>
<a name="l00412"></a>00412     <a class="code" href="classBaseBus.html#a3eb88cd36449bb56229422858d34194d">transDist</a>[pkt_cmd]++;
<a name="l00413"></a>00413     <a class="code" href="classCoherentBus.html#a576c4936ce7bed70cd1751024670e75f">snoopDataThroughBus</a> += pkt_size;
<a name="l00414"></a>00414 
<a name="l00415"></a>00415     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00416"></a>00416 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4dc637449366fcdfc4e764cdf12d9b11"></a><!-- doxytag: member="CoherentBus::regStats" ref="a4dc637449366fcdfc4e764cdf12d9b11" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void regStats </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p><a class="el" href="classRegister.html">Register</a> statistics for this object. </p>

<p><a class="el" href="classBaseBus.html#a4dc637449366fcdfc4e764cdf12d9b11">BaseBus</a>を再定義しています。</p>

<p><div class="fragment"><pre class="fragment"><a name="l00650"></a>00650 {
<a name="l00651"></a>00651     <span class="comment">// register the stats of the base class and our three bus layers</span>
<a name="l00652"></a>00652     <a class="code" href="classCoherentBus.html#a4dc637449366fcdfc4e764cdf12d9b11">BaseBus::regStats</a>();
<a name="l00653"></a>00653     <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="namespaceMipsISA.html#a5818de049c10ffd7c1fea7d4dd69ed5c">l</a> = <a class="code" href="classCoherentBus.html#ab124575386549f77de080cd9fcaf2ba0">reqLayers</a>.begin(); <a class="code" href="namespaceMipsISA.html#a5818de049c10ffd7c1fea7d4dd69ed5c">l</a> != <a class="code" href="classCoherentBus.html#ab124575386549f77de080cd9fcaf2ba0">reqLayers</a>.end(); ++<a class="code" href="namespaceMipsISA.html#a5818de049c10ffd7c1fea7d4dd69ed5c">l</a>)
<a name="l00654"></a>00654         (*l)-&gt;regStats();
<a name="l00655"></a>00655     <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="namespaceMipsISA.html#a5818de049c10ffd7c1fea7d4dd69ed5c">l</a> = <a class="code" href="classCoherentBus.html#a2f42dda70e78f1e5e9574f11b465d173">respLayers</a>.begin(); <a class="code" href="namespaceMipsISA.html#a5818de049c10ffd7c1fea7d4dd69ed5c">l</a> != <a class="code" href="classCoherentBus.html#a2f42dda70e78f1e5e9574f11b465d173">respLayers</a>.end(); ++<a class="code" href="namespaceMipsISA.html#a5818de049c10ffd7c1fea7d4dd69ed5c">l</a>)
<a name="l00656"></a>00656         (*l)-&gt;regStats();
<a name="l00657"></a>00657     <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="namespaceMipsISA.html#a5818de049c10ffd7c1fea7d4dd69ed5c">l</a> = <a class="code" href="classCoherentBus.html#ae6f8cf70846d8ee4b2314816863efbca">snoopLayers</a>.begin(); <a class="code" href="namespaceMipsISA.html#a5818de049c10ffd7c1fea7d4dd69ed5c">l</a> != <a class="code" href="classCoherentBus.html#ae6f8cf70846d8ee4b2314816863efbca">snoopLayers</a>.end(); ++<a class="code" href="namespaceMipsISA.html#a5818de049c10ffd7c1fea7d4dd69ed5c">l</a>)
<a name="l00658"></a>00658         (*l)-&gt;regStats();
<a name="l00659"></a>00659 
<a name="l00660"></a>00660     <a class="code" href="classCoherentBus.html#a7040fa8d9fb24afb9f4fe245b135da19">dataThroughBus</a>
<a name="l00661"></a>00661         .<a class="code" href="classStats_1_1DataWrap.html#a8eaf5c2b92132dfcacd7d9b10afb1726">name</a>(<a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>() + <span class="stringliteral">&quot;.data_through_bus&quot;</span>)
<a name="l00662"></a>00662         .desc(<span class="stringliteral">&quot;Total data (bytes)&quot;</span>)
<a name="l00663"></a>00663         ;
<a name="l00664"></a>00664 
<a name="l00665"></a>00665     <a class="code" href="classCoherentBus.html#a576c4936ce7bed70cd1751024670e75f">snoopDataThroughBus</a>
<a name="l00666"></a>00666         .<a class="code" href="classStats_1_1DataWrap.html#a8eaf5c2b92132dfcacd7d9b10afb1726">name</a>(<a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>() + <span class="stringliteral">&quot;.snoop_data_through_bus&quot;</span>)
<a name="l00667"></a>00667         .desc(<span class="stringliteral">&quot;Total snoop data (bytes)&quot;</span>)
<a name="l00668"></a>00668     ;
<a name="l00669"></a>00669 
<a name="l00670"></a>00670     <a class="code" href="classBaseBus.html#ac7ddaff47c2ff8945ba85797af602673">throughput</a>
<a name="l00671"></a>00671         .<a class="code" href="classStats_1_1DataWrap.html#a8eaf5c2b92132dfcacd7d9b10afb1726">name</a>(<a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>() + <span class="stringliteral">&quot;.throughput&quot;</span>)
<a name="l00672"></a>00672         .desc(<span class="stringliteral">&quot;Throughput (bytes/s)&quot;</span>)
<a name="l00673"></a>00673         .precision(0)
<a name="l00674"></a>00674         ;
<a name="l00675"></a>00675 
<a name="l00676"></a>00676     <a class="code" href="classBaseBus.html#ac7ddaff47c2ff8945ba85797af602673">throughput</a> = (<a class="code" href="classCoherentBus.html#a7040fa8d9fb24afb9f4fe245b135da19">dataThroughBus</a> + <a class="code" href="classCoherentBus.html#a576c4936ce7bed70cd1751024670e75f">snoopDataThroughBus</a>) / <a class="code" href="stat__control_8cc.html#aaad77dbb4162ef5a66c24dcd1ce256d0">simSeconds</a>;
<a name="l00677"></a>00677 }
</pre></div></p>

</div>
</div>
<hr/><h2>変数</h2>
<a class="anchor" id="a7040fa8d9fb24afb9f4fe245b135da19"></a><!-- doxytag: member="CoherentBus::dataThroughBus" ref="a7040fa8d9fb24afb9f4fe245b135da19" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classStats_1_1Scalar.html">Stats::Scalar</a> <a class="el" href="classCoherentBus.html#a7040fa8d9fb24afb9f4fe245b135da19">dataThroughBus</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a8b5de6798515d1ac1236592c5ad7c521"></a><!-- doxytag: member="CoherentBus::outstandingReq" ref="a8b5de6798515d1ac1236592c5ad7c521" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">m5::hash_set&lt;<a class="el" href="classRequest.html">RequestPtr</a>&gt; <a class="el" href="classCoherentBus.html#a8b5de6798515d1ac1236592c5ad7c521">outstandingReq</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Store the outstanding requests so we can determine which ones we generated and which ones were merely forwarded. This is used in the coherent bus when coherency responses come back. </p>

</div>
</div>
<a class="anchor" id="ab124575386549f77de080cd9fcaf2ba0"></a><!-- doxytag: member="CoherentBus::reqLayers" ref="ab124575386549f77de080cd9fcaf2ba0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classstd_1_1vector.html">std::vector</a>&lt;<a class="el" href="classBaseBus_1_1Layer.html">ReqLayer</a>*&gt; <a class="el" href="classCoherentBus.html#ab124575386549f77de080cd9fcaf2ba0">reqLayers</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a2f42dda70e78f1e5e9574f11b465d173"></a><!-- doxytag: member="CoherentBus::respLayers" ref="a2f42dda70e78f1e5e9574f11b465d173" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classstd_1_1vector.html">std::vector</a>&lt;<a class="el" href="classBaseBus_1_1Layer.html">RespLayer</a>*&gt; <a class="el" href="classCoherentBus.html#a2f42dda70e78f1e5e9574f11b465d173">respLayers</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a576c4936ce7bed70cd1751024670e75f"></a><!-- doxytag: member="CoherentBus::snoopDataThroughBus" ref="a576c4936ce7bed70cd1751024670e75f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classStats_1_1Scalar.html">Stats::Scalar</a> <a class="el" href="classCoherentBus.html#a576c4936ce7bed70cd1751024670e75f">snoopDataThroughBus</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ae6f8cf70846d8ee4b2314816863efbca"></a><!-- doxytag: member="CoherentBus::snoopLayers" ref="ae6f8cf70846d8ee4b2314816863efbca" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classstd_1_1vector.html">std::vector</a>&lt;<a class="el" href="classBaseBus_1_1Layer.html">SnoopLayer</a>*&gt; <a class="el" href="classCoherentBus.html#ae6f8cf70846d8ee4b2314816863efbca">snoopLayers</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="acdbc947756de5f5071b88ce0702d557d"></a><!-- doxytag: member="CoherentBus::snoopPorts" ref="acdbc947756de5f5071b88ce0702d557d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classstd_1_1vector.html">std::vector</a>&lt;<a class="el" href="classSlavePort.html">SlavePort</a>*&gt; <a class="el" href="classCoherentBus.html#acdbc947756de5f5071b88ce0702d557d">snoopPorts</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ae876574c554fa099bcd063e2e188b95b"></a><!-- doxytag: member="CoherentBus::snoopRespPorts" ref="ae876574c554fa099bcd063e2e188b95b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classstd_1_1vector.html">std::vector</a>&lt;<a class="el" href="classCoherentBus_1_1SnoopRespPort.html">SnoopRespPort</a>*&gt; <a class="el" href="classCoherentBus.html#ae876574c554fa099bcd063e2e188b95b">snoopRespPorts</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="af27ccd765f13a4b7bd119dc7579e2746"></a><!-- doxytag: member="CoherentBus::system" ref="af27ccd765f13a4b7bd119dc7579e2746" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classSystem.html">System</a>* <a class="el" href="classCoherentBus.html#af27ccd765f13a4b7bd119dc7579e2746">system</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Keep a pointer to the system to be allow to querying memory system properties. </p>

</div>
</div>
<hr/>このクラスの説明は次のファイルから生成されました:<ul>
<li>mem/<a class="el" href="coherent__bus_8hh_source.html">coherent_bus.hh</a></li>
<li>mem/<a class="el" href="coherent__bus_8cc.html">coherent_bus.cc</a></li>
</ul>
</div>
<hr size="1"/><address style="text-align: right;"><small>File&nbsp;GEM5&nbsp;Wrapperに対して25 May 2015に生成されました。&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
