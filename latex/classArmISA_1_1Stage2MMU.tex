\hypertarget{classArmISA_1_1Stage2MMU}{
\section{クラス Stage2MMU}
\label{classArmISA_1_1Stage2MMU}\index{ArmISA::Stage2MMU@{ArmISA::Stage2MMU}}
}


{\ttfamily \#include $<$stage2\_\-mmu.hh$>$}Stage2MMUに対する継承グラフ:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2cm]{classArmISA_1_1Stage2MMU}
\end{center}
\end{figure}
\subsection*{構成}
\begin{DoxyCompactItemize}
\item 
class \hyperlink{classArmISA_1_1Stage2MMU_1_1Stage2Translation}{Stage2Translation}
\end{DoxyCompactItemize}
\subsection*{Public 型}
\begin{DoxyCompactItemize}
\item 
typedef ArmStage2MMUParams \hyperlink{classArmISA_1_1Stage2MMU_a50e2496d982576d92f9f4df1918b73e0}{Params}
\end{DoxyCompactItemize}
\subsection*{Public メソッド}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classArmISA_1_1Stage2MMU_a2ba240fe5b46f673d59a1472ea2fba90}{Stage2MMU} (const \hyperlink{classArmISA_1_1Stage2MMU_a50e2496d982576d92f9f4df1918b73e0}{Params} $\ast$p)
\item 
\hyperlink{classRefCountingPtr}{Fault} \hyperlink{classArmISA_1_1Stage2MMU_ac040aef55a7ff520560957793f33f2d0}{readDataUntimed} (\hyperlink{classThreadContext}{ThreadContext} $\ast$\hyperlink{namespaceArmISA_a5aff829af55e65b802d83dfcef4e9dd0}{tc}, \hyperlink{classm5_1_1params_1_1Addr}{Addr} oVAddr, \hyperlink{classm5_1_1params_1_1Addr}{Addr} descAddr, uint8\_\-t $\ast$data, int numBytes, \hyperlink{classFlags}{Request::Flags} flags, int masterId, bool isFunctional)
\item 
\hyperlink{classRefCountingPtr}{Fault} \hyperlink{classArmISA_1_1Stage2MMU_a3798cb9b2fe75e8f40a2d2810824dd12}{readDataTimed} (\hyperlink{classThreadContext}{ThreadContext} $\ast$\hyperlink{namespaceArmISA_a5aff829af55e65b802d83dfcef4e9dd0}{tc}, \hyperlink{classm5_1_1params_1_1Addr}{Addr} descAddr, \hyperlink{classArmISA_1_1Stage2MMU_1_1Stage2Translation}{Stage2Translation} $\ast$translation, int numBytes, \hyperlink{classFlags}{Request::Flags} flags, int masterId)
\item 
\hyperlink{classArmISA_1_1TLB}{TLB} $\ast$ \hyperlink{classArmISA_1_1Stage2MMU_a88fa1d7ae56b4e726bf33cafc3d336a0}{stage1Tlb} () const 
\item 
\hyperlink{classArmISA_1_1TLB}{TLB} $\ast$ \hyperlink{classArmISA_1_1Stage2MMU_a17482b0222f72379826534d4b65e9195}{stage2Tlb} () const 
\end{DoxyCompactItemize}
\subsection*{Private 変数}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classArmISA_1_1TLB}{TLB} $\ast$ \hyperlink{classArmISA_1_1Stage2MMU_a33806b31f50f905dd9894ed27cd04958}{\_\-stage1Tlb}
\item 
\hyperlink{classArmISA_1_1TLB}{TLB} $\ast$ \hyperlink{classArmISA_1_1Stage2MMU_a8bb6ae753189e6ef8ad755ff214a0dcd}{\_\-stage2Tlb}
\end{DoxyCompactItemize}


\subsection{型定義}
\hypertarget{classArmISA_1_1Stage2MMU_a50e2496d982576d92f9f4df1918b73e0}{
\index{ArmISA::Stage2MMU@{ArmISA::Stage2MMU}!Params@{Params}}
\index{Params@{Params}!ArmISA::Stage2MMU@{ArmISA::Stage2MMU}}
\subsubsection[{Params}]{\setlength{\rightskip}{0pt plus 5cm}typedef ArmStage2MMUParams {\bf Params}}}
\label{classArmISA_1_1Stage2MMU_a50e2496d982576d92f9f4df1918b73e0}


\subsection{コンストラクタとデストラクタ}
\hypertarget{classArmISA_1_1Stage2MMU_a2ba240fe5b46f673d59a1472ea2fba90}{
\index{ArmISA::Stage2MMU@{ArmISA::Stage2MMU}!Stage2MMU@{Stage2MMU}}
\index{Stage2MMU@{Stage2MMU}!ArmISA::Stage2MMU@{ArmISA::Stage2MMU}}
\subsubsection[{Stage2MMU}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Stage2MMU} (const {\bf Params} $\ast$ {\em p})}}
\label{classArmISA_1_1Stage2MMU_a2ba240fe5b46f673d59a1472ea2fba90}



\begin{DoxyCode}
53     : SimObject(p), _stage1Tlb(p->tlb), _stage2Tlb(p->stage2_tlb)
54 {
55     stage1Tlb()->setMMU(this);
56     stage2Tlb()->setMMU(this);
57 }
\end{DoxyCode}


\subsection{関数}
\hypertarget{classArmISA_1_1Stage2MMU_a3798cb9b2fe75e8f40a2d2810824dd12}{
\index{ArmISA::Stage2MMU@{ArmISA::Stage2MMU}!readDataTimed@{readDataTimed}}
\index{readDataTimed@{readDataTimed}!ArmISA::Stage2MMU@{ArmISA::Stage2MMU}}
\subsubsection[{readDataTimed}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Fault} readDataTimed ({\bf ThreadContext} $\ast$ {\em tc}, \/  {\bf Addr} {\em descAddr}, \/  {\bf Stage2Translation} $\ast$ {\em translation}, \/  int {\em numBytes}, \/  {\bf Request::Flags} {\em flags}, \/  int {\em masterId})}}
\label{classArmISA_1_1Stage2MMU_a3798cb9b2fe75e8f40a2d2810824dd12}



\begin{DoxyCode}
101 {
102     Fault fault;
103     // translate to physical address using the second stage MMU
104     translation->setVirt(descAddr, numBytes, flags | Request::PT_WALK, masterId);
      
105     fault = translation->translateTiming(tc);
106     return fault;
107 }
\end{DoxyCode}
\hypertarget{classArmISA_1_1Stage2MMU_ac040aef55a7ff520560957793f33f2d0}{
\index{ArmISA::Stage2MMU@{ArmISA::Stage2MMU}!readDataUntimed@{readDataUntimed}}
\index{readDataUntimed@{readDataUntimed}!ArmISA::Stage2MMU@{ArmISA::Stage2MMU}}
\subsubsection[{readDataUntimed}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Fault} readDataUntimed ({\bf ThreadContext} $\ast$ {\em tc}, \/  {\bf Addr} {\em oVAddr}, \/  {\bf Addr} {\em descAddr}, \/  uint8\_\-t $\ast$ {\em data}, \/  int {\em numBytes}, \/  {\bf Request::Flags} {\em flags}, \/  int {\em masterId}, \/  bool {\em isFunctional})}}
\label{classArmISA_1_1Stage2MMU_ac040aef55a7ff520560957793f33f2d0}



\begin{DoxyCode}
63 {
64     Fault fault;
65 
66     // translate to physical address using the second stage MMU
67     Request req = Request();
68     req.setVirt(0, descAddr, numBytes, flags | Request::PT_WALK, masterId, 0);
69     if (isFunctional) {
70         fault = stage2Tlb()->translateFunctional(&req, tc, BaseTLB::Read);
71     } else {
72         fault = stage2Tlb()->translateAtomic(&req, tc, BaseTLB::Read);
73     }
74 
75     // Now do the access.
76     if (fault == NoFault && !req.getFlags().isSet(Request::NO_ACCESS)) {
77         Packet pkt = Packet(&req, MemCmd::ReadReq);
78         pkt.dataStatic(data);
79         if (isFunctional) {
80             stage1Tlb()->getWalkerPort().sendFunctional(&pkt);
81         } else {
82             stage1Tlb()->getWalkerPort().sendAtomic(&pkt);
83         }
84         assert(!pkt.isError());
85     }
86 
87     // If there was a fault annotate it with the flag saying the foult occured
88     // while doing a translation for a stage 1 page table walk.
89     if (fault != NoFault) {
90         ArmFault *armFault = reinterpret_cast<ArmFault *>(fault.get());
91         armFault->annotate(ArmFault::S1PTW, true);
92         armFault->annotate(ArmFault::OVA, oVAddr);
93     }
94     return fault;
95 }
\end{DoxyCode}
\hypertarget{classArmISA_1_1Stage2MMU_a88fa1d7ae56b4e726bf33cafc3d336a0}{
\index{ArmISA::Stage2MMU@{ArmISA::Stage2MMU}!stage1Tlb@{stage1Tlb}}
\index{stage1Tlb@{stage1Tlb}!ArmISA::Stage2MMU@{ArmISA::Stage2MMU}}
\subsubsection[{stage1Tlb}]{\setlength{\rightskip}{0pt plus 5cm}{\bf TLB}$\ast$ stage1Tlb () const\hspace{0.3cm}{\ttfamily  \mbox{[}inline\mbox{]}}}}
\label{classArmISA_1_1Stage2MMU_a88fa1d7ae56b4e726bf33cafc3d336a0}



\begin{DoxyCode}
106 { return _stage1Tlb; }
\end{DoxyCode}
\hypertarget{classArmISA_1_1Stage2MMU_a17482b0222f72379826534d4b65e9195}{
\index{ArmISA::Stage2MMU@{ArmISA::Stage2MMU}!stage2Tlb@{stage2Tlb}}
\index{stage2Tlb@{stage2Tlb}!ArmISA::Stage2MMU@{ArmISA::Stage2MMU}}
\subsubsection[{stage2Tlb}]{\setlength{\rightskip}{0pt plus 5cm}{\bf TLB}$\ast$ stage2Tlb () const\hspace{0.3cm}{\ttfamily  \mbox{[}inline\mbox{]}}}}
\label{classArmISA_1_1Stage2MMU_a17482b0222f72379826534d4b65e9195}



\begin{DoxyCode}
107 { return _stage2Tlb; }
\end{DoxyCode}


\subsection{変数}
\hypertarget{classArmISA_1_1Stage2MMU_a33806b31f50f905dd9894ed27cd04958}{
\index{ArmISA::Stage2MMU@{ArmISA::Stage2MMU}!\_\-stage1Tlb@{\_\-stage1Tlb}}
\index{\_\-stage1Tlb@{\_\-stage1Tlb}!ArmISA::Stage2MMU@{ArmISA::Stage2MMU}}
\subsubsection[{\_\-stage1Tlb}]{\setlength{\rightskip}{0pt plus 5cm}{\bf TLB}$\ast$ {\bf \_\-stage1Tlb}\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classArmISA_1_1Stage2MMU_a33806b31f50f905dd9894ed27cd04958}
\hypertarget{classArmISA_1_1Stage2MMU_a8bb6ae753189e6ef8ad755ff214a0dcd}{
\index{ArmISA::Stage2MMU@{ArmISA::Stage2MMU}!\_\-stage2Tlb@{\_\-stage2Tlb}}
\index{\_\-stage2Tlb@{\_\-stage2Tlb}!ArmISA::Stage2MMU@{ArmISA::Stage2MMU}}
\subsubsection[{\_\-stage2Tlb}]{\setlength{\rightskip}{0pt plus 5cm}{\bf TLB}$\ast$ {\bf \_\-stage2Tlb}\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classArmISA_1_1Stage2MMU_a8bb6ae753189e6ef8ad755ff214a0dcd}
The \hyperlink{classArmISA_1_1TLB}{TLB} that will cache the stage 2 look ups. 

このクラスの説明は次のファイルから生成されました:\begin{DoxyCompactItemize}
\item 
arch/arm/\hyperlink{stage2__mmu_8hh}{stage2\_\-mmu.hh}\item 
arch/arm/\hyperlink{stage2__mmu_8cc}{stage2\_\-mmu.cc}\end{DoxyCompactItemize}
