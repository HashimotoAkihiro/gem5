<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>File&nbsp;GEM5&nbsp;Wrapper: クラス テンプレート Layer&lt; SrcType, DstType &gt;</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- 作成： Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>メインページ</span></a></li>
      <li><a href="pages.html"><span>関連ページ</span></a></li>
      <li><a href="modules.html"><span>モジュール</span></a></li>
      <li><a href="namespaces.html"><span>ネームスペース</span></a></li>
      <li class="current"><a href="annotated.html"><span>クラス</span></a></li>
      <li><a href="files.html"><span>ファイル</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>構成</span></a></li>
      <li><a href="classes.html"><span>構成索引</span></a></li>
      <li><a href="hierarchy.html"><span>クラス階層</span></a></li>
      <li><a href="functions.html"><span>構成メンバ</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="classBaseBus.html">BaseBus</a>::<a class="el" href="classBaseBus_1_1Layer.html">Layer</a>
  </div>
</div>
<div class="contents">
<h1>クラス テンプレート Layer&lt; SrcType, DstType &gt;</h1><!-- doxytag: class="BaseBus::Layer" --><!-- doxytag: inherits="Drainable" -->
<p><code>#include &lt;<a class="el" href="bus_8hh_source.html">bus.hh</a>&gt;</code></p>
<div class="dynheader">
Layer&lt; SrcType, DstType &gt;に対する継承グラフ</div>
<div class="dynsection">
 <div class="center">
  <img src="classBaseBus_1_1Layer.gif" usemap="#Layer&lt; SrcType, DstType &gt;_map" alt=""/>
  <map id="Layer&lt; SrcType, DstType &gt;_map" name="Layer&lt; SrcType, DstType &gt;_map">
<area href="classDrainable.html" alt="Drainable" shape="rect" coords="0,0,172,24"/>
</map>
 </div>
</div>

<p><a href="classBaseBus_1_1Layer-members.html">すべてのメンバ一覧</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Public メソッド</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaseBus_1_1Layer.html#a1206f14a8687ddf9256407d185fed584">Layer</a> (DstType &amp;_port, <a class="el" href="classBaseBus.html">BaseBus</a> &amp;_bus, const std::string &amp;<a class="el" href="classBaseBus_1_1Layer.html#aaf2ed934b37cbbd236fdd1b01a5f5005">_name</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaseBus_1_1Layer.html#aa8a18d230dba7a674ac8a0b4f35bc36a">drain</a> (<a class="el" href="classDrainManager.html">DrainManager</a> *dm)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const std::string&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaseBus_1_1Layer.html#a6490f765a824ced1cc94979609fe7e07">name</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaseBus_1_1Layer.html#a903a48e7e621bc5add3149fdce906bc7">tryTiming</a> (SrcType *src_port)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaseBus_1_1Layer.html#a63792ad682fd60a25e2896f83452e877">succeededTiming</a> (<a class="el" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> busy_time)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaseBus_1_1Layer.html#a024ba069e31ed6c6b68dc003c9613bc2">failedTiming</a> (SrcType *src_port, <a class="el" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> busy_time)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaseBus_1_1Layer.html#aa31a4364e1cce5c7aee0703fa8e289eb">occupyLayer</a> (<a class="el" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> until)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaseBus_1_1Layer.html#ae589ae2847102aa65e86ebc70414fea3">retryWaiting</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaseBus_1_1Layer.html#a29cb5a4f98063ce6e9210eacbdb35298">recvRetry</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaseBus_1_1Layer.html#a4dc637449366fcdfc4e764cdf12d9b11">regStats</a> ()</td></tr>
<tr><td colspan="2"><h2>Private 型</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaseBus_1_1Layer.html#a5d74787dedbc4e11c1ab15bf487e61f8">State</a> { <a class="el" href="classBaseBus_1_1Layer.html#a5d74787dedbc4e11c1ab15bf487e61f8afd6a0e4343048b10646dd2976cc5ad18">IDLE</a>, 
<a class="el" href="classBaseBus_1_1Layer.html#a5d74787dedbc4e11c1ab15bf487e61f8aa6e504d57ec9777faa0185fbd3b93b97">BUSY</a>, 
<a class="el" href="classBaseBus_1_1Layer.html#a5d74787dedbc4e11c1ab15bf487e61f8a76d44342c42b85edbde0cae33f14c5de">RETRY</a>
 }</td></tr>
<tr><td colspan="2"><h2>Private メソッド</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaseBus_1_1Layer.html#a8f18de03b5e7510ac8a47a698bd673e3">releaseLayer</a> ()</td></tr>
<tr><td colspan="2"><h2>Private 変数</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">DstType &amp;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaseBus_1_1Layer.html#afb40502d9466732dadd57056e653d8f9">port</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classBaseBus.html">BaseBus</a> &amp;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaseBus_1_1Layer.html#ad7d5bc8ce3d9e2ce16633178b4feb387">bus</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::string&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaseBus_1_1Layer.html#aaf2ed934b37cbbd236fdd1b01a5f5005">_name</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classBaseBus_1_1Layer.html#a5d74787dedbc4e11c1ab15bf487e61f8">State</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaseBus_1_1Layer.html#a876b486d3a5241a126bd5751c5f70f79">state</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classDrainManager.html">DrainManager</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaseBus_1_1Layer.html#a329b71fb934a93312ca0aacbf5a3f982">drainManager</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classstd_1_1deque.html">std::deque</a>&lt; SrcType * &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaseBus_1_1Layer.html#a8db23e62d084ba779ff42aacec39065d">waitingForLayer</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">SrcType *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaseBus_1_1Layer.html#a982a229cbb75d7774cb62aebcec3ee9f">retryingPort</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">SrcType *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaseBus_1_1Layer.html#ab8ea7bd13cb34352f935d08c989ab5e8">waitingForPeer</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classEventWrapper.html">EventWrapper</a>&lt; <a class="el" href="classBaseBus_1_1Layer.html">Layer</a>,&amp;Layer::releaseLayer &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaseBus_1_1Layer.html#a69eab40ac3f909ccc29d20e8dbdc022e">releaseEvent</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classStats_1_1Scalar.html">Stats::Scalar</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaseBus_1_1Layer.html#a4bdb9e419f12a845feff7f1c7923a75f">occupancy</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classStats_1_1Formula.html">Stats::Formula</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaseBus_1_1Layer.html#a04353589e0e920909d3ceb8e73abb7ac">utilization</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>説明</h2>
<h3>template&lt;typename SrcType, typename DstType&gt;<br/>
 class BaseBus::Layer&lt; SrcType, DstType &gt;</h3>

<p>A bus layer is an internal bus structure with its own flow control and arbitration. Hence, a single-layer bus mimics a traditional off-chip tri-state bus (like PCI), where only one set of wires are shared. For on-chip buses, a good starting point is to have three layers, for requests, responses, and snoop responses respectively (snoop requests are instantaneous and do not need any flow control or arbitration). This case is similar to AHB and some OCP configurations.</p>
<p>As a further extensions beyond the three-layer bus, a future multi-layer bus has with one layer per connected slave port provides a full or partial crossbar, like AXI, OCP, PCIe etc.</p>
<p>The template parameter, PortClass, indicates the destination port type for the bus. The retry list holds either master ports or slave ports, depending on the direction of the layer. Thus, a request layer has a retry list containing slave ports, whereas a response layer holds master ports. </p>
<hr/><h2>列挙型</h2>
<a class="anchor" id="a5d74787dedbc4e11c1ab15bf487e61f8"></a><!-- doxytag: member="BaseBus::Layer::State" ref="a5d74787dedbc4e11c1ab15bf487e61f8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="classBaseBus_1_1Layer.html#a5d74787dedbc4e11c1ab15bf487e61f8">State</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>We declare an enum to track the state of the bus layer. The starting point is an idle state where the bus layer is waiting for a packet to arrive. Upon arrival, the bus layer transitions to the busy state, where it remains either until the packet transfer is done, or the header time is spent. Once the bus layer leaves the busy state, it can either go back to idle, if no packets have arrived while it was busy, or the bus layer goes on to retry the first port in waitingForLayer. A similar transition takes place from idle to retry if the bus layer receives a retry from one of its connected ports. The retry state lasts until the port in questions calls sendTiming and returns control to the bus layer, or goes to a busy state if the port does not immediately react to the retry by calling sendTiming. </p>
<dl><dt><b>列挙型の値: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="a5d74787dedbc4e11c1ab15bf487e61f8afd6a0e4343048b10646dd2976cc5ad18"></a><!-- doxytag: member="IDLE" ref="a5d74787dedbc4e11c1ab15bf487e61f8afd6a0e4343048b10646dd2976cc5ad18" args="" -->IDLE</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a5d74787dedbc4e11c1ab15bf487e61f8aa6e504d57ec9777faa0185fbd3b93b97"></a><!-- doxytag: member="BUSY" ref="a5d74787dedbc4e11c1ab15bf487e61f8aa6e504d57ec9777faa0185fbd3b93b97" args="" -->BUSY</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a5d74787dedbc4e11c1ab15bf487e61f8a76d44342c42b85edbde0cae33f14c5de"></a><!-- doxytag: member="RETRY" ref="a5d74787dedbc4e11c1ab15bf487e61f8a76d44342c42b85edbde0cae33f14c5de" args="" -->RETRY</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>

<p><a class="el" href="classDrainable.html#a5d74787dedbc4e11c1ab15bf487e61f8">Drainable</a>を再定義しています。</p>

<p><div class="fragment"><pre class="fragment"><a name="l00209"></a>00209 { <a class="code" href="classBaseBus_1_1Layer.html#a5d74787dedbc4e11c1ab15bf487e61f8afd6a0e4343048b10646dd2976cc5ad18">IDLE</a>, <a class="code" href="classBaseBus_1_1Layer.html#a5d74787dedbc4e11c1ab15bf487e61f8aa6e504d57ec9777faa0185fbd3b93b97">BUSY</a>, <a class="code" href="classBaseBus_1_1Layer.html#a5d74787dedbc4e11c1ab15bf487e61f8a76d44342c42b85edbde0cae33f14c5de">RETRY</a> };
</pre></div></p>

</div>
</div>
<hr/><h2>コンストラクタとデストラクタ</h2>
<a class="anchor" id="a1206f14a8687ddf9256407d185fed584"></a><!-- doxytag: member="BaseBus::Layer::Layer" ref="a1206f14a8687ddf9256407d185fed584" args="(DstType &amp;_port, BaseBus &amp;_bus, const std::string &amp;_name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classBaseBus_1_1Layer.html">Layer</a> </td>
          <td>(</td>
          <td class="paramtype">DstType &amp;&nbsp;</td>
          <td class="paramname"> <em>_port</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classBaseBus.html">BaseBus</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>_bus</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&nbsp;</td>
          <td class="paramname"> <em>_name</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Create a bus layer and give it a name. The bus layer uses the bus an event manager.</p>
<dl><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>_port</em>&nbsp;</td><td>destination port the layer converges at </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>_bus</em>&nbsp;</td><td>the bus this layer belongs to </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>_name</em>&nbsp;</td><td>the layer's name </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l00137"></a>00137                                                                :
<a name="l00138"></a>00138     <a class="code" href="classBaseBus_1_1Layer.html#afb40502d9466732dadd57056e653d8f9">port</a>(_port), <a class="code" href="classBaseBus_1_1Layer.html#ad7d5bc8ce3d9e2ce16633178b4feb387">bus</a>(_bus), <a class="code" href="classBaseBus_1_1Layer.html#aaf2ed934b37cbbd236fdd1b01a5f5005">_name</a>(<a class="code" href="classBaseBus_1_1Layer.html#aaf2ed934b37cbbd236fdd1b01a5f5005">_name</a>), <a class="code" href="classBaseBus_1_1Layer.html#a876b486d3a5241a126bd5751c5f70f79">state</a>(<a class="code" href="classBaseBus_1_1Layer.html#a5d74787dedbc4e11c1ab15bf487e61f8afd6a0e4343048b10646dd2976cc5ad18">IDLE</a>), <a class="code" href="classBaseBus_1_1Layer.html#a329b71fb934a93312ca0aacbf5a3f982">drainManager</a>(<a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>),
<a name="l00139"></a>00139     <a class="code" href="classBaseBus_1_1Layer.html#a982a229cbb75d7774cb62aebcec3ee9f">retryingPort</a>(<a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>), <a class="code" href="classBaseBus_1_1Layer.html#ab8ea7bd13cb34352f935d08c989ab5e8">waitingForPeer</a>(<a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>),
<a name="l00140"></a>00140     <a class="code" href="classBaseBus_1_1Layer.html#a69eab40ac3f909ccc29d20e8dbdc022e">releaseEvent</a>(<span class="keyword">this</span>)
<a name="l00141"></a>00141 {
<a name="l00142"></a>00142 }

</pre></div></p>

</div>
</div>
<hr/><h2>関数</h2>
<a class="anchor" id="aa8a18d230dba7a674ac8a0b4f35bc36a"></a><!-- doxytag: member="BaseBus::Layer::drain" ref="aa8a18d230dba7a674ac8a0b4f35bc36a" args="(DrainManager *dm)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int drain </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classDrainManager.html">DrainManager</a> *&nbsp;</td>
          <td class="paramname"> <em>dm</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Drain according to the normal semantics, so that the bus can tell the layer to drain, and pass an event to signal back when drained.</p>
<dl><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>de</em>&nbsp;</td><td>drain event to call once drained</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>戻り値:</b></dt><dd>1 if busy or waiting to retry, or 0 if idle </dd></dl>

<p><a class="el" href="classDrainable.html#a1ed42c14f2f622ea6b0df3865e89c8b4">Drainable</a>を実装しています。</p>

<p><div class="fragment"><pre class="fragment"><a name="l00587"></a>00587 {
<a name="l00588"></a>00588     <span class="comment">//We should check that we&apos;re not &quot;doing&quot; anything, and that noone is</span>
<a name="l00589"></a>00589     <span class="comment">//waiting. We might be idle but have someone waiting if the device we</span>
<a name="l00590"></a>00590     <span class="comment">//contacted for a retry didn&apos;t actually retry.</span>
<a name="l00591"></a>00591     <span class="keywordflow">if</span> (<a class="code" href="classBaseBus_1_1Layer.html#a876b486d3a5241a126bd5751c5f70f79">state</a> != <a class="code" href="classBaseBus_1_1Layer.html#a5d74787dedbc4e11c1ab15bf487e61f8afd6a0e4343048b10646dd2976cc5ad18">IDLE</a>) {
<a name="l00592"></a>00592         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Drain, <span class="stringliteral">&quot;Bus not drained\n&quot;</span>);
<a name="l00593"></a>00593         <a class="code" href="classBaseBus_1_1Layer.html#a329b71fb934a93312ca0aacbf5a3f982">drainManager</a> = dm;
<a name="l00594"></a>00594         <span class="keywordflow">return</span> 1;
<a name="l00595"></a>00595     }
<a name="l00596"></a>00596     <span class="keywordflow">return</span> 0;
<a name="l00597"></a>00597 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a024ba069e31ed6c6b68dc003c9613bc2"></a><!-- doxytag: member="BaseBus::Layer::failedTiming" ref="a024ba069e31ed6c6b68dc003c9613bc2" args="(SrcType *src_port, Tick busy_time)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void failedTiming </td>
          <td>(</td>
          <td class="paramtype">SrcType *&nbsp;</td>
          <td class="paramname"> <em>src_port</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a>&nbsp;</td>
          <td class="paramname"> <em>busy_time</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Deal with a destination port not accepting a packet by potentially adding the source port to the retry list (if not already at the front) and occupying the bus layer accordingly.</p>
<dl><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>src_port</em>&nbsp;</td><td>Source port </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>busy_time</em>&nbsp;</td><td><a class="el" href="classTime.html">Time</a> to spend as a result of a failed send </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l00215"></a>00215 {
<a name="l00216"></a>00216     <span class="comment">// ensure no one got in between and tried to send something to</span>
<a name="l00217"></a>00217     <span class="comment">// this port</span>
<a name="l00218"></a>00218     assert(<a class="code" href="classBaseBus_1_1Layer.html#ab8ea7bd13cb34352f935d08c989ab5e8">waitingForPeer</a> == <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>);
<a name="l00219"></a>00219 
<a name="l00220"></a>00220     <span class="comment">// if the source port is the current retrying one or not, we have</span>
<a name="l00221"></a>00221     <span class="comment">// failed in forwarding and should track that we are now waiting</span>
<a name="l00222"></a>00222     <span class="comment">// for the peer to send a retry</span>
<a name="l00223"></a>00223     <a class="code" href="classBaseBus_1_1Layer.html#ab8ea7bd13cb34352f935d08c989ab5e8">waitingForPeer</a> = src_port;
<a name="l00224"></a>00224 
<a name="l00225"></a>00225     <span class="comment">// we should have gone from idle or retry to busy in the tryTiming</span>
<a name="l00226"></a>00226     <span class="comment">// test</span>
<a name="l00227"></a>00227     assert(<a class="code" href="classBaseBus_1_1Layer.html#a876b486d3a5241a126bd5751c5f70f79">state</a> == <a class="code" href="classBaseBus_1_1Layer.html#a5d74787dedbc4e11c1ab15bf487e61f8aa6e504d57ec9777faa0185fbd3b93b97">BUSY</a>);
<a name="l00228"></a>00228 
<a name="l00229"></a>00229     <span class="comment">// occupy the bus accordingly</span>
<a name="l00230"></a>00230     <a class="code" href="classBaseBus_1_1Layer.html#aa31a4364e1cce5c7aee0703fa8e289eb">occupyLayer</a>(busy_time);
<a name="l00231"></a>00231 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6490f765a824ced1cc94979609fe7e07"></a><!-- doxytag: member="BaseBus::Layer::name" ref="a6490f765a824ced1cc94979609fe7e07" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const std::string name </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Get the bus layer's name </p>

<p><div class="fragment"><pre class="fragment"><a name="l00126"></a>00126 { <span class="keywordflow">return</span> <a class="code" href="classBaseBus_1_1Layer.html#ad7d5bc8ce3d9e2ce16633178b4feb387">bus</a>.<a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>() + <a class="code" href="classBaseBus_1_1Layer.html#aaf2ed934b37cbbd236fdd1b01a5f5005">_name</a>; }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa31a4364e1cce5c7aee0703fa8e289eb"></a><!-- doxytag: member="BaseBus::Layer::occupyLayer" ref="aa31a4364e1cce5c7aee0703fa8e289eb" args="(Tick until)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void occupyLayer </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a>&nbsp;</td>
          <td class="paramname"> <em>until</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Occupy the bus layer until until </p>

<p><div class="fragment"><pre class="fragment"><a name="l00146"></a>00146 {
<a name="l00147"></a>00147     <span class="comment">// ensure the state is busy at this point, as the bus should</span>
<a name="l00148"></a>00148     <span class="comment">// transition from idle as soon as it has decided to forward the</span>
<a name="l00149"></a>00149     <span class="comment">// packet to prevent any follow-on calls to sendTiming seeing an</span>
<a name="l00150"></a>00150     <span class="comment">// unoccupied bus</span>
<a name="l00151"></a>00151     assert(<a class="code" href="classBaseBus_1_1Layer.html#a876b486d3a5241a126bd5751c5f70f79">state</a> == <a class="code" href="classBaseBus_1_1Layer.html#a5d74787dedbc4e11c1ab15bf487e61f8aa6e504d57ec9777faa0185fbd3b93b97">BUSY</a>);
<a name="l00152"></a>00152 
<a name="l00153"></a>00153     <span class="comment">// until should never be 0 as express snoops never occupy the bus</span>
<a name="l00154"></a>00154     assert(until != 0);
<a name="l00155"></a>00155     <a class="code" href="classBaseBus_1_1Layer.html#ad7d5bc8ce3d9e2ce16633178b4feb387">bus</a>.<a class="code" href="classEventManager.html#a4ddebbfe9a12b95be6fb993ce892dcd3">schedule</a>(<a class="code" href="classBaseBus_1_1Layer.html#a69eab40ac3f909ccc29d20e8dbdc022e">releaseEvent</a>, until);
<a name="l00156"></a>00156 
<a name="l00157"></a>00157     <span class="comment">// account for the occupied ticks</span>
<a name="l00158"></a>00158     <a class="code" href="classBaseBus_1_1Layer.html#a4bdb9e419f12a845feff7f1c7923a75f">occupancy</a> += until - <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The universal simulation clock.">curTick</a>();
<a name="l00159"></a>00159 
<a name="l00160"></a>00160     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classBaseBus.html">BaseBus</a>, <span class="stringliteral">&quot;The bus is now busy from tick %d to %d\n&quot;</span>,
<a name="l00161"></a>00161             <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The universal simulation clock.">curTick</a>(), until);
<a name="l00162"></a>00162 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a29cb5a4f98063ce6e9210eacbdb35298"></a><!-- doxytag: member="BaseBus::Layer::recvRetry" ref="a29cb5a4f98063ce6e9210eacbdb35298" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void recvRetry </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Handle a retry from a neighbouring module. This wraps retryWaiting by verifying that there are ports waiting before calling retryWaiting. </p>

<p><div class="fragment"><pre class="fragment"><a name="l00295"></a>00295 {
<a name="l00296"></a>00296     <span class="comment">// we should never get a retry without having failed to forward</span>
<a name="l00297"></a>00297     <span class="comment">// something to this port</span>
<a name="l00298"></a>00298     assert(<a class="code" href="classBaseBus_1_1Layer.html#ab8ea7bd13cb34352f935d08c989ab5e8">waitingForPeer</a> != <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>);
<a name="l00299"></a>00299 
<a name="l00300"></a>00300     <span class="comment">// add the port where the failed packet originated to the front of</span>
<a name="l00301"></a>00301     <span class="comment">// the waiting ports for the layer, this allows us to call retry</span>
<a name="l00302"></a>00302     <span class="comment">// on the port immediately if the bus layer is idle</span>
<a name="l00303"></a>00303     <a class="code" href="classBaseBus_1_1Layer.html#a8db23e62d084ba779ff42aacec39065d">waitingForLayer</a>.push_front(<a class="code" href="classBaseBus_1_1Layer.html#ab8ea7bd13cb34352f935d08c989ab5e8">waitingForPeer</a>);
<a name="l00304"></a>00304 
<a name="l00305"></a>00305     <span class="comment">// we are no longer waiting for the peer</span>
<a name="l00306"></a>00306     <a class="code" href="classBaseBus_1_1Layer.html#ab8ea7bd13cb34352f935d08c989ab5e8">waitingForPeer</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00307"></a>00307 
<a name="l00308"></a>00308     <span class="comment">// if the bus layer is idle, retry this port straight away, if we</span>
<a name="l00309"></a>00309     <span class="comment">// are busy, then simply let the port wait for its turn</span>
<a name="l00310"></a>00310     <span class="keywordflow">if</span> (<a class="code" href="classBaseBus_1_1Layer.html#a876b486d3a5241a126bd5751c5f70f79">state</a> == <a class="code" href="classBaseBus_1_1Layer.html#a5d74787dedbc4e11c1ab15bf487e61f8afd6a0e4343048b10646dd2976cc5ad18">IDLE</a>) {
<a name="l00311"></a>00311         <a class="code" href="classBaseBus_1_1Layer.html#ae589ae2847102aa65e86ebc70414fea3">retryWaiting</a>();
<a name="l00312"></a>00312     } <span class="keywordflow">else</span> {
<a name="l00313"></a>00313         assert(<a class="code" href="classBaseBus_1_1Layer.html#a876b486d3a5241a126bd5751c5f70f79">state</a> == <a class="code" href="classBaseBus_1_1Layer.html#a5d74787dedbc4e11c1ab15bf487e61f8aa6e504d57ec9777faa0185fbd3b93b97">BUSY</a>);
<a name="l00314"></a>00314     }
<a name="l00315"></a>00315 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4dc637449366fcdfc4e764cdf12d9b11"></a><!-- doxytag: member="BaseBus::Layer::regStats" ref="a4dc637449366fcdfc4e764cdf12d9b11" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void regStats </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p><a class="el" href="classRegister.html">Register</a> stats for the layer </p>

<p><div class="fragment"><pre class="fragment"><a name="l00602"></a>00602 {
<a name="l00603"></a>00603     <span class="keyword">using namespace </span>Stats;
<a name="l00604"></a>00604 
<a name="l00605"></a>00605     <a class="code" href="classBaseBus_1_1Layer.html#a4bdb9e419f12a845feff7f1c7923a75f">occupancy</a>
<a name="l00606"></a>00606         .<a class="code" href="classStats_1_1DataWrap.html#a8eaf5c2b92132dfcacd7d9b10afb1726">name</a>(<a class="code" href="classBaseBus_1_1Layer.html#a6490f765a824ced1cc94979609fe7e07">name</a>() + <span class="stringliteral">&quot;.occupancy&quot;</span>)
<a name="l00607"></a>00607         .desc(<span class="stringliteral">&quot;Layer occupancy (ticks)&quot;</span>)
<a name="l00608"></a>00608         .flags(<a class="code" href="namespaceStats.html#aea66fede55fadabd06c458fb36736378">nozero</a>);
<a name="l00609"></a>00609 
<a name="l00610"></a>00610     <a class="code" href="classBaseBus_1_1Layer.html#a04353589e0e920909d3ceb8e73abb7ac">utilization</a>
<a name="l00611"></a>00611         .<a class="code" href="classStats_1_1DataWrap.html#a8eaf5c2b92132dfcacd7d9b10afb1726">name</a>(<a class="code" href="classBaseBus_1_1Layer.html#a6490f765a824ced1cc94979609fe7e07">name</a>() + <span class="stringliteral">&quot;.utilization&quot;</span>)
<a name="l00612"></a>00612         .desc(<span class="stringliteral">&quot;Layer utilization (%)&quot;</span>)
<a name="l00613"></a>00613         .precision(1)
<a name="l00614"></a>00614         .flags(<a class="code" href="namespaceStats.html#aea66fede55fadabd06c458fb36736378">nozero</a>);
<a name="l00615"></a>00615 
<a name="l00616"></a>00616     <a class="code" href="classBaseBus_1_1Layer.html#a04353589e0e920909d3ceb8e73abb7ac">utilization</a> = 100 * <a class="code" href="classBaseBus_1_1Layer.html#a4bdb9e419f12a845feff7f1c7923a75f">occupancy</a> / <a class="code" href="stat__control_8cc.html#a7d4c467738eb0a3ad90786862eec30d6">simTicks</a>;
<a name="l00617"></a>00617 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8f18de03b5e7510ac8a47a698bd673e3"></a><!-- doxytag: member="BaseBus::Layer::releaseLayer" ref="a8f18de03b5e7510ac8a47a698bd673e3" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void releaseLayer </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Release the bus layer after being occupied and return to an idle state where we proceed to send a retry to any potential waiting port, or drain if asked to do so. </p>

<p><div class="fragment"><pre class="fragment"><a name="l00236"></a>00236 {
<a name="l00237"></a>00237     <span class="comment">// releasing the bus means we should now be idle</span>
<a name="l00238"></a>00238     assert(<a class="code" href="classBaseBus_1_1Layer.html#a876b486d3a5241a126bd5751c5f70f79">state</a> == <a class="code" href="classBaseBus_1_1Layer.html#a5d74787dedbc4e11c1ab15bf487e61f8aa6e504d57ec9777faa0185fbd3b93b97">BUSY</a>);
<a name="l00239"></a>00239     assert(!<a class="code" href="classBaseBus_1_1Layer.html#a69eab40ac3f909ccc29d20e8dbdc022e">releaseEvent</a>.<a class="code" href="classEvent.html#a9cd69a6b10cb037550943f177a0da688" title="Determine if the current event is scheduled.">scheduled</a>());
<a name="l00240"></a>00240 
<a name="l00241"></a>00241     <span class="comment">// update the state</span>
<a name="l00242"></a>00242     <a class="code" href="classBaseBus_1_1Layer.html#a876b486d3a5241a126bd5751c5f70f79">state</a> = <a class="code" href="classBaseBus_1_1Layer.html#a5d74787dedbc4e11c1ab15bf487e61f8afd6a0e4343048b10646dd2976cc5ad18">IDLE</a>;
<a name="l00243"></a>00243 
<a name="l00244"></a>00244     <span class="comment">// bus layer is now idle, so if someone is waiting we can retry</span>
<a name="l00245"></a>00245     <span class="keywordflow">if</span> (!<a class="code" href="classBaseBus_1_1Layer.html#a8db23e62d084ba779ff42aacec39065d">waitingForLayer</a>.empty()) {
<a name="l00246"></a>00246         <a class="code" href="classBaseBus_1_1Layer.html#ae589ae2847102aa65e86ebc70414fea3">retryWaiting</a>();
<a name="l00247"></a>00247     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classBaseBus_1_1Layer.html#ab8ea7bd13cb34352f935d08c989ab5e8">waitingForPeer</a> == <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a> &amp;&amp; <a class="code" href="classBaseBus_1_1Layer.html#a329b71fb934a93312ca0aacbf5a3f982">drainManager</a>) {
<a name="l00248"></a>00248         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Drain, <span class="stringliteral">&quot;Bus done draining, signaling drain manager\n&quot;</span>);
<a name="l00249"></a>00249         <span class="comment">//If we weren&apos;t able to drain before, do it now.</span>
<a name="l00250"></a>00250         <a class="code" href="classBaseBus_1_1Layer.html#a329b71fb934a93312ca0aacbf5a3f982">drainManager</a>-&gt;<a class="code" href="classDrainManager.html#ab89d10e368d2e82061eddb9e40022382">signalDrainDone</a>();
<a name="l00251"></a>00251         <span class="comment">// Clear the drain event once we&apos;re done with it.</span>
<a name="l00252"></a>00252         <a class="code" href="classBaseBus_1_1Layer.html#a329b71fb934a93312ca0aacbf5a3f982">drainManager</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00253"></a>00253     }
<a name="l00254"></a>00254 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae589ae2847102aa65e86ebc70414fea3"></a><!-- doxytag: member="BaseBus::Layer::retryWaiting" ref="ae589ae2847102aa65e86ebc70414fea3" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void retryWaiting </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Send a retry to the port at the head of waitingForLayer. The caller must ensure that the list is not empty. </p>

<p><div class="fragment"><pre class="fragment"><a name="l00259"></a>00259 {
<a name="l00260"></a>00260     <span class="comment">// this should never be called with no one waiting</span>
<a name="l00261"></a>00261     assert(!<a class="code" href="classBaseBus_1_1Layer.html#a8db23e62d084ba779ff42aacec39065d">waitingForLayer</a>.empty());
<a name="l00262"></a>00262 
<a name="l00263"></a>00263     <span class="comment">// we always go to retrying from idle</span>
<a name="l00264"></a>00264     assert(<a class="code" href="classBaseBus_1_1Layer.html#a876b486d3a5241a126bd5751c5f70f79">state</a> == <a class="code" href="classBaseBus_1_1Layer.html#a5d74787dedbc4e11c1ab15bf487e61f8afd6a0e4343048b10646dd2976cc5ad18">IDLE</a>);
<a name="l00265"></a>00265 
<a name="l00266"></a>00266     <span class="comment">// update the state</span>
<a name="l00267"></a>00267     <a class="code" href="classBaseBus_1_1Layer.html#a876b486d3a5241a126bd5751c5f70f79">state</a> = <a class="code" href="classBaseBus_1_1Layer.html#a5d74787dedbc4e11c1ab15bf487e61f8a76d44342c42b85edbde0cae33f14c5de">RETRY</a>;
<a name="l00268"></a>00268 
<a name="l00269"></a>00269     <span class="comment">// set the retrying port to the front of the retry list and pop it</span>
<a name="l00270"></a>00270     <span class="comment">// off the list</span>
<a name="l00271"></a>00271     assert(<a class="code" href="classBaseBus_1_1Layer.html#a982a229cbb75d7774cb62aebcec3ee9f">retryingPort</a> == <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>);
<a name="l00272"></a>00272     <a class="code" href="classBaseBus_1_1Layer.html#a982a229cbb75d7774cb62aebcec3ee9f">retryingPort</a> = <a class="code" href="classBaseBus_1_1Layer.html#a8db23e62d084ba779ff42aacec39065d">waitingForLayer</a>.front();
<a name="l00273"></a>00273     <a class="code" href="classBaseBus_1_1Layer.html#a8db23e62d084ba779ff42aacec39065d">waitingForLayer</a>.pop_front();
<a name="l00274"></a>00274 
<a name="l00275"></a>00275     <span class="comment">// tell the port to retry, which in some cases ends up calling the</span>
<a name="l00276"></a>00276     <span class="comment">// bus</span>
<a name="l00277"></a>00277     <a class="code" href="classBaseBus_1_1Layer.html#a982a229cbb75d7774cb62aebcec3ee9f">retryingPort</a>-&gt;sendRetry();
<a name="l00278"></a>00278 
<a name="l00279"></a>00279     <span class="comment">// If the bus is still in the retry state, sendTiming wasn&apos;t</span>
<a name="l00280"></a>00280     <span class="comment">// called in zero time (e.g. the cache does this), burn a cycle</span>
<a name="l00281"></a>00281     <span class="keywordflow">if</span> (<a class="code" href="classBaseBus_1_1Layer.html#a876b486d3a5241a126bd5751c5f70f79">state</a> == <a class="code" href="classBaseBus_1_1Layer.html#a5d74787dedbc4e11c1ab15bf487e61f8a76d44342c42b85edbde0cae33f14c5de">RETRY</a>) {
<a name="l00282"></a>00282         <span class="comment">// update the state to busy and reset the retrying port, we</span>
<a name="l00283"></a>00283         <span class="comment">// have done our bit and sent the retry</span>
<a name="l00284"></a>00284         <a class="code" href="classBaseBus_1_1Layer.html#a876b486d3a5241a126bd5751c5f70f79">state</a> = <a class="code" href="classBaseBus_1_1Layer.html#a5d74787dedbc4e11c1ab15bf487e61f8aa6e504d57ec9777faa0185fbd3b93b97">BUSY</a>;
<a name="l00285"></a>00285         <a class="code" href="classBaseBus_1_1Layer.html#a982a229cbb75d7774cb62aebcec3ee9f">retryingPort</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00286"></a>00286 
<a name="l00287"></a>00287         <span class="comment">// occupy the bus layer until the next cycle ends</span>
<a name="l00288"></a>00288         <a class="code" href="classBaseBus_1_1Layer.html#aa31a4364e1cce5c7aee0703fa8e289eb">occupyLayer</a>(<a class="code" href="classBaseBus_1_1Layer.html#ad7d5bc8ce3d9e2ce16633178b4feb387">bus</a>.<a class="code" href="classClockedObject.html#a773956693f216cafb7d4cad92ad582e5">clockEdge</a>(<a class="code" href="classCycles.html">Cycles</a>(1)));
<a name="l00289"></a>00289     }
<a name="l00290"></a>00290 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a63792ad682fd60a25e2896f83452e877"></a><!-- doxytag: member="BaseBus::Layer::succeededTiming" ref="a63792ad682fd60a25e2896f83452e877" args="(Tick busy_time)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void succeededTiming </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a>&nbsp;</td>
          <td class="paramname"> <em>busy_time</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Deal with a destination port accepting a packet by potentially removing the source port from the retry list (if retrying) and occupying the bus layer accordingly.</p>
<dl><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>busy_time</em>&nbsp;</td><td><a class="el" href="classTime.html">Time</a> to spend as a result of a successful send </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l00202"></a>00202 {
<a name="l00203"></a>00203     <span class="comment">// we should have gone from idle or retry to busy in the tryTiming</span>
<a name="l00204"></a>00204     <span class="comment">// test</span>
<a name="l00205"></a>00205     assert(<a class="code" href="classBaseBus_1_1Layer.html#a876b486d3a5241a126bd5751c5f70f79">state</a> == <a class="code" href="classBaseBus_1_1Layer.html#a5d74787dedbc4e11c1ab15bf487e61f8aa6e504d57ec9777faa0185fbd3b93b97">BUSY</a>);
<a name="l00206"></a>00206 
<a name="l00207"></a>00207     <span class="comment">// occupy the bus accordingly</span>
<a name="l00208"></a>00208     <a class="code" href="classBaseBus_1_1Layer.html#aa31a4364e1cce5c7aee0703fa8e289eb">occupyLayer</a>(busy_time);
<a name="l00209"></a>00209 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a903a48e7e621bc5add3149fdce906bc7"></a><!-- doxytag: member="BaseBus::Layer::tryTiming" ref="a903a48e7e621bc5add3149fdce906bc7" args="(SrcType *src_port)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool tryTiming </td>
          <td>(</td>
          <td class="paramtype">SrcType *&nbsp;</td>
          <td class="paramname"> <em>src_port</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Determine if the bus layer accepts a packet from a specific port. If not, the port in question is also added to the retry list. In either case the state of the layer is updated accordingly.</p>
<dl><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>port</em>&nbsp;</td><td>Source port presenting the packet</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>戻り値:</b></dt><dd>True if the bus layer accepts the packet </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00167"></a>00167 {
<a name="l00168"></a>00168     <span class="comment">// if we are in the retry state, we will not see anything but the</span>
<a name="l00169"></a>00169     <span class="comment">// retrying port (or in the case of the snoop ports the snoop</span>
<a name="l00170"></a>00170     <span class="comment">// response port that mirrors the actual slave port) as we leave</span>
<a name="l00171"></a>00171     <span class="comment">// this state again in zero time if the peer does not immediately</span>
<a name="l00172"></a>00172     <span class="comment">// call the bus when receiving the retry</span>
<a name="l00173"></a>00173 
<a name="l00174"></a>00174     <span class="comment">// first we see if the layer is busy, next we check if the</span>
<a name="l00175"></a>00175     <span class="comment">// destination port is already engaged in a transaction waiting</span>
<a name="l00176"></a>00176     <span class="comment">// for a retry from the peer</span>
<a name="l00177"></a>00177     <span class="keywordflow">if</span> (<a class="code" href="classBaseBus_1_1Layer.html#a876b486d3a5241a126bd5751c5f70f79">state</a> == <a class="code" href="classBaseBus_1_1Layer.html#a5d74787dedbc4e11c1ab15bf487e61f8aa6e504d57ec9777faa0185fbd3b93b97">BUSY</a> || <a class="code" href="classBaseBus_1_1Layer.html#ab8ea7bd13cb34352f935d08c989ab5e8">waitingForPeer</a> != <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>) {
<a name="l00178"></a>00178         <span class="comment">// the port should not be waiting already</span>
<a name="l00179"></a>00179         assert(std::find(<a class="code" href="classBaseBus_1_1Layer.html#a8db23e62d084ba779ff42aacec39065d">waitingForLayer</a>.begin(), <a class="code" href="classBaseBus_1_1Layer.html#a8db23e62d084ba779ff42aacec39065d">waitingForLayer</a>.end(),
<a name="l00180"></a>00180                          src_port) == <a class="code" href="classBaseBus_1_1Layer.html#a8db23e62d084ba779ff42aacec39065d">waitingForLayer</a>.end());
<a name="l00181"></a>00181 
<a name="l00182"></a>00182         <span class="comment">// put the port at the end of the retry list waiting for the</span>
<a name="l00183"></a>00183         <span class="comment">// layer to be freed up (and in the case of a busy peer, for</span>
<a name="l00184"></a>00184         <span class="comment">// that transaction to go through, and then the bus to free</span>
<a name="l00185"></a>00185         <span class="comment">// up)</span>
<a name="l00186"></a>00186         <a class="code" href="classBaseBus_1_1Layer.html#a8db23e62d084ba779ff42aacec39065d">waitingForLayer</a>.push_back(src_port);
<a name="l00187"></a>00187         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00188"></a>00188     }
<a name="l00189"></a>00189 
<a name="l00190"></a>00190     <span class="comment">// update the state to busy</span>
<a name="l00191"></a>00191     <a class="code" href="classBaseBus_1_1Layer.html#a876b486d3a5241a126bd5751c5f70f79">state</a> = <a class="code" href="classBaseBus_1_1Layer.html#a5d74787dedbc4e11c1ab15bf487e61f8aa6e504d57ec9777faa0185fbd3b93b97">BUSY</a>;
<a name="l00192"></a>00192 
<a name="l00193"></a>00193     <span class="comment">// reset the retrying port</span>
<a name="l00194"></a>00194     <a class="code" href="classBaseBus_1_1Layer.html#a982a229cbb75d7774cb62aebcec3ee9f">retryingPort</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00195"></a>00195 
<a name="l00196"></a>00196     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00197"></a>00197 }
</pre></div></p>

</div>
</div>
<hr/><h2>変数</h2>
<a class="anchor" id="aaf2ed934b37cbbd236fdd1b01a5f5005"></a><!-- doxytag: member="BaseBus::Layer::_name" ref="aaf2ed934b37cbbd236fdd1b01a5f5005" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::string <a class="el" href="classBaseBus_1_1Layer.html#aaf2ed934b37cbbd236fdd1b01a5f5005">_name</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>A name for this layer. </p>

</div>
</div>
<a class="anchor" id="ad7d5bc8ce3d9e2ce16633178b4feb387"></a><!-- doxytag: member="BaseBus::Layer::bus" ref="ad7d5bc8ce3d9e2ce16633178b4feb387" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classBaseBus.html">BaseBus</a>&amp; <a class="el" href="classBaseBus_1_1Layer.html#ad7d5bc8ce3d9e2ce16633178b4feb387">bus</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>The bus this layer is a part of. </p>

</div>
</div>
<a class="anchor" id="a329b71fb934a93312ca0aacbf5a3f982"></a><!-- doxytag: member="BaseBus::Layer::drainManager" ref="a329b71fb934a93312ca0aacbf5a3f982" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classDrainManager.html">DrainManager</a>* <a class="el" href="classBaseBus_1_1Layer.html#a329b71fb934a93312ca0aacbf5a3f982">drainManager</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>manager to signal when drained </p>

</div>
</div>
<a class="anchor" id="a4bdb9e419f12a845feff7f1c7923a75f"></a><!-- doxytag: member="BaseBus::Layer::occupancy" ref="a4bdb9e419f12a845feff7f1c7923a75f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classStats_1_1Scalar.html">Stats::Scalar</a> <a class="el" href="classBaseBus_1_1Layer.html#a4bdb9e419f12a845feff7f1c7923a75f">occupancy</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p><a class="el" href="namespaceStats.html">Stats</a> for occupancy and utilization. These stats capture the time the bus spends in the busy state and are thus only relevant when the memory system is in timing mode. </p>

</div>
</div>
<a class="anchor" id="afb40502d9466732dadd57056e653d8f9"></a><!-- doxytag: member="BaseBus::Layer::port" ref="afb40502d9466732dadd57056e653d8f9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">DstType&amp; <a class="el" href="classBaseBus_1_1Layer.html#afb40502d9466732dadd57056e653d8f9">port</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>The destination port this layer converges at. </p>

</div>
</div>
<a class="anchor" id="a69eab40ac3f909ccc29d20e8dbdc022e"></a><!-- doxytag: member="BaseBus::Layer::releaseEvent" ref="a69eab40ac3f909ccc29d20e8dbdc022e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classEventWrapper.html">EventWrapper</a>&lt;<a class="el" href="classBaseBus_1_1Layer.html">Layer</a>, &amp;Layer::releaseLayer&gt; <a class="el" href="classBaseBus_1_1Layer.html#a69eab40ac3f909ccc29d20e8dbdc022e">releaseEvent</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>event used to schedule a release of the layer </p>

</div>
</div>
<a class="anchor" id="a982a229cbb75d7774cb62aebcec3ee9f"></a><!-- doxytag: member="BaseBus::Layer::retryingPort" ref="a982a229cbb75d7774cb62aebcec3ee9f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">SrcType* <a class="el" href="classBaseBus_1_1Layer.html#a982a229cbb75d7774cb62aebcec3ee9f">retryingPort</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p><a class="el" href="classPort.html">Port</a> that we are currently in the process of telling to retry a previously failed attempt to perform a timing transaction. This is a valid port when in the retry state, and NULL when in busy or idle. </p>

</div>
</div>
<a class="anchor" id="a876b486d3a5241a126bd5751c5f70f79"></a><!-- doxytag: member="BaseBus::Layer::state" ref="a876b486d3a5241a126bd5751c5f70f79" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classBaseBus_1_1Layer.html#a5d74787dedbc4e11c1ab15bf487e61f8">State</a> <a class="el" href="classBaseBus_1_1Layer.html#a876b486d3a5241a126bd5751c5f70f79">state</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>track the state of the bus layer </p>

</div>
</div>
<a class="anchor" id="a04353589e0e920909d3ceb8e73abb7ac"></a><!-- doxytag: member="BaseBus::Layer::utilization" ref="a04353589e0e920909d3ceb8e73abb7ac" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classStats_1_1Formula.html">Stats::Formula</a> <a class="el" href="classBaseBus_1_1Layer.html#a04353589e0e920909d3ceb8e73abb7ac">utilization</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a8db23e62d084ba779ff42aacec39065d"></a><!-- doxytag: member="BaseBus::Layer::waitingForLayer" ref="a8db23e62d084ba779ff42aacec39065d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classstd_1_1deque.html">std::deque</a>&lt;SrcType*&gt; <a class="el" href="classBaseBus_1_1Layer.html#a8db23e62d084ba779ff42aacec39065d">waitingForLayer</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>A deque of ports that retry should be called on because the original send was delayed due to a busy layer. </p>

</div>
</div>
<a class="anchor" id="ab8ea7bd13cb34352f935d08c989ab5e8"></a><!-- doxytag: member="BaseBus::Layer::waitingForPeer" ref="ab8ea7bd13cb34352f935d08c989ab5e8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">SrcType* <a class="el" href="classBaseBus_1_1Layer.html#ab8ea7bd13cb34352f935d08c989ab5e8">waitingForPeer</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Track who is waiting for the retry when receiving it from a peer. If no port is waiting NULL is stored. </p>

</div>
</div>
<hr/>このクラスの説明は次のファイルから生成されました:<ul>
<li>mem/<a class="el" href="bus_8hh_source.html">bus.hh</a></li>
<li>mem/<a class="el" href="bus_8cc.html">bus.cc</a></li>
</ul>
</div>
<hr size="1"/><address style="text-align: right;"><small>File&nbsp;GEM5&nbsp;Wrapperに対して25 May 2015に生成されました。&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
