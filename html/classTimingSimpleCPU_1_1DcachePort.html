<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>File&nbsp;GEM5&nbsp;Wrapper: クラス DcachePort</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- 作成： Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>メインページ</span></a></li>
      <li><a href="pages.html"><span>関連ページ</span></a></li>
      <li><a href="modules.html"><span>モジュール</span></a></li>
      <li><a href="namespaces.html"><span>ネームスペース</span></a></li>
      <li class="current"><a href="annotated.html"><span>クラス</span></a></li>
      <li><a href="files.html"><span>ファイル</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>構成</span></a></li>
      <li><a href="classes.html"><span>構成索引</span></a></li>
      <li><a href="hierarchy.html"><span>クラス階層</span></a></li>
      <li><a href="functions.html"><span>構成メンバ</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="classTimingSimpleCPU.html">TimingSimpleCPU</a>::<a class="el" href="classTimingSimpleCPU_1_1DcachePort.html">DcachePort</a>
  </div>
</div>
<div class="contents">
<h1>クラス DcachePort</h1><!-- doxytag: class="TimingSimpleCPU::DcachePort" --><!-- doxytag: inherits="TimingSimpleCPU::TimingCPUPort" --><div class="dynheader">
DcachePortに対する継承グラフ</div>
<div class="dynsection">
 <div class="center">
  <img src="classTimingSimpleCPU_1_1DcachePort.gif" usemap="#DcachePort_map" alt=""/>
  <map id="DcachePort_map" name="DcachePort_map">
<area href="classTimingSimpleCPU_1_1TimingCPUPort.html" alt="TimingCPUPort" shape="rect" coords="0,168,102,192"/>
<area href="classMasterPort.html" alt="MasterPort" shape="rect" coords="0,112,102,136"/>
<area href="classBaseMasterPort.html" alt="BaseMasterPort" shape="rect" coords="0,56,102,80"/>
<area href="classPort.html" alt="Port" shape="rect" coords="0,0,102,24"/>
</map>
 </div>
</div>

<p><a href="classTimingSimpleCPU_1_1DcachePort-members.html">すべてのメンバ一覧</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>構成</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structTimingSimpleCPU_1_1DcachePort_1_1DTickEvent.html">DTickEvent</a></td></tr>
<tr><td colspan="2"><h2>Public メソッド</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU_1_1DcachePort.html#ae1acfc6b442a828753a2311f1325cec5">DcachePort</a> (<a class="el" href="classTimingSimpleCPU_1_1TimingSimpleCPU.html">TimingSimpleCPU</a> *_cpu)</td></tr>
<tr><td colspan="2"><h2>Public 変数</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU_1_1DcachePort.html#af4264b12b32db39099b579e1ed670312">cacheBlockMask</a></td></tr>
<tr><td colspan="2"><h2>Protected メソッド</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU_1_1DcachePort.html#aff3031c56fc4947a19695c868bb8233e">recvTimingSnoopReq</a> (<a class="el" href="classPacket.html">PacketPtr</a> pkt)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU_1_1DcachePort.html#a482dba5588f4bee43e498875a61e5e0b">recvTimingResp</a> (<a class="el" href="classPacket.html">PacketPtr</a> pkt)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU_1_1DcachePort.html#a29cb5a4f98063ce6e9210eacbdb35298">recvRetry</a> ()</td></tr>
<tr><td colspan="2"><h2>Protected 変数</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structTimingSimpleCPU_1_1DcachePort_1_1DTickEvent.html">DTickEvent</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU_1_1DcachePort.html#a49142331c4285494b26819ad5d97f545">tickEvent</a></td></tr>
</table>
<hr/><h2>コンストラクタとデストラクタ</h2>
<a class="anchor" id="ae1acfc6b442a828753a2311f1325cec5"></a><!-- doxytag: member="TimingSimpleCPU::DcachePort::DcachePort" ref="ae1acfc6b442a828753a2311f1325cec5" args="(TimingSimpleCPU *_cpu)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classTimingSimpleCPU_1_1DcachePort.html">DcachePort</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classTimingSimpleCPU_1_1TimingSimpleCPU.html">TimingSimpleCPU</a> *&nbsp;</td>
          <td class="paramname"> <em>_cpu</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00218"></a>00218             : <a class="code" href="classTimingSimpleCPU_1_1TimingCPUPort.html#a5c5d45da58c60de7b1896dbc5440d644">TimingCPUPort</a>(_cpu-&gt;name() + <span class="stringliteral">&quot;.dcache_port&quot;</span>, _cpu),
<a name="l00219"></a>00219               <a class="code" href="classTimingSimpleCPU_1_1DcachePort.html#a49142331c4285494b26819ad5d97f545">tickEvent</a>(_cpu)
<a name="l00220"></a>00220         {
<a name="l00221"></a>00221            <a class="code" href="classTimingSimpleCPU_1_1DcachePort.html#af4264b12b32db39099b579e1ed670312">cacheBlockMask</a> = ~(<a class="code" href="classTimingSimpleCPU_1_1TimingCPUPort.html#ace3e131319475077fac2fa861708b0c9">cpu</a>-&gt;cacheLineSize() - 1);
<a name="l00222"></a>00222         }
</pre></div></p>

</div>
</div>
<hr/><h2>関数</h2>
<a class="anchor" id="a29cb5a4f98063ce6e9210eacbdb35298"></a><!-- doxytag: member="TimingSimpleCPU::DcachePort::recvRetry" ref="a29cb5a4f98063ce6e9210eacbdb35298" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void recvRetry </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Called by the slave port if sendTimingReq or sendTimingSnoopResp was called on this master port (causing recvTimingReq and recvTimingSnoopResp to be called on the slave port) and was unsuccesful. </p>

<p><a class="el" href="classMasterPort.html#ac1ccc3bcf7ebabb20b57fab99b2be5b0">MasterPort</a>を実装しています。</p>

<p><div class="fragment"><pre class="fragment"><a name="l00862"></a>00862 {
<a name="l00863"></a>00863     <span class="comment">// we shouldn&apos;t get a retry unless we have a packet that we&apos;re</span>
<a name="l00864"></a>00864     <span class="comment">// waiting to transmit</span>
<a name="l00865"></a>00865     assert(<a class="code" href="classTimingSimpleCPU_1_1TimingCPUPort.html#ace3e131319475077fac2fa861708b0c9">cpu</a>-&gt;<a class="code" href="classTimingSimpleCPU.html#a8cdf6dfb358a155d5422c09f961297fe">dcache_pkt</a> != <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>);
<a name="l00866"></a>00866     assert(<a class="code" href="classTimingSimpleCPU_1_1TimingCPUPort.html#ace3e131319475077fac2fa861708b0c9">cpu</a>-&gt;<a class="code" href="classBaseSimpleCPU.html#a6cdf6e6db875a442f3ab6db542bd2bb5">_status</a> == <a class="code" href="classBaseSimpleCPU.html#a67a0db04d321a74b7e7fcfd3f1a3f70ba0faf54129de01a1d6f0ba1c929e0fa40">DcacheRetry</a>);
<a name="l00867"></a>00867     <a class="code" href="classPacket.html">PacketPtr</a> tmp = <a class="code" href="classTimingSimpleCPU_1_1TimingCPUPort.html#ace3e131319475077fac2fa861708b0c9">cpu</a>-&gt;<a class="code" href="classTimingSimpleCPU.html#a8cdf6dfb358a155d5422c09f961297fe">dcache_pkt</a>;
<a name="l00868"></a>00868     <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="classPacket.html#a983ade0479f946c813284dcc65073367">senderState</a>) {
<a name="l00869"></a>00869         <span class="comment">// This is a packet from a split access.</span>
<a name="l00870"></a>00870         SplitFragmentSenderState * send_state =
<a name="l00871"></a>00871             <span class="keyword">dynamic_cast&lt;</span>SplitFragmentSenderState *<span class="keyword">&gt;</span>(tmp-&gt;<a class="code" href="classPacket.html#a983ade0479f946c813284dcc65073367">senderState</a>);
<a name="l00872"></a>00872         assert(send_state);
<a name="l00873"></a>00873         <a class="code" href="classPacket.html">PacketPtr</a> big_pkt = send_state-&gt;bigPkt;
<a name="l00874"></a>00874         
<a name="l00875"></a>00875         SplitMainSenderState * main_send_state =
<a name="l00876"></a>00876             <span class="keyword">dynamic_cast&lt;</span>SplitMainSenderState *<span class="keyword">&gt;</span>(big_pkt-&gt;<a class="code" href="classPacket.html#a983ade0479f946c813284dcc65073367">senderState</a>);
<a name="l00877"></a>00877         assert(main_send_state);
<a name="l00878"></a>00878 
<a name="l00879"></a>00879         <span class="keywordflow">if</span> (<a class="code" href="classMasterPort.html#aafaf979005392447714384794f1a8610">sendTimingReq</a>(tmp)) {
<a name="l00880"></a>00880             <span class="comment">// If we were able to send without retrying, record that fact</span>
<a name="l00881"></a>00881             <span class="comment">// and try sending the other fragment.</span>
<a name="l00882"></a>00882             send_state-&gt;clearFromParent();
<a name="l00883"></a>00883             <span class="keywordtype">int</span> other_index = main_send_state-&gt;getPendingFragment();
<a name="l00884"></a>00884             <span class="keywordflow">if</span> (other_index &gt; 0) {
<a name="l00885"></a>00885                 tmp = main_send_state-&gt;fragments[other_index];
<a name="l00886"></a>00886                 <a class="code" href="classTimingSimpleCPU_1_1TimingCPUPort.html#ace3e131319475077fac2fa861708b0c9">cpu</a>-&gt;<a class="code" href="classTimingSimpleCPU.html#a8cdf6dfb358a155d5422c09f961297fe">dcache_pkt</a> = tmp;
<a name="l00887"></a>00887                 <span class="keywordflow">if</span> ((big_pkt-&gt;<a class="code" href="classPacket.html#adc47901747fc3c447db3abddaf01491a">isRead</a>() &amp;&amp; <a class="code" href="classTimingSimpleCPU_1_1TimingCPUPort.html#ace3e131319475077fac2fa861708b0c9">cpu</a>-&gt;<a class="code" href="classTimingSimpleCPU.html#a9a8beb0dcad34e8759794cea6639f715">handleReadPacket</a>(tmp)) ||
<a name="l00888"></a>00888                         (big_pkt-&gt;<a class="code" href="classPacket.html#ab699d2f0d186312531fd1c279fd27b73">isWrite</a>() &amp;&amp; <a class="code" href="classTimingSimpleCPU_1_1TimingCPUPort.html#ace3e131319475077fac2fa861708b0c9">cpu</a>-&gt;<a class="code" href="classTimingSimpleCPU.html#a8d70b3b102cd0f4949ae31e84ee2eb98">handleWritePacket</a>())) {
<a name="l00889"></a>00889                     main_send_state-&gt;fragments[other_index] = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00890"></a>00890                 }
<a name="l00891"></a>00891             } <span class="keywordflow">else</span> {
<a name="l00892"></a>00892                 <a class="code" href="classTimingSimpleCPU_1_1TimingCPUPort.html#ace3e131319475077fac2fa861708b0c9">cpu</a>-&gt;<a class="code" href="classBaseSimpleCPU.html#a6cdf6e6db875a442f3ab6db542bd2bb5">_status</a> = <a class="code" href="classBaseSimpleCPU.html#a67a0db04d321a74b7e7fcfd3f1a3f70ba62a98c3fd8f706eefc06ffbf0e657c7b">DcacheWaitResponse</a>;
<a name="l00893"></a>00893                 <span class="comment">// memory system takes ownership of packet</span>
<a name="l00894"></a>00894                 <a class="code" href="classTimingSimpleCPU_1_1TimingCPUPort.html#ace3e131319475077fac2fa861708b0c9">cpu</a>-&gt;<a class="code" href="classTimingSimpleCPU.html#a8cdf6dfb358a155d5422c09f961297fe">dcache_pkt</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00895"></a>00895             }
<a name="l00896"></a>00896         }
<a name="l00897"></a>00897     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classMasterPort.html#aafaf979005392447714384794f1a8610">sendTimingReq</a>(tmp)) {
<a name="l00898"></a>00898         <a class="code" href="classTimingSimpleCPU_1_1TimingCPUPort.html#ace3e131319475077fac2fa861708b0c9">cpu</a>-&gt;<a class="code" href="classBaseSimpleCPU.html#a6cdf6e6db875a442f3ab6db542bd2bb5">_status</a> = <a class="code" href="classBaseSimpleCPU.html#a67a0db04d321a74b7e7fcfd3f1a3f70ba62a98c3fd8f706eefc06ffbf0e657c7b">DcacheWaitResponse</a>;
<a name="l00899"></a>00899         <span class="comment">// memory system takes ownership of packet</span>
<a name="l00900"></a>00900         <a class="code" href="classTimingSimpleCPU_1_1TimingCPUPort.html#ace3e131319475077fac2fa861708b0c9">cpu</a>-&gt;<a class="code" href="classTimingSimpleCPU.html#a8cdf6dfb358a155d5422c09f961297fe">dcache_pkt</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00901"></a>00901     }
<a name="l00902"></a>00902 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a482dba5588f4bee43e498875a61e5e0b"></a><!-- doxytag: member="TimingSimpleCPU::DcachePort::recvTimingResp" ref="a482dba5588f4bee43e498875a61e5e0b" args="(PacketPtr pkt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool recvTimingResp </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classPacket.html">PacketPtr</a>&nbsp;</td>
          <td class="paramname"> <em>pkt</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Receive a timing response from the slave port. </p>

<p><a class="el" href="classMasterPort.html#abd323548d6c93f8b0543f1fe3a86ca35">MasterPort</a>を実装しています。</p>

<p><div class="fragment"><pre class="fragment"><a name="l00832"></a>00832 {
<a name="l00833"></a>00833     <span class="comment">// delay processing of returned data until next CPU clock edge</span>
<a name="l00834"></a>00834     <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> next_tick = <a class="code" href="classTimingSimpleCPU_1_1TimingCPUPort.html#ace3e131319475077fac2fa861708b0c9">cpu</a>-&gt;clockEdge();
<a name="l00835"></a>00835 
<a name="l00836"></a>00836     <span class="keywordflow">if</span> (next_tick == <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The universal simulation clock.">curTick</a>()) {
<a name="l00837"></a>00837         <a class="code" href="classTimingSimpleCPU_1_1TimingCPUPort.html#ace3e131319475077fac2fa861708b0c9">cpu</a>-&gt;<a class="code" href="classTimingSimpleCPU.html#a0f7f0d3412bbf494cd3d0c0f48e5fcf2">completeDataAccess</a>(pkt);
<a name="l00838"></a>00838     } <span class="keywordflow">else</span> {
<a name="l00839"></a>00839         <span class="keywordflow">if</span> (!<a class="code" href="classTimingSimpleCPU_1_1DcachePort.html#a49142331c4285494b26819ad5d97f545">tickEvent</a>.scheduled()) {
<a name="l00840"></a>00840             <a class="code" href="classTimingSimpleCPU_1_1DcachePort.html#a49142331c4285494b26819ad5d97f545">tickEvent</a>.schedule(pkt, next_tick);
<a name="l00841"></a>00841         } <span class="keywordflow">else</span> {
<a name="l00842"></a>00842             <span class="comment">// In the case of a split transaction and a cache that is</span>
<a name="l00843"></a>00843             <span class="comment">// faster than a CPU we could get two responses before</span>
<a name="l00844"></a>00844             <span class="comment">// next_tick expires</span>
<a name="l00845"></a>00845             <span class="keywordflow">if</span> (!<a class="code" href="classTimingSimpleCPU_1_1TimingCPUPort.html#a4afea62519871edec5a95131972c4952">retryEvent</a>.<a class="code" href="classEvent.html#a9cd69a6b10cb037550943f177a0da688" title="Determine if the current event is scheduled.">scheduled</a>())
<a name="l00846"></a>00846                 <a class="code" href="classTimingSimpleCPU_1_1TimingCPUPort.html#ace3e131319475077fac2fa861708b0c9">cpu</a>-&gt;schedule(<a class="code" href="classTimingSimpleCPU_1_1TimingCPUPort.html#a4afea62519871edec5a95131972c4952">retryEvent</a>, next_tick);
<a name="l00847"></a>00847             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00848"></a>00848         }
<a name="l00849"></a>00849     }
<a name="l00850"></a>00850 
<a name="l00851"></a>00851     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00852"></a>00852 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aff3031c56fc4947a19695c868bb8233e"></a><!-- doxytag: member="TimingSimpleCPU::DcachePort::recvTimingSnoopReq" ref="aff3031c56fc4947a19695c868bb8233e" args="(PacketPtr pkt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void recvTimingSnoopReq </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classPacket.html">PacketPtr</a>&nbsp;</td>
          <td class="paramname"> <em>pkt</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Snoop a coherence request, we need to check if this causes a wakeup event on a cpu that is monitoring an address </p>

<p><a class="el" href="classTimingSimpleCPU_1_1TimingCPUPort.html#ae43c73eff109f907118829fcfa9e7096">TimingCPUPort</a>を再定義しています。</p>

<p><div class="fragment"><pre class="fragment"><a name="l00825"></a>00825 {
<a name="l00826"></a>00826     <a class="code" href="namespaceAlphaISA.html#aae6ad66df5dfd5de14b36293aaf2e7f1">TheISA::handleLockedSnoop</a>(<a class="code" href="classTimingSimpleCPU_1_1TimingCPUPort.html#ace3e131319475077fac2fa861708b0c9">cpu</a>-&gt;<a class="code" href="classBaseSimpleCPU.html#af9572fa907cd21b54cb14bd626010d39">thread</a>, pkt, <a class="code" href="classTimingSimpleCPU_1_1DcachePort.html#af4264b12b32db39099b579e1ed670312">cacheBlockMask</a>);
<a name="l00827"></a>00827 }
</pre></div></p>

</div>
</div>
<hr/><h2>変数</h2>
<a class="anchor" id="af4264b12b32db39099b579e1ed670312"></a><!-- doxytag: member="TimingSimpleCPU::DcachePort::cacheBlockMask" ref="af4264b12b32db39099b579e1ed670312" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a> <a class="el" href="classTimingSimpleCPU_1_1DcachePort.html#af4264b12b32db39099b579e1ed670312">cacheBlockMask</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a49142331c4285494b26819ad5d97f545"></a><!-- doxytag: member="TimingSimpleCPU::DcachePort::tickEvent" ref="a49142331c4285494b26819ad5d97f545" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structTimingSimpleCPU_1_1DcachePort_1_1DTickEvent.html">DTickEvent</a> <a class="el" href="classTimingSimpleCPU_1_1DcachePort.html#a49142331c4285494b26819ad5d97f545">tickEvent</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/>このクラスの説明は次のファイルから生成されました:<ul>
<li>cpu/simple/<a class="el" href="timing_8hh_source.html">timing.hh</a></li>
<li>cpu/simple/<a class="el" href="timing_8cc.html">timing.cc</a></li>
</ul>
</div>
<hr size="1"/><address style="text-align: right;"><small>File&nbsp;GEM5&nbsp;Wrapperに対して25 May 2015に生成されました。&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
