<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>File&nbsp;GEM5&nbsp;Wrapper: クラス CopyEngine</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- 作成： Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>メインページ</span></a></li>
      <li><a href="pages.html"><span>関連ページ</span></a></li>
      <li><a href="modules.html"><span>モジュール</span></a></li>
      <li><a href="namespaces.html"><span>ネームスペース</span></a></li>
      <li class="current"><a href="annotated.html"><span>クラス</span></a></li>
      <li><a href="files.html"><span>ファイル</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>構成</span></a></li>
      <li><a href="classes.html"><span>構成索引</span></a></li>
      <li><a href="hierarchy.html"><span>クラス階層</span></a></li>
      <li><a href="functions.html"><span>構成メンバ</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>クラス CopyEngine</h1><!-- doxytag: class="CopyEngine" --><!-- doxytag: inherits="PciDevice" -->
<p><code>#include &lt;<a class="el" href="copy__engine_8hh_source.html">copy_engine.hh</a>&gt;</code></p>
<div class="dynheader">
CopyEngineに対する継承グラフ</div>
<div class="dynsection">
 <div class="center">
  <img src="classCopyEngine.gif" usemap="#CopyEngine_map" alt=""/>
  <map id="CopyEngine_map" name="CopyEngine_map">
<area href="classPciDevice.html" alt="PciDevice" shape="rect" coords="105,336,200,360"/>
<area href="classDmaDevice.html" alt="DmaDevice" shape="rect" coords="105,280,200,304"/>
<area href="classPioDevice.html" alt="PioDevice" shape="rect" coords="105,224,200,248"/>
<area href="classMemObject.html" alt="MemObject" shape="rect" coords="105,168,200,192"/>
<area href="classClockedObject.html" alt="ClockedObject" shape="rect" coords="105,112,200,136"/>
<area href="classSimObject.html" alt="SimObject" shape="rect" coords="105,56,200,80"/>
<area href="classEventManager.html" alt="EventManager" shape="rect" coords="0,0,95,24"/>
<area href="classSerializable.html" alt="Serializable" shape="rect" coords="105,0,200,24"/>
<area href="classDrainable.html" alt="Drainable" shape="rect" coords="210,0,305,24"/>
</map>
 </div>
</div>

<p><a href="classCopyEngine-members.html">すべてのメンバ一覧</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>構成</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCopyEngine_1_1CopyEngine.html">CopyEngine</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCopyEngine_1_1CopyEngineChannel.html">CopyEngineChannel</a></td></tr>
<tr><td colspan="2"><h2>Public 型</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef CopyEngineParams&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCopyEngine.html#a0b0580d58d6a0384646682653aefb97a">Params</a></td></tr>
<tr><td colspan="2"><h2>Public メソッド</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const <a class="el" href="classCopyEngine.html#a0b0580d58d6a0384646682653aefb97a">Params</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCopyEngine.html#acd3c3feb78ae7a8f88fe0f110a718dff">params</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCopyEngine.html#a7042a20ebc60002d8be8c1dd2cc77d24">CopyEngine</a> (const <a class="el" href="classCopyEngine.html#a0b0580d58d6a0384646682653aefb97a">Params</a> *params)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCopyEngine.html#a1e9353806b1e8062eac347916ca32ac7">~CopyEngine</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCopyEngine.html#a4dc637449366fcdfc4e764cdf12d9b11">regStats</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="classBaseMasterPort.html">BaseMasterPort</a> &amp;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCopyEngine.html#adc4e675e51defbdd1e354dac729d0703">getMasterPort</a> (const std::string &amp;if_name, <a class="el" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a> idx=<a class="el" href="base_2types_8hh.html#a65bf40f138cf863f0c5e2d8ca1144126">InvalidPortID</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCopyEngine.html#a613ec7d5e1ec64f8d21fec78ae8e568e">read</a> (<a class="el" href="classPacket.html">PacketPtr</a> pkt)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCopyEngine.html#a4cefab464e72b5dd42c003a0a4341802">write</a> (<a class="el" href="classPacket.html">PacketPtr</a> pkt)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCopyEngine.html#a53e036786d17361be4c7320d39c99b84">serialize</a> (std::ostream &amp;os)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCopyEngine.html#af22e5d6d660b97db37003ac61ac4ee49">unserialize</a> (<a class="el" href="classCheckpoint.html">Checkpoint</a> *cp, const std::string &amp;section)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCopyEngine.html#a6bf479c521c7c3eb473822d953275b26">drain</a> (<a class="el" href="classDrainManager.html">DrainManager</a> *drainManger)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCopyEngine.html#a8f020d3237536fe007fc488c4125c5d8">drainResume</a> ()</td></tr>
<tr><td colspan="2"><h2>Private 変数</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classStats_1_1Vector.html">Stats::Vector</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCopyEngine.html#a25b7da20ae9cf014c7806abf1bf929b3">bytesCopied</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classStats_1_1Vector.html">Stats::Vector</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCopyEngine.html#a2c7c96445b0cb37f72b61dae4d2c541d">copiesProcessed</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structCopyEngineReg_1_1Regs.html">CopyEngineReg::Regs</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCopyEngine.html#ac3a32787c71b25fdee473de0804efa29">regs</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classstd_1_1vector.html">std::vector</a>&lt; <a class="el" href="classCopyEngine_1_1CopyEngineChannel.html">CopyEngineChannel</a> * &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCopyEngine.html#a2fa0132c83d16e1e404f54278dcf94c4">chan</a></td></tr>
</table>
<hr/><h2>型定義</h2>
<a class="anchor" id="a0b0580d58d6a0384646682653aefb97a"></a><!-- doxytag: member="CopyEngine::Params" ref="a0b0580d58d6a0384646682653aefb97a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef CopyEngineParams <a class="el" href="classCopyEngine.html#a0b0580d58d6a0384646682653aefb97a">Params</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><a class="el" href="classPciDevice.html#aefbfd3f2d9daf3173b779eeff32e8112">PciDevice</a>を再定義しています。</p>

</div>
</div>
<hr/><h2>コンストラクタとデストラクタ</h2>
<a class="anchor" id="a7042a20ebc60002d8be8c1dd2cc77d24"></a><!-- doxytag: member="CopyEngine::CopyEngine" ref="a7042a20ebc60002d8be8c1dd2cc77d24" args="(const Params *params)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classCopyEngine_1_1CopyEngine.html">CopyEngine</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classCopyEngine.html#a0b0580d58d6a0384646682653aefb97a">Params</a> *&nbsp;</td>
          <td class="paramname"> <em>params</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00063"></a>00063     : <a class="code" href="classPciDevice.html#ab3ecd08d152a6a949c1e6a2d48a9afd5">PciDevice</a>(<a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a>)
<a name="l00064"></a>00064 {
<a name="l00065"></a>00065     <span class="comment">// All Reg regs are initialized to 0 by default</span>
<a name="l00066"></a>00066     <a class="code" href="classCopyEngine.html#ac3a32787c71b25fdee473de0804efa29">regs</a>.<a class="code" href="structCopyEngineReg_1_1Regs.html#a72591202604201c764b2d2330de87eb9">chanCount</a> = <a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a>-&gt;ChanCnt;
<a name="l00067"></a>00067     <a class="code" href="classCopyEngine.html#ac3a32787c71b25fdee473de0804efa29">regs</a>.<a class="code" href="structCopyEngineReg_1_1Regs.html#ad07b5a14bd75791ecb3aec74efe132ac">xferCap</a> = <a class="code" href="bitfield_8hh.html#aa8f1ff3b89ba9c337baeef12d161580f">findMsbSet</a>(<a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a>-&gt;XferCap);
<a name="l00068"></a>00068     <a class="code" href="classCopyEngine.html#ac3a32787c71b25fdee473de0804efa29">regs</a>.<a class="code" href="structCopyEngineReg_1_1Regs.html#a96b8c5009091673411f229448c8d2de1">attnStatus</a> = 0;
<a name="l00069"></a>00069 
<a name="l00070"></a>00070     <span class="keywordflow">if</span> (<a class="code" href="classCopyEngine.html#ac3a32787c71b25fdee473de0804efa29">regs</a>.<a class="code" href="structCopyEngineReg_1_1Regs.html#a72591202604201c764b2d2330de87eb9">chanCount</a> &gt; 64)
<a name="l00071"></a>00071         <a class="code" href="base_2misc_8hh.html#acad519418dbfdd70c1208711e609c80e">fatal</a>(<span class="stringliteral">&quot;CopyEngine interface doesn&apos;t support more than 64 DMA engines\n&quot;</span>);
<a name="l00072"></a>00072 
<a name="l00073"></a>00073     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespaceX86ISA.html#ab5f9a01fc40e47853ae9551b008afcbd">x</a> = 0; <a class="code" href="namespaceX86ISA.html#ab5f9a01fc40e47853ae9551b008afcbd">x</a> &lt; <a class="code" href="classCopyEngine.html#ac3a32787c71b25fdee473de0804efa29">regs</a>.<a class="code" href="structCopyEngineReg_1_1Regs.html#a72591202604201c764b2d2330de87eb9">chanCount</a>; <a class="code" href="namespaceX86ISA.html#ab5f9a01fc40e47853ae9551b008afcbd">x</a>++) {
<a name="l00074"></a>00074         CopyEngineChannel *ch = <span class="keyword">new</span> CopyEngineChannel(<span class="keyword">this</span>, <a class="code" href="namespaceX86ISA.html#ab5f9a01fc40e47853ae9551b008afcbd">x</a>);
<a name="l00075"></a>00075         <a class="code" href="classCopyEngine.html#a2fa0132c83d16e1e404f54278dcf94c4">chan</a>.push_back(ch);
<a name="l00076"></a>00076     }
<a name="l00077"></a>00077 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1e9353806b1e8062eac347916ca32ac7"></a><!-- doxytag: member="CopyEngine::~CopyEngine" ref="a1e9353806b1e8062eac347916ca32ac7" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">~<a class="el" href="classCopyEngine_1_1CopyEngine.html">CopyEngine</a> </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00101"></a>00101 {
<a name="l00102"></a>00102     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespaceX86ISA.html#ab5f9a01fc40e47853ae9551b008afcbd">x</a> = 0; <a class="code" href="namespaceX86ISA.html#ab5f9a01fc40e47853ae9551b008afcbd">x</a> &lt; <a class="code" href="classCopyEngine.html#a2fa0132c83d16e1e404f54278dcf94c4">chan</a>.size(); <a class="code" href="namespaceX86ISA.html#ab5f9a01fc40e47853ae9551b008afcbd">x</a>++) {
<a name="l00103"></a>00103         <span class="keyword">delete</span> <a class="code" href="classCopyEngine.html#a2fa0132c83d16e1e404f54278dcf94c4">chan</a>[<a class="code" href="namespaceX86ISA.html#ab5f9a01fc40e47853ae9551b008afcbd">x</a>];
<a name="l00104"></a>00104     }
<a name="l00105"></a>00105 }
</pre></div></p>

</div>
</div>
<hr/><h2>関数</h2>
<a class="anchor" id="a6bf479c521c7c3eb473822d953275b26"></a><!-- doxytag: member="CopyEngine::drain" ref="a6bf479c521c7c3eb473822d953275b26" args="(DrainManager *drainManger)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int drain </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classDrainManager.html">DrainManager</a> *&nbsp;</td>
          <td class="paramname"> <em>drainManger</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Provide a default implementation of the drain interface that simply returns 0 (draining completed) and sets the drain state to Drained. </p>

<p><a class="el" href="classPciDevice.html#aa8a18d230dba7a674ac8a0b4f35bc36a">PciDevice</a>を再定義しています。</p>

<p><div class="fragment"><pre class="fragment"><a name="l00665"></a>00665 {
<a name="l00666"></a>00666     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespaceX86ISA.html#a668f84c330035fdb72824eb18e09cd09">count</a>;
<a name="l00667"></a>00667     count = <a class="code" href="classPioDevice.html#a13e5e3439c77b7b772e2e11df33fd700">pioPort</a>.<a class="code" href="classQueuedSlavePort.html#aa8a18d230dba7a674ac8a0b4f35bc36a">drain</a>(<a class="code" href="namespaceMipsISA.html#a2575c29e7f4617b6076486f340b6fe19">dm</a>) + <a class="code" href="classDmaDevice.html#a0e844de222006d2f1aadb8f01d8f383b">dmaPort</a>.<a class="code" href="classDmaPort.html#a6bf479c521c7c3eb473822d953275b26">drain</a>(<a class="code" href="namespaceMipsISA.html#a2575c29e7f4617b6076486f340b6fe19">dm</a>) + <a class="code" href="classPciDevice.html#a3c911166270cab77d55e5bc6626e8a05">configPort</a>.<a class="code" href="classQueuedSlavePort.html#aa8a18d230dba7a674ac8a0b4f35bc36a">drain</a>(<a class="code" href="namespaceMipsISA.html#a2575c29e7f4617b6076486f340b6fe19">dm</a>);
<a name="l00668"></a>00668     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespaceX86ISA.html#ab5f9a01fc40e47853ae9551b008afcbd">x</a> = 0;<a class="code" href="namespaceX86ISA.html#ab5f9a01fc40e47853ae9551b008afcbd">x</a> &lt; <a class="code" href="classCopyEngine.html#a2fa0132c83d16e1e404f54278dcf94c4">chan</a>.size(); <a class="code" href="namespaceX86ISA.html#ab5f9a01fc40e47853ae9551b008afcbd">x</a>++)
<a name="l00669"></a>00669         count += <a class="code" href="classCopyEngine.html#a2fa0132c83d16e1e404f54278dcf94c4">chan</a>[<a class="code" href="namespaceX86ISA.html#ab5f9a01fc40e47853ae9551b008afcbd">x</a>]-&gt;<a class="code" href="classCopyEngine.html#a6bf479c521c7c3eb473822d953275b26">drain</a>(<a class="code" href="namespaceMipsISA.html#a2575c29e7f4617b6076486f340b6fe19">dm</a>);
<a name="l00670"></a>00670 
<a name="l00671"></a>00671     <span class="keywordflow">if</span> (count)
<a name="l00672"></a>00672         <a class="code" href="classDrainable.html#ad800905390fe03e850cf996e914038f9">setDrainState</a>(<a class="code" href="classDrainable.html#a5d74787dedbc4e11c1ab15bf487e61f8a929d17847bfad0d4689c9ab8540d5134">Draining</a>);
<a name="l00673"></a>00673     <span class="keywordflow">else</span>
<a name="l00674"></a>00674         <a class="code" href="classDrainable.html#ad800905390fe03e850cf996e914038f9">setDrainState</a>(<a class="code" href="classDrainable.html#a5d74787dedbc4e11c1ab15bf487e61f8a5656955cb808502a2ec75b367e2c1e82">Drained</a>);
<a name="l00675"></a>00675 
<a name="l00676"></a>00676     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Drain, <span class="stringliteral">&quot;CopyEngine not drained\n&quot;</span>);
<a name="l00677"></a>00677     <span class="keywordflow">return</span> count;
<a name="l00678"></a>00678 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8f020d3237536fe007fc488c4125c5d8"></a><!-- doxytag: member="CopyEngine::drainResume" ref="a8f020d3237536fe007fc488c4125c5d8" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void drainResume </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Resume execution after a successful drain.</p>
<dl class="note"><dt><b>覚え書き:</b></dt><dd>This method is normally only called from the simulation scripts. </dd></dl>

<p><a class="el" href="classDrainable.html#a8f020d3237536fe007fc488c4125c5d8">Drainable</a>を再定義しています。</p>

<p><div class="fragment"><pre class="fragment"><a name="l00764"></a>00764 {
<a name="l00765"></a>00765     <a class="code" href="classCopyEngine.html#a8f020d3237536fe007fc488c4125c5d8">Drainable::drainResume</a>();
<a name="l00766"></a>00766     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespaceX86ISA.html#ab5f9a01fc40e47853ae9551b008afcbd">x</a> = 0;<a class="code" href="namespaceX86ISA.html#ab5f9a01fc40e47853ae9551b008afcbd">x</a> &lt; <a class="code" href="classCopyEngine.html#a2fa0132c83d16e1e404f54278dcf94c4">chan</a>.size(); <a class="code" href="namespaceX86ISA.html#ab5f9a01fc40e47853ae9551b008afcbd">x</a>++)
<a name="l00767"></a>00767         <a class="code" href="classCopyEngine.html#a2fa0132c83d16e1e404f54278dcf94c4">chan</a>[<a class="code" href="namespaceX86ISA.html#ab5f9a01fc40e47853ae9551b008afcbd">x</a>]-&gt;<a class="code" href="classCopyEngine.html#a8f020d3237536fe007fc488c4125c5d8">drainResume</a>();
<a name="l00768"></a>00768 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="adc4e675e51defbdd1e354dac729d0703"></a><!-- doxytag: member="CopyEngine::getMasterPort" ref="adc4e675e51defbdd1e354dac729d0703" args="(const std::string &amp;if_name, PortID idx=InvalidPortID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classBaseMasterPort.html">BaseMasterPort</a> &amp; getMasterPort </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&nbsp;</td>
          <td class="paramname"> <em>if_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a>&nbsp;</td>
          <td class="paramname"> <em>idx</em> = <code><a class="el" href="base_2types_8hh.html#a65bf40f138cf863f0c5e2d8ca1144126">InvalidPortID</a></code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Get a master port with a given name and index. This is used at binding time and returns a reference to a protocol-agnostic base master port.</p>
<dl><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>if_name</em>&nbsp;</td><td><a class="el" href="classPort.html">Port</a> name </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>idx</em>&nbsp;</td><td>Index in the case of a VectorPort</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>戻り値:</b></dt><dd>A reference to the given port </dd></dl>

<p><a class="el" href="classDmaDevice.html#adc4e675e51defbdd1e354dac729d0703">DmaDevice</a>を再定義しています。</p>

<p><div class="fragment"><pre class="fragment"><a name="l00115"></a>00115 {
<a name="l00116"></a>00116     <span class="keywordflow">if</span> (if_name != <span class="stringliteral">&quot;dma&quot;</span>) {
<a name="l00117"></a>00117         <span class="comment">// pass it along to our super class</span>
<a name="l00118"></a>00118         <span class="keywordflow">return</span> <a class="code" href="classCopyEngine.html#adc4e675e51defbdd1e354dac729d0703">PciDevice::getMasterPort</a>(if_name, idx);
<a name="l00119"></a>00119     } <span class="keywordflow">else</span> {
<a name="l00120"></a>00120         <span class="keywordflow">if</span> (idx &gt;= static_cast&lt;int&gt;(<a class="code" href="classCopyEngine.html#a2fa0132c83d16e1e404f54278dcf94c4">chan</a>.size())) {
<a name="l00121"></a>00121             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;CopyEngine::getMasterPort: unknown index %d\n&quot;</span>, idx);
<a name="l00122"></a>00122         }
<a name="l00123"></a>00123 
<a name="l00124"></a>00124         <span class="keywordflow">return</span> <a class="code" href="classCopyEngine.html#a2fa0132c83d16e1e404f54278dcf94c4">chan</a>[idx]-&gt;getMasterPort();
<a name="l00125"></a>00125     }
<a name="l00126"></a>00126 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="acd3c3feb78ae7a8f88fe0f110a718dff"></a><!-- doxytag: member="CopyEngine::params" ref="acd3c3feb78ae7a8f88fe0f110a718dff" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="classCopyEngine.html#a0b0580d58d6a0384646682653aefb97a">Params</a>* params </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><a class="el" href="classPciDevice.html#acd3c3feb78ae7a8f88fe0f110a718dff">PciDevice</a>を再定義しています。</p>

<p><div class="fragment"><pre class="fragment"><a name="l00194"></a>00194     {
<a name="l00195"></a>00195         <span class="keywordflow">return</span> <span class="keyword">dynamic_cast&lt;</span><span class="keyword">const </span><a class="code" href="classCopyEngine.html#a0b0580d58d6a0384646682653aefb97a">Params</a> *<span class="keyword">&gt;</span>(<a class="code" href="classSimObject.html#acaf6024ae9dda44bfb1c67e05ad70aef">_params</a>);
<a name="l00196"></a>00196     }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a613ec7d5e1ec64f8d21fec78ae8e568e"></a><!-- doxytag: member="CopyEngine::read" ref="a613ec7d5e1ec64f8d21fec78ae8e568e" args="(PacketPtr pkt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> read </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classPacket.html">PacketPtr</a>&nbsp;</td>
          <td class="paramname"> <em>pkt</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Pure virtual function that the device must implement. Called when a read command is recieved by the port. </p>
<dl><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pkt</em>&nbsp;</td><td><a class="el" href="classPacket.html">Packet</a> describing this request </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>戻り値:</b></dt><dd>number of ticks it took to complete </dd></dl>

<p><p>Handle read of register here</p>
<p>Channel registers are handled here</p>
</p>

<p><a class="el" href="classPioDevice.html#a842312590432036092c422c87a442358">PioDevice</a>を実装しています。</p>

<p><div class="fragment"><pre class="fragment"><a name="l00167"></a>00167 {
<a name="l00168"></a>00168     <span class="keywordtype">int</span> bar;
<a name="l00169"></a>00169     <a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a> daddr;
<a name="l00170"></a>00170 
<a name="l00171"></a>00171     <span class="keywordflow">if</span> (!<a class="code" href="classPciDevice.html#ad7fbff3ce8627dac12313ed7ac1ea44a">getBAR</a>(pkt-&gt;<a class="code" href="classPacket.html#afca9af4d83a57836baba87603463a6e0">getAddr</a>(), bar, daddr))
<a name="l00172"></a>00172         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Invalid PCI memory access to unmapped memory.\n&quot;</span>);
<a name="l00173"></a>00173 
<a name="l00174"></a>00174     <span class="comment">// Only Memory register BAR is allowed</span>
<a name="l00175"></a>00175     assert(bar == 0);
<a name="l00176"></a>00176 
<a name="l00177"></a>00177     <span class="keywordtype">int</span> size = pkt-&gt;<a class="code" href="classPacket.html#a1d18ba49c7be427da1f4a42d53e35f48">getSize</a>();
<a name="l00178"></a>00178     <span class="keywordflow">if</span> (size != <span class="keyword">sizeof</span>(uint64_t) &amp;&amp; size != <span class="keyword">sizeof</span>(<a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>) &amp;&amp;
<a name="l00179"></a>00179         size != <span class="keyword">sizeof</span>(uint16_t) &amp;&amp; size != <span class="keyword">sizeof</span>(uint8_t)) {
<a name="l00180"></a>00180         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Unknown size for MMIO access: %d\n&quot;</span>, pkt-&gt;<a class="code" href="classPacket.html#a1d18ba49c7be427da1f4a42d53e35f48">getSize</a>());
<a name="l00181"></a>00181     }
<a name="l00182"></a>00182 
<a name="l00183"></a>00183     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DMACopyEngine, <span class="stringliteral">&quot;Read device register %#X size: %d\n&quot;</span>, daddr, size);
<a name="l00184"></a>00184 
<a name="l00185"></a>00185     pkt-&gt;<a class="code" href="classPacket.html#acaefe811b78a2fdc4a0dba0c4029c3ef">allocate</a>();
<a name="l00186"></a>00186 
<a name="l00190"></a>00190 
<a name="l00191"></a>00191     <span class="keywordflow">if</span> (daddr &lt; 0x80) {
<a name="l00192"></a>00192         <span class="keywordflow">switch</span> (daddr) {
<a name="l00193"></a>00193           <span class="keywordflow">case</span> <a class="code" href="namespaceCopyEngineReg.html#a14c18458452291938d4152a65e037928">GEN_CHANCOUNT</a>:
<a name="l00194"></a>00194             assert(size == <span class="keyword">sizeof</span>(<a class="code" href="classCopyEngine.html#ac3a32787c71b25fdee473de0804efa29">regs</a>.<a class="code" href="structCopyEngineReg_1_1Regs.html#a72591202604201c764b2d2330de87eb9">chanCount</a>));
<a name="l00195"></a>00195             pkt-&gt;<a class="code" href="classPacket.html#a64d947d8dd285398050238bf26c1d8d2">set</a>&lt;uint8_t&gt;(<a class="code" href="classCopyEngine.html#ac3a32787c71b25fdee473de0804efa29">regs</a>.<a class="code" href="structCopyEngineReg_1_1Regs.html#a72591202604201c764b2d2330de87eb9">chanCount</a>);
<a name="l00196"></a>00196             <span class="keywordflow">break</span>;
<a name="l00197"></a>00197           <span class="keywordflow">case</span> <a class="code" href="namespaceCopyEngineReg.html#ac0068780087938924e6ad21074d945d9">GEN_XFERCAP</a>:
<a name="l00198"></a>00198             assert(size == <span class="keyword">sizeof</span>(<a class="code" href="classCopyEngine.html#ac3a32787c71b25fdee473de0804efa29">regs</a>.<a class="code" href="structCopyEngineReg_1_1Regs.html#ad07b5a14bd75791ecb3aec74efe132ac">xferCap</a>));
<a name="l00199"></a>00199             pkt-&gt;<a class="code" href="classPacket.html#a64d947d8dd285398050238bf26c1d8d2">set</a>&lt;uint8_t&gt;(<a class="code" href="classCopyEngine.html#ac3a32787c71b25fdee473de0804efa29">regs</a>.<a class="code" href="structCopyEngineReg_1_1Regs.html#ad07b5a14bd75791ecb3aec74efe132ac">xferCap</a>);
<a name="l00200"></a>00200             <span class="keywordflow">break</span>;
<a name="l00201"></a>00201           <span class="keywordflow">case</span> <a class="code" href="namespaceCopyEngineReg.html#abd37ea26b220f895c1d50b0b94654a23">GEN_INTRCTRL</a>:
<a name="l00202"></a>00202             assert(size == <span class="keyword">sizeof</span>(uint8_t));
<a name="l00203"></a>00203             pkt-&gt;<a class="code" href="classPacket.html#a64d947d8dd285398050238bf26c1d8d2">set</a>&lt;uint8_t&gt;(<a class="code" href="classCopyEngine.html#ac3a32787c71b25fdee473de0804efa29">regs</a>.<a class="code" href="structCopyEngineReg_1_1Regs.html#adb90603779b60249df8136e1537ebeb7">intrctrl</a>());
<a name="l00204"></a>00204             <a class="code" href="classCopyEngine.html#ac3a32787c71b25fdee473de0804efa29">regs</a>.<a class="code" href="structCopyEngineReg_1_1Regs.html#adb90603779b60249df8136e1537ebeb7">intrctrl</a>.master_int_enable(0);
<a name="l00205"></a>00205             <span class="keywordflow">break</span>;
<a name="l00206"></a>00206           <span class="keywordflow">case</span> <a class="code" href="namespaceCopyEngineReg.html#af80eb1e2939758c39cde1c3383b8a329">GEN_ATTNSTATUS</a>:
<a name="l00207"></a>00207             assert(size == <span class="keyword">sizeof</span>(<a class="code" href="classCopyEngine.html#ac3a32787c71b25fdee473de0804efa29">regs</a>.<a class="code" href="structCopyEngineReg_1_1Regs.html#a96b8c5009091673411f229448c8d2de1">attnStatus</a>));
<a name="l00208"></a>00208             pkt-&gt;<a class="code" href="classPacket.html#a64d947d8dd285398050238bf26c1d8d2">set</a>&lt;<a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&gt;(<a class="code" href="classCopyEngine.html#ac3a32787c71b25fdee473de0804efa29">regs</a>.<a class="code" href="structCopyEngineReg_1_1Regs.html#a96b8c5009091673411f229448c8d2de1">attnStatus</a>);
<a name="l00209"></a>00209             <a class="code" href="classCopyEngine.html#ac3a32787c71b25fdee473de0804efa29">regs</a>.<a class="code" href="structCopyEngineReg_1_1Regs.html#a96b8c5009091673411f229448c8d2de1">attnStatus</a> = 0;
<a name="l00210"></a>00210             <span class="keywordflow">break</span>;
<a name="l00211"></a>00211           <span class="keywordflow">default</span>:
<a name="l00212"></a>00212             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Read request to unknown register number: %#x\n&quot;</span>, daddr);
<a name="l00213"></a>00213         }
<a name="l00214"></a>00214         pkt-&gt;<a class="code" href="classPacket.html#ad664e704f09d6bb5c116573721034ebd">makeAtomicResponse</a>();
<a name="l00215"></a>00215         <span class="keywordflow">return</span> <a class="code" href="classPciDevice.html#ac8e969635a78ab9ab123904ccca434cc">pioDelay</a>;
<a name="l00216"></a>00216     }
<a name="l00217"></a>00217 
<a name="l00218"></a>00218 
<a name="l00219"></a>00219     <span class="comment">// Find which channel we&apos;re accessing</span>
<a name="l00220"></a>00220     <span class="keywordtype">int</span> chanid = 0;
<a name="l00221"></a>00221     daddr -= 0x80;
<a name="l00222"></a>00222     <span class="keywordflow">while</span> (daddr &gt;= 0x80) {
<a name="l00223"></a>00223         chanid++;
<a name="l00224"></a>00224         daddr -= 0x80;
<a name="l00225"></a>00225     }
<a name="l00226"></a>00226 
<a name="l00227"></a>00227     <span class="keywordflow">if</span> (chanid &gt;= <a class="code" href="classCopyEngine.html#ac3a32787c71b25fdee473de0804efa29">regs</a>.<a class="code" href="structCopyEngineReg_1_1Regs.html#a72591202604201c764b2d2330de87eb9">chanCount</a>)
<a name="l00228"></a>00228         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Access to channel %d (device only configured for %d channels)&quot;</span>,
<a name="l00229"></a>00229                 chanid, <a class="code" href="classCopyEngine.html#ac3a32787c71b25fdee473de0804efa29">regs</a>.<a class="code" href="structCopyEngineReg_1_1Regs.html#a72591202604201c764b2d2330de87eb9">chanCount</a>);
<a name="l00230"></a>00230 
<a name="l00234"></a>00234     <a class="code" href="classCopyEngine.html#a2fa0132c83d16e1e404f54278dcf94c4">chan</a>[chanid]-&gt;channelRead(pkt, daddr, size);
<a name="l00235"></a>00235 
<a name="l00236"></a>00236     pkt-&gt;<a class="code" href="classPacket.html#ad664e704f09d6bb5c116573721034ebd">makeAtomicResponse</a>();
<a name="l00237"></a>00237     <span class="keywordflow">return</span> <a class="code" href="classPciDevice.html#ac8e969635a78ab9ab123904ccca434cc">pioDelay</a>;
<a name="l00238"></a>00238 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4dc637449366fcdfc4e764cdf12d9b11"></a><!-- doxytag: member="CopyEngine::regStats" ref="a4dc637449366fcdfc4e764cdf12d9b11" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void regStats </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p><a class="el" href="classRegister.html">Register</a> statistics for this object. </p>

<p><a class="el" href="classSimObject.html#a4dc637449366fcdfc4e764cdf12d9b11">SimObject</a>を再定義しています。</p>

<p><div class="fragment"><pre class="fragment"><a name="l00428"></a>00428 {
<a name="l00429"></a>00429     <span class="keyword">using namespace </span>Stats;
<a name="l00430"></a>00430     <a class="code" href="classCopyEngine.html#a25b7da20ae9cf014c7806abf1bf929b3">bytesCopied</a>
<a name="l00431"></a>00431         .<a class="code" href="classStats_1_1VectorBase.html#ae41cad1a02eeb7958df026d8e2cc7582">init</a>(<a class="code" href="classCopyEngine.html#ac3a32787c71b25fdee473de0804efa29">regs</a>.<a class="code" href="structCopyEngineReg_1_1Regs.html#a72591202604201c764b2d2330de87eb9">chanCount</a>)
<a name="l00432"></a>00432         .name(<a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>() + <span class="stringliteral">&quot;.bytes_copied&quot;</span>)
<a name="l00433"></a>00433         .desc(<span class="stringliteral">&quot;Number of bytes copied by each engine&quot;</span>)
<a name="l00434"></a>00434         .flags(<a class="code" href="namespaceStats.html#a4031dfee086a6a4cf1deea1fff2e0d5c">total</a>)
<a name="l00435"></a>00435         ;
<a name="l00436"></a>00436     <a class="code" href="classCopyEngine.html#a2c7c96445b0cb37f72b61dae4d2c541d">copiesProcessed</a>
<a name="l00437"></a>00437         .<a class="code" href="classStats_1_1VectorBase.html#ae41cad1a02eeb7958df026d8e2cc7582">init</a>(<a class="code" href="classCopyEngine.html#ac3a32787c71b25fdee473de0804efa29">regs</a>.<a class="code" href="structCopyEngineReg_1_1Regs.html#a72591202604201c764b2d2330de87eb9">chanCount</a>)
<a name="l00438"></a>00438         .name(<a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>() + <span class="stringliteral">&quot;.copies_processed&quot;</span>)
<a name="l00439"></a>00439         .desc(<span class="stringliteral">&quot;Number of copies processed by each engine&quot;</span>)
<a name="l00440"></a>00440         .flags(<a class="code" href="namespaceStats.html#a4031dfee086a6a4cf1deea1fff2e0d5c">total</a>)
<a name="l00441"></a>00441         ;
<a name="l00442"></a>00442 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a53e036786d17361be4c7320d39c99b84"></a><!-- doxytag: member="CopyEngine::serialize" ref="a53e036786d17361be4c7320d39c99b84" args="(std::ostream &amp;os)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void serialize </td>
          <td>(</td>
          <td class="paramtype">std::ostream &amp;&nbsp;</td>
          <td class="paramname"> <em>os</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Serialize this object to the given output stream. </p>
<dl><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>os</em>&nbsp;</td><td>The stream to serialize to. </td></tr>
  </table>
  </dd>
</dl>

<p><a class="el" href="classPciDevice.html#a53e036786d17361be4c7320d39c99b84">PciDevice</a>を再定義しています。</p>

<p><div class="fragment"><pre class="fragment"><a name="l00682"></a>00682 {
<a name="l00683"></a>00683     <a class="code" href="classCopyEngine.html#a53e036786d17361be4c7320d39c99b84">PciDevice::serialize</a>(<a class="code" href="namespaceX86ISA.html#a6b6e6ba763e7eaf46ac5b6372ca98d30">os</a>);
<a name="l00684"></a>00684     <a class="code" href="classCopyEngine.html#ac3a32787c71b25fdee473de0804efa29">regs</a>.<a class="code" href="structCopyEngineReg_1_1Regs.html#a53e036786d17361be4c7320d39c99b84">serialize</a>(<a class="code" href="namespaceX86ISA.html#a6b6e6ba763e7eaf46ac5b6372ca98d30">os</a>);
<a name="l00685"></a>00685     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespaceX86ISA.html#ab5f9a01fc40e47853ae9551b008afcbd">x</a> =0; <a class="code" href="namespaceX86ISA.html#ab5f9a01fc40e47853ae9551b008afcbd">x</a> &lt; <a class="code" href="classCopyEngine.html#a2fa0132c83d16e1e404f54278dcf94c4">chan</a>.size(); <a class="code" href="namespaceX86ISA.html#ab5f9a01fc40e47853ae9551b008afcbd">x</a>++) {
<a name="l00686"></a>00686         <a class="code" href="classSerializable.html#a02882ba301442518e82872ad4574a3f0">nameOut</a>(<a class="code" href="namespaceX86ISA.html#a6b6e6ba763e7eaf46ac5b6372ca98d30">os</a>, <a class="code" href="cprintf_8hh.html#ace22d1c39f2df58e593bc49d1613eca2">csprintf</a>(<span class="stringliteral">&quot;%s.channel%d&quot;</span>, <a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>(), <a class="code" href="namespaceX86ISA.html#ab5f9a01fc40e47853ae9551b008afcbd">x</a>));
<a name="l00687"></a>00687         <a class="code" href="classCopyEngine.html#a2fa0132c83d16e1e404f54278dcf94c4">chan</a>[<a class="code" href="namespaceX86ISA.html#ab5f9a01fc40e47853ae9551b008afcbd">x</a>]-&gt;serialize(<a class="code" href="namespaceX86ISA.html#a6b6e6ba763e7eaf46ac5b6372ca98d30">os</a>);
<a name="l00688"></a>00688     }
<a name="l00689"></a>00689 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af22e5d6d660b97db37003ac61ac4ee49"></a><!-- doxytag: member="CopyEngine::unserialize" ref="af22e5d6d660b97db37003ac61ac4ee49" args="(Checkpoint *cp, const std::string &amp;section)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void unserialize </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classCheckpoint.html">Checkpoint</a> *&nbsp;</td>
          <td class="paramname"> <em>cp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&nbsp;</td>
          <td class="paramname"> <em>section</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Reconstruct the state of this object from a checkpoint. </p>
<dl><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="namespacecp.html">cp</a></em>&nbsp;</td><td>The checkpoint use. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>section</em>&nbsp;</td><td>The section name of this object </td></tr>
  </table>
  </dd>
</dl>

<p><a class="el" href="classPciDevice.html#af22e5d6d660b97db37003ac61ac4ee49">PciDevice</a>を再定義しています。</p>

<p><div class="fragment"><pre class="fragment"><a name="l00693"></a>00693 {
<a name="l00694"></a>00694     <a class="code" href="classCopyEngine.html#af22e5d6d660b97db37003ac61ac4ee49">PciDevice::unserialize</a>(cp, section);
<a name="l00695"></a>00695     <a class="code" href="classCopyEngine.html#ac3a32787c71b25fdee473de0804efa29">regs</a>.<a class="code" href="structCopyEngineReg_1_1Regs.html#af22e5d6d660b97db37003ac61ac4ee49">unserialize</a>(cp, section);
<a name="l00696"></a>00696     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespaceX86ISA.html#ab5f9a01fc40e47853ae9551b008afcbd">x</a> = 0; <a class="code" href="namespaceX86ISA.html#ab5f9a01fc40e47853ae9551b008afcbd">x</a> &lt; <a class="code" href="classCopyEngine.html#a2fa0132c83d16e1e404f54278dcf94c4">chan</a>.size(); <a class="code" href="namespaceX86ISA.html#ab5f9a01fc40e47853ae9551b008afcbd">x</a>++)
<a name="l00697"></a>00697         <a class="code" href="classCopyEngine.html#a2fa0132c83d16e1e404f54278dcf94c4">chan</a>[<a class="code" href="namespaceX86ISA.html#ab5f9a01fc40e47853ae9551b008afcbd">x</a>]-&gt;<a class="code" href="classCopyEngine.html#af22e5d6d660b97db37003ac61ac4ee49">unserialize</a>(cp, <a class="code" href="cprintf_8hh.html#ace22d1c39f2df58e593bc49d1613eca2">csprintf</a>(<span class="stringliteral">&quot;%s.channel%d&quot;</span>, section, <a class="code" href="namespaceX86ISA.html#ab5f9a01fc40e47853ae9551b008afcbd">x</a>));
<a name="l00698"></a>00698 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4cefab464e72b5dd42c003a0a4341802"></a><!-- doxytag: member="CopyEngine::write" ref="a4cefab464e72b5dd42c003a0a4341802" args="(PacketPtr pkt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> write </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classPacket.html">PacketPtr</a>&nbsp;</td>
          <td class="paramname"> <em>pkt</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Pure virtual function that the device must implement. Called when a write command is recieved by the port. </p>
<dl><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pkt</em>&nbsp;</td><td><a class="el" href="classPacket.html">Packet</a> describing this request </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>戻り値:</b></dt><dd>number of ticks it took to complete </dd></dl>

<p><p>Handle write of register here</p>
<p>Channel registers are handled here</p>
</p>

<p><a class="el" href="classPioDevice.html#afe8371668d023bb2516b286e5e399b6f">PioDevice</a>を実装しています。</p>

<p><div class="fragment"><pre class="fragment"><a name="l00292"></a>00292 {
<a name="l00293"></a>00293     <span class="keywordtype">int</span> bar;
<a name="l00294"></a>00294     <a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a> daddr;
<a name="l00295"></a>00295 
<a name="l00296"></a>00296 
<a name="l00297"></a>00297     <span class="keywordflow">if</span> (!<a class="code" href="classPciDevice.html#ad7fbff3ce8627dac12313ed7ac1ea44a">getBAR</a>(pkt-&gt;<a class="code" href="classPacket.html#afca9af4d83a57836baba87603463a6e0">getAddr</a>(), bar, daddr))
<a name="l00298"></a>00298         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Invalid PCI memory access to unmapped memory.\n&quot;</span>);
<a name="l00299"></a>00299 
<a name="l00300"></a>00300     <span class="comment">// Only Memory register BAR is allowed</span>
<a name="l00301"></a>00301     assert(bar == 0);
<a name="l00302"></a>00302 
<a name="l00303"></a>00303     <span class="keywordtype">int</span> size = pkt-&gt;<a class="code" href="classPacket.html#a1d18ba49c7be427da1f4a42d53e35f48">getSize</a>();
<a name="l00304"></a>00304 
<a name="l00308"></a>00308 
<a name="l00309"></a>00309     <span class="keywordflow">if</span> (size == <span class="keyword">sizeof</span>(uint64_t)) {
<a name="l00310"></a>00310         uint64_t <a class="code" href="namespaceX86ISA.html#ae13bf1250853ff6b72aabe3c79b587cc">val</a> M5_VAR_USED = pkt-&gt;<a class="code" href="classPacket.html#af6ea056c8af82f08af9fd0d857967f9b">get</a>&lt;uint64_t&gt;();
<a name="l00311"></a>00311         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DMACopyEngine, <span class="stringliteral">&quot;Wrote device register %#X value %#X\n&quot;</span>, daddr, <a class="code" href="namespaceX86ISA.html#ae13bf1250853ff6b72aabe3c79b587cc">val</a>);
<a name="l00312"></a>00312     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (size == <span class="keyword">sizeof</span>(<a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>)) {
<a name="l00313"></a>00313         <a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> <a class="code" href="namespaceX86ISA.html#ae13bf1250853ff6b72aabe3c79b587cc">val</a> M5_VAR_USED = pkt-&gt;<a class="code" href="classPacket.html#af6ea056c8af82f08af9fd0d857967f9b">get</a>&lt;<a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&gt;();
<a name="l00314"></a>00314         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DMACopyEngine, <span class="stringliteral">&quot;Wrote device register %#X value %#X\n&quot;</span>, daddr, <a class="code" href="namespaceX86ISA.html#ae13bf1250853ff6b72aabe3c79b587cc">val</a>);
<a name="l00315"></a>00315     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (size == <span class="keyword">sizeof</span>(uint16_t)) {
<a name="l00316"></a>00316         uint16_t <a class="code" href="namespaceX86ISA.html#ae13bf1250853ff6b72aabe3c79b587cc">val</a> M5_VAR_USED = pkt-&gt;<a class="code" href="classPacket.html#af6ea056c8af82f08af9fd0d857967f9b">get</a>&lt;uint16_t&gt;();
<a name="l00317"></a>00317         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DMACopyEngine, <span class="stringliteral">&quot;Wrote device register %#X value %#X\n&quot;</span>, daddr, <a class="code" href="namespaceX86ISA.html#ae13bf1250853ff6b72aabe3c79b587cc">val</a>);
<a name="l00318"></a>00318     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (size == <span class="keyword">sizeof</span>(uint8_t)) {
<a name="l00319"></a>00319         uint8_t <a class="code" href="namespaceX86ISA.html#ae13bf1250853ff6b72aabe3c79b587cc">val</a> M5_VAR_USED = pkt-&gt;<a class="code" href="classPacket.html#af6ea056c8af82f08af9fd0d857967f9b">get</a>&lt;uint8_t&gt;();
<a name="l00320"></a>00320         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DMACopyEngine, <span class="stringliteral">&quot;Wrote device register %#X value %#X\n&quot;</span>, daddr, <a class="code" href="namespaceX86ISA.html#ae13bf1250853ff6b72aabe3c79b587cc">val</a>);
<a name="l00321"></a>00321     } <span class="keywordflow">else</span> {
<a name="l00322"></a>00322         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Unknown size for MMIO access: %d\n&quot;</span>, size);
<a name="l00323"></a>00323     }
<a name="l00324"></a>00324 
<a name="l00325"></a>00325     <span class="keywordflow">if</span> (daddr &lt; 0x80) {
<a name="l00326"></a>00326         <span class="keywordflow">switch</span> (daddr) {
<a name="l00327"></a>00327           <span class="keywordflow">case</span> <a class="code" href="namespaceCopyEngineReg.html#a14c18458452291938d4152a65e037928">GEN_CHANCOUNT</a>:
<a name="l00328"></a>00328           <span class="keywordflow">case</span> <a class="code" href="namespaceCopyEngineReg.html#ac0068780087938924e6ad21074d945d9">GEN_XFERCAP</a>:
<a name="l00329"></a>00329           <span class="keywordflow">case</span> <a class="code" href="namespaceCopyEngineReg.html#af80eb1e2939758c39cde1c3383b8a329">GEN_ATTNSTATUS</a>:
<a name="l00330"></a>00330             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(DMACopyEngine, <span class="stringliteral">&quot;Warning, ignorning write to register %x\n&quot;</span>,
<a name="l00331"></a>00331                     daddr);
<a name="l00332"></a>00332             <span class="keywordflow">break</span>;
<a name="l00333"></a>00333           <span class="keywordflow">case</span> <a class="code" href="namespaceCopyEngineReg.html#abd37ea26b220f895c1d50b0b94654a23">GEN_INTRCTRL</a>:
<a name="l00334"></a>00334             <a class="code" href="classCopyEngine.html#ac3a32787c71b25fdee473de0804efa29">regs</a>.<a class="code" href="structCopyEngineReg_1_1Regs.html#adb90603779b60249df8136e1537ebeb7">intrctrl</a>.master_int_enable(<a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123">bits</a>(pkt-&gt;<a class="code" href="classPacket.html#af6ea056c8af82f08af9fd0d857967f9b">get</a>&lt;uint8_t&gt;(),0,1));
<a name="l00335"></a>00335             <span class="keywordflow">break</span>;
<a name="l00336"></a>00336           <span class="keywordflow">default</span>:
<a name="l00337"></a>00337             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Read request to unknown register number: %#x\n&quot;</span>, daddr);
<a name="l00338"></a>00338         }
<a name="l00339"></a>00339         pkt-&gt;<a class="code" href="classPacket.html#ad664e704f09d6bb5c116573721034ebd">makeAtomicResponse</a>();
<a name="l00340"></a>00340         <span class="keywordflow">return</span> <a class="code" href="classPciDevice.html#ac8e969635a78ab9ab123904ccca434cc">pioDelay</a>;
<a name="l00341"></a>00341     }
<a name="l00342"></a>00342 
<a name="l00343"></a>00343     <span class="comment">// Find which channel we&apos;re accessing</span>
<a name="l00344"></a>00344     <span class="keywordtype">int</span> chanid = 0;
<a name="l00345"></a>00345     daddr -= 0x80;
<a name="l00346"></a>00346     <span class="keywordflow">while</span> (daddr &gt;= 0x80) {
<a name="l00347"></a>00347         chanid++;
<a name="l00348"></a>00348         daddr -= 0x80;
<a name="l00349"></a>00349     }
<a name="l00350"></a>00350 
<a name="l00351"></a>00351     <span class="keywordflow">if</span> (chanid &gt;= <a class="code" href="classCopyEngine.html#ac3a32787c71b25fdee473de0804efa29">regs</a>.<a class="code" href="structCopyEngineReg_1_1Regs.html#a72591202604201c764b2d2330de87eb9">chanCount</a>)
<a name="l00352"></a>00352         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Access to channel %d (device only configured for %d channels)&quot;</span>,
<a name="l00353"></a>00353                 chanid, <a class="code" href="classCopyEngine.html#ac3a32787c71b25fdee473de0804efa29">regs</a>.<a class="code" href="structCopyEngineReg_1_1Regs.html#a72591202604201c764b2d2330de87eb9">chanCount</a>);
<a name="l00354"></a>00354 
<a name="l00358"></a>00358     <a class="code" href="classCopyEngine.html#a2fa0132c83d16e1e404f54278dcf94c4">chan</a>[chanid]-&gt;channelWrite(pkt, daddr, size);
<a name="l00359"></a>00359 
<a name="l00360"></a>00360     pkt-&gt;<a class="code" href="classPacket.html#ad664e704f09d6bb5c116573721034ebd">makeAtomicResponse</a>();
<a name="l00361"></a>00361     <span class="keywordflow">return</span> <a class="code" href="classPciDevice.html#ac8e969635a78ab9ab123904ccca434cc">pioDelay</a>;
<a name="l00362"></a>00362 }
</pre></div></p>

</div>
</div>
<hr/><h2>変数</h2>
<a class="anchor" id="a25b7da20ae9cf014c7806abf1bf929b3"></a><!-- doxytag: member="CopyEngine::bytesCopied" ref="a25b7da20ae9cf014c7806abf1bf929b3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classStats_1_1Vector.html">Stats::Vector</a> <a class="el" href="classCopyEngine.html#a25b7da20ae9cf014c7806abf1bf929b3">bytesCopied</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a2fa0132c83d16e1e404f54278dcf94c4"></a><!-- doxytag: member="CopyEngine::chan" ref="a2fa0132c83d16e1e404f54278dcf94c4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classstd_1_1vector.html">std::vector</a>&lt;<a class="el" href="classCopyEngine_1_1CopyEngineChannel.html">CopyEngineChannel</a>*&gt; <a class="el" href="classCopyEngine.html#a2fa0132c83d16e1e404f54278dcf94c4">chan</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a2c7c96445b0cb37f72b61dae4d2c541d"></a><!-- doxytag: member="CopyEngine::copiesProcessed" ref="a2c7c96445b0cb37f72b61dae4d2c541d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classStats_1_1Vector.html">Stats::Vector</a> <a class="el" href="classCopyEngine.html#a2c7c96445b0cb37f72b61dae4d2c541d">copiesProcessed</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ac3a32787c71b25fdee473de0804efa29"></a><!-- doxytag: member="CopyEngine::regs" ref="ac3a32787c71b25fdee473de0804efa29" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structCopyEngineReg_1_1Regs.html">CopyEngineReg::Regs</a> <a class="el" href="classCopyEngine.html#ac3a32787c71b25fdee473de0804efa29">regs</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/>このクラスの説明は次のファイルから生成されました:<ul>
<li>dev/<a class="el" href="copy__engine_8hh_source.html">copy_engine.hh</a></li>
<li>dev/<a class="el" href="copy__engine_8cc.html">copy_engine.cc</a></li>
</ul>
</div>
<hr size="1"/><address style="text-align: right;"><small>File&nbsp;GEM5&nbsp;Wrapperに対して25 May 2015に生成されました。&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
