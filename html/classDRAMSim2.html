<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>File&nbsp;GEM5&nbsp;Wrapper: クラス DRAMSim2</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- 作成： Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>メインページ</span></a></li>
      <li><a href="pages.html"><span>関連ページ</span></a></li>
      <li><a href="modules.html"><span>モジュール</span></a></li>
      <li><a href="namespaces.html"><span>ネームスペース</span></a></li>
      <li class="current"><a href="annotated.html"><span>クラス</span></a></li>
      <li><a href="files.html"><span>ファイル</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>構成</span></a></li>
      <li><a href="classes.html"><span>構成索引</span></a></li>
      <li><a href="hierarchy.html"><span>クラス階層</span></a></li>
      <li><a href="functions.html"><span>構成メンバ</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>クラス DRAMSim2</h1><!-- doxytag: class="DRAMSim2" --><!-- doxytag: inherits="AbstractMemory" -->
<p><code>#include &lt;<a class="el" href="dramsim2_8hh_source.html">dramsim2.hh</a>&gt;</code></p>
<div class="dynheader">
DRAMSim2に対する継承グラフ</div>
<div class="dynsection">
 <div class="center">
  <img src="classDRAMSim2.gif" usemap="#DRAMSim2_map" alt=""/>
  <map id="DRAMSim2_map" name="DRAMSim2_map">
<area href="classAbstractMemory.html" alt="AbstractMemory" shape="rect" coords="115,224,220,248"/>
<area href="classMemObject.html" alt="MemObject" shape="rect" coords="115,168,220,192"/>
<area href="classClockedObject.html" alt="ClockedObject" shape="rect" coords="115,112,220,136"/>
<area href="classSimObject.html" alt="SimObject" shape="rect" coords="115,56,220,80"/>
<area href="classEventManager.html" alt="EventManager" shape="rect" coords="0,0,105,24"/>
<area href="classSerializable.html" alt="Serializable" shape="rect" coords="115,0,220,24"/>
<area href="classDrainable.html" alt="Drainable" shape="rect" coords="230,0,335,24"/>
</map>
 </div>
</div>

<p><a href="classDRAMSim2-members.html">すべてのメンバ一覧</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>構成</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDRAMSim2_1_1DRAMSim2.html">DRAMSim2</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDRAMSim2_1_1MemoryPort.html">MemoryPort</a></td></tr>
<tr><td colspan="2"><h2>Public 型</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef DRAMSim2Params&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDRAMSim2.html#ae66665a06c9d64a6ba0e56d589b74d6c">Params</a></td></tr>
<tr><td colspan="2"><h2>Public メソッド</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDRAMSim2.html#ab8d8de0105b7d92ea63130025ee2bc5a">DRAMSim2</a> (const <a class="el" href="classDRAMSim2.html#ae66665a06c9d64a6ba0e56d589b74d6c">Params</a> *p)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDRAMSim2.html#a8c698c38274256cd03843f1296ac9eed">readComplete</a> (unsigned id, uint64_t addr, uint64_t <a class="el" href="classClockedObject.html#a5dd7a975aae396561aafab3faa698033">cycle</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDRAMSim2.html#aeb50ab991dbcebefc4952362893d0891">writeComplete</a> (unsigned id, uint64_t addr, uint64_t <a class="el" href="classClockedObject.html#a5dd7a975aae396561aafab3faa698033">cycle</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDRAMSim2.html#aa8a18d230dba7a674ac8a0b4f35bc36a">drain</a> (<a class="el" href="classDrainManager.html">DrainManager</a> *dm)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="classBaseSlavePort.html">BaseSlavePort</a> &amp;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDRAMSim2.html#ac918a145092d7514ebc6dbd952dceafb">getSlavePort</a> (const std::string &amp;if_name, <a class="el" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a> idx=<a class="el" href="base_2types_8hh.html#a65bf40f138cf863f0c5e2d8ca1144126">InvalidPortID</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDRAMSim2.html#a02fd73d861ef2e4aabb38c0c9ff82947">init</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDRAMSim2.html#aecc7d8debf54990ffeaaed5bac7d7d81">startup</a> ()</td></tr>
<tr><td colspan="2"><h2>Protected メソッド</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDRAMSim2.html#a5f0b4c4a94f6b0053f9d7a4eb9c2518a">recvAtomic</a> (<a class="el" href="classPacket.html">PacketPtr</a> pkt)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDRAMSim2.html#aeefa907fb6d6a787e6dab90e8138ea90">recvFunctional</a> (<a class="el" href="classPacket.html">PacketPtr</a> pkt)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDRAMSim2.html#a3344d9dd0f83257feab5424e761f31c6">recvTimingReq</a> (<a class="el" href="classPacket.html">PacketPtr</a> pkt)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDRAMSim2.html#a29cb5a4f98063ce6e9210eacbdb35298">recvRetry</a> ()</td></tr>
<tr><td colspan="2"><h2>Private メソッド</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDRAMSim2.html#a034e8a2b3dd91f3ad9ca116c60aa3ea5">nbrOutstanding</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDRAMSim2.html#a26aa336cb4192aab04418121f361fa49">accessAndRespond</a> (<a class="el" href="classPacket.html">PacketPtr</a> pkt)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDRAMSim2.html#a07982d2ae9430f5cd468e15bb4920ea4">sendResponse</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDRAMSim2.html#a873dd91783f9efb4a590aded1f70d6b0">tick</a> ()</td></tr>
<tr><td colspan="2"><h2>Private 変数</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classDRAMSim2_1_1MemoryPort.html">MemoryPort</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDRAMSim2.html#a55c076720c982014096b57cadebf9a14">port</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classDRAMSim2Wrapper.html">DRAMSim2Wrapper</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDRAMSim2.html#a19f45f63dee6f1b0a77c2758069683f8">wrapper</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDRAMSim2.html#aab3b947b2633a30b5973a39b7e9b018a">retryReq</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDRAMSim2.html#a6ddfdd4eb676d50001bda88567e6da14">retryResp</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">m5::hash_map&lt; <a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a>, std::queue<br class="typebreak"/>
&lt; <a class="el" href="classPacket.html">PacketPtr</a> &gt; &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDRAMSim2.html#aa436e51811d19fcd65fcc5061afc981a">outstandingReads</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">m5::hash_map&lt; <a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a>, std::queue<br class="typebreak"/>
&lt; <a class="el" href="classPacket.html">PacketPtr</a> &gt; &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDRAMSim2.html#ae3f05f6f5f0f558c32291a43c04fc1a1">outstandingWrites</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDRAMSim2.html#a75a96fd06206c4a8580628497ad694df">nbrOutstandingReads</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDRAMSim2.html#ae13aa3a1980dc05e181f85d7304baa82">nbrOutstandingWrites</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classstd_1_1deque.html">std::deque</a>&lt; <a class="el" href="classPacket.html">PacketPtr</a> &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDRAMSim2.html#a7dd56c8ca058e3e734ec0460b1587932">responseQueue</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classDrainManager.html">DrainManager</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDRAMSim2.html#a329b71fb934a93312ca0aacbf5a3f982">drainManager</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classEventWrapper.html">EventWrapper</a>&lt; <a class="el" href="classDRAMSim2_1_1DRAMSim2.html">DRAMSim2</a>,&amp;DRAMSim2::sendResponse &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDRAMSim2.html#a46a89603d961c3ae9b2cb2df412503f6">sendResponseEvent</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classEventWrapper.html">EventWrapper</a>&lt; <a class="el" href="classDRAMSim2_1_1DRAMSim2.html">DRAMSim2</a>,&amp;DRAMSim2::tick &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDRAMSim2.html#acab0bec584b681055f948abbbaf8acb2">tickEvent</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classstd_1_1vector.html">std::vector</a>&lt; <a class="el" href="classPacket.html">PacketPtr</a> &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDRAMSim2.html#a21da4bea3554874b557428e4cce5d4a4">pendingDelete</a></td></tr>
</table>
<hr/><h2>型定義</h2>
<a class="anchor" id="ae66665a06c9d64a6ba0e56d589b74d6c"></a><!-- doxytag: member="DRAMSim2::Params" ref="ae66665a06c9d64a6ba0e56d589b74d6c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef DRAMSim2Params <a class="el" href="classDRAMSim2.html#ae66665a06c9d64a6ba0e56d589b74d6c">Params</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><a class="el" href="classAbstractMemory.html#ab4fcbcbcfef78d6bc871995f8eca40eb">AbstractMemory</a>を再定義しています。</p>

</div>
</div>
<hr/><h2>コンストラクタとデストラクタ</h2>
<a class="anchor" id="ab8d8de0105b7d92ea63130025ee2bc5a"></a><!-- doxytag: member="DRAMSim2::DRAMSim2" ref="ab8d8de0105b7d92ea63130025ee2bc5a" args="(const Params *p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classDRAMSim2_1_1DRAMSim2.html">DRAMSim2</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classDRAMSim2.html#ae66665a06c9d64a6ba0e56d589b74d6c">Params</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00048"></a>00048                                   :
<a name="l00049"></a>00049     <a class="code" href="classAbstractMemory.html#abe7c4ad03729f9b3dd25d3dc43361103">AbstractMemory</a>(<a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a>),
<a name="l00050"></a>00050     <a class="code" href="classDRAMSim2.html#a55c076720c982014096b57cadebf9a14">port</a>(<a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>() + <span class="stringliteral">&quot;.port&quot;</span>, *<span class="keyword">this</span>),
<a name="l00051"></a>00051     <a class="code" href="classDRAMSim2.html#a19f45f63dee6f1b0a77c2758069683f8">wrapper</a>(<a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a>-&gt;deviceConfigFile, <a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a>-&gt;systemConfigFile, <a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a>-&gt;filePath,
<a name="l00052"></a>00052             <a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a>-&gt;traceFile, <a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a>-&gt;range.size() / 1024 / 1024, <a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a>-&gt;enableDebug),
<a name="l00053"></a>00053     <a class="code" href="classDRAMSim2.html#aab3b947b2633a30b5973a39b7e9b018a">retryReq</a>(<span class="keyword">false</span>), <a class="code" href="classDRAMSim2.html#a6ddfdd4eb676d50001bda88567e6da14">retryResp</a>(<span class="keyword">false</span>),
<a name="l00054"></a>00054     <a class="code" href="classDRAMSim2.html#a75a96fd06206c4a8580628497ad694df">nbrOutstandingReads</a>(0), <a class="code" href="classDRAMSim2.html#ae13aa3a1980dc05e181f85d7304baa82">nbrOutstandingWrites</a>(0),
<a name="l00055"></a>00055     <a class="code" href="classDRAMSim2.html#a329b71fb934a93312ca0aacbf5a3f982">drainManager</a>(<a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>),
<a name="l00056"></a>00056     <a class="code" href="classDRAMSim2.html#a46a89603d961c3ae9b2cb2df412503f6">sendResponseEvent</a>(<span class="keyword">this</span>), <a class="code" href="classDRAMSim2.html#acab0bec584b681055f948abbbaf8acb2">tickEvent</a>(<span class="keyword">this</span>)
<a name="l00057"></a>00057 {
<a name="l00058"></a>00058     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classDRAMSim2.html">DRAMSim2</a>,
<a name="l00059"></a>00059             <span class="stringliteral">&quot;Instantiated DRAMSim2 with clock %d ns and queue size %d\n&quot;</span>,
<a name="l00060"></a>00060             <a class="code" href="classDRAMSim2.html#a19f45f63dee6f1b0a77c2758069683f8">wrapper</a>.<a class="code" href="classDRAMSim2Wrapper.html#a6efe80b239837bd53bf8d8694c665993">clockPeriod</a>(), <a class="code" href="classDRAMSim2.html#a19f45f63dee6f1b0a77c2758069683f8">wrapper</a>.<a class="code" href="classDRAMSim2Wrapper.html#a667ea9ca9654bced2242c6ccd77599ee">queueSize</a>());
<a name="l00061"></a>00061 
<a name="l00062"></a>00062     DRAMSim::TransactionCompleteCB* read_cb =
<a name="l00063"></a>00063         <span class="keyword">new</span> DRAMSim::Callback&lt;DRAMSim2, void, unsigned, uint64_t, uint64_t&gt;(
<a name="l00064"></a>00064             <span class="keyword">this</span>, &amp;<a class="code" href="classDRAMSim2.html#a8c698c38274256cd03843f1296ac9eed">DRAMSim2::readComplete</a>);
<a name="l00065"></a>00065     DRAMSim::TransactionCompleteCB* write_cb =
<a name="l00066"></a>00066         <span class="keyword">new</span> DRAMSim::Callback&lt;DRAMSim2, void, unsigned, uint64_t, uint64_t&gt;(
<a name="l00067"></a>00067             <span class="keyword">this</span>, &amp;<a class="code" href="classDRAMSim2.html#aeb50ab991dbcebefc4952362893d0891">DRAMSim2::writeComplete</a>);
<a name="l00068"></a>00068     <a class="code" href="classDRAMSim2.html#a19f45f63dee6f1b0a77c2758069683f8">wrapper</a>.<a class="code" href="classDRAMSim2Wrapper.html#ae7cabadc2302c5b4899c5db3b66b2549">setCallbacks</a>(read_cb, write_cb);
<a name="l00069"></a>00069 
<a name="l00070"></a>00070     <span class="comment">// Register a callback to compensate for the destructor not</span>
<a name="l00071"></a>00071     <span class="comment">// being called. The callback prints the DRAMSim2 stats.</span>
<a name="l00072"></a>00072     <a class="code" href="classCallback.html">Callback</a>* cb = <span class="keyword">new</span> <a class="code" href="classMakeCallback.html">MakeCallback</a>&lt;<a class="code" href="classDRAMSim2Wrapper.html">DRAMSim2Wrapper</a>,
<a name="l00073"></a>00073         &amp;<a class="code" href="classDRAMSim2Wrapper.html#a0beecd7e864561c9474bc80e993556bf">DRAMSim2Wrapper::printStats</a>&gt;(<a class="code" href="classDRAMSim2.html#a19f45f63dee6f1b0a77c2758069683f8">wrapper</a>);
<a name="l00074"></a>00074     <a class="code" href="core_8cc.html#acbc78ce26c7964097d562909c589d585">registerExitCallback</a>(cb);
<a name="l00075"></a>00075 }

</pre></div></p>

</div>
</div>
<hr/><h2>関数</h2>
<a class="anchor" id="a26aa336cb4192aab04418121f361fa49"></a><!-- doxytag: member="DRAMSim2::accessAndRespond" ref="a26aa336cb4192aab04418121f361fa49" args="(PacketPtr pkt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void accessAndRespond </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classPacket.html">PacketPtr</a>&nbsp;</td>
          <td class="paramname"> <em>pkt</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>When a packet is ready, use the "access()" method in <a class="el" href="classAbstractMemory.html">AbstractMemory</a> to actually create the response packet, and send it back to the outside world requestor.</p>
<dl><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pkt</em>&nbsp;</td><td>The packet from the outside world </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l00254"></a>00254 {
<a name="l00255"></a>00255     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classDRAMSim2.html">DRAMSim2</a>, <span class="stringliteral">&quot;Access for address %lld\n&quot;</span>, pkt-&gt;<a class="code" href="classPacket.html#afca9af4d83a57836baba87603463a6e0">getAddr</a>());
<a name="l00256"></a>00256 
<a name="l00257"></a>00257     <span class="keywordtype">bool</span> needsResponse = pkt-&gt;<a class="code" href="classPacket.html#a390c6cced05593f0a2c75a38a7a24fa9">needsResponse</a>();
<a name="l00258"></a>00258 
<a name="l00259"></a>00259     <span class="comment">// do the actual memory access which also turns the packet into a</span>
<a name="l00260"></a>00260     <span class="comment">// response</span>
<a name="l00261"></a>00261     <a class="code" href="classAbstractMemory.html#aac5d96736802cb79fb2287135bcc1dff">access</a>(pkt);
<a name="l00262"></a>00262 
<a name="l00263"></a>00263     <span class="comment">// turn packet around to go back to requester if response expected</span>
<a name="l00264"></a>00264     <span class="keywordflow">if</span> (needsResponse) {
<a name="l00265"></a>00265         <span class="comment">// access already turned the packet into a response</span>
<a name="l00266"></a>00266         assert(pkt-&gt;<a class="code" href="classPacket.html#a5f89a108755a6cb3e8185d85c850a816">isResponse</a>());
<a name="l00267"></a>00267 
<a name="l00268"></a>00268         <span class="comment">// @todo someone should pay for this</span>
<a name="l00269"></a>00269         pkt-&gt;<a class="code" href="classPacket.html#af8986a05caa6c5b96b0b01bb6cf47772">busFirstWordDelay</a> = pkt-&gt;<a class="code" href="classPacket.html#a7bf8ae0a056329f751eda8b39ca4c268">busLastWordDelay</a> = 0;
<a name="l00270"></a>00270 
<a name="l00271"></a>00271         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classDRAMSim2.html">DRAMSim2</a>, <span class="stringliteral">&quot;Queuing response for address %lld\n&quot;</span>,
<a name="l00272"></a>00272                 pkt-&gt;<a class="code" href="classPacket.html#afca9af4d83a57836baba87603463a6e0">getAddr</a>());
<a name="l00273"></a>00273 
<a name="l00274"></a>00274         <span class="comment">// queue it to be sent back</span>
<a name="l00275"></a>00275         <a class="code" href="classDRAMSim2.html#a7dd56c8ca058e3e734ec0460b1587932">responseQueue</a>.push_back(pkt);
<a name="l00276"></a>00276 
<a name="l00277"></a>00277         <span class="comment">// if we are not already waiting for a retry, or are scheduled</span>
<a name="l00278"></a>00278         <span class="comment">// to send a response, schedule an event</span>
<a name="l00279"></a>00279         <span class="keywordflow">if</span> (!<a class="code" href="classDRAMSim2.html#a6ddfdd4eb676d50001bda88567e6da14">retryResp</a> &amp;&amp; !<a class="code" href="classDRAMSim2.html#a46a89603d961c3ae9b2cb2df412503f6">sendResponseEvent</a>.<a class="code" href="classEvent.html#a9cd69a6b10cb037550943f177a0da688" title="Determine if the current event is scheduled.">scheduled</a>())
<a name="l00280"></a>00280             <a class="code" href="classEventManager.html#a4ddebbfe9a12b95be6fb993ce892dcd3">schedule</a>(<a class="code" href="classDRAMSim2.html#a46a89603d961c3ae9b2cb2df412503f6">sendResponseEvent</a>, <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The universal simulation clock.">curTick</a>());
<a name="l00281"></a>00281     } <span class="keywordflow">else</span> {
<a name="l00282"></a>00282         <span class="comment">// @todo the packet is going to be deleted, and the DRAMPacket</span>
<a name="l00283"></a>00283         <span class="comment">// is still having a pointer to it</span>
<a name="l00284"></a>00284         <a class="code" href="classDRAMSim2.html#a21da4bea3554874b557428e4cce5d4a4">pendingDelete</a>.push_back(pkt);
<a name="l00285"></a>00285     }
<a name="l00286"></a>00286 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa8a18d230dba7a674ac8a0b4f35bc36a"></a><!-- doxytag: member="DRAMSim2::drain" ref="aa8a18d230dba7a674ac8a0b4f35bc36a" args="(DrainManager *dm)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int drain </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classDrainManager.html">DrainManager</a> *&nbsp;</td>
          <td class="paramname"> <em>drainManger</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Provide a default implementation of the drain interface that simply returns 0 (draining completed) and sets the drain state to Drained. </p>

<p><a class="el" href="classSimObject.html#a6bf479c521c7c3eb473822d953275b26">SimObject</a>を再定義しています。</p>

<p><div class="fragment"><pre class="fragment"><a name="l00355"></a>00355 {
<a name="l00356"></a>00356     <span class="comment">// check our outstanding reads and writes and if any they need to</span>
<a name="l00357"></a>00357     <span class="comment">// drain</span>
<a name="l00358"></a>00358     <span class="keywordflow">if</span> (<a class="code" href="classDRAMSim2.html#a034e8a2b3dd91f3ad9ca116c60aa3ea5">nbrOutstanding</a>() != 0) {
<a name="l00359"></a>00359         <a class="code" href="classDrainable.html#ad800905390fe03e850cf996e914038f9">setDrainState</a>(<a class="code" href="classDrainable.html#a5d74787dedbc4e11c1ab15bf487e61f8a929d17847bfad0d4689c9ab8540d5134">Drainable::Draining</a>);
<a name="l00360"></a>00360         <a class="code" href="classDRAMSim2.html#a329b71fb934a93312ca0aacbf5a3f982">drainManager</a> = <a class="code" href="namespaceMipsISA.html#a2575c29e7f4617b6076486f340b6fe19">dm</a>;
<a name="l00361"></a>00361         <span class="keywordflow">return</span> 1;
<a name="l00362"></a>00362     } <span class="keywordflow">else</span> {
<a name="l00363"></a>00363         <a class="code" href="classDrainable.html#ad800905390fe03e850cf996e914038f9">setDrainState</a>(<a class="code" href="classDrainable.html#a5d74787dedbc4e11c1ab15bf487e61f8a5656955cb808502a2ec75b367e2c1e82">Drainable::Drained</a>);
<a name="l00364"></a>00364         <span class="keywordflow">return</span> 0;
<a name="l00365"></a>00365     }
<a name="l00366"></a>00366 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac918a145092d7514ebc6dbd952dceafb"></a><!-- doxytag: member="DRAMSim2::getSlavePort" ref="ac918a145092d7514ebc6dbd952dceafb" args="(const std::string &amp;if_name, PortID idx=InvalidPortID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classBaseSlavePort.html">BaseSlavePort</a> &amp; getSlavePort </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&nbsp;</td>
          <td class="paramname"> <em>if_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a>&nbsp;</td>
          <td class="paramname"> <em>idx</em> = <code><a class="el" href="base_2types_8hh.html#a65bf40f138cf863f0c5e2d8ca1144126">InvalidPortID</a></code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Get a slave port with a given name and index. This is used at binding time and returns a reference to a protocol-agnostic base master port.</p>
<dl><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>if_name</em>&nbsp;</td><td><a class="el" href="classPort.html">Port</a> name </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>idx</em>&nbsp;</td><td>Index in the case of a VectorPort</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>戻り値:</b></dt><dd>A reference to the given port </dd></dl>

<p><a class="el" href="classMemObject.html#ac918a145092d7514ebc6dbd952dceafb">MemObject</a>を再定義しています。</p>

<p><div class="fragment"><pre class="fragment"><a name="l00345"></a>00345 {
<a name="l00346"></a>00346     <span class="keywordflow">if</span> (if_name != <span class="stringliteral">&quot;port&quot;</span>) {
<a name="l00347"></a>00347         <span class="keywordflow">return</span> <a class="code" href="classDRAMSim2.html#ac918a145092d7514ebc6dbd952dceafb">MemObject::getSlavePort</a>(if_name, idx);
<a name="l00348"></a>00348     } <span class="keywordflow">else</span> {
<a name="l00349"></a>00349         <span class="keywordflow">return</span> <a class="code" href="classDRAMSim2.html#a55c076720c982014096b57cadebf9a14">port</a>;
<a name="l00350"></a>00350     }
<a name="l00351"></a>00351 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a02fd73d861ef2e4aabb38c0c9ff82947"></a><!-- doxytag: member="DRAMSim2::init" ref="a02fd73d861ef2e4aabb38c0c9ff82947" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void init </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p><a class="el" href="classDRAMSim2.html#a02fd73d861ef2e4aabb38c0c9ff82947">init()</a> is called after all C++ SimObjects have been created and all ports are connected. Initializations that are independent of unserialization but rely on a fully instantiated and connected <a class="el" href="classSimObject.html">SimObject</a> graph should be done here. </p>

<p><a class="el" href="classSimObject.html#a02fd73d861ef2e4aabb38c0c9ff82947">SimObject</a>を再定義しています。</p>

<p><div class="fragment"><pre class="fragment"><a name="l00079"></a>00079 {
<a name="l00080"></a>00080     <span class="keywordflow">if</span> (!<a class="code" href="classDRAMSim2.html#a55c076720c982014096b57cadebf9a14">port</a>.<a class="code" href="classBaseSlavePort.html#a180fa55a4bf36580963bed9e3e09c227">isConnected</a>()) {
<a name="l00081"></a>00081         <a class="code" href="base_2misc_8hh.html#acad519418dbfdd70c1208711e609c80e">fatal</a>(<span class="stringliteral">&quot;DRAMSim2 %s is unconnected!\n&quot;</span>, <a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>());
<a name="l00082"></a>00082     } <span class="keywordflow">else</span> {
<a name="l00083"></a>00083         <a class="code" href="classDRAMSim2.html#a55c076720c982014096b57cadebf9a14">port</a>.<a class="code" href="classSlavePort.html#afb438cc39c4c679860c791bcef6dc7f3">sendRangeChange</a>();
<a name="l00084"></a>00084     }
<a name="l00085"></a>00085 
<a name="l00086"></a>00086     <span class="keywordflow">if</span> (<a class="code" href="classAbstractMemory.html#a83984c42bc765168929779ed9a37ebe8">system</a>()-&gt;cacheLineSize() != <a class="code" href="classDRAMSim2.html#a19f45f63dee6f1b0a77c2758069683f8">wrapper</a>.<a class="code" href="classDRAMSim2Wrapper.html#ad4ebfa7de0b48f306bf4d5e736843d62">burstSize</a>())
<a name="l00087"></a>00087         <a class="code" href="base_2misc_8hh.html#acad519418dbfdd70c1208711e609c80e">fatal</a>(<span class="stringliteral">&quot;DRAMSim2 burst size %d does not match cache line size %d\n&quot;</span>,
<a name="l00088"></a>00088               <a class="code" href="classDRAMSim2.html#a19f45f63dee6f1b0a77c2758069683f8">wrapper</a>.<a class="code" href="classDRAMSim2Wrapper.html#ad4ebfa7de0b48f306bf4d5e736843d62">burstSize</a>(), <a class="code" href="classAbstractMemory.html#a83984c42bc765168929779ed9a37ebe8">system</a>()-&gt;<a class="code" href="classSystem.html#ac1f842b56d922c001dda5262b4cccbc6">cacheLineSize</a>());
<a name="l00089"></a>00089 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a034e8a2b3dd91f3ad9ca116c60aa3ea5"></a><!-- doxytag: member="DRAMSim2::nbrOutstanding" ref="a034e8a2b3dd91f3ad9ca116c60aa3ea5" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int nbrOutstanding </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td> const<code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00133"></a>00133 {
<a name="l00134"></a>00134     <span class="keywordflow">return</span> <a class="code" href="classDRAMSim2.html#a75a96fd06206c4a8580628497ad694df">nbrOutstandingReads</a> + <a class="code" href="classDRAMSim2.html#ae13aa3a1980dc05e181f85d7304baa82">nbrOutstandingWrites</a> + <a class="code" href="classDRAMSim2.html#a7dd56c8ca058e3e734ec0460b1587932">responseQueue</a>.size();
<a name="l00135"></a>00135 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8c698c38274256cd03843f1296ac9eed"></a><!-- doxytag: member="DRAMSim2::readComplete" ref="a8c698c38274256cd03843f1296ac9eed" args="(unsigned id, uint64_t addr, uint64_t cycle)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void readComplete </td>
          <td>(</td>
          <td class="paramtype">unsigned&nbsp;</td>
          <td class="paramname"> <em>id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&nbsp;</td>
          <td class="paramname"> <em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&nbsp;</td>
          <td class="paramname"> <em>cycle</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Read completion callback.</p>
<dl><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>id</em>&nbsp;</td><td>Channel id of the responder </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>addr</em>&nbsp;</td><td><a class="el" href="classAddress.html">Address</a> of the request </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>cycle</em>&nbsp;</td><td>Internal cycle count of <a class="el" href="classDRAMSim2.html">DRAMSim2</a> </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l00289"></a>00289 {
<a name="l00290"></a>00290     assert(<a class="code" href="classClockedObject.html#a5dd7a975aae396561aafab3faa698033">cycle</a> == <a class="code" href="intmath_8hh.html#ae842b412d3570df97a944085b8f85850">divCeil</a>(<a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The universal simulation clock.">curTick</a>(),
<a name="l00291"></a>00291                             <a class="code" href="classDRAMSim2.html#a19f45f63dee6f1b0a77c2758069683f8">wrapper</a>.<a class="code" href="classDRAMSim2Wrapper.html#a6efe80b239837bd53bf8d8694c665993">clockPeriod</a>() * <a class="code" href="namespaceSimClock_1_1Int.html#a370bc05be45c1b9f039369ffd5c0efd4" title="nanosecond">SimClock::Int::ns</a>));
<a name="l00292"></a>00292 
<a name="l00293"></a>00293     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classDRAMSim2.html">DRAMSim2</a>, <span class="stringliteral">&quot;Read to address %lld complete\n&quot;</span>, <a class="code" href="namespaceX86ISA.html#ab705917f60c5566f9ce56a93f798b2e2">addr</a>);
<a name="l00294"></a>00294 
<a name="l00295"></a>00295     <span class="comment">// get the outstanding reads for the address in question</span>
<a name="l00296"></a>00296     <span class="keyword">auto</span> <a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a> = <a class="code" href="classDRAMSim2.html#aa436e51811d19fcd65fcc5061afc981a">outstandingReads</a>.find(<a class="code" href="namespaceX86ISA.html#ab705917f60c5566f9ce56a93f798b2e2">addr</a>);
<a name="l00297"></a>00297     assert(<a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a> != <a class="code" href="classDRAMSim2.html#aa436e51811d19fcd65fcc5061afc981a">outstandingReads</a>.end());
<a name="l00298"></a>00298 
<a name="l00299"></a>00299     <span class="comment">// first in first out, which is not necessarily true, but it is</span>
<a name="l00300"></a>00300     <span class="comment">// the best we can do at this point</span>
<a name="l00301"></a>00301     <a class="code" href="classPacket.html">PacketPtr</a> pkt = <a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a>-&gt;second.front();
<a name="l00302"></a>00302     <a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a>-&gt;second.pop();
<a name="l00303"></a>00303 
<a name="l00304"></a>00304     <span class="keywordflow">if</span> (<a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a>-&gt;second.empty())
<a name="l00305"></a>00305         <a class="code" href="classDRAMSim2.html#aa436e51811d19fcd65fcc5061afc981a">outstandingReads</a>.erase(<a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a>);
<a name="l00306"></a>00306 
<a name="l00307"></a>00307     <span class="comment">// no need to check for drain here as the next call will add a</span>
<a name="l00308"></a>00308     <span class="comment">// response to the response queue straight away</span>
<a name="l00309"></a>00309     assert(<a class="code" href="classDRAMSim2.html#a75a96fd06206c4a8580628497ad694df">nbrOutstandingReads</a> != 0);
<a name="l00310"></a>00310     --<a class="code" href="classDRAMSim2.html#a75a96fd06206c4a8580628497ad694df">nbrOutstandingReads</a>;
<a name="l00311"></a>00311 
<a name="l00312"></a>00312     <span class="comment">// perform the actual memory access</span>
<a name="l00313"></a>00313     <a class="code" href="classDRAMSim2.html#a26aa336cb4192aab04418121f361fa49">accessAndRespond</a>(pkt);
<a name="l00314"></a>00314 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5f0b4c4a94f6b0053f9d7a4eb9c2518a"></a><!-- doxytag: member="DRAMSim2::recvAtomic" ref="a5f0b4c4a94f6b0053f9d7a4eb9c2518a" args="(PacketPtr pkt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> recvAtomic </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classPacket.html">PacketPtr</a>&nbsp;</td>
          <td class="paramname"> <em>pkt</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00154"></a>00154 {
<a name="l00155"></a>00155     <a class="code" href="classAbstractMemory.html#aac5d96736802cb79fb2287135bcc1dff">access</a>(pkt);
<a name="l00156"></a>00156 
<a name="l00157"></a>00157     <span class="comment">// 50 ns is just an arbitrary value at this point</span>
<a name="l00158"></a>00158     <span class="keywordflow">return</span> pkt-&gt;<a class="code" href="classPacket.html#a9693a1ffeda326646443ab2a2a92be41">memInhibitAsserted</a>() ? 0 : 50000;
<a name="l00159"></a>00159 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aeefa907fb6d6a787e6dab90e8138ea90"></a><!-- doxytag: member="DRAMSim2::recvFunctional" ref="aeefa907fb6d6a787e6dab90e8138ea90" args="(PacketPtr pkt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void recvFunctional </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classPacket.html">PacketPtr</a>&nbsp;</td>
          <td class="paramname"> <em>pkt</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00163"></a>00163 {
<a name="l00164"></a>00164     pkt-&gt;<a class="code" href="classPacket.html#ad2656c333949d4b445823d47398829f2">pushLabel</a>(<a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>());
<a name="l00165"></a>00165 
<a name="l00166"></a>00166     <a class="code" href="classAbstractMemory.html#ace845b5316308e12fd958fa5df09a8e8">functionalAccess</a>(pkt);
<a name="l00167"></a>00167 
<a name="l00168"></a>00168     <span class="comment">// potentially update the packets in our response queue as well</span>
<a name="l00169"></a>00169     <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> = <a class="code" href="classDRAMSim2.html#a7dd56c8ca058e3e734ec0460b1587932">responseQueue</a>.begin(); <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> != <a class="code" href="classDRAMSim2.html#a7dd56c8ca058e3e734ec0460b1587932">responseQueue</a>.end(); ++<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>)
<a name="l00170"></a>00170         pkt-&gt;<a class="code" href="classPacket.html#a77410f93ce8057ce67882c121ac2e667">checkFunctional</a>(*<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>);
<a name="l00171"></a>00171 
<a name="l00172"></a>00172     pkt-&gt;<a class="code" href="classPacket.html#a3ab6da7065be0d85f45a8dd050515f16">popLabel</a>();
<a name="l00173"></a>00173 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a29cb5a4f98063ce6e9210eacbdb35298"></a><!-- doxytag: member="DRAMSim2::recvRetry" ref="a29cb5a4f98063ce6e9210eacbdb35298" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void recvRetry </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00244"></a>00244 {
<a name="l00245"></a>00245     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classDRAMSim2.html">DRAMSim2</a>, <span class="stringliteral">&quot;Retrying\n&quot;</span>);
<a name="l00246"></a>00246 
<a name="l00247"></a>00247     assert(<a class="code" href="classDRAMSim2.html#a6ddfdd4eb676d50001bda88567e6da14">retryResp</a>);
<a name="l00248"></a>00248     <a class="code" href="classDRAMSim2.html#a6ddfdd4eb676d50001bda88567e6da14">retryResp</a> = <span class="keyword">false</span>;
<a name="l00249"></a>00249     <a class="code" href="classDRAMSim2.html#a07982d2ae9430f5cd468e15bb4920ea4">sendResponse</a>();
<a name="l00250"></a>00250 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3344d9dd0f83257feab5424e761f31c6"></a><!-- doxytag: member="DRAMSim2::recvTimingReq" ref="a3344d9dd0f83257feab5424e761f31c6" args="(PacketPtr pkt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool recvTimingReq </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classPacket.html">PacketPtr</a>&nbsp;</td>
          <td class="paramname"> <em>pkt</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00177"></a>00177 {
<a name="l00178"></a>00178     <span class="comment">// we should never see a new request while in retry</span>
<a name="l00179"></a>00179     assert(!<a class="code" href="classDRAMSim2.html#aab3b947b2633a30b5973a39b7e9b018a">retryReq</a>);
<a name="l00180"></a>00180 
<a name="l00181"></a>00181     <span class="comment">// @todo temporary hack to deal with memory corruption issues until</span>
<a name="l00182"></a>00182     <span class="comment">// 4-phase transactions are complete</span>
<a name="l00183"></a>00183     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespaceX86ISA.html#ab5f9a01fc40e47853ae9551b008afcbd">x</a> = 0; <a class="code" href="namespaceX86ISA.html#ab5f9a01fc40e47853ae9551b008afcbd">x</a> &lt; <a class="code" href="classDRAMSim2.html#a21da4bea3554874b557428e4cce5d4a4">pendingDelete</a>.size(); <a class="code" href="namespaceX86ISA.html#ab5f9a01fc40e47853ae9551b008afcbd">x</a>++)
<a name="l00184"></a>00184         <span class="keyword">delete</span> <a class="code" href="classDRAMSim2.html#a21da4bea3554874b557428e4cce5d4a4">pendingDelete</a>[<a class="code" href="namespaceX86ISA.html#ab5f9a01fc40e47853ae9551b008afcbd">x</a>];
<a name="l00185"></a>00185     <a class="code" href="classDRAMSim2.html#a21da4bea3554874b557428e4cce5d4a4">pendingDelete</a>.clear();
<a name="l00186"></a>00186 
<a name="l00187"></a>00187     <span class="keywordflow">if</span> (pkt-&gt;<a class="code" href="classPacket.html#a9693a1ffeda326646443ab2a2a92be41">memInhibitAsserted</a>()) {
<a name="l00188"></a>00188         <span class="comment">// snooper will supply based on copy of packet</span>
<a name="l00189"></a>00189         <span class="comment">// still target&apos;s responsibility to delete packet</span>
<a name="l00190"></a>00190         <a class="code" href="classDRAMSim2.html#a21da4bea3554874b557428e4cce5d4a4">pendingDelete</a>.push_back(pkt);
<a name="l00191"></a>00191         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00192"></a>00192     }
<a name="l00193"></a>00193 
<a name="l00194"></a>00194     <span class="comment">// if we cannot accept we need to send a retry once progress can</span>
<a name="l00195"></a>00195     <span class="comment">// be made</span>
<a name="l00196"></a>00196     <span class="keywordtype">bool</span> can_accept = <a class="code" href="classDRAMSim2.html#a034e8a2b3dd91f3ad9ca116c60aa3ea5">nbrOutstanding</a>() &lt; <a class="code" href="classDRAMSim2.html#a19f45f63dee6f1b0a77c2758069683f8">wrapper</a>.<a class="code" href="classDRAMSim2Wrapper.html#a667ea9ca9654bced2242c6ccd77599ee">queueSize</a>();
<a name="l00197"></a>00197 
<a name="l00198"></a>00198     <span class="comment">// keep track of the transaction</span>
<a name="l00199"></a>00199     <span class="keywordflow">if</span> (pkt-&gt;<a class="code" href="classPacket.html#adc47901747fc3c447db3abddaf01491a">isRead</a>()) {
<a name="l00200"></a>00200         <span class="keywordflow">if</span> (can_accept) {
<a name="l00201"></a>00201             <a class="code" href="classDRAMSim2.html#aa436e51811d19fcd65fcc5061afc981a">outstandingReads</a>[pkt-&gt;<a class="code" href="classPacket.html#afca9af4d83a57836baba87603463a6e0">getAddr</a>()].push(pkt);
<a name="l00202"></a>00202 
<a name="l00203"></a>00203             <span class="comment">// we count a transaction as outstanding until it has left the</span>
<a name="l00204"></a>00204             <span class="comment">// queue in the controller, and the response has been sent</span>
<a name="l00205"></a>00205             <span class="comment">// back, note that this will differ for reads and writes</span>
<a name="l00206"></a>00206             ++<a class="code" href="classDRAMSim2.html#a75a96fd06206c4a8580628497ad694df">nbrOutstandingReads</a>;
<a name="l00207"></a>00207         }
<a name="l00208"></a>00208     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pkt-&gt;<a class="code" href="classPacket.html#ab699d2f0d186312531fd1c279fd27b73">isWrite</a>()) {
<a name="l00209"></a>00209         <span class="keywordflow">if</span> (can_accept) {
<a name="l00210"></a>00210             <a class="code" href="classDRAMSim2.html#ae3f05f6f5f0f558c32291a43c04fc1a1">outstandingWrites</a>[pkt-&gt;<a class="code" href="classPacket.html#afca9af4d83a57836baba87603463a6e0">getAddr</a>()].push(pkt);
<a name="l00211"></a>00211 
<a name="l00212"></a>00212             ++<a class="code" href="classDRAMSim2.html#ae13aa3a1980dc05e181f85d7304baa82">nbrOutstandingWrites</a>;
<a name="l00213"></a>00213 
<a name="l00214"></a>00214             <span class="comment">// perform the access for writes</span>
<a name="l00215"></a>00215             <a class="code" href="classDRAMSim2.html#a26aa336cb4192aab04418121f361fa49">accessAndRespond</a>(pkt);
<a name="l00216"></a>00216         }
<a name="l00217"></a>00217     } <span class="keywordflow">else</span> {
<a name="l00218"></a>00218         <span class="comment">// keep it simple and just respond if necessary</span>
<a name="l00219"></a>00219         <a class="code" href="classDRAMSim2.html#a26aa336cb4192aab04418121f361fa49">accessAndRespond</a>(pkt);
<a name="l00220"></a>00220         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00221"></a>00221     }
<a name="l00222"></a>00222 
<a name="l00223"></a>00223     <span class="keywordflow">if</span> (can_accept) {
<a name="l00224"></a>00224         <span class="comment">// we should never have a situation when we think there is space,</span>
<a name="l00225"></a>00225         <span class="comment">// and there isn&apos;t</span>
<a name="l00226"></a>00226         assert(<a class="code" href="classDRAMSim2.html#a19f45f63dee6f1b0a77c2758069683f8">wrapper</a>.<a class="code" href="classDRAMSim2Wrapper.html#a34b4e8ea869adbb57c71b30c55e6f5bd">canAccept</a>());
<a name="l00227"></a>00227 
<a name="l00228"></a>00228         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classDRAMSim2.html">DRAMSim2</a>, <span class="stringliteral">&quot;Enqueueing address %lld\n&quot;</span>, pkt-&gt;<a class="code" href="classPacket.html#afca9af4d83a57836baba87603463a6e0">getAddr</a>());
<a name="l00229"></a>00229 
<a name="l00230"></a>00230         <span class="comment">// @todo what about the granularity here, implicit assumption that</span>
<a name="l00231"></a>00231         <span class="comment">// a transaction matches the burst size of the memory (which we</span>
<a name="l00232"></a>00232         <span class="comment">// cannot determine without parsing the ini file ourselves)</span>
<a name="l00233"></a>00233         <a class="code" href="classDRAMSim2.html#a19f45f63dee6f1b0a77c2758069683f8">wrapper</a>.<a class="code" href="classDRAMSim2Wrapper.html#ae247cb4ece9657b8730c721920c23ab7">enqueue</a>(pkt-&gt;<a class="code" href="classPacket.html#ab699d2f0d186312531fd1c279fd27b73">isWrite</a>(), pkt-&gt;<a class="code" href="classPacket.html#afca9af4d83a57836baba87603463a6e0">getAddr</a>());
<a name="l00234"></a>00234 
<a name="l00235"></a>00235         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00236"></a>00236     } <span class="keywordflow">else</span> {
<a name="l00237"></a>00237         <a class="code" href="classDRAMSim2.html#aab3b947b2633a30b5973a39b7e9b018a">retryReq</a> = <span class="keyword">true</span>;
<a name="l00238"></a>00238         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00239"></a>00239     }
<a name="l00240"></a>00240 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a07982d2ae9430f5cd468e15bb4920ea4"></a><!-- doxytag: member="DRAMSim2::sendResponse" ref="a07982d2ae9430f5cd468e15bb4920ea4" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sendResponse </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00100"></a>00100 {
<a name="l00101"></a>00101     assert(!<a class="code" href="classDRAMSim2.html#a6ddfdd4eb676d50001bda88567e6da14">retryResp</a>);
<a name="l00102"></a>00102     assert(!<a class="code" href="classDRAMSim2.html#a7dd56c8ca058e3e734ec0460b1587932">responseQueue</a>.empty());
<a name="l00103"></a>00103 
<a name="l00104"></a>00104     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classDRAMSim2.html">DRAMSim2</a>, <span class="stringliteral">&quot;Attempting to send response\n&quot;</span>);
<a name="l00105"></a>00105 
<a name="l00106"></a>00106     <span class="keywordtype">bool</span> success = <a class="code" href="classDRAMSim2.html#a55c076720c982014096b57cadebf9a14">port</a>.<a class="code" href="classSlavePort.html#a0c021b2778a3358d110bd8700fe85732">sendTimingResp</a>(<a class="code" href="classDRAMSim2.html#a7dd56c8ca058e3e734ec0460b1587932">responseQueue</a>.front());
<a name="l00107"></a>00107     <span class="keywordflow">if</span> (success) {
<a name="l00108"></a>00108         <a class="code" href="classDRAMSim2.html#a7dd56c8ca058e3e734ec0460b1587932">responseQueue</a>.pop_front();
<a name="l00109"></a>00109 
<a name="l00110"></a>00110         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classDRAMSim2.html">DRAMSim2</a>, <span class="stringliteral">&quot;Have %d read, %d write, %d responses outstanding\n&quot;</span>,
<a name="l00111"></a>00111                 <a class="code" href="classDRAMSim2.html#a75a96fd06206c4a8580628497ad694df">nbrOutstandingReads</a>, <a class="code" href="classDRAMSim2.html#ae13aa3a1980dc05e181f85d7304baa82">nbrOutstandingWrites</a>,
<a name="l00112"></a>00112                 <a class="code" href="classDRAMSim2.html#a7dd56c8ca058e3e734ec0460b1587932">responseQueue</a>.size());
<a name="l00113"></a>00113 
<a name="l00114"></a>00114         <span class="keywordflow">if</span> (!<a class="code" href="classDRAMSim2.html#a7dd56c8ca058e3e734ec0460b1587932">responseQueue</a>.empty() &amp;&amp; !<a class="code" href="classDRAMSim2.html#a46a89603d961c3ae9b2cb2df412503f6">sendResponseEvent</a>.<a class="code" href="classEvent.html#a9cd69a6b10cb037550943f177a0da688" title="Determine if the current event is scheduled.">scheduled</a>())
<a name="l00115"></a>00115             <a class="code" href="classEventManager.html#a4ddebbfe9a12b95be6fb993ce892dcd3">schedule</a>(<a class="code" href="classDRAMSim2.html#a46a89603d961c3ae9b2cb2df412503f6">sendResponseEvent</a>, <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The universal simulation clock.">curTick</a>());
<a name="l00116"></a>00116 
<a name="l00117"></a>00117         <span class="comment">// check if we were asked to drain and if we are now done</span>
<a name="l00118"></a>00118         <span class="keywordflow">if</span> (<a class="code" href="classDRAMSim2.html#a329b71fb934a93312ca0aacbf5a3f982">drainManager</a> &amp;&amp; <a class="code" href="classDRAMSim2.html#a034e8a2b3dd91f3ad9ca116c60aa3ea5">nbrOutstanding</a>() == 0) {
<a name="l00119"></a>00119             <a class="code" href="classDRAMSim2.html#a329b71fb934a93312ca0aacbf5a3f982">drainManager</a>-&gt;<a class="code" href="classDrainManager.html#ab89d10e368d2e82061eddb9e40022382">signalDrainDone</a>();
<a name="l00120"></a>00120             <a class="code" href="classDRAMSim2.html#a329b71fb934a93312ca0aacbf5a3f982">drainManager</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00121"></a>00121         }
<a name="l00122"></a>00122     } <span class="keywordflow">else</span> {
<a name="l00123"></a>00123         <a class="code" href="classDRAMSim2.html#a6ddfdd4eb676d50001bda88567e6da14">retryResp</a> = <span class="keyword">true</span>;
<a name="l00124"></a>00124 
<a name="l00125"></a>00125         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classDRAMSim2.html">DRAMSim2</a>, <span class="stringliteral">&quot;Waiting for response retry\n&quot;</span>);
<a name="l00126"></a>00126 
<a name="l00127"></a>00127         assert(!<a class="code" href="classDRAMSim2.html#a46a89603d961c3ae9b2cb2df412503f6">sendResponseEvent</a>.<a class="code" href="classEvent.html#a9cd69a6b10cb037550943f177a0da688" title="Determine if the current event is scheduled.">scheduled</a>());
<a name="l00128"></a>00128     }
<a name="l00129"></a>00129 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aecc7d8debf54990ffeaaed5bac7d7d81"></a><!-- doxytag: member="DRAMSim2::startup" ref="aecc7d8debf54990ffeaaed5bac7d7d81" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void startup </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p><a class="el" href="classDRAMSim2.html#aecc7d8debf54990ffeaaed5bac7d7d81">startup()</a> is the final initialization call before simulation. All state is initialized (including unserialized state, if any, such as the <a class="el" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The universal simulation clock.">curTick()</a> value), so this is the appropriate place to schedule initial event(s) for objects that need them. </p>

<p><a class="el" href="classSimObject.html#aecc7d8debf54990ffeaaed5bac7d7d81">SimObject</a>を再定義しています。</p>

<p><div class="fragment"><pre class="fragment"><a name="l00093"></a>00093 {
<a name="l00094"></a>00094     <span class="comment">// kick off the clock ticks</span>
<a name="l00095"></a>00095     <a class="code" href="classEventManager.html#a4ddebbfe9a12b95be6fb993ce892dcd3">schedule</a>(<a class="code" href="classDRAMSim2.html#acab0bec584b681055f948abbbaf8acb2">tickEvent</a>, <a class="code" href="classClockedObject.html#a773956693f216cafb7d4cad92ad582e5">clockEdge</a>());
<a name="l00096"></a>00096 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a873dd91783f9efb4a590aded1f70d6b0"></a><!-- doxytag: member="DRAMSim2::tick" ref="a873dd91783f9efb4a590aded1f70d6b0" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void tick </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Progress the controller one clock cycle. </p>

<p><div class="fragment"><pre class="fragment"><a name="l00139"></a>00139 {
<a name="l00140"></a>00140     <a class="code" href="classDRAMSim2.html#a19f45f63dee6f1b0a77c2758069683f8">wrapper</a>.<a class="code" href="classDRAMSim2Wrapper.html#a873dd91783f9efb4a590aded1f70d6b0">tick</a>();
<a name="l00141"></a>00141 
<a name="l00142"></a>00142     <span class="comment">// is the connected port waiting for a retry, if so check the</span>
<a name="l00143"></a>00143     <span class="comment">// state and send a retry if conditions have changed</span>
<a name="l00144"></a>00144     <span class="keywordflow">if</span> (<a class="code" href="classDRAMSim2.html#aab3b947b2633a30b5973a39b7e9b018a">retryReq</a> &amp;&amp; <a class="code" href="classDRAMSim2.html#a034e8a2b3dd91f3ad9ca116c60aa3ea5">nbrOutstanding</a>() &lt; <a class="code" href="classDRAMSim2.html#a19f45f63dee6f1b0a77c2758069683f8">wrapper</a>.<a class="code" href="classDRAMSim2Wrapper.html#a667ea9ca9654bced2242c6ccd77599ee">queueSize</a>()) {
<a name="l00145"></a>00145         <a class="code" href="classDRAMSim2.html#aab3b947b2633a30b5973a39b7e9b018a">retryReq</a> = <span class="keyword">false</span>;
<a name="l00146"></a>00146         <a class="code" href="classDRAMSim2.html#a55c076720c982014096b57cadebf9a14">port</a>.<a class="code" href="classSlavePort.html#a6172657b944e32a722d90a20c5896bb7">sendRetry</a>();
<a name="l00147"></a>00147     }
<a name="l00148"></a>00148 
<a name="l00149"></a>00149     <a class="code" href="classEventManager.html#a4ddebbfe9a12b95be6fb993ce892dcd3">schedule</a>(<a class="code" href="classDRAMSim2.html#acab0bec584b681055f948abbbaf8acb2">tickEvent</a>, <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The universal simulation clock.">curTick</a>() + <a class="code" href="classDRAMSim2.html#a19f45f63dee6f1b0a77c2758069683f8">wrapper</a>.<a class="code" href="classDRAMSim2Wrapper.html#a6efe80b239837bd53bf8d8694c665993">clockPeriod</a>() * <a class="code" href="namespaceSimClock_1_1Int.html#a370bc05be45c1b9f039369ffd5c0efd4" title="nanosecond">SimClock::Int::ns</a>);
<a name="l00150"></a>00150 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aeb50ab991dbcebefc4952362893d0891"></a><!-- doxytag: member="DRAMSim2::writeComplete" ref="aeb50ab991dbcebefc4952362893d0891" args="(unsigned id, uint64_t addr, uint64_t cycle)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void writeComplete </td>
          <td>(</td>
          <td class="paramtype">unsigned&nbsp;</td>
          <td class="paramname"> <em>id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&nbsp;</td>
          <td class="paramname"> <em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&nbsp;</td>
          <td class="paramname"> <em>cycle</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Write completion callback.</p>
<dl><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>id</em>&nbsp;</td><td>Channel id of the responder </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>addr</em>&nbsp;</td><td><a class="el" href="classAddress.html">Address</a> of the request </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>cycle</em>&nbsp;</td><td>Internal cycle count of <a class="el" href="classDRAMSim2.html">DRAMSim2</a> </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l00317"></a>00317 {
<a name="l00318"></a>00318     assert(<a class="code" href="classClockedObject.html#a5dd7a975aae396561aafab3faa698033">cycle</a> == <a class="code" href="intmath_8hh.html#ae842b412d3570df97a944085b8f85850">divCeil</a>(<a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The universal simulation clock.">curTick</a>(),
<a name="l00319"></a>00319                             <a class="code" href="classDRAMSim2.html#a19f45f63dee6f1b0a77c2758069683f8">wrapper</a>.<a class="code" href="classDRAMSim2Wrapper.html#a6efe80b239837bd53bf8d8694c665993">clockPeriod</a>() * <a class="code" href="namespaceSimClock_1_1Int.html#a370bc05be45c1b9f039369ffd5c0efd4" title="nanosecond">SimClock::Int::ns</a>));
<a name="l00320"></a>00320 
<a name="l00321"></a>00321     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classDRAMSim2.html">DRAMSim2</a>, <span class="stringliteral">&quot;Write to address %lld complete\n&quot;</span>, <a class="code" href="namespaceX86ISA.html#ab705917f60c5566f9ce56a93f798b2e2">addr</a>);
<a name="l00322"></a>00322 
<a name="l00323"></a>00323     <span class="comment">// get the outstanding reads for the address in question</span>
<a name="l00324"></a>00324     <span class="keyword">auto</span> <a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a> = <a class="code" href="classDRAMSim2.html#ae3f05f6f5f0f558c32291a43c04fc1a1">outstandingWrites</a>.find(<a class="code" href="namespaceX86ISA.html#ab705917f60c5566f9ce56a93f798b2e2">addr</a>);
<a name="l00325"></a>00325     assert(<a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a> != <a class="code" href="classDRAMSim2.html#ae3f05f6f5f0f558c32291a43c04fc1a1">outstandingWrites</a>.end());
<a name="l00326"></a>00326 
<a name="l00327"></a>00327     <span class="comment">// we have already responded, and this is only to keep track of</span>
<a name="l00328"></a>00328     <span class="comment">// what is outstanding</span>
<a name="l00329"></a>00329     <a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a>-&gt;second.pop();
<a name="l00330"></a>00330     <span class="keywordflow">if</span> (<a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a>-&gt;second.empty())
<a name="l00331"></a>00331         <a class="code" href="classDRAMSim2.html#ae3f05f6f5f0f558c32291a43c04fc1a1">outstandingWrites</a>.erase(<a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a>);
<a name="l00332"></a>00332 
<a name="l00333"></a>00333     assert(<a class="code" href="classDRAMSim2.html#ae13aa3a1980dc05e181f85d7304baa82">nbrOutstandingWrites</a> != 0);
<a name="l00334"></a>00334     --<a class="code" href="classDRAMSim2.html#ae13aa3a1980dc05e181f85d7304baa82">nbrOutstandingWrites</a>;
<a name="l00335"></a>00335 
<a name="l00336"></a>00336     <span class="comment">// check if we were asked to drain and if we are now done</span>
<a name="l00337"></a>00337     <span class="keywordflow">if</span> (<a class="code" href="classDRAMSim2.html#a329b71fb934a93312ca0aacbf5a3f982">drainManager</a> &amp;&amp; <a class="code" href="classDRAMSim2.html#a034e8a2b3dd91f3ad9ca116c60aa3ea5">nbrOutstanding</a>() == 0) {
<a name="l00338"></a>00338         <a class="code" href="classDRAMSim2.html#a329b71fb934a93312ca0aacbf5a3f982">drainManager</a>-&gt;<a class="code" href="classDrainManager.html#ab89d10e368d2e82061eddb9e40022382">signalDrainDone</a>();
<a name="l00339"></a>00339         <a class="code" href="classDRAMSim2.html#a329b71fb934a93312ca0aacbf5a3f982">drainManager</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00340"></a>00340     }
<a name="l00341"></a>00341 }
</pre></div></p>

</div>
</div>
<hr/><h2>変数</h2>
<a class="anchor" id="a329b71fb934a93312ca0aacbf5a3f982"></a><!-- doxytag: member="DRAMSim2::drainManager" ref="a329b71fb934a93312ca0aacbf5a3f982" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classDrainManager.html">DrainManager</a>* <a class="el" href="classDRAMSim2.html#a329b71fb934a93312ca0aacbf5a3f982">drainManager</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>If we need to drain, keep the drain manager around until we're done here. </p>

</div>
</div>
<a class="anchor" id="a75a96fd06206c4a8580628497ad694df"></a><!-- doxytag: member="DRAMSim2::nbrOutstandingReads" ref="a75a96fd06206c4a8580628497ad694df" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int <a class="el" href="classDRAMSim2.html#a75a96fd06206c4a8580628497ad694df">nbrOutstandingReads</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Count the number of outstanding transactions so that we can block any further requests until there is space in <a class="el" href="classDRAMSim2.html">DRAMSim2</a> and the sending queue we need to buffer the response packets. </p>

</div>
</div>
<a class="anchor" id="ae13aa3a1980dc05e181f85d7304baa82"></a><!-- doxytag: member="DRAMSim2::nbrOutstandingWrites" ref="ae13aa3a1980dc05e181f85d7304baa82" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int <a class="el" href="classDRAMSim2.html#ae13aa3a1980dc05e181f85d7304baa82">nbrOutstandingWrites</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="aa436e51811d19fcd65fcc5061afc981a"></a><!-- doxytag: member="DRAMSim2::outstandingReads" ref="aa436e51811d19fcd65fcc5061afc981a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">m5::hash_map&lt;<a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a>, std::queue&lt;<a class="el" href="classPacket.html">PacketPtr</a>&gt; &gt; <a class="el" href="classDRAMSim2.html#aa436e51811d19fcd65fcc5061afc981a">outstandingReads</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Keep track of what packets are outstanding per address, and do so separately for reads and writes. This is done so that we can return the right packet on completion from <a class="el" href="namespaceDRAMSim.html">DRAMSim</a>. </p>

</div>
</div>
<a class="anchor" id="ae3f05f6f5f0f558c32291a43c04fc1a1"></a><!-- doxytag: member="DRAMSim2::outstandingWrites" ref="ae3f05f6f5f0f558c32291a43c04fc1a1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">m5::hash_map&lt;<a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a>, std::queue&lt;<a class="el" href="classPacket.html">PacketPtr</a>&gt; &gt; <a class="el" href="classDRAMSim2.html#ae3f05f6f5f0f558c32291a43c04fc1a1">outstandingWrites</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a21da4bea3554874b557428e4cce5d4a4"></a><!-- doxytag: member="DRAMSim2::pendingDelete" ref="a21da4bea3554874b557428e4cce5d4a4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classstd_1_1vector.html">std::vector</a>&lt;<a class="el" href="classPacket.html">PacketPtr</a>&gt; <a class="el" href="classDRAMSim2.html#a21da4bea3554874b557428e4cce5d4a4">pendingDelete</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000084">TODO:</a></b></dt><dd>this is a temporary workaround until the 4-phase code is committed. upstream caches needs this packet until true is returned, so hold onto it for deletion until a subsequent call </dd></dl>

</div>
</div>
<a class="anchor" id="a55c076720c982014096b57cadebf9a14"></a><!-- doxytag: member="DRAMSim2::port" ref="a55c076720c982014096b57cadebf9a14" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classDRAMSim2_1_1MemoryPort.html">MemoryPort</a> <a class="el" href="classDRAMSim2.html#a55c076720c982014096b57cadebf9a14">port</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a7dd56c8ca058e3e734ec0460b1587932"></a><!-- doxytag: member="DRAMSim2::responseQueue" ref="a7dd56c8ca058e3e734ec0460b1587932" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classstd_1_1deque.html">std::deque</a>&lt;<a class="el" href="classPacket.html">PacketPtr</a>&gt; <a class="el" href="classDRAMSim2.html#a7dd56c8ca058e3e734ec0460b1587932">responseQueue</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Queue to hold response packets until we can send them back. This is needed as <a class="el" href="classDRAMSim2.html">DRAMSim2</a> unconditionally passes responses back without any flow control. </p>

</div>
</div>
<a class="anchor" id="aab3b947b2633a30b5973a39b7e9b018a"></a><!-- doxytag: member="DRAMSim2::retryReq" ref="aab3b947b2633a30b5973a39b7e9b018a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classDRAMSim2.html#aab3b947b2633a30b5973a39b7e9b018a">retryReq</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Is the connected port waiting for a retry from us </p>

</div>
</div>
<a class="anchor" id="a6ddfdd4eb676d50001bda88567e6da14"></a><!-- doxytag: member="DRAMSim2::retryResp" ref="a6ddfdd4eb676d50001bda88567e6da14" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classDRAMSim2.html#a6ddfdd4eb676d50001bda88567e6da14">retryResp</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Are we waiting for a retry for sending a response. </p>

</div>
</div>
<a class="anchor" id="a46a89603d961c3ae9b2cb2df412503f6"></a><!-- doxytag: member="DRAMSim2::sendResponseEvent" ref="a46a89603d961c3ae9b2cb2df412503f6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classEventWrapper.html">EventWrapper</a>&lt;<a class="el" href="classDRAMSim2_1_1DRAMSim2.html">DRAMSim2</a>, &amp;DRAMSim2::sendResponse&gt; <a class="el" href="classDRAMSim2.html#a46a89603d961c3ae9b2cb2df412503f6">sendResponseEvent</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p><a class="el" href="classEvent.html">Event</a> to schedule sending of responses </p>

</div>
</div>
<a class="anchor" id="acab0bec584b681055f948abbbaf8acb2"></a><!-- doxytag: member="DRAMSim2::tickEvent" ref="acab0bec584b681055f948abbbaf8acb2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classEventWrapper.html">EventWrapper</a>&lt;<a class="el" href="classDRAMSim2_1_1DRAMSim2.html">DRAMSim2</a>, &amp;DRAMSim2::tick&gt; <a class="el" href="classDRAMSim2.html#acab0bec584b681055f948abbbaf8acb2">tickEvent</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p><a class="el" href="classEvent.html">Event</a> to schedule clock ticks </p>

</div>
</div>
<a class="anchor" id="a19f45f63dee6f1b0a77c2758069683f8"></a><!-- doxytag: member="DRAMSim2::wrapper" ref="a19f45f63dee6f1b0a77c2758069683f8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classDRAMSim2Wrapper.html">DRAMSim2Wrapper</a> <a class="el" href="classDRAMSim2.html#a19f45f63dee6f1b0a77c2758069683f8">wrapper</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>The actual <a class="el" href="classDRAMSim2.html">DRAMSim2</a> wrapper </p>

</div>
</div>
<hr/>このクラスの説明は次のファイルから生成されました:<ul>
<li>mem/<a class="el" href="dramsim2_8hh_source.html">dramsim2.hh</a></li>
<li>mem/<a class="el" href="dramsim2_8cc.html">dramsim2.cc</a></li>
</ul>
</div>
<hr size="1"/><address style="text-align: right;"><small>File&nbsp;GEM5&nbsp;Wrapperに対して25 May 2015に生成されました。&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
