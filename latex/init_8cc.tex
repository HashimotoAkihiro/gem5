\hypertarget{init_8cc}{
\section{sim/init.cc}
\label{init_8cc}\index{sim/init.cc@{sim/init.cc}}
}
{\ttfamily \#include $<$Python.h$>$}\par
{\ttfamily \#include $<$marshal.h$>$}\par
{\ttfamily \#include $<$zlib.h$>$}\par
{\ttfamily \#include $<$csignal$>$}\par
{\ttfamily \#include $<$iostream$>$}\par
{\ttfamily \#include $<$list$>$}\par
{\ttfamily \#include $<$string$>$}\par
{\ttfamily \#include \char`\"{}base/cprintf.hh\char`\"{}}\par
{\ttfamily \#include \char`\"{}base/misc.hh\char`\"{}}\par
{\ttfamily \#include \char`\"{}base/types.hh\char`\"{}}\par
{\ttfamily \#include \char`\"{}config/have\_\-protobuf.hh\char`\"{}}\par
{\ttfamily \#include \char`\"{}sim/async.hh\char`\"{}}\par
{\ttfamily \#include \char`\"{}sim/core.hh\char`\"{}}\par
{\ttfamily \#include \char`\"{}sim/init.hh\char`\"{}}\par
\subsection*{マクロ定義}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{init_8cc_ad3a907e4f3172e200b5568f7e1df2e5d}{PyCC}(x)~(const\_\-cast$<$char $\ast$$>$(x))
\end{DoxyCompactItemize}
\subsection*{関数}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{init_8cc_a022a6cffd1e62434c8d2db231132ebc5}{dumpStatsHandler} (int sigtype)
\begin{DoxyCompactList}\small\item\em \hyperlink{namespaceStats}{Stats} signal handler. \item\end{DoxyCompactList}\item 
void \hyperlink{init_8cc_aa15513491cd8b43dacf2680124c1feec}{dumprstStatsHandler} (int sigtype)
\item 
void \hyperlink{init_8cc_a82498a29f5c97cedefc027aef34c198a}{exitNowHandler} (int sigtype)
\begin{DoxyCompactList}\small\item\em Exit signal handler. \item\end{DoxyCompactList}\item 
void \hyperlink{init_8cc_a285bd5faf9d027a414cc6c68c1af574c}{abortHandler} (int sigtype)
\begin{DoxyCompactList}\small\item\em Abort signal handler. \item\end{DoxyCompactList}\item 
static void \hyperlink{init_8cc_a361675b1f677f02aae12cc058106f802}{ioHandler} (int sigtype)
\item 
static void \hyperlink{init_8cc_aa65550c86dd9e19dd93f4271afd4251c}{installSignalHandler} (int signal, void($\ast$handler)(int sigtype))
\item 
void \hyperlink{init_8cc_a8e6d6582b28c82a93332d8f8fc331c71}{initSignals} ()
\item 
int \hyperlink{init_8cc_a3b22eeb5fc94acc80cbbf4d9baa19ea2}{initM5Python} ()
\item 
const char $\ast$ \hyperlink{init_8cc_aff02fcdd36bf0c05520cfd39fd4eff67}{\_\-\_\-attribute\_\-\_\-} ((weak)) \hyperlink{stattest_8cc_ac696f96d01f515b5050bbae13c38fe01}{m5MainCommands}\mbox{[}$\,$\mbox{]}
\item 
int \hyperlink{init_8cc_a2c29b07c70d79dfd1b822d2b0cdd50c0}{m5Main} (int argc, char $\ast$$\ast$argv)
\item 
PyMODINIT\_\-FUNC \hyperlink{init_8cc_a0315a0cf1d812b58eb30d8c40e4f83f7}{initm5} (void)
\end{DoxyCompactItemize}


\subsection{マクロ定義}
\hypertarget{init_8cc_ad3a907e4f3172e200b5568f7e1df2e5d}{
\index{init.cc@{init.cc}!PyCC@{PyCC}}
\index{PyCC@{PyCC}!init.cc@{init.cc}}
\subsubsection[{PyCC}]{\setlength{\rightskip}{0pt plus 5cm}\#define PyCC(x)~(const\_\-cast$<$char $\ast$$>$(x))}}
\label{init_8cc_ad3a907e4f3172e200b5568f7e1df2e5d}


\subsection{関数}
\hypertarget{init_8cc_aff02fcdd36bf0c05520cfd39fd4eff67}{
\index{init.cc@{init.cc}!\_\-\_\-attribute\_\-\_\-@{\_\-\_\-attribute\_\-\_\-}}
\index{\_\-\_\-attribute\_\-\_\-@{\_\-\_\-attribute\_\-\_\-}!init.cc@{init.cc}}
\subsubsection[{\_\-\_\-attribute\_\-\_\-}]{\setlength{\rightskip}{0pt plus 5cm}const char$\ast$ \_\-\_\-attribute\_\-\_\- ((weak))}}
\label{init_8cc_aff02fcdd36bf0c05520cfd39fd4eff67}
\hypertarget{init_8cc_a285bd5faf9d027a414cc6c68c1af574c}{
\index{init.cc@{init.cc}!abortHandler@{abortHandler}}
\index{abortHandler@{abortHandler}!init.cc@{init.cc}}
\subsubsection[{abortHandler}]{\setlength{\rightskip}{0pt plus 5cm}void abortHandler (int {\em sigtype})}}
\label{init_8cc_a285bd5faf9d027a414cc6c68c1af574c}


Abort signal handler. 


\begin{DoxyCode}
95 {
96     ccprintf(cerr, "Program aborted at tick %d\n", curTick());
97 }
\end{DoxyCode}
\hypertarget{init_8cc_aa15513491cd8b43dacf2680124c1feec}{
\index{init.cc@{init.cc}!dumprstStatsHandler@{dumprstStatsHandler}}
\index{dumprstStatsHandler@{dumprstStatsHandler}!init.cc@{init.cc}}
\subsubsection[{dumprstStatsHandler}]{\setlength{\rightskip}{0pt plus 5cm}void dumprstStatsHandler (int {\em sigtype})}}
\label{init_8cc_aa15513491cd8b43dacf2680124c1feec}



\begin{DoxyCode}
78 {
79     async_event = true;
80     async_statdump = true;
81     async_statreset = true;
82 }
\end{DoxyCode}
\hypertarget{init_8cc_a022a6cffd1e62434c8d2db231132ebc5}{
\index{init.cc@{init.cc}!dumpStatsHandler@{dumpStatsHandler}}
\index{dumpStatsHandler@{dumpStatsHandler}!init.cc@{init.cc}}
\subsubsection[{dumpStatsHandler}]{\setlength{\rightskip}{0pt plus 5cm}void dumpStatsHandler (int {\em sigtype})}}
\label{init_8cc_a022a6cffd1e62434c8d2db231132ebc5}


\hyperlink{namespaceStats}{Stats} signal handler. 


\begin{DoxyCode}
71 {
72     async_event = true;
73     async_statdump = true;
74 }
\end{DoxyCode}
\hypertarget{init_8cc_a82498a29f5c97cedefc027aef34c198a}{
\index{init.cc@{init.cc}!exitNowHandler@{exitNowHandler}}
\index{exitNowHandler@{exitNowHandler}!init.cc@{init.cc}}
\subsubsection[{exitNowHandler}]{\setlength{\rightskip}{0pt plus 5cm}void exitNowHandler (int {\em sigtype})}}
\label{init_8cc_a82498a29f5c97cedefc027aef34c198a}


Exit signal handler. 


\begin{DoxyCode}
87 {
88     async_event = true;
89     async_exit = true;
90 }
\end{DoxyCode}
\hypertarget{init_8cc_a0315a0cf1d812b58eb30d8c40e4f83f7}{
\index{init.cc@{init.cc}!initm5@{initm5}}
\index{initm5@{initm5}!init.cc@{init.cc}}
\subsubsection[{initm5}]{\setlength{\rightskip}{0pt plus 5cm}PyMODINIT\_\-FUNC initm5 (void)}}
\label{init_8cc_a0315a0cf1d812b58eb30d8c40e4f83f7}



\begin{DoxyCode}
325 {
326     initM5Python();
327     PyImport_ImportModule(PyCC("m5"));
328 }
\end{DoxyCode}
\hypertarget{init_8cc_a3b22eeb5fc94acc80cbbf4d9baa19ea2}{
\index{init.cc@{init.cc}!initM5Python@{initM5Python}}
\index{initM5Python@{initM5Python}!init.cc@{init.cc}}
\subsubsection[{initM5Python}]{\setlength{\rightskip}{0pt plus 5cm}int initM5Python ()}}
\label{init_8cc_a3b22eeb5fc94acc80cbbf4d9baa19ea2}



\begin{DoxyCode}
262 {
263     EmbeddedSwig::initAll();
264     return EmbeddedPython::initAll();
265 }
\end{DoxyCode}
\hypertarget{init_8cc_a8e6d6582b28c82a93332d8f8fc331c71}{
\index{init.cc@{init.cc}!initSignals@{initSignals}}
\index{initSignals@{initSignals}!init.cc@{init.cc}}
\subsubsection[{initSignals}]{\setlength{\rightskip}{0pt plus 5cm}void initSignals ()}}
\label{init_8cc_a8e6d6582b28c82a93332d8f8fc331c71}



\begin{DoxyCode}
127 {
128     // Floating point exceptions may happen on misspeculated paths, so
129     // ignore them
130     signal(SIGFPE, SIG_IGN);
131 
132     // We use SIGTRAP sometimes for debugging
133     signal(SIGTRAP, SIG_IGN);
134 
135     // Dump intermediate stats
136     installSignalHandler(SIGUSR1, dumpStatsHandler);
137 
138     // Dump intermediate stats and reset them
139     installSignalHandler(SIGUSR2, dumprstStatsHandler);
140 
141     // Exit cleanly on Interrupt (Ctrl-C)
142     installSignalHandler(SIGINT, exitNowHandler);
143 
144     // Print out cycle number on abort
145     installSignalHandler(SIGABRT, abortHandler);
146 
147     // Install a SIGIO handler to handle asynchronous file IO. See the
148     // PollQueue class.
149     installSignalHandler(SIGIO, ioHandler);
150 }
\end{DoxyCode}
\hypertarget{init_8cc_aa65550c86dd9e19dd93f4271afd4251c}{
\index{init.cc@{init.cc}!installSignalHandler@{installSignalHandler}}
\index{installSignalHandler@{installSignalHandler}!init.cc@{init.cc}}
\subsubsection[{installSignalHandler}]{\setlength{\rightskip}{0pt plus 5cm}static void installSignalHandler (int {\em signal}, \/  void($\ast$)(int sigtype) {\em handler})\hspace{0.3cm}{\ttfamily  \mbox{[}static\mbox{]}}}}
\label{init_8cc_aa65550c86dd9e19dd93f4271afd4251c}



\begin{DoxyCode}
109 {
110     struct sigaction sa;
111 
112     memset(&sa, 0, sizeof(sa));
113     sigemptyset(&sa.sa_mask);
114     sa.sa_handler = handler;
115     sa.sa_flags = SA_RESTART;
116 
117     if (sigaction(signal, &sa, NULL) == -1)
118         panic("Failed to setup handler for signal %i\n", signal);
119 }
\end{DoxyCode}
\hypertarget{init_8cc_a361675b1f677f02aae12cc058106f802}{
\index{init.cc@{init.cc}!ioHandler@{ioHandler}}
\index{ioHandler@{ioHandler}!init.cc@{init.cc}}
\subsubsection[{ioHandler}]{\setlength{\rightskip}{0pt plus 5cm}static void ioHandler (int {\em sigtype})\hspace{0.3cm}{\ttfamily  \mbox{[}static\mbox{]}}}}
\label{init_8cc_a361675b1f677f02aae12cc058106f802}



\begin{DoxyCode}
102 {
103     async_event = true;
104     async_io = true;
105 }
\end{DoxyCode}
\hypertarget{init_8cc_a2c29b07c70d79dfd1b822d2b0cdd50c0}{
\index{init.cc@{init.cc}!m5Main@{m5Main}}
\index{m5Main@{m5Main}!init.cc@{init.cc}}
\subsubsection[{m5Main}]{\setlength{\rightskip}{0pt plus 5cm}int m5Main (int {\em argc}, \/  char $\ast$$\ast$ {\em argv})}}
\label{init_8cc_a2c29b07c70d79dfd1b822d2b0cdd50c0}



\begin{DoxyCode}
283 {
284 #if HAVE_PROTOBUF
285     // Verify that the version of the protobuf library that we linked
286     // against is compatible with the version of the headers we
287     // compiled against.
288     GOOGLE_PROTOBUF_VERIFY_VERSION;
289 #endif
290 
291     PySys_SetArgv(argc, argv);
292 
293     // We have to set things up in the special __main__ module
294     PyObject *module = PyImport_AddModule(PyCC("__main__"));
295     if (module == NULL)
296         panic("Could not import __main__");
297     PyObject *dict = PyModule_GetDict(module);
298 
299     // import the main m5 module
300     PyObject *result;
301     const char **command = m5MainCommands;
302 
303     // evaluate each command in the m5MainCommands array (basically a
304     // bunch of python statements.
305     while (*command) {
306         result = PyRun_String(*command, Py_file_input, dict, dict);
307         if (!result) {
308             PyErr_Print();
309             return 1;
310         }
311         Py_DECREF(result);
312 
313         command++;
314     }
315 
316 #if HAVE_PROTOBUF
317     google::protobuf::ShutdownProtobufLibrary();
318 #endif
319 
320     return 0;
321 }
\end{DoxyCode}
