<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>File&nbsp;GEM5&nbsp;Wrapper: cpu/kvm/x86_cpu.cc</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- 作成： Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>メインページ</span></a></li>
      <li><a href="pages.html"><span>関連ページ</span></a></li>
      <li><a href="modules.html"><span>モジュール</span></a></li>
      <li><a href="namespaces.html"><span>ネームスペース</span></a></li>
      <li><a href="annotated.html"><span>クラス</span></a></li>
      <li class="current"><a href="files.html"><span>ファイル</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>ファイル一覧</span></a></li>
      <li><a href="globals.html"><span>ファイルメンバ</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>cpu/kvm/x86_cpu.cc</h1><code>#include &lt;linux/kvm.h&gt;</code><br/>
<code>#include &lt;algorithm&gt;</code><br/>
<code>#include &lt;cerrno&gt;</code><br/>
<code>#include &lt;memory&gt;</code><br/>
<code>#include &quot;<a class="el" href="msr_8hh_source.html">arch/x86/regs/msr.hh</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="cpuid_8hh_source.html">arch/x86/cpuid.hh</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="x86_2utility_8hh_source.html">arch/x86/utility.hh</a>&quot;</code><br/>
<code>#include &quot;arch/registers.hh&quot;</code><br/>
<code>#include &quot;<a class="el" href="cpu_2kvm_2base_8hh_source.html">cpu/kvm/base.hh</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="x86__cpu_8hh_source.html">cpu/kvm/x86_cpu.hh</a>&quot;</code><br/>
<code>#include &quot;debug/Drain.hh&quot;</code><br/>
<code>#include &quot;debug/Kvm.hh&quot;</code><br/>
<code>#include &quot;debug/KvmContext.hh&quot;</code><br/>
<code>#include &quot;debug/KvmIO.hh&quot;</code><br/>
<code>#include &quot;debug/KvmInt.hh&quot;</code><br/>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>構成</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structFXSave.html">FXSave</a></td></tr>
<tr><td colspan="2"><h2>マクロ定義</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__cpu_8cc.html#a48a07da9eda1a7054027cbbd5701f7cc">MSR_TSC</a>&nbsp;&nbsp;&nbsp;0x10</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__cpu_8cc.html#aa249f80ee7382ea304af9e36af7e7b36">IO_PCI_CONF_ADDR</a>&nbsp;&nbsp;&nbsp;0xCF8</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__cpu_8cc.html#a5242fcbaf586dae287efe4163b97c019">IO_PCI_CONF_DATA_BASE</a>&nbsp;&nbsp;&nbsp;0xCFC</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__cpu_8cc.html#ab981dfcf0b109de1740a5684d6eed5d8">SEG_SYS_TYPE_TSS_AVAILABLE</a>&nbsp;&nbsp;&nbsp;9</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__cpu_8cc.html#a7dbae927888360923f7d7dbb529a3668">SEG_SYS_TYPE_TSS_BUSY</a>&nbsp;&nbsp;&nbsp;11</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__cpu_8cc.html#a4a17e8eb656d44e302e42eaad4ed7d55">SEG_CS_TYPE_ACCESSED</a>&nbsp;&nbsp;&nbsp;9</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__cpu_8cc.html#a64546b78e0c66406e0c585251017e97d">SEG_CS_TYPE_READ_ACCESSED</a>&nbsp;&nbsp;&nbsp;11</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__cpu_8cc.html#a4d4061bc93950e881300fc67c076eebd">SEG_TYPE_BIT_ACCESSED</a>&nbsp;&nbsp;&nbsp;1</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__cpu_8cc.html#a1b70a9e03d3e57124b5ec691a3de8720">FOREACH_IREG</a>()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__cpu_8cc.html#aa90701ca0a4e8e76a8fe2e712b1435a2">FOREACH_SREG</a>()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__cpu_8cc.html#a356ecb0e240862ff8435fda6237e8cc9">FOREACH_DREG</a>()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__cpu_8cc.html#a9687b0de58e7126c4e4bfa5396205bfe">FOREACH_SEGMENT</a>()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__cpu_8cc.html#ad8b16766eca6fa646fa2cc82fbd44cb7">FOREACH_DTABLE</a>()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__cpu_8cc.html#acd661b64526a8ecbee8a9930ebd7b0be">APPLY_IREG</a>(kreg, mreg)&nbsp;&nbsp;&nbsp;inform(&quot;\t&quot; # kreg &quot;: 0x%llx\n&quot;, regs.kreg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__cpu_8cc.html#a0388026cca60eb03b28dec28749123c7">APPLY_SREG</a>(kreg, mreg)&nbsp;&nbsp;&nbsp;inform(&quot;\t&quot; # kreg &quot;: 0x%llx\n&quot;, sregs.kreg);</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__cpu_8cc.html#a63320c6620c2a08acd1dd9338417ec95">APPLY_SEGMENT</a>(kreg, idx)&nbsp;&nbsp;&nbsp;dumpKvm(# kreg, sregs.kreg);</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__cpu_8cc.html#aba8cb1b1518fbda6abb37867aa6b8af2">APPLY_DTABLE</a>(kreg, idx)&nbsp;&nbsp;&nbsp;dumpKvm(# kreg, sregs.kreg);</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__cpu_8cc.html#acd661b64526a8ecbee8a9930ebd7b0be">APPLY_IREG</a>(kreg, mreg)&nbsp;&nbsp;&nbsp;regs.kreg = tc-&gt;readIntReg(mreg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__cpu_8cc.html#a0388026cca60eb03b28dec28749123c7">APPLY_SREG</a>(kreg, mreg)&nbsp;&nbsp;&nbsp;sregs.kreg = tc-&gt;readMiscRegNoEffect(mreg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__cpu_8cc.html#a63320c6620c2a08acd1dd9338417ec95">APPLY_SEGMENT</a>(kreg, idx)&nbsp;&nbsp;&nbsp;setKvmSegmentReg(tc, sregs.kreg, idx)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__cpu_8cc.html#aba8cb1b1518fbda6abb37867aa6b8af2">APPLY_DTABLE</a>(kreg, idx)&nbsp;&nbsp;&nbsp;setKvmDTableReg(tc, sregs.kreg, idx)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__cpu_8cc.html#a63320c6620c2a08acd1dd9338417ec95">APPLY_SEGMENT</a>(kreg, idx)&nbsp;&nbsp;&nbsp;checkSeg(# kreg, idx + MISCREG_SEG_SEL_BASE, sregs.kreg, sregs)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__cpu_8cc.html#acd661b64526a8ecbee8a9930ebd7b0be">APPLY_IREG</a>(kreg, mreg)&nbsp;&nbsp;&nbsp;tc-&gt;setIntReg(mreg, regs.kreg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__cpu_8cc.html#a0388026cca60eb03b28dec28749123c7">APPLY_SREG</a>(kreg, mreg)&nbsp;&nbsp;&nbsp;tc-&gt;setMiscRegNoEffect(mreg, sregs.kreg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__cpu_8cc.html#a63320c6620c2a08acd1dd9338417ec95">APPLY_SEGMENT</a>(kreg, idx)&nbsp;&nbsp;&nbsp;setContextSegment(tc, sregs.kreg, idx)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__cpu_8cc.html#aba8cb1b1518fbda6abb37867aa6b8af2">APPLY_DTABLE</a>(kreg, idx)&nbsp;&nbsp;&nbsp;setContextSegment(tc, sregs.kreg, idx)</td></tr>
<tr><td colspan="2"><h2>関数</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__cpu_8cc.html#a954bbe2225157cef7b550ee58ce351bd">static_assert</a> (sizeof(<a class="el" href="structFXSave.html">FXSave</a>)==512,&quot;Unexpected size of <a class="el" href="structFXSave.html">FXSave</a>&quot;)</td></tr>
<tr><td class="memTemplParams" colspan="2">template&lt;typename STRUCT , typename ENTRY &gt; </td></tr>
<tr><td class="memTemplItemLeft" align="right" valign="top">static STRUCT *&nbsp;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="x86__cpu_8cc.html#a28d3018844ed28641faabd89ab18e3ff">newVarStruct</a> (size_t entries)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__cpu_8cc.html#ac071f56204bac6717fe834e758908929">dumpKvm</a> (const struct kvm_regs &amp;regs)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__cpu_8cc.html#a74ec3b8549e1f3e742423b0ec38bb9de">dumpKvm</a> (const char *reg_name, const struct kvm_segment &amp;seg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__cpu_8cc.html#a69fa7ec6c7399ac8aa29df5e7bfa9efc">dumpKvm</a> (const char *reg_name, const struct kvm_dtable &amp;dtable)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__cpu_8cc.html#a36910f19c3862f43565434410f6d211b">dumpKvm</a> (const struct kvm_sregs &amp;sregs)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__cpu_8cc.html#adf41008a4447459acb9f919d51a2805b">dumpFpuSpec</a> (const struct <a class="el" href="structFXSave.html">FXSave</a> &amp;xs)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__cpu_8cc.html#a66c7b9de0f3bb8c466dd0b8d4fb3567b">dumpFpuSpec</a> (const struct kvm_fpu &amp;fpu)</td></tr>
<tr><td class="memTemplParams" colspan="2">template&lt;typename T &gt; </td></tr>
<tr><td class="memTemplItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="x86__cpu_8cc.html#a46f5ba7be6890a81b497c1eeaf8c2029">dumpFpuCommon</a> (const T &amp;fpu)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__cpu_8cc.html#a97136c2e8a5ac2deba6e38795d3b5053">dumpKvm</a> (const struct kvm_fpu &amp;fpu)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__cpu_8cc.html#a865009cd8e167f82ccbd8cdca9eb143c">dumpKvm</a> (const struct kvm_xsave &amp;xsave)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__cpu_8cc.html#ae1337a353229bd0870744e1043623ff4">dumpKvm</a> (const struct kvm_msrs &amp;msrs)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__cpu_8cc.html#af915161a847a8b42b652e6196c97d13f">dumpKvm</a> (const struct kvm_xcrs &amp;regs)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__cpu_8cc.html#afbf85fdc9a68b6997ea5f91a0c17ec10">dumpKvm</a> (const struct kvm_vcpu_events &amp;events)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__cpu_8cc.html#a897edaa2f5ac7a67d3897d65908e8522">isCanonicalAddress</a> (uint64_t addr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__cpu_8cc.html#a7174d4d5d8e57f423f727d67beaa463d">checkSeg</a> (const char *name, const int idx, const struct kvm_segment &amp;seg, struct kvm_sregs sregs)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__cpu_8cc.html#a05127157d55aca2814725c2e283a2d19">setKvmSegmentReg</a> (<a class="el" href="classThreadContext.html">ThreadContext</a> *tc, struct kvm_segment &amp;kvm_seg, const int index)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__cpu_8cc.html#a51d8093baee27ba8789bb1af7af824a2">setKvmDTableReg</a> (<a class="el" href="classThreadContext.html">ThreadContext</a> *tc, struct kvm_dtable &amp;kvm_dtable, const int index)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__cpu_8cc.html#a0dd1c17ee1639164887df8dae4a46861">forceSegAccessed</a> (struct kvm_segment &amp;seg)</td></tr>
<tr><td class="memTemplParams" colspan="2">template&lt;typename T &gt; </td></tr>
<tr><td class="memTemplItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="x86__cpu_8cc.html#af4646df895fd6ad546cfecaa85e782b7">updateKvmStateFPUCommon</a> (<a class="el" href="classThreadContext.html">ThreadContext</a> *tc, T &amp;fpu)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__cpu_8cc.html#a95c05cceb7cdce6304fb8ebe174bf300">setContextSegment</a> (<a class="el" href="classThreadContext.html">ThreadContext</a> *tc, const struct kvm_segment &amp;kvm_seg, const int index)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__cpu_8cc.html#ada916424bb12b00a7176788153a7a2f4">setContextSegment</a> (<a class="el" href="classThreadContext.html">ThreadContext</a> *tc, const struct kvm_dtable &amp;kvm_dtable, const int index)</td></tr>
<tr><td class="memTemplParams" colspan="2">template&lt;typename T &gt; </td></tr>
<tr><td class="memTemplItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="x86__cpu_8cc.html#a313c58fe9310f894c07dda533fde7fbb">updateThreadContextFPUCommon</a> (<a class="el" href="classThreadContext.html">ThreadContext</a> *tc, const T &amp;fpu)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct kvm_cpuid_entry2&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__cpu_8cc.html#a8e529a8d690941d970b53028ee411ec2">makeKvmCpuid</a> (<a class="el" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> function, <a class="el" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> index, <a class="el" href="structX86ISA_1_1CpuidResult.html">CpuidResult</a> &amp;result)</td></tr>
<tr><td colspan="2"><h2>変数</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structFXSave.html">FXSave</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__cpu_8cc.html#a71c71aceb8fa2a663f6ac608a6df0b08">M5_ATTR_PACKED</a></td></tr>
</table>
<hr/><h2>マクロ定義</h2>
<a class="anchor" id="aba8cb1b1518fbda6abb37867aa6b8af2"></a><!-- doxytag: member="x86_cpu.cc::APPLY_DTABLE" ref="aba8cb1b1518fbda6abb37867aa6b8af2" args="(kreg, idx)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define APPLY_DTABLE</td>
          <td>(</td>
          <td class="paramtype">kreg, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">idx&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;setContextSegment(tc, sregs.kreg, idx)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="aba8cb1b1518fbda6abb37867aa6b8af2"></a><!-- doxytag: member="x86_cpu.cc::APPLY_DTABLE" ref="aba8cb1b1518fbda6abb37867aa6b8af2" args="(kreg, idx)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define APPLY_DTABLE</td>
          <td>(</td>
          <td class="paramtype">kreg, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">idx&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;setKvmDTableReg(tc, sregs.kreg, idx)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="aba8cb1b1518fbda6abb37867aa6b8af2"></a><!-- doxytag: member="x86_cpu.cc::APPLY_DTABLE" ref="aba8cb1b1518fbda6abb37867aa6b8af2" args="(kreg, idx)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define APPLY_DTABLE</td>
          <td>(</td>
          <td class="paramtype">kreg, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">idx&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;dumpKvm(# kreg, sregs.kreg);</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="acd661b64526a8ecbee8a9930ebd7b0be"></a><!-- doxytag: member="x86_cpu.cc::APPLY_IREG" ref="acd661b64526a8ecbee8a9930ebd7b0be" args="(kreg, mreg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define APPLY_IREG</td>
          <td>(</td>
          <td class="paramtype">kreg, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">mreg&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;tc-&gt;setIntReg(mreg, regs.kreg)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="acd661b64526a8ecbee8a9930ebd7b0be"></a><!-- doxytag: member="x86_cpu.cc::APPLY_IREG" ref="acd661b64526a8ecbee8a9930ebd7b0be" args="(kreg, mreg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define APPLY_IREG</td>
          <td>(</td>
          <td class="paramtype">kreg, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">mreg&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;regs.kreg = tc-&gt;readIntReg(mreg)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="acd661b64526a8ecbee8a9930ebd7b0be"></a><!-- doxytag: member="x86_cpu.cc::APPLY_IREG" ref="acd661b64526a8ecbee8a9930ebd7b0be" args="(kreg, mreg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define APPLY_IREG</td>
          <td>(</td>
          <td class="paramtype">kreg, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">mreg&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;inform(&quot;\t&quot; # kreg &quot;: 0x%llx\n&quot;, regs.kreg)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a63320c6620c2a08acd1dd9338417ec95"></a><!-- doxytag: member="x86_cpu.cc::APPLY_SEGMENT" ref="a63320c6620c2a08acd1dd9338417ec95" args="(kreg, idx)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define APPLY_SEGMENT</td>
          <td>(</td>
          <td class="paramtype">kreg, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">idx&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;setContextSegment(tc, sregs.kreg, idx)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a63320c6620c2a08acd1dd9338417ec95"></a><!-- doxytag: member="x86_cpu.cc::APPLY_SEGMENT" ref="a63320c6620c2a08acd1dd9338417ec95" args="(kreg, idx)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define APPLY_SEGMENT</td>
          <td>(</td>
          <td class="paramtype">kreg, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">idx&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;checkSeg(# kreg, idx + MISCREG_SEG_SEL_BASE, sregs.kreg, sregs)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a63320c6620c2a08acd1dd9338417ec95"></a><!-- doxytag: member="x86_cpu.cc::APPLY_SEGMENT" ref="a63320c6620c2a08acd1dd9338417ec95" args="(kreg, idx)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define APPLY_SEGMENT</td>
          <td>(</td>
          <td class="paramtype">kreg, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">idx&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;setKvmSegmentReg(tc, sregs.kreg, idx)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a63320c6620c2a08acd1dd9338417ec95"></a><!-- doxytag: member="x86_cpu.cc::APPLY_SEGMENT" ref="a63320c6620c2a08acd1dd9338417ec95" args="(kreg, idx)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define APPLY_SEGMENT</td>
          <td>(</td>
          <td class="paramtype">kreg, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">idx&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;dumpKvm(# kreg, sregs.kreg);</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a0388026cca60eb03b28dec28749123c7"></a><!-- doxytag: member="x86_cpu.cc::APPLY_SREG" ref="a0388026cca60eb03b28dec28749123c7" args="(kreg, mreg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define APPLY_SREG</td>
          <td>(</td>
          <td class="paramtype">kreg, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">mreg&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;tc-&gt;setMiscRegNoEffect(mreg, sregs.kreg)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a0388026cca60eb03b28dec28749123c7"></a><!-- doxytag: member="x86_cpu.cc::APPLY_SREG" ref="a0388026cca60eb03b28dec28749123c7" args="(kreg, mreg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define APPLY_SREG</td>
          <td>(</td>
          <td class="paramtype">kreg, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">mreg&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;sregs.kreg = tc-&gt;readMiscRegNoEffect(mreg)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a0388026cca60eb03b28dec28749123c7"></a><!-- doxytag: member="x86_cpu.cc::APPLY_SREG" ref="a0388026cca60eb03b28dec28749123c7" args="(kreg, mreg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define APPLY_SREG</td>
          <td>(</td>
          <td class="paramtype">kreg, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">mreg&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;inform(&quot;\t&quot; # kreg &quot;: 0x%llx\n&quot;, sregs.kreg);</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a356ecb0e240862ff8435fda6237e8cc9"></a><!-- doxytag: member="x86_cpu.cc::FOREACH_DREG" ref="a356ecb0e240862ff8435fda6237e8cc9" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FOREACH_DREG</td>
          <td>(</td>
&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>値:</b><div class="fragment"><pre class="fragment"><span class="keywordflow">do</span> {                                        \
        APPLY_DREG(db[0], <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67a0f0728501be9d4a351cb3988f5441178">MISCREG_DR0</a>);         \
        APPLY_DREG(db[1], <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67a41a9ed961eb10c2dd5f5c5b156fd67d2">MISCREG_DR1</a>);         \
        APPLY_DREG(db[2], <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67ac1d9c7c2d810cd735892947b39e7a451">MISCREG_DR2</a>);         \
        APPLY_DREG(db[3], <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67aed2fa86f63645dcfaa07937108e7aa8a">MISCREG_DR3</a>);         \
        APPLY_DREG(dr6, <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67a7dfee71b1a94f6cc70fce2ced630d7ca">MISCREG_DR6</a>);           \
        APPLY_DREG(dr7, <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67a60cd30a0da849fdd1c95fb213670222f">MISCREG_DR7</a>);           \
    } <span class="keywordflow">while</span>(0)
</pre></div>
</div>
</div>
<a class="anchor" id="ad8b16766eca6fa646fa2cc82fbd44cb7"></a><!-- doxytag: member="x86_cpu.cc::FOREACH_DTABLE" ref="ad8b16766eca6fa646fa2cc82fbd44cb7" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FOREACH_DTABLE</td>
          <td>(</td>
&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>値:</b><div class="fragment"><pre class="fragment"><span class="keywordflow">do</span> {                                                        \
        <a class="code" href="x86__cpu_8cc.html#aba8cb1b1518fbda6abb37867aa6b8af2">APPLY_DTABLE</a>(gdt, <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67ac07c56d506a9a542de1853943c55b597">MISCREG_TSG</a> - <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67a7442fc458dadcbe725c985bfd469875f">MISCREG_SEG_SEL_BASE</a>);  \
        <a class="code" href="x86__cpu_8cc.html#aba8cb1b1518fbda6abb37867aa6b8af2">APPLY_DTABLE</a>(idt, <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67a9dcd7397324a6838963f8d28eac4aa82">MISCREG_IDTR</a> - <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67a7442fc458dadcbe725c985bfd469875f">MISCREG_SEG_SEL_BASE</a>); \
    } <span class="keywordflow">while</span>(0)
</pre></div>
</div>
</div>
<a class="anchor" id="a1b70a9e03d3e57124b5ec691a3de8720"></a><!-- doxytag: member="x86_cpu.cc::FOREACH_IREG" ref="a1b70a9e03d3e57124b5ec691a3de8720" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FOREACH_IREG</td>
          <td>(</td>
&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>値:</b><div class="fragment"><pre class="fragment"><span class="keywordflow">do</span> {                                        \
        <a class="code" href="x86__cpu_8cc.html#acd661b64526a8ecbee8a9930ebd7b0be">APPLY_IREG</a>(rax, INTREG_RAX);            \
        <a class="code" href="x86__cpu_8cc.html#acd661b64526a8ecbee8a9930ebd7b0be">APPLY_IREG</a>(rbx, INTREG_RBX);            \
        <a class="code" href="x86__cpu_8cc.html#acd661b64526a8ecbee8a9930ebd7b0be">APPLY_IREG</a>(rcx, INTREG_RCX);            \
        <a class="code" href="x86__cpu_8cc.html#acd661b64526a8ecbee8a9930ebd7b0be">APPLY_IREG</a>(rdx, INTREG_RDX);            \
        <a class="code" href="x86__cpu_8cc.html#acd661b64526a8ecbee8a9930ebd7b0be">APPLY_IREG</a>(rsi, INTREG_RSI);            \
        <a class="code" href="x86__cpu_8cc.html#acd661b64526a8ecbee8a9930ebd7b0be">APPLY_IREG</a>(rdi, INTREG_RDI);            \
        <a class="code" href="x86__cpu_8cc.html#acd661b64526a8ecbee8a9930ebd7b0be">APPLY_IREG</a>(rsp, INTREG_RSP);            \
        <a class="code" href="x86__cpu_8cc.html#acd661b64526a8ecbee8a9930ebd7b0be">APPLY_IREG</a>(rbp, INTREG_RBP);            \
        <a class="code" href="x86__cpu_8cc.html#acd661b64526a8ecbee8a9930ebd7b0be">APPLY_IREG</a>(r8, <a class="code" href="namespaceArmISA.html#ae64680ba9fb526106829d6bf92fc791bac66ead91eaa60c51e8bcf7dc4f46b7e3">INTREG_R8</a>);              \
        <a class="code" href="x86__cpu_8cc.html#acd661b64526a8ecbee8a9930ebd7b0be">APPLY_IREG</a>(r9, <a class="code" href="namespaceArmISA.html#ae64680ba9fb526106829d6bf92fc791ba6b7438f963c0cddddde957e390088176">INTREG_R9</a>);              \
        <a class="code" href="x86__cpu_8cc.html#acd661b64526a8ecbee8a9930ebd7b0be">APPLY_IREG</a>(r10, <a class="code" href="namespaceArmISA.html#ae64680ba9fb526106829d6bf92fc791ba489c2c86a1504ec742e05de9ff5216af">INTREG_R10</a>);            \
        <a class="code" href="x86__cpu_8cc.html#acd661b64526a8ecbee8a9930ebd7b0be">APPLY_IREG</a>(r11, <a class="code" href="namespaceArmISA.html#ae64680ba9fb526106829d6bf92fc791ba5cc72dc30c42d05c70ebca70910f10c7">INTREG_R11</a>);            \
        <a class="code" href="x86__cpu_8cc.html#acd661b64526a8ecbee8a9930ebd7b0be">APPLY_IREG</a>(r12, <a class="code" href="namespaceArmISA.html#ae64680ba9fb526106829d6bf92fc791ba3f5e7c969c847f91714c4f59511ec1c2">INTREG_R12</a>);            \
        <a class="code" href="x86__cpu_8cc.html#acd661b64526a8ecbee8a9930ebd7b0be">APPLY_IREG</a>(r13, <a class="code" href="namespaceArmISA.html#ae64680ba9fb526106829d6bf92fc791ba9b643bc501a3698ba3902de5901bf8df">INTREG_R13</a>);            \
        <a class="code" href="x86__cpu_8cc.html#acd661b64526a8ecbee8a9930ebd7b0be">APPLY_IREG</a>(r14, <a class="code" href="namespaceArmISA.html#ae64680ba9fb526106829d6bf92fc791ba855a4065d4c4458df72f004fc6eeda4e">INTREG_R14</a>);            \
        <a class="code" href="x86__cpu_8cc.html#acd661b64526a8ecbee8a9930ebd7b0be">APPLY_IREG</a>(r15, <a class="code" href="namespaceArmISA.html#ae64680ba9fb526106829d6bf92fc791ba4fa3cdf8f8860fe4fc62ea7a6669ef85">INTREG_R15</a>);            \
    } <span class="keywordflow">while</span>(0)
</pre></div>
</div>
</div>
<a class="anchor" id="a9687b0de58e7126c4e4bfa5396205bfe"></a><!-- doxytag: member="x86_cpu.cc::FOREACH_SEGMENT" ref="a9687b0de58e7126c4e4bfa5396205bfe" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FOREACH_SEGMENT</td>
          <td>(</td>
&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>値:</b><div class="fragment"><pre class="fragment"><span class="keywordflow">do</span> {                                                        \
        <a class="code" href="x86__cpu_8cc.html#a63320c6620c2a08acd1dd9338417ec95">APPLY_SEGMENT</a>(cs, <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67acb7d2629eff9685c63de92064284d0f7">MISCREG_CS</a> - <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67a7442fc458dadcbe725c985bfd469875f">MISCREG_SEG_SEL_BASE</a>);   \
        <a class="code" href="x86__cpu_8cc.html#a63320c6620c2a08acd1dd9338417ec95">APPLY_SEGMENT</a>(<a class="code" href="namespaceMipsISA.html#af99c5bc05a6ca7d714ff7db9402c9cca">ds</a>, <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67ad224da287eca97d2937cefcff44618b3">MISCREG_DS</a> - <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67a7442fc458dadcbe725c985bfd469875f">MISCREG_SEG_SEL_BASE</a>);   \
        <a class="code" href="x86__cpu_8cc.html#a63320c6620c2a08acd1dd9338417ec95">APPLY_SEGMENT</a>(<a class="code" href="namespaceMipsISA.html#aae6a38e5d8f3ef8bdc92464d6232e3ad">es</a>, <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67a1933582308f6db8df9bece9696edd237">MISCREG_ES</a> - <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67a7442fc458dadcbe725c985bfd469875f">MISCREG_SEG_SEL_BASE</a>);   \
        <a class="code" href="x86__cpu_8cc.html#a63320c6620c2a08acd1dd9338417ec95">APPLY_SEGMENT</a>(fs, <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67af2f77faa0df9059606bfa3a6a2405a4c">MISCREG_FS</a> - <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67a7442fc458dadcbe725c985bfd469875f">MISCREG_SEG_SEL_BASE</a>);   \
        <a class="code" href="x86__cpu_8cc.html#a63320c6620c2a08acd1dd9338417ec95">APPLY_SEGMENT</a>(<a class="code" href="namespaceMipsISA.html#a2b7eea2f417bdbde7ce0f944dd01121e">gs</a>, <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67a12903e4dd2ac30fe09d276a3b9d2694f">MISCREG_GS</a> - <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67a7442fc458dadcbe725c985bfd469875f">MISCREG_SEG_SEL_BASE</a>);   \
        <a class="code" href="x86__cpu_8cc.html#a63320c6620c2a08acd1dd9338417ec95">APPLY_SEGMENT</a>(<a class="code" href="namespaceArmISA.html#a947232c56fc3fcfcef3ee43afafcc4a6">ss</a>, <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67ad55ce5d1ed7eef4b01b7d4c929637434">MISCREG_SS</a> - <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67a7442fc458dadcbe725c985bfd469875f">MISCREG_SEG_SEL_BASE</a>);   \
        <a class="code" href="x86__cpu_8cc.html#a63320c6620c2a08acd1dd9338417ec95">APPLY_SEGMENT</a>(tr, <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67a8dfb825b70214a0eb8725483884f9c2c">MISCREG_TR</a> - <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67a7442fc458dadcbe725c985bfd469875f">MISCREG_SEG_SEL_BASE</a>);   \
        <a class="code" href="x86__cpu_8cc.html#a63320c6620c2a08acd1dd9338417ec95">APPLY_SEGMENT</a>(ldt, <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67a1a1bffbabb8ec2d7995f8460c64258eb">MISCREG_TSL</a> - <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67a7442fc458dadcbe725c985bfd469875f">MISCREG_SEG_SEL_BASE</a>); \
    } <span class="keywordflow">while</span>(0)
</pre></div>
</div>
</div>
<a class="anchor" id="aa90701ca0a4e8e76a8fe2e712b1435a2"></a><!-- doxytag: member="x86_cpu.cc::FOREACH_SREG" ref="aa90701ca0a4e8e76a8fe2e712b1435a2" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FOREACH_SREG</td>
          <td>(</td>
&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>値:</b><div class="fragment"><pre class="fragment"><span class="keywordflow">do</span> {                                                \
        <a class="code" href="x86__cpu_8cc.html#a0388026cca60eb03b28dec28749123c7">APPLY_SREG</a>(cr0, <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67ada26b29c24bab13bc6d77060ba44fb33">MISCREG_CR0</a>);                   \
        <a class="code" href="x86__cpu_8cc.html#a0388026cca60eb03b28dec28749123c7">APPLY_SREG</a>(cr2, <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67aed4bea15f26a11939c4db2e18405c375">MISCREG_CR2</a>);                   \
        <a class="code" href="x86__cpu_8cc.html#a0388026cca60eb03b28dec28749123c7">APPLY_SREG</a>(cr3, <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67a99d06669b1c1a63a84a60330ab29d01d">MISCREG_CR3</a>);                   \
        <a class="code" href="x86__cpu_8cc.html#a0388026cca60eb03b28dec28749123c7">APPLY_SREG</a>(cr4, <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67a2e36ea3a504f795d0672d9448bfb9edc">MISCREG_CR4</a>);                   \
        <a class="code" href="x86__cpu_8cc.html#a0388026cca60eb03b28dec28749123c7">APPLY_SREG</a>(cr8, <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67a57090203dc471731ffa4ac498cc41078">MISCREG_CR8</a>);                   \
        <a class="code" href="x86__cpu_8cc.html#a0388026cca60eb03b28dec28749123c7">APPLY_SREG</a>(efer, <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67ac2bc7bba381e618f344c3047d968f5a7">MISCREG_EFER</a>);                 \
        <a class="code" href="x86__cpu_8cc.html#a0388026cca60eb03b28dec28749123c7">APPLY_SREG</a>(apic_base, <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67aa140419207c4efa0ada78f30ac3e5589">MISCREG_APIC_BASE</a>);       \
    } <span class="keywordflow">while</span>(0)
</pre></div>
</div>
</div>
<a class="anchor" id="aa249f80ee7382ea304af9e36af7e7b36"></a><!-- doxytag: member="x86_cpu.cc::IO_PCI_CONF_ADDR" ref="aa249f80ee7382ea304af9e36af7e7b36" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IO_PCI_CONF_ADDR&nbsp;&nbsp;&nbsp;0xCF8</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a5242fcbaf586dae287efe4163b97c019"></a><!-- doxytag: member="x86_cpu.cc::IO_PCI_CONF_DATA_BASE" ref="a5242fcbaf586dae287efe4163b97c019" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IO_PCI_CONF_DATA_BASE&nbsp;&nbsp;&nbsp;0xCFC</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a48a07da9eda1a7054027cbbd5701f7cc"></a><!-- doxytag: member="x86_cpu.cc::MSR_TSC" ref="a48a07da9eda1a7054027cbbd5701f7cc" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MSR_TSC&nbsp;&nbsp;&nbsp;0x10</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a4a17e8eb656d44e302e42eaad4ed7d55"></a><!-- doxytag: member="x86_cpu.cc::SEG_CS_TYPE_ACCESSED" ref="a4a17e8eb656d44e302e42eaad4ed7d55" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SEG_CS_TYPE_ACCESSED&nbsp;&nbsp;&nbsp;9</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a64546b78e0c66406e0c585251017e97d"></a><!-- doxytag: member="x86_cpu.cc::SEG_CS_TYPE_READ_ACCESSED" ref="a64546b78e0c66406e0c585251017e97d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SEG_CS_TYPE_READ_ACCESSED&nbsp;&nbsp;&nbsp;11</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ab981dfcf0b109de1740a5684d6eed5d8"></a><!-- doxytag: member="x86_cpu.cc::SEG_SYS_TYPE_TSS_AVAILABLE" ref="ab981dfcf0b109de1740a5684d6eed5d8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SEG_SYS_TYPE_TSS_AVAILABLE&nbsp;&nbsp;&nbsp;9</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a7dbae927888360923f7d7dbb529a3668"></a><!-- doxytag: member="x86_cpu.cc::SEG_SYS_TYPE_TSS_BUSY" ref="a7dbae927888360923f7d7dbb529a3668" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SEG_SYS_TYPE_TSS_BUSY&nbsp;&nbsp;&nbsp;11</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a4d4061bc93950e881300fc67c076eebd"></a><!-- doxytag: member="x86_cpu.cc::SEG_TYPE_BIT_ACCESSED" ref="a4d4061bc93950e881300fc67c076eebd" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SEG_TYPE_BIT_ACCESSED&nbsp;&nbsp;&nbsp;1</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/><h2>関数</h2>
<a class="anchor" id="a7174d4d5d8e57f423f727d67beaa463d"></a><!-- doxytag: member="x86_cpu.cc::checkSeg" ref="a7174d4d5d8e57f423f727d67beaa463d" args="(const char *name, const int idx, const struct kvm_segment &amp;seg, struct kvm_sregs sregs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void checkSeg </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>idx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct kvm_segment &amp;&nbsp;</td>
          <td class="paramname"> <em>seg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct kvm_sregs&nbsp;</td>
          <td class="paramname"> <em>sregs</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00382"></a>00382 {
<a name="l00383"></a>00383     <span class="comment">// Check the register base</span>
<a name="l00384"></a>00384     <span class="keywordflow">switch</span> (idx) {
<a name="l00385"></a>00385       <span class="keywordflow">case</span> <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67a1a1bffbabb8ec2d7995f8460c64258eb">MISCREG_TSL</a>:
<a name="l00386"></a>00386       <span class="keywordflow">case</span> <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67a8dfb825b70214a0eb8725483884f9c2c">MISCREG_TR</a>:
<a name="l00387"></a>00387       <span class="keywordflow">case</span> <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67af2f77faa0df9059606bfa3a6a2405a4c">MISCREG_FS</a>:
<a name="l00388"></a>00388       <span class="keywordflow">case</span> <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67a12903e4dd2ac30fe09d276a3b9d2694f">MISCREG_GS</a>:
<a name="l00389"></a>00389         <span class="keywordflow">if</span> (!<a class="code" href="x86__cpu_8cc.html#a897edaa2f5ac7a67d3897d65908e8522">isCanonicalAddress</a>(<a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.base))
<a name="l00390"></a>00390             <a class="code" href="base_2misc_8hh.html#a8224a361dddd2ad59b411982e5ea746f">warn</a>(<span class="stringliteral">&quot;Illegal %s base: 0x%x\n&quot;</span>, <a class="code" href="trace_8hh.html#a166fa10b86d8faa127fb7c78191e3e60">name</a>, <a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.base);
<a name="l00391"></a>00391         <span class="keywordflow">break</span>;
<a name="l00392"></a>00392 
<a name="l00393"></a>00393       <span class="keywordflow">case</span> <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67ad55ce5d1ed7eef4b01b7d4c929637434">MISCREG_SS</a>:
<a name="l00394"></a>00394       <span class="keywordflow">case</span> <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67ad224da287eca97d2937cefcff44618b3">MISCREG_DS</a>:
<a name="l00395"></a>00395       <span class="keywordflow">case</span> <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67a1933582308f6db8df9bece9696edd237">MISCREG_ES</a>:
<a name="l00396"></a>00396         <span class="keywordflow">if</span> (<a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.unusable)
<a name="l00397"></a>00397             <span class="keywordflow">break</span>;
<a name="l00398"></a>00398       <span class="keywordflow">case</span> <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67acb7d2629eff9685c63de92064284d0f7">MISCREG_CS</a>:
<a name="l00399"></a>00399         <span class="keywordflow">if</span> (<a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.base &amp; 0xffffffff00000000ULL)
<a name="l00400"></a>00400             <a class="code" href="base_2misc_8hh.html#a8224a361dddd2ad59b411982e5ea746f">warn</a>(<span class="stringliteral">&quot;Illegal %s base: 0x%x\n&quot;</span>, <a class="code" href="trace_8hh.html#a166fa10b86d8faa127fb7c78191e3e60">name</a>, <a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.base);
<a name="l00401"></a>00401         <span class="keywordflow">break</span>;
<a name="l00402"></a>00402     }
<a name="l00403"></a>00403 
<a name="l00404"></a>00404     <span class="comment">// Check the type</span>
<a name="l00405"></a>00405     <span class="keywordflow">switch</span> (idx) {
<a name="l00406"></a>00406       <span class="keywordflow">case</span> <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67acb7d2629eff9685c63de92064284d0f7">MISCREG_CS</a>:
<a name="l00407"></a>00407         <span class="keywordflow">switch</span> (<a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.type) {
<a name="l00408"></a>00408           <span class="keywordflow">case</span> 3:
<a name="l00409"></a>00409             <span class="keywordflow">if</span> (<a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.dpl != 0)
<a name="l00410"></a>00410                 <a class="code" href="base_2misc_8hh.html#a8224a361dddd2ad59b411982e5ea746f">warn</a>(<span class="stringliteral">&quot;CS type is 3 but dpl != 0.\n&quot;</span>);
<a name="l00411"></a>00411             <span class="keywordflow">break</span>;
<a name="l00412"></a>00412           <span class="keywordflow">case</span> 9:
<a name="l00413"></a>00413           <span class="keywordflow">case</span> 11:
<a name="l00414"></a>00414             <span class="keywordflow">if</span> (<a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.dpl != sregs.ss.dpl)
<a name="l00415"></a>00415                 <a class="code" href="base_2misc_8hh.html#a8224a361dddd2ad59b411982e5ea746f">warn</a>(<span class="stringliteral">&quot;CS type is %i but CS DPL != SS DPL\n&quot;</span>, <a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.type);
<a name="l00416"></a>00416             <span class="keywordflow">break</span>;
<a name="l00417"></a>00417           <span class="keywordflow">case</span> 13:
<a name="l00418"></a>00418           <span class="keywordflow">case</span> 15:
<a name="l00419"></a>00419             <span class="keywordflow">if</span> (<a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.dpl &gt; sregs.ss.dpl)
<a name="l00420"></a>00420                 <a class="code" href="base_2misc_8hh.html#a8224a361dddd2ad59b411982e5ea746f">warn</a>(<span class="stringliteral">&quot;CS type is %i but CS DPL &gt; SS DPL\n&quot;</span>, <a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.type);
<a name="l00421"></a>00421             <span class="keywordflow">break</span>;
<a name="l00422"></a>00422           <span class="keywordflow">default</span>:
<a name="l00423"></a>00423             <a class="code" href="base_2misc_8hh.html#a8224a361dddd2ad59b411982e5ea746f">warn</a>(<span class="stringliteral">&quot;Illegal CS type: %i\n&quot;</span>, <a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.type);
<a name="l00424"></a>00424             <span class="keywordflow">break</span>;
<a name="l00425"></a>00425         }
<a name="l00426"></a>00426         <span class="keywordflow">break</span>;
<a name="l00427"></a>00427 
<a name="l00428"></a>00428       <span class="keywordflow">case</span> <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67ad55ce5d1ed7eef4b01b7d4c929637434">MISCREG_SS</a>:
<a name="l00429"></a>00429         <span class="keywordflow">if</span> (<a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.unusable)
<a name="l00430"></a>00430             <span class="keywordflow">break</span>;
<a name="l00431"></a>00431         <span class="keywordflow">switch</span> (<a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.type) {
<a name="l00432"></a>00432           <span class="keywordflow">case</span> 3:
<a name="l00433"></a>00433             <span class="keywordflow">if</span> (sregs.cs.type == 3 &amp;&amp; <a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.dpl != 0)
<a name="l00434"></a>00434                 <a class="code" href="base_2misc_8hh.html#a8224a361dddd2ad59b411982e5ea746f">warn</a>(<span class="stringliteral">&quot;CS type is 3, but SS DPL is != 0.\n&quot;</span>);
<a name="l00435"></a>00435             <span class="comment">/* FALLTHROUGH */</span>
<a name="l00436"></a>00436           <span class="keywordflow">case</span> 7:
<a name="l00437"></a>00437             <span class="keywordflow">if</span> (!(sregs.cr0 &amp; 1) &amp;&amp; <a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.dpl != 0)
<a name="l00438"></a>00438                 <a class="code" href="base_2misc_8hh.html#a8224a361dddd2ad59b411982e5ea746f">warn</a>(<span class="stringliteral">&quot;SS DPL is %i, but CR0 PE is 0\n&quot;</span>, <a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.dpl);
<a name="l00439"></a>00439             <span class="keywordflow">break</span>;
<a name="l00440"></a>00440           <span class="keywordflow">default</span>:
<a name="l00441"></a>00441             <a class="code" href="base_2misc_8hh.html#a8224a361dddd2ad59b411982e5ea746f">warn</a>(<span class="stringliteral">&quot;Illegal SS type: %i\n&quot;</span>, <a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.type);
<a name="l00442"></a>00442             <span class="keywordflow">break</span>;
<a name="l00443"></a>00443         }
<a name="l00444"></a>00444         <span class="keywordflow">break</span>;
<a name="l00445"></a>00445 
<a name="l00446"></a>00446       <span class="keywordflow">case</span> <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67ad224da287eca97d2937cefcff44618b3">MISCREG_DS</a>:
<a name="l00447"></a>00447       <span class="keywordflow">case</span> <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67a1933582308f6db8df9bece9696edd237">MISCREG_ES</a>:
<a name="l00448"></a>00448       <span class="keywordflow">case</span> <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67af2f77faa0df9059606bfa3a6a2405a4c">MISCREG_FS</a>:
<a name="l00449"></a>00449       <span class="keywordflow">case</span> <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67a12903e4dd2ac30fe09d276a3b9d2694f">MISCREG_GS</a>:
<a name="l00450"></a>00450         <span class="keywordflow">if</span> (<a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.unusable)
<a name="l00451"></a>00451             <span class="keywordflow">break</span>;
<a name="l00452"></a>00452         <span class="keywordflow">if</span> (!(<a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.type &amp; 0x1) ||
<a name="l00453"></a>00453             ((<a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.type &amp; 0x8) &amp;&amp; !(<a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.type &amp; 0x2)))
<a name="l00454"></a>00454             <a class="code" href="base_2misc_8hh.html#a8224a361dddd2ad59b411982e5ea746f">warn</a>(<span class="stringliteral">&quot;%s has an illegal type field: %i\n&quot;</span>, <a class="code" href="trace_8hh.html#a166fa10b86d8faa127fb7c78191e3e60">name</a>, <a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.type);
<a name="l00455"></a>00455         <span class="keywordflow">break</span>;
<a name="l00456"></a>00456 
<a name="l00457"></a>00457       <span class="keywordflow">case</span> <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67a8dfb825b70214a0eb8725483884f9c2c">MISCREG_TR</a>:
<a name="l00458"></a>00458         <span class="comment">// TODO: We should check the CPU mode</span>
<a name="l00459"></a>00459         <span class="keywordflow">if</span> (<a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.type != 3 &amp;&amp; <a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.type != 11)
<a name="l00460"></a>00460             <a class="code" href="base_2misc_8hh.html#a8224a361dddd2ad59b411982e5ea746f">warn</a>(<span class="stringliteral">&quot;%s: Illegal segment type (%i)\n&quot;</span>, <a class="code" href="trace_8hh.html#a166fa10b86d8faa127fb7c78191e3e60">name</a>, <a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.type);
<a name="l00461"></a>00461         <span class="keywordflow">break</span>;
<a name="l00462"></a>00462 
<a name="l00463"></a>00463       <span class="keywordflow">case</span> <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67a1a1bffbabb8ec2d7995f8460c64258eb">MISCREG_TSL</a>:
<a name="l00464"></a>00464         <span class="keywordflow">if</span> (<a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.unusable)
<a name="l00465"></a>00465             <span class="keywordflow">break</span>;
<a name="l00466"></a>00466         <span class="keywordflow">if</span> (<a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.type != 2)
<a name="l00467"></a>00467             <a class="code" href="base_2misc_8hh.html#a8224a361dddd2ad59b411982e5ea746f">warn</a>(<span class="stringliteral">&quot;%s: Illegal segment type (%i)\n&quot;</span>, <a class="code" href="trace_8hh.html#a166fa10b86d8faa127fb7c78191e3e60">name</a>, <a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.type);
<a name="l00468"></a>00468         <span class="keywordflow">break</span>;
<a name="l00469"></a>00469     }
<a name="l00470"></a>00470 
<a name="l00471"></a>00471     <span class="keywordflow">switch</span> (idx) {
<a name="l00472"></a>00472       <span class="keywordflow">case</span> <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67ad55ce5d1ed7eef4b01b7d4c929637434">MISCREG_SS</a>:
<a name="l00473"></a>00473       <span class="keywordflow">case</span> <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67ad224da287eca97d2937cefcff44618b3">MISCREG_DS</a>:
<a name="l00474"></a>00474       <span class="keywordflow">case</span> <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67a1933582308f6db8df9bece9696edd237">MISCREG_ES</a>:
<a name="l00475"></a>00475       <span class="keywordflow">case</span> <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67af2f77faa0df9059606bfa3a6a2405a4c">MISCREG_FS</a>:
<a name="l00476"></a>00476       <span class="keywordflow">case</span> <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67a12903e4dd2ac30fe09d276a3b9d2694f">MISCREG_GS</a>:
<a name="l00477"></a>00477         <span class="keywordflow">if</span> (<a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.unusable)
<a name="l00478"></a>00478             <span class="keywordflow">break</span>;
<a name="l00479"></a>00479       <span class="keywordflow">case</span> <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67acb7d2629eff9685c63de92064284d0f7">MISCREG_CS</a>:
<a name="l00480"></a>00480         <span class="keywordflow">if</span> (!<a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.s)
<a name="l00481"></a>00481             <a class="code" href="base_2misc_8hh.html#a8224a361dddd2ad59b411982e5ea746f">warn</a>(<span class="stringliteral">&quot;%s: S flag not set\n&quot;</span>, <a class="code" href="trace_8hh.html#a166fa10b86d8faa127fb7c78191e3e60">name</a>);
<a name="l00482"></a>00482         <span class="keywordflow">break</span>;
<a name="l00483"></a>00483 
<a name="l00484"></a>00484       <span class="keywordflow">case</span> <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67a1a1bffbabb8ec2d7995f8460c64258eb">MISCREG_TSL</a>:
<a name="l00485"></a>00485         <span class="keywordflow">if</span> (<a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.unusable)
<a name="l00486"></a>00486             <span class="keywordflow">break</span>;
<a name="l00487"></a>00487       <span class="keywordflow">case</span> <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67a8dfb825b70214a0eb8725483884f9c2c">MISCREG_TR</a>:
<a name="l00488"></a>00488         <span class="keywordflow">if</span> (<a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.s)
<a name="l00489"></a>00489             <a class="code" href="base_2misc_8hh.html#a8224a361dddd2ad59b411982e5ea746f">warn</a>(<span class="stringliteral">&quot;%s: S flag is set\n&quot;</span>, <a class="code" href="trace_8hh.html#a166fa10b86d8faa127fb7c78191e3e60">name</a>);
<a name="l00490"></a>00490         <span class="keywordflow">break</span>;
<a name="l00491"></a>00491     }
<a name="l00492"></a>00492 
<a name="l00493"></a>00493     <span class="keywordflow">switch</span> (idx) {
<a name="l00494"></a>00494       <span class="keywordflow">case</span> <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67ad55ce5d1ed7eef4b01b7d4c929637434">MISCREG_SS</a>:
<a name="l00495"></a>00495       <span class="keywordflow">case</span> <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67ad224da287eca97d2937cefcff44618b3">MISCREG_DS</a>:
<a name="l00496"></a>00496       <span class="keywordflow">case</span> <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67a1933582308f6db8df9bece9696edd237">MISCREG_ES</a>:
<a name="l00497"></a>00497       <span class="keywordflow">case</span> <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67af2f77faa0df9059606bfa3a6a2405a4c">MISCREG_FS</a>:
<a name="l00498"></a>00498       <span class="keywordflow">case</span> <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67a12903e4dd2ac30fe09d276a3b9d2694f">MISCREG_GS</a>:
<a name="l00499"></a>00499       <span class="keywordflow">case</span> <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67a1a1bffbabb8ec2d7995f8460c64258eb">MISCREG_TSL</a>:
<a name="l00500"></a>00500         <span class="keywordflow">if</span> (<a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.unusable)
<a name="l00501"></a>00501             <span class="keywordflow">break</span>;
<a name="l00502"></a>00502       <span class="keywordflow">case</span> <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67a8dfb825b70214a0eb8725483884f9c2c">MISCREG_TR</a>:
<a name="l00503"></a>00503       <span class="keywordflow">case</span> <a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67acb7d2629eff9685c63de92064284d0f7">MISCREG_CS</a>:
<a name="l00504"></a>00504         <span class="keywordflow">if</span> (!<a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.present)
<a name="l00505"></a>00505             <a class="code" href="base_2misc_8hh.html#a8224a361dddd2ad59b411982e5ea746f">warn</a>(<span class="stringliteral">&quot;%s: P flag not set\n&quot;</span>, <a class="code" href="trace_8hh.html#a166fa10b86d8faa127fb7c78191e3e60">name</a>);
<a name="l00506"></a>00506 
<a name="l00507"></a>00507         <span class="keywordflow">if</span> (((<a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.limit &amp; 0xFFF) == 0 &amp;&amp; <a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.g) ||
<a name="l00508"></a>00508             ((<a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.limit &amp; 0xFFF00000) != 0 &amp;&amp; !<a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.g)) {
<a name="l00509"></a>00509             <a class="code" href="base_2misc_8hh.html#a8224a361dddd2ad59b411982e5ea746f">warn</a>(<span class="stringliteral">&quot;%s limit (0x%x) and g (%i) combination is illegal.\n&quot;</span>,
<a name="l00510"></a>00510                  <a class="code" href="trace_8hh.html#a166fa10b86d8faa127fb7c78191e3e60">name</a>, <a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.limit, <a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.g);
<a name="l00511"></a>00511         }
<a name="l00512"></a>00512         <span class="keywordflow">break</span>;
<a name="l00513"></a>00513     }
<a name="l00514"></a>00514 
<a name="l00515"></a>00515     <span class="comment">// TODO: Check CS DB</span>
<a name="l00516"></a>00516 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a46f5ba7be6890a81b497c1eeaf8c2029"></a><!-- doxytag: member="x86_cpu.cc::dumpFpuCommon" ref="a46f5ba7be6890a81b497c1eeaf8c2029" args="(const T &amp;fpu)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void dumpFpuCommon </td>
          <td>(</td>
          <td class="paramtype">const T &amp;&nbsp;</td>
          <td class="paramname"> <em>fpu</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00260"></a>00260 {
<a name="l00261"></a>00261     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> top((fpu.fsw &gt;&gt; 11) &amp; 0x7);
<a name="l00262"></a>00262     <a class="code" href="base_2misc_8hh.html#ae7d790080fa18103d7582effff570b9e">inform</a>(<span class="stringliteral">&quot;\tfcw: 0x%x\n&quot;</span>, fpu.fcw);
<a name="l00263"></a>00263 
<a name="l00264"></a>00264     <a class="code" href="base_2misc_8hh.html#ae7d790080fa18103d7582effff570b9e">inform</a>(<span class="stringliteral">&quot;\tfsw: 0x%x (top: %i, &quot;</span>
<a name="l00265"></a>00265            <span class="stringliteral">&quot;conditions: %s%s%s%s, exceptions: %s%s%s%s%s%s %s%s%s)\n&quot;</span>,
<a name="l00266"></a>00266            fpu.fsw, top,
<a name="l00267"></a>00267 
<a name="l00268"></a>00268            (fpu.fsw &amp; <a class="code" href="namespaceX86ISA.html#a56ab3d4ef473ec7adc4ddeac60582b25ab25df8150146507436ea3de82b14b2c2">CC0Bit</a>) ? <span class="stringliteral">&quot;C0&quot;</span> : <span class="stringliteral">&quot;&quot;</span>,
<a name="l00269"></a>00269            (fpu.fsw &amp; <a class="code" href="namespaceX86ISA.html#a56ab3d4ef473ec7adc4ddeac60582b25a5b2388f8cda2c2655e35384da4b93c32">CC1Bit</a>) ? <span class="stringliteral">&quot;C1&quot;</span> : <span class="stringliteral">&quot;&quot;</span>,
<a name="l00270"></a>00270            (fpu.fsw &amp; <a class="code" href="namespaceX86ISA.html#a56ab3d4ef473ec7adc4ddeac60582b25af6994130984a4272ffde3f8f31a20d16">CC2Bit</a>) ? <span class="stringliteral">&quot;C2&quot;</span> : <span class="stringliteral">&quot;&quot;</span>,
<a name="l00271"></a>00271            (fpu.fsw &amp; <a class="code" href="namespaceX86ISA.html#a56ab3d4ef473ec7adc4ddeac60582b25ad74f69c75aed13485540849f7b86efb8">CC3Bit</a>) ? <span class="stringliteral">&quot;C3&quot;</span> : <span class="stringliteral">&quot;&quot;</span>,
<a name="l00272"></a>00272 
<a name="l00273"></a>00273            (fpu.fsw &amp; <a class="code" href="namespaceX86ISA.html#a56ab3d4ef473ec7adc4ddeac60582b25a119d3962ccfe00f78727003a7c1ed4bf">IEBit</a>) ? <span class="stringliteral">&quot;I&quot;</span> : <span class="stringliteral">&quot;&quot;</span>,
<a name="l00274"></a>00274            (fpu.fsw &amp; <a class="code" href="namespaceX86ISA.html#a56ab3d4ef473ec7adc4ddeac60582b25a8255af4cbacecb05af1d66ab1fcebb31">DEBit</a>) ? <span class="stringliteral">&quot;D&quot;</span> : <span class="stringliteral">&quot;&quot;</span>,
<a name="l00275"></a>00275            (fpu.fsw &amp; <a class="code" href="namespaceX86ISA.html#a56ab3d4ef473ec7adc4ddeac60582b25a842013f850da4678aa5982306db0bde1">ZEBit</a>) ? <span class="stringliteral">&quot;Z&quot;</span> : <span class="stringliteral">&quot;&quot;</span>,
<a name="l00276"></a>00276            (fpu.fsw &amp; <a class="code" href="namespaceX86ISA.html#a56ab3d4ef473ec7adc4ddeac60582b25ac85c84074f4cf51b9dd1ebdd34f25a63">OEBit</a>) ? <span class="stringliteral">&quot;O&quot;</span> : <span class="stringliteral">&quot;&quot;</span>,
<a name="l00277"></a>00277            (fpu.fsw &amp; <a class="code" href="namespaceX86ISA.html#a56ab3d4ef473ec7adc4ddeac60582b25a46546565841875c3a57a0ba61fca8957">UEBit</a>) ? <span class="stringliteral">&quot;U&quot;</span> : <span class="stringliteral">&quot;&quot;</span>,
<a name="l00278"></a>00278            (fpu.fsw &amp; <a class="code" href="namespaceX86ISA.html#a56ab3d4ef473ec7adc4ddeac60582b25af9baebd25f57192bc0d77906466bb100">PEBit</a>) ? <span class="stringliteral">&quot;P&quot;</span> : <span class="stringliteral">&quot;&quot;</span>,
<a name="l00279"></a>00279 
<a name="l00280"></a>00280            (fpu.fsw &amp; <a class="code" href="namespaceX86ISA.html#a56ab3d4ef473ec7adc4ddeac60582b25ac2d1705a732b243835d1187299b5681c">StackFaultBit</a>) ? <span class="stringliteral">&quot;SF &quot;</span> : <span class="stringliteral">&quot;&quot;</span>,
<a name="l00281"></a>00281            (fpu.fsw &amp; <a class="code" href="namespaceX86ISA.html#a56ab3d4ef473ec7adc4ddeac60582b25a9a42c69561648f78d25c754728ee1b35">ErrSummaryBit</a>) ? <span class="stringliteral">&quot;ES &quot;</span> : <span class="stringliteral">&quot;&quot;</span>,
<a name="l00282"></a>00282            (fpu.fsw &amp; <a class="code" href="namespaceX86ISA.html#a56ab3d4ef473ec7adc4ddeac60582b25a6134a1cdf75ea277941c7fd62961f7e2">BusyBit</a>) ? <span class="stringliteral">&quot;BUSY &quot;</span> : <span class="stringliteral">&quot;&quot;</span>
<a name="l00283"></a>00283         );
<a name="l00284"></a>00284     <a class="code" href="base_2misc_8hh.html#ae7d790080fa18103d7582effff570b9e">inform</a>(<span class="stringliteral">&quot;\tftwx: 0x%x\n&quot;</span>, fpu.ftwx);
<a name="l00285"></a>00285     <a class="code" href="base_2misc_8hh.html#ae7d790080fa18103d7582effff570b9e">inform</a>(<span class="stringliteral">&quot;\tlast_opcode: 0x%x\n&quot;</span>, fpu.last_opcode);
<a name="l00286"></a>00286     <a class="code" href="x86__cpu_8cc.html#adf41008a4447459acb9f919d51a2805b">dumpFpuSpec</a>(fpu);
<a name="l00287"></a>00287     <a class="code" href="base_2misc_8hh.html#ae7d790080fa18103d7582effff570b9e">inform</a>(<span class="stringliteral">&quot;\tmxcsr: 0x%x\n&quot;</span>, fpu.mxcsr);
<a name="l00288"></a>00288     <a class="code" href="base_2misc_8hh.html#ae7d790080fa18103d7582effff570b9e">inform</a>(<span class="stringliteral">&quot;\tFP Stack:\n&quot;</span>);
<a name="l00289"></a>00289     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> = 0; <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> &lt; 8; ++<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>) {
<a name="l00290"></a>00290         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> reg_idx((<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> + top) &amp; 0x7);
<a name="l00291"></a>00291         <span class="keyword">const</span> <span class="keywordtype">bool</span> empty(!((fpu.ftwx &gt;&gt; reg_idx) &amp; 0x1));
<a name="l00292"></a>00292         <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespacegenini.html#a7e5f482a3a8a4f98bd1a9c124485f572">value</a>(<a class="code" href="namespaceX86ISA.html#a97c5f8f8ac0ded173ac00bfae8e92e0e">X86ISA::loadFloat80</a>(fpu.fpr[<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>]));
<a name="l00293"></a>00293         <span class="keywordtype">char</span> hex[33];
<a name="l00294"></a>00294         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespaceArmISA.html#adda8322536e2853111a71e4e2f911762">j</a> = 0; <a class="code" href="namespaceArmISA.html#adda8322536e2853111a71e4e2f911762">j</a> &lt; 10; ++<a class="code" href="namespaceArmISA.html#adda8322536e2853111a71e4e2f911762">j</a>)
<a name="l00295"></a>00295             snprintf(&amp;hex[<a class="code" href="namespaceArmISA.html#adda8322536e2853111a71e4e2f911762">j</a>*2], 3, <span class="stringliteral">&quot;%.2x&quot;</span>, fpu.fpr[<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>][j]);
<a name="l00296"></a>00296         <a class="code" href="base_2misc_8hh.html#ae7d790080fa18103d7582effff570b9e">inform</a>(<span class="stringliteral">&quot;\t\tST%i/%i: 0x%s (%f)%s\n&quot;</span>, <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>, reg_idx,
<a name="l00297"></a>00297                hex, <a class="code" href="namespacegenini.html#a7e5f482a3a8a4f98bd1a9c124485f572">value</a>, empty ? <span class="stringliteral">&quot; (e)&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
<a name="l00298"></a>00298     }
<a name="l00299"></a>00299     <a class="code" href="base_2misc_8hh.html#ae7d790080fa18103d7582effff570b9e">inform</a>(<span class="stringliteral">&quot;\tXMM registers:\n&quot;</span>);
<a name="l00300"></a>00300     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> = 0; <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> &lt; 16; ++<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>) {
<a name="l00301"></a>00301         <span class="keywordtype">char</span> hex[33];
<a name="l00302"></a>00302         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespaceArmISA.html#adda8322536e2853111a71e4e2f911762">j</a> = 0; <a class="code" href="namespaceArmISA.html#adda8322536e2853111a71e4e2f911762">j</a> &lt; 16; ++<a class="code" href="namespaceArmISA.html#adda8322536e2853111a71e4e2f911762">j</a>)
<a name="l00303"></a>00303             snprintf(&amp;hex[<a class="code" href="namespaceArmISA.html#adda8322536e2853111a71e4e2f911762">j</a>*2], 3, <span class="stringliteral">&quot;%.2x&quot;</span>, fpu.xmm[<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>][j]);
<a name="l00304"></a>00304         <a class="code" href="base_2misc_8hh.html#ae7d790080fa18103d7582effff570b9e">inform</a>(<span class="stringliteral">&quot;\t\t%i: 0x%s\n&quot;</span>, <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>, hex);
<a name="l00305"></a>00305     }
<a name="l00306"></a>00306 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a66c7b9de0f3bb8c466dd0b8d4fb3567b"></a><!-- doxytag: member="x86_cpu.cc::dumpFpuSpec" ref="a66c7b9de0f3bb8c466dd0b8d4fb3567b" args="(const struct kvm_fpu &amp;fpu)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void dumpFpuSpec </td>
          <td>(</td>
          <td class="paramtype">const struct kvm_fpu &amp;&nbsp;</td>
          <td class="paramname"> <em>fpu</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00252"></a>00252 {
<a name="l00253"></a>00253     <a class="code" href="base_2misc_8hh.html#ae7d790080fa18103d7582effff570b9e">inform</a>(<span class="stringliteral">&quot;\tlast_ip: 0x%x\n&quot;</span>, fpu.last_ip);
<a name="l00254"></a>00254     <a class="code" href="base_2misc_8hh.html#ae7d790080fa18103d7582effff570b9e">inform</a>(<span class="stringliteral">&quot;\tlast_dp: 0x%x\n&quot;</span>, fpu.last_dp);
<a name="l00255"></a>00255 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="adf41008a4447459acb9f919d51a2805b"></a><!-- doxytag: member="x86_cpu.cc::dumpFpuSpec" ref="adf41008a4447459acb9f919d51a2805b" args="(const struct FXSave &amp;xs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void dumpFpuSpec </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structFXSave.html">FXSave</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>xs</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00244"></a>00244 {
<a name="l00245"></a>00245     <a class="code" href="base_2misc_8hh.html#ae7d790080fa18103d7582effff570b9e">inform</a>(<span class="stringliteral">&quot;\tlast_ip: 0x%x\n&quot;</span>, xs.<a class="code" href="structFXSave.html#a5b1d40e273056ed663af234fa7cdc543">ctrl64</a>.fpu_ip);
<a name="l00246"></a>00246     <a class="code" href="base_2misc_8hh.html#ae7d790080fa18103d7582effff570b9e">inform</a>(<span class="stringliteral">&quot;\tlast_dp: 0x%x\n&quot;</span>, xs.<a class="code" href="structFXSave.html#a5b1d40e273056ed663af234fa7cdc543">ctrl64</a>.fpu_dp);
<a name="l00247"></a>00247     <a class="code" href="base_2misc_8hh.html#ae7d790080fa18103d7582effff570b9e">inform</a>(<span class="stringliteral">&quot;\tmxcsr_mask: 0x%x\n&quot;</span>, xs.<a class="code" href="structFXSave.html#ad1c05b4421c5de1edc602432cb3aec36">mxcsr_mask</a>);
<a name="l00248"></a>00248 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="afbf85fdc9a68b6997ea5f91a0c17ec10"></a><!-- doxytag: member="x86_cpu.cc::dumpKvm" ref="afbf85fdc9a68b6997ea5f91a0c17ec10" args="(const struct kvm_vcpu_events &amp;events)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void dumpKvm </td>
          <td>(</td>
          <td class="paramtype">const struct kvm_vcpu_events &amp;&nbsp;</td>
          <td class="paramname"> <em>events</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00349"></a>00349 {
<a name="l00350"></a>00350     <a class="code" href="base_2misc_8hh.html#ae7d790080fa18103d7582effff570b9e">inform</a>(<span class="stringliteral">&quot;vCPU events:\n&quot;</span>);
<a name="l00351"></a>00351 
<a name="l00352"></a>00352     <a class="code" href="base_2misc_8hh.html#ae7d790080fa18103d7582effff570b9e">inform</a>(<span class="stringliteral">&quot;\tException: [inj: %i, nr: %i, has_ec: %i, ec: %i]\n&quot;</span>,
<a name="l00353"></a>00353            events.exception.injected, events.exception.nr,
<a name="l00354"></a>00354            events.exception.has_error_code, events.exception.error_code);
<a name="l00355"></a>00355 
<a name="l00356"></a>00356     <a class="code" href="base_2misc_8hh.html#ae7d790080fa18103d7582effff570b9e">inform</a>(<span class="stringliteral">&quot;\tInterrupt: [inj: %i, nr: %i, soft: %i]\n&quot;</span>,
<a name="l00357"></a>00357            events.interrupt.injected, events.interrupt.nr,
<a name="l00358"></a>00358            events.interrupt.soft);
<a name="l00359"></a>00359 
<a name="l00360"></a>00360     <a class="code" href="base_2misc_8hh.html#ae7d790080fa18103d7582effff570b9e">inform</a>(<span class="stringliteral">&quot;\tNMI: [inj: %i, pending: %i, masked: %i]\n&quot;</span>,
<a name="l00361"></a>00361            events.nmi.injected, events.nmi.pending,
<a name="l00362"></a>00362            events.nmi.masked);
<a name="l00363"></a>00363 
<a name="l00364"></a>00364     <a class="code" href="base_2misc_8hh.html#ae7d790080fa18103d7582effff570b9e">inform</a>(<span class="stringliteral">&quot;\tSIPI vector: 0x%x\n&quot;</span>, events.sipi_vector);
<a name="l00365"></a>00365     <a class="code" href="base_2misc_8hh.html#ae7d790080fa18103d7582effff570b9e">inform</a>(<span class="stringliteral">&quot;\tFlags: 0x%x\n&quot;</span>, events.flags);
<a name="l00366"></a>00366 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af915161a847a8b42b652e6196c97d13f"></a><!-- doxytag: member="x86_cpu.cc::dumpKvm" ref="af915161a847a8b42b652e6196c97d13f" args="(const struct kvm_xcrs &amp;regs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void dumpKvm </td>
          <td>(</td>
          <td class="paramtype">const struct kvm_xcrs &amp;&nbsp;</td>
          <td class="paramname"> <em>regs</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00336"></a>00336 {
<a name="l00337"></a>00337     <a class="code" href="base_2misc_8hh.html#ae7d790080fa18103d7582effff570b9e">inform</a>(<span class="stringliteral">&quot;KVM XCR registers:\n&quot;</span>);
<a name="l00338"></a>00338 
<a name="l00339"></a>00339     <a class="code" href="base_2misc_8hh.html#ae7d790080fa18103d7582effff570b9e">inform</a>(<span class="stringliteral">&quot;\tFlags: 0x%x\n&quot;</span>, regs.flags);
<a name="l00340"></a>00340     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> = 0; <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> &lt; regs.nr_xcrs; ++<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>) {
<a name="l00341"></a>00341         <a class="code" href="base_2misc_8hh.html#ae7d790080fa18103d7582effff570b9e">inform</a>(<span class="stringliteral">&quot;\tXCR[0x%x]: 0x%x\n&quot;</span>,
<a name="l00342"></a>00342                regs.xcrs[<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>].xcr,
<a name="l00343"></a>00343                regs.xcrs[<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>].value);
<a name="l00344"></a>00344     }
<a name="l00345"></a>00345 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae1337a353229bd0870744e1043623ff4"></a><!-- doxytag: member="x86_cpu.cc::dumpKvm" ref="ae1337a353229bd0870744e1043623ff4" args="(const struct kvm_msrs &amp;msrs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void dumpKvm </td>
          <td>(</td>
          <td class="paramtype">const struct kvm_msrs &amp;&nbsp;</td>
          <td class="paramname"> <em>msrs</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00324"></a>00324 {
<a name="l00325"></a>00325     <a class="code" href="base_2misc_8hh.html#ae7d790080fa18103d7582effff570b9e">inform</a>(<span class="stringliteral">&quot;MSRs:\n&quot;</span>);
<a name="l00326"></a>00326 
<a name="l00327"></a>00327     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> = 0; <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> &lt; msrs.nmsrs; ++<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>) {
<a name="l00328"></a>00328         <span class="keyword">const</span> <span class="keyword">struct </span>kvm_msr_entry &amp;<a class="code" href="namespaceArmISA.html#a55520507919005a961edbe8b177f3bba">e</a>(msrs.entries[<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>]);
<a name="l00329"></a>00329 
<a name="l00330"></a>00330         <a class="code" href="base_2misc_8hh.html#ae7d790080fa18103d7582effff570b9e">inform</a>(<span class="stringliteral">&quot;\t0x%x: 0x%x\n&quot;</span>, <a class="code" href="namespaceArmISA.html#a55520507919005a961edbe8b177f3bba">e</a>.index, <a class="code" href="namespaceArmISA.html#a55520507919005a961edbe8b177f3bba">e</a>.data);
<a name="l00331"></a>00331     }
<a name="l00332"></a>00332 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a865009cd8e167f82ccbd8cdca9eb143c"></a><!-- doxytag: member="x86_cpu.cc::dumpKvm" ref="a865009cd8e167f82ccbd8cdca9eb143c" args="(const struct kvm_xsave &amp;xsave)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void dumpKvm </td>
          <td>(</td>
          <td class="paramtype">const struct kvm_xsave &amp;&nbsp;</td>
          <td class="paramname"> <em>xsave</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00317"></a>00317 {
<a name="l00318"></a>00318     <a class="code" href="base_2misc_8hh.html#ae7d790080fa18103d7582effff570b9e">inform</a>(<span class="stringliteral">&quot;FPU registers (XSave):\n&quot;</span>);
<a name="l00319"></a>00319     <a class="code" href="x86__cpu_8cc.html#a46f5ba7be6890a81b497c1eeaf8c2029">dumpFpuCommon</a>(*(<a class="code" href="structFXSave.html">FXSave</a> *)xsave.region);
<a name="l00320"></a>00320 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a97136c2e8a5ac2deba6e38795d3b5053"></a><!-- doxytag: member="x86_cpu.cc::dumpKvm" ref="a97136c2e8a5ac2deba6e38795d3b5053" args="(const struct kvm_fpu &amp;fpu)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void dumpKvm </td>
          <td>(</td>
          <td class="paramtype">const struct kvm_fpu &amp;&nbsp;</td>
          <td class="paramname"> <em>fpu</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00310"></a>00310 {
<a name="l00311"></a>00311     <a class="code" href="base_2misc_8hh.html#ae7d790080fa18103d7582effff570b9e">inform</a>(<span class="stringliteral">&quot;FPU registers:\n&quot;</span>);
<a name="l00312"></a>00312     <a class="code" href="x86__cpu_8cc.html#a46f5ba7be6890a81b497c1eeaf8c2029">dumpFpuCommon</a>(fpu);
<a name="l00313"></a>00313 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a36910f19c3862f43565434410f6d211b"></a><!-- doxytag: member="x86_cpu.cc::dumpKvm" ref="a36910f19c3862f43565434410f6d211b" args="(const struct kvm_sregs &amp;sregs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void dumpKvm </td>
          <td>(</td>
          <td class="paramtype">const struct kvm_sregs &amp;&nbsp;</td>
          <td class="paramname"> <em>sregs</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00203"></a>00203 {
<a name="l00204"></a>00204 <span class="preprocessor">#define APPLY_SREG(kreg, mreg)                          \</span>
<a name="l00205"></a>00205 <span class="preprocessor">    inform(&quot;\t&quot; # kreg &quot;: 0x%llx\n&quot;, sregs.kreg);</span>
<a name="l00206"></a>00206 <span class="preprocessor"></span><span class="preprocessor">#define APPLY_SEGMENT(kreg, idx)                \</span>
<a name="l00207"></a>00207 <span class="preprocessor">    dumpKvm(# kreg, sregs.kreg);</span>
<a name="l00208"></a>00208 <span class="preprocessor"></span><span class="preprocessor">#define APPLY_DTABLE(kreg, idx)                 \</span>
<a name="l00209"></a>00209 <span class="preprocessor">    dumpKvm(# kreg, sregs.kreg);</span>
<a name="l00210"></a>00210 <span class="preprocessor"></span>
<a name="l00211"></a>00211     <a class="code" href="base_2misc_8hh.html#ae7d790080fa18103d7582effff570b9e">inform</a>(<span class="stringliteral">&quot;Special registers:\n&quot;</span>);
<a name="l00212"></a>00212     <a class="code" href="x86__cpu_8cc.html#a9687b0de58e7126c4e4bfa5396205bfe">FOREACH_SEGMENT</a>();
<a name="l00213"></a>00213     <a class="code" href="x86__cpu_8cc.html#aa90701ca0a4e8e76a8fe2e712b1435a2">FOREACH_SREG</a>();
<a name="l00214"></a>00214     <a class="code" href="x86__cpu_8cc.html#ad8b16766eca6fa646fa2cc82fbd44cb7">FOREACH_DTABLE</a>();
<a name="l00215"></a>00215 
<a name="l00216"></a>00216     <a class="code" href="base_2misc_8hh.html#ae7d790080fa18103d7582effff570b9e">inform</a>(<span class="stringliteral">&quot;Interrupt Bitmap:&quot;</span>);
<a name="l00217"></a>00217     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> = 0; <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> &lt; KVM_NR_INTERRUPTS; <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> += 64)
<a name="l00218"></a>00218         <a class="code" href="base_2misc_8hh.html#ae7d790080fa18103d7582effff570b9e">inform</a>(<span class="stringliteral">&quot;  0x%.8x&quot;</span>, sregs.interrupt_bitmap[<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> / 64]);
<a name="l00219"></a>00219 
<a name="l00220"></a>00220 <span class="preprocessor">#undef APPLY_SREG</span>
<a name="l00221"></a>00221 <span class="preprocessor"></span><span class="preprocessor">#undef APPLY_SEGMENT</span>
<a name="l00222"></a>00222 <span class="preprocessor"></span><span class="preprocessor">#undef APPLY_DTABLE</span>
<a name="l00223"></a>00223 <span class="preprocessor"></span>}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a69fa7ec6c7399ac8aa29df5e7bfa9efc"></a><!-- doxytag: member="x86_cpu.cc::dumpKvm" ref="a69fa7ec6c7399ac8aa29df5e7bfa9efc" args="(const char *reg_name, const struct kvm_dtable &amp;dtable)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void dumpKvm </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>reg_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct kvm_dtable &amp;&nbsp;</td>
          <td class="paramname"> <em>dtable</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00196"></a>00196 {
<a name="l00197"></a>00197     <a class="code" href="base_2misc_8hh.html#ae7d790080fa18103d7582effff570b9e">inform</a>(<span class="stringliteral">&quot;\t%s: @0x%llx+%x\n&quot;</span>,
<a name="l00198"></a>00198            reg_name, dtable.base, dtable.limit);
<a name="l00199"></a>00199 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a74ec3b8549e1f3e742423b0ec38bb9de"></a><!-- doxytag: member="x86_cpu.cc::dumpKvm" ref="a74ec3b8549e1f3e742423b0ec38bb9de" args="(const char *reg_name, const struct kvm_segment &amp;seg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void dumpKvm </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>reg_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct kvm_segment &amp;&nbsp;</td>
          <td class="paramname"> <em>seg</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00186"></a>00186 {
<a name="l00187"></a>00187     <a class="code" href="base_2misc_8hh.html#ae7d790080fa18103d7582effff570b9e">inform</a>(<span class="stringliteral">&quot;\t%s: @0x%llx+%x [sel: 0x%x, type: 0x%x]\n&quot;</span>
<a name="l00188"></a>00188            <span class="stringliteral">&quot;\t\tpres.: %u, dpl: %u, db: %u, s: %u, l: %u, g: %u, avl: %u, unus.: %u\n&quot;</span>,
<a name="l00189"></a>00189            reg_name,
<a name="l00190"></a>00190            <a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.base, <a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.limit, <a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.selector, <a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.type,
<a name="l00191"></a>00191            <a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.present, <a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.dpl, <a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.db, <a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.s, <a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.l, <a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.g, <a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.avl, <a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.unusable);
<a name="l00192"></a>00192 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac071f56204bac6717fe834e758908929"></a><!-- doxytag: member="x86_cpu.cc::dumpKvm" ref="ac071f56204bac6717fe834e758908929" args="(const struct kvm_regs &amp;regs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void dumpKvm </td>
          <td>(</td>
          <td class="paramtype">const struct kvm_regs &amp;&nbsp;</td>
          <td class="paramname"> <em>regs</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00170"></a>00170 {
<a name="l00171"></a>00171     <a class="code" href="base_2misc_8hh.html#ae7d790080fa18103d7582effff570b9e">inform</a>(<span class="stringliteral">&quot;KVM register state:\n&quot;</span>);
<a name="l00172"></a>00172 
<a name="l00173"></a>00173 <span class="preprocessor">#define APPLY_IREG(kreg, mreg)                  \</span>
<a name="l00174"></a>00174 <span class="preprocessor">    inform(&quot;\t&quot; # kreg &quot;: 0x%llx\n&quot;, regs.kreg)</span>
<a name="l00175"></a>00175 <span class="preprocessor"></span>
<a name="l00176"></a>00176     <a class="code" href="x86__cpu_8cc.html#a1b70a9e03d3e57124b5ec691a3de8720">FOREACH_IREG</a>();
<a name="l00177"></a>00177 
<a name="l00178"></a>00178 <span class="preprocessor">#undef APPLY_IREG</span>
<a name="l00179"></a>00179 <span class="preprocessor"></span>
<a name="l00180"></a>00180     <a class="code" href="base_2misc_8hh.html#ae7d790080fa18103d7582effff570b9e">inform</a>(<span class="stringliteral">&quot;\trip: 0x%llx\n&quot;</span>, regs.rip);
<a name="l00181"></a>00181     <a class="code" href="base_2misc_8hh.html#ae7d790080fa18103d7582effff570b9e">inform</a>(<span class="stringliteral">&quot;\trflags: 0x%llx\n&quot;</span>, regs.rflags);
<a name="l00182"></a>00182 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0dd1c17ee1639164887df8dae4a46861"></a><!-- doxytag: member="x86_cpu.cc::forceSegAccessed" ref="a0dd1c17ee1639164887df8dae4a46861" args="(struct kvm_segment &amp;seg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void forceSegAccessed </td>
          <td>(</td>
          <td class="paramtype">struct kvm_segment &amp;&nbsp;</td>
          <td class="paramname"> <em>seg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00741"></a>00741 {
<a name="l00742"></a>00742     <span class="comment">// Intel&apos;s VMX requires that (some) usable segments are flagged as</span>
<a name="l00743"></a>00743     <span class="comment">// &apos;accessed&apos; (i.e., the lowest bit in the segment type is set)</span>
<a name="l00744"></a>00744     <span class="comment">// when entering VMX. This wouldn&apos;t necessary be the case even if</span>
<a name="l00745"></a>00745     <span class="comment">// gem5 did set the access bits correctly, so we force it to one</span>
<a name="l00746"></a>00746     <span class="comment">// in that case.</span>
<a name="l00747"></a>00747     <span class="keywordflow">if</span> (!<a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.unusable)
<a name="l00748"></a>00748         <a class="code" href="namespaceX86ISA.html#a93006a29bcdfcda7fdda27c7deec6618">seg</a>.type |= <a class="code" href="x86__cpu_8cc.html#a4d4061bc93950e881300fc67c076eebd">SEG_TYPE_BIT_ACCESSED</a>;
<a name="l00749"></a>00749 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a897edaa2f5ac7a67d3897d65908e8522"></a><!-- doxytag: member="x86_cpu.cc::isCanonicalAddress" ref="a897edaa2f5ac7a67d3897d65908e8522" args="(uint64_t addr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static bool isCanonicalAddress </td>
          <td>(</td>
          <td class="paramtype">uint64_t&nbsp;</td>
          <td class="paramname"> <em>addr</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00370"></a>00370 {
<a name="l00371"></a>00371     <span class="comment">// x86-64 doesn&apos;t currently use the full 64-bit virtual address</span>
<a name="l00372"></a>00372     <span class="comment">// space, instead it uses signed 48 bit addresses that are</span>
<a name="l00373"></a>00373     <span class="comment">// sign-extended to 64 bits.  Such addresses are known as</span>
<a name="l00374"></a>00374     <span class="comment">// &quot;canonical&quot;.</span>
<a name="l00375"></a>00375     uint64_t upper_half(<a class="code" href="namespaceX86ISA.html#ab705917f60c5566f9ce56a93f798b2e2">addr</a> &amp; 0xffff800000000000ULL);
<a name="l00376"></a>00376     <span class="keywordflow">return</span> upper_half == 0 || upper_half == 0xffff800000000000;
<a name="l00377"></a>00377 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8e529a8d690941d970b53028ee411ec2"></a><!-- doxytag: member="x86_cpu.cc::makeKvmCpuid" ref="a8e529a8d690941d970b53028ee411ec2" args="(uint32_t function, uint32_t index, CpuidResult &amp;result)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct kvm_cpuid_entry2 makeKvmCpuid </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&nbsp;</td>
          <td class="paramname"> <em>function</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&nbsp;</td>
          <td class="paramname"> <em>index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structX86ISA_1_1CpuidResult.html">CpuidResult</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>result</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l01410"></a>01410 {
<a name="l01411"></a>01411     <span class="keyword">struct </span>kvm_cpuid_entry2 <a class="code" href="namespaceArmISA.html#a55520507919005a961edbe8b177f3bba">e</a>;
<a name="l01412"></a>01412     <a class="code" href="namespaceArmISA.html#a55520507919005a961edbe8b177f3bba">e</a>.function = function;
<a name="l01413"></a>01413     <a class="code" href="namespaceArmISA.html#a55520507919005a961edbe8b177f3bba">e</a>.index = <a class="code" href="namespaceMipsISA.html#ae6714ce3c5ef82205cecbd410556edf3">index</a>;
<a name="l01414"></a>01414     <a class="code" href="namespaceArmISA.html#a55520507919005a961edbe8b177f3bba">e</a>.flags = 0;
<a name="l01415"></a>01415     <a class="code" href="namespaceArmISA.html#a55520507919005a961edbe8b177f3bba">e</a>.eax = (<a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>)result.<a class="code" href="structX86ISA_1_1CpuidResult.html#afae317c0ec04889d6c9452dc30711975">rax</a>;
<a name="l01416"></a>01416     <a class="code" href="namespaceArmISA.html#a55520507919005a961edbe8b177f3bba">e</a>.ebx = (<a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>)result.<a class="code" href="structX86ISA_1_1CpuidResult.html#a49647568f68fbd9082c6be345350f483">rbx</a>;
<a name="l01417"></a>01417     <a class="code" href="namespaceArmISA.html#a55520507919005a961edbe8b177f3bba">e</a>.ecx = (<a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>)result.<a class="code" href="structX86ISA_1_1CpuidResult.html#a914f17516921c8917ca4a809893138d6">rcx</a>;
<a name="l01418"></a>01418     <a class="code" href="namespaceArmISA.html#a55520507919005a961edbe8b177f3bba">e</a>.edx = (<a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>)result.<a class="code" href="structX86ISA_1_1CpuidResult.html#a7e87c5e2faab8a404c01084ddeed4588">rdx</a>;
<a name="l01419"></a>01419 
<a name="l01420"></a>01420     <span class="keywordflow">return</span> <a class="code" href="namespaceArmISA.html#a55520507919005a961edbe8b177f3bba">e</a>;
<a name="l01421"></a>01421 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a28d3018844ed28641faabd89ab18e3ff"></a><!-- doxytag: member="x86_cpu.cc::newVarStruct" ref="a28d3018844ed28641faabd89ab18e3ff" args="(size_t entries)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static STRUCT* newVarStruct </td>
          <td>(</td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>entries</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00164"></a>00164 {
<a name="l00165"></a>00165     <span class="keywordflow">return</span> (STRUCT *)operator new(<span class="keyword">sizeof</span>(STRUCT) + entries * <span class="keyword">sizeof</span>(ENTRY));
<a name="l00166"></a>00166 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ada916424bb12b00a7176788153a7a2f4"></a><!-- doxytag: member="x86_cpu.cc::setContextSegment" ref="ada916424bb12b00a7176788153a7a2f4" args="(ThreadContext *tc, const struct kvm_dtable &amp;kvm_dtable, const int index)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void setContextSegment </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classThreadContext.html">ThreadContext</a> *&nbsp;</td>
          <td class="paramname"> <em>tc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct kvm_dtable &amp;&nbsp;</td>
          <td class="paramname"> <em>kvm_dtable</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>index</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l01016"></a>01016 {
<a name="l01017"></a>01017     <span class="comment">// We need some setMiscReg magic here to keep the effective base</span>
<a name="l01018"></a>01018     <span class="comment">// addresses in sync. We need an up-to-date version of EFER, so</span>
<a name="l01019"></a>01019     <span class="comment">// make sure this is called after the sregs have been synced.</span>
<a name="l01020"></a>01020     tc-&gt;<a class="code" href="classThreadContext.html#a074166dc2fe3c4aea3ad588ed9883c51">setMiscReg</a>(<a class="code" href="namespaceX86ISA.html#a310d36d3d8ec55a84d807cb7e1edf7d6">MISCREG_SEG_BASE</a>(<a class="code" href="namespaceMipsISA.html#ae6714ce3c5ef82205cecbd410556edf3">index</a>), kvm_dtable.base);
<a name="l01021"></a>01021     tc-&gt;<a class="code" href="classThreadContext.html#a074166dc2fe3c4aea3ad588ed9883c51">setMiscReg</a>(<a class="code" href="namespaceX86ISA.html#af93c7fd7ac0d329975952ac0c2a97f98">MISCREG_SEG_LIMIT</a>(<a class="code" href="namespaceMipsISA.html#ae6714ce3c5ef82205cecbd410556edf3">index</a>), kvm_dtable.limit);
<a name="l01022"></a>01022 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a95c05cceb7cdce6304fb8ebe174bf300"></a><!-- doxytag: member="x86_cpu.cc::setContextSegment" ref="a95c05cceb7cdce6304fb8ebe174bf300" args="(ThreadContext *tc, const struct kvm_segment &amp;kvm_seg, const int index)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void setContextSegment </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classThreadContext.html">ThreadContext</a> *&nbsp;</td>
          <td class="paramname"> <em>tc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct kvm_segment &amp;&nbsp;</td>
          <td class="paramname"> <em>kvm_seg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>index</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00991"></a>00991 {
<a name="l00992"></a>00992     SegAttr <a class="code" href="namespaceArmISA.html#a710acfac10f0042826d2d6d9c213ae7b">attr</a>(0);
<a name="l00993"></a>00993 
<a name="l00994"></a>00994     <a class="code" href="namespaceArmISA.html#a710acfac10f0042826d2d6d9c213ae7b">attr</a>.type = kvm_seg.type;
<a name="l00995"></a>00995     <a class="code" href="namespaceArmISA.html#a710acfac10f0042826d2d6d9c213ae7b">attr</a>.present = kvm_seg.present;
<a name="l00996"></a>00996     <a class="code" href="namespaceArmISA.html#a710acfac10f0042826d2d6d9c213ae7b">attr</a>.dpl = kvm_seg.dpl;
<a name="l00997"></a>00997     <a class="code" href="namespaceArmISA.html#a710acfac10f0042826d2d6d9c213ae7b">attr</a>.defaultSize = kvm_seg.db;
<a name="l00998"></a>00998     <a class="code" href="namespaceArmISA.html#a710acfac10f0042826d2d6d9c213ae7b">attr</a>.system = kvm_seg.s;
<a name="l00999"></a>00999     <a class="code" href="namespaceArmISA.html#a710acfac10f0042826d2d6d9c213ae7b">attr</a>.longMode = kvm_seg.l;
<a name="l01000"></a>01000     <a class="code" href="namespaceArmISA.html#a710acfac10f0042826d2d6d9c213ae7b">attr</a>.granularity = kvm_seg.g;
<a name="l01001"></a>01001     <a class="code" href="namespaceArmISA.html#a710acfac10f0042826d2d6d9c213ae7b">attr</a>.avl = kvm_seg.avl;
<a name="l01002"></a>01002     <a class="code" href="namespaceArmISA.html#a710acfac10f0042826d2d6d9c213ae7b">attr</a>.unusable = kvm_seg.unusable;
<a name="l01003"></a>01003 
<a name="l01004"></a>01004     <span class="comment">// We need some setMiscReg magic here to keep the effective base</span>
<a name="l01005"></a>01005     <span class="comment">// addresses in sync. We need an up-to-date version of EFER, so</span>
<a name="l01006"></a>01006     <span class="comment">// make sure this is called after the sregs have been synced.</span>
<a name="l01007"></a>01007     tc-&gt;<a class="code" href="classThreadContext.html#a074166dc2fe3c4aea3ad588ed9883c51">setMiscReg</a>(<a class="code" href="namespaceX86ISA.html#a310d36d3d8ec55a84d807cb7e1edf7d6">MISCREG_SEG_BASE</a>(<a class="code" href="namespaceMipsISA.html#ae6714ce3c5ef82205cecbd410556edf3">index</a>), kvm_seg.base);
<a name="l01008"></a>01008     tc-&gt;<a class="code" href="classThreadContext.html#a074166dc2fe3c4aea3ad588ed9883c51">setMiscReg</a>(<a class="code" href="namespaceX86ISA.html#af93c7fd7ac0d329975952ac0c2a97f98">MISCREG_SEG_LIMIT</a>(<a class="code" href="namespaceMipsISA.html#ae6714ce3c5ef82205cecbd410556edf3">index</a>), kvm_seg.limit);
<a name="l01009"></a>01009     tc-&gt;<a class="code" href="classThreadContext.html#a074166dc2fe3c4aea3ad588ed9883c51">setMiscReg</a>(<a class="code" href="namespaceX86ISA.html#a7a287359d6688cb50477df97dcbdd196">MISCREG_SEG_SEL</a>(<a class="code" href="namespaceMipsISA.html#ae6714ce3c5ef82205cecbd410556edf3">index</a>), kvm_seg.selector);
<a name="l01010"></a>01010     tc-&gt;<a class="code" href="classThreadContext.html#a074166dc2fe3c4aea3ad588ed9883c51">setMiscReg</a>(<a class="code" href="namespaceX86ISA.html#abb8ec3742a54286da349c98a1a9c9755">MISCREG_SEG_ATTR</a>(<a class="code" href="namespaceMipsISA.html#ae6714ce3c5ef82205cecbd410556edf3">index</a>), <a class="code" href="namespaceArmISA.html#a710acfac10f0042826d2d6d9c213ae7b">attr</a>);
<a name="l01011"></a>01011 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a51d8093baee27ba8789bb1af7af824a2"></a><!-- doxytag: member="x86_cpu.cc::setKvmDTableReg" ref="a51d8093baee27ba8789bb1af7af824a2" args="(ThreadContext *tc, struct kvm_dtable &amp;kvm_dtable, const int index)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void setKvmDTableReg </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classThreadContext.html">ThreadContext</a> *&nbsp;</td>
          <td class="paramname"> <em>tc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct kvm_dtable &amp;&nbsp;</td>
          <td class="paramname"> <em>kvm_dtable</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>index</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00734"></a>00734 {
<a name="l00735"></a>00735     kvm_dtable.base = tc-&gt;<a class="code" href="classThreadContext.html#a93c9c97261cb7289d5976b8222f70c4c">readMiscRegNoEffect</a>(<a class="code" href="namespaceX86ISA.html#a310d36d3d8ec55a84d807cb7e1edf7d6">MISCREG_SEG_BASE</a>(<a class="code" href="namespaceMipsISA.html#ae6714ce3c5ef82205cecbd410556edf3">index</a>));
<a name="l00736"></a>00736     kvm_dtable.limit = tc-&gt;<a class="code" href="classThreadContext.html#a93c9c97261cb7289d5976b8222f70c4c">readMiscRegNoEffect</a>(<a class="code" href="namespaceX86ISA.html#af93c7fd7ac0d329975952ac0c2a97f98">MISCREG_SEG_LIMIT</a>(<a class="code" href="namespaceMipsISA.html#ae6714ce3c5ef82205cecbd410556edf3">index</a>));
<a name="l00737"></a>00737 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a05127157d55aca2814725c2e283a2d19"></a><!-- doxytag: member="x86_cpu.cc::setKvmSegmentReg" ref="a05127157d55aca2814725c2e283a2d19" args="(ThreadContext *tc, struct kvm_segment &amp;kvm_seg, const int index)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void setKvmSegmentReg </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classThreadContext.html">ThreadContext</a> *&nbsp;</td>
          <td class="paramname"> <em>tc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct kvm_segment &amp;&nbsp;</td>
          <td class="paramname"> <em>kvm_seg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>index</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00709"></a>00709 {
<a name="l00710"></a>00710     SegAttr <a class="code" href="namespaceArmISA.html#a710acfac10f0042826d2d6d9c213ae7b">attr</a>(tc-&gt;<a class="code" href="classThreadContext.html#a93c9c97261cb7289d5976b8222f70c4c">readMiscRegNoEffect</a>(<a class="code" href="namespaceX86ISA.html#abb8ec3742a54286da349c98a1a9c9755">MISCREG_SEG_ATTR</a>(<a class="code" href="namespaceMipsISA.html#ae6714ce3c5ef82205cecbd410556edf3">index</a>)));
<a name="l00711"></a>00711 
<a name="l00712"></a>00712     kvm_seg.base = tc-&gt;<a class="code" href="classThreadContext.html#a93c9c97261cb7289d5976b8222f70c4c">readMiscRegNoEffect</a>(<a class="code" href="namespaceX86ISA.html#a310d36d3d8ec55a84d807cb7e1edf7d6">MISCREG_SEG_BASE</a>(<a class="code" href="namespaceMipsISA.html#ae6714ce3c5ef82205cecbd410556edf3">index</a>));
<a name="l00713"></a>00713     kvm_seg.limit = tc-&gt;<a class="code" href="classThreadContext.html#a93c9c97261cb7289d5976b8222f70c4c">readMiscRegNoEffect</a>(<a class="code" href="namespaceX86ISA.html#af93c7fd7ac0d329975952ac0c2a97f98">MISCREG_SEG_LIMIT</a>(<a class="code" href="namespaceMipsISA.html#ae6714ce3c5ef82205cecbd410556edf3">index</a>));
<a name="l00714"></a>00714     kvm_seg.selector = tc-&gt;<a class="code" href="classThreadContext.html#a93c9c97261cb7289d5976b8222f70c4c">readMiscRegNoEffect</a>(<a class="code" href="namespaceX86ISA.html#a7a287359d6688cb50477df97dcbdd196">MISCREG_SEG_SEL</a>(<a class="code" href="namespaceMipsISA.html#ae6714ce3c5ef82205cecbd410556edf3">index</a>));
<a name="l00715"></a>00715     kvm_seg.type = <a class="code" href="namespaceArmISA.html#a710acfac10f0042826d2d6d9c213ae7b">attr</a>.type;
<a name="l00716"></a>00716     kvm_seg.present = <a class="code" href="namespaceArmISA.html#a710acfac10f0042826d2d6d9c213ae7b">attr</a>.present;
<a name="l00717"></a>00717     kvm_seg.dpl = <a class="code" href="namespaceArmISA.html#a710acfac10f0042826d2d6d9c213ae7b">attr</a>.dpl;
<a name="l00718"></a>00718     kvm_seg.db = <a class="code" href="namespaceArmISA.html#a710acfac10f0042826d2d6d9c213ae7b">attr</a>.defaultSize;
<a name="l00719"></a>00719     kvm_seg.s = <a class="code" href="namespaceArmISA.html#a710acfac10f0042826d2d6d9c213ae7b">attr</a>.system;
<a name="l00720"></a>00720     kvm_seg.l = <a class="code" href="namespaceArmISA.html#a710acfac10f0042826d2d6d9c213ae7b">attr</a>.longMode;
<a name="l00721"></a>00721     kvm_seg.g = <a class="code" href="namespaceArmISA.html#a710acfac10f0042826d2d6d9c213ae7b">attr</a>.granularity;
<a name="l00722"></a>00722     kvm_seg.avl = <a class="code" href="namespaceArmISA.html#a710acfac10f0042826d2d6d9c213ae7b">attr</a>.avl;
<a name="l00723"></a>00723 
<a name="l00724"></a>00724     <span class="comment">// A segment is normally unusable when the selector is zero. There</span>
<a name="l00725"></a>00725     <span class="comment">// is a attr.unusable flag in gem5, but it seems unused. qemu</span>
<a name="l00726"></a>00726     <span class="comment">// seems to set this to 0 all the time, so we just do the same and</span>
<a name="l00727"></a>00727     <span class="comment">// hope for the best.</span>
<a name="l00728"></a>00728     kvm_seg.unusable = 0;
<a name="l00729"></a>00729 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a954bbe2225157cef7b550ee58ce351bd"></a><!-- doxytag: member="x86_cpu.cc::static_assert" ref="a954bbe2225157cef7b550ee58ce351bd" args="(sizeof(FXSave)==512,&quot;Unexpected size of FXSave&quot;)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static_assert </td>
          <td>(</td>
          <td class="paramtype">sizeof(<a class="el" href="structFXSave.html">FXSave</a>)&nbsp;</td>
          <td class="paramname"> = <code>=512</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&quot;Unexpected size of <a class="el" href="structFXSave.html">FXSave</a>&quot;&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="af4646df895fd6ad546cfecaa85e782b7"></a><!-- doxytag: member="x86_cpu.cc::updateKvmStateFPUCommon" ref="af4646df895fd6ad546cfecaa85e782b7" args="(ThreadContext *tc, T &amp;fpu)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void updateKvmStateFPUCommon </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classThreadContext.html">ThreadContext</a> *&nbsp;</td>
          <td class="paramname"> <em>tc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">T &amp;&nbsp;</td>
          <td class="paramname"> <em>fpu</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00822"></a>00822 {
<a name="l00823"></a>00823     <a class="code" href="x86__cpu_8cc.html#a954bbe2225157cef7b550ee58ce351bd">static_assert</a>(<span class="keyword">sizeof</span>(<a class="code" href="namespaceX86ISA.html#a6905e424d12491fe126e1a22a9c8d655">X86ISA::FloatRegBits</a>) == 8,
<a name="l00824"></a>00824                   <span class="stringliteral">&quot;Unexpected size of X86ISA::FloatRegBits&quot;</span>);
<a name="l00825"></a>00825 
<a name="l00826"></a>00826     fpu.mxcsr = tc-&gt;<a class="code" href="classThreadContext.html#a93c9c97261cb7289d5976b8222f70c4c">readMiscRegNoEffect</a>(<a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67a7346c48560738adc54cb595c3cb544ea">MISCREG_MXCSR</a>);
<a name="l00827"></a>00827     fpu.fcw = tc-&gt;<a class="code" href="classThreadContext.html#a93c9c97261cb7289d5976b8222f70c4c">readMiscRegNoEffect</a>(<a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67ae65ec737a3d225a3774722b60f9d2556">MISCREG_FCW</a>);
<a name="l00828"></a>00828     <span class="comment">// No need to rebuild from MISCREG_FSW and MISCREG_TOP if we read</span>
<a name="l00829"></a>00829     <span class="comment">// with effects.</span>
<a name="l00830"></a>00830     fpu.fsw = tc-&gt;<a class="code" href="classThreadContext.html#a6888f4bff21e34892e59654ea80073b2">readMiscReg</a>(<a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67a0cf71d184089ae0802cd85b0fb5d699b">MISCREG_FSW</a>);
<a name="l00831"></a>00831 
<a name="l00832"></a>00832     uint64_t ftw(tc-&gt;<a class="code" href="classThreadContext.html#a93c9c97261cb7289d5976b8222f70c4c">readMiscRegNoEffect</a>(<a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67af78c79c66b0edd9c9f2fcb4b94209200">MISCREG_FTW</a>));
<a name="l00833"></a>00833     fpu.ftwx = <a class="code" href="namespaceX86ISA.html#add62d0d156403397cd87b43f80923727">X86ISA::convX87TagsToXTags</a>(ftw);
<a name="l00834"></a>00834 
<a name="l00835"></a>00835     fpu.last_opcode = tc-&gt;<a class="code" href="classThreadContext.html#a93c9c97261cb7289d5976b8222f70c4c">readMiscRegNoEffect</a>(<a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67a502b6710aea0fe55c463e05f4cd0d3ce">MISCREG_FOP</a>);
<a name="l00836"></a>00836 
<a name="l00837"></a>00837     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> top((fpu.fsw &gt;&gt; 11) &amp; 0x7);
<a name="l00838"></a>00838     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> = 0; <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> &lt; 8; ++<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>) {
<a name="l00839"></a>00839         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> reg_idx((<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> + top) &amp; 0x7);
<a name="l00840"></a>00840         <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespacegenini.html#a7e5f482a3a8a4f98bd1a9c124485f572">value</a>(tc-&gt;<a class="code" href="classThreadContext.html#a7883083f396dee2160e4b8640d02f5f6">readFloatReg</a>(<a class="code" href="namespaceX86ISA.html#ab07809fafe3d56bd3789c7ada8139259">FLOATREG_FPR</a>(reg_idx)));
<a name="l00841"></a>00841         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(KvmContext, <span class="stringliteral">&quot;Setting KVM FP reg %i (st[%i]) := %f\n&quot;</span>,
<a name="l00842"></a>00842                 reg_idx, <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>, <a class="code" href="namespacegenini.html#a7e5f482a3a8a4f98bd1a9c124485f572">value</a>);
<a name="l00843"></a>00843         <a class="code" href="namespaceX86ISA.html#ae8b48156538261ce17898404db731128">X86ISA::storeFloat80</a>(fpu.fpr[<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>], <a class="code" href="namespacegenini.html#a7e5f482a3a8a4f98bd1a9c124485f572">value</a>);
<a name="l00844"></a>00844     }
<a name="l00845"></a>00845 
<a name="l00846"></a>00846     <span class="comment">// TODO: We should update the MMX state</span>
<a name="l00847"></a>00847 
<a name="l00848"></a>00848     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> = 0; <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> &lt; 16; ++<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>) {
<a name="l00849"></a>00849         *(<a class="code" href="namespaceX86ISA.html#a6905e424d12491fe126e1a22a9c8d655">X86ISA::FloatRegBits</a> *)&amp;fpu.xmm[<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>][0] =
<a name="l00850"></a>00850             tc-&gt;<a class="code" href="classThreadContext.html#a66bf9e1bf11ad15d1903209dd37014c5">readFloatRegBits</a>(<a class="code" href="namespaceX86ISA.html#a7e1716adfb57ca8bf4794517d887ea54">FLOATREG_XMM_LOW</a>(<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>));
<a name="l00851"></a>00851         *(<a class="code" href="namespaceX86ISA.html#a6905e424d12491fe126e1a22a9c8d655">X86ISA::FloatRegBits</a> *)&amp;fpu.xmm[<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>][8] =
<a name="l00852"></a>00852             tc-&gt;<a class="code" href="classThreadContext.html#a66bf9e1bf11ad15d1903209dd37014c5">readFloatRegBits</a>(<a class="code" href="namespaceX86ISA.html#ac68f196980acc04ce2279fb376e1401b">FLOATREG_XMM_HIGH</a>(<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>));
<a name="l00853"></a>00853     }
<a name="l00854"></a>00854 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a313c58fe9310f894c07dda533fde7fbb"></a><!-- doxytag: member="x86_cpu.cc::updateThreadContextFPUCommon" ref="a313c58fe9310f894c07dda533fde7fbb" args="(ThreadContext *tc, const T &amp;fpu)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void updateThreadContextFPUCommon </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classThreadContext.html">ThreadContext</a> *&nbsp;</td>
          <td class="paramname"> <em>tc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const T &amp;&nbsp;</td>
          <td class="paramname"> <em>fpu</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l01044"></a>01044 {
<a name="l01045"></a>01045     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> top((fpu.fsw &gt;&gt; 11) &amp; 0x7);
<a name="l01046"></a>01046 
<a name="l01047"></a>01047     <a class="code" href="x86__cpu_8cc.html#a954bbe2225157cef7b550ee58ce351bd">static_assert</a>(<span class="keyword">sizeof</span>(<a class="code" href="namespaceX86ISA.html#a6905e424d12491fe126e1a22a9c8d655">X86ISA::FloatRegBits</a>) == 8,
<a name="l01048"></a>01048                   <span class="stringliteral">&quot;Unexpected size of X86ISA::FloatRegBits&quot;</span>);
<a name="l01049"></a>01049 
<a name="l01050"></a>01050     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> = 0; <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> &lt; 8; ++<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>) {
<a name="l01051"></a>01051         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> reg_idx((<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> + top) &amp; 0x7);
<a name="l01052"></a>01052         <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespacegenini.html#a7e5f482a3a8a4f98bd1a9c124485f572">value</a>(<a class="code" href="namespaceX86ISA.html#a97c5f8f8ac0ded173ac00bfae8e92e0e">X86ISA::loadFloat80</a>(fpu.fpr[<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>]));
<a name="l01053"></a>01053         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(KvmContext, <span class="stringliteral">&quot;Setting gem5 FP reg %i (st[%i]) := %f\n&quot;</span>,
<a name="l01054"></a>01054                 reg_idx, <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>, <a class="code" href="namespacegenini.html#a7e5f482a3a8a4f98bd1a9c124485f572">value</a>);
<a name="l01055"></a>01055         tc-&gt;<a class="code" href="classThreadContext.html#af8dc9762fda519d911372dd6f4a28d8e">setFloatReg</a>(<a class="code" href="namespaceX86ISA.html#ab07809fafe3d56bd3789c7ada8139259">FLOATREG_FPR</a>(reg_idx), <a class="code" href="namespacegenini.html#a7e5f482a3a8a4f98bd1a9c124485f572">value</a>);
<a name="l01056"></a>01056     }
<a name="l01057"></a>01057 
<a name="l01058"></a>01058     <span class="comment">// TODO: We should update the MMX state</span>
<a name="l01059"></a>01059 
<a name="l01060"></a>01060     tc-&gt;<a class="code" href="classThreadContext.html#a2987c1ff22ebdf6cdf354a31462bdbfb">setMiscRegNoEffect</a>(<a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67a5a843f44bad48e37151dd9fb9f9cf637">MISCREG_X87_TOP</a>, top);
<a name="l01061"></a>01061     tc-&gt;<a class="code" href="classThreadContext.html#a2987c1ff22ebdf6cdf354a31462bdbfb">setMiscRegNoEffect</a>(<a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67a7346c48560738adc54cb595c3cb544ea">MISCREG_MXCSR</a>, fpu.mxcsr);
<a name="l01062"></a>01062     tc-&gt;<a class="code" href="classThreadContext.html#a2987c1ff22ebdf6cdf354a31462bdbfb">setMiscRegNoEffect</a>(<a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67ae65ec737a3d225a3774722b60f9d2556">MISCREG_FCW</a>, fpu.fcw);
<a name="l01063"></a>01063     tc-&gt;<a class="code" href="classThreadContext.html#a2987c1ff22ebdf6cdf354a31462bdbfb">setMiscRegNoEffect</a>(<a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67a0cf71d184089ae0802cd85b0fb5d699b">MISCREG_FSW</a>, fpu.fsw);
<a name="l01064"></a>01064 
<a name="l01065"></a>01065     uint64_t ftw(<a class="code" href="namespaceX86ISA.html#ae196a751ba59507ee189f66f87f62de1">convX87XTagsToTags</a>(fpu.ftwx));
<a name="l01066"></a>01066     <span class="comment">// TODO: Are these registers really the same?</span>
<a name="l01067"></a>01067     tc-&gt;<a class="code" href="classThreadContext.html#a2987c1ff22ebdf6cdf354a31462bdbfb">setMiscRegNoEffect</a>(<a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67af78c79c66b0edd9c9f2fcb4b94209200">MISCREG_FTW</a>, ftw);
<a name="l01068"></a>01068     tc-&gt;<a class="code" href="classThreadContext.html#a2987c1ff22ebdf6cdf354a31462bdbfb">setMiscRegNoEffect</a>(<a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67aa6d5a985a9baab9d150cfd7c437f54b3">MISCREG_FTAG</a>, ftw);
<a name="l01069"></a>01069 
<a name="l01070"></a>01070     tc-&gt;<a class="code" href="classThreadContext.html#a2987c1ff22ebdf6cdf354a31462bdbfb">setMiscRegNoEffect</a>(<a class="code" href="namespaceX86ISA.html#a1e522017e015d4c7efd6b2360143aa67a502b6710aea0fe55c463e05f4cd0d3ce">MISCREG_FOP</a>, fpu.last_opcode);
<a name="l01071"></a>01071 
<a name="l01072"></a>01072     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> = 0; <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> &lt; 16; ++<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>) {
<a name="l01073"></a>01073         tc-&gt;<a class="code" href="classThreadContext.html#a8f0c8b07cd1c4a6019a5b3922689d1db">setFloatRegBits</a>(<a class="code" href="namespaceX86ISA.html#a7e1716adfb57ca8bf4794517d887ea54">FLOATREG_XMM_LOW</a>(<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>),
<a name="l01074"></a>01074                             *(<a class="code" href="namespaceX86ISA.html#a6905e424d12491fe126e1a22a9c8d655">X86ISA::FloatRegBits</a> *)&amp;fpu.xmm[<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>][0]);
<a name="l01075"></a>01075         tc-&gt;<a class="code" href="classThreadContext.html#a8f0c8b07cd1c4a6019a5b3922689d1db">setFloatRegBits</a>(<a class="code" href="namespaceX86ISA.html#ac68f196980acc04ce2279fb376e1401b">FLOATREG_XMM_HIGH</a>(i),
<a name="l01076"></a>01076                             *(<a class="code" href="namespaceX86ISA.html#a6905e424d12491fe126e1a22a9c8d655">X86ISA::FloatRegBits</a> *)&amp;fpu.xmm[i][8]);
<a name="l01077"></a>01077     }
<a name="l01078"></a>01078 }
</pre></div></p>

</div>
</div>
<hr/><h2>変数</h2>
<a class="anchor" id="a71c71aceb8fa2a663f6ac608a6df0b08"></a><!-- doxytag: member="x86_cpu.cc::M5_ATTR_PACKED" ref="a71c71aceb8fa2a663f6ac608a6df0b08" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structFXSave.html">FXSave</a>  <a class="el" href="x86__cpu_8cc.html#a71c71aceb8fa2a663f6ac608a6df0b08">M5_ATTR_PACKED</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>File&nbsp;GEM5&nbsp;Wrapperに対して25 May 2015に生成されました。&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
