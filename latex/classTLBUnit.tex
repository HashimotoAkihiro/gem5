\hypertarget{classTLBUnit}{
\section{クラス TLBUnit}
\label{classTLBUnit}\index{TLBUnit@{TLBUnit}}
}


{\ttfamily \#include $<$tlb\_\-unit.hh$>$}TLBUnitに対する継承グラフ:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2cm]{classTLBUnit}
\end{center}
\end{figure}
\subsection*{Public 型}
\begin{DoxyCompactItemize}
\item 
enum \hyperlink{classTLBUnit_a84156c3c25e02b62e71c79cb2bb242b6}{TLBCommand} \{ \hyperlink{classTLBUnit_a84156c3c25e02b62e71c79cb2bb242b6aee3054bfa4409a05b1621d500d4048a7}{FetchLookup}, 
\hyperlink{classTLBUnit_a84156c3c25e02b62e71c79cb2bb242b6a0818430be26628918457330f03d5d0d4}{DataReadLookup}, 
\hyperlink{classTLBUnit_a84156c3c25e02b62e71c79cb2bb242b6aaa5cca038c0fd9c8e1a68b6227cf1919}{DataWriteLookup}
 \}
\item 
typedef \hyperlink{classRefCountingPtr}{ThePipeline::DynInstPtr} \hyperlink{classTLBUnit_af9d0c8a46736ba6aa2d8bb94da1a5e73}{DynInstPtr}
\end{DoxyCompactItemize}
\subsection*{Public メソッド}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classTLBUnit_a08b80cd9315a97384c41fcab5e237316}{TLBUnit} (std::string res\_\-name, int res\_\-id, int res\_\-width, \hyperlink{classCycles}{Cycles} res\_\-latency, \hyperlink{classInOrderCPU}{InOrderCPU} $\ast$\_\-cpu, \hyperlink{namespaceThePipeline_ab62ca16eeca26566ad2422b5df4943ce}{ThePipeline::Params} $\ast$params)
\item 
virtual \hyperlink{classTLBUnit_a715a453817a86ac44d004bbb01e58dbb}{$\sim$TLBUnit} ()
\item 
void \hyperlink{classTLBUnit_a02fd73d861ef2e4aabb38c0c9ff82947}{init} ()
\item 
int \hyperlink{classTLBUnit_ab3ba2ee95c723c8c056db0a1f2a6dfd3}{getSlot} (\hyperlink{classRefCountingPtr}{DynInstPtr} inst)
\item 
virtual \hyperlink{classResourceRequest}{ResourceRequest} $\ast$ \hyperlink{classTLBUnit_a98b2e8ae07f180e62be1d03beae400f9}{getRequest} (\hyperlink{classRefCountingPtr}{DynInstPtr} \_\-inst, int stage\_\-num, int res\_\-idx, int slot\_\-num, unsigned cmd)
\item 
virtual void \hyperlink{classTLBUnit_a7b7fff82f8c9cbdb02add1346f60bb9e}{execute} (int slot\_\-num)
\item 
void \hyperlink{classTLBUnit_a52235c5e3d912452f254dc45f1496fd2}{squash} (\hyperlink{classRefCountingPtr}{DynInstPtr} inst, int stage\_\-num, \hyperlink{inst__seq_8hh_a258d93d98edaedee089435c19ea2ea2e}{InstSeqNum} squash\_\-seq\_\-num, \hyperlink{base_2types_8hh_ab39b1a4f9dad884694c7a74ed69e6a6b}{ThreadID} tid)
\item 
TheISA::TLB $\ast$ \hyperlink{classTLBUnit_a3cf8b27760278d20d4aa9463f52a2d95}{tlb} ()
\end{DoxyCompactItemize}
\subsection*{Public 変数}
\begin{DoxyCompactItemize}
\item 
bool \hyperlink{classTLBUnit_a1e5ca2b940e91b19e93867cc549fe65d}{tlbBlocked} \mbox{[}\hyperlink{namespaceThePipeline_ac9c0bbe9cf27d93e08ea8ccc4096e633}{ThePipeline::MaxThreads}\mbox{]}
\end{DoxyCompactItemize}
\subsection*{Protected 変数}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classstd_1_1list}{std::list}$<$ \hyperlink{classRefCountingPtr}{DynInstPtr} $>$ \hyperlink{classTLBUnit_ae10a391d02ce1ef67ee13cd82b7d46e5}{instList}
\item 
TheISA::TLB $\ast$ \hyperlink{classTLBUnit_a5aa23855b427a009f3334c95a146084b}{\_\-tlb}
\end{DoxyCompactItemize}


\subsection{型定義}
\hypertarget{classTLBUnit_af9d0c8a46736ba6aa2d8bb94da1a5e73}{
\index{TLBUnit@{TLBUnit}!DynInstPtr@{DynInstPtr}}
\index{DynInstPtr@{DynInstPtr}!TLBUnit@{TLBUnit}}
\subsubsection[{DynInstPtr}]{\setlength{\rightskip}{0pt plus 5cm}typedef {\bf ThePipeline::DynInstPtr} {\bf DynInstPtr}}}
\label{classTLBUnit_af9d0c8a46736ba6aa2d8bb94da1a5e73}


\hyperlink{classResource_af9d0c8a46736ba6aa2d8bb94da1a5e73}{Resource}を再定義しています。

\subsection{列挙型}
\hypertarget{classTLBUnit_a84156c3c25e02b62e71c79cb2bb242b6}{
\index{TLBUnit@{TLBUnit}!TLBCommand@{TLBCommand}}
\index{TLBCommand@{TLBCommand}!TLBUnit@{TLBUnit}}
\subsubsection[{TLBCommand}]{\setlength{\rightskip}{0pt plus 5cm}enum {\bf TLBCommand}}}
\label{classTLBUnit_a84156c3c25e02b62e71c79cb2bb242b6}
\begin{Desc}
\item[列挙型の値: ]\par
\begin{description}
\index{FetchLookup@{FetchLookup}!TLBUnit@{TLBUnit}}\index{TLBUnit@{TLBUnit}!FetchLookup@{FetchLookup}}\item[{\em 
\hypertarget{classTLBUnit_a84156c3c25e02b62e71c79cb2bb242b6aee3054bfa4409a05b1621d500d4048a7}{
FetchLookup}
\label{classTLBUnit_a84156c3c25e02b62e71c79cb2bb242b6aee3054bfa4409a05b1621d500d4048a7}
}]\index{DataReadLookup@{DataReadLookup}!TLBUnit@{TLBUnit}}\index{TLBUnit@{TLBUnit}!DataReadLookup@{DataReadLookup}}\item[{\em 
\hypertarget{classTLBUnit_a84156c3c25e02b62e71c79cb2bb242b6a0818430be26628918457330f03d5d0d4}{
DataReadLookup}
\label{classTLBUnit_a84156c3c25e02b62e71c79cb2bb242b6a0818430be26628918457330f03d5d0d4}
}]\index{DataWriteLookup@{DataWriteLookup}!TLBUnit@{TLBUnit}}\index{TLBUnit@{TLBUnit}!DataWriteLookup@{DataWriteLookup}}\item[{\em 
\hypertarget{classTLBUnit_a84156c3c25e02b62e71c79cb2bb242b6aaa5cca038c0fd9c8e1a68b6227cf1919}{
DataWriteLookup}
\label{classTLBUnit_a84156c3c25e02b62e71c79cb2bb242b6aaa5cca038c0fd9c8e1a68b6227cf1919}
}]\end{description}
\end{Desc}




\begin{DoxyCode}
50                     {
51         FetchLookup,
52         DataReadLookup,
53         DataWriteLookup
54     };
\end{DoxyCode}


\subsection{コンストラクタとデストラクタ}
\hypertarget{classTLBUnit_a08b80cd9315a97384c41fcab5e237316}{
\index{TLBUnit@{TLBUnit}!TLBUnit@{TLBUnit}}
\index{TLBUnit@{TLBUnit}!TLBUnit@{TLBUnit}}
\subsubsection[{TLBUnit}]{\setlength{\rightskip}{0pt plus 5cm}{\bf TLBUnit} (std::string {\em res\_\-name}, \/  int {\em res\_\-id}, \/  int {\em res\_\-width}, \/  {\bf Cycles} {\em res\_\-latency}, \/  {\bf InOrderCPU} $\ast$ {\em \_\-cpu}, \/  {\bf ThePipeline::Params} $\ast$ {\em params})}}
\label{classTLBUnit_a08b80cd9315a97384c41fcab5e237316}
\hypertarget{classTLBUnit_a715a453817a86ac44d004bbb01e58dbb}{
\index{TLBUnit@{TLBUnit}!$\sim$TLBUnit@{$\sim$TLBUnit}}
\index{$\sim$TLBUnit@{$\sim$TLBUnit}!TLBUnit@{TLBUnit}}
\subsubsection[{$\sim$TLBUnit}]{\setlength{\rightskip}{0pt plus 5cm}virtual $\sim${\bf TLBUnit} ()\hspace{0.3cm}{\ttfamily  \mbox{[}inline, virtual\mbox{]}}}}
\label{classTLBUnit_a715a453817a86ac44d004bbb01e58dbb}



\begin{DoxyCode}
60 {}
\end{DoxyCode}


\subsection{関数}
\hypertarget{classTLBUnit_a7b7fff82f8c9cbdb02add1346f60bb9e}{
\index{TLBUnit@{TLBUnit}!execute@{execute}}
\index{execute@{execute}!TLBUnit@{TLBUnit}}
\subsubsection[{execute}]{\setlength{\rightskip}{0pt plus 5cm}void execute (int {\em slot\_\-idx})\hspace{0.3cm}{\ttfamily  \mbox{[}virtual\mbox{]}}}}
\label{classTLBUnit_a7b7fff82f8c9cbdb02add1346f60bb9e}
Execute the function of this resource. The Default is action is to do nothing. More specific models will derive from this class and define their own execute function. 

\hyperlink{classResource_a39af49c5568d1db3f53c12d7d6914c32}{Resource}を再定義しています。


\begin{DoxyCode}
105 {
106     // After this is working, change this to a reinterpret cast
107     // for performance considerations
108     TLBUnitRequest* tlb_req = dynamic_cast<TLBUnitRequest*>(reqs[slot_idx]);
109     assert(tlb_req != 0x0);
110 
111     DynInstPtr inst = tlb_req->inst;
112     ThreadID tid = inst->readTid();
113     InstSeqNum seq_num = inst->seqNum;
114     int stage_num = tlb_req->getStageNum();
115 
116     tlb_req->fault = NoFault;
117 
118     assert(cpu->thread[tid]->getTC() != 0x0);
119     assert(cpu->pipelineStage[stage_num] != 0x0);
120 
121     switch (tlb_req->cmd)
122     {
123       case FetchLookup:
124         {
125             tlb_req->fault =
126                 _tlb->translateAtomic(tlb_req->memReq,
127                                       cpu->thread[tid]->getTC(), TheISA::TLB::Exe
      cute);
128 
129             if (tlb_req->fault != NoFault) {
130                 DPRINTF(InOrderTLB, "[tid:%i]: %s encountered while translating "
      
131                         "addr:%08p for [sn:%i].\n", tid, tlb_req->fault->name(),
132                         tlb_req->memReq->getVaddr(), seq_num);
133 
134                 DPRINTF(InOrderTLB, "slot:%i sn:%i schedule event.\n", slot_idx, 
      seq_num);
135 
136                 cpu->pipelineStage[stage_num]->setResStall(tlb_req, tid);
137                 tlbBlocked[tid] = true;
138                 scheduleEvent(slot_idx, 1);
139 
140                 // @TODO: SHOULDNT BREAK EXECUTION at misspeculated PC Fault
141                 // Let CPU handle the fault
142                 cpu->trap(tlb_req->fault, tid);
143             } else {
144                 DPRINTF(InOrderTLB, "[tid:%i]: [sn:%i] virt. addr %08p translated
       "
145                         "to phys. addr:%08p.\n", tid, seq_num,
146                         tlb_req->memReq->getVaddr(),
147                         tlb_req->memReq->getPaddr());
148                 tlb_req->done();
149             }
150         }
151         break;
152 
153       case DataReadLookup:
154       case DataWriteLookup:
155         {
156             DPRINTF(InOrderTLB, "[tid:%i]: [sn:%i]: Attempting to translate %08p.
      \n",
157                     tid, seq_num, tlb_req->memReq->getVaddr());
158 
159 
160             TheISA::TLB::Mode tlb_mode = (tlb_req->cmd == DataReadLookup) ?
161                 TheISA::TLB::Read : TheISA::TLB::Write;
162 
163             tlb_req->fault =
164                 _tlb->translateAtomic(tlb_req->memReq,
165                                       cpu->thread[tid]->getTC(), tlb_mode);
166 
167             if (tlb_req->fault != NoFault) {
168                 DPRINTF(InOrderTLB, "[tid:%i]: %s encountered while translating "
      
169                         "addr:%08p for [sn:%i] %s.\n", tid, tlb_req->fault->name(
      ),
170                         tlb_req->memReq->getVaddr(), seq_num, inst->instName());
171 
172                 if (inst->isDataPrefetch()) {
173                     DPRINTF(InOrderTLB, "Ignoring %s fault for data prefetch\n",
174                             tlb_req->fault->name());
175 
176                     tlb_req->fault = NoFault;
177 
178                     tlb_req->done();
179                 } else {
180                     cpu->pipelineStage[stage_num]->setResStall(tlb_req, tid);
181                     tlbBlocked[tid] = true;
182                     scheduleEvent(slot_idx, 1);
183 
184                     // Let CPU handle the fault
185                     cpu->trap(tlb_req->fault, tid, inst);
186                 }
187             } else {
188                 DPRINTF(InOrderTLB, "[tid:%i]: [sn:%i] virt. addr %08p translated
       "
189                         "to phys. addr:%08p.\n", tid, seq_num,
190                         tlb_req->memReq->getVaddr(),
191                         tlb_req->memReq->getPaddr());
192                 tlb_req->done();
193             }
194         }
195         break;
196 
197       default:
198         fatal("Unrecognized command to %s", resName);
199     }
200 }
\end{DoxyCode}
\hypertarget{classTLBUnit_a98b2e8ae07f180e62be1d03beae400f9}{
\index{TLBUnit@{TLBUnit}!getRequest@{getRequest}}
\index{getRequest@{getRequest}!TLBUnit@{TLBUnit}}
\subsubsection[{getRequest}]{\setlength{\rightskip}{0pt plus 5cm}{\bf ResourceRequest} $\ast$ getRequest ({\bf DynInstPtr} {\em \_\-inst}, \/  int {\em stage\_\-num}, \/  int {\em res\_\-idx}, \/  int {\em slot\_\-num}, \/  unsigned {\em cmd})\hspace{0.3cm}{\ttfamily  \mbox{[}virtual\mbox{]}}}}
\label{classTLBUnit_a98b2e8ae07f180e62be1d03beae400f9}
\hyperlink{classRequest}{Request} usage of a resource for this instruction. If this instruction already has made this request to this resource, and that request is uncompleted this function will just return that request 

\hyperlink{classResource_aae5ce84f94a1057d7f60172daf5d731d}{Resource}を再定義しています。


\begin{DoxyCode}
97 {
98     TLBUnitRequest *tlb_req = dynamic_cast<TLBUnitRequest*>(reqs[slot_num]);
99     tlb_req->setRequest(inst, stage_num, id, slot_num, cmd);
100     return ud_req;
101 }
\end{DoxyCode}
\hypertarget{classTLBUnit_ab3ba2ee95c723c8c056db0a1f2a6dfd3}{
\index{TLBUnit@{TLBUnit}!getSlot@{getSlot}}
\index{getSlot@{getSlot}!TLBUnit@{TLBUnit}}
\subsubsection[{getSlot}]{\setlength{\rightskip}{0pt plus 5cm}int getSlot ({\bf DynInstPtr} {\em inst})\hspace{0.3cm}{\ttfamily  \mbox{[}virtual\mbox{]}}}}
\label{classTLBUnit_ab3ba2ee95c723c8c056db0a1f2a6dfd3}
Get the next available slot in this resource. Instruction is passed so that resources can check the instruction before allocating a slot if necessary. 

\hyperlink{classResource_ab3ba2ee95c723c8c056db0a1f2a6dfd3}{Resource}を再定義しています。


\begin{DoxyCode}
85 {
86     if (tlbBlocked[inst->threadNumber]) {
87         return -1;
88     } else {
89         return Resource::getSlot(inst);
90     }
91 }
\end{DoxyCode}
\hypertarget{classTLBUnit_a02fd73d861ef2e4aabb38c0c9ff82947}{
\index{TLBUnit@{TLBUnit}!init@{init}}
\index{init@{init}!TLBUnit@{TLBUnit}}
\subsubsection[{init}]{\setlength{\rightskip}{0pt plus 5cm}void init ()\hspace{0.3cm}{\ttfamily  \mbox{[}virtual\mbox{]}}}}
\label{classTLBUnit_a02fd73d861ef2e4aabb38c0c9ff82947}
Any extra initiliazation stuff can be set up using this function that should get called before the simulation starts (tick 0) 

\hyperlink{classResource_a02fd73d861ef2e4aabb38c0c9ff82947}{Resource}を再定義しています。


\begin{DoxyCode}
73 {
74     resourceEvent = new TLBUnitEvent[width];
75 
76     for (int i = 0; i < width; i++) {
77         reqs[i] = new TLBUnitRequest(this);
78     }
79 
80     initSlots();
81 }
\end{DoxyCode}
\hypertarget{classTLBUnit_a52235c5e3d912452f254dc45f1496fd2}{
\index{TLBUnit@{TLBUnit}!squash@{squash}}
\index{squash@{squash}!TLBUnit@{TLBUnit}}
\subsubsection[{squash}]{\setlength{\rightskip}{0pt plus 5cm}void squash ({\bf DynInstPtr} {\em inst}, \/  int {\em stage\_\-num}, \/  {\bf InstSeqNum} {\em squash\_\-seq\_\-num}, \/  {\bf ThreadID} {\em tid})\hspace{0.3cm}{\ttfamily  \mbox{[}virtual\mbox{]}}}}
\label{classTLBUnit_a52235c5e3d912452f254dc45f1496fd2}
Squash All Requests After This Seq Num 

\hyperlink{classResource_a52235c5e3d912452f254dc45f1496fd2}{Resource}を再定義しています。


\begin{DoxyCode}
228 {
229     for (int i = 0; i < width; i++) {
230         ResReqPtr req_ptr = reqs[i];
231 
232          if (req_ptr->valid &&
233              req_ptr->getInst()->readTid() == tid &&
234              req_ptr->getInst()->seqNum > squash_seq_num) {
235 
236              DPRINTF(Resource, "[tid:%i]: Squashing [sn:%i].\n",
237                      req_ptr->getInst()->readTid(),
238                      req_ptr->getInst()->seqNum);
239 
240              req_ptr->setSquashed();
241 
242              int req_slot_num = req_ptr->getSlot();
243 
244              tlbBlocked[tid] = false;
245 
246              int stall_stage = reqs[req_slot_num]->getStageNum();
247 
248              cpu->pipelineStage[stall_stage]->
249                  unsetResStall(reqs[req_slot_num], tid);
250 
251              if (resourceEvent[req_slot_num].scheduled())
252                  unscheduleEvent(req_slot_num);
253 
254              freeSlot(req_slot_num);
255          }
256      }
257 }
\end{DoxyCode}
\hypertarget{classTLBUnit_a3cf8b27760278d20d4aa9463f52a2d95}{
\index{TLBUnit@{TLBUnit}!tlb@{tlb}}
\index{tlb@{tlb}!TLBUnit@{TLBUnit}}
\subsubsection[{tlb}]{\setlength{\rightskip}{0pt plus 5cm}TheISA::TLB $\ast$ tlb ()}}
\label{classTLBUnit_a3cf8b27760278d20d4aa9463f52a2d95}



\begin{DoxyCode}
66 {
67     return _tlb;
68 
69 }
\end{DoxyCode}


\subsection{変数}
\hypertarget{classTLBUnit_a5aa23855b427a009f3334c95a146084b}{
\index{TLBUnit@{TLBUnit}!\_\-tlb@{\_\-tlb}}
\index{\_\-tlb@{\_\-tlb}!TLBUnit@{TLBUnit}}
\subsubsection[{\_\-tlb}]{\setlength{\rightskip}{0pt plus 5cm}TheISA::TLB$\ast$ {\bf \_\-tlb}\hspace{0.3cm}{\ttfamily  \mbox{[}protected\mbox{]}}}}
\label{classTLBUnit_a5aa23855b427a009f3334c95a146084b}
\hypertarget{classTLBUnit_ae10a391d02ce1ef67ee13cd82b7d46e5}{
\index{TLBUnit@{TLBUnit}!instList@{instList}}
\index{instList@{instList}!TLBUnit@{TLBUnit}}
\subsubsection[{instList}]{\setlength{\rightskip}{0pt plus 5cm}{\bf std::list}$<${\bf DynInstPtr}$>$ {\bf instList}\hspace{0.3cm}{\ttfamily  \mbox{[}protected\mbox{]}}}}
\label{classTLBUnit_ae10a391d02ce1ef67ee13cd82b7d46e5}
List of instructions this resource is currently processing. \hypertarget{classTLBUnit_a1e5ca2b940e91b19e93867cc549fe65d}{
\index{TLBUnit@{TLBUnit}!tlbBlocked@{tlbBlocked}}
\index{tlbBlocked@{tlbBlocked}!TLBUnit@{TLBUnit}}
\subsubsection[{tlbBlocked}]{\setlength{\rightskip}{0pt plus 5cm}bool {\bf tlbBlocked}\mbox{[}{\bf ThePipeline::MaxThreads}\mbox{]}}}
\label{classTLBUnit_a1e5ca2b940e91b19e93867cc549fe65d}


このクラスの説明は次のファイルから生成されました:\begin{DoxyCompactItemize}
\item 
cpu/inorder/resources/\hyperlink{tlb__unit_8hh}{tlb\_\-unit.hh}\item 
cpu/inorder/resources/\hyperlink{tlb__unit_8cc}{tlb\_\-unit.cc}\end{DoxyCompactItemize}
