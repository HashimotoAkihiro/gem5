\hypertarget{classPc}{
\section{クラス Pc}
\label{classPc}\index{Pc@{Pc}}
}


{\ttfamily \#include $<$pc.hh$>$}Pcに対する継承グラフ:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=4cm]{classPc}
\end{center}
\end{figure}
\subsection*{構成}
\begin{DoxyCompactItemize}
\item 
class \hyperlink{classPc_1_1Pc}{Pc}
\end{DoxyCompactItemize}
\subsection*{Public 型}
\begin{DoxyCompactItemize}
\item 
typedef PcParams \hyperlink{classPc_a3cb59bd5a1945e535ba84d5e34ad19ec}{Params}
\end{DoxyCompactItemize}
\subsection*{Public メソッド}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{classPc_a02fd73d861ef2e4aabb38c0c9ff82947}{init} ()
\item 
\hyperlink{classPc_a6186230aeb24af2fdcdb2d7881df7403}{Pc} (const \hyperlink{classPc_a3cb59bd5a1945e535ba84d5e34ad19ec}{Params} $\ast$p)
\item 
virtual void \hyperlink{classPc_a5b278cebc0a62bc2195edf27f059ab1a}{postConsoleInt} ()
\item 
virtual void \hyperlink{classPc_ad38e46034c079c8e765d3ac7eb99337d}{clearConsoleInt} ()
\item 
virtual void \hyperlink{classPc_a545d1445357706d7259aa73104f44222}{postPciInt} (int line)
\item 
virtual void \hyperlink{classPc_a0d98ea2b236bb883fa15d63a59a2ec9e}{clearPciInt} (int line)
\item 
virtual \hyperlink{base_2types_8hh_af1bb03d6a4ee096394a6749f0a169232}{Addr} \hyperlink{classPc_a87078b3d3a28ae134f6736337e90dac3}{pciToDma} (\hyperlink{base_2types_8hh_af1bb03d6a4ee096394a6749f0a169232}{Addr} pciAddr) const 
\item 
virtual \hyperlink{base_2types_8hh_af1bb03d6a4ee096394a6749f0a169232}{Addr} \hyperlink{classPc_a5b8797a83289cb5fd895c9a5dc7eae6f}{calcPciConfigAddr} (int bus, int dev, int func)
\item 
virtual \hyperlink{base_2types_8hh_af1bb03d6a4ee096394a6749f0a169232}{Addr} \hyperlink{classPc_a83afd16479598cfaeb035fd30eeedd8b}{calcPciIOAddr} (\hyperlink{base_2types_8hh_af1bb03d6a4ee096394a6749f0a169232}{Addr} addr)
\item 
virtual \hyperlink{base_2types_8hh_af1bb03d6a4ee096394a6749f0a169232}{Addr} \hyperlink{classPc_aa2acd9bf04ba56b380e7812ce29971b5}{calcPciMemAddr} (\hyperlink{base_2types_8hh_af1bb03d6a4ee096394a6749f0a169232}{Addr} addr)
\end{DoxyCompactItemize}
\subsection*{Public 変数}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classSystem}{System} $\ast$ \hyperlink{classPc_af27ccd765f13a4b7bd119dc7579e2746}{system}
\item 
\hyperlink{classSouthBridge}{SouthBridge} $\ast$ \hyperlink{classPc_adeda641729958e9bfeb6f15676275af0}{southBridge}
\end{DoxyCompactItemize}


\subsection{型定義}
\hypertarget{classPc_a3cb59bd5a1945e535ba84d5e34ad19ec}{
\index{Pc@{Pc}!Params@{Params}}
\index{Params@{Params}!Pc@{Pc}}
\subsubsection[{Params}]{\setlength{\rightskip}{0pt plus 5cm}typedef PcParams {\bf Params}}}
\label{classPc_a3cb59bd5a1945e535ba84d5e34ad19ec}


\hyperlink{classPlatform_af4e77eaf2602e4808deef7d1ba95e579}{Platform}を再定義しています。

\subsection{コンストラクタとデストラクタ}
\hypertarget{classPc_a6186230aeb24af2fdcdb2d7881df7403}{
\index{Pc@{Pc}!Pc@{Pc}}
\index{Pc@{Pc}!Pc@{Pc}}
\subsubsection[{Pc}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Pc} (const {\bf Params} $\ast$ {\em p})}}
\label{classPc_a6186230aeb24af2fdcdb2d7881df7403}



\begin{DoxyCode}
55     : Platform(p), system(p->system)
56 {
57     southBridge = NULL;
58 }
\end{DoxyCode}


\subsection{関数}
\hypertarget{classPc_a5b8797a83289cb5fd895c9a5dc7eae6f}{
\index{Pc@{Pc}!calcPciConfigAddr@{calcPciConfigAddr}}
\index{calcPciConfigAddr@{calcPciConfigAddr}!Pc@{Pc}}
\subsubsection[{calcPciConfigAddr}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Addr} calcPciConfigAddr (int {\em bus}, \/  int {\em dev}, \/  int {\em func})\hspace{0.3cm}{\ttfamily  \mbox{[}virtual\mbox{]}}}}
\label{classPc_a5b8797a83289cb5fd895c9a5dc7eae6f}
Calculate the configuration address given a bus/dev/func. 

\hyperlink{classPlatform_a4a2bdce1a8794dd3ea6ca12b36320433}{Platform}を実装しています。


\begin{DoxyCode}
152 {
153     assert(func < 8);
154     assert(dev < 32);
155     assert(bus == 0);
156     return (PhysAddrPrefixPciConfig | (func << 8) | (dev << 11));
157 }
\end{DoxyCode}
\hypertarget{classPc_a83afd16479598cfaeb035fd30eeedd8b}{
\index{Pc@{Pc}!calcPciIOAddr@{calcPciIOAddr}}
\index{calcPciIOAddr@{calcPciIOAddr}!Pc@{Pc}}
\subsubsection[{calcPciIOAddr}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Addr} calcPciIOAddr ({\bf Addr} {\em addr})\hspace{0.3cm}{\ttfamily  \mbox{[}virtual\mbox{]}}}}
\label{classPc_a83afd16479598cfaeb035fd30eeedd8b}
Calculate the address for an IO location on the PCI bus. 

\hyperlink{classPlatform_a3d1d55996e865ab1b65c732496c08b00}{Platform}を実装しています。


\begin{DoxyCode}
161 {
162     return PhysAddrPrefixIO + addr;
163 }
\end{DoxyCode}
\hypertarget{classPc_aa2acd9bf04ba56b380e7812ce29971b5}{
\index{Pc@{Pc}!calcPciMemAddr@{calcPciMemAddr}}
\index{calcPciMemAddr@{calcPciMemAddr}!Pc@{Pc}}
\subsubsection[{calcPciMemAddr}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Addr} calcPciMemAddr ({\bf Addr} {\em addr})\hspace{0.3cm}{\ttfamily  \mbox{[}virtual\mbox{]}}}}
\label{classPc_aa2acd9bf04ba56b380e7812ce29971b5}
Calculate the address for a memory location on the PCI bus. 

\hyperlink{classPlatform_a303d8161e77b31b8425cb320562a54b2}{Platform}を実装しています。


\begin{DoxyCode}
167 {
168     return addr;
169 }
\end{DoxyCode}
\hypertarget{classPc_ad38e46034c079c8e765d3ac7eb99337d}{
\index{Pc@{Pc}!clearConsoleInt@{clearConsoleInt}}
\index{clearConsoleInt@{clearConsoleInt}!Pc@{Pc}}
\subsubsection[{clearConsoleInt}]{\setlength{\rightskip}{0pt plus 5cm}void clearConsoleInt ()\hspace{0.3cm}{\ttfamily  \mbox{[}virtual\mbox{]}}}}
\label{classPc_ad38e46034c079c8e765d3ac7eb99337d}
Clear a posted CPU interrupt 

\hyperlink{classPlatform_aaf1bfcf0f5ac95c6a9d1607172a5a29e}{Platform}を実装しています。


\begin{DoxyCode}
127 {
128     warn_once("Don't know what interrupt to clear for console.\n");
129     //panic("Need implementation\n");
130 }
\end{DoxyCode}
\hypertarget{classPc_a0d98ea2b236bb883fa15d63a59a2ec9e}{
\index{Pc@{Pc}!clearPciInt@{clearPciInt}}
\index{clearPciInt@{clearPciInt}!Pc@{Pc}}
\subsubsection[{clearPciInt}]{\setlength{\rightskip}{0pt plus 5cm}void clearPciInt (int {\em line})\hspace{0.3cm}{\ttfamily  \mbox{[}virtual\mbox{]}}}}
\label{classPc_a0d98ea2b236bb883fa15d63a59a2ec9e}
Clear a posted PCI-\/$>$CPU interrupt 

\hyperlink{classPlatform_a0d98ea2b236bb883fa15d63a59a2ec9e}{Platform}を再定義しています。


\begin{DoxyCode}
140 {
141     warn_once("Tried to clear PCI interrupt %d\n", line);
142 }
\end{DoxyCode}
\hypertarget{classPc_a02fd73d861ef2e4aabb38c0c9ff82947}{
\index{Pc@{Pc}!init@{init}}
\index{init@{init}!Pc@{Pc}}
\subsubsection[{init}]{\setlength{\rightskip}{0pt plus 5cm}void init ()\hspace{0.3cm}{\ttfamily  \mbox{[}virtual\mbox{]}}}}
\label{classPc_a02fd73d861ef2e4aabb38c0c9ff82947}
Do platform initialization stuff 

\hyperlink{classSimObject_a02fd73d861ef2e4aabb38c0c9ff82947}{SimObject}を再定義しています。


\begin{DoxyCode}
62 {
63     assert(southBridge);
64 
65     /*
66      * Initialize the timer.
67      */
68     I8254 & timer = *southBridge->pit;
69     //Timer 0, mode 2, no bcd, 16 bit count
70     timer.writeControl(0x34);
71     //Timer 0, latch command
72     timer.writeControl(0x00);
73     //Write a 16 bit count of 0
74     timer.writeCounter(0, 0);
75     timer.writeCounter(0, 0);
76 
77     /*
78      * Initialize the I/O APIC.
79      */
80     I82094AA & ioApic = *southBridge->ioApic;
81     I82094AA::RedirTableEntry entry = 0;
82     entry.deliveryMode = DeliveryMode::ExtInt;
83     entry.vector = 0x20;
84     ioApic.writeReg(0x10, entry.bottomDW);
85     ioApic.writeReg(0x11, entry.topDW);
86     entry.deliveryMode = DeliveryMode::Fixed;
87     entry.vector = 0x24;
88     ioApic.writeReg(0x18, entry.bottomDW);
89     ioApic.writeReg(0x19, entry.topDW);
90     entry.mask = 1;
91     entry.vector = 0x21;
92     ioApic.writeReg(0x12, entry.bottomDW);
93     ioApic.writeReg(0x13, entry.topDW);
94     entry.vector = 0x20;
95     ioApic.writeReg(0x14, entry.bottomDW);
96     ioApic.writeReg(0x15, entry.topDW);
97     entry.vector = 0x28;
98     ioApic.writeReg(0x20, entry.bottomDW);
99     ioApic.writeReg(0x21, entry.topDW);
100     entry.vector = 0x2C;
101     ioApic.writeReg(0x28, entry.bottomDW);
102     ioApic.writeReg(0x29, entry.topDW);
103     entry.vector = 0x2E;
104     ioApic.writeReg(0x2C, entry.bottomDW);
105     ioApic.writeReg(0x2D, entry.topDW);
106     entry.vector = 0x30;
107     ioApic.writeReg(0x30, entry.bottomDW);
108     ioApic.writeReg(0x31, entry.topDW);
109 
110     /*
111      * Mask the PICs. I'm presuming the BIOS/bootloader would have cleared
112      * these out and masked them before passing control to the OS.
113      */
114     southBridge->pic1->maskAll();
115     southBridge->pic2->maskAll();
116 }
\end{DoxyCode}
\hypertarget{classPc_a87078b3d3a28ae134f6736337e90dac3}{
\index{Pc@{Pc}!pciToDma@{pciToDma}}
\index{pciToDma@{pciToDma}!Pc@{Pc}}
\subsubsection[{pciToDma}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Addr} pciToDma ({\bf Addr} {\em pciAddr}) const\hspace{0.3cm}{\ttfamily  \mbox{[}virtual\mbox{]}}}}
\label{classPc_a87078b3d3a28ae134f6736337e90dac3}


\hyperlink{classPlatform_a87078b3d3a28ae134f6736337e90dac3}{Platform}を再定義しています。


\begin{DoxyCode}
146 {
147     return pciAddr;
148 }
\end{DoxyCode}
\hypertarget{classPc_a5b278cebc0a62bc2195edf27f059ab1a}{
\index{Pc@{Pc}!postConsoleInt@{postConsoleInt}}
\index{postConsoleInt@{postConsoleInt}!Pc@{Pc}}
\subsubsection[{postConsoleInt}]{\setlength{\rightskip}{0pt plus 5cm}void postConsoleInt ()\hspace{0.3cm}{\ttfamily  \mbox{[}virtual\mbox{]}}}}
\label{classPc_a5b278cebc0a62bc2195edf27f059ab1a}
Cause the cpu to post a serial interrupt to the CPU. 

\hyperlink{classPlatform_a24ab6780a0fa391b19980027355ba467}{Platform}を実装しています。


\begin{DoxyCode}
120 {
121     southBridge->ioApic->signalInterrupt(4);
122     southBridge->pic1->signalInterrupt(4);
123 }
\end{DoxyCode}
\hypertarget{classPc_a545d1445357706d7259aa73104f44222}{
\index{Pc@{Pc}!postPciInt@{postPciInt}}
\index{postPciInt@{postPciInt}!Pc@{Pc}}
\subsubsection[{postPciInt}]{\setlength{\rightskip}{0pt plus 5cm}void postPciInt (int {\em line})\hspace{0.3cm}{\ttfamily  \mbox{[}virtual\mbox{]}}}}
\label{classPc_a545d1445357706d7259aa73104f44222}
Cause the chipset to post a pci interrupt to the CPU. 

\hyperlink{classPlatform_a545d1445357706d7259aa73104f44222}{Platform}を再定義しています。


\begin{DoxyCode}
134 {
135     southBridge->ioApic->signalInterrupt(line);
136 }
\end{DoxyCode}


\subsection{変数}
\hypertarget{classPc_adeda641729958e9bfeb6f15676275af0}{
\index{Pc@{Pc}!southBridge@{southBridge}}
\index{southBridge@{southBridge}!Pc@{Pc}}
\subsubsection[{southBridge}]{\setlength{\rightskip}{0pt plus 5cm}{\bf SouthBridge}$\ast$ {\bf southBridge}}}
\label{classPc_adeda641729958e9bfeb6f15676275af0}
\hypertarget{classPc_af27ccd765f13a4b7bd119dc7579e2746}{
\index{Pc@{Pc}!system@{system}}
\index{system@{system}!Pc@{Pc}}
\subsubsection[{system}]{\setlength{\rightskip}{0pt plus 5cm}{\bf System}$\ast$ {\bf system}}}
\label{classPc_af27ccd765f13a4b7bd119dc7579e2746}
Pointer to the system 

\hyperlink{classPlatform_af27ccd765f13a4b7bd119dc7579e2746}{Platform}を再定義しています。

このクラスの説明は次のファイルから生成されました:\begin{DoxyCompactItemize}
\item 
dev/x86/\hyperlink{pc_8hh}{pc.hh}\item 
dev/x86/\hyperlink{pc_8cc}{pc.cc}\end{DoxyCompactItemize}
