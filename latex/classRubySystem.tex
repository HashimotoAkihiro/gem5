\hypertarget{classRubySystem}{
\section{クラス RubySystem}
\label{classRubySystem}\index{RubySystem@{RubySystem}}
}


{\ttfamily \#include $<$System.hh$>$}RubySystemに対する継承グラフ:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=4cm]{classRubySystem}
\end{center}
\end{figure}
\subsection*{構成}
\begin{DoxyCompactItemize}
\item 
class \hyperlink{classRubySystem_1_1RubyEvent}{RubyEvent}
\end{DoxyCompactItemize}
\subsection*{Public 型}
\begin{DoxyCompactItemize}
\item 
typedef RubySystemParams \hyperlink{classRubySystem_af3998ceb414058e5e416b8b239698858}{Params}
\end{DoxyCompactItemize}
\subsection*{Public メソッド}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classRubySystem_a84ecac2914c133c0db81fe28405e815b}{RubySystem} (const \hyperlink{classRubySystem_af3998ceb414058e5e416b8b239698858}{Params} $\ast$p)
\item 
\hyperlink{classRubySystem_a335c948aafcd4d981ba75e02f1b33500}{$\sim$RubySystem} ()
\item 
\hyperlink{classProfiler}{Profiler} $\ast$ \hyperlink{classRubySystem_a1dc2a271b826284445c889f60c62b2fb}{getProfiler} ()
\item 
\hyperlink{classMemoryVector}{MemoryVector} $\ast$ \hyperlink{classRubySystem_aae1baebbd770dbbcf63259f5053681ea}{getMemoryVector} ()
\item 
void \hyperlink{classRubySystem_a4dc637449366fcdfc4e764cdf12d9b11}{regStats} ()
\item 
void \hyperlink{classRubySystem_a208669cbc0bb1d52565956ca8c690c55}{collateStats} ()
\item 
void \hyperlink{classRubySystem_a65880e61108132689a1bd769b9187fb7}{resetStats} ()
\item 
void \hyperlink{classRubySystem_a53e036786d17361be4c7320d39c99b84}{serialize} (std::ostream \&os)
\item 
void \hyperlink{classRubySystem_af22e5d6d660b97db37003ac61ac4ee49}{unserialize} (\hyperlink{classCheckpoint}{Checkpoint} $\ast$cp, const std::string \&section)
\item 
void \hyperlink{classRubySystem_a2e9c5136d19b1a95fc427e0852deab5c}{process} ()
\item 
void \hyperlink{classRubySystem_aecc7d8debf54990ffeaaed5bac7d7d81}{startup} ()
\item 
bool \hyperlink{classRubySystem_a9fece07bc06f16d7c5190f08e42f5359}{functionalRead} (\hyperlink{classPacket}{Packet} $\ast$ptr)
\item 
bool \hyperlink{classRubySystem_af751326b50cd1150f91ec688d9336ffc}{functionalWrite} (\hyperlink{classPacket}{Packet} $\ast$ptr)
\item 
void \hyperlink{classRubySystem_ac1a2d2ecf9164e8b3e11b461abab8521}{registerNetwork} (\hyperlink{classNetwork}{Network} $\ast$)
\item 
void \hyperlink{classRubySystem_ab7d5364ddbfcfd86ca9a47684f12c162}{registerAbstractController} (\hyperlink{classAbstractController}{AbstractController} $\ast$)
\item 
void \hyperlink{classRubySystem_a7eb79d5477e1c2026d9b1d8b6e26112b}{registerSparseMemory} (\hyperlink{classSparseMemory}{SparseMemory} $\ast$)
\item 
void \hyperlink{classRubySystem_ac9de1de608e144dd7905a56770e60bfc}{registerMemController} (\hyperlink{classMemoryControl}{MemoryControl} $\ast$mc)
\item 
bool \hyperlink{classRubySystem_a89b51bcc3a463cd78acf62b3fc66288f}{eventQueueEmpty} ()
\item 
void \hyperlink{classRubySystem_a14b5a6783cc1c4f01aef58ab8ddaf46e}{enqueueRubyEvent} (\hyperlink{base_2types_8hh_a5c8ed81b7d238c9083e1037ba6d61643}{Tick} \hyperlink{classClockedObject_a4daae57fbf09ee5423d123f5ce330e92}{tick})
\end{DoxyCompactItemize}
\subsection*{Static Public メソッド}
\begin{DoxyCompactItemize}
\item 
static int \hyperlink{classRubySystem_aed9d96608b2dca650ff1cece99ace997}{getRandomSeed} ()
\item 
static int \hyperlink{classRubySystem_a2c9e274659748daf59b6e960456cea85}{getRandomization} ()
\item 
static \hyperlink{Type_8hh_a435d1572bf3f880d55459d9805097f62}{uint32\_\-t} \hyperlink{classRubySystem_ad5726e8c9283b1447b75c3a8c67ffa75}{getBlockSizeBytes} ()
\item 
static \hyperlink{Type_8hh_a435d1572bf3f880d55459d9805097f62}{uint32\_\-t} \hyperlink{classRubySystem_a2b48f2ef758982094ea9fd3a70cf078b}{getBlockSizeBits} ()
\item 
static uint64\_\-t \hyperlink{classRubySystem_a736ae287325afa244eda540419cdd90c}{getMemorySizeBytes} ()
\item 
static \hyperlink{Type_8hh_a435d1572bf3f880d55459d9805097f62}{uint32\_\-t} \hyperlink{classRubySystem_a30259c41e1b009b45c094bccf585dab3}{getMemorySizeBits} ()
\end{DoxyCompactItemize}
\subsection*{Public 変数}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classProfiler}{Profiler} $\ast$ \hyperlink{classRubySystem_ad0e39538c0dbbe770d4c19025103b39a}{m\_\-profiler}
\item 
\hyperlink{classMemoryVector}{MemoryVector} $\ast$ \hyperlink{classRubySystem_a107b799e6f2f820a02d25dc1ba6f7014}{m\_\-mem\_\-vec}
\item 
bool \hyperlink{classRubySystem_ae9051ba7e9770f4a2be7a20f6f185e86}{m\_\-warmup\_\-enabled}
\item 
bool \hyperlink{classRubySystem_a89b41c4f399369eb42a580d0c32a7c0b}{m\_\-cooldown\_\-enabled}
\item 
\hyperlink{classCacheRecorder}{CacheRecorder} $\ast$ \hyperlink{classRubySystem_a12cc73bd44b03600f54d4ca386f7bc20}{m\_\-cache\_\-recorder}
\item 
\hyperlink{classstd_1_1vector}{std::vector}$<$ \hyperlink{classSparseMemory}{SparseMemory} $\ast$ $>$ \hyperlink{classRubySystem_a808eab8032db5c7032a0b805fbb77351}{m\_\-sparse\_\-memory\_\-vector}
\end{DoxyCompactItemize}
\subsection*{Private メソッド}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classRubySystem_a273c873452012ea56ae230db703d5c53}{RubySystem} (const \hyperlink{classRubySystem}{RubySystem} \&obj)
\item 
\hyperlink{classRubySystem}{RubySystem} \& \hyperlink{classRubySystem_a58b52a9b6b16a43dede7354145249435}{operator=} (const \hyperlink{classRubySystem}{RubySystem} \&obj)
\item 
void \hyperlink{classRubySystem_a94173d52d87090e6088f923496535c1d}{readCompressedTrace} (std::string filename, uint8\_\-t $\ast$\&raw\_\-data, \hyperlink{TypeDefines_8hh_a29940ae63ec06c9998bba873e25407ad}{uint64} \&uncompressed\_\-trace\_\-size)
\item 
void \hyperlink{classRubySystem_a158f1a4484dab34bceeee8cb54501ced}{writeCompressedTrace} (uint8\_\-t $\ast$raw\_\-data, std::string file, \hyperlink{TypeDefines_8hh_a29940ae63ec06c9998bba873e25407ad}{uint64} uncompressed\_\-trace\_\-size)
\end{DoxyCompactItemize}
\subsection*{Private 変数}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classNetwork}{Network} $\ast$ \hyperlink{classRubySystem_a9ee1ed03705a87b18e7244ead083c182}{m\_\-network}
\item 
\hyperlink{classstd_1_1vector}{std::vector}$<$ \hyperlink{classMemoryControl}{MemoryControl} $\ast$ $>$ \hyperlink{classRubySystem_a666fa896076bf9fd8b1e86b823fc36b5}{m\_\-memory\_\-controller\_\-vec}
\item 
\hyperlink{classstd_1_1vector}{std::vector}$<$ \hyperlink{classAbstractController}{AbstractController} $\ast$ $>$ \hyperlink{classRubySystem_adb7cc2941698a199e44de621cf24f868}{m\_\-abs\_\-cntrl\_\-vec}
\end{DoxyCompactItemize}
\subsection*{Static Private 変数}
\begin{DoxyCompactItemize}
\item 
static int \hyperlink{classRubySystem_af65ef68d40faf23fe1e78331e0447958}{m\_\-random\_\-seed}
\item 
static bool \hyperlink{classRubySystem_aa846ca9467116a26a879dc4b262cf36a}{m\_\-randomization}
\item 
static \hyperlink{Type_8hh_a435d1572bf3f880d55459d9805097f62}{uint32\_\-t} \hyperlink{classRubySystem_a6ffc54d275164accb6a789f59f228ee1}{m\_\-block\_\-size\_\-bytes}
\item 
static \hyperlink{Type_8hh_a435d1572bf3f880d55459d9805097f62}{uint32\_\-t} \hyperlink{classRubySystem_a138d3bdf8b6cd953f0bf8634db379365}{m\_\-block\_\-size\_\-bits}
\item 
static uint64\_\-t \hyperlink{classRubySystem_af9b18a9cc774821d72777f50821b4429}{m\_\-memory\_\-size\_\-bytes}
\item 
static \hyperlink{Type_8hh_a435d1572bf3f880d55459d9805097f62}{uint32\_\-t} \hyperlink{classRubySystem_afcfee986c39619dff25c7e96187708c0}{m\_\-memory\_\-size\_\-bits}
\end{DoxyCompactItemize}
\subsection*{フレンド}
\begin{DoxyCompactItemize}
\item 
class \hyperlink{classRubySystem_a384b2b27e44aae348fc2c459a78d4a90}{RubyEvent}
\end{DoxyCompactItemize}


\subsection{型定義}
\hypertarget{classRubySystem_af3998ceb414058e5e416b8b239698858}{
\index{RubySystem@{RubySystem}!Params@{Params}}
\index{Params@{Params}!RubySystem@{RubySystem}}
\subsubsection[{Params}]{\setlength{\rightskip}{0pt plus 5cm}typedef RubySystemParams {\bf Params}}}
\label{classRubySystem_af3998ceb414058e5e416b8b239698858}


\hyperlink{classSimObject_a0f0761d2db586a23bb2a2880b8f387bb}{SimObject}を再定義しています。

\subsection{コンストラクタとデストラクタ}
\hypertarget{classRubySystem_a84ecac2914c133c0db81fe28405e815b}{
\index{RubySystem@{RubySystem}!RubySystem@{RubySystem}}
\index{RubySystem@{RubySystem}!RubySystem@{RubySystem}}
\subsubsection[{RubySystem}]{\setlength{\rightskip}{0pt plus 5cm}{\bf RubySystem} (const {\bf Params} $\ast$ {\em p})}}
\label{classRubySystem_a84ecac2914c133c0db81fe28405e815b}



\begin{DoxyCode}
54     : ClockedObject(p)
55 {
56     if (g_system_ptr != NULL)
57         fatal("Only one RubySystem object currently allowed.\n");
58 
59     m_random_seed = p->random_seed;
60     srandom(m_random_seed);
61     m_randomization = p->randomization;
62 
63     m_block_size_bytes = p->block_size_bytes;
64     assert(isPowerOf2(m_block_size_bytes));
65     m_block_size_bits = floorLog2(m_block_size_bytes);
66 
67     m_memory_size_bytes = p->mem_size;
68     if (m_memory_size_bytes == 0) {
69         m_memory_size_bits = 0;
70     } else {
71         m_memory_size_bits = ceilLog2(m_memory_size_bytes);
72     }
73 
74     if (p->no_mem_vec) {
75         m_mem_vec = NULL;
76     } else {
77         m_mem_vec = new MemoryVector;
78         m_mem_vec->resize(m_memory_size_bytes);
79     }
80 
81     m_warmup_enabled = false;
82     m_cooldown_enabled = false;
83 
84     // Setup the global variables used in Ruby
85     g_system_ptr = this;
86 
87     // Resize to the size of different machine types
88     g_abs_controls.resize(MachineType_NUM);
89 
90     // Collate the statistics before they are printed.
91     Stats::registerDumpCallback(new RubyStatsCallback(this));
92     // Create the profiler
93     m_profiler = new Profiler(p);
94 }
\end{DoxyCode}
\hypertarget{classRubySystem_a335c948aafcd4d981ba75e02f1b33500}{
\index{RubySystem@{RubySystem}!$\sim$RubySystem@{$\sim$RubySystem}}
\index{$\sim$RubySystem@{$\sim$RubySystem}!RubySystem@{RubySystem}}
\subsubsection[{$\sim$RubySystem}]{\setlength{\rightskip}{0pt plus 5cm}$\sim${\bf RubySystem} ()}}
\label{classRubySystem_a335c948aafcd4d981ba75e02f1b33500}



\begin{DoxyCode}
123 {
124     delete m_network;
125     delete m_profiler;
126     if (m_mem_vec)
127         delete m_mem_vec;
128 }
\end{DoxyCode}
\hypertarget{classRubySystem_a273c873452012ea56ae230db703d5c53}{
\index{RubySystem@{RubySystem}!RubySystem@{RubySystem}}
\index{RubySystem@{RubySystem}!RubySystem@{RubySystem}}
\subsubsection[{RubySystem}]{\setlength{\rightskip}{0pt plus 5cm}{\bf RubySystem} (const {\bf RubySystem} \& {\em obj})\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classRubySystem_a273c873452012ea56ae230db703d5c53}


\subsection{関数}
\hypertarget{classRubySystem_a208669cbc0bb1d52565956ca8c690c55}{
\index{RubySystem@{RubySystem}!collateStats@{collateStats}}
\index{collateStats@{collateStats}!RubySystem@{RubySystem}}
\subsubsection[{collateStats}]{\setlength{\rightskip}{0pt plus 5cm}void collateStats ()\hspace{0.3cm}{\ttfamily  \mbox{[}inline\mbox{]}}}}
\label{classRubySystem_a208669cbc0bb1d52565956ca8c690c55}



\begin{DoxyCode}
98 { m_profiler->collateStats(); }
\end{DoxyCode}
\hypertarget{classRubySystem_a14b5a6783cc1c4f01aef58ab8ddaf46e}{
\index{RubySystem@{RubySystem}!enqueueRubyEvent@{enqueueRubyEvent}}
\index{enqueueRubyEvent@{enqueueRubyEvent}!RubySystem@{RubySystem}}
\subsubsection[{enqueueRubyEvent}]{\setlength{\rightskip}{0pt plus 5cm}void enqueueRubyEvent ({\bf Tick} {\em tick})\hspace{0.3cm}{\ttfamily  \mbox{[}inline\mbox{]}}}}
\label{classRubySystem_a14b5a6783cc1c4f01aef58ab8ddaf46e}



\begin{DoxyCode}
115     {
116         RubyEvent* e = new RubyEvent(this);
117         schedule(e, tick);
118     }
\end{DoxyCode}
\hypertarget{classRubySystem_a89b51bcc3a463cd78acf62b3fc66288f}{
\index{RubySystem@{RubySystem}!eventQueueEmpty@{eventQueueEmpty}}
\index{eventQueueEmpty@{eventQueueEmpty}!RubySystem@{RubySystem}}
\subsubsection[{eventQueueEmpty}]{\setlength{\rightskip}{0pt plus 5cm}bool eventQueueEmpty ()\hspace{0.3cm}{\ttfamily  \mbox{[}inline\mbox{]}}}}
\label{classRubySystem_a89b51bcc3a463cd78acf62b3fc66288f}



\begin{DoxyCode}
113 { return eventq->empty(); }
\end{DoxyCode}
\hypertarget{classRubySystem_a9fece07bc06f16d7c5190f08e42f5359}{
\index{RubySystem@{RubySystem}!functionalRead@{functionalRead}}
\index{functionalRead@{functionalRead}!RubySystem@{RubySystem}}
\subsubsection[{functionalRead}]{\setlength{\rightskip}{0pt plus 5cm}bool functionalRead ({\bf Packet} $\ast$ {\em ptr})}}
\label{classRubySystem_a9fece07bc06f16d7c5190f08e42f5359}
\hypertarget{classRubySystem_af751326b50cd1150f91ec688d9336ffc}{
\index{RubySystem@{RubySystem}!functionalWrite@{functionalWrite}}
\index{functionalWrite@{functionalWrite}!RubySystem@{RubySystem}}
\subsubsection[{functionalWrite}]{\setlength{\rightskip}{0pt plus 5cm}bool functionalWrite ({\bf Packet} $\ast$ {\em ptr})}}
\label{classRubySystem_af751326b50cd1150f91ec688d9336ffc}
\hypertarget{classRubySystem_a2b48f2ef758982094ea9fd3a70cf078b}{
\index{RubySystem@{RubySystem}!getBlockSizeBits@{getBlockSizeBits}}
\index{getBlockSizeBits@{getBlockSizeBits}!RubySystem@{RubySystem}}
\subsubsection[{getBlockSizeBits}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf uint32\_\-t} getBlockSizeBits ()\hspace{0.3cm}{\ttfamily  \mbox{[}inline, static\mbox{]}}}}
\label{classRubySystem_a2b48f2ef758982094ea9fd3a70cf078b}



\begin{DoxyCode}
78 { return m_block_size_bits; }
\end{DoxyCode}
\hypertarget{classRubySystem_ad5726e8c9283b1447b75c3a8c67ffa75}{
\index{RubySystem@{RubySystem}!getBlockSizeBytes@{getBlockSizeBytes}}
\index{getBlockSizeBytes@{getBlockSizeBytes}!RubySystem@{RubySystem}}
\subsubsection[{getBlockSizeBytes}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf uint32\_\-t} getBlockSizeBytes ()\hspace{0.3cm}{\ttfamily  \mbox{[}inline, static\mbox{]}}}}
\label{classRubySystem_ad5726e8c9283b1447b75c3a8c67ffa75}



\begin{DoxyCode}
77 { return m_block_size_bytes; }
\end{DoxyCode}
\hypertarget{classRubySystem_a30259c41e1b009b45c094bccf585dab3}{
\index{RubySystem@{RubySystem}!getMemorySizeBits@{getMemorySizeBits}}
\index{getMemorySizeBits@{getMemorySizeBits}!RubySystem@{RubySystem}}
\subsubsection[{getMemorySizeBits}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf uint32\_\-t} getMemorySizeBits ()\hspace{0.3cm}{\ttfamily  \mbox{[}inline, static\mbox{]}}}}
\label{classRubySystem_a30259c41e1b009b45c094bccf585dab3}



\begin{DoxyCode}
80 { return m_memory_size_bits; }
\end{DoxyCode}
\hypertarget{classRubySystem_a736ae287325afa244eda540419cdd90c}{
\index{RubySystem@{RubySystem}!getMemorySizeBytes@{getMemorySizeBytes}}
\index{getMemorySizeBytes@{getMemorySizeBytes}!RubySystem@{RubySystem}}
\subsubsection[{getMemorySizeBytes}]{\setlength{\rightskip}{0pt plus 5cm}static uint64\_\-t getMemorySizeBytes ()\hspace{0.3cm}{\ttfamily  \mbox{[}inline, static\mbox{]}}}}
\label{classRubySystem_a736ae287325afa244eda540419cdd90c}



\begin{DoxyCode}
79 { return m_memory_size_bytes; }
\end{DoxyCode}
\hypertarget{classRubySystem_aae1baebbd770dbbcf63259f5053681ea}{
\index{RubySystem@{RubySystem}!getMemoryVector@{getMemoryVector}}
\index{getMemoryVector@{getMemoryVector}!RubySystem@{RubySystem}}
\subsubsection[{getMemoryVector}]{\setlength{\rightskip}{0pt plus 5cm}{\bf MemoryVector}$\ast$ getMemoryVector ()\hspace{0.3cm}{\ttfamily  \mbox{[}inline\mbox{]}}}}
\label{classRubySystem_aae1baebbd770dbbcf63259f5053681ea}



\begin{DoxyCode}
92     {
93         assert(m_mem_vec != NULL);
94         return m_mem_vec;
95     }
\end{DoxyCode}
\hypertarget{classRubySystem_a1dc2a271b826284445c889f60c62b2fb}{
\index{RubySystem@{RubySystem}!getProfiler@{getProfiler}}
\index{getProfiler@{getProfiler}!RubySystem@{RubySystem}}
\subsubsection[{getProfiler}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Profiler}$\ast$ getProfiler ()\hspace{0.3cm}{\ttfamily  \mbox{[}inline\mbox{]}}}}
\label{classRubySystem_a1dc2a271b826284445c889f60c62b2fb}



\begin{DoxyCode}
85     {
86         assert(m_profiler != NULL);
87         return m_profiler;
88     }
\end{DoxyCode}
\hypertarget{classRubySystem_a2c9e274659748daf59b6e960456cea85}{
\index{RubySystem@{RubySystem}!getRandomization@{getRandomization}}
\index{getRandomization@{getRandomization}!RubySystem@{RubySystem}}
\subsubsection[{getRandomization}]{\setlength{\rightskip}{0pt plus 5cm}static int getRandomization ()\hspace{0.3cm}{\ttfamily  \mbox{[}inline, static\mbox{]}}}}
\label{classRubySystem_a2c9e274659748daf59b6e960456cea85}



\begin{DoxyCode}
76 { return m_randomization; }
\end{DoxyCode}
\hypertarget{classRubySystem_aed9d96608b2dca650ff1cece99ace997}{
\index{RubySystem@{RubySystem}!getRandomSeed@{getRandomSeed}}
\index{getRandomSeed@{getRandomSeed}!RubySystem@{RubySystem}}
\subsubsection[{getRandomSeed}]{\setlength{\rightskip}{0pt plus 5cm}static int getRandomSeed ()\hspace{0.3cm}{\ttfamily  \mbox{[}inline, static\mbox{]}}}}
\label{classRubySystem_aed9d96608b2dca650ff1cece99ace997}



\begin{DoxyCode}
75 { return m_random_seed; }
\end{DoxyCode}
\hypertarget{classRubySystem_a58b52a9b6b16a43dede7354145249435}{
\index{RubySystem@{RubySystem}!operator=@{operator=}}
\index{operator=@{operator=}!RubySystem@{RubySystem}}
\subsubsection[{operator=}]{\setlength{\rightskip}{0pt plus 5cm}{\bf RubySystem}\& operator= (const {\bf RubySystem} \& {\em obj})\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classRubySystem_a58b52a9b6b16a43dede7354145249435}
\hypertarget{classRubySystem_a2e9c5136d19b1a95fc427e0852deab5c}{
\index{RubySystem@{RubySystem}!process@{process}}
\index{process@{process}!RubySystem@{RubySystem}}
\subsubsection[{process}]{\setlength{\rightskip}{0pt plus 5cm}void process ()}}
\label{classRubySystem_a2e9c5136d19b1a95fc427e0852deab5c}
\hypertarget{classRubySystem_a94173d52d87090e6088f923496535c1d}{
\index{RubySystem@{RubySystem}!readCompressedTrace@{readCompressedTrace}}
\index{readCompressedTrace@{readCompressedTrace}!RubySystem@{RubySystem}}
\subsubsection[{readCompressedTrace}]{\setlength{\rightskip}{0pt plus 5cm}void readCompressedTrace (std::string {\em filename}, \/  uint8\_\-t $\ast$\& {\em raw\_\-data}, \/  {\bf uint64} \& {\em uncompressed\_\-trace\_\-size})\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classRubySystem_a94173d52d87090e6088f923496535c1d}
\hypertarget{classRubySystem_ab7d5364ddbfcfd86ca9a47684f12c162}{
\index{RubySystem@{RubySystem}!registerAbstractController@{registerAbstractController}}
\index{registerAbstractController@{registerAbstractController}!RubySystem@{RubySystem}}
\subsubsection[{registerAbstractController}]{\setlength{\rightskip}{0pt plus 5cm}void registerAbstractController ({\bf AbstractController} $\ast$ {\em cntrl})}}
\label{classRubySystem_ab7d5364ddbfcfd86ca9a47684f12c162}



\begin{DoxyCode}
104 {
105   m_abs_cntrl_vec.push_back(cntrl);
106 
107   MachineID id = cntrl->getMachineID();
108   g_abs_controls[id.getType()][id.getNum()] = cntrl;
109 }
\end{DoxyCode}
\hypertarget{classRubySystem_ac9de1de608e144dd7905a56770e60bfc}{
\index{RubySystem@{RubySystem}!registerMemController@{registerMemController}}
\index{registerMemController@{registerMemController}!RubySystem@{RubySystem}}
\subsubsection[{registerMemController}]{\setlength{\rightskip}{0pt plus 5cm}void registerMemController ({\bf MemoryControl} $\ast$ {\em mc})}}
\label{classRubySystem_ac9de1de608e144dd7905a56770e60bfc}



\begin{DoxyCode}
118                                                    {
119     m_memory_controller_vec.push_back(mc);
120 }
\end{DoxyCode}
\hypertarget{classRubySystem_ac1a2d2ecf9164e8b3e11b461abab8521}{
\index{RubySystem@{RubySystem}!registerNetwork@{registerNetwork}}
\index{registerNetwork@{registerNetwork}!RubySystem@{RubySystem}}
\subsubsection[{registerNetwork}]{\setlength{\rightskip}{0pt plus 5cm}void registerNetwork ({\bf Network} $\ast$ {\em network\_\-ptr})}}
\label{classRubySystem_ac1a2d2ecf9164e8b3e11b461abab8521}



\begin{DoxyCode}
98 {
99   m_network = network_ptr;
100 }
\end{DoxyCode}
\hypertarget{classRubySystem_a7eb79d5477e1c2026d9b1d8b6e26112b}{
\index{RubySystem@{RubySystem}!registerSparseMemory@{registerSparseMemory}}
\index{registerSparseMemory@{registerSparseMemory}!RubySystem@{RubySystem}}
\subsubsection[{registerSparseMemory}]{\setlength{\rightskip}{0pt plus 5cm}void registerSparseMemory ({\bf SparseMemory} $\ast$ {\em s})}}
\label{classRubySystem_a7eb79d5477e1c2026d9b1d8b6e26112b}



\begin{DoxyCode}
113 {
114     m_sparse_memory_vector.push_back(s);
115 }
\end{DoxyCode}
\hypertarget{classRubySystem_a4dc637449366fcdfc4e764cdf12d9b11}{
\index{RubySystem@{RubySystem}!regStats@{regStats}}
\index{regStats@{regStats}!RubySystem@{RubySystem}}
\subsubsection[{regStats}]{\setlength{\rightskip}{0pt plus 5cm}void regStats ()\hspace{0.3cm}{\ttfamily  \mbox{[}inline, virtual\mbox{]}}}}
\label{classRubySystem_a4dc637449366fcdfc4e764cdf12d9b11}
\hyperlink{classRegister}{Register} statistics for this object. 

\hyperlink{classSimObject_a4dc637449366fcdfc4e764cdf12d9b11}{SimObject}を再定義しています。


\begin{DoxyCode}
97 { m_profiler->regStats(name()); }
\end{DoxyCode}
\hypertarget{classRubySystem_a65880e61108132689a1bd769b9187fb7}{
\index{RubySystem@{RubySystem}!resetStats@{resetStats}}
\index{resetStats@{resetStats}!RubySystem@{RubySystem}}
\subsubsection[{resetStats}]{\setlength{\rightskip}{0pt plus 5cm}void resetStats ()\hspace{0.3cm}{\ttfamily  \mbox{[}virtual\mbox{]}}}}
\label{classRubySystem_a65880e61108132689a1bd769b9187fb7}
Reset statistics associated with this object. 

\hyperlink{classSimObject_a65880e61108132689a1bd769b9187fb7}{SimObject}を再定義しています。


\begin{DoxyCode}
404 {
405     g_ruby_start = curCycle();
406 }
\end{DoxyCode}
\hypertarget{classRubySystem_a53e036786d17361be4c7320d39c99b84}{
\index{RubySystem@{RubySystem}!serialize@{serialize}}
\index{serialize@{serialize}!RubySystem@{RubySystem}}
\subsubsection[{serialize}]{\setlength{\rightskip}{0pt plus 5cm}void serialize (std::ostream \& {\em os})\hspace{0.3cm}{\ttfamily  \mbox{[}virtual\mbox{]}}}}
\label{classRubySystem_a53e036786d17361be4c7320d39c99b84}


\hyperlink{classSerializable_ad6272f80ae37e8331e3969b3f072a801}{Serializable}を再定義しています。


\begin{DoxyCode}
161 {
162     m_cooldown_enabled = true;
163 
164     vector<Sequencer*> sequencer_map;
165     Sequencer* sequencer_ptr = NULL;
166     int cntrl_id = -1;
167 
168 
169     for (int cntrl = 0; cntrl < m_abs_cntrl_vec.size(); cntrl++) {
170         sequencer_map.push_back(m_abs_cntrl_vec[cntrl]->getSequencer());
171         if (sequencer_ptr == NULL) {
172             sequencer_ptr = sequencer_map[cntrl];
173             cntrl_id = cntrl;
174         }
175     }
176 
177     assert(sequencer_ptr != NULL);
178 
179     for (int cntrl = 0; cntrl < m_abs_cntrl_vec.size(); cntrl++) {
180         if (sequencer_map[cntrl] == NULL) {
181             sequencer_map[cntrl] = sequencer_ptr;
182         }
183     }
184 
185     // Store the cache-block size, so we are able to restore on systems with a
186     // different cache-block size. CacheRecorder depends on the correct
187     // cache-block size upon unserializing.
188     uint64 block_size_bytes = getBlockSizeBytes();
189     SERIALIZE_SCALAR(block_size_bytes);
190 
191     DPRINTF(RubyCacheTrace, "Recording Cache Trace\n");
192     // Create the CacheRecorder and record the cache trace
193     m_cache_recorder = new CacheRecorder(NULL, 0, sequencer_map,
194                                          block_size_bytes);
195 
196     for (int cntrl = 0; cntrl < m_abs_cntrl_vec.size(); cntrl++) {
197         m_abs_cntrl_vec[cntrl]->recordCacheTrace(cntrl, m_cache_recorder);
198     }
199 
200     DPRINTF(RubyCacheTrace, "Cache Trace Complete\n");
201     // save the current tick value
202     Tick curtick_original = curTick();
203     // save the event queue head
204     Event* eventq_head = eventq->replaceHead(NULL);
205     DPRINTF(RubyCacheTrace, "Recording current tick %ld and event queue\n",
206             curtick_original);
207 
208     // Schedule an event to start cache cooldown
209     DPRINTF(RubyCacheTrace, "Starting cache flush\n");
210     enqueueRubyEvent(curTick());
211     simulate();
212     DPRINTF(RubyCacheTrace, "Cache flush complete\n");
213 
214     // Restore eventq head
215     eventq_head = eventq->replaceHead(eventq_head);
216     // Restore curTick
217     setCurTick(curtick_original);
218 
219     uint8_t *raw_data = NULL;
220 
221     if (m_mem_vec != NULL) {
222         uint64 memory_trace_size = m_mem_vec->collatePages(raw_data);
223 
224         string memory_trace_file = name() + ".memory.gz";
225         writeCompressedTrace(raw_data, memory_trace_file,
226                              memory_trace_size);
227 
228         SERIALIZE_SCALAR(memory_trace_file);
229         SERIALIZE_SCALAR(memory_trace_size);
230 
231     } else {
232         for (int i = 0; i < m_sparse_memory_vector.size(); ++i) {
233             m_sparse_memory_vector[i]->recordBlocks(cntrl_id,
234                                                     m_cache_recorder);
235         }
236     }
237 
238     // Aggergate the trace entries together into a single array
239     raw_data = new uint8_t[4096];
240     uint64 cache_trace_size = m_cache_recorder->aggregateRecords(&raw_data,
241                                                                  4096);
242     string cache_trace_file = name() + ".cache.gz";
243     writeCompressedTrace(raw_data, cache_trace_file, cache_trace_size);
244 
245     SERIALIZE_SCALAR(cache_trace_file);
246     SERIALIZE_SCALAR(cache_trace_size);
247 
248     m_cooldown_enabled = false;
249 }
\end{DoxyCode}
\hypertarget{classRubySystem_aecc7d8debf54990ffeaaed5bac7d7d81}{
\index{RubySystem@{RubySystem}!startup@{startup}}
\index{startup@{startup}!RubySystem@{RubySystem}}
\subsubsection[{startup}]{\setlength{\rightskip}{0pt plus 5cm}void startup ()\hspace{0.3cm}{\ttfamily  \mbox{[}virtual\mbox{]}}}}
\label{classRubySystem_aecc7d8debf54990ffeaaed5bac7d7d81}
\hyperlink{classRubySystem_aecc7d8debf54990ffeaaed5bac7d7d81}{startup()} is the final initialization call before simulation. All state is initialized (including unserialized state, if any, such as the \hyperlink{statistics_8hh_a7acdccbf0d35ce0c159c0cdd36371b22}{curTick()} value), so this is the appropriate place to schedule initial event(s) for objects that need them. 

\hyperlink{classSimObject_aecc7d8debf54990ffeaaed5bac7d7d81}{SimObject}を再定義しています。


\begin{DoxyCode}
341 {
342 
343     // Ruby restores state from a checkpoint by resetting the clock to 0 and
344     // playing the requests that can possibly re-generate the cache state.
345     // The clock value is set to the actual checkpointed value once all the
346     // requests have been executed.
347     //
348     // This way of restoring state is pretty finicky. For example, if a
349     // Ruby component reads time before the state has been restored, it would
350     // cache this value and hence its clock would not be reset to 0, when
351     // Ruby resets the global clock. This can potentially result in a
352     // deadlock.
353     //
354     // The solution is that no Ruby component should read time before the
355     // simulation starts. And then one also needs to hope that the time
356     // Ruby finishes restoring the state is less than the time when the
357     // state was checkpointed.
358 
359     if (m_warmup_enabled) {
360         // save the current tick value
361         Tick curtick_original = curTick();
362         // save the event queue head
363         Event* eventq_head = eventq->replaceHead(NULL);
364         // set curTick to 0 and reset Ruby System's clock
365         setCurTick(0);
366         resetClock();
367 
368         // Schedule an event to start cache warmup
369         enqueueRubyEvent(curTick());
370         simulate();
371 
372         delete m_cache_recorder;
373         m_cache_recorder = NULL;
374         m_warmup_enabled = false;
375 
376         // reset DRAM so that it's not waiting for events on the old event
377         // queue
378         for (int i = 0; i < m_memory_controller_vec.size(); ++i) {
379             m_memory_controller_vec[i]->reset();
380         }
381 
382         // Restore eventq head
383         eventq_head = eventq->replaceHead(eventq_head);
384         // Restore curTick and Ruby System's clock
385         setCurTick(curtick_original);
386         resetClock();
387     }
388 
389     resetStats();
390 }
\end{DoxyCode}
\hypertarget{classRubySystem_af22e5d6d660b97db37003ac61ac4ee49}{
\index{RubySystem@{RubySystem}!unserialize@{unserialize}}
\index{unserialize@{unserialize}!RubySystem@{RubySystem}}
\subsubsection[{unserialize}]{\setlength{\rightskip}{0pt plus 5cm}void unserialize ({\bf Checkpoint} $\ast$ {\em cp}, \/  const std::string \& {\em section})\hspace{0.3cm}{\ttfamily  \mbox{[}virtual\mbox{]}}}}
\label{classRubySystem_af22e5d6d660b97db37003ac61ac4ee49}


\hyperlink{classSerializable_af100c4e9feabf3cd918619c88c718387}{Serializable}を再定義しています。\hypertarget{classRubySystem_a158f1a4484dab34bceeee8cb54501ced}{
\index{RubySystem@{RubySystem}!writeCompressedTrace@{writeCompressedTrace}}
\index{writeCompressedTrace@{writeCompressedTrace}!RubySystem@{RubySystem}}
\subsubsection[{writeCompressedTrace}]{\setlength{\rightskip}{0pt plus 5cm}void writeCompressedTrace (uint8\_\-t $\ast$ {\em raw\_\-data}, \/  std::string {\em file}, \/  {\bf uint64} {\em uncompressed\_\-trace\_\-size})\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classRubySystem_a158f1a4484dab34bceeee8cb54501ced}


\subsection{フレンドと関連する関数}
\hypertarget{classRubySystem_a384b2b27e44aae348fc2c459a78d4a90}{
\index{RubySystem@{RubySystem}!RubyEvent@{RubyEvent}}
\index{RubyEvent@{RubyEvent}!RubySystem@{RubySystem}}
\subsubsection[{RubyEvent}]{\setlength{\rightskip}{0pt plus 5cm}friend class {\bf RubyEvent}\hspace{0.3cm}{\ttfamily  \mbox{[}friend\mbox{]}}}}
\label{classRubySystem_a384b2b27e44aae348fc2c459a78d4a90}


\subsection{変数}
\hypertarget{classRubySystem_adb7cc2941698a199e44de621cf24f868}{
\index{RubySystem@{RubySystem}!m\_\-abs\_\-cntrl\_\-vec@{m\_\-abs\_\-cntrl\_\-vec}}
\index{m\_\-abs\_\-cntrl\_\-vec@{m\_\-abs\_\-cntrl\_\-vec}!RubySystem@{RubySystem}}
\subsubsection[{m\_\-abs\_\-cntrl\_\-vec}]{\setlength{\rightskip}{0pt plus 5cm}{\bf std::vector}$<${\bf AbstractController} $\ast$$>$ {\bf m\_\-abs\_\-cntrl\_\-vec}\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classRubySystem_adb7cc2941698a199e44de621cf24f868}
\hypertarget{classRubySystem_a138d3bdf8b6cd953f0bf8634db379365}{
\index{RubySystem@{RubySystem}!m\_\-block\_\-size\_\-bits@{m\_\-block\_\-size\_\-bits}}
\index{m\_\-block\_\-size\_\-bits@{m\_\-block\_\-size\_\-bits}!RubySystem@{RubySystem}}
\subsubsection[{m\_\-block\_\-size\_\-bits}]{\setlength{\rightskip}{0pt plus 5cm}{\bf uint32\_\-t} {\bf m\_\-block\_\-size\_\-bits}\hspace{0.3cm}{\ttfamily  \mbox{[}static, private\mbox{]}}}}
\label{classRubySystem_a138d3bdf8b6cd953f0bf8634db379365}
\hypertarget{classRubySystem_a6ffc54d275164accb6a789f59f228ee1}{
\index{RubySystem@{RubySystem}!m\_\-block\_\-size\_\-bytes@{m\_\-block\_\-size\_\-bytes}}
\index{m\_\-block\_\-size\_\-bytes@{m\_\-block\_\-size\_\-bytes}!RubySystem@{RubySystem}}
\subsubsection[{m\_\-block\_\-size\_\-bytes}]{\setlength{\rightskip}{0pt plus 5cm}{\bf uint32\_\-t} {\bf m\_\-block\_\-size\_\-bytes}\hspace{0.3cm}{\ttfamily  \mbox{[}static, private\mbox{]}}}}
\label{classRubySystem_a6ffc54d275164accb6a789f59f228ee1}
\hypertarget{classRubySystem_a12cc73bd44b03600f54d4ca386f7bc20}{
\index{RubySystem@{RubySystem}!m\_\-cache\_\-recorder@{m\_\-cache\_\-recorder}}
\index{m\_\-cache\_\-recorder@{m\_\-cache\_\-recorder}!RubySystem@{RubySystem}}
\subsubsection[{m\_\-cache\_\-recorder}]{\setlength{\rightskip}{0pt plus 5cm}{\bf CacheRecorder}$\ast$ {\bf m\_\-cache\_\-recorder}}}
\label{classRubySystem_a12cc73bd44b03600f54d4ca386f7bc20}
\hypertarget{classRubySystem_a89b41c4f399369eb42a580d0c32a7c0b}{
\index{RubySystem@{RubySystem}!m\_\-cooldown\_\-enabled@{m\_\-cooldown\_\-enabled}}
\index{m\_\-cooldown\_\-enabled@{m\_\-cooldown\_\-enabled}!RubySystem@{RubySystem}}
\subsubsection[{m\_\-cooldown\_\-enabled}]{\setlength{\rightskip}{0pt plus 5cm}bool {\bf m\_\-cooldown\_\-enabled}}}
\label{classRubySystem_a89b41c4f399369eb42a580d0c32a7c0b}
\hypertarget{classRubySystem_a107b799e6f2f820a02d25dc1ba6f7014}{
\index{RubySystem@{RubySystem}!m\_\-mem\_\-vec@{m\_\-mem\_\-vec}}
\index{m\_\-mem\_\-vec@{m\_\-mem\_\-vec}!RubySystem@{RubySystem}}
\subsubsection[{m\_\-mem\_\-vec}]{\setlength{\rightskip}{0pt plus 5cm}{\bf MemoryVector}$\ast$ {\bf m\_\-mem\_\-vec}}}
\label{classRubySystem_a107b799e6f2f820a02d25dc1ba6f7014}
\hypertarget{classRubySystem_a666fa896076bf9fd8b1e86b823fc36b5}{
\index{RubySystem@{RubySystem}!m\_\-memory\_\-controller\_\-vec@{m\_\-memory\_\-controller\_\-vec}}
\index{m\_\-memory\_\-controller\_\-vec@{m\_\-memory\_\-controller\_\-vec}!RubySystem@{RubySystem}}
\subsubsection[{m\_\-memory\_\-controller\_\-vec}]{\setlength{\rightskip}{0pt plus 5cm}{\bf std::vector}$<${\bf MemoryControl} $\ast$$>$ {\bf m\_\-memory\_\-controller\_\-vec}\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classRubySystem_a666fa896076bf9fd8b1e86b823fc36b5}
\hypertarget{classRubySystem_afcfee986c39619dff25c7e96187708c0}{
\index{RubySystem@{RubySystem}!m\_\-memory\_\-size\_\-bits@{m\_\-memory\_\-size\_\-bits}}
\index{m\_\-memory\_\-size\_\-bits@{m\_\-memory\_\-size\_\-bits}!RubySystem@{RubySystem}}
\subsubsection[{m\_\-memory\_\-size\_\-bits}]{\setlength{\rightskip}{0pt plus 5cm}{\bf uint32\_\-t} {\bf m\_\-memory\_\-size\_\-bits}\hspace{0.3cm}{\ttfamily  \mbox{[}static, private\mbox{]}}}}
\label{classRubySystem_afcfee986c39619dff25c7e96187708c0}
\hypertarget{classRubySystem_af9b18a9cc774821d72777f50821b4429}{
\index{RubySystem@{RubySystem}!m\_\-memory\_\-size\_\-bytes@{m\_\-memory\_\-size\_\-bytes}}
\index{m\_\-memory\_\-size\_\-bytes@{m\_\-memory\_\-size\_\-bytes}!RubySystem@{RubySystem}}
\subsubsection[{m\_\-memory\_\-size\_\-bytes}]{\setlength{\rightskip}{0pt plus 5cm}uint64\_\-t {\bf m\_\-memory\_\-size\_\-bytes}\hspace{0.3cm}{\ttfamily  \mbox{[}static, private\mbox{]}}}}
\label{classRubySystem_af9b18a9cc774821d72777f50821b4429}
\hypertarget{classRubySystem_a9ee1ed03705a87b18e7244ead083c182}{
\index{RubySystem@{RubySystem}!m\_\-network@{m\_\-network}}
\index{m\_\-network@{m\_\-network}!RubySystem@{RubySystem}}
\subsubsection[{m\_\-network}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Network}$\ast$ {\bf m\_\-network}\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classRubySystem_a9ee1ed03705a87b18e7244ead083c182}
\hypertarget{classRubySystem_ad0e39538c0dbbe770d4c19025103b39a}{
\index{RubySystem@{RubySystem}!m\_\-profiler@{m\_\-profiler}}
\index{m\_\-profiler@{m\_\-profiler}!RubySystem@{RubySystem}}
\subsubsection[{m\_\-profiler}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Profiler}$\ast$ {\bf m\_\-profiler}}}
\label{classRubySystem_ad0e39538c0dbbe770d4c19025103b39a}
\hypertarget{classRubySystem_af65ef68d40faf23fe1e78331e0447958}{
\index{RubySystem@{RubySystem}!m\_\-random\_\-seed@{m\_\-random\_\-seed}}
\index{m\_\-random\_\-seed@{m\_\-random\_\-seed}!RubySystem@{RubySystem}}
\subsubsection[{m\_\-random\_\-seed}]{\setlength{\rightskip}{0pt plus 5cm}int {\bf m\_\-random\_\-seed}\hspace{0.3cm}{\ttfamily  \mbox{[}static, private\mbox{]}}}}
\label{classRubySystem_af65ef68d40faf23fe1e78331e0447958}
\hypertarget{classRubySystem_aa846ca9467116a26a879dc4b262cf36a}{
\index{RubySystem@{RubySystem}!m\_\-randomization@{m\_\-randomization}}
\index{m\_\-randomization@{m\_\-randomization}!RubySystem@{RubySystem}}
\subsubsection[{m\_\-randomization}]{\setlength{\rightskip}{0pt plus 5cm}bool {\bf m\_\-randomization}\hspace{0.3cm}{\ttfamily  \mbox{[}static, private\mbox{]}}}}
\label{classRubySystem_aa846ca9467116a26a879dc4b262cf36a}
\hypertarget{classRubySystem_a808eab8032db5c7032a0b805fbb77351}{
\index{RubySystem@{RubySystem}!m\_\-sparse\_\-memory\_\-vector@{m\_\-sparse\_\-memory\_\-vector}}
\index{m\_\-sparse\_\-memory\_\-vector@{m\_\-sparse\_\-memory\_\-vector}!RubySystem@{RubySystem}}
\subsubsection[{m\_\-sparse\_\-memory\_\-vector}]{\setlength{\rightskip}{0pt plus 5cm}{\bf std::vector}$<${\bf SparseMemory}$\ast$$>$ {\bf m\_\-sparse\_\-memory\_\-vector}}}
\label{classRubySystem_a808eab8032db5c7032a0b805fbb77351}
\hypertarget{classRubySystem_ae9051ba7e9770f4a2be7a20f6f185e86}{
\index{RubySystem@{RubySystem}!m\_\-warmup\_\-enabled@{m\_\-warmup\_\-enabled}}
\index{m\_\-warmup\_\-enabled@{m\_\-warmup\_\-enabled}!RubySystem@{RubySystem}}
\subsubsection[{m\_\-warmup\_\-enabled}]{\setlength{\rightskip}{0pt plus 5cm}bool {\bf m\_\-warmup\_\-enabled}}}
\label{classRubySystem_ae9051ba7e9770f4a2be7a20f6f185e86}


このクラスの説明は次のファイルから生成されました:\begin{DoxyCompactItemize}
\item 
mem/ruby/system/\hyperlink{System_8hh}{System.hh}\item 
mem/ruby/system/\hyperlink{System_8cc}{System.cc}\end{DoxyCompactItemize}
