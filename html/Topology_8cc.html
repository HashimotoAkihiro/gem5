<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>File&nbsp;GEM5&nbsp;Wrapper: mem/ruby/network/Topology.cc</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- 作成： Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>メインページ</span></a></li>
      <li><a href="pages.html"><span>関連ページ</span></a></li>
      <li><a href="modules.html"><span>モジュール</span></a></li>
      <li><a href="namespaces.html"><span>ネームスペース</span></a></li>
      <li><a href="annotated.html"><span>クラス</span></a></li>
      <li class="current"><a href="files.html"><span>ファイル</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>ファイル一覧</span></a></li>
      <li><a href="globals.html"><span>ファイルメンバ</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>mem/ruby/network/Topology.cc</h1><code>#include &lt;cassert&gt;</code><br/>
<code>#include &quot;<a class="el" href="trace_8hh_source.html">base/trace.hh</a>&quot;</code><br/>
<code>#include &quot;debug/RubyNetwork.hh&quot;</code><br/>
<code>#include &quot;<a class="el" href="NetDest_8hh_source.html">mem/ruby/common/NetDest.hh</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="BasicLink_8hh_source.html">mem/ruby/network/BasicLink.hh</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="Topology_8hh_source.html">mem/ruby/network/Topology.hh</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="AbstractController_8hh_source.html">mem/ruby/slicc_interface/AbstractController.hh</a>&quot;</code><br/>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>関数</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="Topology_8cc.html#ac9730bfec6c51d328b1efb6f28f13776">extend_shortest_path</a> (<a class="el" href="classstd_1_1vector.html">Matrix</a> &amp;current_dist, <a class="el" href="classstd_1_1vector.html">Matrix</a> &amp;latencies, <a class="el" href="classstd_1_1vector.html">Matrix</a> &amp;inter_switches)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classstd_1_1vector.html">Matrix</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="Topology_8cc.html#a1171b8fbbe647907f37c781e6cd8c35a">shortest_path</a> (const <a class="el" href="classstd_1_1vector.html">Matrix</a> &amp;weights, <a class="el" href="classstd_1_1vector.html">Matrix</a> &amp;latencies, <a class="el" href="classstd_1_1vector.html">Matrix</a> &amp;inter_switches)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="Topology_8cc.html#a5682566d601544b63450eeab2272e194">link_is_shortest_path_to_node</a> (<a class="el" href="TypeDefines_8hh.html#ac925a332c83eaf1e40e056e7a20ebcd8">SwitchID</a> src, <a class="el" href="TypeDefines_8hh.html#ac925a332c83eaf1e40e056e7a20ebcd8">SwitchID</a> next, <a class="el" href="TypeDefines_8hh.html#ac925a332c83eaf1e40e056e7a20ebcd8">SwitchID</a> final, const <a class="el" href="classstd_1_1vector.html">Matrix</a> &amp;weights, const <a class="el" href="classstd_1_1vector.html">Matrix</a> &amp;dist)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classNetDest.html">NetDest</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="Topology_8cc.html#abf86316b99d59ceba03e61b8f1bdd3e3">shortest_path_to_node</a> (<a class="el" href="TypeDefines_8hh.html#ac925a332c83eaf1e40e056e7a20ebcd8">SwitchID</a> src, <a class="el" href="TypeDefines_8hh.html#ac925a332c83eaf1e40e056e7a20ebcd8">SwitchID</a> next, const <a class="el" href="classstd_1_1vector.html">Matrix</a> &amp;weights, const <a class="el" href="classstd_1_1vector.html">Matrix</a> &amp;dist)</td></tr>
<tr><td colspan="2"><h2>変数</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="Topology_8cc.html#a7992fc7fce22bc8f0a770e3bfba8c67b">INFINITE_LATENCY</a> = 10000</td></tr>
</table>
<hr/><h2>関数</h2>
<a class="anchor" id="ac9730bfec6c51d328b1efb6f28f13776"></a><!-- doxytag: member="Topology.cc::extend_shortest_path" ref="ac9730bfec6c51d328b1efb6f28f13776" args="(Matrix &amp;current_dist, Matrix &amp;latencies, Matrix &amp;inter_switches)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void extend_shortest_path </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classstd_1_1vector.html">Matrix</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>current_dist</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classstd_1_1vector.html">Matrix</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>latencies</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classstd_1_1vector.html">Matrix</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>inter_switches</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00248"></a>00248 {
<a name="l00249"></a>00249     <span class="keywordtype">bool</span> change = <span class="keyword">true</span>;
<a name="l00250"></a>00250     <span class="keywordtype">int</span> nodes = current_dist.size();
<a name="l00251"></a>00251 
<a name="l00252"></a>00252     <span class="keywordflow">while</span> (change) {
<a name="l00253"></a>00253         change = <span class="keyword">false</span>;
<a name="l00254"></a>00254         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> = 0; <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> &lt; nodes; <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>++) {
<a name="l00255"></a>00255             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespaceArmISA.html#adda8322536e2853111a71e4e2f911762">j</a> = 0; <a class="code" href="namespaceArmISA.html#adda8322536e2853111a71e4e2f911762">j</a> &lt; nodes; <a class="code" href="namespaceArmISA.html#adda8322536e2853111a71e4e2f911762">j</a>++) {
<a name="l00256"></a>00256                 <span class="keywordtype">int</span> minimum = current_dist[<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>][<a class="code" href="namespaceArmISA.html#adda8322536e2853111a71e4e2f911762">j</a>];
<a name="l00257"></a>00257                 <span class="keywordtype">int</span> previous_minimum = minimum;
<a name="l00258"></a>00258                 <span class="keywordtype">int</span> intermediate_switch = -1;
<a name="l00259"></a>00259                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespaceMipsISA.html#aef5e9ad990297740e743c7dbff9b9749">k</a> = 0; <a class="code" href="namespaceMipsISA.html#aef5e9ad990297740e743c7dbff9b9749">k</a> &lt; nodes; <a class="code" href="namespaceMipsISA.html#aef5e9ad990297740e743c7dbff9b9749">k</a>++) {
<a name="l00260"></a>00260                     minimum = min(minimum,
<a name="l00261"></a>00261                         current_dist[<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>][<a class="code" href="namespaceMipsISA.html#aef5e9ad990297740e743c7dbff9b9749">k</a>] + current_dist[<a class="code" href="namespaceMipsISA.html#aef5e9ad990297740e743c7dbff9b9749">k</a>][<a class="code" href="namespaceArmISA.html#adda8322536e2853111a71e4e2f911762">j</a>]);
<a name="l00262"></a>00262                     <span class="keywordflow">if</span> (previous_minimum != minimum) {
<a name="l00263"></a>00263                         intermediate_switch = <a class="code" href="namespaceMipsISA.html#aef5e9ad990297740e743c7dbff9b9749">k</a>;
<a name="l00264"></a>00264                         inter_switches[<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>][<a class="code" href="namespaceArmISA.html#adda8322536e2853111a71e4e2f911762">j</a>] =
<a name="l00265"></a>00265                             inter_switches[<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>][<a class="code" href="namespaceMipsISA.html#aef5e9ad990297740e743c7dbff9b9749">k</a>] +
<a name="l00266"></a>00266                             inter_switches[<a class="code" href="namespaceMipsISA.html#aef5e9ad990297740e743c7dbff9b9749">k</a>][<a class="code" href="namespaceArmISA.html#adda8322536e2853111a71e4e2f911762">j</a>] + 1;
<a name="l00267"></a>00267                     }
<a name="l00268"></a>00268                     previous_minimum = minimum;
<a name="l00269"></a>00269                 }
<a name="l00270"></a>00270                 <span class="keywordflow">if</span> (current_dist[<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>][<a class="code" href="namespaceArmISA.html#adda8322536e2853111a71e4e2f911762">j</a>] != minimum) {
<a name="l00271"></a>00271                     change = <span class="keyword">true</span>;
<a name="l00272"></a>00272                     current_dist[<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>][<a class="code" href="namespaceArmISA.html#adda8322536e2853111a71e4e2f911762">j</a>] = minimum;
<a name="l00273"></a>00273                     assert(intermediate_switch &gt;= 0);
<a name="l00274"></a>00274                     assert(intermediate_switch &lt; latencies[<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>].size());
<a name="l00275"></a>00275                     latencies[<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>][<a class="code" href="namespaceArmISA.html#adda8322536e2853111a71e4e2f911762">j</a>] = latencies[<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>][intermediate_switch] +
<a name="l00276"></a>00276                         latencies[intermediate_switch][<a class="code" href="namespaceArmISA.html#adda8322536e2853111a71e4e2f911762">j</a>];
<a name="l00277"></a>00277                 }
<a name="l00278"></a>00278             }
<a name="l00279"></a>00279         }
<a name="l00280"></a>00280     }
<a name="l00281"></a>00281 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5682566d601544b63450eeab2272e194"></a><!-- doxytag: member="Topology.cc::link_is_shortest_path_to_node" ref="a5682566d601544b63450eeab2272e194" args="(SwitchID src, SwitchID next, SwitchID final, const Matrix &amp;weights, const Matrix &amp;dist)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool link_is_shortest_path_to_node </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="TypeDefines_8hh.html#ac925a332c83eaf1e40e056e7a20ebcd8">SwitchID</a>&nbsp;</td>
          <td class="paramname"> <em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="TypeDefines_8hh.html#ac925a332c83eaf1e40e056e7a20ebcd8">SwitchID</a>&nbsp;</td>
          <td class="paramname"> <em>next</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="TypeDefines_8hh.html#ac925a332c83eaf1e40e056e7a20ebcd8">SwitchID</a>&nbsp;</td>
          <td class="paramname"> <em>final</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classstd_1_1vector.html">Matrix</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>weights</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classstd_1_1vector.html">Matrix</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>dist</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00294"></a>00294 {
<a name="l00295"></a>00295     <span class="keywordflow">return</span> weights[src][next] + dist[next][<span class="keyword">final</span>] == dist[src][<span class="keyword">final</span>];
<a name="l00296"></a>00296 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1171b8fbbe647907f37c781e6cd8c35a"></a><!-- doxytag: member="Topology.cc::shortest_path" ref="a1171b8fbbe647907f37c781e6cd8c35a" args="(const Matrix &amp;weights, Matrix &amp;latencies, Matrix &amp;inter_switches)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classstd_1_1vector.html">Matrix</a> shortest_path </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classstd_1_1vector.html">Matrix</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>weights</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classstd_1_1vector.html">Matrix</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>latencies</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classstd_1_1vector.html">Matrix</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>inter_switches</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00285"></a>00285 {
<a name="l00286"></a>00286     <a class="code" href="classstd_1_1vector.html">Matrix</a> <a class="code" href="namespaceStats.html#a25cf6f3e458aaa5fdf87fc287ef0376e">dist</a> = weights;
<a name="l00287"></a>00287     <a class="code" href="Topology_8cc.html#ac9730bfec6c51d328b1efb6f28f13776">extend_shortest_path</a>(dist, latencies, inter_switches);
<a name="l00288"></a>00288     <span class="keywordflow">return</span> dist;
<a name="l00289"></a>00289 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="abf86316b99d59ceba03e61b8f1bdd3e3"></a><!-- doxytag: member="Topology.cc::shortest_path_to_node" ref="abf86316b99d59ceba03e61b8f1bdd3e3" args="(SwitchID src, SwitchID next, const Matrix &amp;weights, const Matrix &amp;dist)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classNetDest.html">NetDest</a> shortest_path_to_node </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="TypeDefines_8hh.html#ac925a332c83eaf1e40e056e7a20ebcd8">SwitchID</a>&nbsp;</td>
          <td class="paramname"> <em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="TypeDefines_8hh.html#ac925a332c83eaf1e40e056e7a20ebcd8">SwitchID</a>&nbsp;</td>
          <td class="paramname"> <em>next</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classstd_1_1vector.html">Matrix</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>weights</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classstd_1_1vector.html">Matrix</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>dist</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00301"></a>00301 {
<a name="l00302"></a>00302     <a class="code" href="classNetDest.html">NetDest</a> result;
<a name="l00303"></a>00303     <span class="keywordtype">int</span> <a class="code" href="namespaceArmISA.html#a780d191da4f56c853452d790bddbacb1">d</a> = 0;
<a name="l00304"></a>00304     <span class="keywordtype">int</span> machines;
<a name="l00305"></a>00305     <span class="keywordtype">int</span> max_machines;
<a name="l00306"></a>00306 
<a name="l00307"></a>00307     machines = MachineType_NUM;
<a name="l00308"></a>00308     max_machines = MachineType_base_number(MachineType_NUM);
<a name="l00309"></a>00309 
<a name="l00310"></a>00310     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespaceArmISA.html#afb747b54d0c5e3e4e1763be19ca9373b">m</a> = 0; <a class="code" href="namespaceArmISA.html#afb747b54d0c5e3e4e1763be19ca9373b">m</a> &lt; machines; <a class="code" href="namespaceArmISA.html#afb747b54d0c5e3e4e1763be19ca9373b">m</a>++) {
<a name="l00311"></a>00311         <span class="keywordflow">for</span> (<a class="code" href="TypeDefines_8hh.html#a83c14b4ae37e80071f6b3506a6c46151">NodeID</a> <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> = 0; <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> &lt; MachineType_base_count((MachineType)<a class="code" href="namespaceArmISA.html#afb747b54d0c5e3e4e1763be19ca9373b">m</a>); <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>++) {
<a name="l00312"></a>00312             <span class="comment">// we use &quot;d+max_machines&quot; below since the &quot;destination&quot;</span>
<a name="l00313"></a>00313             <span class="comment">// switches for the machines are numbered</span>
<a name="l00314"></a>00314             <span class="comment">// [MachineType_base_number(MachineType_NUM)...</span>
<a name="l00315"></a>00315             <span class="comment">//  2*MachineType_base_number(MachineType_NUM)-1] for the</span>
<a name="l00316"></a>00316             <span class="comment">// component network</span>
<a name="l00317"></a>00317             <span class="keywordflow">if</span> (<a class="code" href="Topology_8cc.html#a5682566d601544b63450eeab2272e194">link_is_shortest_path_to_node</a>(src, next, d + max_machines,
<a name="l00318"></a>00318                     weights, dist)) {
<a name="l00319"></a>00319                 <a class="code" href="structMachineID.html">MachineID</a> mach = {(MachineType)<a class="code" href="namespaceArmISA.html#afb747b54d0c5e3e4e1763be19ca9373b">m</a>, <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>};
<a name="l00320"></a>00320                 result.<a class="code" href="classNetDest.html#afbaba944e1b52530702aad09dd563a79">add</a>(mach);
<a name="l00321"></a>00321             }
<a name="l00322"></a>00322             d++;
<a name="l00323"></a>00323         }
<a name="l00324"></a>00324     }
<a name="l00325"></a>00325 
<a name="l00326"></a>00326     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(RubyNetwork, <span class="stringliteral">&quot;Returning shortest path\n&quot;</span>
<a name="l00327"></a>00327             <span class="stringliteral">&quot;(src-(2*max_machines)): %d, (next-(2*max_machines)): %d, &quot;</span>
<a name="l00328"></a>00328             <span class="stringliteral">&quot;src: %d, next: %d, result: %s\n&quot;</span>,
<a name="l00329"></a>00329             (src-(2*max_machines)), (next-(2*max_machines)),
<a name="l00330"></a>00330             src, next, result);
<a name="l00331"></a>00331 
<a name="l00332"></a>00332     <span class="keywordflow">return</span> result;
<a name="l00333"></a>00333 }
</pre></div></p>

</div>
</div>
<hr/><h2>変数</h2>
<a class="anchor" id="a7992fc7fce22bc8f0a770e3bfba8c67b"></a><!-- doxytag: member="Topology.cc::INFINITE_LATENCY" ref="a7992fc7fce22bc8f0a770e3bfba8c67b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const int <a class="el" href="Topology_8cc.html#a7992fc7fce22bc8f0a770e3bfba8c67b">INFINITE_LATENCY</a> = 10000</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>File&nbsp;GEM5&nbsp;Wrapperに対して25 May 2015に生成されました。&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
