<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>File&nbsp;GEM5&nbsp;Wrapper: クラス NoncoherentBus</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- 作成： Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>メインページ</span></a></li>
      <li><a href="pages.html"><span>関連ページ</span></a></li>
      <li><a href="modules.html"><span>モジュール</span></a></li>
      <li><a href="namespaces.html"><span>ネームスペース</span></a></li>
      <li class="current"><a href="annotated.html"><span>クラス</span></a></li>
      <li><a href="files.html"><span>ファイル</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>構成</span></a></li>
      <li><a href="classes.html"><span>構成索引</span></a></li>
      <li><a href="hierarchy.html"><span>クラス階層</span></a></li>
      <li><a href="functions.html"><span>構成メンバ</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>クラス NoncoherentBus</h1><!-- doxytag: class="NoncoherentBus" --><!-- doxytag: inherits="BaseBus" -->
<p><code>#include &lt;<a class="el" href="noncoherent__bus_8hh_source.html">noncoherent_bus.hh</a>&gt;</code></p>
<div class="dynheader">
NoncoherentBusに対する継承グラフ</div>
<div class="dynsection">
 <div class="center">
  <img src="classNoncoherentBus.gif" usemap="#NoncoherentBus_map" alt=""/>
  <map id="NoncoherentBus_map" name="NoncoherentBus_map">
<area href="classBaseBus.html" alt="BaseBus" shape="rect" coords="116,224,222,248"/>
<area href="classMemObject.html" alt="MemObject" shape="rect" coords="116,168,222,192"/>
<area href="classClockedObject.html" alt="ClockedObject" shape="rect" coords="116,112,222,136"/>
<area href="classSimObject.html" alt="SimObject" shape="rect" coords="116,56,222,80"/>
<area href="classEventManager.html" alt="EventManager" shape="rect" coords="0,0,106,24"/>
<area href="classSerializable.html" alt="Serializable" shape="rect" coords="116,0,222,24"/>
<area href="classDrainable.html" alt="Drainable" shape="rect" coords="232,0,338,24"/>
</map>
 </div>
</div>

<p><a href="classNoncoherentBus-members.html">すべてのメンバ一覧</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>構成</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNoncoherentBus_1_1NoncoherentBusMasterPort.html">NoncoherentBusMasterPort</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNoncoherentBus_1_1NoncoherentBusSlavePort.html">NoncoherentBusSlavePort</a></td></tr>
<tr><td colspan="2"><h2>Public メソッド</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNoncoherentBus.html#a12760c9f0ef395e273e820a9d1db9cd9">NoncoherentBus</a> (const NoncoherentBusParams *p)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNoncoherentBus.html#a80310b44cba4493123399310722fd6e6">~NoncoherentBus</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNoncoherentBus.html#aa8a18d230dba7a674ac8a0b4f35bc36a">drain</a> (<a class="el" href="classDrainManager.html">DrainManager</a> *dm)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNoncoherentBus.html#a4dc637449366fcdfc4e764cdf12d9b11">regStats</a> ()</td></tr>
<tr><td colspan="2"><h2>Public 変数</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classStats_1_1Scalar.html">Stats::Scalar</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNoncoherentBus.html#a7040fa8d9fb24afb9f4fe245b135da19">dataThroughBus</a></td></tr>
<tr><td colspan="2"><h2>Protected 型</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef <a class="el" href="classBaseBus_1_1Layer.html">Layer</a>&lt; <a class="el" href="classSlavePort.html">SlavePort</a>, <br class="typebreak"/>
<a class="el" href="classMasterPort.html">MasterPort</a> &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNoncoherentBus.html#ae15f02c0dca186fbfbd2f7b732e5b441">ReqLayer</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef <a class="el" href="classBaseBus_1_1Layer.html">Layer</a>&lt; <a class="el" href="classMasterPort.html">MasterPort</a>, <br class="typebreak"/>
<a class="el" href="classSlavePort.html">SlavePort</a> &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNoncoherentBus.html#a40797c56ea5eaf481f56dfdc3ab1b399">RespLayer</a></td></tr>
<tr><td colspan="2"><h2>Protected メソッド</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNoncoherentBus.html#a8e2d7ccc3adb605e763f2bd1c64e5128">recvTimingReq</a> (<a class="el" href="classPacket.html">PacketPtr</a> pkt, <a class="el" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a> slave_port_id)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNoncoherentBus.html#a47ba09f9a3b3998cac9c14ab596a7515">recvTimingResp</a> (<a class="el" href="classPacket.html">PacketPtr</a> pkt, <a class="el" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a> master_port_id)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNoncoherentBus.html#a96f9cd33bfb9a8b7fb2b25078eaf75a1">recvRetry</a> (<a class="el" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a> master_port_id)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNoncoherentBus.html#ab0e34155d341f5561834eca8e4c97759">recvAtomic</a> (<a class="el" href="classPacket.html">PacketPtr</a> pkt, <a class="el" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a> slave_port_id)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNoncoherentBus.html#a5cdfa7d369ba37394403d3c2bd5cf6d1">recvFunctional</a> (<a class="el" href="classPacket.html">PacketPtr</a> pkt, <a class="el" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a> slave_port_id)</td></tr>
<tr><td colspan="2"><h2>Protected 変数</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classstd_1_1vector.html">std::vector</a>&lt; <a class="el" href="classBaseBus_1_1Layer.html">ReqLayer</a> * &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNoncoherentBus.html#ab124575386549f77de080cd9fcaf2ba0">reqLayers</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classstd_1_1vector.html">std::vector</a>&lt; <a class="el" href="classBaseBus_1_1Layer.html">RespLayer</a> * &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNoncoherentBus.html#a2f42dda70e78f1e5e9574f11b465d173">respLayers</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>説明</h2>
<p>A non-coherent bus connects a number of non-snooping masters and slaves, and routes the request and response packets based on the address. The request packets issued by the master connected to a non-coherent bus could still snoop in caches attached to a coherent bus, as is the case with the I/O bus and memory bus in most system configurations. No snoops will, however, reach any master on the non-coherent bus itself.</p>
<p>The non-coherent bus can be used as a template for modelling PCI, PCIe, and non-coherent AMBA and OCP buses, and is typically used for the I/O buses. </p>
<hr/><h2>型定義</h2>
<a class="anchor" id="ae15f02c0dca186fbfbd2f7b732e5b441"></a><!-- doxytag: member="NoncoherentBus::ReqLayer" ref="ae15f02c0dca186fbfbd2f7b732e5b441" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="classBaseBus_1_1Layer.html">Layer</a>&lt;<a class="el" href="classSlavePort.html">SlavePort</a>,<a class="el" href="classMasterPort.html">MasterPort</a>&gt; <a class="el" href="classBaseBus_1_1Layer.html">ReqLayer</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Declare the layers of this bus, one vector for requests and one for responses. </p>

</div>
</div>
<a class="anchor" id="a40797c56ea5eaf481f56dfdc3ab1b399"></a><!-- doxytag: member="NoncoherentBus::RespLayer" ref="a40797c56ea5eaf481f56dfdc3ab1b399" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="classBaseBus_1_1Layer.html">Layer</a>&lt;<a class="el" href="classMasterPort.html">MasterPort</a>,<a class="el" href="classSlavePort.html">SlavePort</a>&gt; <a class="el" href="classBaseBus_1_1Layer.html">RespLayer</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/><h2>コンストラクタとデストラクタ</h2>
<a class="anchor" id="a12760c9f0ef395e273e820a9d1db9cd9"></a><!-- doxytag: member="NoncoherentBus::NoncoherentBus" ref="a12760c9f0ef395e273e820a9d1db9cd9" args="(const NoncoherentBusParams *p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classNoncoherentBus.html">NoncoherentBus</a> </td>
          <td>(</td>
          <td class="paramtype">const NoncoherentBusParams *&nbsp;</td>
          <td class="paramname"> <em>p</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00058"></a>00058     : <a class="code" href="classBaseBus.html#aafbb881b411bf8ecd7696a6b6c9fbf5c">BaseBus</a>(<a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a>)
<a name="l00059"></a>00059 {
<a name="l00060"></a>00060     <span class="comment">// create the ports based on the size of the master and slave</span>
<a name="l00061"></a>00061     <span class="comment">// vector ports, and the presence of the default port, the ports</span>
<a name="l00062"></a>00062     <span class="comment">// are enumerated starting from zero</span>
<a name="l00063"></a>00063     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> = 0; <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> &lt; <a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a>-&gt;port_master_connection_count; ++<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>) {
<a name="l00064"></a>00064         std::string portName = <a class="code" href="cprintf_8hh.html#ace22d1c39f2df58e593bc49d1613eca2">csprintf</a>(<span class="stringliteral">&quot;%s.master[%d]&quot;</span>, <a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>(), <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>);
<a name="l00065"></a>00065         <a class="code" href="classMasterPort.html">MasterPort</a>* bp = <span class="keyword">new</span> NoncoherentBusMasterPort(portName, *<span class="keyword">this</span>, <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>);
<a name="l00066"></a>00066         <a class="code" href="classBaseBus.html#a0f7b2e1619b03085b0a28bb3216cd562">masterPorts</a>.push_back(bp);
<a name="l00067"></a>00067         <a class="code" href="classNoncoherentBus.html#ab124575386549f77de080cd9fcaf2ba0">reqLayers</a>.push_back(<span class="keyword">new</span> <a class="code" href="classNoncoherentBus.html#ae15f02c0dca186fbfbd2f7b732e5b441">ReqLayer</a>(*bp, *<span class="keyword">this</span>,
<a name="l00068"></a>00068                                          <a class="code" href="cprintf_8hh.html#ace22d1c39f2df58e593bc49d1613eca2">csprintf</a>(<span class="stringliteral">&quot;.reqLayer%d&quot;</span>, <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>)));
<a name="l00069"></a>00069     }
<a name="l00070"></a>00070 
<a name="l00071"></a>00071     <span class="comment">// see if we have a default slave device connected and if so add</span>
<a name="l00072"></a>00072     <span class="comment">// our corresponding master port</span>
<a name="l00073"></a>00073     <span class="keywordflow">if</span> (<a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a>-&gt;port_default_connection_count) {
<a name="l00074"></a>00074         <a class="code" href="classBaseBus.html#a769e7b27ddafebcc1228757f2c9ec1ba">defaultPortID</a> = <a class="code" href="classBaseBus.html#a0f7b2e1619b03085b0a28bb3216cd562">masterPorts</a>.size();
<a name="l00075"></a>00075         std::string portName = <a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>() + <span class="stringliteral">&quot;.default&quot;</span>;
<a name="l00076"></a>00076         <a class="code" href="classMasterPort.html">MasterPort</a>* bp = <span class="keyword">new</span> NoncoherentBusMasterPort(portName, *<span class="keyword">this</span>,
<a name="l00077"></a>00077                                                       <a class="code" href="classBaseBus.html#a769e7b27ddafebcc1228757f2c9ec1ba">defaultPortID</a>);
<a name="l00078"></a>00078         <a class="code" href="classBaseBus.html#a0f7b2e1619b03085b0a28bb3216cd562">masterPorts</a>.push_back(bp);
<a name="l00079"></a>00079         <a class="code" href="classNoncoherentBus.html#ab124575386549f77de080cd9fcaf2ba0">reqLayers</a>.push_back(<span class="keyword">new</span> <a class="code" href="classNoncoherentBus.html#ae15f02c0dca186fbfbd2f7b732e5b441">ReqLayer</a>(*bp, *<span class="keyword">this</span>, <a class="code" href="cprintf_8hh.html#ace22d1c39f2df58e593bc49d1613eca2">csprintf</a>(<span class="stringliteral">&quot;.reqLayer%d&quot;</span>,
<a name="l00080"></a>00080                                                               <a class="code" href="classBaseBus.html#a769e7b27ddafebcc1228757f2c9ec1ba">defaultPortID</a>)));
<a name="l00081"></a>00081     }
<a name="l00082"></a>00082 
<a name="l00083"></a>00083     <span class="comment">// create the slave ports, once again starting at zero</span>
<a name="l00084"></a>00084     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> = 0; <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> &lt; <a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a>-&gt;port_slave_connection_count; ++<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>) {
<a name="l00085"></a>00085         std::string portName = <a class="code" href="cprintf_8hh.html#ace22d1c39f2df58e593bc49d1613eca2">csprintf</a>(<span class="stringliteral">&quot;%s.slave[%d]&quot;</span>, <a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>(), <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>);
<a name="l00086"></a>00086         <a class="code" href="classSlavePort.html">SlavePort</a>* bp = <span class="keyword">new</span> NoncoherentBusSlavePort(portName, *<span class="keyword">this</span>, <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>);
<a name="l00087"></a>00087         <a class="code" href="classBaseBus.html#a9f084bf86a306772d84ad52e839cce97">slavePorts</a>.push_back(bp);
<a name="l00088"></a>00088         <a class="code" href="classNoncoherentBus.html#a2f42dda70e78f1e5e9574f11b465d173">respLayers</a>.push_back(<span class="keyword">new</span> <a class="code" href="classNoncoherentBus.html#a40797c56ea5eaf481f56dfdc3ab1b399">RespLayer</a>(*bp, *<span class="keyword">this</span>,
<a name="l00089"></a>00089                                            <a class="code" href="cprintf_8hh.html#ace22d1c39f2df58e593bc49d1613eca2">csprintf</a>(<span class="stringliteral">&quot;.respLayer%d&quot;</span>, <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>)));
<a name="l00090"></a>00090     }
<a name="l00091"></a>00091 
<a name="l00092"></a>00092     <a class="code" href="classBaseBus.html#a2b259c34a080563d0e03d5a1fec2cd7a">clearPortCache</a>();
<a name="l00093"></a>00093 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a80310b44cba4493123399310722fd6e6"></a><!-- doxytag: member="NoncoherentBus::~NoncoherentBus" ref="a80310b44cba4493123399310722fd6e6" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">~<a class="el" href="classNoncoherentBus.html">NoncoherentBus</a> </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00096"></a>00096 {
<a name="l00097"></a>00097     <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="namespaceMipsISA.html#a5818de049c10ffd7c1fea7d4dd69ed5c">l</a> = <a class="code" href="classNoncoherentBus.html#ab124575386549f77de080cd9fcaf2ba0">reqLayers</a>.begin(); <a class="code" href="namespaceMipsISA.html#a5818de049c10ffd7c1fea7d4dd69ed5c">l</a> != <a class="code" href="classNoncoherentBus.html#ab124575386549f77de080cd9fcaf2ba0">reqLayers</a>.end(); ++<a class="code" href="namespaceMipsISA.html#a5818de049c10ffd7c1fea7d4dd69ed5c">l</a>)
<a name="l00098"></a>00098         <span class="keyword">delete</span> *<a class="code" href="namespaceMipsISA.html#a5818de049c10ffd7c1fea7d4dd69ed5c">l</a>;
<a name="l00099"></a>00099     <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="namespaceMipsISA.html#a5818de049c10ffd7c1fea7d4dd69ed5c">l</a> = <a class="code" href="classNoncoherentBus.html#a2f42dda70e78f1e5e9574f11b465d173">respLayers</a>.begin(); <a class="code" href="namespaceMipsISA.html#a5818de049c10ffd7c1fea7d4dd69ed5c">l</a> != <a class="code" href="classNoncoherentBus.html#a2f42dda70e78f1e5e9574f11b465d173">respLayers</a>.end(); ++<a class="code" href="namespaceMipsISA.html#a5818de049c10ffd7c1fea7d4dd69ed5c">l</a>)
<a name="l00100"></a>00100         <span class="keyword">delete</span> *<a class="code" href="namespaceMipsISA.html#a5818de049c10ffd7c1fea7d4dd69ed5c">l</a>;
<a name="l00101"></a>00101 }
</pre></div></p>

</div>
</div>
<hr/><h2>関数</h2>
<a class="anchor" id="aa8a18d230dba7a674ac8a0b4f35bc36a"></a><!-- doxytag: member="NoncoherentBus::drain" ref="aa8a18d230dba7a674ac8a0b4f35bc36a" args="(DrainManager *dm)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int drain </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classDrainManager.html">DrainManager</a> *&nbsp;</td>
          <td class="paramname"> <em>drainManger</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Provide a default implementation of the drain interface that simply returns 0 (draining completed) and sets the drain state to Drained. </p>

<p><a class="el" href="classBaseBus.html#ac8c1510f7e1591e75a5c79b4b873f6b4">BaseBus</a>を実装しています。</p>

<p><div class="fragment"><pre class="fragment"><a name="l00268"></a>00268 {
<a name="l00269"></a>00269     <span class="comment">// sum up the individual layers</span>
<a name="l00270"></a>00270     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespaceStats.html#a4031dfee086a6a4cf1deea1fff2e0d5c">total</a> = 0;
<a name="l00271"></a>00271     <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="namespaceMipsISA.html#a5818de049c10ffd7c1fea7d4dd69ed5c">l</a> = <a class="code" href="classNoncoherentBus.html#ab124575386549f77de080cd9fcaf2ba0">reqLayers</a>.begin(); <a class="code" href="namespaceMipsISA.html#a5818de049c10ffd7c1fea7d4dd69ed5c">l</a> != <a class="code" href="classNoncoherentBus.html#ab124575386549f77de080cd9fcaf2ba0">reqLayers</a>.end(); ++<a class="code" href="namespaceMipsISA.html#a5818de049c10ffd7c1fea7d4dd69ed5c">l</a>)
<a name="l00272"></a>00272         total += (*l)-&gt;drain(<a class="code" href="namespaceMipsISA.html#a2575c29e7f4617b6076486f340b6fe19">dm</a>);
<a name="l00273"></a>00273     <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="namespaceMipsISA.html#a5818de049c10ffd7c1fea7d4dd69ed5c">l</a> = <a class="code" href="classNoncoherentBus.html#a2f42dda70e78f1e5e9574f11b465d173">respLayers</a>.begin(); <a class="code" href="namespaceMipsISA.html#a5818de049c10ffd7c1fea7d4dd69ed5c">l</a> != <a class="code" href="classNoncoherentBus.html#a2f42dda70e78f1e5e9574f11b465d173">respLayers</a>.end(); ++<a class="code" href="namespaceMipsISA.html#a5818de049c10ffd7c1fea7d4dd69ed5c">l</a>)
<a name="l00274"></a>00274         total += (*l)-&gt;drain(<a class="code" href="namespaceMipsISA.html#a2575c29e7f4617b6076486f340b6fe19">dm</a>);
<a name="l00275"></a>00275     <span class="keywordflow">return</span> total;
<a name="l00276"></a>00276 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab0e34155d341f5561834eca8e4c97759"></a><!-- doxytag: member="NoncoherentBus::recvAtomic" ref="ab0e34155d341f5561834eca8e4c97759" args="(PacketPtr pkt, PortID slave_port_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> recvAtomic </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classPacket.html">PacketPtr</a>&nbsp;</td>
          <td class="paramname"> <em>pkt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a>&nbsp;</td>
          <td class="paramname"> <em>slave_port_id</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function called by the port when the bus is recieving a Atomic transaction. </p>

<p><div class="fragment"><pre class="fragment"><a name="l00225"></a>00225 {
<a name="l00226"></a>00226     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classNoncoherentBus.html">NoncoherentBus</a>, <span class="stringliteral">&quot;recvAtomic: packet src %s addr 0x%x cmd %s\n&quot;</span>,
<a name="l00227"></a>00227             <a class="code" href="classBaseBus.html#a9f084bf86a306772d84ad52e839cce97">slavePorts</a>[slave_port_id]-&gt;<a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>(), pkt-&gt;<a class="code" href="classPacket.html#afca9af4d83a57836baba87603463a6e0">getAddr</a>(),
<a name="l00228"></a>00228             pkt-&gt;<a class="code" href="classPacket.html#a863af57e28a01258236ea303155fc7ff">cmdString</a>());
<a name="l00229"></a>00229 
<a name="l00230"></a>00230     <span class="comment">// add the request data</span>
<a name="l00231"></a>00231     <a class="code" href="classNoncoherentBus.html#a7040fa8d9fb24afb9f4fe245b135da19">dataThroughBus</a> += pkt-&gt;<a class="code" href="classPacket.html#a0effbd4cf91891700ac41e86defe4aa6">hasData</a>() ? pkt-&gt;<a class="code" href="classPacket.html#a1d18ba49c7be427da1f4a42d53e35f48">getSize</a>() : 0;
<a name="l00232"></a>00232 
<a name="l00233"></a>00233     <span class="comment">// determine the destination port</span>
<a name="l00234"></a>00234     <a class="code" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a> dest_id = <a class="code" href="classBaseBus.html#a16872a256ea6eae168abc47d498841cb">findPort</a>(pkt-&gt;<a class="code" href="classPacket.html#afca9af4d83a57836baba87603463a6e0">getAddr</a>());
<a name="l00235"></a>00235 
<a name="l00236"></a>00236     <span class="comment">// forward the request to the appropriate destination</span>
<a name="l00237"></a>00237     <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> response_latency = <a class="code" href="classBaseBus.html#a0f7b2e1619b03085b0a28bb3216cd562">masterPorts</a>[dest_id]-&gt;sendAtomic(pkt);
<a name="l00238"></a>00238 
<a name="l00239"></a>00239     <span class="comment">// add the response data</span>
<a name="l00240"></a>00240     <span class="keywordflow">if</span> (pkt-&gt;<a class="code" href="classPacket.html#a5f89a108755a6cb3e8185d85c850a816">isResponse</a>())
<a name="l00241"></a>00241         dataThroughBus += pkt-&gt;<a class="code" href="classPacket.html#a0effbd4cf91891700ac41e86defe4aa6">hasData</a>() ? pkt-&gt;<a class="code" href="classPacket.html#a1d18ba49c7be427da1f4a42d53e35f48">getSize</a>() : 0;
<a name="l00242"></a>00242 
<a name="l00243"></a>00243     <span class="comment">// @todo: Not setting first-word time</span>
<a name="l00244"></a>00244     pkt-&gt;<a class="code" href="classPacket.html#a7bf8ae0a056329f751eda8b39ca4c268">busLastWordDelay</a> = response_latency;
<a name="l00245"></a>00245     <span class="keywordflow">return</span> response_latency;
<a name="l00246"></a>00246 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5cdfa7d369ba37394403d3c2bd5cf6d1"></a><!-- doxytag: member="NoncoherentBus::recvFunctional" ref="a5cdfa7d369ba37394403d3c2bd5cf6d1" args="(PacketPtr pkt, PortID slave_port_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void recvFunctional </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classPacket.html">PacketPtr</a>&nbsp;</td>
          <td class="paramname"> <em>pkt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a>&nbsp;</td>
          <td class="paramname"> <em>slave_port_id</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function called by the port when the bus is recieving a Functional transaction. </p>

<p><div class="fragment"><pre class="fragment"><a name="l00250"></a>00250 {
<a name="l00251"></a>00251     <span class="keywordflow">if</span> (!pkt-&gt;<a class="code" href="classPacket.html#ae56bb417ddf53e85cb389267590fe969">isPrint</a>()) {
<a name="l00252"></a>00252         <span class="comment">// don&apos;t do DPRINTFs on PrintReq as it clutters up the output</span>
<a name="l00253"></a>00253         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classNoncoherentBus.html">NoncoherentBus</a>,
<a name="l00254"></a>00254                 <span class="stringliteral">&quot;recvFunctional: packet src %s addr 0x%x cmd %s\n&quot;</span>,
<a name="l00255"></a>00255                 <a class="code" href="classBaseBus.html#a9f084bf86a306772d84ad52e839cce97">slavePorts</a>[slave_port_id]-&gt;<a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>(), pkt-&gt;<a class="code" href="classPacket.html#afca9af4d83a57836baba87603463a6e0">getAddr</a>(),
<a name="l00256"></a>00256                 pkt-&gt;<a class="code" href="classPacket.html#a863af57e28a01258236ea303155fc7ff">cmdString</a>());
<a name="l00257"></a>00257     }
<a name="l00258"></a>00258 
<a name="l00259"></a>00259     <span class="comment">// determine the destination port</span>
<a name="l00260"></a>00260     <a class="code" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a> dest_id = <a class="code" href="classBaseBus.html#a16872a256ea6eae168abc47d498841cb">findPort</a>(pkt-&gt;<a class="code" href="classPacket.html#afca9af4d83a57836baba87603463a6e0">getAddr</a>());
<a name="l00261"></a>00261 
<a name="l00262"></a>00262     <span class="comment">// forward the request to the appropriate destination</span>
<a name="l00263"></a>00263     <a class="code" href="classBaseBus.html#a0f7b2e1619b03085b0a28bb3216cd562">masterPorts</a>[dest_id]-&gt;sendFunctional(pkt);
<a name="l00264"></a>00264 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a96f9cd33bfb9a8b7fb2b25078eaf75a1"></a><!-- doxytag: member="NoncoherentBus::recvRetry" ref="a96f9cd33bfb9a8b7fb2b25078eaf75a1" args="(PortID master_port_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void recvRetry </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a>&nbsp;</td>
          <td class="paramname"> <em>master_port_id</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Timing function called by port when it is once again able to process requests. </p>

<p><div class="fragment"><pre class="fragment"><a name="l00216"></a>00216 {
<a name="l00217"></a>00217     <span class="comment">// responses never block on forwarding them, so the retry will</span>
<a name="l00218"></a>00218     <span class="comment">// always be coming from a port to which we tried to forward a</span>
<a name="l00219"></a>00219     <span class="comment">// request</span>
<a name="l00220"></a>00220     <a class="code" href="classNoncoherentBus.html#ab124575386549f77de080cd9fcaf2ba0">reqLayers</a>[master_port_id]-&gt;recvRetry();
<a name="l00221"></a>00221 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8e2d7ccc3adb605e763f2bd1c64e5128"></a><!-- doxytag: member="NoncoherentBus::recvTimingReq" ref="a8e2d7ccc3adb605e763f2bd1c64e5128" args="(PacketPtr pkt, PortID slave_port_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool recvTimingReq </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classPacket.html">PacketPtr</a>&nbsp;</td>
          <td class="paramname"> <em>pkt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a>&nbsp;</td>
          <td class="paramname"> <em>slave_port_id</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function called by the port when the bus is recieving a Timing request packet. </p>

<p><div class="fragment"><pre class="fragment"><a name="l00105"></a>00105 {
<a name="l00106"></a>00106     <span class="comment">// determine the source port based on the id</span>
<a name="l00107"></a>00107     <a class="code" href="classSlavePort.html">SlavePort</a> *src_port = <a class="code" href="classBaseBus.html#a9f084bf86a306772d84ad52e839cce97">slavePorts</a>[slave_port_id];
<a name="l00108"></a>00108 
<a name="l00109"></a>00109     <span class="comment">// we should never see express snoops on a non-coherent bus</span>
<a name="l00110"></a>00110     assert(!pkt-&gt;<a class="code" href="classPacket.html#aa20026c596161a1efabde68c4a34e00b">isExpressSnoop</a>());
<a name="l00111"></a>00111 
<a name="l00112"></a>00112     <span class="comment">// determine the destination based on the address</span>
<a name="l00113"></a>00113     <a class="code" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a> master_port_id = <a class="code" href="classBaseBus.html#a16872a256ea6eae168abc47d498841cb">findPort</a>(pkt-&gt;<a class="code" href="classPacket.html#afca9af4d83a57836baba87603463a6e0">getAddr</a>());
<a name="l00114"></a>00114 
<a name="l00115"></a>00115     <span class="comment">// test if the bus should be considered occupied for the current</span>
<a name="l00116"></a>00116     <span class="comment">// port</span>
<a name="l00117"></a>00117     <span class="keywordflow">if</span> (!<a class="code" href="classNoncoherentBus.html#ab124575386549f77de080cd9fcaf2ba0">reqLayers</a>[master_port_id]-&gt;tryTiming(src_port)) {
<a name="l00118"></a>00118         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classNoncoherentBus.html">NoncoherentBus</a>, <span class="stringliteral">&quot;recvTimingReq: src %s %s 0x%x BUSY\n&quot;</span>,
<a name="l00119"></a>00119                 src_port-&gt;<a class="code" href="classPort.html#a6490f765a824ced1cc94979609fe7e07">name</a>(), pkt-&gt;<a class="code" href="classPacket.html#a863af57e28a01258236ea303155fc7ff">cmdString</a>(), pkt-&gt;<a class="code" href="classPacket.html#afca9af4d83a57836baba87603463a6e0">getAddr</a>());
<a name="l00120"></a>00120         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00121"></a>00121     }
<a name="l00122"></a>00122 
<a name="l00123"></a>00123     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classNoncoherentBus.html">NoncoherentBus</a>, <span class="stringliteral">&quot;recvTimingReq: src %s %s 0x%x\n&quot;</span>,
<a name="l00124"></a>00124             src_port-&gt;<a class="code" href="classPort.html#a6490f765a824ced1cc94979609fe7e07">name</a>(), pkt-&gt;<a class="code" href="classPacket.html#a863af57e28a01258236ea303155fc7ff">cmdString</a>(), pkt-&gt;<a class="code" href="classPacket.html#afca9af4d83a57836baba87603463a6e0">getAddr</a>());
<a name="l00125"></a>00125 
<a name="l00126"></a>00126     <span class="comment">// store size and command as they might be modified when</span>
<a name="l00127"></a>00127     <span class="comment">// forwarding the packet</span>
<a name="l00128"></a>00128     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pkt_size = pkt-&gt;<a class="code" href="classPacket.html#a0effbd4cf91891700ac41e86defe4aa6">hasData</a>() ? pkt-&gt;<a class="code" href="classPacket.html#a1d18ba49c7be427da1f4a42d53e35f48">getSize</a>() : 0;
<a name="l00129"></a>00129     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pkt_cmd = pkt-&gt;<a class="code" href="classPacket.html#a8db75870e65b9d86793f2805097c05a0" title="Return the index of this command.">cmdToIndex</a>();
<a name="l00130"></a>00130 
<a name="l00131"></a>00131     <span class="comment">// set the source port for routing of the response</span>
<a name="l00132"></a>00132     pkt-&gt;<a class="code" href="classPacket.html#a6e173cf473a751a0e969c1561a4184cc" title="Accessor function to set the source index of the packet.">setSrc</a>(slave_port_id);
<a name="l00133"></a>00133 
<a name="l00134"></a>00134     <a class="code" href="classBaseBus.html#a0e69bf0fe1b87ac59689c3807a942ee7">calcPacketTiming</a>(pkt);
<a name="l00135"></a>00135     <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> packetFinishTime = pkt-&gt;<a class="code" href="classPacket.html#a7bf8ae0a056329f751eda8b39ca4c268">busLastWordDelay</a> + <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The universal simulation clock.">curTick</a>();
<a name="l00136"></a>00136 
<a name="l00137"></a>00137     <span class="comment">// since it is a normal request, attempt to send the packet</span>
<a name="l00138"></a>00138     <span class="keywordtype">bool</span> success = <a class="code" href="classBaseBus.html#a0f7b2e1619b03085b0a28bb3216cd562">masterPorts</a>[master_port_id]-&gt;sendTimingReq(pkt);
<a name="l00139"></a>00139 
<a name="l00140"></a>00140     <span class="keywordflow">if</span> (!success)  {
<a name="l00141"></a>00141         <span class="comment">// inhibited packets should never be forced to retry</span>
<a name="l00142"></a>00142         assert(!pkt-&gt;<a class="code" href="classPacket.html#a9693a1ffeda326646443ab2a2a92be41">memInhibitAsserted</a>());
<a name="l00143"></a>00143 
<a name="l00144"></a>00144         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classNoncoherentBus.html">NoncoherentBus</a>, <span class="stringliteral">&quot;recvTimingReq: src %s %s 0x%x RETRY\n&quot;</span>,
<a name="l00145"></a>00145                 src_port-&gt;<a class="code" href="classPort.html#a6490f765a824ced1cc94979609fe7e07">name</a>(), pkt-&gt;<a class="code" href="classPacket.html#a863af57e28a01258236ea303155fc7ff">cmdString</a>(), pkt-&gt;<a class="code" href="classPacket.html#afca9af4d83a57836baba87603463a6e0">getAddr</a>());
<a name="l00146"></a>00146 
<a name="l00147"></a>00147         <span class="comment">// undo the calculation so we can check for 0 again</span>
<a name="l00148"></a>00148         pkt-&gt;<a class="code" href="classPacket.html#af8986a05caa6c5b96b0b01bb6cf47772">busFirstWordDelay</a> = pkt-&gt;<a class="code" href="classPacket.html#a7bf8ae0a056329f751eda8b39ca4c268">busLastWordDelay</a> = 0;
<a name="l00149"></a>00149 
<a name="l00150"></a>00150         <span class="comment">// occupy until the header is sent</span>
<a name="l00151"></a>00151         <a class="code" href="classNoncoherentBus.html#ab124575386549f77de080cd9fcaf2ba0">reqLayers</a>[master_port_id]-&gt;failedTiming(src_port,
<a name="l00152"></a>00152                                                 <a class="code" href="classClockedObject.html#a773956693f216cafb7d4cad92ad582e5">clockEdge</a>(<a class="code" href="classBaseBus.html#ab9c87c91aa592a3542152117cdb99c9b">headerCycles</a>));
<a name="l00153"></a>00153 
<a name="l00154"></a>00154         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00155"></a>00155     }
<a name="l00156"></a>00156 
<a name="l00157"></a>00157     <a class="code" href="classNoncoherentBus.html#ab124575386549f77de080cd9fcaf2ba0">reqLayers</a>[master_port_id]-&gt;succeededTiming(packetFinishTime);
<a name="l00158"></a>00158 
<a name="l00159"></a>00159     <span class="comment">// stats updates</span>
<a name="l00160"></a>00160     <a class="code" href="classNoncoherentBus.html#a7040fa8d9fb24afb9f4fe245b135da19">dataThroughBus</a> += pkt_size;
<a name="l00161"></a>00161     <a class="code" href="classBaseBus.html#a1444e1d672a8bfe518b9c3d05412985a">pktCount</a>[slave_port_id][master_port_id]++;
<a name="l00162"></a>00162     <a class="code" href="classBaseBus.html#a1b2222f1cfbd8c191ad8d1099fd24848">totPktSize</a>[slave_port_id][master_port_id] += pkt_size;
<a name="l00163"></a>00163     <a class="code" href="classBaseBus.html#a3eb88cd36449bb56229422858d34194d">transDist</a>[pkt_cmd]++;
<a name="l00164"></a>00164 
<a name="l00165"></a>00165     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00166"></a>00166 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a47ba09f9a3b3998cac9c14ab596a7515"></a><!-- doxytag: member="NoncoherentBus::recvTimingResp" ref="a47ba09f9a3b3998cac9c14ab596a7515" args="(PacketPtr pkt, PortID master_port_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool recvTimingResp </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classPacket.html">PacketPtr</a>&nbsp;</td>
          <td class="paramname"> <em>pkt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a>&nbsp;</td>
          <td class="paramname"> <em>master_port_id</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function called by the port when the bus is recieving a Timing response packet. </p>

<p><div class="fragment"><pre class="fragment"><a name="l00170"></a>00170 {
<a name="l00171"></a>00171     <span class="comment">// determine the source port based on the id</span>
<a name="l00172"></a>00172     <a class="code" href="classMasterPort.html">MasterPort</a> *src_port = <a class="code" href="classBaseBus.html#a0f7b2e1619b03085b0a28bb3216cd562">masterPorts</a>[master_port_id];
<a name="l00173"></a>00173 
<a name="l00174"></a>00174     <span class="comment">// determine the destination based on what is stored in the packet</span>
<a name="l00175"></a>00175     <a class="code" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a> slave_port_id = pkt-&gt;<a class="code" href="classPacket.html#a8c4564a96830dffcc13f56b716afa674" title="Accessor function for the destination index of the packet.">getDest</a>();
<a name="l00176"></a>00176 
<a name="l00177"></a>00177     <span class="comment">// test if the bus should be considered occupied for the current</span>
<a name="l00178"></a>00178     <span class="comment">// port</span>
<a name="l00179"></a>00179     <span class="keywordflow">if</span> (!<a class="code" href="classNoncoherentBus.html#a2f42dda70e78f1e5e9574f11b465d173">respLayers</a>[slave_port_id]-&gt;tryTiming(src_port)) {
<a name="l00180"></a>00180         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classNoncoherentBus.html">NoncoherentBus</a>, <span class="stringliteral">&quot;recvTimingResp: src %s %s 0x%x BUSY\n&quot;</span>,
<a name="l00181"></a>00181                 src_port-&gt;<a class="code" href="classPort.html#a6490f765a824ced1cc94979609fe7e07">name</a>(), pkt-&gt;<a class="code" href="classPacket.html#a863af57e28a01258236ea303155fc7ff">cmdString</a>(), pkt-&gt;<a class="code" href="classPacket.html#afca9af4d83a57836baba87603463a6e0">getAddr</a>());
<a name="l00182"></a>00182         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00183"></a>00183     }
<a name="l00184"></a>00184 
<a name="l00185"></a>00185     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classNoncoherentBus.html">NoncoherentBus</a>, <span class="stringliteral">&quot;recvTimingResp: src %s %s 0x%x\n&quot;</span>,
<a name="l00186"></a>00186             src_port-&gt;<a class="code" href="classPort.html#a6490f765a824ced1cc94979609fe7e07">name</a>(), pkt-&gt;<a class="code" href="classPacket.html#a863af57e28a01258236ea303155fc7ff">cmdString</a>(), pkt-&gt;<a class="code" href="classPacket.html#afca9af4d83a57836baba87603463a6e0">getAddr</a>());
<a name="l00187"></a>00187 
<a name="l00188"></a>00188     <span class="comment">// store size and command as they might be modified when</span>
<a name="l00189"></a>00189     <span class="comment">// forwarding the packet</span>
<a name="l00190"></a>00190     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pkt_size = pkt-&gt;<a class="code" href="classPacket.html#a0effbd4cf91891700ac41e86defe4aa6">hasData</a>() ? pkt-&gt;<a class="code" href="classPacket.html#a1d18ba49c7be427da1f4a42d53e35f48">getSize</a>() : 0;
<a name="l00191"></a>00191     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pkt_cmd = pkt-&gt;<a class="code" href="classPacket.html#a8db75870e65b9d86793f2805097c05a0" title="Return the index of this command.">cmdToIndex</a>();
<a name="l00192"></a>00192 
<a name="l00193"></a>00193     <a class="code" href="classBaseBus.html#a0e69bf0fe1b87ac59689c3807a942ee7">calcPacketTiming</a>(pkt);
<a name="l00194"></a>00194     <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> packetFinishTime = pkt-&gt;<a class="code" href="classPacket.html#a7bf8ae0a056329f751eda8b39ca4c268">busLastWordDelay</a> + <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The universal simulation clock.">curTick</a>();
<a name="l00195"></a>00195 
<a name="l00196"></a>00196     <span class="comment">// send the packet through the destination slave port</span>
<a name="l00197"></a>00197     <span class="keywordtype">bool</span> success M5_VAR_USED = <a class="code" href="classBaseBus.html#a9f084bf86a306772d84ad52e839cce97">slavePorts</a>[slave_port_id]-&gt;sendTimingResp(pkt);
<a name="l00198"></a>00198 
<a name="l00199"></a>00199     <span class="comment">// currently it is illegal to block responses... can lead to</span>
<a name="l00200"></a>00200     <span class="comment">// deadlock</span>
<a name="l00201"></a>00201     assert(success);
<a name="l00202"></a>00202 
<a name="l00203"></a>00203     <a class="code" href="classNoncoherentBus.html#a2f42dda70e78f1e5e9574f11b465d173">respLayers</a>[slave_port_id]-&gt;succeededTiming(packetFinishTime);
<a name="l00204"></a>00204 
<a name="l00205"></a>00205     <span class="comment">// stats updates</span>
<a name="l00206"></a>00206     <a class="code" href="classNoncoherentBus.html#a7040fa8d9fb24afb9f4fe245b135da19">dataThroughBus</a> += pkt_size;
<a name="l00207"></a>00207     <a class="code" href="classBaseBus.html#a1444e1d672a8bfe518b9c3d05412985a">pktCount</a>[slave_port_id][master_port_id]++;
<a name="l00208"></a>00208     <a class="code" href="classBaseBus.html#a1b2222f1cfbd8c191ad8d1099fd24848">totPktSize</a>[slave_port_id][master_port_id] += pkt_size;
<a name="l00209"></a>00209     <a class="code" href="classBaseBus.html#a3eb88cd36449bb56229422858d34194d">transDist</a>[pkt_cmd]++;
<a name="l00210"></a>00210 
<a name="l00211"></a>00211     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00212"></a>00212 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4dc637449366fcdfc4e764cdf12d9b11"></a><!-- doxytag: member="NoncoherentBus::regStats" ref="a4dc637449366fcdfc4e764cdf12d9b11" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void regStats </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>stats </p>

<p><a class="el" href="classBaseBus.html#a4dc637449366fcdfc4e764cdf12d9b11">BaseBus</a>を再定義しています。</p>

<p><div class="fragment"><pre class="fragment"><a name="l00286"></a>00286 {
<a name="l00287"></a>00287     <span class="comment">// register the stats of the base class and our two bus layers</span>
<a name="l00288"></a>00288     <a class="code" href="classNoncoherentBus.html#a4dc637449366fcdfc4e764cdf12d9b11">BaseBus::regStats</a>();
<a name="l00289"></a>00289     <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="namespaceMipsISA.html#a5818de049c10ffd7c1fea7d4dd69ed5c">l</a> = <a class="code" href="classNoncoherentBus.html#ab124575386549f77de080cd9fcaf2ba0">reqLayers</a>.begin(); <a class="code" href="namespaceMipsISA.html#a5818de049c10ffd7c1fea7d4dd69ed5c">l</a> != <a class="code" href="classNoncoherentBus.html#ab124575386549f77de080cd9fcaf2ba0">reqLayers</a>.end(); ++<a class="code" href="namespaceMipsISA.html#a5818de049c10ffd7c1fea7d4dd69ed5c">l</a>)
<a name="l00290"></a>00290         (*l)-&gt;regStats();
<a name="l00291"></a>00291     <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="namespaceMipsISA.html#a5818de049c10ffd7c1fea7d4dd69ed5c">l</a> = <a class="code" href="classNoncoherentBus.html#a2f42dda70e78f1e5e9574f11b465d173">respLayers</a>.begin(); <a class="code" href="namespaceMipsISA.html#a5818de049c10ffd7c1fea7d4dd69ed5c">l</a> != <a class="code" href="classNoncoherentBus.html#a2f42dda70e78f1e5e9574f11b465d173">respLayers</a>.end(); ++<a class="code" href="namespaceMipsISA.html#a5818de049c10ffd7c1fea7d4dd69ed5c">l</a>)
<a name="l00292"></a>00292         (*l)-&gt;regStats();
<a name="l00293"></a>00293 
<a name="l00294"></a>00294     <a class="code" href="classNoncoherentBus.html#a7040fa8d9fb24afb9f4fe245b135da19">dataThroughBus</a>
<a name="l00295"></a>00295         .<a class="code" href="classStats_1_1DataWrap.html#a8eaf5c2b92132dfcacd7d9b10afb1726">name</a>(<a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>() + <span class="stringliteral">&quot;.data_through_bus&quot;</span>)
<a name="l00296"></a>00296         .desc(<span class="stringliteral">&quot;Total data (bytes)&quot;</span>)
<a name="l00297"></a>00297         ;
<a name="l00298"></a>00298 
<a name="l00299"></a>00299     <a class="code" href="classBaseBus.html#ac7ddaff47c2ff8945ba85797af602673">throughput</a>
<a name="l00300"></a>00300         .<a class="code" href="classStats_1_1DataWrap.html#a8eaf5c2b92132dfcacd7d9b10afb1726">name</a>(<a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>() + <span class="stringliteral">&quot;.throughput&quot;</span>)
<a name="l00301"></a>00301         .desc(<span class="stringliteral">&quot;Throughput (bytes/s)&quot;</span>)
<a name="l00302"></a>00302         .precision(0)
<a name="l00303"></a>00303         ;
<a name="l00304"></a>00304 
<a name="l00305"></a>00305     <a class="code" href="classBaseBus.html#ac7ddaff47c2ff8945ba85797af602673">throughput</a> = <a class="code" href="classNoncoherentBus.html#a7040fa8d9fb24afb9f4fe245b135da19">dataThroughBus</a> / <a class="code" href="stat__control_8cc.html#aaad77dbb4162ef5a66c24dcd1ce256d0">simSeconds</a>;
<a name="l00306"></a>00306 }
</pre></div></p>

</div>
</div>
<hr/><h2>変数</h2>
<a class="anchor" id="a7040fa8d9fb24afb9f4fe245b135da19"></a><!-- doxytag: member="NoncoherentBus::dataThroughBus" ref="a7040fa8d9fb24afb9f4fe245b135da19" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classStats_1_1Scalar.html">Stats::Scalar</a> <a class="el" href="classNoncoherentBus.html#a7040fa8d9fb24afb9f4fe245b135da19">dataThroughBus</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ab124575386549f77de080cd9fcaf2ba0"></a><!-- doxytag: member="NoncoherentBus::reqLayers" ref="ab124575386549f77de080cd9fcaf2ba0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classstd_1_1vector.html">std::vector</a>&lt;<a class="el" href="classBaseBus_1_1Layer.html">ReqLayer</a>*&gt; <a class="el" href="classNoncoherentBus.html#ab124575386549f77de080cd9fcaf2ba0">reqLayers</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a2f42dda70e78f1e5e9574f11b465d173"></a><!-- doxytag: member="NoncoherentBus::respLayers" ref="a2f42dda70e78f1e5e9574f11b465d173" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classstd_1_1vector.html">std::vector</a>&lt;<a class="el" href="classBaseBus_1_1Layer.html">RespLayer</a>*&gt; <a class="el" href="classNoncoherentBus.html#a2f42dda70e78f1e5e9574f11b465d173">respLayers</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/>このクラスの説明は次のファイルから生成されました:<ul>
<li>mem/<a class="el" href="noncoherent__bus_8hh_source.html">noncoherent_bus.hh</a></li>
<li>mem/<a class="el" href="noncoherent__bus_8cc.html">noncoherent_bus.cc</a></li>
</ul>
</div>
<hr size="1"/><address style="text-align: right;"><small>File&nbsp;GEM5&nbsp;Wrapperに対して25 May 2015に生成されました。&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
