\hypertarget{classBranchPredictor}{
\section{クラス BranchPredictor}
\label{classBranchPredictor}\index{BranchPredictor@{BranchPredictor}}
}


{\ttfamily \#include $<$branch\_\-predictor.hh$>$}BranchPredictorに対する継承グラフ:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2cm]{classBranchPredictor}
\end{center}
\end{figure}
\subsection*{構成}
\begin{DoxyCompactItemize}
\item 
class \hyperlink{classBranchPredictor_1_1BranchPredictor}{BranchPredictor}
\end{DoxyCompactItemize}
\subsection*{Public 型}
\begin{DoxyCompactItemize}
\item 
enum \hyperlink{classBranchPredictor_a2afce0a47a93eee73a314d53e4890153}{Command} \{ \hyperlink{classBranchPredictor_a2afce0a47a93eee73a314d53e4890153aec1c2cbeee4201814af6c741b088b95e}{PredictBranch}, 
\hyperlink{classBranchPredictor_a2afce0a47a93eee73a314d53e4890153a246fdcc5483f7878e46d4f5d80789b16}{UpdatePredictor}
 \}
\item 
typedef \hyperlink{classRefCountingPtr}{ThePipeline::DynInstPtr} \hyperlink{classBranchPredictor_af9d0c8a46736ba6aa2d8bb94da1a5e73}{DynInstPtr}
\end{DoxyCompactItemize}
\subsection*{Public メソッド}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classBranchPredictor_a8df166d242ec66fcc54ae779bb1f955d}{BranchPredictor} (std::string res\_\-name, int res\_\-id, int res\_\-width, \hyperlink{classCycles}{Cycles} res\_\-latency, \hyperlink{classInOrderCPU}{InOrderCPU} $\ast$\_\-cpu, \hyperlink{namespaceThePipeline_ab62ca16eeca26566ad2422b5df4943ce}{ThePipeline::Params} $\ast$params)
\item 
void \hyperlink{classBranchPredictor_a4dc637449366fcdfc4e764cdf12d9b11}{regStats} ()
\item 
void \hyperlink{classBranchPredictor_a7b7fff82f8c9cbdb02add1346f60bb9e}{execute} (int slot\_\-num)
\item 
void \hyperlink{classBranchPredictor_a52235c5e3d912452f254dc45f1496fd2}{squash} (\hyperlink{classRefCountingPtr}{DynInstPtr} inst, int stage\_\-num, \hyperlink{inst__seq_8hh_a258d93d98edaedee089435c19ea2ea2e}{InstSeqNum} squash\_\-seq\_\-num, \hyperlink{base_2types_8hh_ab39b1a4f9dad884694c7a74ed69e6a6b}{ThreadID} tid)
\item 
void \hyperlink{classBranchPredictor_a3f5f4da90448a4c3a3c0533881fb3129}{instGraduated} (\hyperlink{inst__seq_8hh_a258d93d98edaedee089435c19ea2ea2e}{InstSeqNum} seq\_\-num, \hyperlink{base_2types_8hh_ab39b1a4f9dad884694c7a74ed69e6a6b}{ThreadID} tid)
\end{DoxyCompactItemize}
\subsection*{Protected 変数}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classBPredUnit}{BPredUnit} $\ast$ \hyperlink{classBranchPredictor_adee29d0de843b42df1f1caf92d388413}{branchPred}
\item 
int \hyperlink{classBranchPredictor_a494a9a986bc62c946604f9e9047ad237}{instSize}
\item 
\hyperlink{classStats_1_1Scalar}{Stats::Scalar} \hyperlink{classBranchPredictor_ada70fcd9e8038f515744ad60fcbb2cad}{predictedTaken}
\item 
\hyperlink{classStats_1_1Scalar}{Stats::Scalar} \hyperlink{classBranchPredictor_ae27736a1ae544674fb4449cc6d8b432c}{predictedNotTaken}
\end{DoxyCompactItemize}


\subsection{型定義}
\hypertarget{classBranchPredictor_af9d0c8a46736ba6aa2d8bb94da1a5e73}{
\index{BranchPredictor@{BranchPredictor}!DynInstPtr@{DynInstPtr}}
\index{DynInstPtr@{DynInstPtr}!BranchPredictor@{BranchPredictor}}
\subsubsection[{DynInstPtr}]{\setlength{\rightskip}{0pt plus 5cm}typedef {\bf ThePipeline::DynInstPtr} {\bf DynInstPtr}}}
\label{classBranchPredictor_af9d0c8a46736ba6aa2d8bb94da1a5e73}


\hyperlink{classResource_af9d0c8a46736ba6aa2d8bb94da1a5e73}{Resource}を再定義しています。

\subsection{列挙型}
\hypertarget{classBranchPredictor_a2afce0a47a93eee73a314d53e4890153}{
\index{BranchPredictor@{BranchPredictor}!Command@{Command}}
\index{Command@{Command}!BranchPredictor@{BranchPredictor}}
\subsubsection[{Command}]{\setlength{\rightskip}{0pt plus 5cm}enum {\bf Command}}}
\label{classBranchPredictor_a2afce0a47a93eee73a314d53e4890153}
\begin{Desc}
\item[列挙型の値: ]\par
\begin{description}
\index{PredictBranch@{PredictBranch}!BranchPredictor@{BranchPredictor}}\index{BranchPredictor@{BranchPredictor}!PredictBranch@{PredictBranch}}\item[{\em 
\hypertarget{classBranchPredictor_a2afce0a47a93eee73a314d53e4890153aec1c2cbeee4201814af6c741b088b95e}{
PredictBranch}
\label{classBranchPredictor_a2afce0a47a93eee73a314d53e4890153aec1c2cbeee4201814af6c741b088b95e}
}]\index{UpdatePredictor@{UpdatePredictor}!BranchPredictor@{BranchPredictor}}\index{BranchPredictor@{BranchPredictor}!UpdatePredictor@{UpdatePredictor}}\item[{\em 
\hypertarget{classBranchPredictor_a2afce0a47a93eee73a314d53e4890153a246fdcc5483f7878e46d4f5d80789b16}{
UpdatePredictor}
\label{classBranchPredictor_a2afce0a47a93eee73a314d53e4890153a246fdcc5483f7878e46d4f5d80789b16}
}]\end{description}
\end{Desc}




\begin{DoxyCode}
50                  {
51         PredictBranch,
52         UpdatePredictor
53     };
\end{DoxyCode}


\subsection{コンストラクタとデストラクタ}
\hypertarget{classBranchPredictor_a8df166d242ec66fcc54ae779bb1f955d}{
\index{BranchPredictor@{BranchPredictor}!BranchPredictor@{BranchPredictor}}
\index{BranchPredictor@{BranchPredictor}!BranchPredictor@{BranchPredictor}}
\subsubsection[{BranchPredictor}]{\setlength{\rightskip}{0pt plus 5cm}{\bf BranchPredictor} (std::string {\em res\_\-name}, \/  int {\em res\_\-id}, \/  int {\em res\_\-width}, \/  {\bf Cycles} {\em res\_\-latency}, \/  {\bf InOrderCPU} $\ast$ {\em \_\-cpu}, \/  {\bf ThePipeline::Params} $\ast$ {\em params})}}
\label{classBranchPredictor_a8df166d242ec66fcc54ae779bb1f955d}



\begin{DoxyCode}
46     : Resource(res_name, res_id, res_width, res_latency, _cpu),
47       branchPred(params->branchPred)
48 {
49     instSize = sizeof(MachInst);
50 }
\end{DoxyCode}


\subsection{関数}
\hypertarget{classBranchPredictor_a7b7fff82f8c9cbdb02add1346f60bb9e}{
\index{BranchPredictor@{BranchPredictor}!execute@{execute}}
\index{execute@{execute}!BranchPredictor@{BranchPredictor}}
\subsubsection[{execute}]{\setlength{\rightskip}{0pt plus 5cm}void execute (int {\em slot\_\-idx})\hspace{0.3cm}{\ttfamily  \mbox{[}virtual\mbox{]}}}}
\label{classBranchPredictor_a7b7fff82f8c9cbdb02add1346f60bb9e}
Execute the function of this resource. The Default is action is to do nothing. More specific models will derive from this class and define their own execute function. 

\hyperlink{classResource_a39af49c5568d1db3f53c12d7d6914c32}{Resource}を再定義しています。


\begin{DoxyCode}
68 {
69     ResourceRequest* bpred_req = reqs[slot_num];
70     DynInstPtr inst = bpred_req->inst;
71     if (inst->fault != NoFault) {
72         DPRINTF(InOrderBPred,
73                 "[tid:%i]: [sn:%i]: Detected %s fault @ %x. Forwarding to "
74                 "next stage.\n", inst->readTid(), inst->seqNum, inst->fault->name
      (),
75                 inst->pcState());
76         bpred_req->done();
77         return;
78     }
79 
80     if (!inst->isControl()) {
81         DPRINTF(Resource, "Ignoring %s, not a control inst.\n",
82                 inst->instName());
83         bpred_req->done();
84         return;
85     }
86 
87     ThreadID tid = inst->readTid();
88     InstSeqNum seq_num = inst->seqNum;
89     switch (bpred_req->cmd)
90     {
91       case PredictBranch:
92         {
93             if (inst->seqNum > cpu->squashSeqNum[tid] &&
94                 curTick() == cpu->lastSquashCycle[tid]) {
95                 DPRINTF(InOrderStage, "[tid:%u]: [sn:%i]: squashed, "
96                         "skipping prediction \n", tid, inst->seqNum);
97             } else {
98                 TheISA::PCState instPC = inst->pcState();
99                 TheISA::PCState pred_PC = inst->pcState();
100                 TheISA::advancePC(pred_PC, inst->staticInst);
101 
102                 if (inst->isControl()) {
103                     // If not, the pred_PC be updated to pc+8
104                     // If predicted, the pred_PC will be updated to new target
105                     // value
106                     bool predict_taken = branchPred->predictInOrder(
107                                             inst->staticInst, inst->seqNum,
108                                             inst->asid, instPC, pred_PC, tid);
109 
110                     if (predict_taken) {
111                         DPRINTF(InOrderBPred, "[tid:%i]: [sn:%i]: Branch "
112                                 "predicted true.\n", tid, seq_num);
113                         predictedTaken++;
114                     } else {
115                         DPRINTF(InOrderBPred, "[tid:%i]: [sn:%i]: Branch "
116                                 "predicted false.\n", tid, seq_num);
117                         predictedNotTaken++;
118                     }
119 
120                     inst->setBranchPred(predict_taken);
121                 }
122 
123                 //@todo: Check to see how hw_rei is handled here...how does
124                 //PC,NPC get updated to compare mispredict against???
125                 inst->setPredTarg(pred_PC);
126                 DPRINTF(InOrderBPred, "[tid:%i]: [sn:%i]: %s Predicted PC is "
127                         "%s.\n", tid, seq_num, inst->instName(), pred_PC);
128             }
129 
130             bpred_req->done();
131         }
132         break;
133 
134       case UpdatePredictor:
135         {
136             if (inst->seqNum > cpu->squashSeqNum[tid] &&
137                 curTick() == cpu->lastSquashCycle[tid]) {
138                 DPRINTF(InOrderStage, "[tid:%u]: [sn:%i]: squashed, "
139                         "skipping branch predictor update \n",
140                         tid, inst->seqNum);
141             } else {
142                 DPRINTF(InOrderBPred, "[tid:%i]: [sn:%i]: Updating "
143                         "Branch Predictor.\n",
144                         tid, seq_num);
145 
146 
147                 branchPred->update(seq_num, tid);
148             }
149 
150             bpred_req->done();
151         }
152         break;
153 
154       default:
155         fatal("Unrecognized command to %s", resName);
156     }
157 }
\end{DoxyCode}
\hypertarget{classBranchPredictor_a3f5f4da90448a4c3a3c0533881fb3129}{
\index{BranchPredictor@{BranchPredictor}!instGraduated@{instGraduated}}
\index{instGraduated@{instGraduated}!BranchPredictor@{BranchPredictor}}
\subsubsection[{instGraduated}]{\setlength{\rightskip}{0pt plus 5cm}void instGraduated ({\bf InstSeqNum} {\em seq\_\-num}, \/  {\bf ThreadID} {\em tid})\hspace{0.3cm}{\ttfamily  \mbox{[}virtual\mbox{]}}}}
\label{classBranchPredictor_a3f5f4da90448a4c3a3c0533881fb3129}
Resources that care when an instruction has been graduated can override this 

\hyperlink{classResource_ad09300971c77caba13bf59e77b99ea24}{Resource}を再定義しています。


\begin{DoxyCode}
179 {
180     branchPred->update(seq_num, tid);
181 }
\end{DoxyCode}
\hypertarget{classBranchPredictor_a4dc637449366fcdfc4e764cdf12d9b11}{
\index{BranchPredictor@{BranchPredictor}!regStats@{regStats}}
\index{regStats@{regStats}!BranchPredictor@{BranchPredictor}}
\subsubsection[{regStats}]{\setlength{\rightskip}{0pt plus 5cm}void regStats ()\hspace{0.3cm}{\ttfamily  \mbox{[}virtual\mbox{]}}}}
\label{classBranchPredictor_a4dc637449366fcdfc4e764cdf12d9b11}
\hyperlink{classRegister}{Register} \hyperlink{namespaceStats}{Stats} for this resource 

\hyperlink{classResource_ac1739a9be0fbd5d96cf441cd3b2c1c78}{Resource}を再定義しています。


\begin{DoxyCode}
54 {
55     predictedTaken
56         .name(name() + ".predictedTaken")
57         .desc("Number of Branches Predicted As Taken (True).");
58 
59     predictedNotTaken
60         .name(name() + ".predictedNotTaken")
61         .desc("Number of Branches Predicted As Not Taken (False).");
62 
63     Resource::regStats();
64 }
\end{DoxyCode}
\hypertarget{classBranchPredictor_a52235c5e3d912452f254dc45f1496fd2}{
\index{BranchPredictor@{BranchPredictor}!squash@{squash}}
\index{squash@{squash}!BranchPredictor@{BranchPredictor}}
\subsubsection[{squash}]{\setlength{\rightskip}{0pt plus 5cm}void squash ({\bf DynInstPtr} {\em inst}, \/  int {\em stage\_\-num}, \/  {\bf InstSeqNum} {\em squash\_\-seq\_\-num}, \/  {\bf ThreadID} {\em tid})\hspace{0.3cm}{\ttfamily  \mbox{[}virtual\mbox{]}}}}
\label{classBranchPredictor_a52235c5e3d912452f254dc45f1496fd2}
Squash All Requests After This Seq Num 

\hyperlink{classResource_a52235c5e3d912452f254dc45f1496fd2}{Resource}を再定義しています。


\begin{DoxyCode}
162 {
163     InstSeqNum bpred_squash_num = inst->seqNum;
164     DPRINTF(InOrderBPred, "[tid:%i][sn:%i] Squashing...\n", tid,
165             bpred_squash_num);
166 
167     // update due to branch resolution
168     if (squash_stage >= ThePipeline::BackEndStartStage) {
169         branchPred->squash(bpred_squash_num, inst->pcState(),
170                            inst->pcState().branching(), tid);
171     } else {
172     // update due to predicted taken branch
173         branchPred->squash(bpred_squash_num, tid);
174     }
175 }
\end{DoxyCode}


\subsection{変数}
\hypertarget{classBranchPredictor_adee29d0de843b42df1f1caf92d388413}{
\index{BranchPredictor@{BranchPredictor}!branchPred@{branchPred}}
\index{branchPred@{branchPred}!BranchPredictor@{BranchPredictor}}
\subsubsection[{branchPred}]{\setlength{\rightskip}{0pt plus 5cm}{\bf BPredUnit}$\ast$ {\bf branchPred}\hspace{0.3cm}{\ttfamily  \mbox{[}protected\mbox{]}}}}
\label{classBranchPredictor_adee29d0de843b42df1f1caf92d388413}
List of instructions this resource is currently processing. \hypertarget{classBranchPredictor_a494a9a986bc62c946604f9e9047ad237}{
\index{BranchPredictor@{BranchPredictor}!instSize@{instSize}}
\index{instSize@{instSize}!BranchPredictor@{BranchPredictor}}
\subsubsection[{instSize}]{\setlength{\rightskip}{0pt plus 5cm}int {\bf instSize}\hspace{0.3cm}{\ttfamily  \mbox{[}protected\mbox{]}}}}
\label{classBranchPredictor_a494a9a986bc62c946604f9e9047ad237}
\hypertarget{classBranchPredictor_ae27736a1ae544674fb4449cc6d8b432c}{
\index{BranchPredictor@{BranchPredictor}!predictedNotTaken@{predictedNotTaken}}
\index{predictedNotTaken@{predictedNotTaken}!BranchPredictor@{BranchPredictor}}
\subsubsection[{predictedNotTaken}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Stats::Scalar} {\bf predictedNotTaken}\hspace{0.3cm}{\ttfamily  \mbox{[}protected\mbox{]}}}}
\label{classBranchPredictor_ae27736a1ae544674fb4449cc6d8b432c}
\hypertarget{classBranchPredictor_ada70fcd9e8038f515744ad60fcbb2cad}{
\index{BranchPredictor@{BranchPredictor}!predictedTaken@{predictedTaken}}
\index{predictedTaken@{predictedTaken}!BranchPredictor@{BranchPredictor}}
\subsubsection[{predictedTaken}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Stats::Scalar} {\bf predictedTaken}\hspace{0.3cm}{\ttfamily  \mbox{[}protected\mbox{]}}}}
\label{classBranchPredictor_ada70fcd9e8038f515744ad60fcbb2cad}


このクラスの説明は次のファイルから生成されました:\begin{DoxyCompactItemize}
\item 
cpu/inorder/resources/\hyperlink{branch__predictor_8hh}{branch\_\-predictor.hh}\item 
cpu/inorder/resources/\hyperlink{branch__predictor_8cc}{branch\_\-predictor.cc}\end{DoxyCompactItemize}
