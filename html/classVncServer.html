<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>File&nbsp;GEM5&nbsp;Wrapper: クラス VncServer</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- 作成： Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>メインページ</span></a></li>
      <li><a href="pages.html"><span>関連ページ</span></a></li>
      <li><a href="modules.html"><span>モジュール</span></a></li>
      <li><a href="namespaces.html"><span>ネームスペース</span></a></li>
      <li class="current"><a href="annotated.html"><span>クラス</span></a></li>
      <li><a href="files.html"><span>ファイル</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>構成</span></a></li>
      <li><a href="classes.html"><span>構成索引</span></a></li>
      <li><a href="hierarchy.html"><span>クラス階層</span></a></li>
      <li><a href="functions.html"><span>構成メンバ</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>クラス VncServer</h1><!-- doxytag: class="VncServer" --><!-- doxytag: inherits="VncInput" -->
<p><code>#include &lt;<a class="el" href="vncserver_8hh_source.html">vncserver.hh</a>&gt;</code></p>
<div class="dynheader">
VncServerに対する継承グラフ</div>
<div class="dynsection">
 <div class="center">
  <img src="classVncServer.gif" usemap="#VncServer_map" alt=""/>
  <map id="VncServer_map" name="VncServer_map">
<area href="classVncInput.html" alt="VncInput" shape="rect" coords="105,112,200,136"/>
<area href="classSimObject.html" alt="SimObject" shape="rect" coords="105,56,200,80"/>
<area href="classEventManager.html" alt="EventManager" shape="rect" coords="0,0,95,24"/>
<area href="classSerializable.html" alt="Serializable" shape="rect" coords="105,0,200,24"/>
<area href="classDrainable.html" alt="Drainable" shape="rect" coords="210,0,305,24"/>
</map>
 </div>
</div>

<p><a href="classVncServer-members.html">すべてのメンバ一覧</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>構成</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classVncServer_1_1DataEvent.html">DataEvent</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structVncServer_1_1FrameBufferRect.html">FrameBufferRect</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structVncServer_1_1FrameBufferUpdate.html">FrameBufferUpdate</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classVncServer_1_1ListenEvent.html">ListenEvent</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structVncServer_1_1ServerCutText.html">ServerCutText</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structVncServer_1_1ServerInitMsg.html">ServerInitMsg</a></td></tr>
<tr><td colspan="2"><h2>Public 型</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__VncConstants.html#ga98f897c5a38e76e2cc7fea4d87083a84">ServerMessages</a> { <a class="el" href="group__VncConstants.html#gga98f897c5a38e76e2cc7fea4d87083a84afb5f87db0a4610309f486463de5388b7">ServerFrameBufferUpdate</a> =  0, 
<a class="el" href="group__VncConstants.html#gga98f897c5a38e76e2cc7fea4d87083a84aba175e2ce5c7225c9945f1e133857c07">ServerSetColorMapEntries</a> =  1, 
<a class="el" href="group__VncConstants.html#gga98f897c5a38e76e2cc7fea4d87083a84a32aadc1d2674e65c0f598a2727945b8d">ServerBell</a> =  2, 
<a class="el" href="group__VncConstants.html#gga98f897c5a38e76e2cc7fea4d87083a84ad80502eb07cc53ade0e84460d0c39e7c">ServerCutText</a> =  3
 }</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__VncConstants.html#ga0b9039f87c8a2980c4a6ab14b511760a">EncodingTypes</a> { <a class="el" href="group__VncConstants.html#gga0b9039f87c8a2980c4a6ab14b511760aa2929e8976a78e5a5e8829beae2a7e69e">EncodingRaw</a> =  0, 
<a class="el" href="group__VncConstants.html#gga0b9039f87c8a2980c4a6ab14b511760aac66141a54bb407b18d3ab26e779bc4a8">EncodingCopyRect</a> =  1, 
<a class="el" href="group__VncConstants.html#gga0b9039f87c8a2980c4a6ab14b511760aa2e2676a7c0aac5891c51c5d4325453f7">EncodingHextile</a> =  5, 
<a class="el" href="group__VncConstants.html#gga0b9039f87c8a2980c4a6ab14b511760aa81cbe670fb7e962f4721e74d55bc66e5">EncodingDesktopSize</a> =  -223
 }</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__VncConstants.html#ga0aa77c5c19bd1f953c90f0cae8c61a9a">MouseEvents</a> { <a class="el" href="group__VncConstants.html#gga0aa77c5c19bd1f953c90f0cae8c61a9aa13ee718768549ed254378457536bfd63">MouseLeftButton</a> =  0x1, 
<a class="el" href="group__VncConstants.html#gga0aa77c5c19bd1f953c90f0cae8c61a9aa9722dcc9b50f713f587a1b046e108b27">MouseRightButton</a> =  0x2, 
<a class="el" href="group__VncConstants.html#gga0aa77c5c19bd1f953c90f0cae8c61a9aaa93c27c34acd42cdc9e28a8f668d87dd">MouseMiddleButton</a> =  0x4
 }</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__VncConstants.html#gacdd867d72142510ce53521a63a062f9b">ConnectionState</a> { <br/>
&nbsp;&nbsp;<a class="el" href="group__VncConstants.html#ggacdd867d72142510ce53521a63a062f9ba79cc83bc90b4f683fb2495d4487662ea">WaitForProtocolVersion</a>, 
<a class="el" href="group__VncConstants.html#ggacdd867d72142510ce53521a63a062f9ba198ea2412a93ac253bf8e4406a8fb06c">WaitForSecurityResponse</a>, 
<a class="el" href="group__VncConstants.html#ggacdd867d72142510ce53521a63a062f9ba78e807adbaddb74b84dea34150fab20e">WaitForClientInit</a>, 
<a class="el" href="group__VncConstants.html#ggacdd867d72142510ce53521a63a062f9badd4438c090c589c90c368d163c4edbd9">InitializationPhase</a>, 
<br/>
&nbsp;&nbsp;<a class="el" href="group__VncConstants.html#ggacdd867d72142510ce53521a63a062f9ba6302b1455052baff1528e67e95db429a">NormalPhase</a>
<br/>
 }</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef VncServerParams&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classVncServer.html#a9bc94e8c47d227e70719e2f0b14d23d8">Params</a></td></tr>
<tr><td colspan="2"><h2>Public メソッド</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__VncConstants.html#ga36bab5b0163b272b816361d6214c3f14">vncVersion</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classVncServer.html#a0438267d56345e85e9422a89bea5c886">VncServer</a> (const <a class="el" href="classVncServer.html#a9bc94e8c47d227e70719e2f0b14d23d8">Params</a> *p)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classVncServer.html#a13ae0e928ec930d77353cb1bd42e36a1">~VncServer</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classVncServer.html#a92a590790db6444ca7a79eaf5fbcb0d9">setDirty</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classVncServer.html#a9abef13e07371ccf4a89883649f1bcc5">setFrameBufferParams</a> (<a class="el" href="classVideoConvert.html#a46c8a310cf4c094f8c80e1cb8dc1f911">VideoConvert::Mode</a> mode, uint16_t width, uint16_t height)</td></tr>
<tr><td colspan="2"><h2>Public 変数</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structVncServer_1_1ServerInitMsg.html">VncServer::ServerInitMsg</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__VncConstants.html#ga2f0a8a1f1c40593e1e01ce4b8087d792">M5_ATTR_PACKED</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structVncServer_1_1FrameBufferUpdate.html">VncServer::FrameBufferUpdate</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__VncConstants.html#ga357314e013d6289c7d085fadd56a290c">M5_ATTR_PACKED</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structVncServer_1_1FrameBufferRect.html">VncServer::FrameBufferRect</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__VncConstants.html#gab34a91a8552f4b2f7e2806b835f39780">M5_ATTR_PACKED</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structVncServer_1_1ServerCutText.html">VncServer::ServerCutText</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__VncConstants.html#gac782a3823c0bb07395a234047394d59e">M5_ATTR_PACKED</a></td></tr>
<tr><td colspan="2"><h2>Static Public 変数</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const <a class="el" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__VncConstants.html#ga0adb6517a8a2c8403f7aff85bad3dfa5">AuthInvalid</a> = 0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const <a class="el" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__VncConstants.html#gabc058a28bda6e015dbafe8bbfbddb821">AuthNone</a> = 1</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const <a class="el" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__VncConstants.html#ga6d4127ee4f24603d9a0c7e3257b04ca3">VncOK</a> = 0</td></tr>
<tr><td colspan="2"><h2>Protected メソッド</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classVncServer.html#ac0c44c1417536740ffc2cf33117027cf">listen</a> (int port)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classVncServer.html#aadb9f3b844fb4cf98288cd3c60a3af91">accept</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classVncServer.html#a6617ba3e856d8b24979a2a44e5417172">data</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classVncServer.html#ac295bade8aee589f6718dfa79edc2a34">detach</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classVncServer.html#a3531045d065c2aa1aaf5a225e2337e80">sendError</a> (const char *error_msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">size_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classVncServer.html#a9f8a094b410fa145da19663f83f241e3">read</a> (uint8_t *buf, size_t len)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">size_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classVncServer.html#ab265cdc9659b04aafe0b93e866024a6d">read1</a> (uint8_t *buf, size_t len)</td></tr>
<tr><td class="memTemplParams" colspan="2">template&lt;typename T &gt; </td></tr>
<tr><td class="memTemplItemLeft" align="right" valign="top">size_t&nbsp;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classVncServer.html#a09f96768306b6f498cf39d32962a853d">read</a> (T *val)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">size_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classVncServer.html#a215d71301eb6ae0ebffc5d2f8fe4a140">write</a> (const uint8_t *buf, size_t len)</td></tr>
<tr><td class="memTemplParams" colspan="2">template&lt;typename T &gt; </td></tr>
<tr><td class="memTemplItemLeft" align="right" valign="top">size_t&nbsp;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classVncServer.html#aefa1c03e3a1158303080d2702de2a11e">write</a> (T *val)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">size_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classVncServer.html#add50e5436017b9c2f1e0d11c9476bf1b">write</a> (const char *str)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classVncServer.html#aee7430db7799cf4e0bac388671be878d">checkProtocolVersion</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classVncServer.html#ad4122a39071b5fd462e19418a432ed31">checkSecurity</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classVncServer.html#a0d7d773b4b3948da49ae2ecd00f985d5">sendServerInit</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classVncServer.html#a6ad4e22608f77193eb9cddb1c8b20703">sendError</a> (std::string error_msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classVncServer.html#a12fdf8396c8fe33bb93e66d7491fb497">sendFrameBufferUpdate</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classVncServer.html#ad52ea030be3bb8b536f8a7f87b709319">setPixelFormat</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classVncServer.html#a840599118004b7df093bd78b6a21e56b">setEncodings</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classVncServer.html#a83f5ce82a666e5b948e2a14b430633ce">requestFbUpdate</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classVncServer.html#adce913e2d5283f60780d7becd1d3e44b">recvKeyboardInput</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classVncServer.html#a95d4cde3a9b92bbac5871d8b475eedd3">recvPointerInput</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classVncServer.html#a7ee4399f42b127e68135272ff77815c2">recvCutText</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classVncServer.html#a046eae8a3566418d4f03a95de5d1af13">sendFrameBufferResized</a> ()</td></tr>
<tr><td colspan="2"><h2>Protected 変数</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classVncServer_1_1ListenEvent.html">ListenEvent</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classVncServer.html#ad7f258b1b869b6152bc5040c38b79d39">listenEvent</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classVncServer_1_1DataEvent.html">DataEvent</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classVncServer.html#a7a8501aba170bc353fe057e372612b93">dataEvent</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classVncServer.html#a7106e2abc437ad981830d14176d15f09">number</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classVncServer.html#ab9f945d843e004fbbb155b7709051470">dataFd</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classListenSocket.html">ListenSocket</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classVncServer.html#acf9ea448b26a541b4a197f1ca92f700b">listener</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__VncConstants.html#gacdd867d72142510ce53521a63a062f9b">ConnectionState</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classVncServer.html#ad0bc1d6a87b76d47489ca919f3ae51ca">curState</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classVncServer.html#ab2b958eb553dde858c8737b57614e87d">sendUpdate</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structVncInput_1_1PixelFormat.html">PixelFormat</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classVncServer.html#a126e69cd1de897ecc9b84e858e4809c7">pixelFormat</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classVncServer.html#a1286ea1dbf0c332e14ccfc0267de405e">supportsRawEnc</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classVncServer.html#a68ae35695f8a6dcd68d9ff80dee28736">supportsResizeEnc</a></td></tr>
<tr><td colspan="2"><h2>フレンド</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classVncServer.html#a9465cdda0008b0e7b7f9ac919cd9cca6">ListenEvent</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classVncServer.html#a8a93830b802d4fc8562fa54ead43b1f9">DataEvent</a></td></tr>
</table>
<hr/><h2>型定義</h2>
<a class="anchor" id="a9bc94e8c47d227e70719e2f0b14d23d8"></a><!-- doxytag: member="VncServer::Params" ref="a9bc94e8c47d227e70719e2f0b14d23d8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef VncServerParams <a class="el" href="classVncServer.html#a9bc94e8c47d227e70719e2f0b14d23d8">Params</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><a class="el" href="classVncInput.html#a33249bc76b6a23eda274363d6f466b79">VncInput</a>を再定義しています。</p>

</div>
</div>
<hr/><h2>コンストラクタとデストラクタ</h2>
<a class="anchor" id="a0438267d56345e85e9422a89bea5c886"></a><!-- doxytag: member="VncServer::VncServer" ref="a0438267d56345e85e9422a89bea5c886" args="(const Params *p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classVncServer.html">VncServer</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classVncServer.html#a9bc94e8c47d227e70719e2f0b14d23d8">Params</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p><a class="el" href="classVncServer.html">VncServer</a> </p>

<p><div class="fragment"><pre class="fragment"><a name="l00108"></a>00108     : <a class="code" href="classVncInput.html#aa1f9aa1c07faf127e4006b0ab3369039">VncInput</a>(<a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a>), <a class="code" href="classVncServer.html#ad7f258b1b869b6152bc5040c38b79d39">listenEvent</a>(<a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>), <a class="code" href="classVncServer.html#a7a8501aba170bc353fe057e372612b93">dataEvent</a>(<a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>), <a class="code" href="classVncServer.html#a7106e2abc437ad981830d14176d15f09">number</a>(<a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a>-&gt;number),
<a name="l00109"></a>00109       <a class="code" href="classVncServer.html#ab9f945d843e004fbbb155b7709051470">dataFd</a>(-1), <a class="code" href="classVncServer.html#ab2b958eb553dde858c8737b57614e87d">sendUpdate</a>(<span class="keyword">false</span>)
<a name="l00110"></a>00110 {
<a name="l00111"></a>00111     <span class="keywordflow">if</span> (<a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a>-&gt;port)
<a name="l00112"></a>00112         <a class="code" href="classVncServer.html#ac0c44c1417536740ffc2cf33117027cf">listen</a>(<a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a>-&gt;port);
<a name="l00113"></a>00113 
<a name="l00114"></a>00114     <a class="code" href="classVncServer.html#ad0bc1d6a87b76d47489ca919f3ae51ca">curState</a> = <a class="code" href="group__VncConstants.html#ggacdd867d72142510ce53521a63a062f9ba79cc83bc90b4f683fb2495d4487662ea">WaitForProtocolVersion</a>;
<a name="l00115"></a>00115 
<a name="l00116"></a>00116     <span class="comment">// currently we only support this one pixel format</span>
<a name="l00117"></a>00117     <span class="comment">// unpacked 32bit rgb (rgb888 + 8 bits of nothing/alpha)</span>
<a name="l00118"></a>00118     <span class="comment">// keep it around for telling the client and making</span>
<a name="l00119"></a>00119     <span class="comment">// sure the client cooperates</span>
<a name="l00120"></a>00120     <a class="code" href="classVncServer.html#a126e69cd1de897ecc9b84e858e4809c7">pixelFormat</a>.<a class="code" href="structVncInput_1_1PixelFormat.html#a496818f626ceb32365ca6cf57c991979">bpp</a> = 32;
<a name="l00121"></a>00121     <a class="code" href="classVncServer.html#a126e69cd1de897ecc9b84e858e4809c7">pixelFormat</a>.<a class="code" href="structVncInput_1_1PixelFormat.html#ab6f276082172be43a6041212071e377b">depth</a> = 24;
<a name="l00122"></a>00122     <a class="code" href="classVncServer.html#a126e69cd1de897ecc9b84e858e4809c7">pixelFormat</a>.<a class="code" href="structVncInput_1_1PixelFormat.html#a4d868ea999e3357d3046b00014455b6e">bigendian</a> = 0;
<a name="l00123"></a>00123     <a class="code" href="classVncServer.html#a126e69cd1de897ecc9b84e858e4809c7">pixelFormat</a>.<a class="code" href="structVncInput_1_1PixelFormat.html#ab14b7ec53c8b8d397a4abb2c61f3dde6">truecolor</a> = 1;
<a name="l00124"></a>00124     <a class="code" href="classVncServer.html#a126e69cd1de897ecc9b84e858e4809c7">pixelFormat</a>.<a class="code" href="structVncInput_1_1PixelFormat.html#a55af395a54c61a9e6118f09dfbcaa45e">redmax</a> = 0xff;
<a name="l00125"></a>00125     <a class="code" href="classVncServer.html#a126e69cd1de897ecc9b84e858e4809c7">pixelFormat</a>.<a class="code" href="structVncInput_1_1PixelFormat.html#ae8bacdd4bc66c207a91914a5eb0fb1c9">greenmax</a> = 0xff;
<a name="l00126"></a>00126     <a class="code" href="classVncServer.html#a126e69cd1de897ecc9b84e858e4809c7">pixelFormat</a>.<a class="code" href="structVncInput_1_1PixelFormat.html#adfda5ca4cddee763bdf6c78777593328">bluemax</a> = 0xff;
<a name="l00127"></a>00127     <a class="code" href="classVncServer.html#a126e69cd1de897ecc9b84e858e4809c7">pixelFormat</a>.<a class="code" href="structVncInput_1_1PixelFormat.html#ae651b46b775055134b81e5055203facf">redshift</a> = 16;
<a name="l00128"></a>00128     <a class="code" href="classVncServer.html#a126e69cd1de897ecc9b84e858e4809c7">pixelFormat</a>.<a class="code" href="structVncInput_1_1PixelFormat.html#ae51a571c5df8d325edb011c3c93532c2">greenshift</a> = 8;
<a name="l00129"></a>00129     <a class="code" href="classVncServer.html#a126e69cd1de897ecc9b84e858e4809c7">pixelFormat</a>.<a class="code" href="structVncInput_1_1PixelFormat.html#afbb2c2bc76b4cc4e8552fc47403c4786">blueshift</a> = 0;
<a name="l00130"></a>00130 
<a name="l00131"></a>00131     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(VNC, <span class="stringliteral">&quot;Vnc server created at port %d\n&quot;</span>, <a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a>-&gt;port);
<a name="l00132"></a>00132 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a13ae0e928ec930d77353cb1bd42e36a1"></a><!-- doxytag: member="VncServer::~VncServer" ref="a13ae0e928ec930d77353cb1bd42e36a1" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">~<a class="el" href="classVncServer.html">VncServer</a> </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00135"></a>00135 {
<a name="l00136"></a>00136     <span class="keywordflow">if</span> (<a class="code" href="classVncServer.html#ab9f945d843e004fbbb155b7709051470">dataFd</a> != -1)
<a name="l00137"></a>00137         ::close(<a class="code" href="classVncServer.html#ab9f945d843e004fbbb155b7709051470">dataFd</a>);
<a name="l00138"></a>00138 
<a name="l00139"></a>00139     <span class="keywordflow">if</span> (<a class="code" href="classVncServer.html#ad7f258b1b869b6152bc5040c38b79d39">listenEvent</a>)
<a name="l00140"></a>00140         <span class="keyword">delete</span> <a class="code" href="classVncServer.html#ad7f258b1b869b6152bc5040c38b79d39">listenEvent</a>;
<a name="l00141"></a>00141 
<a name="l00142"></a>00142     <span class="keywordflow">if</span> (<a class="code" href="classVncServer.html#a7a8501aba170bc353fe057e372612b93">dataEvent</a>)
<a name="l00143"></a>00143         <span class="keyword">delete</span> <a class="code" href="classVncServer.html#a7a8501aba170bc353fe057e372612b93">dataEvent</a>;
<a name="l00144"></a>00144 }
</pre></div></p>

</div>
</div>
<hr/><h2>関数</h2>
<a class="anchor" id="aadb9f3b844fb4cf98288cd3c60a3af91"></a><!-- doxytag: member="VncServer::accept" ref="aadb9f3b844fb4cf98288cd3c60a3af91" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void accept </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00176"></a>00176 {
<a name="l00177"></a>00177     <span class="comment">// As a consequence of being called from the PollQueue, we might</span>
<a name="l00178"></a>00178     <span class="comment">// have been called from a different thread. Migrate to &quot;our&quot;</span>
<a name="l00179"></a>00179     <span class="comment">// thread.</span>
<a name="l00180"></a>00180     <a class="code" href="classEventQueue_1_1ScopedMigration.html">EventQueue::ScopedMigration</a> migrate(<a class="code" href="classEventManager.html#ad6e91e91036b003cf3661959078e677f">eventQueue</a>());
<a name="l00181"></a>00181 
<a name="l00182"></a>00182     <span class="keywordflow">if</span> (!<a class="code" href="classVncServer.html#acf9ea448b26a541b4a197f1ca92f700b">listener</a>.<a class="code" href="classListenSocket.html#a2848e5513ce657609b8210b7d23e4f6b">islistening</a>())
<a name="l00183"></a>00183         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;%s: cannot accept a connection if not listening!&quot;</span>, <a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>());
<a name="l00184"></a>00184 
<a name="l00185"></a>00185     <span class="keywordtype">int</span> <a class="code" href="namespaceArmISA.html#a87001e8063b8b1b5dc88f5a4b43b2a5a">fd</a> = <a class="code" href="classVncServer.html#acf9ea448b26a541b4a197f1ca92f700b">listener</a>.<a class="code" href="classListenSocket.html#a456b2a8397007045eca1f89d086b5778">accept</a>(<span class="keyword">true</span>);
<a name="l00186"></a>00186     <span class="keywordflow">if</span> (<a class="code" href="classVncServer.html#ab9f945d843e004fbbb155b7709051470">dataFd</a> != -1) {
<a name="l00187"></a>00187         <span class="keywordtype">char</span> message[] = <span class="stringliteral">&quot;vnc server already attached!\n&quot;</span>;
<a name="l00188"></a>00188         <a class="code" href="atomicio_8cc.html#a301f476c6c8d75d54f43aea6ad1ff740">atomic_write</a>(fd, message, <span class="keyword">sizeof</span>(message));
<a name="l00189"></a>00189         ::close(fd);
<a name="l00190"></a>00190         <span class="keywordflow">return</span>;
<a name="l00191"></a>00191     }
<a name="l00192"></a>00192 
<a name="l00193"></a>00193     <a class="code" href="classVncServer.html#ab9f945d843e004fbbb155b7709051470">dataFd</a> = fd;
<a name="l00194"></a>00194 
<a name="l00195"></a>00195     <span class="comment">// Send our version number to the client</span>
<a name="l00196"></a>00196     <a class="code" href="classVncServer.html#a215d71301eb6ae0ebffc5d2f8fe4a140">write</a>((uint8_t*)<a class="code" href="group__VncConstants.html#ga36bab5b0163b272b816361d6214c3f14">vncVersion</a>(), strlen(<a class="code" href="group__VncConstants.html#ga36bab5b0163b272b816361d6214c3f14">vncVersion</a>()));
<a name="l00197"></a>00197 
<a name="l00198"></a>00198     <span class="comment">// read the client response</span>
<a name="l00199"></a>00199     <a class="code" href="classVncServer.html#a7a8501aba170bc353fe057e372612b93">dataEvent</a> = <span class="keyword">new</span> <a class="code" href="classVncServer.html#a8a93830b802d4fc8562fa54ead43b1f9">DataEvent</a>(<span class="keyword">this</span>, <a class="code" href="classVncServer.html#ab9f945d843e004fbbb155b7709051470">dataFd</a>, POLLIN);
<a name="l00200"></a>00200     <a class="code" href="pollevent_8cc.html#a6d9704e1e32950ea3b587e96e8873739">pollQueue</a>.<a class="code" href="classPollQueue.html#a3f09bc14c53cce046dfdc7d11c96bb72">schedule</a>(<a class="code" href="classVncServer.html#a7a8501aba170bc353fe057e372612b93">dataEvent</a>);
<a name="l00201"></a>00201 
<a name="l00202"></a>00202     <a class="code" href="base_2misc_8hh.html#ae7d790080fa18103d7582effff570b9e">inform</a>(<span class="stringliteral">&quot;VNC client attached\n&quot;</span>);
<a name="l00203"></a>00203 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aee7430db7799cf4e0bac388671be878d"></a><!-- doxytag: member="VncServer::checkProtocolVersion" ref="aee7430db7799cf4e0bac388671be878d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void checkProtocolVersion </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p><a class="el" href="classCheck.html">Check</a> the client's protocol verion for compatibility and send the security types we support </p>

<p><div class="fragment"><pre class="fragment"><a name="l00369"></a>00369 {
<a name="l00370"></a>00370     assert(<a class="code" href="classVncServer.html#ad0bc1d6a87b76d47489ca919f3ae51ca">curState</a> == <a class="code" href="group__VncConstants.html#ggacdd867d72142510ce53521a63a062f9ba79cc83bc90b4f683fb2495d4487662ea">WaitForProtocolVersion</a>);
<a name="l00371"></a>00371 
<a name="l00372"></a>00372     <span class="keywordtype">size_t</span> <a class="code" href="namespaceArmISA.html#a41a9f22a6c7645fac2f8d633371e354d">len</a> M5_VAR_USED;
<a name="l00373"></a>00373     <span class="keywordtype">char</span> version_string[13];
<a name="l00374"></a>00374 
<a name="l00375"></a>00375     <span class="comment">// Null terminate the message so it&apos;s easier to work with</span>
<a name="l00376"></a>00376     version_string[12] = 0;
<a name="l00377"></a>00377 
<a name="l00378"></a>00378     <a class="code" href="namespaceArmISA.html#a41a9f22a6c7645fac2f8d633371e354d">len</a> = <a class="code" href="classVncServer.html#a9f8a094b410fa145da19663f83f241e3">read</a>((uint8_t*)version_string, 12);
<a name="l00379"></a>00379     assert(<a class="code" href="namespaceArmISA.html#a41a9f22a6c7645fac2f8d633371e354d">len</a> == 12);
<a name="l00380"></a>00380 
<a name="l00381"></a>00381     <a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> major, minor;
<a name="l00382"></a>00382 
<a name="l00383"></a>00383     <span class="comment">// Figure out the major/minor numbers</span>
<a name="l00384"></a>00384     <span class="keywordflow">if</span> (sscanf(version_string, <span class="stringliteral">&quot;RFB %03d.%03d\n&quot;</span>, &amp;major, &amp;minor) != 2) {
<a name="l00385"></a>00385         <a class="code" href="base_2misc_8hh.html#a8224a361dddd2ad59b411982e5ea746f">warn</a>(<span class="stringliteral">&quot; Malformed protocol version %s\n&quot;</span>, version_string);
<a name="l00386"></a>00386         <a class="code" href="classVncServer.html#a3531045d065c2aa1aaf5a225e2337e80">sendError</a>(<span class="stringliteral">&quot;Malformed protocol version\n&quot;</span>);
<a name="l00387"></a>00387         <a class="code" href="classVncServer.html#ac295bade8aee589f6718dfa79edc2a34">detach</a>();
<a name="l00388"></a>00388     }
<a name="l00389"></a>00389 
<a name="l00390"></a>00390     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(VNC, <span class="stringliteral">&quot;Client request protocol version %d.%d\n&quot;</span>, major, minor);
<a name="l00391"></a>00391 
<a name="l00392"></a>00392     <span class="comment">// If it&apos;s not 3.X we don&apos;t support it</span>
<a name="l00393"></a>00393     <span class="keywordflow">if</span> (major != 3 || minor &lt; 2) {
<a name="l00394"></a>00394         <a class="code" href="base_2misc_8hh.html#a8224a361dddd2ad59b411982e5ea746f">warn</a>(<span class="stringliteral">&quot;Unsupported VNC client version... disconnecting\n&quot;</span>);
<a name="l00395"></a>00395         uint8_t err = <a class="code" href="group__VncConstants.html#ga0adb6517a8a2c8403f7aff85bad3dfa5">AuthInvalid</a>;
<a name="l00396"></a>00396         <a class="code" href="classVncServer.html#a215d71301eb6ae0ebffc5d2f8fe4a140">write</a>(&amp;err);
<a name="l00397"></a>00397         <a class="code" href="classVncServer.html#ac295bade8aee589f6718dfa79edc2a34">detach</a>();
<a name="l00398"></a>00398     }
<a name="l00399"></a>00399     <span class="comment">// Auth is different based on version number</span>
<a name="l00400"></a>00400     <span class="keywordflow">if</span> (minor &lt; 7) {
<a name="l00401"></a>00401         <a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> sec_type = <a class="code" href="byteswap_8hh.html#a0ec9bd801b3cff46ad2537234f1f1a67">htobe</a>((<a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>)<a class="code" href="group__VncConstants.html#gabc058a28bda6e015dbafe8bbfbddb821">AuthNone</a>);
<a name="l00402"></a>00402         <a class="code" href="classVncServer.html#a215d71301eb6ae0ebffc5d2f8fe4a140">write</a>(&amp;sec_type);
<a name="l00403"></a>00403     } <span class="keywordflow">else</span> {
<a name="l00404"></a>00404         uint8_t sec_cnt = 1;
<a name="l00405"></a>00405         uint8_t sec_type = <a class="code" href="byteswap_8hh.html#a0ec9bd801b3cff46ad2537234f1f1a67">htobe</a>((uint8_t)<a class="code" href="group__VncConstants.html#gabc058a28bda6e015dbafe8bbfbddb821">AuthNone</a>);
<a name="l00406"></a>00406         <a class="code" href="classVncServer.html#a215d71301eb6ae0ebffc5d2f8fe4a140">write</a>(&amp;sec_cnt);
<a name="l00407"></a>00407         <a class="code" href="classVncServer.html#a215d71301eb6ae0ebffc5d2f8fe4a140">write</a>(&amp;sec_type);
<a name="l00408"></a>00408     }
<a name="l00409"></a>00409 
<a name="l00410"></a>00410     <span class="comment">// Wait for client to respond</span>
<a name="l00411"></a>00411     <a class="code" href="classVncServer.html#ad0bc1d6a87b76d47489ca919f3ae51ca">curState</a> = <a class="code" href="group__VncConstants.html#ggacdd867d72142510ce53521a63a062f9ba198ea2412a93ac253bf8e4406a8fb06c">WaitForSecurityResponse</a>;
<a name="l00412"></a>00412 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad4122a39071b5fd462e19418a432ed31"></a><!-- doxytag: member="VncServer::checkSecurity" ref="ad4122a39071b5fd462e19418a432ed31" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void checkSecurity </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p><a class="el" href="classCheck.html">Check</a> that the security exchange was successful </p>

<p><div class="fragment"><pre class="fragment"><a name="l00416"></a>00416 {
<a name="l00417"></a>00417     assert(<a class="code" href="classVncServer.html#ad0bc1d6a87b76d47489ca919f3ae51ca">curState</a> == <a class="code" href="group__VncConstants.html#ggacdd867d72142510ce53521a63a062f9ba198ea2412a93ac253bf8e4406a8fb06c">WaitForSecurityResponse</a>);
<a name="l00418"></a>00418 
<a name="l00419"></a>00419     uint8_t security_type;
<a name="l00420"></a>00420     <span class="keywordtype">size_t</span> <a class="code" href="namespaceArmISA.html#a41a9f22a6c7645fac2f8d633371e354d">len</a> M5_VAR_USED = <a class="code" href="classVncServer.html#a9f8a094b410fa145da19663f83f241e3">read</a>(&amp;security_type);
<a name="l00421"></a>00421 
<a name="l00422"></a>00422     assert(<a class="code" href="namespaceArmISA.html#a41a9f22a6c7645fac2f8d633371e354d">len</a> == 1);
<a name="l00423"></a>00423 
<a name="l00424"></a>00424     <span class="keywordflow">if</span> (security_type != <a class="code" href="group__VncConstants.html#gabc058a28bda6e015dbafe8bbfbddb821">AuthNone</a>) {
<a name="l00425"></a>00425         <a class="code" href="base_2misc_8hh.html#a8224a361dddd2ad59b411982e5ea746f">warn</a>(<span class="stringliteral">&quot;Unknown VNC security type\n&quot;</span>);
<a name="l00426"></a>00426         <a class="code" href="classVncServer.html#a3531045d065c2aa1aaf5a225e2337e80">sendError</a>(<span class="stringliteral">&quot;Unknown security type\n&quot;</span>);
<a name="l00427"></a>00427     }
<a name="l00428"></a>00428 
<a name="l00429"></a>00429     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(VNC, <span class="stringliteral">&quot;Sending security auth OK\n&quot;</span>);
<a name="l00430"></a>00430 
<a name="l00431"></a>00431     <a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> success = <a class="code" href="byteswap_8hh.html#a0ec9bd801b3cff46ad2537234f1f1a67">htobe</a>(<a class="code" href="group__VncConstants.html#ga6d4127ee4f24603d9a0c7e3257b04ca3">VncOK</a>);
<a name="l00432"></a>00432     <a class="code" href="classVncServer.html#a215d71301eb6ae0ebffc5d2f8fe4a140">write</a>(&amp;success);
<a name="l00433"></a>00433     <a class="code" href="classVncServer.html#ad0bc1d6a87b76d47489ca919f3ae51ca">curState</a> = <a class="code" href="group__VncConstants.html#ggacdd867d72142510ce53521a63a062f9ba78e807adbaddb74b84dea34150fab20e">WaitForClientInit</a>;
<a name="l00434"></a>00434 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6617ba3e856d8b24979a2a44e5417172"></a><!-- doxytag: member="VncServer::data" ref="a6617ba3e856d8b24979a2a44e5417172" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void data </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00208"></a>00208 {
<a name="l00209"></a>00209     <span class="comment">// We have new data, see if we can handle it</span>
<a name="l00210"></a>00210     <span class="keywordtype">size_t</span> <a class="code" href="namespaceArmISA.html#a41a9f22a6c7645fac2f8d633371e354d">len</a>;
<a name="l00211"></a>00211     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(VNC, <span class="stringliteral">&quot;Vnc client message recieved\n&quot;</span>);
<a name="l00212"></a>00212 
<a name="l00213"></a>00213     <span class="keywordflow">switch</span> (<a class="code" href="classVncServer.html#ad0bc1d6a87b76d47489ca919f3ae51ca">curState</a>) {
<a name="l00214"></a>00214       <span class="keywordflow">case</span> <a class="code" href="group__VncConstants.html#ggacdd867d72142510ce53521a63a062f9ba79cc83bc90b4f683fb2495d4487662ea">WaitForProtocolVersion</a>:
<a name="l00215"></a>00215         <a class="code" href="classVncServer.html#aee7430db7799cf4e0bac388671be878d">checkProtocolVersion</a>();
<a name="l00216"></a>00216         <span class="keywordflow">break</span>;
<a name="l00217"></a>00217       <span class="keywordflow">case</span> <a class="code" href="group__VncConstants.html#ggacdd867d72142510ce53521a63a062f9ba198ea2412a93ac253bf8e4406a8fb06c">WaitForSecurityResponse</a>:
<a name="l00218"></a>00218         <a class="code" href="classVncServer.html#ad4122a39071b5fd462e19418a432ed31">checkSecurity</a>();
<a name="l00219"></a>00219         <span class="keywordflow">break</span>;
<a name="l00220"></a>00220       <span class="keywordflow">case</span> <a class="code" href="group__VncConstants.html#ggacdd867d72142510ce53521a63a062f9ba78e807adbaddb74b84dea34150fab20e">WaitForClientInit</a>:
<a name="l00221"></a>00221         <span class="comment">// Don&apos;t care about shared, just need to read it out of the socket</span>
<a name="l00222"></a>00222         uint8_t shared;
<a name="l00223"></a>00223         len = <a class="code" href="classVncServer.html#a9f8a094b410fa145da19663f83f241e3">read</a>(&amp;shared);
<a name="l00224"></a>00224         assert(len == 1);
<a name="l00225"></a>00225 
<a name="l00226"></a>00226         <span class="comment">// Send our idea of the frame buffer</span>
<a name="l00227"></a>00227         <a class="code" href="classVncServer.html#a0d7d773b4b3948da49ae2ecd00f985d5">sendServerInit</a>();
<a name="l00228"></a>00228 
<a name="l00229"></a>00229         <span class="keywordflow">break</span>;
<a name="l00230"></a>00230       <span class="keywordflow">case</span> <a class="code" href="group__VncConstants.html#ggacdd867d72142510ce53521a63a062f9ba6302b1455052baff1528e67e95db429a">NormalPhase</a>:
<a name="l00231"></a>00231         uint8_t message_type;
<a name="l00232"></a>00232         len = <a class="code" href="classVncServer.html#a9f8a094b410fa145da19663f83f241e3">read</a>(&amp;message_type);
<a name="l00233"></a>00233         <span class="keywordflow">if</span> (!len) {
<a name="l00234"></a>00234             <a class="code" href="classVncServer.html#ac295bade8aee589f6718dfa79edc2a34">detach</a>();
<a name="l00235"></a>00235             <span class="keywordflow">return</span>;
<a name="l00236"></a>00236         }
<a name="l00237"></a>00237         assert(len == 1);
<a name="l00238"></a>00238 
<a name="l00239"></a>00239         <span class="keywordflow">switch</span> (message_type) {
<a name="l00240"></a>00240           <span class="keywordflow">case</span> <a class="code" href="classVncInput.html#a58b5b2aadaeafc265dec196e8868cacda255292f4d9e524e15ff62e8033ddcaf5">ClientSetPixelFormat</a>:
<a name="l00241"></a>00241             <a class="code" href="classVncServer.html#ad52ea030be3bb8b536f8a7f87b709319">setPixelFormat</a>();
<a name="l00242"></a>00242             <span class="keywordflow">break</span>;
<a name="l00243"></a>00243           <span class="keywordflow">case</span> <a class="code" href="classVncInput.html#a58b5b2aadaeafc265dec196e8868cacdaa89fc9bca1b3c104d1b1d4e363c7a35c">ClientSetEncodings</a>:
<a name="l00244"></a>00244             <a class="code" href="classVncServer.html#a840599118004b7df093bd78b6a21e56b">setEncodings</a>();
<a name="l00245"></a>00245             <span class="keywordflow">break</span>;
<a name="l00246"></a>00246           <span class="keywordflow">case</span> <a class="code" href="classVncInput.html#a58b5b2aadaeafc265dec196e8868cacda2a5859ccdbbeec19483aa0c10403ac3a">ClientFrameBufferUpdate</a>:
<a name="l00247"></a>00247             <a class="code" href="classVncServer.html#a83f5ce82a666e5b948e2a14b430633ce">requestFbUpdate</a>();
<a name="l00248"></a>00248             <span class="keywordflow">break</span>;
<a name="l00249"></a>00249           <span class="keywordflow">case</span> <a class="code" href="classVncInput.html#a58b5b2aadaeafc265dec196e8868cacda20b91df2df74ddf80c0608d5919be1b3">ClientKeyEvent</a>:
<a name="l00250"></a>00250             <a class="code" href="classVncServer.html#adce913e2d5283f60780d7becd1d3e44b">recvKeyboardInput</a>();
<a name="l00251"></a>00251             <span class="keywordflow">break</span>;
<a name="l00252"></a>00252           <span class="keywordflow">case</span> <a class="code" href="classVncInput.html#a58b5b2aadaeafc265dec196e8868cacdabf768f748337c98b90d1ff88a0182a38">ClientPointerEvent</a>:
<a name="l00253"></a>00253             <a class="code" href="classVncServer.html#a95d4cde3a9b92bbac5871d8b475eedd3">recvPointerInput</a>();
<a name="l00254"></a>00254             <span class="keywordflow">break</span>;
<a name="l00255"></a>00255           <span class="keywordflow">case</span> <a class="code" href="classVncInput.html#a58b5b2aadaeafc265dec196e8868cacda6ce5edbf9a7674d935c30c974af50696">ClientCutText</a>:
<a name="l00256"></a>00256             <a class="code" href="classVncServer.html#a7ee4399f42b127e68135272ff77815c2">recvCutText</a>();
<a name="l00257"></a>00257             <span class="keywordflow">break</span>;
<a name="l00258"></a>00258           <span class="keywordflow">default</span>:
<a name="l00259"></a>00259             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Unimplemented message type recv from client: %d\n&quot;</span>,
<a name="l00260"></a>00260                   message_type);
<a name="l00261"></a>00261             <span class="keywordflow">break</span>;
<a name="l00262"></a>00262         }
<a name="l00263"></a>00263         <span class="keywordflow">break</span>;
<a name="l00264"></a>00264       <span class="keywordflow">default</span>:
<a name="l00265"></a>00265         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Unknown vnc server state\n&quot;</span>);
<a name="l00266"></a>00266     }
<a name="l00267"></a>00267 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac295bade8aee589f6718dfa79edc2a34"></a><!-- doxytag: member="VncServer::detach" ref="ac295bade8aee589f6718dfa79edc2a34" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void detach </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00341"></a>00341 {
<a name="l00342"></a>00342     <span class="keywordflow">if</span> (<a class="code" href="classVncServer.html#ab9f945d843e004fbbb155b7709051470">dataFd</a> != -1) {
<a name="l00343"></a>00343         ::close(<a class="code" href="classVncServer.html#ab9f945d843e004fbbb155b7709051470">dataFd</a>);
<a name="l00344"></a>00344         <a class="code" href="classVncServer.html#ab9f945d843e004fbbb155b7709051470">dataFd</a> = -1;
<a name="l00345"></a>00345     }
<a name="l00346"></a>00346 
<a name="l00347"></a>00347     <span class="keywordflow">if</span> (!<a class="code" href="classVncServer.html#a7a8501aba170bc353fe057e372612b93">dataEvent</a> || !<a class="code" href="classVncServer.html#a7a8501aba170bc353fe057e372612b93">dataEvent</a>-&gt;<a class="code" href="classPollEvent.html#afeaa51bebb848d5f58994a57dcf2a1c6">queued</a>())
<a name="l00348"></a>00348         <span class="keywordflow">return</span>;
<a name="l00349"></a>00349 
<a name="l00350"></a>00350     <a class="code" href="pollevent_8cc.html#a6d9704e1e32950ea3b587e96e8873739">pollQueue</a>.<a class="code" href="classPollQueue.html#a4b43e98813c26772adf0d7488dfa1887">remove</a>(<a class="code" href="classVncServer.html#a7a8501aba170bc353fe057e372612b93">dataEvent</a>);
<a name="l00351"></a>00351     <span class="keyword">delete</span> <a class="code" href="classVncServer.html#a7a8501aba170bc353fe057e372612b93">dataEvent</a>;
<a name="l00352"></a>00352     <a class="code" href="classVncServer.html#a7a8501aba170bc353fe057e372612b93">dataEvent</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00353"></a>00353     <a class="code" href="classVncServer.html#ad0bc1d6a87b76d47489ca919f3ae51ca">curState</a> = <a class="code" href="group__VncConstants.html#ggacdd867d72142510ce53521a63a062f9ba79cc83bc90b4f683fb2495d4487662ea">WaitForProtocolVersion</a>;
<a name="l00354"></a>00354 
<a name="l00355"></a>00355     <a class="code" href="base_2misc_8hh.html#ae7d790080fa18103d7582effff570b9e">inform</a>(<span class="stringliteral">&quot;VNC client detached\n&quot;</span>);
<a name="l00356"></a>00356     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(VNC, <span class="stringliteral">&quot;detach vnc client %d\n&quot;</span>, <a class="code" href="classVncServer.html#a7106e2abc437ad981830d14176d15f09">number</a>);
<a name="l00357"></a>00357 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac0c44c1417536740ffc2cf33117027cf"></a><!-- doxytag: member="VncServer::listen" ref="ac0c44c1417536740ffc2cf33117027cf" args="(int port)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void listen </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>port</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00150"></a>00150 {
<a name="l00151"></a>00151     <span class="keywordflow">if</span> (<a class="code" href="classListenSocket.html#a70ba2cf446c7e6363080efd46cd330c5">ListenSocket::allDisabled</a>()) {
<a name="l00152"></a>00152         <a class="code" href="base_2misc_8hh.html#abb243c15dfbeedf4ae64aa213f4f18c7">warn_once</a>(<span class="stringliteral">&quot;Sockets disabled, not accepting vnc client connections&quot;</span>);
<a name="l00153"></a>00153         <span class="keywordflow">return</span>;
<a name="l00154"></a>00154     }
<a name="l00155"></a>00155 
<a name="l00156"></a>00156     <span class="keywordflow">while</span> (!<a class="code" href="classVncServer.html#acf9ea448b26a541b4a197f1ca92f700b">listener</a>.<a class="code" href="classListenSocket.html#adc0204f049c93d5c4ed27c604d1127a4">listen</a>(port, <span class="keyword">true</span>)) {
<a name="l00157"></a>00157         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(VNC,
<a name="l00158"></a>00158                 <span class="stringliteral">&quot;can&apos;t bind address vnc server port %d in use PID %d\n&quot;</span>,
<a name="l00159"></a>00159                 port, getpid());
<a name="l00160"></a>00160         port++;
<a name="l00161"></a>00161     }
<a name="l00162"></a>00162 
<a name="l00163"></a>00163     <span class="keywordtype">int</span> p1, p2;
<a name="l00164"></a>00164     p2 = <a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>().rfind(<span class="charliteral">&apos;.&apos;</span>) - 1;
<a name="l00165"></a>00165     p1 = <a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>().rfind(<span class="charliteral">&apos;.&apos;</span>, p2);
<a name="l00166"></a>00166     <a class="code" href="cprintf_8hh.html#ab172c0b086575bda3d04daee7df17da1">ccprintf</a>(cerr, <span class="stringliteral">&quot;Listening for %s connection on port %d\n&quot;</span>,
<a name="l00167"></a>00167              <a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>().substr(p1 + 1, p2 - p1), port);
<a name="l00168"></a>00168 
<a name="l00169"></a>00169     <a class="code" href="classVncServer.html#ad7f258b1b869b6152bc5040c38b79d39">listenEvent</a> = <span class="keyword">new</span> <a class="code" href="classVncServer.html#a9465cdda0008b0e7b7f9ac919cd9cca6">ListenEvent</a>(<span class="keyword">this</span>, <a class="code" href="classVncServer.html#acf9ea448b26a541b4a197f1ca92f700b">listener</a>.<a class="code" href="classListenSocket.html#a6246250322a585921fc1e9d27b0d7b80">getfd</a>(), POLLIN);
<a name="l00170"></a>00170     <a class="code" href="pollevent_8cc.html#a6d9704e1e32950ea3b587e96e8873739">pollQueue</a>.<a class="code" href="classPollQueue.html#a3f09bc14c53cce046dfdc7d11c96bb72">schedule</a>(<a class="code" href="classVncServer.html#ad7f258b1b869b6152bc5040c38b79d39">listenEvent</a>);
<a name="l00171"></a>00171 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a09f96768306b6f498cf39d32962a853d"></a><!-- doxytag: member="VncServer::read" ref="a09f96768306b6f498cf39d32962a853d" args="(T *val)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t read </td>
          <td>(</td>
          <td class="paramtype">T *&nbsp;</td>
          <td class="paramname"> <em>val</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Templated version of the read function above to read simple data to the client </p>
<dl><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>val</em>&nbsp;</td><td>data to recv from the client </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l00305"></a>00305 {
<a name="l00306"></a>00306     <span class="keywordflow">return</span> <a class="code" href="classVncServer.html#a9f8a094b410fa145da19663f83f241e3">read</a>((uint8_t*)<a class="code" href="namespaceX86ISA.html#ae13bf1250853ff6b72aabe3c79b587cc">val</a>, <span class="keyword">sizeof</span>(T));
<a name="l00307"></a>00307 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9f8a094b410fa145da19663f83f241e3"></a><!-- doxytag: member="VncServer::read" ref="a9f8a094b410fa145da19663f83f241e3" args="(uint8_t *buf, size_t len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t read </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>len</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Read some data from the client </p>
<dl><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>buf</em>&nbsp;</td><td>the data to read </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>len</em>&nbsp;</td><td>the amount of data to read </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>戻り値:</b></dt><dd>length read </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00273"></a>00273 {
<a name="l00274"></a>00274     <span class="keywordflow">if</span> (<a class="code" href="classVncServer.html#ab9f945d843e004fbbb155b7709051470">dataFd</a> &lt; 0)
<a name="l00275"></a>00275         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;vnc not properly attached.\n&quot;</span>);
<a name="l00276"></a>00276 
<a name="l00277"></a>00277     <span class="keywordtype">size_t</span> ret;
<a name="l00278"></a>00278     <span class="keywordflow">do</span> {
<a name="l00279"></a>00279         ret =<a class="code" href="classVncServer.html#a9f8a094b410fa145da19663f83f241e3"> ::read</a>(<a class="code" href="classVncServer.html#ab9f945d843e004fbbb155b7709051470">dataFd</a>, buf, <a class="code" href="namespaceArmISA.html#a41a9f22a6c7645fac2f8d633371e354d">len</a>);
<a name="l00280"></a>00280     } <span class="keywordflow">while</span> (ret == -1 &amp;&amp; errno == EINTR);
<a name="l00281"></a>00281 
<a name="l00282"></a>00282 
<a name="l00283"></a>00283     <span class="keywordflow">if</span> (ret &lt;= 0){
<a name="l00284"></a>00284         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(VNC, <span class="stringliteral">&quot;Read failed.\n&quot;</span>);
<a name="l00285"></a>00285         <a class="code" href="classVncServer.html#ac295bade8aee589f6718dfa79edc2a34">detach</a>();
<a name="l00286"></a>00286         <span class="keywordflow">return</span> 0;
<a name="l00287"></a>00287     }
<a name="l00288"></a>00288 
<a name="l00289"></a>00289     <span class="keywordflow">return</span> ret;
<a name="l00290"></a>00290 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab265cdc9659b04aafe0b93e866024a6d"></a><!-- doxytag: member="VncServer::read1" ref="ab265cdc9659b04aafe0b93e866024a6d" args="(uint8_t *buf, size_t len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t read1 </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>len</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Read len -1 bytes from the client into the buffer provided + 1 assert that we read enough bytes. This function exists to handle reading all of the protocol structs above when we've already read the first byte which describes which one we're reading </p>
<dl><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>buf</em>&nbsp;</td><td>the address of the buffer to add one to and read data into </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>len</em>&nbsp;</td><td>the amount of data + 1 to read </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>戻り値:</b></dt><dd>length read </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00294"></a>00294 {
<a name="l00295"></a>00295     <span class="keywordtype">size_t</span> read_len M5_VAR_USED;
<a name="l00296"></a>00296     read_len = <a class="code" href="classVncServer.html#a9f8a094b410fa145da19663f83f241e3">read</a>(buf + 1, <a class="code" href="namespaceArmISA.html#a41a9f22a6c7645fac2f8d633371e354d">len</a> - 1);
<a name="l00297"></a>00297     assert(read_len == <a class="code" href="namespaceArmISA.html#a41a9f22a6c7645fac2f8d633371e354d">len</a> - 1);
<a name="l00298"></a>00298     <span class="keywordflow">return</span> read_len;
<a name="l00299"></a>00299 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7ee4399f42b127e68135272ff77815c2"></a><!-- doxytag: member="VncServer::recvCutText" ref="a7ee4399f42b127e68135272ff77815c2" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void recvCutText </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Receive message from client that there is text in it's paste buffer. This is a no-op at the moment, but perhaps we would want to be able to paste it at some point. </p>

<p><div class="fragment"><pre class="fragment"><a name="l00581"></a>00581 {
<a name="l00582"></a>00582     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(VNC, <span class="stringliteral">&quot;Received client copy buffer message\n&quot;</span>);
<a name="l00583"></a>00583 
<a name="l00584"></a>00584     ClientCutTextMessage cct;
<a name="l00585"></a>00585     <a class="code" href="classVncServer.html#ab265cdc9659b04aafe0b93e866024a6d">read1</a>((uint8_t*)&amp;cct, <span class="keyword">sizeof</span>(ClientCutTextMessage));
<a name="l00586"></a>00586 
<a name="l00587"></a>00587     <span class="keywordtype">char</span> str[1025];
<a name="l00588"></a>00588     <span class="keywordtype">size_t</span> data_len = <a class="code" href="byteswap_8hh.html#a2af77d34ef12718184be94c5b14a27ce">betoh</a>(cct.length);
<a name="l00589"></a>00589     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(VNC, <span class="stringliteral">&quot;String length %d\n&quot;</span>, data_len);
<a name="l00590"></a>00590     <span class="keywordflow">while</span> (data_len &gt; 0) {
<a name="l00591"></a>00591         <span class="keywordtype">size_t</span> <a class="code" href="namespaceArmISA.html#a41a9f22a6c7645fac2f8d633371e354d">len</a>;
<a name="l00592"></a>00592         <span class="keywordtype">size_t</span> bytes_to_read = data_len &gt; 1024 ? 1024 : data_len;
<a name="l00593"></a>00593         len = <a class="code" href="classVncServer.html#a9f8a094b410fa145da19663f83f241e3">read</a>((uint8_t*)&amp;str, bytes_to_read);
<a name="l00594"></a>00594         str[bytes_to_read] = 0;
<a name="l00595"></a>00595         data_len -= len;
<a name="l00596"></a>00596         assert(data_len &gt;= 0);
<a name="l00597"></a>00597         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(VNC, <span class="stringliteral">&quot;Buffer: %s\n&quot;</span>, str);
<a name="l00598"></a>00598     }
<a name="l00599"></a>00599 
<a name="l00600"></a>00600 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="adce913e2d5283f60780d7becd1d3e44b"></a><!-- doxytag: member="VncServer::recvKeyboardInput" ref="adce913e2d5283f60780d7becd1d3e44b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void recvKeyboardInput </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Receive message from client providing new keyboard input </p>

<p><div class="fragment"><pre class="fragment"><a name="l00549"></a>00549 {
<a name="l00550"></a>00550     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(VNC, <span class="stringliteral">&quot;Received keyboard input from client\n&quot;</span>);
<a name="l00551"></a>00551     KeyEventMessage kem;
<a name="l00552"></a>00552     <a class="code" href="classVncServer.html#ab265cdc9659b04aafe0b93e866024a6d">read1</a>((uint8_t*)&amp;kem, <span class="keyword">sizeof</span>(KeyEventMessage));
<a name="l00553"></a>00553 
<a name="l00554"></a>00554     kem.key = <a class="code" href="byteswap_8hh.html#a2af77d34ef12718184be94c5b14a27ce">betoh</a>(kem.key);
<a name="l00555"></a>00555     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(VNC, <span class="stringliteral">&quot; -- received key code %d (%s)\n&quot;</span>, kem.key, kem.down_flag ?
<a name="l00556"></a>00556             <span class="stringliteral">&quot;down&quot;</span> : <span class="stringliteral">&quot;up&quot;</span>);
<a name="l00557"></a>00557 
<a name="l00558"></a>00558     <span class="keywordflow">if</span> (<a class="code" href="classVncInput.html#a185f1d765c763c2a2aae6b2b652a9032">keyboard</a>)
<a name="l00559"></a>00559         <a class="code" href="classVncInput.html#a185f1d765c763c2a2aae6b2b652a9032">keyboard</a>-&gt;<a class="code" href="classVncKeyboard.html#a5159bd9abc87d9ed9e74c782173e8f0f">keyPress</a>(kem.key, kem.down_flag);
<a name="l00560"></a>00560 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a95d4cde3a9b92bbac5871d8b475eedd3"></a><!-- doxytag: member="VncServer::recvPointerInput" ref="a95d4cde3a9b92bbac5871d8b475eedd3" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void recvPointerInput </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Recv message from client providing new mouse movement or button click </p>

<p><div class="fragment"><pre class="fragment"><a name="l00564"></a>00564 {
<a name="l00565"></a>00565     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(VNC, <span class="stringliteral">&quot;Received pointer input from client\n&quot;</span>);
<a name="l00566"></a>00566     PointerEventMessage pem;
<a name="l00567"></a>00567 
<a name="l00568"></a>00568     <a class="code" href="classVncServer.html#ab265cdc9659b04aafe0b93e866024a6d">read1</a>((uint8_t*)&amp;pem, <span class="keyword">sizeof</span>(PointerEventMessage));;
<a name="l00569"></a>00569 
<a name="l00570"></a>00570     pem.x = <a class="code" href="byteswap_8hh.html#a2af77d34ef12718184be94c5b14a27ce">betoh</a>(pem.x);
<a name="l00571"></a>00571     pem.y = <a class="code" href="byteswap_8hh.html#a2af77d34ef12718184be94c5b14a27ce">betoh</a>(pem.y);
<a name="l00572"></a>00572     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(VNC, <span class="stringliteral">&quot; -- pointer at x = %d y = %d buttons = %#x\n&quot;</span>, pem.x, pem.y,
<a name="l00573"></a>00573             pem.button_mask);
<a name="l00574"></a>00574 
<a name="l00575"></a>00575     <span class="keywordflow">if</span> (<a class="code" href="classVncInput.html#a8cea9cca80c9b50e4cfedb8d1bd90da0">mouse</a>)
<a name="l00576"></a>00576         <a class="code" href="classVncInput.html#a8cea9cca80c9b50e4cfedb8d1bd90da0">mouse</a>-&gt;<a class="code" href="classVncMouse.html#a9046dc82e20c004a2ac9b38f47ade145">mouseAt</a>(pem.x, pem.y, pem.button_mask);
<a name="l00577"></a>00577 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a83f5ce82a666e5b948e2a14b430633ce"></a><!-- doxytag: member="VncServer::requestFbUpdate" ref="a83f5ce82a666e5b948e2a14b430633ce" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void requestFbUpdate </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Receive message from client asking for updated frame buffer </p>

<p><div class="fragment"><pre class="fragment"><a name="l00530"></a>00530 {
<a name="l00531"></a>00531     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(VNC, <span class="stringliteral">&quot;Received frame buffer update request from client\n&quot;</span>);
<a name="l00532"></a>00532 
<a name="l00533"></a>00533     FrameBufferUpdateReq fbr;
<a name="l00534"></a>00534     <a class="code" href="classVncServer.html#ab265cdc9659b04aafe0b93e866024a6d">read1</a>((uint8_t*)&amp;fbr, <span class="keyword">sizeof</span>(FrameBufferUpdateReq));
<a name="l00535"></a>00535 
<a name="l00536"></a>00536     fbr.x = <a class="code" href="byteswap_8hh.html#a2af77d34ef12718184be94c5b14a27ce">betoh</a>(fbr.x);
<a name="l00537"></a>00537     fbr.y = <a class="code" href="byteswap_8hh.html#a2af77d34ef12718184be94c5b14a27ce">betoh</a>(fbr.y);
<a name="l00538"></a>00538     fbr.width = <a class="code" href="byteswap_8hh.html#a2af77d34ef12718184be94c5b14a27ce">betoh</a>(fbr.width);
<a name="l00539"></a>00539     fbr.height = <a class="code" href="byteswap_8hh.html#a2af77d34ef12718184be94c5b14a27ce">betoh</a>(fbr.height);
<a name="l00540"></a>00540 
<a name="l00541"></a>00541     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(VNC, <span class="stringliteral">&quot; -- x = %d y = %d w = %d h = %d\n&quot;</span>, fbr.x, fbr.y, fbr.width,
<a name="l00542"></a>00542             fbr.height);
<a name="l00543"></a>00543 
<a name="l00544"></a>00544     <a class="code" href="classVncServer.html#a12fdf8396c8fe33bb93e66d7491fb497">sendFrameBufferUpdate</a>();
<a name="l00545"></a>00545 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6ad4e22608f77193eb9cddb1c8b20703"></a><!-- doxytag: member="VncServer::sendError" ref="a6ad4e22608f77193eb9cddb1c8b20703" args="(std::string error_msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sendError </td>
          <td>(</td>
          <td class="paramtype">std::string&nbsp;</td>
          <td class="paramname"> <em>error_msg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Send an error message to the client when something goes wrong </p>
<dl><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>error_msg</em>&nbsp;</td><td>error to send </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a3531045d065c2aa1aaf5a225e2337e80"></a><!-- doxytag: member="VncServer::sendError" ref="a3531045d065c2aa1aaf5a225e2337e80" args="(const char *error_msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sendError </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>error_msg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>vnc client Interface Send an error message to the client </p>
<dl><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>error_msg</em>&nbsp;</td><td>text to send describing the error </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l00361"></a>00361 {
<a name="l00362"></a>00362    <a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> <a class="code" href="namespaceArmISA.html#a41a9f22a6c7645fac2f8d633371e354d">len</a> = strlen(error_msg);
<a name="l00363"></a>00363    <a class="code" href="classVncServer.html#a215d71301eb6ae0ebffc5d2f8fe4a140">write</a>(&amp;len);
<a name="l00364"></a>00364    <a class="code" href="classVncServer.html#a215d71301eb6ae0ebffc5d2f8fe4a140">write</a>(error_msg);
<a name="l00365"></a>00365 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a046eae8a3566418d4f03a95de5d1af13"></a><!-- doxytag: member="VncServer::sendFrameBufferResized" ref="a046eae8a3566418d4f03a95de5d1af13" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sendFrameBufferResized </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Tell the client that the frame buffer resized. This happens when the simulated system changes video modes (E.g. X11 starts). </p>

<p><div class="fragment"><pre class="fragment"><a name="l00652"></a>00652 {
<a name="l00653"></a>00653     assert(<a class="code" href="classVncInput.html#abb84b49d0d59c2601f33b650316a4c50">fbPtr</a> &amp;&amp; <a class="code" href="classVncServer.html#ab9f945d843e004fbbb155b7709051470">dataFd</a> &gt; 0 &amp;&amp; <a class="code" href="classVncServer.html#ad0bc1d6a87b76d47489ca919f3ae51ca">curState</a> == <a class="code" href="group__VncConstants.html#ggacdd867d72142510ce53521a63a062f9ba6302b1455052baff1528e67e95db429a">NormalPhase</a>);
<a name="l00654"></a>00654     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(VNC, <span class="stringliteral">&quot;Sending framebuffer resize\n&quot;</span>);
<a name="l00655"></a>00655 
<a name="l00656"></a>00656     FrameBufferUpdate fbu;
<a name="l00657"></a>00657     FrameBufferRect fbr;
<a name="l00658"></a>00658 
<a name="l00659"></a>00659     fbu.type = <a class="code" href="group__VncConstants.html#gga98f897c5a38e76e2cc7fea4d87083a84afb5f87db0a4610309f486463de5388b7">ServerFrameBufferUpdate</a>;
<a name="l00660"></a>00660     fbu.num_rects = 1;
<a name="l00661"></a>00661     fbr.x = 0;
<a name="l00662"></a>00662     fbr.y = 0;
<a name="l00663"></a>00663     fbr.width = <a class="code" href="classVncInput.html#ab1e9571fac3dd138effbc19ec81536ce">videoWidth</a>();
<a name="l00664"></a>00664     fbr.height = <a class="code" href="classVncInput.html#aba9f8788e70eacd6c454abfe49de9c3c">videoHeight</a>();
<a name="l00665"></a>00665     fbr.encoding = <a class="code" href="group__VncConstants.html#gga0b9039f87c8a2980c4a6ab14b511760aa81cbe670fb7e962f4721e74d55bc66e5">EncodingDesktopSize</a>;
<a name="l00666"></a>00666 
<a name="l00667"></a>00667     <span class="comment">// fix up endian</span>
<a name="l00668"></a>00668     fbu.num_rects = <a class="code" href="byteswap_8hh.html#a0ec9bd801b3cff46ad2537234f1f1a67">htobe</a>(fbu.num_rects);
<a name="l00669"></a>00669     fbr.x = <a class="code" href="byteswap_8hh.html#a0ec9bd801b3cff46ad2537234f1f1a67">htobe</a>(fbr.x);
<a name="l00670"></a>00670     fbr.y = <a class="code" href="byteswap_8hh.html#a0ec9bd801b3cff46ad2537234f1f1a67">htobe</a>(fbr.y);
<a name="l00671"></a>00671     fbr.width = <a class="code" href="byteswap_8hh.html#a0ec9bd801b3cff46ad2537234f1f1a67">htobe</a>(fbr.width);
<a name="l00672"></a>00672     fbr.height = <a class="code" href="byteswap_8hh.html#a0ec9bd801b3cff46ad2537234f1f1a67">htobe</a>(fbr.height);
<a name="l00673"></a>00673     fbr.encoding = <a class="code" href="byteswap_8hh.html#a0ec9bd801b3cff46ad2537234f1f1a67">htobe</a>(fbr.encoding);
<a name="l00674"></a>00674 
<a name="l00675"></a>00675     <span class="comment">// send headers to client</span>
<a name="l00676"></a>00676     <a class="code" href="classVncServer.html#a215d71301eb6ae0ebffc5d2f8fe4a140">write</a>(&amp;fbu);
<a name="l00677"></a>00677     <a class="code" href="classVncServer.html#a215d71301eb6ae0ebffc5d2f8fe4a140">write</a>(&amp;fbr);
<a name="l00678"></a>00678 
<a name="l00679"></a>00679     <span class="comment">// No actual data is sent in this message</span>
<a name="l00680"></a>00680 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a12fdf8396c8fe33bb93e66d7491fb497"></a><!-- doxytag: member="VncServer::sendFrameBufferUpdate" ref="a12fdf8396c8fe33bb93e66d7491fb497" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sendFrameBufferUpdate </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Send a updated frame buffer to the client. </p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000011">TODO:</a></b></dt><dd>this doesn't do anything smart and just sends the entire image </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00605"></a>00605 {
<a name="l00606"></a>00606 
<a name="l00607"></a>00607     <span class="keywordflow">if</span> (!<a class="code" href="classVncInput.html#abb84b49d0d59c2601f33b650316a4c50">fbPtr</a> || <a class="code" href="classVncServer.html#ab9f945d843e004fbbb155b7709051470">dataFd</a> &lt;= 0 || <a class="code" href="classVncServer.html#ad0bc1d6a87b76d47489ca919f3ae51ca">curState</a> != <a class="code" href="group__VncConstants.html#ggacdd867d72142510ce53521a63a062f9ba6302b1455052baff1528e67e95db429a">NormalPhase</a> || !<a class="code" href="classVncServer.html#ab2b958eb553dde858c8737b57614e87d">sendUpdate</a>) {
<a name="l00608"></a>00608         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(VNC, <span class="stringliteral">&quot;NOT sending framebuffer update\n&quot;</span>);
<a name="l00609"></a>00609         <span class="keywordflow">return</span>;
<a name="l00610"></a>00610     }
<a name="l00611"></a>00611 
<a name="l00612"></a>00612     assert(<a class="code" href="classVncInput.html#ad44402c880e7d76c01c4085aeecc8bc0">vc</a>);
<a name="l00613"></a>00613 
<a name="l00614"></a>00614     <span class="comment">// The client will request data constantly, unless we throttle it</span>
<a name="l00615"></a>00615     <a class="code" href="classVncServer.html#ab2b958eb553dde858c8737b57614e87d">sendUpdate</a> = <span class="keyword">false</span>;
<a name="l00616"></a>00616 
<a name="l00617"></a>00617     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(VNC, <span class="stringliteral">&quot;Sending framebuffer update\n&quot;</span>);
<a name="l00618"></a>00618 
<a name="l00619"></a>00619     FrameBufferUpdate fbu;
<a name="l00620"></a>00620     FrameBufferRect fbr;
<a name="l00621"></a>00621 
<a name="l00622"></a>00622     fbu.type = <a class="code" href="group__VncConstants.html#gga98f897c5a38e76e2cc7fea4d87083a84afb5f87db0a4610309f486463de5388b7">ServerFrameBufferUpdate</a>;
<a name="l00623"></a>00623     fbu.num_rects = 1;
<a name="l00624"></a>00624     fbr.x = 0;
<a name="l00625"></a>00625     fbr.y = 0;
<a name="l00626"></a>00626     fbr.width = <a class="code" href="classVncInput.html#ab1e9571fac3dd138effbc19ec81536ce">videoWidth</a>();
<a name="l00627"></a>00627     fbr.height = <a class="code" href="classVncInput.html#aba9f8788e70eacd6c454abfe49de9c3c">videoHeight</a>();
<a name="l00628"></a>00628     fbr.encoding = <a class="code" href="group__VncConstants.html#gga0b9039f87c8a2980c4a6ab14b511760aa2929e8976a78e5a5e8829beae2a7e69e">EncodingRaw</a>;
<a name="l00629"></a>00629 
<a name="l00630"></a>00630     <span class="comment">// fix up endian</span>
<a name="l00631"></a>00631     fbu.num_rects = <a class="code" href="byteswap_8hh.html#a0ec9bd801b3cff46ad2537234f1f1a67">htobe</a>(fbu.num_rects);
<a name="l00632"></a>00632     fbr.x = <a class="code" href="byteswap_8hh.html#a0ec9bd801b3cff46ad2537234f1f1a67">htobe</a>(fbr.x);
<a name="l00633"></a>00633     fbr.y = <a class="code" href="byteswap_8hh.html#a0ec9bd801b3cff46ad2537234f1f1a67">htobe</a>(fbr.y);
<a name="l00634"></a>00634     fbr.width = <a class="code" href="byteswap_8hh.html#a0ec9bd801b3cff46ad2537234f1f1a67">htobe</a>(fbr.width);
<a name="l00635"></a>00635     fbr.height = <a class="code" href="byteswap_8hh.html#a0ec9bd801b3cff46ad2537234f1f1a67">htobe</a>(fbr.height);
<a name="l00636"></a>00636     fbr.encoding = <a class="code" href="byteswap_8hh.html#a0ec9bd801b3cff46ad2537234f1f1a67">htobe</a>(fbr.encoding);
<a name="l00637"></a>00637 
<a name="l00638"></a>00638     <span class="comment">// send headers to client</span>
<a name="l00639"></a>00639     <a class="code" href="classVncServer.html#a215d71301eb6ae0ebffc5d2f8fe4a140">write</a>(&amp;fbu);
<a name="l00640"></a>00640     <a class="code" href="classVncServer.html#a215d71301eb6ae0ebffc5d2f8fe4a140">write</a>(&amp;fbr);
<a name="l00641"></a>00641 
<a name="l00642"></a>00642     assert(<a class="code" href="classVncInput.html#abb84b49d0d59c2601f33b650316a4c50">fbPtr</a>);
<a name="l00643"></a>00643 
<a name="l00644"></a>00644     uint8_t *tmp = <a class="code" href="classVncInput.html#ad44402c880e7d76c01c4085aeecc8bc0">vc</a>-&gt;<a class="code" href="classVideoConvert.html#a9d6b4342acae62e284ca3a200af30554">convert</a>(<a class="code" href="classVncInput.html#abb84b49d0d59c2601f33b650316a4c50">fbPtr</a>);
<a name="l00645"></a>00645     <a class="code" href="classVncServer.html#a215d71301eb6ae0ebffc5d2f8fe4a140">write</a>(tmp, <a class="code" href="classVncInput.html#ab1e9571fac3dd138effbc19ec81536ce">videoWidth</a>() * <a class="code" href="classVncInput.html#aba9f8788e70eacd6c454abfe49de9c3c">videoHeight</a>() * <span class="keyword">sizeof</span>(<a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>));
<a name="l00646"></a>00646     <span class="keyword">delete</span> [] tmp;
<a name="l00647"></a>00647 
<a name="l00648"></a>00648 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0d7d773b4b3948da49ae2ecd00f985d5"></a><!-- doxytag: member="VncServer::sendServerInit" ref="a0d7d773b4b3948da49ae2ecd00f985d5" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sendServerInit </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Send client our idea about what the frame buffer looks like </p>

<p><div class="fragment"><pre class="fragment"><a name="l00438"></a>00438 {
<a name="l00439"></a>00439     ServerInitMsg msg;
<a name="l00440"></a>00440 
<a name="l00441"></a>00441     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(VNC, <span class="stringliteral">&quot;Sending server init message to client\n&quot;</span>);
<a name="l00442"></a>00442 
<a name="l00443"></a>00443     msg.fbWidth = <a class="code" href="byteswap_8hh.html#a0ec9bd801b3cff46ad2537234f1f1a67">htobe</a>(<a class="code" href="classVncInput.html#ab1e9571fac3dd138effbc19ec81536ce">videoWidth</a>());
<a name="l00444"></a>00444     msg.fbHeight = <a class="code" href="byteswap_8hh.html#a0ec9bd801b3cff46ad2537234f1f1a67">htobe</a>(<a class="code" href="classVncInput.html#aba9f8788e70eacd6c454abfe49de9c3c">videoHeight</a>());
<a name="l00445"></a>00445 
<a name="l00446"></a>00446     msg.px.bpp = <a class="code" href="byteswap_8hh.html#a0ec9bd801b3cff46ad2537234f1f1a67">htobe</a>(<a class="code" href="classVncServer.html#a126e69cd1de897ecc9b84e858e4809c7">pixelFormat</a>.<a class="code" href="structVncInput_1_1PixelFormat.html#a496818f626ceb32365ca6cf57c991979">bpp</a>);
<a name="l00447"></a>00447     msg.px.depth = <a class="code" href="byteswap_8hh.html#a0ec9bd801b3cff46ad2537234f1f1a67">htobe</a>(<a class="code" href="classVncServer.html#a126e69cd1de897ecc9b84e858e4809c7">pixelFormat</a>.<a class="code" href="structVncInput_1_1PixelFormat.html#ab6f276082172be43a6041212071e377b">depth</a>);
<a name="l00448"></a>00448     msg.px.bigendian = <a class="code" href="byteswap_8hh.html#a0ec9bd801b3cff46ad2537234f1f1a67">htobe</a>(<a class="code" href="classVncServer.html#a126e69cd1de897ecc9b84e858e4809c7">pixelFormat</a>.<a class="code" href="structVncInput_1_1PixelFormat.html#a4d868ea999e3357d3046b00014455b6e">bigendian</a>);
<a name="l00449"></a>00449     msg.px.truecolor = <a class="code" href="byteswap_8hh.html#a0ec9bd801b3cff46ad2537234f1f1a67">htobe</a>(<a class="code" href="classVncServer.html#a126e69cd1de897ecc9b84e858e4809c7">pixelFormat</a>.<a class="code" href="structVncInput_1_1PixelFormat.html#ab14b7ec53c8b8d397a4abb2c61f3dde6">truecolor</a>);
<a name="l00450"></a>00450     msg.px.redmax = <a class="code" href="byteswap_8hh.html#a0ec9bd801b3cff46ad2537234f1f1a67">htobe</a>(<a class="code" href="classVncServer.html#a126e69cd1de897ecc9b84e858e4809c7">pixelFormat</a>.<a class="code" href="structVncInput_1_1PixelFormat.html#a55af395a54c61a9e6118f09dfbcaa45e">redmax</a>);
<a name="l00451"></a>00451     msg.px.greenmax = <a class="code" href="byteswap_8hh.html#a0ec9bd801b3cff46ad2537234f1f1a67">htobe</a>(<a class="code" href="classVncServer.html#a126e69cd1de897ecc9b84e858e4809c7">pixelFormat</a>.<a class="code" href="structVncInput_1_1PixelFormat.html#ae8bacdd4bc66c207a91914a5eb0fb1c9">greenmax</a>);
<a name="l00452"></a>00452     msg.px.bluemax = <a class="code" href="byteswap_8hh.html#a0ec9bd801b3cff46ad2537234f1f1a67">htobe</a>(<a class="code" href="classVncServer.html#a126e69cd1de897ecc9b84e858e4809c7">pixelFormat</a>.<a class="code" href="structVncInput_1_1PixelFormat.html#adfda5ca4cddee763bdf6c78777593328">bluemax</a>);
<a name="l00453"></a>00453     msg.px.redshift = <a class="code" href="byteswap_8hh.html#a0ec9bd801b3cff46ad2537234f1f1a67">htobe</a>(<a class="code" href="classVncServer.html#a126e69cd1de897ecc9b84e858e4809c7">pixelFormat</a>.<a class="code" href="structVncInput_1_1PixelFormat.html#ae651b46b775055134b81e5055203facf">redshift</a>);
<a name="l00454"></a>00454     msg.px.greenshift = <a class="code" href="byteswap_8hh.html#a0ec9bd801b3cff46ad2537234f1f1a67">htobe</a>(<a class="code" href="classVncServer.html#a126e69cd1de897ecc9b84e858e4809c7">pixelFormat</a>.<a class="code" href="structVncInput_1_1PixelFormat.html#ae51a571c5df8d325edb011c3c93532c2">greenshift</a>);
<a name="l00455"></a>00455     msg.px.blueshift = <a class="code" href="byteswap_8hh.html#a0ec9bd801b3cff46ad2537234f1f1a67">htobe</a>(<a class="code" href="classVncServer.html#a126e69cd1de897ecc9b84e858e4809c7">pixelFormat</a>.<a class="code" href="structVncInput_1_1PixelFormat.html#afbb2c2bc76b4cc4e8552fc47403c4786">blueshift</a>);
<a name="l00456"></a>00456     memset(msg.px.padding, 0, 3);
<a name="l00457"></a>00457     msg.namelen = 2;
<a name="l00458"></a>00458     msg.namelen = <a class="code" href="byteswap_8hh.html#a0ec9bd801b3cff46ad2537234f1f1a67">htobe</a>(msg.namelen);
<a name="l00459"></a>00459     memcpy(msg.name, <span class="stringliteral">&quot;M5&quot;</span>, 2);
<a name="l00460"></a>00460 
<a name="l00461"></a>00461     <a class="code" href="classVncServer.html#a215d71301eb6ae0ebffc5d2f8fe4a140">write</a>(&amp;msg);
<a name="l00462"></a>00462     <a class="code" href="classVncServer.html#ad0bc1d6a87b76d47489ca919f3ae51ca">curState</a> = <a class="code" href="group__VncConstants.html#ggacdd867d72142510ce53521a63a062f9ba6302b1455052baff1528e67e95db429a">NormalPhase</a>;
<a name="l00463"></a>00463 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a92a590790db6444ca7a79eaf5fbcb0d9"></a><!-- doxytag: member="VncServer::setDirty" ref="a92a590790db6444ca7a79eaf5fbcb0d9" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void setDirty </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>The frame buffer uses this call to notify the vnc server that the frame buffer has been updated and a new image needs to be sent to the client </p>

<p><a class="el" href="classVncInput.html#ad7eac728ea55298c7691e7d1c165719b">VncInput</a>を再定義しています。</p>

<p><div class="fragment"><pre class="fragment"><a name="l00315"></a>00315     {
<a name="l00316"></a>00316         <a class="code" href="classVncServer.html#a92a590790db6444ca7a79eaf5fbcb0d9">VncInput::setDirty</a>();
<a name="l00317"></a>00317         <a class="code" href="classVncServer.html#ab2b958eb553dde858c8737b57614e87d">sendUpdate</a> = <span class="keyword">true</span>;
<a name="l00318"></a>00318         <a class="code" href="classVncServer.html#a12fdf8396c8fe33bb93e66d7491fb497">sendFrameBufferUpdate</a>();
<a name="l00319"></a>00319     }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a840599118004b7df093bd78b6a21e56b"></a><!-- doxytag: member="VncServer::setEncodings" ref="a840599118004b7df093bd78b6a21e56b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void setEncodings </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Receive encodings message from client and process it. </p>

<p><div class="fragment"><pre class="fragment"><a name="l00496"></a>00496 {
<a name="l00497"></a>00497     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(VNC, <span class="stringliteral">&quot;Received supported encodings from client\n&quot;</span>);
<a name="l00498"></a>00498 
<a name="l00499"></a>00499     PixelEncodingsMessage pem;
<a name="l00500"></a>00500     <a class="code" href="classVncServer.html#ab265cdc9659b04aafe0b93e866024a6d">read1</a>((uint8_t*)&amp;pem, <span class="keyword">sizeof</span>(PixelEncodingsMessage));
<a name="l00501"></a>00501 
<a name="l00502"></a>00502     pem.num_encodings = <a class="code" href="byteswap_8hh.html#a2af77d34ef12718184be94c5b14a27ce">betoh</a>(pem.num_encodings);
<a name="l00503"></a>00503 
<a name="l00504"></a>00504     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(VNC, <span class="stringliteral">&quot; -- %d encoding present\n&quot;</span>, pem.num_encodings);
<a name="l00505"></a>00505     <a class="code" href="classVncServer.html#a1286ea1dbf0c332e14ccfc0267de405e">supportsRawEnc</a> = <a class="code" href="classVncServer.html#a68ae35695f8a6dcd68d9ff80dee28736">supportsResizeEnc</a> = <span class="keyword">false</span>;
<a name="l00506"></a>00506 
<a name="l00507"></a>00507     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespaceX86ISA.html#ab5f9a01fc40e47853ae9551b008afcbd">x</a> = 0; <a class="code" href="namespaceX86ISA.html#ab5f9a01fc40e47853ae9551b008afcbd">x</a> &lt; pem.num_encodings; <a class="code" href="namespaceX86ISA.html#ab5f9a01fc40e47853ae9551b008afcbd">x</a>++) {
<a name="l00508"></a>00508         int32_t <a class="code" href="namespaceArmISA.html#a8da691ea158973ca44476de7005c1518">encoding</a>;
<a name="l00509"></a>00509         <span class="keywordtype">size_t</span> <a class="code" href="namespaceArmISA.html#a41a9f22a6c7645fac2f8d633371e354d">len</a> M5_VAR_USED;
<a name="l00510"></a>00510         <a class="code" href="namespaceArmISA.html#a41a9f22a6c7645fac2f8d633371e354d">len</a> = <a class="code" href="classVncServer.html#a9f8a094b410fa145da19663f83f241e3">read</a>(&amp;encoding);
<a name="l00511"></a>00511         assert(<a class="code" href="namespaceArmISA.html#a41a9f22a6c7645fac2f8d633371e354d">len</a> == <span class="keyword">sizeof</span>(encoding));
<a name="l00512"></a>00512         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(VNC, <span class="stringliteral">&quot; -- supports %d\n&quot;</span>, <a class="code" href="byteswap_8hh.html#a2af77d34ef12718184be94c5b14a27ce">betoh</a>(encoding));
<a name="l00513"></a>00513 
<a name="l00514"></a>00514         <span class="keywordflow">switch</span> (<a class="code" href="byteswap_8hh.html#a2af77d34ef12718184be94c5b14a27ce">betoh</a>(encoding)) {
<a name="l00515"></a>00515           <span class="keywordflow">case</span> <a class="code" href="group__VncConstants.html#gga0b9039f87c8a2980c4a6ab14b511760aa2929e8976a78e5a5e8829beae2a7e69e">EncodingRaw</a>:
<a name="l00516"></a>00516             <a class="code" href="classVncServer.html#a1286ea1dbf0c332e14ccfc0267de405e">supportsRawEnc</a> = <span class="keyword">true</span>;
<a name="l00517"></a>00517             <span class="keywordflow">break</span>;
<a name="l00518"></a>00518           <span class="keywordflow">case</span> <a class="code" href="group__VncConstants.html#gga0b9039f87c8a2980c4a6ab14b511760aa81cbe670fb7e962f4721e74d55bc66e5">EncodingDesktopSize</a>:
<a name="l00519"></a>00519             <a class="code" href="classVncServer.html#a68ae35695f8a6dcd68d9ff80dee28736">supportsResizeEnc</a> = <span class="keyword">true</span>;
<a name="l00520"></a>00520             <span class="keywordflow">break</span>;
<a name="l00521"></a>00521         }
<a name="l00522"></a>00522     }
<a name="l00523"></a>00523 
<a name="l00524"></a>00524     <span class="keywordflow">if</span> (!<a class="code" href="classVncServer.html#a1286ea1dbf0c332e14ccfc0267de405e">supportsRawEnc</a>)
<a name="l00525"></a>00525         <a class="code" href="base_2misc_8hh.html#acad519418dbfdd70c1208711e609c80e">fatal</a>(<span class="stringliteral">&quot;VNC clients must always support raw encoding\n&quot;</span>);
<a name="l00526"></a>00526 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9abef13e07371ccf4a89883649f1bcc5"></a><!-- doxytag: member="VncServer::setFrameBufferParams" ref="a9abef13e07371ccf4a89883649f1bcc5" args="(VideoConvert::Mode mode, uint16_t width, uint16_t height)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void setFrameBufferParams </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classVideoConvert.html#a46c8a310cf4c094f8c80e1cb8dc1f911">VideoConvert::Mode</a>&nbsp;</td>
          <td class="paramname"> <em>mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&nbsp;</td>
          <td class="paramname"> <em>width</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&nbsp;</td>
          <td class="paramname"> <em>height</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p><a class="el" href="classSet.html">Set</a> the mode of the data the frame buffer will be sending us </p>
<dl><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>mode</em>&nbsp;</td><td>the mode </td></tr>
  </table>
  </dd>
</dl>

<p><a class="el" href="classVncInput.html#a9abef13e07371ccf4a89883649f1bcc5">VncInput</a>を再定義しています。</p>

<p><div class="fragment"><pre class="fragment"><a name="l00685"></a>00685 {
<a name="l00686"></a>00686     <a class="code" href="classVncServer.html#a9abef13e07371ccf4a89883649f1bcc5">VncInput::setFrameBufferParams</a>(<a class="code" href="namespaceArmISA.html#a5f3b9b97eb2dfa29d33e74878455f90d">mode</a>, <a class="code" href="namespaceArmISA.html#a0da89c280130b84ae26405a901396428">width</a>, height);
<a name="l00687"></a>00687 
<a name="l00688"></a>00688     <span class="keywordflow">if</span> (<a class="code" href="namespaceArmISA.html#a5f3b9b97eb2dfa29d33e74878455f90d">mode</a> != <a class="code" href="classVncInput.html#a697b3d40f1cd2cf07b3679c99f92efa6">videoMode</a> || <a class="code" href="namespaceArmISA.html#a0da89c280130b84ae26405a901396428">width</a> != <a class="code" href="classVncInput.html#ab1e9571fac3dd138effbc19ec81536ce">videoWidth</a>() || height != <a class="code" href="classVncInput.html#aba9f8788e70eacd6c454abfe49de9c3c">videoHeight</a>()) {
<a name="l00689"></a>00689         <span class="keywordflow">if</span> (<a class="code" href="classVncServer.html#ab9f945d843e004fbbb155b7709051470">dataFd</a> &gt; 0 &amp;&amp; <a class="code" href="classVncInput.html#abb84b49d0d59c2601f33b650316a4c50">fbPtr</a> &amp;&amp; <a class="code" href="classVncServer.html#ad0bc1d6a87b76d47489ca919f3ae51ca">curState</a> == <a class="code" href="group__VncConstants.html#ggacdd867d72142510ce53521a63a062f9ba6302b1455052baff1528e67e95db429a">NormalPhase</a>) {
<a name="l00690"></a>00690             <span class="keywordflow">if</span> (<a class="code" href="classVncServer.html#a68ae35695f8a6dcd68d9ff80dee28736">supportsResizeEnc</a>)
<a name="l00691"></a>00691                 <a class="code" href="classVncServer.html#a046eae8a3566418d4f03a95de5d1af13">sendFrameBufferResized</a>();
<a name="l00692"></a>00692             <span class="keywordflow">else</span>
<a name="l00693"></a>00693                 <span class="comment">// The frame buffer changed size and we can&apos;t update the client</span>
<a name="l00694"></a>00694                 <a class="code" href="classVncServer.html#ac295bade8aee589f6718dfa79edc2a34">detach</a>();
<a name="l00695"></a>00695         }
<a name="l00696"></a>00696     }
<a name="l00697"></a>00697 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad52ea030be3bb8b536f8a7f87b709319"></a><!-- doxytag: member="VncServer::setPixelFormat" ref="ad52ea030be3bb8b536f8a7f87b709319" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void setPixelFormat </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Receive pixel foramt message from client and process it. </p>

<p><div class="fragment"><pre class="fragment"><a name="l00467"></a>00467 {
<a name="l00468"></a>00468     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(VNC, <span class="stringliteral">&quot;Received pixel format from client message\n&quot;</span>);
<a name="l00469"></a>00469 
<a name="l00470"></a>00470     PixelFormatMessage pfm;
<a name="l00471"></a>00471     <a class="code" href="classVncServer.html#ab265cdc9659b04aafe0b93e866024a6d">read1</a>((uint8_t*)&amp;pfm, <span class="keyword">sizeof</span>(PixelFormatMessage));
<a name="l00472"></a>00472 
<a name="l00473"></a>00473     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(VNC, <span class="stringliteral">&quot; -- bpp = %d; depth = %d; be = %d\n&quot;</span>, pfm.px.bpp,
<a name="l00474"></a>00474             pfm.px.depth, pfm.px.bigendian);
<a name="l00475"></a>00475     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(VNC, <span class="stringliteral">&quot; -- true color = %d red,green,blue max = %d,%d,%d\n&quot;</span>,
<a name="l00476"></a>00476             pfm.px.truecolor, <a class="code" href="byteswap_8hh.html#a2af77d34ef12718184be94c5b14a27ce">betoh</a>(pfm.px.redmax), <a class="code" href="byteswap_8hh.html#a2af77d34ef12718184be94c5b14a27ce">betoh</a>(pfm.px.greenmax),
<a name="l00477"></a>00477                 <a class="code" href="byteswap_8hh.html#a2af77d34ef12718184be94c5b14a27ce">betoh</a>(pfm.px.bluemax));
<a name="l00478"></a>00478     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(VNC, <span class="stringliteral">&quot; -- red,green,blue shift = %d,%d,%d\n&quot;</span>, pfm.px.redshift,
<a name="l00479"></a>00479             pfm.px.greenshift, pfm.px.blueshift);
<a name="l00480"></a>00480 
<a name="l00481"></a>00481     <span class="keywordflow">if</span> (<a class="code" href="byteswap_8hh.html#a2af77d34ef12718184be94c5b14a27ce">betoh</a>(pfm.px.bpp) != <a class="code" href="classVncServer.html#a126e69cd1de897ecc9b84e858e4809c7">pixelFormat</a>.<a class="code" href="structVncInput_1_1PixelFormat.html#a496818f626ceb32365ca6cf57c991979">bpp</a> ||
<a name="l00482"></a>00482         <a class="code" href="byteswap_8hh.html#a2af77d34ef12718184be94c5b14a27ce">betoh</a>(pfm.px.depth) != <a class="code" href="classVncServer.html#a126e69cd1de897ecc9b84e858e4809c7">pixelFormat</a>.<a class="code" href="structVncInput_1_1PixelFormat.html#ab6f276082172be43a6041212071e377b">depth</a> ||
<a name="l00483"></a>00483         <a class="code" href="byteswap_8hh.html#a2af77d34ef12718184be94c5b14a27ce">betoh</a>(pfm.px.bigendian) != <a class="code" href="classVncServer.html#a126e69cd1de897ecc9b84e858e4809c7">pixelFormat</a>.<a class="code" href="structVncInput_1_1PixelFormat.html#a4d868ea999e3357d3046b00014455b6e">bigendian</a> ||
<a name="l00484"></a>00484         <a class="code" href="byteswap_8hh.html#a2af77d34ef12718184be94c5b14a27ce">betoh</a>(pfm.px.truecolor) != <a class="code" href="classVncServer.html#a126e69cd1de897ecc9b84e858e4809c7">pixelFormat</a>.<a class="code" href="structVncInput_1_1PixelFormat.html#ab14b7ec53c8b8d397a4abb2c61f3dde6">truecolor</a> ||
<a name="l00485"></a>00485         <a class="code" href="byteswap_8hh.html#a2af77d34ef12718184be94c5b14a27ce">betoh</a>(pfm.px.redmax) != <a class="code" href="classVncServer.html#a126e69cd1de897ecc9b84e858e4809c7">pixelFormat</a>.<a class="code" href="structVncInput_1_1PixelFormat.html#a55af395a54c61a9e6118f09dfbcaa45e">redmax</a> ||
<a name="l00486"></a>00486         <a class="code" href="byteswap_8hh.html#a2af77d34ef12718184be94c5b14a27ce">betoh</a>(pfm.px.greenmax) != <a class="code" href="classVncServer.html#a126e69cd1de897ecc9b84e858e4809c7">pixelFormat</a>.<a class="code" href="structVncInput_1_1PixelFormat.html#ae8bacdd4bc66c207a91914a5eb0fb1c9">greenmax</a> ||
<a name="l00487"></a>00487         <a class="code" href="byteswap_8hh.html#a2af77d34ef12718184be94c5b14a27ce">betoh</a>(pfm.px.bluemax) != <a class="code" href="classVncServer.html#a126e69cd1de897ecc9b84e858e4809c7">pixelFormat</a>.<a class="code" href="structVncInput_1_1PixelFormat.html#adfda5ca4cddee763bdf6c78777593328">bluemax</a> ||
<a name="l00488"></a>00488         <a class="code" href="byteswap_8hh.html#a2af77d34ef12718184be94c5b14a27ce">betoh</a>(pfm.px.redshift) != <a class="code" href="classVncServer.html#a126e69cd1de897ecc9b84e858e4809c7">pixelFormat</a>.<a class="code" href="structVncInput_1_1PixelFormat.html#ae651b46b775055134b81e5055203facf">redshift</a> ||
<a name="l00489"></a>00489         <a class="code" href="byteswap_8hh.html#a2af77d34ef12718184be94c5b14a27ce">betoh</a>(pfm.px.greenshift) != <a class="code" href="classVncServer.html#a126e69cd1de897ecc9b84e858e4809c7">pixelFormat</a>.<a class="code" href="structVncInput_1_1PixelFormat.html#ae51a571c5df8d325edb011c3c93532c2">greenshift</a> ||
<a name="l00490"></a>00490         <a class="code" href="byteswap_8hh.html#a2af77d34ef12718184be94c5b14a27ce">betoh</a>(pfm.px.blueshift) != <a class="code" href="classVncServer.html#a126e69cd1de897ecc9b84e858e4809c7">pixelFormat</a>.<a class="code" href="structVncInput_1_1PixelFormat.html#afbb2c2bc76b4cc4e8552fc47403c4786">blueshift</a>)
<a name="l00491"></a>00491         <a class="code" href="base_2misc_8hh.html#acad519418dbfdd70c1208711e609c80e">fatal</a>(<span class="stringliteral">&quot;VNC client doesn&apos;t support true color raw encoding\n&quot;</span>);
<a name="l00492"></a>00492 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="add50e5436017b9c2f1e0d11c9476bf1b"></a><!-- doxytag: member="VncServer::write" ref="add50e5436017b9c2f1e0d11c9476bf1b" args="(const char *str)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t write </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>str</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Send a string to the client </p>
<dl><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>str</em>&nbsp;</td><td>string to transmit </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l00334"></a>00334 {
<a name="l00335"></a>00335     <span class="keywordflow">return</span> <a class="code" href="classVncServer.html#a215d71301eb6ae0ebffc5d2f8fe4a140">write</a>((uint8_t*)str, strlen(str));
<a name="l00336"></a>00336 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aefa1c03e3a1158303080d2702de2a11e"></a><!-- doxytag: member="VncServer::write" ref="aefa1c03e3a1158303080d2702de2a11e" args="(T *val)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t write </td>
          <td>(</td>
          <td class="paramtype">T *&nbsp;</td>
          <td class="paramname"> <em>val</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Templated version of the write function above to write simple data to the client </p>
<dl><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>val</em>&nbsp;</td><td>data to send to the client </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l00328"></a>00328 {
<a name="l00329"></a>00329     <span class="keywordflow">return</span> <a class="code" href="classVncServer.html#a215d71301eb6ae0ebffc5d2f8fe4a140">write</a>((uint8_t*)<a class="code" href="namespaceX86ISA.html#ae13bf1250853ff6b72aabe3c79b587cc">val</a>, <span class="keyword">sizeof</span>(T));
<a name="l00330"></a>00330 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a215d71301eb6ae0ebffc5d2f8fe4a140"></a><!-- doxytag: member="VncServer::write" ref="a215d71301eb6ae0ebffc5d2f8fe4a140" args="(const uint8_t *buf, size_t len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t write </td>
          <td>(</td>
          <td class="paramtype">const uint8_t *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>len</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Write a buffer to the client. </p>
<dl><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>buf</em>&nbsp;</td><td>buffer to send </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>len</em>&nbsp;</td><td>length of the buffer </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>戻り値:</b></dt><dd>number of bytes sent </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00312"></a>00312 {
<a name="l00313"></a>00313     <span class="keywordflow">if</span> (<a class="code" href="classVncServer.html#ab9f945d843e004fbbb155b7709051470">dataFd</a> &lt; 0)
<a name="l00314"></a>00314         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Vnc client not properly attached.\n&quot;</span>);
<a name="l00315"></a>00315 
<a name="l00316"></a>00316     ssize_t ret;
<a name="l00317"></a>00317     ret = <a class="code" href="atomicio_8cc.html#a301f476c6c8d75d54f43aea6ad1ff740">atomic_write</a>(<a class="code" href="classVncServer.html#ab9f945d843e004fbbb155b7709051470">dataFd</a>, buf, <a class="code" href="namespaceArmISA.html#a41a9f22a6c7645fac2f8d633371e354d">len</a>);
<a name="l00318"></a>00318 
<a name="l00319"></a>00319     <span class="keywordflow">if</span> (ret &lt; <a class="code" href="namespaceArmISA.html#a41a9f22a6c7645fac2f8d633371e354d">len</a>)
<a name="l00320"></a>00320         <a class="code" href="classVncServer.html#ac295bade8aee589f6718dfa79edc2a34">detach</a>();
<a name="l00321"></a>00321 
<a name="l00322"></a>00322     <span class="keywordflow">return</span> ret;
<a name="l00323"></a>00323 }
</pre></div></p>

</div>
</div>
<hr/><h2>フレンドと関連する関数</h2>
<a class="anchor" id="a8a93830b802d4fc8562fa54ead43b1f9"></a><!-- doxytag: member="VncServer::DataEvent" ref="a8a93830b802d4fc8562fa54ead43b1f9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">friend class <a class="el" href="classVncServer_1_1DataEvent.html">DataEvent</a><code> [friend]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a9465cdda0008b0e7b7f9ac919cd9cca6"></a><!-- doxytag: member="VncServer::ListenEvent" ref="a9465cdda0008b0e7b7f9ac919cd9cca6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">friend class <a class="el" href="classVncServer_1_1ListenEvent.html">ListenEvent</a><code> [friend]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/><h2>変数</h2>
<a class="anchor" id="ad0bc1d6a87b76d47489ca919f3ae51ca"></a><!-- doxytag: member="VncServer::curState" ref="ad0bc1d6a87b76d47489ca919f3ae51ca" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__VncConstants.html#gacdd867d72142510ce53521a63a062f9b">ConnectionState</a> <a class="el" href="classVncServer.html#ad0bc1d6a87b76d47489ca919f3ae51ca">curState</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>The rfb prototol state the connection is in </p>

</div>
</div>
<a class="anchor" id="a7a8501aba170bc353fe057e372612b93"></a><!-- doxytag: member="VncServer::dataEvent" ref="a7a8501aba170bc353fe057e372612b93" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classVncServer_1_1DataEvent.html">DataEvent</a>* <a class="el" href="classVncServer.html#a7a8501aba170bc353fe057e372612b93">dataEvent</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ab9f945d843e004fbbb155b7709051470"></a><!-- doxytag: member="VncServer::dataFd" ref="ab9f945d843e004fbbb155b7709051470" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classVncServer.html#ab9f945d843e004fbbb155b7709051470">dataFd</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="acf9ea448b26a541b4a197f1ca92f700b"></a><!-- doxytag: member="VncServer::listener" ref="acf9ea448b26a541b4a197f1ca92f700b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classListenSocket.html">ListenSocket</a> <a class="el" href="classVncServer.html#acf9ea448b26a541b4a197f1ca92f700b">listener</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ad7f258b1b869b6152bc5040c38b79d39"></a><!-- doxytag: member="VncServer::listenEvent" ref="ad7f258b1b869b6152bc5040c38b79d39" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classVncServer_1_1ListenEvent.html">ListenEvent</a>* <a class="el" href="classVncServer.html#ad7f258b1b869b6152bc5040c38b79d39">listenEvent</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a7106e2abc437ad981830d14176d15f09"></a><!-- doxytag: member="VncServer::number" ref="a7106e2abc437ad981830d14176d15f09" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classVncServer.html#a7106e2abc437ad981830d14176d15f09">number</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a126e69cd1de897ecc9b84e858e4809c7"></a><!-- doxytag: member="VncServer::pixelFormat" ref="a126e69cd1de897ecc9b84e858e4809c7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structVncInput_1_1PixelFormat.html">PixelFormat</a> <a class="el" href="classVncServer.html#a126e69cd1de897ecc9b84e858e4809c7">pixelFormat</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>The one and only pixel format we support </p>

</div>
</div>
<a class="anchor" id="ab2b958eb553dde858c8737b57614e87d"></a><!-- doxytag: member="VncServer::sendUpdate" ref="ab2b958eb553dde858c8737b57614e87d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classVncServer.html#ab2b958eb553dde858c8737b57614e87d">sendUpdate</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>An update needs to be sent to the client. Without doing this the client will constantly request data that is pointless </p>

</div>
</div>
<a class="anchor" id="a1286ea1dbf0c332e14ccfc0267de405e"></a><!-- doxytag: member="VncServer::supportsRawEnc" ref="a1286ea1dbf0c332e14ccfc0267de405e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classVncServer.html#a1286ea1dbf0c332e14ccfc0267de405e">supportsRawEnc</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>If the vnc client supports receiving raw data. It always should </p>

</div>
</div>
<a class="anchor" id="a68ae35695f8a6dcd68d9ff80dee28736"></a><!-- doxytag: member="VncServer::supportsResizeEnc" ref="a68ae35695f8a6dcd68d9ff80dee28736" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classVncServer.html#a68ae35695f8a6dcd68d9ff80dee28736">supportsResizeEnc</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>If the vnc client supports the desktop resize command </p>

</div>
</div>
<hr/>このクラスの説明は次のファイルから生成されました:<ul>
<li>base/vnc/<a class="el" href="vncserver_8hh_source.html">vncserver.hh</a></li>
<li>base/vnc/<a class="el" href="vncserver_8cc.html">vncserver.cc</a></li>
</ul>
</div>
<hr size="1"/><address style="text-align: right;"><small>File&nbsp;GEM5&nbsp;Wrapperに対して25 May 2015に生成されました。&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
