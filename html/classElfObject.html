<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>File&nbsp;GEM5&nbsp;Wrapper: クラス ElfObject</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- 作成： Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>メインページ</span></a></li>
      <li><a href="pages.html"><span>関連ページ</span></a></li>
      <li><a href="modules.html"><span>モジュール</span></a></li>
      <li><a href="namespaces.html"><span>ネームスペース</span></a></li>
      <li class="current"><a href="annotated.html"><span>クラス</span></a></li>
      <li><a href="files.html"><span>ファイル</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>構成</span></a></li>
      <li><a href="classes.html"><span>構成索引</span></a></li>
      <li><a href="hierarchy.html"><span>クラス階層</span></a></li>
      <li><a href="functions.html"><span>構成メンバ</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>クラス ElfObject</h1><!-- doxytag: class="ElfObject" --><!-- doxytag: inherits="ObjectFile" -->
<p><code>#include &lt;<a class="el" href="elf__object_8hh_source.html">elf_object.hh</a>&gt;</code></p>
<div class="dynheader">
ElfObjectに対する継承グラフ</div>
<div class="dynsection">
 <div class="center">
  <img src="classElfObject.gif" usemap="#ElfObject_map" alt=""/>
  <map id="ElfObject_map" name="ElfObject_map">
<area href="classObjectFile.html" alt="ObjectFile" shape="rect" coords="0,0,70,24"/>
</map>
 </div>
</div>

<p><a href="classElfObject-members.html">すべてのメンバ一覧</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Public メソッド</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classElfObject.html#a19af560ae64a3da113d7fac40f776232">~ElfObject</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classElfObject.html#a69ba3469bb66a1ffa5049d581c1faf70">loadSections</a> (<a class="el" href="classPortProxy.html">PortProxy</a> &amp;memProxy, <a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a> addrMask=std::numeric_limits&lt; <a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a> &gt;::max(), <a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a> offset=0)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classElfObject.html#a1de102f86bbb53d20455d9e78be53935">loadGlobalSymbols</a> (SymbolTable *symtab, <a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a> addrMask=std::numeric_limits&lt; <a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a> &gt;::max())</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classElfObject.html#aab9393b89c15838ac1b842e642f981bb">loadLocalSymbols</a> (SymbolTable *symtab, <a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a> addrMask=std::numeric_limits&lt; <a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a> &gt;::max())</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classElfObject.html#a4469ce4747735e4ecee3a7d5edafaf54">loadWeakSymbols</a> (SymbolTable *symtab, <a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a> addrMask=std::numeric_limits&lt; <a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a> &gt;::max())</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classElfObject.html#adeb3f3d68421f3e5f75dbbdf998a21ac">isDynamic</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classElfObject.html#a1ed34e505be8c6dabe578012e35a0317">hasTLS</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classElfObject.html#acccc82a035ebb35744fea52a2b39cad7">programHeaderTable</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint16_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classElfObject.html#afcbc87834539817b70011c024ab08e95">programHeaderSize</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint16_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classElfObject.html#ac41b59a59e22c3f13e3b8377965610bb">programHeaderCount</a> ()</td></tr>
<tr><td colspan="2"><h2>Static Public メソッド</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classObjectFile.html">ObjectFile</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classElfObject.html#af96c4ced69d653731f78ba9d9006e251">tryFile</a> (const std::string &amp;fname, int fd, size_t <a class="el" href="classObjectFile.html#a7360b55975153b822efc5217b7734e6a">len</a>, uint8_t *<a class="el" href="classObjectFile.html#abbae3bd152e2d64768026e03593e64f3">data</a>)</td></tr>
<tr><td colspan="2"><h2>Protected 型</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef <a class="el" href="structObjectFile_1_1Section.html">ObjectFile::Section</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classElfObject.html#acafda0540ad31755ee35ed8a9e9c3e65">Segment</a></td></tr>
<tr><td colspan="2"><h2>Protected メソッド</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classElfObject.html#a0e172c4c18ce097d56ab99e41baed39b">loadSomeSymbols</a> (SymbolTable *symtab, int binding, <a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a> mask)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Helper functions for <a class="el" href="classElfObject.html#a1de102f86bbb53d20455d9e78be53935">loadGlobalSymbols()</a> and <a class="el" href="classElfObject.html#aab9393b89c15838ac1b842e642f981bb">loadLocalSymbols()</a>.  <a href="#a0e172c4c18ce097d56ab99e41baed39b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classElfObject.html#abc9df1f1dcb0d6c6f98d79fc0f53cb43">ElfObject</a> (const std::string &amp;_filename, int _fd, size_t _len, uint8_t *_data, <a class="el" href="classObjectFile.html#a0ac03ab06a859320a9072002bdf3aa0f">Arch</a> _arch, <a class="el" href="classObjectFile.html#aafc438343baf22e5884dde40c41331e8">OpSys</a> _opSys)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classElfObject.html#a7c222bfbc0dbfdb16cbdc408802ce451">getSections</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classElfObject.html#a5eb8917b5bb77054582ad80b5668e68e">sectionExists</a> (std::string sec)</td></tr>
<tr><td colspan="2"><h2>Protected 変数</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classElfObject.html#a86cf305b617197067a3d741dc4646d66">_programHeaderTable</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint16_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classElfObject.html#a6c5aa85cf3dfde11fb9fc2cfdecddaea">_programHeaderSize</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint16_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classElfObject.html#ad7aa9a59f82dc46c8a5a68cab78ac3d2">_programHeaderCount</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::set&lt; std::string &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classElfObject.html#a12c046b6e1d2d2dd42b6c0ac3bf34886">sectionNames</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classstd_1_1vector.html">std::vector</a>&lt; <a class="el" href="structObjectFile_1_1Section.html">Segment</a> &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classElfObject.html#a84eafac410719032b23da3704a22b143">extraSegments</a></td></tr>
</table>
<hr/><h2>型定義</h2>
<a class="anchor" id="acafda0540ad31755ee35ed8a9e9c3e65"></a><!-- doxytag: member="ElfObject::Segment" ref="acafda0540ad31755ee35ed8a9e9c3e65" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="structObjectFile_1_1Section.html">ObjectFile::Section</a> <a class="el" href="structObjectFile_1_1Section.html">Segment</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/><h2>コンストラクタとデストラクタ</h2>
<a class="anchor" id="abc9df1f1dcb0d6c6f98d79fc0f53cb43"></a><!-- doxytag: member="ElfObject::ElfObject" ref="abc9df1f1dcb0d6c6f98d79fc0f53cb43" args="(const std::string &amp;_filename, int _fd, size_t _len, uint8_t *_data, Arch _arch, OpSys _opSys)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classElfObject.html">ElfObject</a> </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&nbsp;</td>
          <td class="paramname"> <em>_filename</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>_fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&nbsp;</td>
          <td class="paramname"> <em>_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classObjectFile.html#a0ac03ab06a859320a9072002bdf3aa0f">Arch</a>&nbsp;</td>
          <td class="paramname"> <em>_arch</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classObjectFile.html#aafc438343baf22e5884dde40c41331e8">OpSys</a>&nbsp;</td>
          <td class="paramname"> <em>_opSys</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a19af560ae64a3da113d7fac40f776232"></a><!-- doxytag: member="ElfObject::~ElfObject" ref="a19af560ae64a3da113d7fac40f776232" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual ~<a class="el" href="classElfObject.html">ElfObject</a> </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00078"></a>00078 {}
</pre></div></p>

</div>
</div>
<hr/><h2>関数</h2>
<a class="anchor" id="a7c222bfbc0dbfdb16cbdc408802ce451"></a><!-- doxytag: member="ElfObject::getSections" ref="a7c222bfbc0dbfdb16cbdc408802ce451" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void getSections </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00458"></a>00458 {
<a name="l00459"></a>00459     Elf *elf;
<a name="l00460"></a>00460     <span class="keywordtype">int</span> sec_idx = 1; <span class="comment">// there is a 0 but it is nothing, go figure</span>
<a name="l00461"></a>00461     Elf_Scn *section;
<a name="l00462"></a>00462     GElf_Shdr shdr;
<a name="l00463"></a>00463 
<a name="l00464"></a>00464     GElf_Ehdr ehdr;
<a name="l00465"></a>00465 
<a name="l00466"></a>00466     assert(!<a class="code" href="classElfObject.html#a12c046b6e1d2d2dd42b6c0ac3bf34886">sectionNames</a>.size());
<a name="l00467"></a>00467 
<a name="l00468"></a>00468     <span class="comment">// check that header matches library version</span>
<a name="l00469"></a>00469     <span class="keywordflow">if</span> (elf_version(EV_CURRENT) == EV_NONE)
<a name="l00470"></a>00470         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;wrong elf version number!&quot;</span>);
<a name="l00471"></a>00471 
<a name="l00472"></a>00472     <span class="comment">// get a pointer to elf structure</span>
<a name="l00473"></a>00473     elf = elf_memory((<span class="keywordtype">char</span>*)<a class="code" href="classObjectFile.html#a3e95cf013fe7a42d87c9d64a0599776e">fileData</a>,<a class="code" href="classObjectFile.html#a7360b55975153b822efc5217b7734e6a">len</a>);
<a name="l00474"></a>00474     assert(elf != <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>);
<a name="l00475"></a>00475 
<a name="l00476"></a>00476     <span class="comment">// Check that we actually have a elf file</span>
<a name="l00477"></a>00477     <span class="keywordflow">if</span> (gelf_getehdr(elf, &amp;ehdr) ==0) {
<a name="l00478"></a>00478         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Not ELF, shouldn&apos;t be here&quot;</span>);
<a name="l00479"></a>00479     }
<a name="l00480"></a>00480 
<a name="l00481"></a>00481     <span class="comment">// Get the first section</span>
<a name="l00482"></a>00482     section = elf_getscn(elf, sec_idx);
<a name="l00483"></a>00483 
<a name="l00484"></a>00484     <span class="comment">// While there are no more sections</span>
<a name="l00485"></a>00485     <span class="keywordflow">while</span> (section != <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>) {
<a name="l00486"></a>00486         gelf_getshdr(section, &amp;shdr);
<a name="l00487"></a>00487         <a class="code" href="classElfObject.html#a12c046b6e1d2d2dd42b6c0ac3bf34886">sectionNames</a>.insert(elf_strptr(elf, ehdr.e_shstrndx, shdr.sh_name));
<a name="l00488"></a>00488         section = elf_getscn(elf, ++sec_idx);
<a name="l00489"></a>00489     } <span class="comment">// while sections</span>
<a name="l00490"></a>00490 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1ed34e505be8c6dabe578012e35a0317"></a><!-- doxytag: member="ElfObject::hasTLS" ref="a1ed34e505be8c6dabe578012e35a0317" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual bool hasTLS </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><a class="el" href="classObjectFile.html#a1ed34e505be8c6dabe578012e35a0317">ObjectFile</a>を再定義しています。</p>

<p><div class="fragment"><pre class="fragment"><a name="l00091"></a>00091 { <span class="keywordflow">return</span> <a class="code" href="classElfObject.html#a5eb8917b5bb77054582ad80b5668e68e">sectionExists</a>(<span class="stringliteral">&quot;.tbss&quot;</span>); }
</pre></div></p>

</div>
</div>
<a class="anchor" id="adeb3f3d68421f3e5f75dbbdf998a21ac"></a><!-- doxytag: member="ElfObject::isDynamic" ref="adeb3f3d68421f3e5f75dbbdf998a21ac" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual bool isDynamic </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><a class="el" href="classObjectFile.html#adeb3f3d68421f3e5f75dbbdf998a21ac">ObjectFile</a>を再定義しています。</p>

<p><div class="fragment"><pre class="fragment"><a name="l00090"></a>00090 { <span class="keywordflow">return</span> <a class="code" href="classElfObject.html#a5eb8917b5bb77054582ad80b5668e68e">sectionExists</a>(<span class="stringliteral">&quot;.interp&quot;</span>); }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1de102f86bbb53d20455d9e78be53935"></a><!-- doxytag: member="ElfObject::loadGlobalSymbols" ref="a1de102f86bbb53d20455d9e78be53935" args="(SymbolTable *symtab, Addr addrMask=std::numeric_limits&lt; Addr &gt;::max())" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool loadGlobalSymbols </td>
          <td>(</td>
          <td class="paramtype">SymbolTable *&nbsp;</td>
          <td class="paramname"> <em>symtab</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a>&nbsp;</td>
          <td class="paramname"> <em>addrMask</em> = <code>std::numeric_limits&lt;<a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a>&gt;::max()</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><a class="el" href="classObjectFile.html#abd8b86c98494f055ba7e0babbd55f4a0">ObjectFile</a>を実装しています。</p>

<p><div class="fragment"><pre class="fragment"><a name="l00422"></a>00422 {
<a name="l00423"></a>00423     <span class="keywordflow">return</span> <a class="code" href="classElfObject.html#a0e172c4c18ce097d56ab99e41baed39b" title="Helper functions for loadGlobalSymbols() and loadLocalSymbols().">loadSomeSymbols</a>(symtab, STB_GLOBAL, addrMask);
<a name="l00424"></a>00424 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aab9393b89c15838ac1b842e642f981bb"></a><!-- doxytag: member="ElfObject::loadLocalSymbols" ref="aab9393b89c15838ac1b842e642f981bb" args="(SymbolTable *symtab, Addr addrMask=std::numeric_limits&lt; Addr &gt;::max())" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool loadLocalSymbols </td>
          <td>(</td>
          <td class="paramtype">SymbolTable *&nbsp;</td>
          <td class="paramname"> <em>symtab</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a>&nbsp;</td>
          <td class="paramname"> <em>addrMask</em> = <code>std::numeric_limits&lt;<a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a>&gt;::max()</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><a class="el" href="classObjectFile.html#a15e7fbacc339ac9a4d50e4aa36591339">ObjectFile</a>を実装しています。</p>

<p><div class="fragment"><pre class="fragment"><a name="l00428"></a>00428 {
<a name="l00429"></a>00429     <span class="keywordtype">bool</span> found_local = <a class="code" href="classElfObject.html#a0e172c4c18ce097d56ab99e41baed39b" title="Helper functions for loadGlobalSymbols() and loadLocalSymbols().">loadSomeSymbols</a>(symtab, STB_LOCAL, addrMask);
<a name="l00430"></a>00430     <span class="keywordtype">bool</span> found_weak = <a class="code" href="classElfObject.html#a0e172c4c18ce097d56ab99e41baed39b" title="Helper functions for loadGlobalSymbols() and loadLocalSymbols().">loadSomeSymbols</a>(symtab, STB_WEAK, addrMask);
<a name="l00431"></a>00431     <span class="keywordflow">return</span> found_local || found_weak;
<a name="l00432"></a>00432 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a69ba3469bb66a1ffa5049d581c1faf70"></a><!-- doxytag: member="ElfObject::loadSections" ref="a69ba3469bb66a1ffa5049d581c1faf70" args="(PortProxy &amp;memProxy, Addr addrMask=std::numeric_limits&lt; Addr &gt;::max(), Addr offset=0)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool loadSections </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classPortProxy.html">PortProxy</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>memProxy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a>&nbsp;</td>
          <td class="paramname"> <em>addrMask</em> = <code>std::numeric_limits&lt;<a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a>&gt;::max()</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a>&nbsp;</td>
          <td class="paramname"> <em>offset</em> = <code>0</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><a class="el" href="classObjectFile.html#a69ba3469bb66a1ffa5049d581c1faf70">ObjectFile</a>を再定義しています。</p>

<p><div class="fragment"><pre class="fragment"><a name="l00442"></a>00442 {
<a name="l00443"></a>00443     <span class="keywordflow">if</span> (!<a class="code" href="classObjectFile.html#a69ba3469bb66a1ffa5049d581c1faf70">ObjectFile::loadSections</a>(memProxy, addrMask, <a class="code" href="namespaceArmISA.html#a87b7a740701cddafb930a9460e9f4eba">offset</a>))
<a name="l00444"></a>00444         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00445"></a>00445 
<a name="l00446"></a>00446     <a class="code" href="classstd_1_1vector.html">vector&lt;Segment&gt;::iterator</a> extraIt;
<a name="l00447"></a>00447     <span class="keywordflow">for</span> (extraIt = <a class="code" href="classElfObject.html#a84eafac410719032b23da3704a22b143">extraSegments</a>.begin();
<a name="l00448"></a>00448             extraIt != <a class="code" href="classElfObject.html#a84eafac410719032b23da3704a22b143">extraSegments</a>.end(); extraIt++) {
<a name="l00449"></a>00449         <span class="keywordflow">if</span> (!<a class="code" href="classObjectFile.html#aa7e7fd749b6ba3ce19c7d5a3032d890c">loadSection</a>(&amp;(*extraIt), memProxy, addrMask, <a class="code" href="namespaceArmISA.html#a87b7a740701cddafb930a9460e9f4eba">offset</a>)) {
<a name="l00450"></a>00450             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00451"></a>00451         }
<a name="l00452"></a>00452     }
<a name="l00453"></a>00453     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00454"></a>00454 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0e172c4c18ce097d56ab99e41baed39b"></a><!-- doxytag: member="ElfObject::loadSomeSymbols" ref="a0e172c4c18ce097d56ab99e41baed39b" args="(SymbolTable *symtab, int binding, Addr mask)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool loadSomeSymbols </td>
          <td>(</td>
          <td class="paramtype">SymbolTable *&nbsp;</td>
          <td class="paramname"> <em>symtab</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>binding</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a>&nbsp;</td>
          <td class="paramname"> <em>mask</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Helper functions for <a class="el" href="classElfObject.html#a1de102f86bbb53d20455d9e78be53935">loadGlobalSymbols()</a> and <a class="el" href="classElfObject.html#aab9393b89c15838ac1b842e642f981bb">loadLocalSymbols()</a>. </p>

<p><div class="fragment"><pre class="fragment"><a name="l00363"></a>00363 {
<a name="l00364"></a>00364     Elf *elf;
<a name="l00365"></a>00365     <span class="keywordtype">int</span> sec_idx = 1; <span class="comment">// there is a 0 but it is nothing, go figure</span>
<a name="l00366"></a>00366     Elf_Scn *section;
<a name="l00367"></a>00367     GElf_Shdr shdr;
<a name="l00368"></a>00368     Elf_Data *<a class="code" href="classObjectFile.html#abbae3bd152e2d64768026e03593e64f3">data</a>;
<a name="l00369"></a>00369     <span class="keywordtype">int</span> <a class="code" href="namespaceX86ISA.html#a668f84c330035fdb72824eb18e09cd09">count</a>, ii;
<a name="l00370"></a>00370     <span class="keywordtype">bool</span> found = <span class="keyword">false</span>;
<a name="l00371"></a>00371     GElf_Sym sym;
<a name="l00372"></a>00372 
<a name="l00373"></a>00373     <span class="keywordflow">if</span> (!symtab)
<a name="l00374"></a>00374         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00375"></a>00375 
<a name="l00376"></a>00376     <span class="comment">// check that header matches library version</span>
<a name="l00377"></a>00377     <span class="keywordflow">if</span> (elf_version(EV_CURRENT) == EV_NONE)
<a name="l00378"></a>00378         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;wrong elf version number!&quot;</span>);
<a name="l00379"></a>00379 
<a name="l00380"></a>00380     <span class="comment">// get a pointer to elf structure</span>
<a name="l00381"></a>00381     elf = elf_memory((<span class="keywordtype">char</span>*)<a class="code" href="classObjectFile.html#a3e95cf013fe7a42d87c9d64a0599776e">fileData</a>,<a class="code" href="classObjectFile.html#a7360b55975153b822efc5217b7734e6a">len</a>);
<a name="l00382"></a>00382 
<a name="l00383"></a>00383     assert(elf != <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>);
<a name="l00384"></a>00384 
<a name="l00385"></a>00385     <span class="comment">// Get the first section</span>
<a name="l00386"></a>00386     section = elf_getscn(elf, sec_idx);
<a name="l00387"></a>00387 
<a name="l00388"></a>00388     <span class="comment">// While there are no more sections</span>
<a name="l00389"></a>00389     <span class="keywordflow">while</span> (section != <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>) {
<a name="l00390"></a>00390         gelf_getshdr(section, &amp;shdr);
<a name="l00391"></a>00391 
<a name="l00392"></a>00392         <span class="keywordflow">if</span> (shdr.sh_type == SHT_SYMTAB) {
<a name="l00393"></a>00393             found = <span class="keyword">true</span>;
<a name="l00394"></a>00394             data = elf_getdata(section, <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>);
<a name="l00395"></a>00395             count = shdr.sh_size / shdr.sh_entsize;
<a name="l00396"></a>00396             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Loader, <span class="stringliteral">&quot;Found Symbol Table, %d symbols present\n&quot;</span>, count);
<a name="l00397"></a>00397 
<a name="l00398"></a>00398             <span class="comment">// loop through all the symbols, only loading global ones</span>
<a name="l00399"></a>00399             <span class="keywordflow">for</span> (ii = 0; ii &lt; count; ++ii) {
<a name="l00400"></a>00400                 gelf_getsym(data, ii, &amp;sym);
<a name="l00401"></a>00401                 <span class="keywordflow">if</span> (GELF_ST_BIND(sym.st_info) == binding) {
<a name="l00402"></a>00402                     <span class="keywordtype">char</span> *sym_name = elf_strptr(elf, shdr.sh_link, sym.st_name);
<a name="l00403"></a>00403                     <span class="keywordflow">if</span> (sym_name &amp;&amp; sym_name[0] != <span class="charliteral">&apos;$&apos;</span>) {
<a name="l00404"></a>00404                         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Loader, <span class="stringliteral">&quot;Symbol: %-40s value %#x\n&quot;</span>,
<a name="l00405"></a>00405                                 sym_name, sym.st_value);
<a name="l00406"></a>00406                         symtab-&gt;insert(sym.st_value &amp; <a class="code" href="namespaceArmISA.html#a9534dbda5e7db9881c7955c6e08cfdc0">mask</a>, sym_name);
<a name="l00407"></a>00407                     }
<a name="l00408"></a>00408                 }
<a name="l00409"></a>00409             }
<a name="l00410"></a>00410         }
<a name="l00411"></a>00411         ++sec_idx;
<a name="l00412"></a>00412         section = elf_getscn(elf, sec_idx);
<a name="l00413"></a>00413     }
<a name="l00414"></a>00414 
<a name="l00415"></a>00415     elf_end(elf);
<a name="l00416"></a>00416 
<a name="l00417"></a>00417     <span class="keywordflow">return</span> found;
<a name="l00418"></a>00418 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4469ce4747735e4ecee3a7d5edafaf54"></a><!-- doxytag: member="ElfObject::loadWeakSymbols" ref="a4469ce4747735e4ecee3a7d5edafaf54" args="(SymbolTable *symtab, Addr addrMask=std::numeric_limits&lt; Addr &gt;::max())" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool loadWeakSymbols </td>
          <td>(</td>
          <td class="paramtype">SymbolTable *&nbsp;</td>
          <td class="paramname"> <em>symtab</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a>&nbsp;</td>
          <td class="paramname"> <em>addrMask</em> = <code>std::numeric_limits&lt;<a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a>&gt;::max()</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><a class="el" href="classObjectFile.html#ad466ccc8c0bb76d0ff5a2e7e965a2200">ObjectFile</a>を再定義しています。</p>

<p><div class="fragment"><pre class="fragment"><a name="l00436"></a>00436 {
<a name="l00437"></a>00437     <span class="keywordflow">return</span> <a class="code" href="classElfObject.html#a0e172c4c18ce097d56ab99e41baed39b" title="Helper functions for loadGlobalSymbols() and loadLocalSymbols().">loadSomeSymbols</a>(symtab, STB_WEAK, addrMask);
<a name="l00438"></a>00438 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac41b59a59e22c3f13e3b8377965610bb"></a><!-- doxytag: member="ElfObject::programHeaderCount" ref="ac41b59a59e22c3f13e3b8377965610bb" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t programHeaderCount </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00097"></a>00097 {<span class="keywordflow">return</span> <a class="code" href="classElfObject.html#ad7aa9a59f82dc46c8a5a68cab78ac3d2">_programHeaderCount</a>;}
</pre></div></p>

</div>
</div>
<a class="anchor" id="afcbc87834539817b70011c024ab08e95"></a><!-- doxytag: member="ElfObject::programHeaderSize" ref="afcbc87834539817b70011c024ab08e95" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t programHeaderSize </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00096"></a>00096 {<span class="keywordflow">return</span> <a class="code" href="classElfObject.html#a6c5aa85cf3dfde11fb9fc2cfdecddaea">_programHeaderSize</a>;}
</pre></div></p>

</div>
</div>
<a class="anchor" id="acccc82a035ebb35744fea52a2b39cad7"></a><!-- doxytag: member="ElfObject::programHeaderTable" ref="acccc82a035ebb35744fea52a2b39cad7" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a> programHeaderTable </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00095"></a>00095 {<span class="keywordflow">return</span> <a class="code" href="classElfObject.html#a86cf305b617197067a3d741dc4646d66">_programHeaderTable</a>;}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5eb8917b5bb77054582ad80b5668e68e"></a><!-- doxytag: member="ElfObject::sectionExists" ref="a5eb8917b5bb77054582ad80b5668e68e" args="(std::string sec)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool sectionExists </td>
          <td>(</td>
          <td class="paramtype">std::string&nbsp;</td>
          <td class="paramname"> <em>sec</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="af96c4ced69d653731f78ba9d9006e251"></a><!-- doxytag: member="ElfObject::tryFile" ref="af96c4ced69d653731f78ba9d9006e251" args="(const std::string &amp;fname, int fd, size_t len, uint8_t *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="classObjectFile.html">ObjectFile</a>* tryFile </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&nbsp;</td>
          <td class="paramname"> <em>fname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/><h2>変数</h2>
<a class="anchor" id="ad7aa9a59f82dc46c8a5a68cab78ac3d2"></a><!-- doxytag: member="ElfObject::_programHeaderCount" ref="ad7aa9a59f82dc46c8a5a68cab78ac3d2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t <a class="el" href="classElfObject.html#ad7aa9a59f82dc46c8a5a68cab78ac3d2">_programHeaderCount</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a6c5aa85cf3dfde11fb9fc2cfdecddaea"></a><!-- doxytag: member="ElfObject::_programHeaderSize" ref="a6c5aa85cf3dfde11fb9fc2cfdecddaea" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t <a class="el" href="classElfObject.html#a6c5aa85cf3dfde11fb9fc2cfdecddaea">_programHeaderSize</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a86cf305b617197067a3d741dc4646d66"></a><!-- doxytag: member="ElfObject::_programHeaderTable" ref="a86cf305b617197067a3d741dc4646d66" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a> <a class="el" href="classElfObject.html#a86cf305b617197067a3d741dc4646d66">_programHeaderTable</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a84eafac410719032b23da3704a22b143"></a><!-- doxytag: member="ElfObject::extraSegments" ref="a84eafac410719032b23da3704a22b143" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classstd_1_1vector.html">std::vector</a>&lt;<a class="el" href="structObjectFile_1_1Section.html">Segment</a>&gt; <a class="el" href="classElfObject.html#a84eafac410719032b23da3704a22b143">extraSegments</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a12c046b6e1d2d2dd42b6c0ac3bf34886"></a><!-- doxytag: member="ElfObject::sectionNames" ref="a12c046b6e1d2d2dd42b6c0ac3bf34886" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::set&lt;std::string&gt; <a class="el" href="classElfObject.html#a12c046b6e1d2d2dd42b6c0ac3bf34886">sectionNames</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/>このクラスの説明は次のファイルから生成されました:<ul>
<li>base/loader/<a class="el" href="elf__object_8hh_source.html">elf_object.hh</a></li>
<li>base/loader/<a class="el" href="elf__object_8cc.html">elf_object.cc</a></li>
</ul>
</div>
<hr size="1"/><address style="text-align: right;"><small>File&nbsp;GEM5&nbsp;Wrapperに対して25 May 2015に生成されました。&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
