\hypertarget{classTournamentBP}{
\section{クラス TournamentBP}
\label{classTournamentBP}\index{TournamentBP@{TournamentBP}}
}


{\ttfamily \#include $<$tournament.hh$>$}TournamentBPに対する継承グラフ:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=4cm]{classTournamentBP}
\end{center}
\end{figure}
\subsection*{構成}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{structTournamentBP_1_1BPHistory}{BPHistory}
\end{DoxyCompactItemize}
\subsection*{Public メソッド}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classTournamentBP_ad2381a9dbad94a16f6413cf1d69b1ce1}{TournamentBP} (const \hyperlink{classBPredUnit_aa715df0f49f029439cca4c7bd6e3d4fb}{Params} $\ast$params)
\item 
bool \hyperlink{classTournamentBP_a9c30d728e49473b5a3825835e98a10bc}{lookup} (\hyperlink{base_2types_8hh_af1bb03d6a4ee096394a6749f0a169232}{Addr} branch\_\-addr, void $\ast$\&bp\_\-history)
\item 
void \hyperlink{classTournamentBP_ad3d898a5eab93d923a1073fe6a0f0030}{uncondBranch} (void $\ast$\&bp\_\-history)
\item 
void \hyperlink{classTournamentBP_a101ada238eecd07cc6905c60272e2693}{btbUpdate} (\hyperlink{base_2types_8hh_af1bb03d6a4ee096394a6749f0a169232}{Addr} branch\_\-addr, void $\ast$\&bp\_\-history)
\item 
void \hyperlink{classTournamentBP_a590e0fd17d5b663e25f0e956fadc7062}{update} (\hyperlink{base_2types_8hh_af1bb03d6a4ee096394a6749f0a169232}{Addr} branch\_\-addr, bool taken, void $\ast$bp\_\-history, bool squashed)
\item 
void \hyperlink{classTournamentBP_aeb215cee5cdccdf52d02b73fffe80220}{squash} (void $\ast$bp\_\-history)
\item 
unsigned \hyperlink{classTournamentBP_a0024022d02f61b8c4166f8ea91c0e112}{readGlobalHist} ()
\end{DoxyCompactItemize}
\subsection*{Private メソッド}
\begin{DoxyCompactItemize}
\item 
bool \hyperlink{classTournamentBP_ad0f11a4da5ded93ef111f9d8a1d40a54}{getPrediction} (uint8\_\-t \&count)
\item 
unsigned \hyperlink{classTournamentBP_ae93fe8c8e3b6835f6fe2489f56600258}{calcLocHistIdx} (\hyperlink{base_2types_8hh_af1bb03d6a4ee096394a6749f0a169232}{Addr} \&branch\_\-addr)
\item 
void \hyperlink{classTournamentBP_a134f4849d0956d21b8d179d9cc4d5484}{updateGlobalHistTaken} ()
\item 
void \hyperlink{classTournamentBP_aa8baf2d471498ae49654c3398d7b1f1f}{updateGlobalHistNotTaken} ()
\item 
void \hyperlink{classTournamentBP_a4f9579428ce30b76c76e2c6bdc876672}{updateLocalHistTaken} (unsigned local\_\-history\_\-idx)
\item 
void \hyperlink{classTournamentBP_a7be8a3b2838c05c1199ae3490e0c4a31}{updateLocalHistNotTaken} (unsigned local\_\-history\_\-idx)
\end{DoxyCompactItemize}
\subsection*{Private 変数}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classstd_1_1vector}{std::vector}$<$ \hyperlink{classSatCounter}{SatCounter} $>$ \hyperlink{classTournamentBP_a639a100e0452520604d19db58d98721d}{localCtrs}
\item 
unsigned \hyperlink{classTournamentBP_ad980634448337df2bf521bc96fd5653d}{localPredictorSize}
\item 
unsigned \hyperlink{classTournamentBP_a260a954fa701712cdc113f3f9d0fc9ee}{localPredictorMask}
\item 
unsigned \hyperlink{classTournamentBP_a815998927bcd79afe7f787b90f9954f5}{localCtrBits}
\item 
\hyperlink{classstd_1_1vector}{std::vector}$<$ unsigned $>$ \hyperlink{classTournamentBP_a0cd7dde45fcd92a2f25e895f8232007e}{localHistoryTable}
\item 
unsigned \hyperlink{classTournamentBP_a71759b087accf553cc72b42bbd20dacd}{localHistoryTableSize}
\item 
unsigned \hyperlink{classTournamentBP_affb9008b5a92be8b47d319a4ecc28683}{localHistoryBits}
\item 
\hyperlink{classstd_1_1vector}{std::vector}$<$ \hyperlink{classSatCounter}{SatCounter} $>$ \hyperlink{classTournamentBP_aa8fc28af97afce3a4f54e4924f7d4815}{globalCtrs}
\item 
unsigned \hyperlink{classTournamentBP_ad3a4f2fc3c100e6baa69ece70da3cc07}{globalPredictorSize}
\item 
unsigned \hyperlink{classTournamentBP_a21c0cae328ca40466ae7e247bd62373f}{globalCtrBits}
\item 
unsigned \hyperlink{classTournamentBP_a48805f17e95aa944cb6eda2fcf061adf}{globalHistory}
\item 
unsigned \hyperlink{classTournamentBP_a64788f44637c4acaa30edab60e940f1e}{globalHistoryBits}
\item 
unsigned \hyperlink{classTournamentBP_a8a8a42593ca0c54c9cea34315edaf5fa}{globalHistoryMask}
\item 
unsigned \hyperlink{classTournamentBP_aaaf50cc17f3cbe92a7d57a4f86c0cf5c}{choiceHistoryMask}
\item 
unsigned \hyperlink{classTournamentBP_acdbccf5f7c6840a7dd6cd9350d2d29c2}{historyRegisterMask}
\item 
\hyperlink{classstd_1_1vector}{std::vector}$<$ \hyperlink{classSatCounter}{SatCounter} $>$ \hyperlink{classTournamentBP_a26f80c7389224a73876e470b543e327a}{choiceCtrs}
\item 
unsigned \hyperlink{classTournamentBP_aa71f36048f2ff08f22872c928bb15ad7}{choicePredictorSize}
\item 
unsigned \hyperlink{classTournamentBP_aee44accc1717e338f8b33ff113d62be2}{choiceCtrBits}
\item 
unsigned \hyperlink{classTournamentBP_a8ad2ee60a6143561753205840ad144e7}{instShiftAmt}
\item 
unsigned \hyperlink{classTournamentBP_ad1e9eb27631bc79b7aaf699c608ab9e9}{localThreshold}
\item 
unsigned \hyperlink{classTournamentBP_ab40a9a7c94a0d33e3b1782a60c208c56}{globalThreshold}
\item 
unsigned \hyperlink{classTournamentBP_a6de119a3b475137cbfab3f2a0604886b}{choiceThreshold}
\end{DoxyCompactItemize}
\subsection*{Static Private 変数}
\begin{DoxyCompactItemize}
\item 
static const int \hyperlink{classTournamentBP_ac963a89cba9b2e4b21e99863bc5a78f1}{invalidPredictorIndex} = -\/1
\end{DoxyCompactItemize}


\subsection{説明}
Implements a tournament branch predictor, hopefully identical to the one used in the 21264. It has a local predictor, which uses a local history table to index into a table of counters, and a global predictor, which uses a global history to index into a table of counters. A choice predictor chooses between the two. Only the global history register is speculatively updated, the rest are updated upon branches committing or misspeculating. 

\subsection{コンストラクタとデストラクタ}
\hypertarget{classTournamentBP_ad2381a9dbad94a16f6413cf1d69b1ce1}{
\index{TournamentBP@{TournamentBP}!TournamentBP@{TournamentBP}}
\index{TournamentBP@{TournamentBP}!TournamentBP@{TournamentBP}}
\subsubsection[{TournamentBP}]{\setlength{\rightskip}{0pt plus 5cm}{\bf TournamentBP} (const {\bf Params} $\ast$ {\em params})}}
\label{classTournamentBP_ad2381a9dbad94a16f6413cf1d69b1ce1}
Default branch predictor constructor. 


\begin{DoxyCode}
48     : BPredUnit(params),
49       localPredictorSize(params->localPredictorSize),
50       localCtrBits(params->localCtrBits),
51       localHistoryTableSize(params->localHistoryTableSize),
52       localHistoryBits(ceilLog2(params->localPredictorSize)),
53       globalPredictorSize(params->globalPredictorSize),
54       globalCtrBits(params->globalCtrBits),
55       globalHistoryBits(
56           ceilLog2(params->globalPredictorSize) >
57           ceilLog2(params->choicePredictorSize) ?
58           ceilLog2(params->globalPredictorSize) :
59           ceilLog2(params->choicePredictorSize)),
60       choicePredictorSize(params->choicePredictorSize),
61       choiceCtrBits(params->choiceCtrBits),
62       instShiftAmt(params->instShiftAmt)
63 {
64     if (!isPowerOf2(localPredictorSize)) {
65         fatal("Invalid local predictor size!\n");
66     }
67 
68     if (!isPowerOf2(globalPredictorSize)) {
69         fatal("Invalid global predictor size!\n");
70     }
71 
72     //Set up the array of counters for the local predictor
73     localCtrs.resize(localPredictorSize);
74 
75     for (int i = 0; i < localPredictorSize; ++i)
76         localCtrs[i].setBits(localCtrBits);
77 
78     localPredictorMask = mask(localHistoryBits);
79 
80     if (!isPowerOf2(localHistoryTableSize)) {
81         fatal("Invalid local history table size!\n");
82     }
83 
84     //Setup the history table for the local table
85     localHistoryTable.resize(localHistoryTableSize);
86 
87     for (int i = 0; i < localHistoryTableSize; ++i)
88         localHistoryTable[i] = 0;
89 
90     //Setup the array of counters for the global predictor
91     globalCtrs.resize(globalPredictorSize);
92 
93     for (int i = 0; i < globalPredictorSize; ++i)
94         globalCtrs[i].setBits(globalCtrBits);
95 
96     //Clear the global history
97     globalHistory = 0;
98     // Set up the global history mask
99     // this is equivalent to mask(log2(globalPredictorSize)
100     globalHistoryMask = globalPredictorSize - 1;
101 
102     if (!isPowerOf2(choicePredictorSize)) {
103         fatal("Invalid choice predictor size!\n");
104     }
105 
106     // Set up choiceHistoryMask
107     // this is equivalent to mask(log2(choicePredictorSize)
108     choiceHistoryMask = choicePredictorSize - 1;
109 
110     //Setup the array of counters for the choice predictor
111     choiceCtrs.resize(choicePredictorSize);
112 
113     for (int i = 0; i < choicePredictorSize; ++i)
114         choiceCtrs[i].setBits(choiceCtrBits);
115 
116     //Set up historyRegisterMask
117     historyRegisterMask = mask(globalHistoryBits);
118 
119     //Check that predictors don't use more bits than they have available
120     if (globalHistoryMask > historyRegisterMask) {
121         fatal("Global predictor too large for global history bits!\n");
122     }
123     if (choiceHistoryMask > historyRegisterMask) {
124         fatal("Choice predictor too large for global history bits!\n");
125     }
126 
127     if (globalHistoryMask < historyRegisterMask &&
128         choiceHistoryMask < historyRegisterMask) {
129         inform("More global history bits than required by predictors\n");
130     }
131 
132     // Set thresholds for the three predictors' counters
133     // This is equivalent to (2^(Ctr))/2 - 1
134     localThreshold  = (ULL(1) << (localCtrBits  - 1)) - 1;
135     globalThreshold = (ULL(1) << (globalCtrBits - 1)) - 1;
136     choiceThreshold = (ULL(1) << (choiceCtrBits - 1)) - 1;
137 }
\end{DoxyCode}


\subsection{関数}
\hypertarget{classTournamentBP_a101ada238eecd07cc6905c60272e2693}{
\index{TournamentBP@{TournamentBP}!btbUpdate@{btbUpdate}}
\index{btbUpdate@{btbUpdate}!TournamentBP@{TournamentBP}}
\subsubsection[{btbUpdate}]{\setlength{\rightskip}{0pt plus 5cm}void btbUpdate ({\bf Addr} {\em branch\_\-addr}, \/  void $\ast$\& {\em bp\_\-history})\hspace{0.3cm}{\ttfamily  \mbox{[}virtual\mbox{]}}}}
\label{classTournamentBP_a101ada238eecd07cc6905c60272e2693}
Updates the branch predictor to Not Taken if a BTB entry is invalid or not found. 
\begin{DoxyParams}{引数}
\item[{\em branch\_\-addr}]The address of the branch to look up. \item[{\em bp\_\-history}]Pointer to any bp history state. \end{DoxyParams}
\begin{DoxyReturn}{戻り値}
Whether or not the branch is taken. 
\end{DoxyReturn}


\hyperlink{classBPredUnit_a7b687ebde63095b00a0b083ba6607cd4}{BPredUnit}を実装しています。


\begin{DoxyCode}
182 {
183     unsigned local_history_idx = calcLocHistIdx(branch_addr);
184     //Update Global History to Not Taken (clear LSB)
185     globalHistory &= (historyRegisterMask & ~ULL(1));
186     //Update Local History to Not Taken
187     localHistoryTable[local_history_idx] =
188        localHistoryTable[local_history_idx] & (localPredictorMask & ~ULL(1));
189 }
\end{DoxyCode}
\hypertarget{classTournamentBP_ae93fe8c8e3b6835f6fe2489f56600258}{
\index{TournamentBP@{TournamentBP}!calcLocHistIdx@{calcLocHistIdx}}
\index{calcLocHistIdx@{calcLocHistIdx}!TournamentBP@{TournamentBP}}
\subsubsection[{calcLocHistIdx}]{\setlength{\rightskip}{0pt plus 5cm}unsigned calcLocHistIdx ({\bf Addr} \& {\em branch\_\-addr})\hspace{0.3cm}{\ttfamily  \mbox{[}inline, private\mbox{]}}}}
\label{classTournamentBP_ae93fe8c8e3b6835f6fe2489f56600258}
Returns the local history index, given a branch address. 
\begin{DoxyParams}{引数}
\item[{\em branch\_\-addr}]The branch's PC address. \end{DoxyParams}



\begin{DoxyCode}
142 {
143     // Get low order bits after removing instruction offset.
144     return (branch_addr >> instShiftAmt) & (localHistoryTableSize - 1);
145 }
\end{DoxyCode}
\hypertarget{classTournamentBP_ad0f11a4da5ded93ef111f9d8a1d40a54}{
\index{TournamentBP@{TournamentBP}!getPrediction@{getPrediction}}
\index{getPrediction@{getPrediction}!TournamentBP@{TournamentBP}}
\subsubsection[{getPrediction}]{\setlength{\rightskip}{0pt plus 5cm}bool getPrediction (uint8\_\-t \& {\em count})\hspace{0.3cm}{\ttfamily  \mbox{[}inline, private\mbox{]}}}}
\label{classTournamentBP_ad0f11a4da5ded93ef111f9d8a1d40a54}
Returns if the branch should be taken or not, given a counter value. 
\begin{DoxyParams}{引数}
\item[{\em count}]The counter value. \end{DoxyParams}
\hypertarget{classTournamentBP_a9c30d728e49473b5a3825835e98a10bc}{
\index{TournamentBP@{TournamentBP}!lookup@{lookup}}
\index{lookup@{lookup}!TournamentBP@{TournamentBP}}
\subsubsection[{lookup}]{\setlength{\rightskip}{0pt plus 5cm}bool lookup ({\bf Addr} {\em branch\_\-addr}, \/  void $\ast$\& {\em bp\_\-history})\hspace{0.3cm}{\ttfamily  \mbox{[}virtual\mbox{]}}}}
\label{classTournamentBP_a9c30d728e49473b5a3825835e98a10bc}
Looks up the given address in the branch predictor and returns a true/false value as to whether it is taken. Also creates a \hyperlink{structTournamentBP_1_1BPHistory}{BPHistory} object to store any state it will need on squash/update. 
\begin{DoxyParams}{引数}
\item[{\em branch\_\-addr}]The address of the branch to look up. \item[{\em bp\_\-history}]Pointer that will be set to the \hyperlink{structTournamentBP_1_1BPHistory}{BPHistory} object. \end{DoxyParams}
\begin{DoxyReturn}{戻り値}
Whether or not the branch is taken. 
\end{DoxyReturn}


\hyperlink{classBPredUnit_a5632fdea0abc34f7d68d8445a7a6c166}{BPredUnit}を実装しています。


\begin{DoxyCode}
193 {
194     bool local_prediction;
195     unsigned local_history_idx;
196     unsigned local_predictor_idx;
197 
198     bool global_prediction;
199     bool choice_prediction;
200 
201     //Lookup in the local predictor to get its branch prediction
202     local_history_idx = calcLocHistIdx(branch_addr);
203     local_predictor_idx = localHistoryTable[local_history_idx]
204         & localPredictorMask;
205     local_prediction = localCtrs[local_predictor_idx].read() > localThreshold;
206 
207     //Lookup in the global predictor to get its branch prediction
208     global_prediction =
209       globalCtrs[globalHistory & globalHistoryMask].read() > globalThreshold;
210 
211     //Lookup in the choice predictor to see which one to use
212     choice_prediction =
213       choiceCtrs[globalHistory & choiceHistoryMask].read() > choiceThreshold;
214 
215     // Create BPHistory and pass it back to be recorded.
216     BPHistory *history = new BPHistory;
217     history->globalHistory = globalHistory;
218     history->localPredTaken = local_prediction;
219     history->globalPredTaken = global_prediction;
220     history->globalUsed = choice_prediction;
221     history->localHistory = local_predictor_idx;
222     bp_history = (void *)history;
223 
224     assert(local_history_idx < localHistoryTableSize);
225 
226     // Commented code is for doing speculative update of counters and
227     // all histories.
228     if (choice_prediction) {
229         if (global_prediction) {
230             updateGlobalHistTaken();
231             updateLocalHistTaken(local_history_idx);
232             return true;
233         } else {
234             updateGlobalHistNotTaken();
235             updateLocalHistNotTaken(local_history_idx);
236             return false;
237         }
238     } else {
239         if (local_prediction) {
240             updateGlobalHistTaken();
241             updateLocalHistTaken(local_history_idx);
242             return true;
243         } else {
244             updateGlobalHistNotTaken();
245             updateLocalHistNotTaken(local_history_idx);
246             return false;
247         }
248     }
249 }
\end{DoxyCode}
\hypertarget{classTournamentBP_a0024022d02f61b8c4166f8ea91c0e112}{
\index{TournamentBP@{TournamentBP}!readGlobalHist@{readGlobalHist}}
\index{readGlobalHist@{readGlobalHist}!TournamentBP@{TournamentBP}}
\subsubsection[{readGlobalHist}]{\setlength{\rightskip}{0pt plus 5cm}unsigned readGlobalHist ()\hspace{0.3cm}{\ttfamily  \mbox{[}inline\mbox{]}}}}
\label{classTournamentBP_a0024022d02f61b8c4166f8ea91c0e112}
Returns the global history. 


\begin{DoxyCode}
115 { return globalHistory; }
\end{DoxyCode}
\hypertarget{classTournamentBP_aeb215cee5cdccdf52d02b73fffe80220}{
\index{TournamentBP@{TournamentBP}!squash@{squash}}
\index{squash@{squash}!TournamentBP@{TournamentBP}}
\subsubsection[{squash}]{\setlength{\rightskip}{0pt plus 5cm}void squash (void $\ast$ {\em bp\_\-history})\hspace{0.3cm}{\ttfamily  \mbox{[}virtual\mbox{]}}}}
\label{classTournamentBP_aeb215cee5cdccdf52d02b73fffe80220}
Restores the global branch history on a squash. 
\begin{DoxyParams}{引数}
\item[{\em bp\_\-history}]Pointer to the \hyperlink{structTournamentBP_1_1BPHistory}{BPHistory} object that has the previous global branch history in it. \end{DoxyParams}


\hyperlink{classBPredUnit_a2af63ba741727bdf58e2b2dc22a912ed}{BPredUnit}を実装しています。


\begin{DoxyCode}
362 {
363     BPHistory *history = static_cast<BPHistory *>(bp_history);
364 
365     // Restore global history to state prior to this branch.
366     globalHistory = history->globalHistory;
367 
368     // Delete this BPHistory now that we're done with it.
369     delete history;
370 }
\end{DoxyCode}
\hypertarget{classTournamentBP_ad3d898a5eab93d923a1073fe6a0f0030}{
\index{TournamentBP@{TournamentBP}!uncondBranch@{uncondBranch}}
\index{uncondBranch@{uncondBranch}!TournamentBP@{TournamentBP}}
\subsubsection[{uncondBranch}]{\setlength{\rightskip}{0pt plus 5cm}void uncondBranch (void $\ast$\& {\em bp\_\-history})\hspace{0.3cm}{\ttfamily  \mbox{[}virtual\mbox{]}}}}
\label{classTournamentBP_ad3d898a5eab93d923a1073fe6a0f0030}
Records that there was an unconditional branch, and modifies the bp history to point to an object that has the previous global history stored in it. 
\begin{DoxyParams}{引数}
\item[{\em bp\_\-history}]Pointer that will be set to the \hyperlink{structTournamentBP_1_1BPHistory}{BPHistory} object. \end{DoxyParams}


\hyperlink{classBPredUnit_a17161e0c51444f148e49e4df2ba89704}{BPredUnit}を実装しています。


\begin{DoxyCode}
253 {
254     // Create BPHistory and pass it back to be recorded.
255     BPHistory *history = new BPHistory;
256     history->globalHistory = globalHistory;
257     history->localPredTaken = true;
258     history->globalPredTaken = true;
259     history->globalUsed = true;
260     history->localHistory = invalidPredictorIndex;
261     bp_history = static_cast<void *>(history);
262 
263     updateGlobalHistTaken();
264 }
\end{DoxyCode}
\hypertarget{classTournamentBP_a590e0fd17d5b663e25f0e956fadc7062}{
\index{TournamentBP@{TournamentBP}!update@{update}}
\index{update@{update}!TournamentBP@{TournamentBP}}
\subsubsection[{update}]{\setlength{\rightskip}{0pt plus 5cm}void update ({\bf Addr} {\em branch\_\-addr}, \/  bool {\em taken}, \/  void $\ast$ {\em bp\_\-history}, \/  bool {\em squashed})\hspace{0.3cm}{\ttfamily  \mbox{[}virtual\mbox{]}}}}
\label{classTournamentBP_a590e0fd17d5b663e25f0e956fadc7062}
Updates the branch predictor with the actual result of a branch. 
\begin{DoxyParams}{引数}
\item[{\em branch\_\-addr}]The address of the branch to update. \item[{\em taken}]Whether or not the branch was taken. \item[{\em bp\_\-history}]Pointer to the \hyperlink{structTournamentBP_1_1BPHistory}{BPHistory} object that was created when the branch was predicted. \item[{\em squashed}]is set when this function is called during a squash operation. \end{DoxyParams}


\hyperlink{classBPredUnit_ab00dd76dc9f830cdae0edc72357c013a}{BPredUnit}を実装しています。


\begin{DoxyCode}
269 {
270     unsigned local_history_idx;
271     unsigned local_predictor_idx M5_VAR_USED;
272     unsigned local_predictor_hist;
273 
274     // Get the local predictor's current prediction
275     local_history_idx = calcLocHistIdx(branch_addr);
276     local_predictor_hist = localHistoryTable[local_history_idx];
277     local_predictor_idx = local_predictor_hist & localPredictorMask;
278 
279     if (bp_history) {
280         BPHistory *history = static_cast<BPHistory *>(bp_history);
281         // Update may also be called if the Branch target is incorrect even if
282         // the prediction is correct. In that case do not update the counters.
283         bool historyPred = false;
284         unsigned old_local_pred_index = history->localHistory &
285                 localPredictorMask;
286 
287         bool old_local_pred_valid = history->localHistory !=
288             invalidPredictorIndex;
289 
290         assert(old_local_pred_index < localPredictorSize);
291 
292         if (history->globalUsed) {
293            historyPred = history->globalPredTaken;
294         } else {
295            historyPred = history->localPredTaken;
296         }
297         if (historyPred != taken || !squashed) {
298             // Update the choice predictor to tell it which one was correct if
299             // there was a prediction.
300             if (history->localPredTaken != history->globalPredTaken) {
301                  // If the local prediction matches the actual outcome,
302                  // decerement the counter.  Otherwise increment the
303                  // counter.
304                  unsigned choice_predictor_idx =
305                    history->globalHistory & choiceHistoryMask;
306                  if (history->localPredTaken == taken) {
307                      choiceCtrs[choice_predictor_idx].decrement();
308                  } else if (history->globalPredTaken == taken) {
309                      choiceCtrs[choice_predictor_idx].increment();
310                  }
311 
312              }
313 
314              // Update the counters and local history with the proper
315              // resolution of the branch.  Global history is updated
316              // speculatively and restored upon squash() calls, so it does not
317              // need to be updated.
318              unsigned global_predictor_idx =
319                history->globalHistory & globalHistoryMask;
320              if (taken) {
321                   globalCtrs[global_predictor_idx].increment();
322                   if (old_local_pred_valid) {
323                           localCtrs[old_local_pred_index].increment();
324                   }
325              } else {
326                   globalCtrs[global_predictor_idx].decrement();
327                   if (old_local_pred_valid) {
328                           localCtrs[old_local_pred_index].decrement();
329                   }
330              }
331         }
332         if (squashed) {
333              if (taken) {
334                 globalHistory = (history->globalHistory << 1) | 1;
335                 globalHistory = globalHistory & historyRegisterMask;
336                 if (old_local_pred_valid) {
337                     localHistoryTable[local_history_idx] =
338                      (history->localHistory << 1) | 1;
339                 }
340              } else {
341                 globalHistory = (history->globalHistory << 1);
342                 globalHistory = globalHistory & historyRegisterMask;
343                 if (old_local_pred_valid) {
344                      localHistoryTable[local_history_idx] =
345                      history->localHistory << 1;
346                 }
347              }
348 
349         }
350         // We're done with this history, now delete it.
351         delete history;
352 
353     }
354 
355     assert(local_history_idx < localHistoryTableSize);
356 
357 
358 }
\end{DoxyCode}
\hypertarget{classTournamentBP_aa8baf2d471498ae49654c3398d7b1f1f}{
\index{TournamentBP@{TournamentBP}!updateGlobalHistNotTaken@{updateGlobalHistNotTaken}}
\index{updateGlobalHistNotTaken@{updateGlobalHistNotTaken}!TournamentBP@{TournamentBP}}
\subsubsection[{updateGlobalHistNotTaken}]{\setlength{\rightskip}{0pt plus 5cm}void updateGlobalHistNotTaken ()\hspace{0.3cm}{\ttfamily  \mbox{[}inline, private\mbox{]}}}}
\label{classTournamentBP_aa8baf2d471498ae49654c3398d7b1f1f}
Updates global history as not taken. 


\begin{DoxyCode}
158 {
159     globalHistory = (globalHistory << 1);
160     globalHistory = globalHistory & historyRegisterMask;
161 }
\end{DoxyCode}
\hypertarget{classTournamentBP_a134f4849d0956d21b8d179d9cc4d5484}{
\index{TournamentBP@{TournamentBP}!updateGlobalHistTaken@{updateGlobalHistTaken}}
\index{updateGlobalHistTaken@{updateGlobalHistTaken}!TournamentBP@{TournamentBP}}
\subsubsection[{updateGlobalHistTaken}]{\setlength{\rightskip}{0pt plus 5cm}void updateGlobalHistTaken ()\hspace{0.3cm}{\ttfamily  \mbox{[}inline, private\mbox{]}}}}
\label{classTournamentBP_a134f4849d0956d21b8d179d9cc4d5484}
Updates global history as taken. 


\begin{DoxyCode}
150 {
151     globalHistory = (globalHistory << 1) | 1;
152     globalHistory = globalHistory & historyRegisterMask;
153 }
\end{DoxyCode}
\hypertarget{classTournamentBP_a7be8a3b2838c05c1199ae3490e0c4a31}{
\index{TournamentBP@{TournamentBP}!updateLocalHistNotTaken@{updateLocalHistNotTaken}}
\index{updateLocalHistNotTaken@{updateLocalHistNotTaken}!TournamentBP@{TournamentBP}}
\subsubsection[{updateLocalHistNotTaken}]{\setlength{\rightskip}{0pt plus 5cm}void updateLocalHistNotTaken (unsigned {\em local\_\-history\_\-idx})\hspace{0.3cm}{\ttfamily  \mbox{[}inline, private\mbox{]}}}}
\label{classTournamentBP_a7be8a3b2838c05c1199ae3490e0c4a31}
Updates local histories as not taken. 
\begin{DoxyParams}{引数}
\item[{\em local\_\-history\_\-idx}]The local history table entry that will be updated. \end{DoxyParams}



\begin{DoxyCode}
174 {
175     localHistoryTable[local_history_idx] =
176         (localHistoryTable[local_history_idx] << 1);
177 }
\end{DoxyCode}
\hypertarget{classTournamentBP_a4f9579428ce30b76c76e2c6bdc876672}{
\index{TournamentBP@{TournamentBP}!updateLocalHistTaken@{updateLocalHistTaken}}
\index{updateLocalHistTaken@{updateLocalHistTaken}!TournamentBP@{TournamentBP}}
\subsubsection[{updateLocalHistTaken}]{\setlength{\rightskip}{0pt plus 5cm}void updateLocalHistTaken (unsigned {\em local\_\-history\_\-idx})\hspace{0.3cm}{\ttfamily  \mbox{[}inline, private\mbox{]}}}}
\label{classTournamentBP_a4f9579428ce30b76c76e2c6bdc876672}
Updates local histories as taken. 
\begin{DoxyParams}{引数}
\item[{\em local\_\-history\_\-idx}]The local history table entry that will be updated. \end{DoxyParams}



\begin{DoxyCode}
166 {
167     localHistoryTable[local_history_idx] =
168         (localHistoryTable[local_history_idx] << 1) | 1;
169 }
\end{DoxyCode}


\subsection{変数}
\hypertarget{classTournamentBP_aee44accc1717e338f8b33ff113d62be2}{
\index{TournamentBP@{TournamentBP}!choiceCtrBits@{choiceCtrBits}}
\index{choiceCtrBits@{choiceCtrBits}!TournamentBP@{TournamentBP}}
\subsubsection[{choiceCtrBits}]{\setlength{\rightskip}{0pt plus 5cm}unsigned {\bf choiceCtrBits}\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classTournamentBP_aee44accc1717e338f8b33ff113d62be2}
Number of bits in the choice predictor's counters. \hypertarget{classTournamentBP_a26f80c7389224a73876e470b543e327a}{
\index{TournamentBP@{TournamentBP}!choiceCtrs@{choiceCtrs}}
\index{choiceCtrs@{choiceCtrs}!TournamentBP@{TournamentBP}}
\subsubsection[{choiceCtrs}]{\setlength{\rightskip}{0pt plus 5cm}{\bf std::vector}$<${\bf SatCounter}$>$ {\bf choiceCtrs}\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classTournamentBP_a26f80c7389224a73876e470b543e327a}
Array of counters that make up the choice predictor. \hypertarget{classTournamentBP_aaaf50cc17f3cbe92a7d57a4f86c0cf5c}{
\index{TournamentBP@{TournamentBP}!choiceHistoryMask@{choiceHistoryMask}}
\index{choiceHistoryMask@{choiceHistoryMask}!TournamentBP@{TournamentBP}}
\subsubsection[{choiceHistoryMask}]{\setlength{\rightskip}{0pt plus 5cm}unsigned {\bf choiceHistoryMask}\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classTournamentBP_aaaf50cc17f3cbe92a7d57a4f86c0cf5c}
Mask to apply to globalHistory to access choice history table. Based on choicePredictorSize. \hypertarget{classTournamentBP_aa71f36048f2ff08f22872c928bb15ad7}{
\index{TournamentBP@{TournamentBP}!choicePredictorSize@{choicePredictorSize}}
\index{choicePredictorSize@{choicePredictorSize}!TournamentBP@{TournamentBP}}
\subsubsection[{choicePredictorSize}]{\setlength{\rightskip}{0pt plus 5cm}unsigned {\bf choicePredictorSize}\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classTournamentBP_aa71f36048f2ff08f22872c928bb15ad7}
Number of entries in the choice predictor. \hypertarget{classTournamentBP_a6de119a3b475137cbfab3f2a0604886b}{
\index{TournamentBP@{TournamentBP}!choiceThreshold@{choiceThreshold}}
\index{choiceThreshold@{choiceThreshold}!TournamentBP@{TournamentBP}}
\subsubsection[{choiceThreshold}]{\setlength{\rightskip}{0pt plus 5cm}unsigned {\bf choiceThreshold}\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classTournamentBP_a6de119a3b475137cbfab3f2a0604886b}
\hypertarget{classTournamentBP_a21c0cae328ca40466ae7e247bd62373f}{
\index{TournamentBP@{TournamentBP}!globalCtrBits@{globalCtrBits}}
\index{globalCtrBits@{globalCtrBits}!TournamentBP@{TournamentBP}}
\subsubsection[{globalCtrBits}]{\setlength{\rightskip}{0pt plus 5cm}unsigned {\bf globalCtrBits}\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classTournamentBP_a21c0cae328ca40466ae7e247bd62373f}
Number of bits of the global predictor's counters. \hypertarget{classTournamentBP_aa8fc28af97afce3a4f54e4924f7d4815}{
\index{TournamentBP@{TournamentBP}!globalCtrs@{globalCtrs}}
\index{globalCtrs@{globalCtrs}!TournamentBP@{TournamentBP}}
\subsubsection[{globalCtrs}]{\setlength{\rightskip}{0pt plus 5cm}{\bf std::vector}$<${\bf SatCounter}$>$ {\bf globalCtrs}\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classTournamentBP_aa8fc28af97afce3a4f54e4924f7d4815}
Array of counters that make up the global predictor. \hypertarget{classTournamentBP_a48805f17e95aa944cb6eda2fcf061adf}{
\index{TournamentBP@{TournamentBP}!globalHistory@{globalHistory}}
\index{globalHistory@{globalHistory}!TournamentBP@{TournamentBP}}
\subsubsection[{globalHistory}]{\setlength{\rightskip}{0pt plus 5cm}unsigned {\bf globalHistory}\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classTournamentBP_a48805f17e95aa944cb6eda2fcf061adf}
Global history register. Contains as much history as specified by globalHistoryBits. Actual number of bits used is determined by globalHistoryMask and choiceHistoryMask. \hypertarget{classTournamentBP_a64788f44637c4acaa30edab60e940f1e}{
\index{TournamentBP@{TournamentBP}!globalHistoryBits@{globalHistoryBits}}
\index{globalHistoryBits@{globalHistoryBits}!TournamentBP@{TournamentBP}}
\subsubsection[{globalHistoryBits}]{\setlength{\rightskip}{0pt plus 5cm}unsigned {\bf globalHistoryBits}\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classTournamentBP_a64788f44637c4acaa30edab60e940f1e}
Number of bits for the global history. Determines maximum number of entries in global and choice predictor tables. \hypertarget{classTournamentBP_a8a8a42593ca0c54c9cea34315edaf5fa}{
\index{TournamentBP@{TournamentBP}!globalHistoryMask@{globalHistoryMask}}
\index{globalHistoryMask@{globalHistoryMask}!TournamentBP@{TournamentBP}}
\subsubsection[{globalHistoryMask}]{\setlength{\rightskip}{0pt plus 5cm}unsigned {\bf globalHistoryMask}\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classTournamentBP_a8a8a42593ca0c54c9cea34315edaf5fa}
Mask to apply to globalHistory to access global history table. Based on globalPredictorSize. \hypertarget{classTournamentBP_ad3a4f2fc3c100e6baa69ece70da3cc07}{
\index{TournamentBP@{TournamentBP}!globalPredictorSize@{globalPredictorSize}}
\index{globalPredictorSize@{globalPredictorSize}!TournamentBP@{TournamentBP}}
\subsubsection[{globalPredictorSize}]{\setlength{\rightskip}{0pt plus 5cm}unsigned {\bf globalPredictorSize}\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classTournamentBP_ad3a4f2fc3c100e6baa69ece70da3cc07}
Number of entries in the global predictor. \hypertarget{classTournamentBP_ab40a9a7c94a0d33e3b1782a60c208c56}{
\index{TournamentBP@{TournamentBP}!globalThreshold@{globalThreshold}}
\index{globalThreshold@{globalThreshold}!TournamentBP@{TournamentBP}}
\subsubsection[{globalThreshold}]{\setlength{\rightskip}{0pt plus 5cm}unsigned {\bf globalThreshold}\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classTournamentBP_ab40a9a7c94a0d33e3b1782a60c208c56}
\hypertarget{classTournamentBP_acdbccf5f7c6840a7dd6cd9350d2d29c2}{
\index{TournamentBP@{TournamentBP}!historyRegisterMask@{historyRegisterMask}}
\index{historyRegisterMask@{historyRegisterMask}!TournamentBP@{TournamentBP}}
\subsubsection[{historyRegisterMask}]{\setlength{\rightskip}{0pt plus 5cm}unsigned {\bf historyRegisterMask}\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classTournamentBP_acdbccf5f7c6840a7dd6cd9350d2d29c2}
Mask to control how much history is stored. All of it might not be used. \hypertarget{classTournamentBP_a8ad2ee60a6143561753205840ad144e7}{
\index{TournamentBP@{TournamentBP}!instShiftAmt@{instShiftAmt}}
\index{instShiftAmt@{instShiftAmt}!TournamentBP@{TournamentBP}}
\subsubsection[{instShiftAmt}]{\setlength{\rightskip}{0pt plus 5cm}unsigned {\bf instShiftAmt}\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classTournamentBP_a8ad2ee60a6143561753205840ad144e7}
Number of bits to shift the instruction over to get rid of the word offset. \hypertarget{classTournamentBP_ac963a89cba9b2e4b21e99863bc5a78f1}{
\index{TournamentBP@{TournamentBP}!invalidPredictorIndex@{invalidPredictorIndex}}
\index{invalidPredictorIndex@{invalidPredictorIndex}!TournamentBP@{TournamentBP}}
\subsubsection[{invalidPredictorIndex}]{\setlength{\rightskip}{0pt plus 5cm}const int {\bf invalidPredictorIndex} = -\/1\hspace{0.3cm}{\ttfamily  \mbox{[}static, private\mbox{]}}}}
\label{classTournamentBP_ac963a89cba9b2e4b21e99863bc5a78f1}
Flag for invalid predictor index \hypertarget{classTournamentBP_a815998927bcd79afe7f787b90f9954f5}{
\index{TournamentBP@{TournamentBP}!localCtrBits@{localCtrBits}}
\index{localCtrBits@{localCtrBits}!TournamentBP@{TournamentBP}}
\subsubsection[{localCtrBits}]{\setlength{\rightskip}{0pt plus 5cm}unsigned {\bf localCtrBits}\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classTournamentBP_a815998927bcd79afe7f787b90f9954f5}
Number of bits of the local predictor's counters. \hypertarget{classTournamentBP_a639a100e0452520604d19db58d98721d}{
\index{TournamentBP@{TournamentBP}!localCtrs@{localCtrs}}
\index{localCtrs@{localCtrs}!TournamentBP@{TournamentBP}}
\subsubsection[{localCtrs}]{\setlength{\rightskip}{0pt plus 5cm}{\bf std::vector}$<${\bf SatCounter}$>$ {\bf localCtrs}\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classTournamentBP_a639a100e0452520604d19db58d98721d}
Local counters. \hypertarget{classTournamentBP_affb9008b5a92be8b47d319a4ecc28683}{
\index{TournamentBP@{TournamentBP}!localHistoryBits@{localHistoryBits}}
\index{localHistoryBits@{localHistoryBits}!TournamentBP@{TournamentBP}}
\subsubsection[{localHistoryBits}]{\setlength{\rightskip}{0pt plus 5cm}unsigned {\bf localHistoryBits}\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classTournamentBP_affb9008b5a92be8b47d319a4ecc28683}
Number of bits for each entry of the local history table. \hypertarget{classTournamentBP_a0cd7dde45fcd92a2f25e895f8232007e}{
\index{TournamentBP@{TournamentBP}!localHistoryTable@{localHistoryTable}}
\index{localHistoryTable@{localHistoryTable}!TournamentBP@{TournamentBP}}
\subsubsection[{localHistoryTable}]{\setlength{\rightskip}{0pt plus 5cm}{\bf std::vector}$<$unsigned$>$ {\bf localHistoryTable}\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classTournamentBP_a0cd7dde45fcd92a2f25e895f8232007e}
Array of local history table entries. \hypertarget{classTournamentBP_a71759b087accf553cc72b42bbd20dacd}{
\index{TournamentBP@{TournamentBP}!localHistoryTableSize@{localHistoryTableSize}}
\index{localHistoryTableSize@{localHistoryTableSize}!TournamentBP@{TournamentBP}}
\subsubsection[{localHistoryTableSize}]{\setlength{\rightskip}{0pt plus 5cm}unsigned {\bf localHistoryTableSize}\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classTournamentBP_a71759b087accf553cc72b42bbd20dacd}
Number of entries in the local history table. \hypertarget{classTournamentBP_a260a954fa701712cdc113f3f9d0fc9ee}{
\index{TournamentBP@{TournamentBP}!localPredictorMask@{localPredictorMask}}
\index{localPredictorMask@{localPredictorMask}!TournamentBP@{TournamentBP}}
\subsubsection[{localPredictorMask}]{\setlength{\rightskip}{0pt plus 5cm}unsigned {\bf localPredictorMask}\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classTournamentBP_a260a954fa701712cdc113f3f9d0fc9ee}
Mask to truncate values stored in the local history table. \hypertarget{classTournamentBP_ad980634448337df2bf521bc96fd5653d}{
\index{TournamentBP@{TournamentBP}!localPredictorSize@{localPredictorSize}}
\index{localPredictorSize@{localPredictorSize}!TournamentBP@{TournamentBP}}
\subsubsection[{localPredictorSize}]{\setlength{\rightskip}{0pt plus 5cm}unsigned {\bf localPredictorSize}\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classTournamentBP_ad980634448337df2bf521bc96fd5653d}
Number of counters in the local predictor. \hypertarget{classTournamentBP_ad1e9eb27631bc79b7aaf699c608ab9e9}{
\index{TournamentBP@{TournamentBP}!localThreshold@{localThreshold}}
\index{localThreshold@{localThreshold}!TournamentBP@{TournamentBP}}
\subsubsection[{localThreshold}]{\setlength{\rightskip}{0pt plus 5cm}unsigned {\bf localThreshold}\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classTournamentBP_ad1e9eb27631bc79b7aaf699c608ab9e9}
Thresholds for the counter value; above the threshold is taken, equal to or below the threshold is not taken. 

このクラスの説明は次のファイルから生成されました:\begin{DoxyCompactItemize}
\item 
cpu/pred/\hyperlink{tournament_8hh}{tournament.hh}\item 
cpu/pred/\hyperlink{tournament_8cc}{tournament.cc}\end{DoxyCompactItemize}
