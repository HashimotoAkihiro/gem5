<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>File&nbsp;GEM5&nbsp;Wrapper: クラス BridgeMasterPort</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- 作成： Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>メインページ</span></a></li>
      <li><a href="pages.html"><span>関連ページ</span></a></li>
      <li><a href="modules.html"><span>モジュール</span></a></li>
      <li><a href="namespaces.html"><span>ネームスペース</span></a></li>
      <li class="current"><a href="annotated.html"><span>クラス</span></a></li>
      <li><a href="files.html"><span>ファイル</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>構成</span></a></li>
      <li><a href="classes.html"><span>構成索引</span></a></li>
      <li><a href="hierarchy.html"><span>クラス階層</span></a></li>
      <li><a href="functions.html"><span>構成メンバ</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="classBridge.html">Bridge</a>::<a class="el" href="classBridge_1_1BridgeMasterPort.html">BridgeMasterPort</a>
  </div>
</div>
<div class="contents">
<h1>クラス BridgeMasterPort</h1><!-- doxytag: class="Bridge::BridgeMasterPort" --><!-- doxytag: inherits="MasterPort" -->
<p><code>#include &lt;<a class="el" href="bridge_8hh_source.html">bridge.hh</a>&gt;</code></p>
<div class="dynheader">
BridgeMasterPortに対する継承グラフ</div>
<div class="dynsection">
 <div class="center">
  <img src="classBridge_1_1BridgeMasterPort.gif" usemap="#BridgeMasterPort_map" alt=""/>
  <map id="BridgeMasterPort_map" name="BridgeMasterPort_map">
<area href="classMasterPort.html" alt="MasterPort" shape="rect" coords="0,112,111,136"/>
<area href="classBaseMasterPort.html" alt="BaseMasterPort" shape="rect" coords="0,56,111,80"/>
<area href="classPort.html" alt="Port" shape="rect" coords="0,0,111,24"/>
</map>
 </div>
</div>

<p><a href="classBridge_1_1BridgeMasterPort-members.html">すべてのメンバ一覧</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Public メソッド</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBridge_1_1BridgeMasterPort.html#a0e907bb2314fb9bd4dcc0a702c1948dd">BridgeMasterPort</a> (const std::string &amp;_name, <a class="el" href="classBridge_1_1Bridge.html">Bridge</a> &amp;_bridge, <a class="el" href="classBridge_1_1BridgeSlavePort.html">BridgeSlavePort</a> &amp;<a class="el" href="classMasterPort.html#a33e3b01a66e2118c0e01887bd905e904">_slavePort</a>, <a class="el" href="classCycles.html">Cycles</a> _delay, int _req_limit)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBridge_1_1BridgeMasterPort.html#a5b40b3c494ce10f0e9f0c89965808030">reqQueueFull</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBridge_1_1BridgeMasterPort.html#a6e835b0c02fcb4679fc14de7605b4f13">schedTimingReq</a> (<a class="el" href="classPacket.html">PacketPtr</a> pkt, <a class="el" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> when)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBridge_1_1BridgeMasterPort.html#a8eb60d4744b6212ad749f3a586759266">checkFunctional</a> (<a class="el" href="classPacket.html">PacketPtr</a> pkt)</td></tr>
<tr><td colspan="2"><h2>Protected メソッド</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBridge_1_1BridgeMasterPort.html#a482dba5588f4bee43e498875a61e5e0b">recvTimingResp</a> (<a class="el" href="classPacket.html">PacketPtr</a> pkt)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBridge_1_1BridgeMasterPort.html#a29cb5a4f98063ce6e9210eacbdb35298">recvRetry</a> ()</td></tr>
<tr><td colspan="2"><h2>Private メソッド</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBridge_1_1BridgeMasterPort.html#a391c414b53eb45782e37bc539608e477">trySendTiming</a> ()</td></tr>
<tr><td colspan="2"><h2>Private 変数</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classBridge_1_1Bridge.html">Bridge</a> &amp;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBridge_1_1BridgeMasterPort.html#a6d3b24e49ac986064571195ab9905136">bridge</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classBridge_1_1BridgeSlavePort.html">BridgeSlavePort</a> &amp;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBridge_1_1BridgeMasterPort.html#a1e08ec2f17b79c544fef06a37d6b4ba3">slavePort</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const <a class="el" href="classCycles.html">Cycles</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBridge_1_1BridgeMasterPort.html#a153dd7cdfa9816427cbbe84dce923c8d">delay</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classstd_1_1deque.html">std::deque</a>&lt; <a class="el" href="classBridge_1_1DeferredPacket.html">DeferredPacket</a> &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBridge_1_1BridgeMasterPort.html#a640fbfa2436c06d6f64608f76261e6e5">transmitList</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBridge_1_1BridgeMasterPort.html#abe7df187a5de0c89447640be0c8d6f87">reqQueueLimit</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classEventWrapper.html">EventWrapper</a>&lt; <a class="el" href="classBridge_1_1BridgeMasterPort.html">BridgeMasterPort</a>,&amp;BridgeMasterPort::trySendTiming &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBridge_1_1BridgeMasterPort.html#ac65e9e742d994553fd80b8b38c2bd5dd">sendEvent</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>説明</h2>
<p><a class="el" href="classPort.html">Port</a> on the side that forwards requests and receives responses. The master port has a buffer for the requests not yet sent. </p>
<hr/><h2>コンストラクタとデストラクタ</h2>
<a class="anchor" id="a0e907bb2314fb9bd4dcc0a702c1948dd"></a><!-- doxytag: member="Bridge::BridgeMasterPort::BridgeMasterPort" ref="a0e907bb2314fb9bd4dcc0a702c1948dd" args="(const std::string &amp;_name, Bridge &amp;_bridge, BridgeSlavePort &amp;_slavePort, Cycles _delay, int _req_limit)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classBridge_1_1BridgeMasterPort.html">BridgeMasterPort</a> </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&nbsp;</td>
          <td class="paramname"> <em>_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classBridge_1_1Bridge.html">Bridge</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>_bridge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classBridge_1_1BridgeSlavePort.html">BridgeSlavePort</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>_slavePort</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classCycles.html">Cycles</a>&nbsp;</td>
          <td class="paramname"> <em>_delay</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>_req_limit</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Constructor for the <a class="el" href="classBridge_1_1BridgeMasterPort.html">BridgeMasterPort</a>.</p>
<dl><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>_name</em>&nbsp;</td><td>the port name including the owner </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>_bridge</em>&nbsp;</td><td>the structural owner </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>_slavePort</em>&nbsp;</td><td>the slave port on the other side of the bridge </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>_delay</em>&nbsp;</td><td>the delay in cycles from receiving to sending </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>_req_limit</em>&nbsp;</td><td>the size of the request queue </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l00072"></a>00072     : <a class="code" href="classMasterPort.html#a4a4ccf1d4533ae4ce5ac9bf88a7edfd5">MasterPort</a>(_name, &amp;_bridge), <a class="code" href="classBridge_1_1BridgeMasterPort.html#a6d3b24e49ac986064571195ab9905136">bridge</a>(_bridge), <a class="code" href="classBridge_1_1BridgeMasterPort.html#a1e08ec2f17b79c544fef06a37d6b4ba3">slavePort</a>(<a class="code" href="classMasterPort.html#a33e3b01a66e2118c0e01887bd905e904">_slavePort</a>),
<a name="l00073"></a>00073       <a class="code" href="classBridge_1_1BridgeMasterPort.html#a153dd7cdfa9816427cbbe84dce923c8d">delay</a>(_delay), <a class="code" href="classBridge_1_1BridgeMasterPort.html#abe7df187a5de0c89447640be0c8d6f87">reqQueueLimit</a>(_req_limit), <a class="code" href="classBridge_1_1BridgeMasterPort.html#ac65e9e742d994553fd80b8b38c2bd5dd">sendEvent</a>(*<span class="keyword">this</span>)
<a name="l00074"></a>00074 {
<a name="l00075"></a>00075 }
</pre></div></p>

</div>
</div>
<hr/><h2>関数</h2>
<a class="anchor" id="a8eb60d4744b6212ad749f3a586759266"></a><!-- doxytag: member="Bridge::BridgeMasterPort::checkFunctional" ref="a8eb60d4744b6212ad749f3a586759266" args="(PacketPtr pkt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool checkFunctional </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classPacket.html">PacketPtr</a>&nbsp;</td>
          <td class="paramname"> <em>pkt</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p><a class="el" href="classCheck.html">Check</a> a functional request against the packets in our request queue.</p>
<dl><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pkt</em>&nbsp;</td><td>packet to check against</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>戻り値:</b></dt><dd>true if we find a match </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00387"></a>00387 {
<a name="l00388"></a>00388     <span class="keywordtype">bool</span> found = <span class="keyword">false</span>;
<a name="l00389"></a>00389     <span class="keyword">auto</span> <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> = <a class="code" href="classBridge_1_1BridgeMasterPort.html#a640fbfa2436c06d6f64608f76261e6e5">transmitList</a>.begin();
<a name="l00390"></a>00390 
<a name="l00391"></a>00391     <span class="keywordflow">while</span>(<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> != <a class="code" href="classBridge_1_1BridgeMasterPort.html#a640fbfa2436c06d6f64608f76261e6e5">transmitList</a>.end() &amp;&amp; !found) {
<a name="l00392"></a>00392         <span class="keywordflow">if</span> (pkt-&gt;<a class="code" href="classPacket.html#a77410f93ce8057ce67882c121ac2e667">checkFunctional</a>((*i).pkt)) {
<a name="l00393"></a>00393             pkt-&gt;<a class="code" href="classPacket.html#a9330bf4cbbc7e25bbfc9626182df27e5">makeResponse</a>();
<a name="l00394"></a>00394             found = <span class="keyword">true</span>;
<a name="l00395"></a>00395         }
<a name="l00396"></a>00396         ++<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>;
<a name="l00397"></a>00397     }
<a name="l00398"></a>00398 
<a name="l00399"></a>00399     <span class="keywordflow">return</span> found;
<a name="l00400"></a>00400 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a29cb5a4f98063ce6e9210eacbdb35298"></a><!-- doxytag: member="Bridge::BridgeMasterPort::recvRetry" ref="a29cb5a4f98063ce6e9210eacbdb35298" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void recvRetry </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>When receiving a retry request from the peer port, pass it to the bridge. </p>

<p><a class="el" href="classMasterPort.html#ac1ccc3bcf7ebabb20b57fab99b2be5b0">MasterPort</a>を実装しています。</p>

<p><div class="fragment"><pre class="fragment"><a name="l00345"></a>00345 {
<a name="l00346"></a>00346     <a class="code" href="classBridge_1_1BridgeMasterPort.html#a391c414b53eb45782e37bc539608e477">trySendTiming</a>();
<a name="l00347"></a>00347 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a482dba5588f4bee43e498875a61e5e0b"></a><!-- doxytag: member="Bridge::BridgeMasterPort::recvTimingResp" ref="a482dba5588f4bee43e498875a61e5e0b" args="(PacketPtr pkt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool recvTimingResp </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classPacket.html">PacketPtr</a>&nbsp;</td>
          <td class="paramname"> <em>pkt</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>When receiving a timing request from the peer port, pass it to the bridge. </p>

<p><a class="el" href="classMasterPort.html#abd323548d6c93f8b0543f1fe3a86ca35">MasterPort</a>を実装しています。</p>

<p><div class="fragment"><pre class="fragment"><a name="l00131"></a>00131 {
<a name="l00132"></a>00132     <span class="comment">// all checks are done when the request is accepted on the slave</span>
<a name="l00133"></a>00133     <span class="comment">// side, so we are guaranteed to have space for the response</span>
<a name="l00134"></a>00134     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classBridge.html">Bridge</a>, <span class="stringliteral">&quot;recvTimingResp: %s addr 0x%x\n&quot;</span>,
<a name="l00135"></a>00135             pkt-&gt;<a class="code" href="classPacket.html#a863af57e28a01258236ea303155fc7ff">cmdString</a>(), pkt-&gt;<a class="code" href="classPacket.html#afca9af4d83a57836baba87603463a6e0">getAddr</a>());
<a name="l00136"></a>00136 
<a name="l00137"></a>00137     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classBridge.html">Bridge</a>, <span class="stringliteral">&quot;Request queue size: %d\n&quot;</span>, <a class="code" href="classBridge_1_1BridgeMasterPort.html#a640fbfa2436c06d6f64608f76261e6e5">transmitList</a>.size());
<a name="l00138"></a>00138 
<a name="l00139"></a>00139     <span class="comment">// @todo: We need to pay for this and not just zero it out</span>
<a name="l00140"></a>00140     pkt-&gt;<a class="code" href="classPacket.html#af8986a05caa6c5b96b0b01bb6cf47772">busFirstWordDelay</a> = pkt-&gt;<a class="code" href="classPacket.html#a7bf8ae0a056329f751eda8b39ca4c268">busLastWordDelay</a> = 0;
<a name="l00141"></a>00141 
<a name="l00142"></a>00142     <a class="code" href="classBridge_1_1BridgeMasterPort.html#a1e08ec2f17b79c544fef06a37d6b4ba3">slavePort</a>.schedTimingResp(pkt, <a class="code" href="classBridge_1_1BridgeMasterPort.html#a6d3b24e49ac986064571195ab9905136">bridge</a>.<a class="code" href="classClockedObject.html#a773956693f216cafb7d4cad92ad582e5">clockEdge</a>(<a class="code" href="classBridge_1_1BridgeMasterPort.html#a153dd7cdfa9816427cbbe84dce923c8d">delay</a>));
<a name="l00143"></a>00143 
<a name="l00144"></a>00144     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00145"></a>00145 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5b40b3c494ce10f0e9f0c89965808030"></a><!-- doxytag: member="Bridge::BridgeMasterPort::reqQueueFull" ref="a5b40b3c494ce10f0e9f0c89965808030" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool reqQueueFull </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td> const</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Is this side blocked from accepting new request packets.</p>
<dl class="return"><dt><b>戻り値:</b></dt><dd>true if the occupied space has reached the set limit </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00125"></a>00125 {
<a name="l00126"></a>00126     <span class="keywordflow">return</span> <a class="code" href="classBridge_1_1BridgeMasterPort.html#a640fbfa2436c06d6f64608f76261e6e5">transmitList</a>.size() == <a class="code" href="classBridge_1_1BridgeMasterPort.html#abe7df187a5de0c89447640be0c8d6f87">reqQueueLimit</a>;
<a name="l00127"></a>00127 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6e835b0c02fcb4679fc14de7605b4f13"></a><!-- doxytag: member="Bridge::BridgeMasterPort::schedTimingReq" ref="a6e835b0c02fcb4679fc14de7605b4f13" args="(PacketPtr pkt, Tick when)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void schedTimingReq </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classPacket.html">PacketPtr</a>&nbsp;</td>
          <td class="paramname"> <em>pkt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a>&nbsp;</td>
          <td class="paramname"> <em>when</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Queue a request packet to be sent out later and also schedule a send if necessary.</p>
<dl><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pkt</em>&nbsp;</td><td>a request to send out after a delay </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>when</em>&nbsp;</td><td>tick when response packet should be sent </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l00209"></a>00209 {
<a name="l00210"></a>00210     <span class="comment">// If we expect to see a response, we need to restore the source</span>
<a name="l00211"></a>00211     <span class="comment">// and destination field that is potentially changed by a second</span>
<a name="l00212"></a>00212     <span class="comment">// bus</span>
<a name="l00213"></a>00213     <span class="keywordflow">if</span> (!pkt-&gt;<a class="code" href="classPacket.html#a9693a1ffeda326646443ab2a2a92be41">memInhibitAsserted</a>() &amp;&amp; pkt-&gt;<a class="code" href="classPacket.html#a390c6cced05593f0a2c75a38a7a24fa9">needsResponse</a>()) {
<a name="l00214"></a>00214         <span class="comment">// Update the sender state so we can deal with the response</span>
<a name="l00215"></a>00215         <span class="comment">// appropriately</span>
<a name="l00216"></a>00216         pkt-&gt;<a class="code" href="classPacket.html#a6a6aa11d6c2aec2df5aafeefe2847d8e">pushSenderState</a>(<span class="keyword">new</span> RequestState(pkt-&gt;<a class="code" href="classPacket.html#a6ac1bab8f0db56da42ee3359c3aef5dc" title="Accessor function to get the source index of the packet.">getSrc</a>()));
<a name="l00217"></a>00217     }
<a name="l00218"></a>00218 
<a name="l00219"></a>00219     <span class="comment">// If we&apos;re about to put this packet at the head of the queue, we</span>
<a name="l00220"></a>00220     <span class="comment">// need to schedule an event to do the transmit.  Otherwise there</span>
<a name="l00221"></a>00221     <span class="comment">// should already be an event scheduled for sending the head</span>
<a name="l00222"></a>00222     <span class="comment">// packet.</span>
<a name="l00223"></a>00223     <span class="keywordflow">if</span> (<a class="code" href="classBridge_1_1BridgeMasterPort.html#a640fbfa2436c06d6f64608f76261e6e5">transmitList</a>.empty()) {
<a name="l00224"></a>00224         <a class="code" href="classBridge_1_1BridgeMasterPort.html#a6d3b24e49ac986064571195ab9905136">bridge</a>.<a class="code" href="classEventManager.html#a4ddebbfe9a12b95be6fb993ce892dcd3">schedule</a>(<a class="code" href="classBridge_1_1BridgeMasterPort.html#ac65e9e742d994553fd80b8b38c2bd5dd">sendEvent</a>, when);
<a name="l00225"></a>00225     }
<a name="l00226"></a>00226 
<a name="l00227"></a>00227     assert(<a class="code" href="classBridge_1_1BridgeMasterPort.html#a640fbfa2436c06d6f64608f76261e6e5">transmitList</a>.size() != <a class="code" href="classBridge_1_1BridgeMasterPort.html#abe7df187a5de0c89447640be0c8d6f87">reqQueueLimit</a>);
<a name="l00228"></a>00228 
<a name="l00229"></a>00229     <a class="code" href="classBridge_1_1BridgeMasterPort.html#a640fbfa2436c06d6f64608f76261e6e5">transmitList</a>.push_back(DeferredPacket(pkt, when));
<a name="l00230"></a>00230 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a391c414b53eb45782e37bc539608e477"></a><!-- doxytag: member="Bridge::BridgeMasterPort::trySendTiming" ref="a391c414b53eb45782e37bc539608e477" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void trySendTiming </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Handle send event, scheduled when the packet at the head of the outbound queue is ready to transmit (for timing accesses only). </p>

<p><div class="fragment"><pre class="fragment"><a name="l00263"></a>00263 {
<a name="l00264"></a>00264     assert(!<a class="code" href="classBridge_1_1BridgeMasterPort.html#a640fbfa2436c06d6f64608f76261e6e5">transmitList</a>.empty());
<a name="l00265"></a>00265 
<a name="l00266"></a>00266     DeferredPacket req = <a class="code" href="classBridge_1_1BridgeMasterPort.html#a640fbfa2436c06d6f64608f76261e6e5">transmitList</a>.front();
<a name="l00267"></a>00267 
<a name="l00268"></a>00268     assert(req.tick &lt;= <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The universal simulation clock.">curTick</a>());
<a name="l00269"></a>00269 
<a name="l00270"></a>00270     <a class="code" href="classPacket.html">PacketPtr</a> pkt = req.pkt;
<a name="l00271"></a>00271 
<a name="l00272"></a>00272     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classBridge.html">Bridge</a>, <span class="stringliteral">&quot;trySend request addr 0x%x, queue size %d\n&quot;</span>,
<a name="l00273"></a>00273             pkt-&gt;<a class="code" href="classPacket.html#afca9af4d83a57836baba87603463a6e0">getAddr</a>(), <a class="code" href="classBridge_1_1BridgeMasterPort.html#a640fbfa2436c06d6f64608f76261e6e5">transmitList</a>.size());
<a name="l00274"></a>00274 
<a name="l00275"></a>00275     <span class="keywordflow">if</span> (<a class="code" href="classMasterPort.html#aafaf979005392447714384794f1a8610">sendTimingReq</a>(pkt)) {
<a name="l00276"></a>00276         <span class="comment">// send successful</span>
<a name="l00277"></a>00277         <a class="code" href="classBridge_1_1BridgeMasterPort.html#a640fbfa2436c06d6f64608f76261e6e5">transmitList</a>.pop_front();
<a name="l00278"></a>00278         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classBridge.html">Bridge</a>, <span class="stringliteral">&quot;trySend request successful\n&quot;</span>);
<a name="l00279"></a>00279 
<a name="l00280"></a>00280         <span class="comment">// If there are more packets to send, schedule event to try again.</span>
<a name="l00281"></a>00281         <span class="keywordflow">if</span> (!<a class="code" href="classBridge_1_1BridgeMasterPort.html#a640fbfa2436c06d6f64608f76261e6e5">transmitList</a>.empty()) {
<a name="l00282"></a>00282             DeferredPacket next_req = <a class="code" href="classBridge_1_1BridgeMasterPort.html#a640fbfa2436c06d6f64608f76261e6e5">transmitList</a>.front();
<a name="l00283"></a>00283             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classBridge.html">Bridge</a>, <span class="stringliteral">&quot;Scheduling next send\n&quot;</span>);
<a name="l00284"></a>00284             <a class="code" href="classBridge_1_1BridgeMasterPort.html#a6d3b24e49ac986064571195ab9905136">bridge</a>.<a class="code" href="classEventManager.html#a4ddebbfe9a12b95be6fb993ce892dcd3">schedule</a>(<a class="code" href="classBridge_1_1BridgeMasterPort.html#ac65e9e742d994553fd80b8b38c2bd5dd">sendEvent</a>, std::max(next_req.tick,
<a name="l00285"></a>00285                                                 <a class="code" href="classBridge_1_1BridgeMasterPort.html#a6d3b24e49ac986064571195ab9905136">bridge</a>.<a class="code" href="classClockedObject.html#a773956693f216cafb7d4cad92ad582e5">clockEdge</a>()));
<a name="l00286"></a>00286         }
<a name="l00287"></a>00287 
<a name="l00288"></a>00288         <span class="comment">// if we have stalled a request due to a full request queue,</span>
<a name="l00289"></a>00289         <span class="comment">// then send a retry at this point, also note that if the</span>
<a name="l00290"></a>00290         <span class="comment">// request we stalled was waiting for the response queue</span>
<a name="l00291"></a>00291         <span class="comment">// rather than the request queue we might stall it again</span>
<a name="l00292"></a>00292         <a class="code" href="classBridge_1_1BridgeMasterPort.html#a1e08ec2f17b79c544fef06a37d6b4ba3">slavePort</a>.retryStalledReq();
<a name="l00293"></a>00293     }
<a name="l00294"></a>00294 
<a name="l00295"></a>00295     <span class="comment">// if the send failed, then we try again once we receive a retry,</span>
<a name="l00296"></a>00296     <span class="comment">// and therefore there is no need to take any action</span>
<a name="l00297"></a>00297 }
</pre></div></p>

</div>
</div>
<hr/><h2>変数</h2>
<a class="anchor" id="a6d3b24e49ac986064571195ab9905136"></a><!-- doxytag: member="Bridge::BridgeMasterPort::bridge" ref="a6d3b24e49ac986064571195ab9905136" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classBridge_1_1Bridge.html">Bridge</a>&amp; <a class="el" href="classBridge_1_1BridgeMasterPort.html#a6d3b24e49ac986064571195ab9905136">bridge</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>The bridge to which this port belongs. </p>

</div>
</div>
<a class="anchor" id="a153dd7cdfa9816427cbbe84dce923c8d"></a><!-- doxytag: member="Bridge::BridgeMasterPort::delay" ref="a153dd7cdfa9816427cbbe84dce923c8d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="classCycles.html">Cycles</a> <a class="el" href="classBridge_1_1BridgeMasterPort.html#a153dd7cdfa9816427cbbe84dce923c8d">delay</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Minimum delay though this bridge. </p>

</div>
</div>
<a class="anchor" id="abe7df187a5de0c89447640be0c8d6f87"></a><!-- doxytag: member="Bridge::BridgeMasterPort::reqQueueLimit" ref="abe7df187a5de0c89447640be0c8d6f87" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const unsigned int <a class="el" href="classBridge_1_1BridgeMasterPort.html#abe7df187a5de0c89447640be0c8d6f87">reqQueueLimit</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Max queue size for request packets </p>

</div>
</div>
<a class="anchor" id="ac65e9e742d994553fd80b8b38c2bd5dd"></a><!-- doxytag: member="Bridge::BridgeMasterPort::sendEvent" ref="ac65e9e742d994553fd80b8b38c2bd5dd" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classEventWrapper.html">EventWrapper</a>&lt;<a class="el" href="classBridge_1_1BridgeMasterPort.html">BridgeMasterPort</a>, &amp;BridgeMasterPort::trySendTiming&gt; <a class="el" href="classBridge_1_1BridgeMasterPort.html#ac65e9e742d994553fd80b8b38c2bd5dd">sendEvent</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Send event for the request queue. </p>

</div>
</div>
<a class="anchor" id="a1e08ec2f17b79c544fef06a37d6b4ba3"></a><!-- doxytag: member="Bridge::BridgeMasterPort::slavePort" ref="a1e08ec2f17b79c544fef06a37d6b4ba3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classBridge_1_1BridgeSlavePort.html">BridgeSlavePort</a>&amp; <a class="el" href="classBridge_1_1BridgeMasterPort.html#a1e08ec2f17b79c544fef06a37d6b4ba3">slavePort</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>The slave port on the other side of the bridge (connected to the other bus). </p>

</div>
</div>
<a class="anchor" id="a640fbfa2436c06d6f64608f76261e6e5"></a><!-- doxytag: member="Bridge::BridgeMasterPort::transmitList" ref="a640fbfa2436c06d6f64608f76261e6e5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classstd_1_1deque.html">std::deque</a>&lt;<a class="el" href="classBridge_1_1DeferredPacket.html">DeferredPacket</a>&gt; <a class="el" href="classBridge_1_1BridgeMasterPort.html#a640fbfa2436c06d6f64608f76261e6e5">transmitList</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p><a class="el" href="classRequest.html">Request</a> packet queue. <a class="el" href="classRequest.html">Request</a> packets are held in this queue for a specified delay to model the processing delay of the bridge. We use a deque as we need to iterate over the items for functional accesses. </p>

</div>
</div>
<hr/>このクラスの説明は次のファイルから生成されました:<ul>
<li>mem/<a class="el" href="bridge_8hh_source.html">bridge.hh</a></li>
<li>mem/<a class="el" href="bridge_8cc.html">bridge.cc</a></li>
</ul>
</div>
<hr size="1"/><address style="text-align: right;"><small>File&nbsp;GEM5&nbsp;Wrapperに対して25 May 2015に生成されました。&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
