<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>File&nbsp;GEM5&nbsp;Wrapper: クラス IdeDisk</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- 作成： Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>メインページ</span></a></li>
      <li><a href="pages.html"><span>関連ページ</span></a></li>
      <li><a href="modules.html"><span>モジュール</span></a></li>
      <li><a href="namespaces.html"><span>ネームスペース</span></a></li>
      <li class="current"><a href="annotated.html"><span>クラス</span></a></li>
      <li><a href="files.html"><span>ファイル</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>構成</span></a></li>
      <li><a href="classes.html"><span>構成索引</span></a></li>
      <li><a href="hierarchy.html"><span>クラス階層</span></a></li>
      <li><a href="functions.html"><span>構成メンバ</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>クラス IdeDisk</h1><!-- doxytag: class="IdeDisk" --><!-- doxytag: inherits="SimObject" -->
<p><code>#include &lt;<a class="el" href="ide__disk_8hh_source.html">ide_disk.hh</a>&gt;</code></p>
<div class="dynheader">
IdeDiskに対する継承グラフ</div>
<div class="dynsection">
 <div class="center">
  <img src="classIdeDisk.gif" usemap="#IdeDisk_map" alt=""/>
  <map id="IdeDisk_map" name="IdeDisk_map">
<area href="classSimObject.html" alt="SimObject" shape="rect" coords="105,56,200,80"/>
<area href="classEventManager.html" alt="EventManager" shape="rect" coords="0,0,95,24"/>
<area href="classSerializable.html" alt="Serializable" shape="rect" coords="105,0,200,24"/>
<area href="classDrainable.html" alt="Drainable" shape="rect" coords="210,0,305,24"/>
</map>
 </div>
</div>

<p><a href="classIdeDisk-members.html">すべてのメンバ一覧</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Public 型</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef IdeDiskParams&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#a21c0f7d16893ae472d7dbbc6df963053">Params</a></td></tr>
<tr><td colspan="2"><h2>Public メソッド</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#a2e3da8ce499e288eefcec4c9bd396958">IdeDisk</a> (const <a class="el" href="classIdeDisk.html#a21c0f7d16893ae472d7dbbc6df963053">Params</a> *p)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#ad8843ac1fd1bc4b6d82e57318c9aeb38">~IdeDisk</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#a28f0332a5e13753c3f831ce1772b50c7">reset</a> (int id)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#a4dc637449366fcdfc4e764cdf12d9b11">regStats</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#a2ffee462d2d9876fd5b3c6afc9a491bb">setController</a> (<a class="el" href="classIdeController.html">IdeController</a> *c)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#acf65df6ca6cb788da5cc36454d47cc34">readCommand</a> (const <a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a> offset, int size, uint8_t *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#a9eb9bf3059a1fb59a282c5b86ad10ce6">readControl</a> (const <a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a> offset, int size, uint8_t *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#af940c7b6408a2bb34bdd3580e8415da6">writeCommand</a> (const <a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a> offset, int size, const uint8_t *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#af8e7a0d1414a2f9b03e2e001e036e87b">writeControl</a> (const <a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a> offset, int size, const uint8_t *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#a5f7be8f129b212ec5a0f25ce5c65dbd7">startDma</a> (const <a class="el" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> &amp;prdTableBase)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#a477c235c4d75b02347129c86b67161ea">abortDma</a> ()</td></tr>
<tr><td colspan="2"><h2>Protected 変数</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classIdeController.html">IdeController</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#a15da11d9f856cf2edfc6ed93e24ad0ea">ctrl</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classDiskImage.html">DiskImage</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#a86d47120637a95e3a6876c774d768030">image</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#af49c4a1e28104d83429a5ae73e388143">diskDelay</a></td></tr>
<tr><td colspan="2"><h2>Private メソッド</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#a64f80702e39e45d2a65869911928c8ca">startCommand</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#aba6fa755ca152cedafeb4150da6a2493">intrPost</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#ac02b8a3b8685eca8bb4b237b29dfc762">intrClear</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#aa620b27b5598b2b7590329b64291460d">doDmaTransfer</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#aac34c7bd9c30398a876820e7bf616b72">doDmaDataRead</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#a4349f9ce6cbcc189128ed2968e74e497">doDmaRead</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#ae0d5ccabc77ef46a2850230fcf2e44de">doDmaDataWrite</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#ae547bc5391513f6cea7d857dc015f5da">doDmaWrite</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#a251a4f7092f0f261661c759eb4cdbd9b">dmaPrdReadDone</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#a2854a0676c5ef05d69512cabd994959c">dmaReadDone</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#a830e4a686d005a80a9fbf09c5d6d493e">dmaWriteDone</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#a8df41040225176356e649c3d35e11c62">readDisk</a> (<a class="el" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> sector, uint8_t *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#aaf5688ef23ac188d55decc9021229d43">writeDisk</a> (<a class="el" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> sector, uint8_t *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#a24fb6794cfae6f84b380080e7501959e">updateState</a> (<a class="el" href="ide__disk_8hh.html#ab9a7252f05d40d629a2b3e780862846c">DevAction_t</a> action)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#a61117d164479a7bbd3ed3d9afc8e261b">isBSYSet</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#a3e0ad2d309fc4a7aaa7a8af8b09d2cc0">isIENSet</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#a910d3c770ea864b505ae99ee7e674640">isDEVSelect</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#a57e01c0e3593bc187fa343f761ec895a">setComplete</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#af02a88c6960b020d71b0d6b95e41bab1">getLBABase</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#a8f2f46748053f3f3686a295cb3552ecd">pciToDma</a> (<a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a> pciAddr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#a53e036786d17361be4c7320d39c99b84">serialize</a> (std::ostream &amp;os)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#af22e5d6d660b97db37003ac61ac4ee49">unserialize</a> (<a class="el" href="classCheckpoint.html">Checkpoint</a> *cp, const std::string &amp;section)</td></tr>
<tr><td colspan="2"><h2>Private 変数</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structataparams.html">ataparams</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#ae8a5371b95892db84d2b7ecef320d8a9">driveID</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint8_t *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#a54aefba7f330b07a06f4c9447e582f09">dataBuffer</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#a732862da3f80cd2b8eaba9425c8415f5">cmdBytes</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#a70940fc29adad666da15b3d4c11ac2ff">cmdBytesLeft</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#a93e2e2892d126eac3ce8dbb514d44c31">drqBytesLeft</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#af7d6af3e55b20feac31aac92469e56f3">curSector</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structCommandReg.html">CommandReg_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#a2d468138409fc099c81da8d9b62f1f0f">cmdReg</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#ade818037fd6c985038ff29656089758d">status</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#ad58649fd94c5f762267f1d7bf682f6ca">nIENBit</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="ide__disk_8hh.html#abe49db4804c1744e30c8df026681eaf0">DevState_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#a5fb52a264b2cccb6ccad92493dff5deb">devState</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="ide__disk_8hh.html#a398a1d251e78562f1eccfb43ad5fdf49">DmaState_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#acdefad9ebc91ac85f00ff92347b944d7">dmaState</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#a3f1cf4317e46c3c845d144c5e0334096">dmaRead</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#a13b6a0a9519069583d8648b3eafa0448">curPrdAddr</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classPrdTableEntry.html">PrdTableEntry</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#a550dda68894801d065c57391335a8590">curPrd</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#a5f20adde61bc73f1275a1a35481a011d">devID</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#aabb849037e6d1c429d270d7fd20e958f">intrPending</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#aedff89f76b12103a29d22ef4de302236">dmaAborted</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classStats_1_1Scalar.html">Stats::Scalar</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#abab6bdef4c30741f3ec4b69e44e9d7c6">dmaReadFullPages</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classStats_1_1Scalar.html">Stats::Scalar</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#a01f4e9b11f3b49ac1cb6cbb6d51674c2">dmaReadBytes</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classStats_1_1Scalar.html">Stats::Scalar</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#a4310d460e8c2b5db635c0b2d1f1887a1">dmaReadTxs</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classStats_1_1Scalar.html">Stats::Scalar</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#adca0399abe696c769a268759b7823090">dmaWriteFullPages</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classStats_1_1Scalar.html">Stats::Scalar</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#a59676f0552c89ab5f75ed2e6d8fca378">dmaWriteBytes</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classStats_1_1Scalar.html">Stats::Scalar</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#a2bb232dff5f135210d3350a21d1c9ccf">dmaWriteTxs</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classEventWrapper.html">EventWrapper</a>&lt; <a class="el" href="classIdeDisk.html">IdeDisk</a>,&amp;IdeDisk::doDmaTransfer &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#aa90327d610dcc75173d1cd63671c6d31">dmaTransferEvent</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classChunkGenerator.html">ChunkGenerator</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#aafb836a34095616e67256a58e31ca604">dmaReadCG</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classEventWrapper.html">EventWrapper</a>&lt; <a class="el" href="classIdeDisk.html">IdeDisk</a>,&amp;IdeDisk::doDmaRead &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#a163b3ebdf005a99628b313b535697fb4">dmaReadWaitEvent</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classChunkGenerator.html">ChunkGenerator</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#a9efaedbad52401a1b8ac2b8f1dffd28e">dmaWriteCG</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classEventWrapper.html">EventWrapper</a>&lt; <a class="el" href="classIdeDisk.html">IdeDisk</a>,&amp;IdeDisk::doDmaWrite &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#ad35ded50a6e608571cb80f1ad9741514">dmaWriteWaitEvent</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classEventWrapper.html">EventWrapper</a>&lt; <a class="el" href="classIdeDisk.html">IdeDisk</a>,&amp;IdeDisk::dmaPrdReadDone &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#aee6a35e547d828db5c3f993da6179be0">dmaPrdReadEvent</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classEventWrapper.html">EventWrapper</a>&lt; <a class="el" href="classIdeDisk.html">IdeDisk</a>,&amp;IdeDisk::dmaReadDone &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#a7c5e1828543bec774a42b971376bb618">dmaReadEvent</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classEventWrapper.html">EventWrapper</a>&lt; <a class="el" href="classIdeDisk.html">IdeDisk</a>,&amp;IdeDisk::dmaWriteDone &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#a6c721e441022d80574b109229351326a">dmaWriteEvent</a></td></tr>
<tr><td colspan="2"><h2>フレンド</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#a07dd701b52fa01c73a9a70a11490190f">EventWrapper&lt; IdeDisk,&amp;IdeDisk::doDmaTransfer &gt;</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#accdc7f0b6fabdd3d77c1b559d5145f1e">EventWrapper&lt; IdeDisk,&amp;IdeDisk::doDmaRead &gt;</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#ab5b4eef2a93f5c96df001eac024301e2">EventWrapper&lt; IdeDisk,&amp;IdeDisk::doDmaWrite &gt;</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#a576a5609a96330636252b99a5d689e36">EventWrapper&lt; IdeDisk,&amp;IdeDisk::dmaPrdReadDone &gt;</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#a6de24ef3cf489b4e2419c1ce290ea10f">EventWrapper&lt; IdeDisk,&amp;IdeDisk::dmaReadDone &gt;</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classIdeDisk.html#ad39ee160ecba74f2b017af931eec8c6c">EventWrapper&lt; IdeDisk,&amp;IdeDisk::dmaWriteDone &gt;</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>説明</h2>
<p>IDE Disk device model </p>
<hr/><h2>型定義</h2>
<a class="anchor" id="a21c0f7d16893ae472d7dbbc6df963053"></a><!-- doxytag: member="IdeDisk::Params" ref="a21c0f7d16893ae472d7dbbc6df963053" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef IdeDiskParams <a class="el" href="classIdeDisk.html#a21c0f7d16893ae472d7dbbc6df963053">Params</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><a class="el" href="classSimObject.html#a0f0761d2db586a23bb2a2880b8f387bb">SimObject</a>を再定義しています。</p>

</div>
</div>
<hr/><h2>コンストラクタとデストラクタ</h2>
<a class="anchor" id="a2e3da8ce499e288eefcec4c9bd396958"></a><!-- doxytag: member="IdeDisk::IdeDisk" ref="a2e3da8ce499e288eefcec4c9bd396958" args="(const Params *p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classIdeDisk.html">IdeDisk</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classIdeDisk.html#a21c0f7d16893ae472d7dbbc6df963053">Params</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00069"></a>00069     : <a class="code" href="classSimObject.html#a153e2844edadce7c286efc5e3a7da911">SimObject</a>(<a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a>), <a class="code" href="classIdeDisk.html#a15da11d9f856cf2edfc6ed93e24ad0ea">ctrl</a>(<a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>), <a class="code" href="classIdeDisk.html#a86d47120637a95e3a6876c774d768030">image</a>(<a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a>-&gt;image), <a class="code" href="classIdeDisk.html#af49c4a1e28104d83429a5ae73e388143">diskDelay</a>(<a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a>-&gt;delay),
<a name="l00070"></a>00070       <a class="code" href="classIdeDisk.html#aa90327d610dcc75173d1cd63671c6d31">dmaTransferEvent</a>(<span class="keyword">this</span>), <a class="code" href="classIdeDisk.html#aafb836a34095616e67256a58e31ca604">dmaReadCG</a>(<a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>), <a class="code" href="classIdeDisk.html#a163b3ebdf005a99628b313b535697fb4">dmaReadWaitEvent</a>(<span class="keyword">this</span>),
<a name="l00071"></a>00071       <a class="code" href="classIdeDisk.html#a9efaedbad52401a1b8ac2b8f1dffd28e">dmaWriteCG</a>(<a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>), <a class="code" href="classIdeDisk.html#ad35ded50a6e608571cb80f1ad9741514">dmaWriteWaitEvent</a>(<span class="keyword">this</span>), <a class="code" href="classIdeDisk.html#aee6a35e547d828db5c3f993da6179be0">dmaPrdReadEvent</a>(<span class="keyword">this</span>),
<a name="l00072"></a>00072       <a class="code" href="classIdeDisk.html#a7c5e1828543bec774a42b971376bb618">dmaReadEvent</a>(<span class="keyword">this</span>), <a class="code" href="classIdeDisk.html#a6c721e441022d80574b109229351326a">dmaWriteEvent</a>(<span class="keyword">this</span>)
<a name="l00073"></a>00073 {
<a name="l00074"></a>00074     <span class="comment">// Reset the device state</span>
<a name="l00075"></a>00075     <a class="code" href="classIdeDisk.html#a28f0332a5e13753c3f831ce1772b50c7">reset</a>(<a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a>-&gt;driveID);
<a name="l00076"></a>00076 
<a name="l00077"></a>00077     <span class="comment">// fill out the drive ID structure</span>
<a name="l00078"></a>00078     memset(&amp;<a class="code" href="classIdeDisk.html#ae8a5371b95892db84d2b7ecef320d8a9">driveID</a>, 0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structataparams.html">ataparams</a>));
<a name="l00079"></a>00079 
<a name="l00080"></a>00080     <span class="comment">// Calculate LBA and C/H/S values</span>
<a name="l00081"></a>00081     uint16_t cylinders;
<a name="l00082"></a>00082     uint8_t heads;
<a name="l00083"></a>00083     uint8_t sectors;
<a name="l00084"></a>00084 
<a name="l00085"></a>00085     <a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> lba_size = <a class="code" href="classIdeDisk.html#a86d47120637a95e3a6876c774d768030">image</a>-&gt;<a class="code" href="classDiskImage.html#a0e772d58951a6696fce770bd4c390e9f">size</a>();
<a name="l00086"></a>00086     <span class="keywordflow">if</span> (lba_size &gt;= 16383*16*63) {
<a name="l00087"></a>00087         cylinders = 16383;
<a name="l00088"></a>00088         heads = 16;
<a name="l00089"></a>00089         sectors = 63;
<a name="l00090"></a>00090     } <span class="keywordflow">else</span> {
<a name="l00091"></a>00091         <span class="keywordflow">if</span> (lba_size &gt;= 63)
<a name="l00092"></a>00092             sectors = 63;
<a name="l00093"></a>00093         <span class="keywordflow">else</span>
<a name="l00094"></a>00094             sectors = lba_size;
<a name="l00095"></a>00095 
<a name="l00096"></a>00096         <span class="keywordflow">if</span> ((lba_size / sectors) &gt;= 16)
<a name="l00097"></a>00097             heads = 16;
<a name="l00098"></a>00098         <span class="keywordflow">else</span>
<a name="l00099"></a>00099             heads = (lba_size / sectors);
<a name="l00100"></a>00100 
<a name="l00101"></a>00101         cylinders = lba_size / (heads * sectors);
<a name="l00102"></a>00102     }
<a name="l00103"></a>00103 
<a name="l00104"></a>00104     <span class="comment">// Setup the model name</span>
<a name="l00105"></a>00105     strncpy((<span class="keywordtype">char</span> *)<a class="code" href="classIdeDisk.html#ae8a5371b95892db84d2b7ecef320d8a9">driveID</a>.<a class="code" href="structataparams.html#a00e967bbcc15120c0e7b6ad5defd6383">atap_model</a>, <span class="stringliteral">&quot;5MI EDD si k&quot;</span>,
<a name="l00106"></a>00106             <span class="keyword">sizeof</span>(<a class="code" href="classIdeDisk.html#ae8a5371b95892db84d2b7ecef320d8a9">driveID</a>.<a class="code" href="structataparams.html#a00e967bbcc15120c0e7b6ad5defd6383">atap_model</a>));
<a name="l00107"></a>00107     <span class="comment">// Set the maximum multisector transfer size</span>
<a name="l00108"></a>00108     <a class="code" href="classIdeDisk.html#ae8a5371b95892db84d2b7ecef320d8a9">driveID</a>.<a class="code" href="structataparams.html#a31d9f08382d53e4d5e0aaf60715d53fe">atap_multi</a> = <a class="code" href="ide__disk_8hh.html#a78590681c8717cc04539b5c406dda023">MAX_MULTSECT</a>;
<a name="l00109"></a>00109     <span class="comment">// IORDY supported, IORDY disabled, LBA enabled, DMA enabled</span>
<a name="l00110"></a>00110     <a class="code" href="classIdeDisk.html#ae8a5371b95892db84d2b7ecef320d8a9">driveID</a>.<a class="code" href="structataparams.html#a1d272658b0bdb751e3fd307d62882f56">atap_capabilities1</a> = 0x7;
<a name="l00111"></a>00111     <span class="comment">// UDMA support, EIDE support</span>
<a name="l00112"></a>00112     <a class="code" href="classIdeDisk.html#ae8a5371b95892db84d2b7ecef320d8a9">driveID</a>.<a class="code" href="structataparams.html#a889f469aeaa5b91b11f78d93a47c02ba">atap_extensions</a> = 0x6;
<a name="l00113"></a>00113     <span class="comment">// Setup default C/H/S settings</span>
<a name="l00114"></a>00114     <a class="code" href="classIdeDisk.html#ae8a5371b95892db84d2b7ecef320d8a9">driveID</a>.<a class="code" href="structataparams.html#a7abbec036cc95d2afd40700411da1d34">atap_cylinders</a> = cylinders;
<a name="l00115"></a>00115     <a class="code" href="classIdeDisk.html#ae8a5371b95892db84d2b7ecef320d8a9">driveID</a>.<a class="code" href="structataparams.html#aea2e9a1373bc2e48360c489b6a980f73">atap_sectors</a> = sectors;
<a name="l00116"></a>00116     <a class="code" href="classIdeDisk.html#ae8a5371b95892db84d2b7ecef320d8a9">driveID</a>.<a class="code" href="structataparams.html#a32f5c3fe0fedd30e7430fd78eb347750">atap_heads</a> = heads;
<a name="l00117"></a>00117     <span class="comment">// Setup the current multisector transfer size</span>
<a name="l00118"></a>00118     <a class="code" href="classIdeDisk.html#ae8a5371b95892db84d2b7ecef320d8a9">driveID</a>.<a class="code" href="structataparams.html#a4f5de807f00c4eb57cdc18c202397aa3">atap_curmulti</a> = <a class="code" href="ide__disk_8hh.html#a78590681c8717cc04539b5c406dda023">MAX_MULTSECT</a>;
<a name="l00119"></a>00119     <a class="code" href="classIdeDisk.html#ae8a5371b95892db84d2b7ecef320d8a9">driveID</a>.<a class="code" href="structataparams.html#adff1e9e9584894e80c012f70e6340635">atap_curmulti_valid</a> = 0x1;
<a name="l00120"></a>00120     <span class="comment">// Number of sectors on disk</span>
<a name="l00121"></a>00121     <a class="code" href="classIdeDisk.html#ae8a5371b95892db84d2b7ecef320d8a9">driveID</a>.<a class="code" href="structataparams.html#a0ec3c731f44748c9a0bfd19db9003af6">atap_capacity</a> = lba_size;
<a name="l00122"></a>00122     <span class="comment">// Multiword DMA mode 2 and below supported</span>
<a name="l00123"></a>00123     <a class="code" href="classIdeDisk.html#ae8a5371b95892db84d2b7ecef320d8a9">driveID</a>.<a class="code" href="structataparams.html#a1d90f926499b28f5a5148e6e9102af0d">atap_dmamode_supp</a> = 0x4;
<a name="l00124"></a>00124     <span class="comment">// Set PIO mode 4 and 3 supported</span>
<a name="l00125"></a>00125     <a class="code" href="classIdeDisk.html#ae8a5371b95892db84d2b7ecef320d8a9">driveID</a>.<a class="code" href="structataparams.html#a279fd18bfea282fe3c4d7beb6e0be4ef">atap_piomode_supp</a> = 0x3;
<a name="l00126"></a>00126     <span class="comment">// Set DMA mode 4 and below supported</span>
<a name="l00127"></a>00127     <a class="code" href="classIdeDisk.html#ae8a5371b95892db84d2b7ecef320d8a9">driveID</a>.<a class="code" href="structataparams.html#a50f15151b8e9e897f18e693c9f1d2e43">atap_udmamode_supp</a> = 0x1f;
<a name="l00128"></a>00128     <span class="comment">// Statically set hardware config word</span>
<a name="l00129"></a>00129     <a class="code" href="classIdeDisk.html#ae8a5371b95892db84d2b7ecef320d8a9">driveID</a>.<a class="code" href="structataparams.html#aeae5b21453e8911f9501e724fe87c973">atap_hwreset_res</a> = 0x4001;
<a name="l00130"></a>00130 
<a name="l00131"></a>00131     <span class="comment">//arbitrary for now...</span>
<a name="l00132"></a>00132     <a class="code" href="classIdeDisk.html#ae8a5371b95892db84d2b7ecef320d8a9">driveID</a>.<a class="code" href="structataparams.html#ae28c5731e91bd1eb31e5ac3fc993ff09">atap_ata_major</a> = <a class="code" href="ide__atareg_8h.html#adae20c65eac0a1851ff40283c570575e">WDC_VER_ATA7</a>;
<a name="l00133"></a>00133 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad8843ac1fd1bc4b6d82e57318c9aeb38"></a><!-- doxytag: member="IdeDisk::~IdeDisk" ref="ad8843ac1fd1bc4b6d82e57318c9aeb38" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">~<a class="el" href="classIdeDisk.html">IdeDisk</a> </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Delete the data buffer. </p>

<p><div class="fragment"><pre class="fragment"><a name="l00136"></a>00136 {
<a name="l00137"></a>00137     <span class="comment">// destroy the data buffer</span>
<a name="l00138"></a>00138     <span class="keyword">delete</span> [] <a class="code" href="classIdeDisk.html#a54aefba7f330b07a06f4c9447e582f09">dataBuffer</a>;
<a name="l00139"></a>00139 }
</pre></div></p>

</div>
</div>
<hr/><h2>関数</h2>
<a class="anchor" id="a477c235c4d75b02347129c86b67161ea"></a><!-- doxytag: member="IdeDisk::abortDma" ref="a477c235c4d75b02347129c86b67161ea" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void abortDma </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00609"></a>00609 {
<a name="l00610"></a>00610     <span class="keywordflow">if</span> (<a class="code" href="classIdeDisk.html#acdefad9ebc91ac85f00ff92347b944d7">dmaState</a> == <a class="code" href="ide__disk_8hh.html#a8adb9656d6ea50580adaf9c8e7d9eebfa98b4f39d2f8dca680f8b1ac92943966c">Dma_Idle</a>)
<a name="l00611"></a>00611         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Inconsistent DMA state, should be Start or Transfer!&quot;</span>);
<a name="l00612"></a>00612 
<a name="l00613"></a>00613     <span class="keywordflow">if</span> (<a class="code" href="classIdeDisk.html#a5fb52a264b2cccb6ccad92493dff5deb">devState</a> != <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6a64d0d40fb6f851777564c89760787a96">Transfer_Data_Dma</a> &amp;&amp; <a class="code" href="classIdeDisk.html#a5fb52a264b2cccb6ccad92493dff5deb">devState</a> != <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6aed547cd1619ef3146a31732b777681ee">Prepare_Data_Dma</a>)
<a name="l00614"></a>00614         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Inconsistent device state, should be Transfer or Prepare!\n&quot;</span>);
<a name="l00615"></a>00615 
<a name="l00616"></a>00616     <a class="code" href="classIdeDisk.html#a24fb6794cfae6f84b380080e7501959e">updateState</a>(<a class="code" href="ide__disk_8hh.html#a3bae184d288bce92398b814aa118c15ca564e5d0c9a0d03e4e0d901a18100c6fd">ACT_CMD_ERROR</a>);
<a name="l00617"></a>00617 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a251a4f7092f0f261661c759eb4cdbd9b"></a><!-- doxytag: member="IdeDisk::dmaPrdReadDone" ref="a251a4f7092f0f261661c759eb4cdbd9b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dmaPrdReadDone </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00355"></a>00355 {
<a name="l00356"></a>00356     <span class="keywordflow">if</span> (<a class="code" href="classIdeDisk.html#aedff89f76b12103a29d22ef4de302236">dmaAborted</a>) {
<a name="l00357"></a>00357         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classIdeDisk.html">IdeDisk</a>, <span class="stringliteral">&quot;DMA Aborted while reading PRD entry\n&quot;</span>);
<a name="l00358"></a>00358         <a class="code" href="classIdeDisk.html#a24fb6794cfae6f84b380080e7501959e">updateState</a>(<a class="code" href="ide__disk_8hh.html#a3bae184d288bce92398b814aa118c15ca564e5d0c9a0d03e4e0d901a18100c6fd">ACT_CMD_ERROR</a>);
<a name="l00359"></a>00359         <span class="keywordflow">return</span>;
<a name="l00360"></a>00360     }
<a name="l00361"></a>00361 
<a name="l00362"></a>00362     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classIdeDisk.html">IdeDisk</a>,
<a name="l00363"></a>00363             <span class="stringliteral">&quot;PRD: baseAddr:%#x (%#x) byteCount:%d (%d) eot:%#x sector:%d\n&quot;</span>,
<a name="l00364"></a>00364             <a class="code" href="classIdeDisk.html#a550dda68894801d065c57391335a8590">curPrd</a>.<a class="code" href="classPrdTableEntry.html#ad5094152459cac71546bdbd2a88a06e1">getBaseAddr</a>(), <a class="code" href="classIdeDisk.html#a8f2f46748053f3f3686a295cb3552ecd">pciToDma</a>(<a class="code" href="classIdeDisk.html#a550dda68894801d065c57391335a8590">curPrd</a>.<a class="code" href="classPrdTableEntry.html#ad5094152459cac71546bdbd2a88a06e1">getBaseAddr</a>()),
<a name="l00365"></a>00365             <a class="code" href="classIdeDisk.html#a550dda68894801d065c57391335a8590">curPrd</a>.<a class="code" href="classPrdTableEntry.html#aeb2b8df06bf82475ef82d84c80a61813">getByteCount</a>(), (<a class="code" href="classIdeDisk.html#a70940fc29adad666da15b3d4c11ac2ff">cmdBytesLeft</a>/<a class="code" href="disk__image_8hh.html#ac729b32bca4535899ef2ee58b6a13d68">SectorSize</a>),
<a name="l00366"></a>00366             <a class="code" href="classIdeDisk.html#a550dda68894801d065c57391335a8590">curPrd</a>.<a class="code" href="classPrdTableEntry.html#a15470a9b6762e3776b9cd784a74421c4">getEOT</a>(), <a class="code" href="classIdeDisk.html#af7d6af3e55b20feac31aac92469e56f3">curSector</a>);
<a name="l00367"></a>00367 
<a name="l00368"></a>00368     <span class="comment">// the prd pointer has already been translated, so just do an increment</span>
<a name="l00369"></a>00369     <a class="code" href="classIdeDisk.html#a13b6a0a9519069583d8648b3eafa0448">curPrdAddr</a> = curPrdAddr + <span class="keyword">sizeof</span>(<a class="code" href="structPrdEntry.html">PrdEntry_t</a>);
<a name="l00370"></a>00370 
<a name="l00371"></a>00371     <span class="keywordflow">if</span> (<a class="code" href="classIdeDisk.html#a3f1cf4317e46c3c845d144c5e0334096">dmaRead</a>)
<a name="l00372"></a>00372         <a class="code" href="classIdeDisk.html#aac34c7bd9c30398a876820e7bf616b72">doDmaDataRead</a>();
<a name="l00373"></a>00373     <span class="keywordflow">else</span>
<a name="l00374"></a>00374         <a class="code" href="classIdeDisk.html#ae0d5ccabc77ef46a2850230fcf2e44de">doDmaDataWrite</a>();
<a name="l00375"></a>00375 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2854a0676c5ef05d69512cabd994959c"></a><!-- doxytag: member="IdeDisk::dmaReadDone" ref="a2854a0676c5ef05d69512cabd994959c" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dmaReadDone </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00461"></a>00461 {
<a name="l00462"></a>00462     <a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> bytesWritten = 0;
<a name="l00463"></a>00463 
<a name="l00464"></a>00464     <span class="comment">// write the data to the disk image</span>
<a name="l00465"></a>00465     <span class="keywordflow">for</span> (bytesWritten = 0; bytesWritten &lt; <a class="code" href="classIdeDisk.html#a550dda68894801d065c57391335a8590">curPrd</a>.<a class="code" href="classPrdTableEntry.html#aeb2b8df06bf82475ef82d84c80a61813">getByteCount</a>();
<a name="l00466"></a>00466          bytesWritten += <a class="code" href="disk__image_8hh.html#ac729b32bca4535899ef2ee58b6a13d68">SectorSize</a>) {
<a name="l00467"></a>00467 
<a name="l00468"></a>00468         <a class="code" href="classIdeDisk.html#a70940fc29adad666da15b3d4c11ac2ff">cmdBytesLeft</a> -= <a class="code" href="disk__image_8hh.html#ac729b32bca4535899ef2ee58b6a13d68">SectorSize</a>;
<a name="l00469"></a>00469         <a class="code" href="classIdeDisk.html#aaf5688ef23ac188d55decc9021229d43">writeDisk</a>(<a class="code" href="classIdeDisk.html#af7d6af3e55b20feac31aac92469e56f3">curSector</a>++, (uint8_t *)(<a class="code" href="classIdeDisk.html#a54aefba7f330b07a06f4c9447e582f09">dataBuffer</a> + bytesWritten));
<a name="l00470"></a>00470     }
<a name="l00471"></a>00471 
<a name="l00472"></a>00472     <span class="comment">// check for the EOT</span>
<a name="l00473"></a>00473     <span class="keywordflow">if</span> (<a class="code" href="classIdeDisk.html#a550dda68894801d065c57391335a8590">curPrd</a>.<a class="code" href="classPrdTableEntry.html#a15470a9b6762e3776b9cd784a74421c4">getEOT</a>()) {
<a name="l00474"></a>00474         assert(<a class="code" href="classIdeDisk.html#a70940fc29adad666da15b3d4c11ac2ff">cmdBytesLeft</a> == 0);
<a name="l00475"></a>00475         <a class="code" href="classIdeDisk.html#acdefad9ebc91ac85f00ff92347b944d7">dmaState</a> = <a class="code" href="ide__disk_8hh.html#a8adb9656d6ea50580adaf9c8e7d9eebfa98b4f39d2f8dca680f8b1ac92943966c">Dma_Idle</a>;
<a name="l00476"></a>00476         <a class="code" href="classIdeDisk.html#a24fb6794cfae6f84b380080e7501959e">updateState</a>(<a class="code" href="ide__disk_8hh.html#a3bae184d288bce92398b814aa118c15cacce8d2685977821326c313a603e35f7a">ACT_DMA_DONE</a>);
<a name="l00477"></a>00477     } <span class="keywordflow">else</span> {
<a name="l00478"></a>00478         <a class="code" href="classIdeDisk.html#aa620b27b5598b2b7590329b64291460d">doDmaTransfer</a>();
<a name="l00479"></a>00479     }
<a name="l00480"></a>00480 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a830e4a686d005a80a9fbf09c5d6d493e"></a><!-- doxytag: member="IdeDisk::dmaWriteDone" ref="a830e4a686d005a80a9fbf09c5d6d493e" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dmaWriteDone </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00548"></a>00548 {
<a name="l00549"></a>00549     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classIdeDisk.html">IdeDisk</a>, <span class="stringliteral">&quot;doWriteDone: curPrd byte count %d, eot %#x cmd bytes left:%d\n&quot;</span>,
<a name="l00550"></a>00550                 <a class="code" href="classIdeDisk.html#a550dda68894801d065c57391335a8590">curPrd</a>.<a class="code" href="classPrdTableEntry.html#aeb2b8df06bf82475ef82d84c80a61813">getByteCount</a>(), <a class="code" href="classIdeDisk.html#a550dda68894801d065c57391335a8590">curPrd</a>.<a class="code" href="classPrdTableEntry.html#a15470a9b6762e3776b9cd784a74421c4">getEOT</a>(), <a class="code" href="classIdeDisk.html#a70940fc29adad666da15b3d4c11ac2ff">cmdBytesLeft</a>);
<a name="l00551"></a>00551     <span class="comment">// check for the EOT</span>
<a name="l00552"></a>00552     <span class="keywordflow">if</span> (<a class="code" href="classIdeDisk.html#a550dda68894801d065c57391335a8590">curPrd</a>.<a class="code" href="classPrdTableEntry.html#a15470a9b6762e3776b9cd784a74421c4">getEOT</a>()) {
<a name="l00553"></a>00553         assert(<a class="code" href="classIdeDisk.html#a70940fc29adad666da15b3d4c11ac2ff">cmdBytesLeft</a> == 0);
<a name="l00554"></a>00554         <a class="code" href="classIdeDisk.html#acdefad9ebc91ac85f00ff92347b944d7">dmaState</a> = <a class="code" href="ide__disk_8hh.html#a8adb9656d6ea50580adaf9c8e7d9eebfa98b4f39d2f8dca680f8b1ac92943966c">Dma_Idle</a>;
<a name="l00555"></a>00555         <a class="code" href="classIdeDisk.html#a24fb6794cfae6f84b380080e7501959e">updateState</a>(<a class="code" href="ide__disk_8hh.html#a3bae184d288bce92398b814aa118c15cacce8d2685977821326c313a603e35f7a">ACT_DMA_DONE</a>);
<a name="l00556"></a>00556     } <span class="keywordflow">else</span> {
<a name="l00557"></a>00557         <a class="code" href="classIdeDisk.html#aa620b27b5598b2b7590329b64291460d">doDmaTransfer</a>();
<a name="l00558"></a>00558     }
<a name="l00559"></a>00559 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aac34c7bd9c30398a876820e7bf616b72"></a><!-- doxytag: member="IdeDisk::doDmaDataRead" ref="aac34c7bd9c30398a876820e7bf616b72" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void doDmaDataRead </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><dl class="todo"><dt><b><a class="el" href="todo.html#_todo000057">TODO:</a></b></dt><dd>we need to figure out what the delay actually will be </dd></dl>
</p>

<p><div class="fragment"><pre class="fragment"><a name="l00379"></a>00379 {
<a name="l00381"></a>00381     <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> totalDiskDelay = <a class="code" href="classIdeDisk.html#af49c4a1e28104d83429a5ae73e388143">diskDelay</a> + (<a class="code" href="classIdeDisk.html#a550dda68894801d065c57391335a8590">curPrd</a>.<a class="code" href="classPrdTableEntry.html#aeb2b8df06bf82475ef82d84c80a61813">getByteCount</a>() / <a class="code" href="disk__image_8hh.html#ac729b32bca4535899ef2ee58b6a13d68">SectorSize</a>);
<a name="l00382"></a>00382 
<a name="l00383"></a>00383     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classIdeDisk.html">IdeDisk</a>, <span class="stringliteral">&quot;doDmaRead, diskDelay: %d totalDiskDelay: %d\n&quot;</span>,
<a name="l00384"></a>00384             <a class="code" href="classIdeDisk.html#af49c4a1e28104d83429a5ae73e388143">diskDelay</a>, totalDiskDelay);
<a name="l00385"></a>00385 
<a name="l00386"></a>00386     <a class="code" href="classEventManager.html#a4ddebbfe9a12b95be6fb993ce892dcd3">schedule</a>(<a class="code" href="classIdeDisk.html#a163b3ebdf005a99628b313b535697fb4">dmaReadWaitEvent</a>, <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The universal simulation clock.">curTick</a>() + totalDiskDelay);
<a name="l00387"></a>00387 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae0d5ccabc77ef46a2850230fcf2e44de"></a><!-- doxytag: member="IdeDisk::doDmaDataWrite" ref="ae0d5ccabc77ef46a2850230fcf2e44de" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void doDmaDataWrite </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><dl class="todo"><dt><b><a class="el" href="todo.html#_todo000058">TODO:</a></b></dt><dd>we need to figure out what the delay actually will be </dd></dl>
</p>

<p><div class="fragment"><pre class="fragment"><a name="l00484"></a>00484 {
<a name="l00486"></a>00486     <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> totalDiskDelay = <a class="code" href="classIdeDisk.html#af49c4a1e28104d83429a5ae73e388143">diskDelay</a> + (<a class="code" href="classIdeDisk.html#a550dda68894801d065c57391335a8590">curPrd</a>.<a class="code" href="classPrdTableEntry.html#aeb2b8df06bf82475ef82d84c80a61813">getByteCount</a>() / <a class="code" href="disk__image_8hh.html#ac729b32bca4535899ef2ee58b6a13d68">SectorSize</a>);
<a name="l00487"></a>00487     <a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> bytesRead = 0;
<a name="l00488"></a>00488 
<a name="l00489"></a>00489     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classIdeDisk.html">IdeDisk</a>, <span class="stringliteral">&quot;doDmaWrite, diskDelay: %d totalDiskDelay: %d\n&quot;</span>,
<a name="l00490"></a>00490             <a class="code" href="classIdeDisk.html#af49c4a1e28104d83429a5ae73e388143">diskDelay</a>, totalDiskDelay);
<a name="l00491"></a>00491 
<a name="l00492"></a>00492     memset(<a class="code" href="classIdeDisk.html#a54aefba7f330b07a06f4c9447e582f09">dataBuffer</a>, 0, <a class="code" href="ide__disk_8hh.html#a941d6074126345e6acdf3d91ee305b11">MAX_DMA_SIZE</a>);
<a name="l00493"></a>00493     assert(<a class="code" href="classIdeDisk.html#a70940fc29adad666da15b3d4c11ac2ff">cmdBytesLeft</a> &lt;= <a class="code" href="ide__disk_8hh.html#a941d6074126345e6acdf3d91ee305b11">MAX_DMA_SIZE</a>);
<a name="l00494"></a>00494     <span class="keywordflow">while</span> (bytesRead &lt; <a class="code" href="classIdeDisk.html#a550dda68894801d065c57391335a8590">curPrd</a>.<a class="code" href="classPrdTableEntry.html#aeb2b8df06bf82475ef82d84c80a61813">getByteCount</a>()) {
<a name="l00495"></a>00495         <a class="code" href="classIdeDisk.html#a8df41040225176356e649c3d35e11c62">readDisk</a>(<a class="code" href="classIdeDisk.html#af7d6af3e55b20feac31aac92469e56f3">curSector</a>++, (uint8_t *)(<a class="code" href="classIdeDisk.html#a54aefba7f330b07a06f4c9447e582f09">dataBuffer</a> + bytesRead));
<a name="l00496"></a>00496         bytesRead += <a class="code" href="disk__image_8hh.html#ac729b32bca4535899ef2ee58b6a13d68">SectorSize</a>;
<a name="l00497"></a>00497         <a class="code" href="classIdeDisk.html#a70940fc29adad666da15b3d4c11ac2ff">cmdBytesLeft</a> -= <a class="code" href="disk__image_8hh.html#ac729b32bca4535899ef2ee58b6a13d68">SectorSize</a>;
<a name="l00498"></a>00498     }
<a name="l00499"></a>00499     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classIdeDisk.html">IdeDisk</a>, <span class="stringliteral">&quot;doDmaWrite, bytesRead: %d cmdBytesLeft: %d\n&quot;</span>,
<a name="l00500"></a>00500             bytesRead, <a class="code" href="classIdeDisk.html#a70940fc29adad666da15b3d4c11ac2ff">cmdBytesLeft</a>);
<a name="l00501"></a>00501 
<a name="l00502"></a>00502     <a class="code" href="classEventManager.html#a4ddebbfe9a12b95be6fb993ce892dcd3">schedule</a>(<a class="code" href="classIdeDisk.html#ad35ded50a6e608571cb80f1ad9741514">dmaWriteWaitEvent</a>, <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The universal simulation clock.">curTick</a>() + totalDiskDelay);
<a name="l00503"></a>00503 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4349f9ce6cbcc189128ed2968e74e497"></a><!-- doxytag: member="IdeDisk::doDmaRead" ref="a4349f9ce6cbcc189128ed2968e74e497" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void doDmaRead </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00422"></a>00422 {
<a name="l00423"></a>00423     <span class="keywordflow">if</span> (<a class="code" href="classIdeDisk.html#aedff89f76b12103a29d22ef4de302236">dmaAborted</a>) {
<a name="l00424"></a>00424         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classIdeDisk.html">IdeDisk</a>, <span class="stringliteral">&quot;DMA Aborted in middle of Dma Read\n&quot;</span>);
<a name="l00425"></a>00425         <span class="keywordflow">if</span> (<a class="code" href="classIdeDisk.html#aafb836a34095616e67256a58e31ca604">dmaReadCG</a>)
<a name="l00426"></a>00426             <span class="keyword">delete</span> <a class="code" href="classIdeDisk.html#aafb836a34095616e67256a58e31ca604">dmaReadCG</a>;
<a name="l00427"></a>00427         <a class="code" href="classIdeDisk.html#aafb836a34095616e67256a58e31ca604">dmaReadCG</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00428"></a>00428         <a class="code" href="classIdeDisk.html#a24fb6794cfae6f84b380080e7501959e">updateState</a>(<a class="code" href="ide__disk_8hh.html#a3bae184d288bce92398b814aa118c15ca564e5d0c9a0d03e4e0d901a18100c6fd">ACT_CMD_ERROR</a>);
<a name="l00429"></a>00429         <span class="keywordflow">return</span>;
<a name="l00430"></a>00430     }
<a name="l00431"></a>00431 
<a name="l00432"></a>00432     <span class="keywordflow">if</span> (!<a class="code" href="classIdeDisk.html#aafb836a34095616e67256a58e31ca604">dmaReadCG</a>) {
<a name="l00433"></a>00433         <span class="comment">// clear out the data buffer</span>
<a name="l00434"></a>00434         memset(<a class="code" href="classIdeDisk.html#a54aefba7f330b07a06f4c9447e582f09">dataBuffer</a>, 0, <a class="code" href="ide__disk_8hh.html#a941d6074126345e6acdf3d91ee305b11">MAX_DMA_SIZE</a>);
<a name="l00435"></a>00435         <a class="code" href="classIdeDisk.html#aafb836a34095616e67256a58e31ca604">dmaReadCG</a> = <span class="keyword">new</span> <a class="code" href="classChunkGenerator.html">ChunkGenerator</a>(<a class="code" href="classIdeDisk.html#a550dda68894801d065c57391335a8590">curPrd</a>.<a class="code" href="classPrdTableEntry.html#ad5094152459cac71546bdbd2a88a06e1">getBaseAddr</a>(),
<a name="l00436"></a>00436                 <a class="code" href="classIdeDisk.html#a550dda68894801d065c57391335a8590">curPrd</a>.<a class="code" href="classPrdTableEntry.html#aeb2b8df06bf82475ef82d84c80a61813">getByteCount</a>(), <a class="code" href="namespaceAlphaISA.html#ad9d6a4d965e107c9a7214f096107296b">TheISA::PageBytes</a>);
<a name="l00437"></a>00437 
<a name="l00438"></a>00438     }
<a name="l00439"></a>00439     <span class="keywordflow">if</span> (<a class="code" href="classIdeDisk.html#a15da11d9f856cf2edfc6ed93e24ad0ea">ctrl</a>-&gt;<a class="code" href="classDmaDevice.html#a481b9352c138101d0f84f163a760c6e5">dmaPending</a>() || <a class="code" href="classIdeDisk.html#a15da11d9f856cf2edfc6ed93e24ad0ea">ctrl</a>-&gt;<a class="code" href="classDrainable.html#a5c95358f0e9355bcc3979baf3fb7307f">getDrainState</a>() != <a class="code" href="classDrainable.html#a5d74787dedbc4e11c1ab15bf487e61f8a2f5f2c4a8c4f4f0519d503dcdfbf55cb">Drainable::Running</a>) {
<a name="l00440"></a>00440         <a class="code" href="classEventManager.html#a4ddebbfe9a12b95be6fb993ce892dcd3">schedule</a>(<a class="code" href="classIdeDisk.html#a163b3ebdf005a99628b313b535697fb4">dmaReadWaitEvent</a>, <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The universal simulation clock.">curTick</a>() + <a class="code" href="ide__disk_8hh.html#a64bcea63cca60e512b1094c19fc4c587">DMA_BACKOFF_PERIOD</a>);
<a name="l00441"></a>00441         <span class="keywordflow">return</span>;
<a name="l00442"></a>00442     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="classIdeDisk.html#aafb836a34095616e67256a58e31ca604">dmaReadCG</a>-&gt;<a class="code" href="classChunkGenerator.html#a6db83072bdb45ff66ab856903170c40d">done</a>()) {
<a name="l00443"></a>00443         assert(<a class="code" href="classIdeDisk.html#aafb836a34095616e67256a58e31ca604">dmaReadCG</a>-&gt;<a class="code" href="classChunkGenerator.html#a63320000d91910d20f33799285652714">complete</a>() &lt; <a class="code" href="ide__disk_8hh.html#a941d6074126345e6acdf3d91ee305b11">MAX_DMA_SIZE</a>);
<a name="l00444"></a>00444         <a class="code" href="classIdeDisk.html#a15da11d9f856cf2edfc6ed93e24ad0ea">ctrl</a>-&gt;<a class="code" href="classDmaDevice.html#a8ca93dacaa427cede08842a958aa1b23">dmaRead</a>(<a class="code" href="classIdeDisk.html#a8f2f46748053f3f3686a295cb3552ecd">pciToDma</a>(<a class="code" href="classIdeDisk.html#aafb836a34095616e67256a58e31ca604">dmaReadCG</a>-&gt;<a class="code" href="classChunkGenerator.html#a4e8648f42b38341a268850a18c86830d">addr</a>()), <a class="code" href="classIdeDisk.html#aafb836a34095616e67256a58e31ca604">dmaReadCG</a>-&gt;<a class="code" href="classChunkGenerator.html#acdb549c592f948a9d973d4d84b02ef87">size</a>(),
<a name="l00445"></a>00445                 &amp;<a class="code" href="classIdeDisk.html#a163b3ebdf005a99628b313b535697fb4">dmaReadWaitEvent</a>, <a class="code" href="classIdeDisk.html#a54aefba7f330b07a06f4c9447e582f09">dataBuffer</a> + <a class="code" href="classIdeDisk.html#aafb836a34095616e67256a58e31ca604">dmaReadCG</a>-&gt;<a class="code" href="classChunkGenerator.html#a63320000d91910d20f33799285652714">complete</a>());
<a name="l00446"></a>00446         <a class="code" href="classIdeDisk.html#a01f4e9b11f3b49ac1cb6cbb6d51674c2">dmaReadBytes</a> += <a class="code" href="classIdeDisk.html#aafb836a34095616e67256a58e31ca604">dmaReadCG</a>-&gt;<a class="code" href="classChunkGenerator.html#acdb549c592f948a9d973d4d84b02ef87">size</a>();
<a name="l00447"></a>00447         <a class="code" href="classIdeDisk.html#a4310d460e8c2b5db635c0b2d1f1887a1">dmaReadTxs</a>++;
<a name="l00448"></a>00448         <span class="keywordflow">if</span> (<a class="code" href="classIdeDisk.html#aafb836a34095616e67256a58e31ca604">dmaReadCG</a>-&gt;<a class="code" href="classChunkGenerator.html#acdb549c592f948a9d973d4d84b02ef87">size</a>() == <a class="code" href="namespaceAlphaISA.html#ad9d6a4d965e107c9a7214f096107296b">TheISA::PageBytes</a>)
<a name="l00449"></a>00449             <a class="code" href="classIdeDisk.html#abab6bdef4c30741f3ec4b69e44e9d7c6">dmaReadFullPages</a>++;
<a name="l00450"></a>00450         <a class="code" href="classIdeDisk.html#aafb836a34095616e67256a58e31ca604">dmaReadCG</a>-&gt;<a class="code" href="classChunkGenerator.html#a80870c233d0237e3588a2d6f8d176916">next</a>();
<a name="l00451"></a>00451     } <span class="keywordflow">else</span> {
<a name="l00452"></a>00452         assert(<a class="code" href="classIdeDisk.html#aafb836a34095616e67256a58e31ca604">dmaReadCG</a>-&gt;<a class="code" href="classChunkGenerator.html#a6db83072bdb45ff66ab856903170c40d">done</a>());
<a name="l00453"></a>00453         <span class="keyword">delete</span> <a class="code" href="classIdeDisk.html#aafb836a34095616e67256a58e31ca604">dmaReadCG</a>;
<a name="l00454"></a>00454         dmaReadCG = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00455"></a>00455         <a class="code" href="classIdeDisk.html#a2854a0676c5ef05d69512cabd994959c">dmaReadDone</a>();
<a name="l00456"></a>00456     }
<a name="l00457"></a>00457 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa620b27b5598b2b7590329b64291460d"></a><!-- doxytag: member="IdeDisk::doDmaTransfer" ref="aa620b27b5598b2b7590329b64291460d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void doDmaTransfer </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00334"></a>00334 {
<a name="l00335"></a>00335     <span class="keywordflow">if</span> (<a class="code" href="classIdeDisk.html#aedff89f76b12103a29d22ef4de302236">dmaAborted</a>) {
<a name="l00336"></a>00336         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classIdeDisk.html">IdeDisk</a>, <span class="stringliteral">&quot;DMA Aborted before reading PRD entry\n&quot;</span>);
<a name="l00337"></a>00337         <a class="code" href="classIdeDisk.html#a24fb6794cfae6f84b380080e7501959e">updateState</a>(<a class="code" href="ide__disk_8hh.html#a3bae184d288bce92398b814aa118c15ca564e5d0c9a0d03e4e0d901a18100c6fd">ACT_CMD_ERROR</a>);
<a name="l00338"></a>00338         <span class="keywordflow">return</span>;
<a name="l00339"></a>00339     }
<a name="l00340"></a>00340 
<a name="l00341"></a>00341     <span class="keywordflow">if</span> (<a class="code" href="classIdeDisk.html#acdefad9ebc91ac85f00ff92347b944d7">dmaState</a> != <a class="code" href="ide__disk_8hh.html#a8adb9656d6ea50580adaf9c8e7d9eebfa1479e31de2b235a422d366215ade33d4">Dma_Transfer</a> || <a class="code" href="classIdeDisk.html#a5fb52a264b2cccb6ccad92493dff5deb">devState</a> != <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6a64d0d40fb6f851777564c89760787a96">Transfer_Data_Dma</a>)
<a name="l00342"></a>00342         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Inconsistent DMA transfer state: dmaState = %d devState = %d\n&quot;</span>,
<a name="l00343"></a>00343               <a class="code" href="classIdeDisk.html#acdefad9ebc91ac85f00ff92347b944d7">dmaState</a>, <a class="code" href="classIdeDisk.html#a5fb52a264b2cccb6ccad92493dff5deb">devState</a>);
<a name="l00344"></a>00344 
<a name="l00345"></a>00345     <span class="keywordflow">if</span> (<a class="code" href="classIdeDisk.html#a15da11d9f856cf2edfc6ed93e24ad0ea">ctrl</a>-&gt;<a class="code" href="classDmaDevice.html#a481b9352c138101d0f84f163a760c6e5">dmaPending</a>() || <a class="code" href="classIdeDisk.html#a15da11d9f856cf2edfc6ed93e24ad0ea">ctrl</a>-&gt;<a class="code" href="classDrainable.html#a5c95358f0e9355bcc3979baf3fb7307f">getDrainState</a>() != <a class="code" href="classDrainable.html#a5d74787dedbc4e11c1ab15bf487e61f8a2f5f2c4a8c4f4f0519d503dcdfbf55cb">Drainable::Running</a>) {
<a name="l00346"></a>00346         <a class="code" href="classEventManager.html#a4ddebbfe9a12b95be6fb993ce892dcd3">schedule</a>(<a class="code" href="classIdeDisk.html#aa90327d610dcc75173d1cd63671c6d31">dmaTransferEvent</a>, <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The universal simulation clock.">curTick</a>() + <a class="code" href="ide__disk_8hh.html#a64bcea63cca60e512b1094c19fc4c587">DMA_BACKOFF_PERIOD</a>);
<a name="l00347"></a>00347         <span class="keywordflow">return</span>;
<a name="l00348"></a>00348     } <span class="keywordflow">else</span>
<a name="l00349"></a>00349         <a class="code" href="classIdeDisk.html#a15da11d9f856cf2edfc6ed93e24ad0ea">ctrl</a>-&gt;<a class="code" href="classDmaDevice.html#a8ca93dacaa427cede08842a958aa1b23">dmaRead</a>(<a class="code" href="classIdeDisk.html#a13b6a0a9519069583d8648b3eafa0448">curPrdAddr</a>, <span class="keyword">sizeof</span>(<a class="code" href="structPrdEntry.html">PrdEntry_t</a>), &amp;<a class="code" href="classIdeDisk.html#aee6a35e547d828db5c3f993da6179be0">dmaPrdReadEvent</a>,
<a name="l00350"></a>00350                 (uint8_t*)&amp;<a class="code" href="classIdeDisk.html#a550dda68894801d065c57391335a8590">curPrd</a>.<a class="code" href="classPrdTableEntry.html#a367da4f281ab033aae067ee206649f04">entry</a>);
<a name="l00351"></a>00351 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae547bc5391513f6cea7d857dc015f5da"></a><!-- doxytag: member="IdeDisk::doDmaWrite" ref="ae547bc5391513f6cea7d857dc015f5da" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void doDmaWrite </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00507"></a>00507 {
<a name="l00508"></a>00508     <span class="keywordflow">if</span> (<a class="code" href="classIdeDisk.html#aedff89f76b12103a29d22ef4de302236">dmaAborted</a>) {
<a name="l00509"></a>00509         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classIdeDisk.html">IdeDisk</a>, <span class="stringliteral">&quot;DMA Aborted while doing DMA Write\n&quot;</span>);
<a name="l00510"></a>00510         <span class="keywordflow">if</span> (<a class="code" href="classIdeDisk.html#a9efaedbad52401a1b8ac2b8f1dffd28e">dmaWriteCG</a>)
<a name="l00511"></a>00511             <span class="keyword">delete</span> <a class="code" href="classIdeDisk.html#a9efaedbad52401a1b8ac2b8f1dffd28e">dmaWriteCG</a>;
<a name="l00512"></a>00512         <a class="code" href="classIdeDisk.html#a9efaedbad52401a1b8ac2b8f1dffd28e">dmaWriteCG</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00513"></a>00513         <a class="code" href="classIdeDisk.html#a24fb6794cfae6f84b380080e7501959e">updateState</a>(<a class="code" href="ide__disk_8hh.html#a3bae184d288bce92398b814aa118c15ca564e5d0c9a0d03e4e0d901a18100c6fd">ACT_CMD_ERROR</a>);
<a name="l00514"></a>00514         <span class="keywordflow">return</span>;
<a name="l00515"></a>00515     }
<a name="l00516"></a>00516     <span class="keywordflow">if</span> (!<a class="code" href="classIdeDisk.html#a9efaedbad52401a1b8ac2b8f1dffd28e">dmaWriteCG</a>) {
<a name="l00517"></a>00517         <span class="comment">// clear out the data buffer</span>
<a name="l00518"></a>00518         <a class="code" href="classIdeDisk.html#a9efaedbad52401a1b8ac2b8f1dffd28e">dmaWriteCG</a> = <span class="keyword">new</span> <a class="code" href="classChunkGenerator.html">ChunkGenerator</a>(<a class="code" href="classIdeDisk.html#a550dda68894801d065c57391335a8590">curPrd</a>.<a class="code" href="classPrdTableEntry.html#ad5094152459cac71546bdbd2a88a06e1">getBaseAddr</a>(),
<a name="l00519"></a>00519                 <a class="code" href="classIdeDisk.html#a550dda68894801d065c57391335a8590">curPrd</a>.<a class="code" href="classPrdTableEntry.html#aeb2b8df06bf82475ef82d84c80a61813">getByteCount</a>(), <a class="code" href="namespaceAlphaISA.html#ad9d6a4d965e107c9a7214f096107296b">TheISA::PageBytes</a>);
<a name="l00520"></a>00520     }
<a name="l00521"></a>00521     <span class="keywordflow">if</span> (<a class="code" href="classIdeDisk.html#a15da11d9f856cf2edfc6ed93e24ad0ea">ctrl</a>-&gt;<a class="code" href="classDmaDevice.html#a481b9352c138101d0f84f163a760c6e5">dmaPending</a>() || <a class="code" href="classIdeDisk.html#a15da11d9f856cf2edfc6ed93e24ad0ea">ctrl</a>-&gt;<a class="code" href="classDrainable.html#a5c95358f0e9355bcc3979baf3fb7307f">getDrainState</a>() != <a class="code" href="classDrainable.html#a5d74787dedbc4e11c1ab15bf487e61f8a2f5f2c4a8c4f4f0519d503dcdfbf55cb">Drainable::Running</a>) {
<a name="l00522"></a>00522         <a class="code" href="classEventManager.html#a4ddebbfe9a12b95be6fb993ce892dcd3">schedule</a>(<a class="code" href="classIdeDisk.html#ad35ded50a6e608571cb80f1ad9741514">dmaWriteWaitEvent</a>, <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The universal simulation clock.">curTick</a>() + <a class="code" href="ide__disk_8hh.html#a64bcea63cca60e512b1094c19fc4c587">DMA_BACKOFF_PERIOD</a>);
<a name="l00523"></a>00523         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classIdeDisk.html">IdeDisk</a>, <span class="stringliteral">&quot;doDmaWrite: rescheduling\n&quot;</span>);
<a name="l00524"></a>00524         <span class="keywordflow">return</span>;
<a name="l00525"></a>00525     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="classIdeDisk.html#a9efaedbad52401a1b8ac2b8f1dffd28e">dmaWriteCG</a>-&gt;<a class="code" href="classChunkGenerator.html#a6db83072bdb45ff66ab856903170c40d">done</a>()) {
<a name="l00526"></a>00526         assert(<a class="code" href="classIdeDisk.html#a9efaedbad52401a1b8ac2b8f1dffd28e">dmaWriteCG</a>-&gt;<a class="code" href="classChunkGenerator.html#a63320000d91910d20f33799285652714">complete</a>() &lt; <a class="code" href="ide__disk_8hh.html#a941d6074126345e6acdf3d91ee305b11">MAX_DMA_SIZE</a>);
<a name="l00527"></a>00527         <a class="code" href="classIdeDisk.html#a15da11d9f856cf2edfc6ed93e24ad0ea">ctrl</a>-&gt;<a class="code" href="classDmaDevice.html#a4a2db8a9eb52a00a9a2e19c2eb3753dc">dmaWrite</a>(<a class="code" href="classIdeDisk.html#a8f2f46748053f3f3686a295cb3552ecd">pciToDma</a>(<a class="code" href="classIdeDisk.html#a9efaedbad52401a1b8ac2b8f1dffd28e">dmaWriteCG</a>-&gt;<a class="code" href="classChunkGenerator.html#a4e8648f42b38341a268850a18c86830d">addr</a>()), <a class="code" href="classIdeDisk.html#a9efaedbad52401a1b8ac2b8f1dffd28e">dmaWriteCG</a>-&gt;<a class="code" href="classChunkGenerator.html#acdb549c592f948a9d973d4d84b02ef87">size</a>(),
<a name="l00528"></a>00528                 &amp;<a class="code" href="classIdeDisk.html#ad35ded50a6e608571cb80f1ad9741514">dmaWriteWaitEvent</a>, <a class="code" href="classIdeDisk.html#a54aefba7f330b07a06f4c9447e582f09">dataBuffer</a> + <a class="code" href="classIdeDisk.html#a9efaedbad52401a1b8ac2b8f1dffd28e">dmaWriteCG</a>-&gt;<a class="code" href="classChunkGenerator.html#a63320000d91910d20f33799285652714">complete</a>());
<a name="l00529"></a>00529         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classIdeDisk.html">IdeDisk</a>, <span class="stringliteral">&quot;doDmaWrite: not done curPrd byte count %d, eot %#x\n&quot;</span>,
<a name="l00530"></a>00530                 <a class="code" href="classIdeDisk.html#a550dda68894801d065c57391335a8590">curPrd</a>.<a class="code" href="classPrdTableEntry.html#aeb2b8df06bf82475ef82d84c80a61813">getByteCount</a>(), <a class="code" href="classIdeDisk.html#a550dda68894801d065c57391335a8590">curPrd</a>.<a class="code" href="classPrdTableEntry.html#a15470a9b6762e3776b9cd784a74421c4">getEOT</a>());
<a name="l00531"></a>00531         <a class="code" href="classIdeDisk.html#a59676f0552c89ab5f75ed2e6d8fca378">dmaWriteBytes</a> += <a class="code" href="classIdeDisk.html#a9efaedbad52401a1b8ac2b8f1dffd28e">dmaWriteCG</a>-&gt;<a class="code" href="classChunkGenerator.html#acdb549c592f948a9d973d4d84b02ef87">size</a>();
<a name="l00532"></a>00532         <a class="code" href="classIdeDisk.html#a2bb232dff5f135210d3350a21d1c9ccf">dmaWriteTxs</a>++;
<a name="l00533"></a>00533         <span class="keywordflow">if</span> (<a class="code" href="classIdeDisk.html#a9efaedbad52401a1b8ac2b8f1dffd28e">dmaWriteCG</a>-&gt;<a class="code" href="classChunkGenerator.html#acdb549c592f948a9d973d4d84b02ef87">size</a>() == <a class="code" href="namespaceAlphaISA.html#ad9d6a4d965e107c9a7214f096107296b">TheISA::PageBytes</a>)
<a name="l00534"></a>00534             <a class="code" href="classIdeDisk.html#adca0399abe696c769a268759b7823090">dmaWriteFullPages</a>++;
<a name="l00535"></a>00535         <a class="code" href="classIdeDisk.html#a9efaedbad52401a1b8ac2b8f1dffd28e">dmaWriteCG</a>-&gt;<a class="code" href="classChunkGenerator.html#a80870c233d0237e3588a2d6f8d176916">next</a>();
<a name="l00536"></a>00536     } <span class="keywordflow">else</span> {
<a name="l00537"></a>00537         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classIdeDisk.html">IdeDisk</a>, <span class="stringliteral">&quot;doDmaWrite: done curPrd byte count %d, eot %#x\n&quot;</span>,
<a name="l00538"></a>00538                 <a class="code" href="classIdeDisk.html#a550dda68894801d065c57391335a8590">curPrd</a>.<a class="code" href="classPrdTableEntry.html#aeb2b8df06bf82475ef82d84c80a61813">getByteCount</a>(), <a class="code" href="classIdeDisk.html#a550dda68894801d065c57391335a8590">curPrd</a>.<a class="code" href="classPrdTableEntry.html#a15470a9b6762e3776b9cd784a74421c4">getEOT</a>());
<a name="l00539"></a>00539         assert(<a class="code" href="classIdeDisk.html#a9efaedbad52401a1b8ac2b8f1dffd28e">dmaWriteCG</a>-&gt;<a class="code" href="classChunkGenerator.html#a6db83072bdb45ff66ab856903170c40d">done</a>());
<a name="l00540"></a>00540         <span class="keyword">delete</span> <a class="code" href="classIdeDisk.html#a9efaedbad52401a1b8ac2b8f1dffd28e">dmaWriteCG</a>;
<a name="l00541"></a>00541         dmaWriteCG = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00542"></a>00542         <a class="code" href="classIdeDisk.html#a830e4a686d005a80a9fbf09c5d6d493e">dmaWriteDone</a>();
<a name="l00543"></a>00543     }
<a name="l00544"></a>00544 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af02a88c6960b020d71b0d6b95e41bab1"></a><!-- doxytag: member="IdeDisk::getLBABase" ref="af02a88c6960b020d71b0d6b95e41bab1" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> getLBABase </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00361"></a>00361     {
<a name="l00362"></a>00362         <span class="keywordflow">return</span>  (<a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a>)(((<a class="code" href="classIdeDisk.html#a2d468138409fc099c81da8d9b62f1f0f">cmdReg</a>.<a class="code" href="structCommandReg.html#a9794c0e61506b826b49b458708ae2489">head</a> &amp; 0xf) &lt;&lt; 24) | (<a class="code" href="classIdeDisk.html#a2d468138409fc099c81da8d9b62f1f0f">cmdReg</a>.<a class="code" href="structCommandReg.html#a0b9715d01f574b6b31ac724f2039f8db">cyl_high</a> &lt;&lt; 16) |
<a name="l00363"></a>00363                        (<a class="code" href="classIdeDisk.html#a2d468138409fc099c81da8d9b62f1f0f">cmdReg</a>.<a class="code" href="structCommandReg.html#ab766960269178a004098748902b2b456">cyl_low</a> &lt;&lt; 8) | (<a class="code" href="classIdeDisk.html#a2d468138409fc099c81da8d9b62f1f0f">cmdReg</a>.<a class="code" href="structCommandReg.html#a3940c6ebbd3db04528668419e3569c78">sec_num</a>));
<a name="l00364"></a>00364     }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac02b8a3b8685eca8bb4b237b29dfc762"></a><!-- doxytag: member="IdeDisk::intrClear" ref="ac02b8a3b8685eca8bb4b237b29dfc762" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void intrClear </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00749"></a>00749 {
<a name="l00750"></a>00750     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classIdeDisk.html">IdeDisk</a>, <span class="stringliteral">&quot;Clearing Interrupt\n&quot;</span>);
<a name="l00751"></a>00751     <span class="keywordflow">if</span> (!<a class="code" href="classIdeDisk.html#aabb849037e6d1c429d270d7fd20e958f">intrPending</a>)
<a name="l00752"></a>00752         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Attempt to clear a non-pending interrupt\n&quot;</span>);
<a name="l00753"></a>00753 
<a name="l00754"></a>00754     <a class="code" href="classIdeDisk.html#aabb849037e6d1c429d270d7fd20e958f">intrPending</a> = <span class="keyword">false</span>;
<a name="l00755"></a>00755 
<a name="l00756"></a>00756     <span class="comment">// talk to controller to clear interrupt</span>
<a name="l00757"></a>00757     <span class="keywordflow">if</span> (<a class="code" href="classIdeDisk.html#a15da11d9f856cf2edfc6ed93e24ad0ea">ctrl</a>)
<a name="l00758"></a>00758         <a class="code" href="classIdeDisk.html#a15da11d9f856cf2edfc6ed93e24ad0ea">ctrl</a>-&gt;<a class="code" href="classPciDevice.html#ac02b8a3b8685eca8bb4b237b29dfc762">intrClear</a>();
<a name="l00759"></a>00759 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aba6fa755ca152cedafeb4150da6a2493"></a><!-- doxytag: member="IdeDisk::intrPost" ref="aba6fa755ca152cedafeb4150da6a2493" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void intrPost </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00734"></a>00734 {
<a name="l00735"></a>00735     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classIdeDisk.html">IdeDisk</a>, <span class="stringliteral">&quot;Posting Interrupt\n&quot;</span>);
<a name="l00736"></a>00736     <span class="keywordflow">if</span> (<a class="code" href="classIdeDisk.html#aabb849037e6d1c429d270d7fd20e958f">intrPending</a>)
<a name="l00737"></a>00737         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Attempt to post an interrupt with one pending\n&quot;</span>);
<a name="l00738"></a>00738 
<a name="l00739"></a>00739     <a class="code" href="classIdeDisk.html#aabb849037e6d1c429d270d7fd20e958f">intrPending</a> = <span class="keyword">true</span>;
<a name="l00740"></a>00740 
<a name="l00741"></a>00741     <span class="comment">// talk to controller to set interrupt</span>
<a name="l00742"></a>00742     <span class="keywordflow">if</span> (<a class="code" href="classIdeDisk.html#a15da11d9f856cf2edfc6ed93e24ad0ea">ctrl</a>) {
<a name="l00743"></a>00743         <a class="code" href="classIdeDisk.html#a15da11d9f856cf2edfc6ed93e24ad0ea">ctrl</a>-&gt;<a class="code" href="classIdeController.html#aba6fa755ca152cedafeb4150da6a2493">intrPost</a>();
<a name="l00744"></a>00744     }
<a name="l00745"></a>00745 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a61117d164479a7bbd3ed3d9afc8e261b"></a><!-- doxytag: member="IdeDisk::isBSYSet" ref="a61117d164479a7bbd3ed3d9afc8e261b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool isBSYSet </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00346"></a>00346 { <span class="keywordflow">return</span> (<a class="code" href="classIdeDisk.html#ade818037fd6c985038ff29656089758d">status</a> &amp; <a class="code" href="ide__disk_8hh.html#a3d03a0c27c2a175009ae7cb5f1a5b5e1">STATUS_BSY_BIT</a>); }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a910d3c770ea864b505ae99ee7e674640"></a><!-- doxytag: member="IdeDisk::isDEVSelect" ref="a910d3c770ea864b505ae99ee7e674640" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool isDEVSelect </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00187"></a>00187 {
<a name="l00188"></a>00188     <span class="keywordflow">return</span> <a class="code" href="classIdeDisk.html#a15da11d9f856cf2edfc6ed93e24ad0ea">ctrl</a>-&gt;<a class="code" href="classIdeController.html#ab16ba5b7c8f5e314b4003eb4bf9d40bf">isDiskSelected</a>(<span class="keyword">this</span>);
<a name="l00189"></a>00189 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3e0ad2d309fc4a7aaa7a8af8b09d2cc0"></a><!-- doxytag: member="IdeDisk::isIENSet" ref="a3e0ad2d309fc4a7aaa7a8af8b09d2cc0" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool isIENSet </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00347"></a>00347 { <span class="keywordflow">return</span> <a class="code" href="classIdeDisk.html#ad58649fd94c5f762267f1d7bf682f6ca">nIENBit</a>; }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8f2f46748053f3f3686a295cb3552ecd"></a><!-- doxytag: member="IdeDisk::pciToDma" ref="a8f2f46748053f3f3686a295cb3552ecd" args="(Addr pciAddr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a> pciToDma </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a>&nbsp;</td>
          <td class="paramname"> <em>pciAddr</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00193"></a>00193 {
<a name="l00194"></a>00194     <span class="keywordflow">if</span> (<a class="code" href="classIdeDisk.html#a15da11d9f856cf2edfc6ed93e24ad0ea">ctrl</a>)
<a name="l00195"></a>00195         <span class="keywordflow">return</span> <a class="code" href="classIdeDisk.html#a15da11d9f856cf2edfc6ed93e24ad0ea">ctrl</a>-&gt;<a class="code" href="classPciDevice.html#a87078b3d3a28ae134f6736337e90dac3">pciToDma</a>(pciAddr);
<a name="l00196"></a>00196     <span class="keywordflow">else</span>
<a name="l00197"></a>00197         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Access to unset controller!\n&quot;</span>);
<a name="l00198"></a>00198 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="acf65df6ca6cb788da5cc36454d47cc34"></a><!-- doxytag: member="IdeDisk::readCommand" ref="acf65df6ca6cb788da5cc36454d47cc34" args="(const Addr offset, int size, uint8_t *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void readCommand </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a>&nbsp;</td>
          <td class="paramname"> <em>offset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00206"></a>00206 {
<a name="l00207"></a>00207     <span class="keywordflow">if</span> (<a class="code" href="namespaceArmISA.html#a87b7a740701cddafb930a9460e9f4eba">offset</a> == <a class="code" href="ide__disk_8hh.html#a11faa4c105a137b8edaa096de5063835">DATA_OFFSET</a>) {
<a name="l00208"></a>00208         <span class="keywordflow">if</span> (size == <span class="keyword">sizeof</span>(uint16_t)) {
<a name="l00209"></a>00209             *(uint16_t *)data = <a class="code" href="classIdeDisk.html#a2d468138409fc099c81da8d9b62f1f0f">cmdReg</a>.<a class="code" href="structCommandReg.html#aa6e451eccf9519b0809baad41f5ab241">data</a>;
<a name="l00210"></a>00210         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (size == <span class="keyword">sizeof</span>(<a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>)) {
<a name="l00211"></a>00211             *(uint16_t *)data = <a class="code" href="classIdeDisk.html#a2d468138409fc099c81da8d9b62f1f0f">cmdReg</a>.<a class="code" href="structCommandReg.html#aa6e451eccf9519b0809baad41f5ab241">data</a>;
<a name="l00212"></a>00212             <a class="code" href="classIdeDisk.html#a24fb6794cfae6f84b380080e7501959e">updateState</a>(<a class="code" href="ide__disk_8hh.html#a3bae184d288bce92398b814aa118c15ca569047ea4f8599fd76feb7ad76b1e0dc">ACT_DATA_READ_SHORT</a>);
<a name="l00213"></a>00213             *((uint16_t *)data + 1) = <a class="code" href="classIdeDisk.html#a2d468138409fc099c81da8d9b62f1f0f">cmdReg</a>.<a class="code" href="structCommandReg.html#aa6e451eccf9519b0809baad41f5ab241">data</a>;
<a name="l00214"></a>00214         } <span class="keywordflow">else</span> {
<a name="l00215"></a>00215             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Data read of unsupported size %d.\n&quot;</span>, size);
<a name="l00216"></a>00216         }
<a name="l00217"></a>00217         <a class="code" href="classIdeDisk.html#a24fb6794cfae6f84b380080e7501959e">updateState</a>(<a class="code" href="ide__disk_8hh.html#a3bae184d288bce92398b814aa118c15ca569047ea4f8599fd76feb7ad76b1e0dc">ACT_DATA_READ_SHORT</a>);
<a name="l00218"></a>00218         <span class="keywordflow">return</span>;
<a name="l00219"></a>00219     }
<a name="l00220"></a>00220     assert(size == <span class="keyword">sizeof</span>(uint8_t));
<a name="l00221"></a>00221     <span class="keywordflow">switch</span> (<a class="code" href="namespaceArmISA.html#a87b7a740701cddafb930a9460e9f4eba">offset</a>) {
<a name="l00222"></a>00222       <span class="keywordflow">case</span> <a class="code" href="ide__disk_8hh.html#a34da2490156c0fde3a3a9e8b658e6639">ERROR_OFFSET</a>:
<a name="l00223"></a>00223         *data = <a class="code" href="classIdeDisk.html#a2d468138409fc099c81da8d9b62f1f0f">cmdReg</a>.<a class="code" href="structCommandReg.html#adc64ccb7538429fe78e3fe0139267370">error</a>;
<a name="l00224"></a>00224         <span class="keywordflow">break</span>;
<a name="l00225"></a>00225       <span class="keywordflow">case</span> <a class="code" href="ide__disk_8hh.html#a3c028923d4dbc280c75f2d05a07af561">NSECTOR_OFFSET</a>:
<a name="l00226"></a>00226         *data = <a class="code" href="classIdeDisk.html#a2d468138409fc099c81da8d9b62f1f0f">cmdReg</a>.<a class="code" href="structCommandReg.html#a2b7ca3bc768d3d472ebf8dcc6d7b5588">sec_count</a>;
<a name="l00227"></a>00227         <span class="keywordflow">break</span>;
<a name="l00228"></a>00228       <span class="keywordflow">case</span> <a class="code" href="ide__disk_8hh.html#afe1c25cd3dcc7137056f351bb4bae70a">SECTOR_OFFSET</a>:
<a name="l00229"></a>00229         *data = <a class="code" href="classIdeDisk.html#a2d468138409fc099c81da8d9b62f1f0f">cmdReg</a>.<a class="code" href="structCommandReg.html#a3940c6ebbd3db04528668419e3569c78">sec_num</a>;
<a name="l00230"></a>00230         <span class="keywordflow">break</span>;
<a name="l00231"></a>00231       <span class="keywordflow">case</span> <a class="code" href="ide__disk_8hh.html#a3c15c23524c451211d9eb469b602bb80">LCYL_OFFSET</a>:
<a name="l00232"></a>00232         *data = <a class="code" href="classIdeDisk.html#a2d468138409fc099c81da8d9b62f1f0f">cmdReg</a>.<a class="code" href="structCommandReg.html#ab766960269178a004098748902b2b456">cyl_low</a>;
<a name="l00233"></a>00233         <span class="keywordflow">break</span>;
<a name="l00234"></a>00234       <span class="keywordflow">case</span> <a class="code" href="ide__disk_8hh.html#af4211242794af5adce364ae3025bbd58">HCYL_OFFSET</a>:
<a name="l00235"></a>00235         *data = <a class="code" href="classIdeDisk.html#a2d468138409fc099c81da8d9b62f1f0f">cmdReg</a>.<a class="code" href="structCommandReg.html#a0b9715d01f574b6b31ac724f2039f8db">cyl_high</a>;
<a name="l00236"></a>00236         <span class="keywordflow">break</span>;
<a name="l00237"></a>00237       <span class="keywordflow">case</span> <a class="code" href="ide__disk_8hh.html#ab15fd72af5d7f9b9cb8c06f0d2e40b45">DRIVE_OFFSET</a>:
<a name="l00238"></a>00238         *data = <a class="code" href="classIdeDisk.html#a2d468138409fc099c81da8d9b62f1f0f">cmdReg</a>.<a class="code" href="structCommandReg.html#a3f7026e41497f11cac6febb94464474c">drive</a>;
<a name="l00239"></a>00239         <span class="keywordflow">break</span>;
<a name="l00240"></a>00240       <span class="keywordflow">case</span> <a class="code" href="ide__disk_8hh.html#ac3959778b8b4ee593c16fa33a06d844c">STATUS_OFFSET</a>:
<a name="l00241"></a>00241         *data = <a class="code" href="classIdeDisk.html#ade818037fd6c985038ff29656089758d">status</a>;
<a name="l00242"></a>00242         <a class="code" href="classIdeDisk.html#a24fb6794cfae6f84b380080e7501959e">updateState</a>(<a class="code" href="ide__disk_8hh.html#a3bae184d288bce92398b814aa118c15caf826d1740bb55069b77c41dcda84b26a">ACT_STAT_READ</a>);
<a name="l00243"></a>00243         <span class="keywordflow">break</span>;
<a name="l00244"></a>00244       <span class="keywordflow">default</span>:
<a name="l00245"></a>00245         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Invalid IDE command register offset: %#x\n&quot;</span>, <a class="code" href="namespaceArmISA.html#a87b7a740701cddafb930a9460e9f4eba">offset</a>);
<a name="l00246"></a>00246     }
<a name="l00247"></a>00247     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classIdeDisk.html">IdeDisk</a>, <span class="stringliteral">&quot;Read to disk at offset: %#x data %#x\n&quot;</span>, <a class="code" href="namespaceArmISA.html#a87b7a740701cddafb930a9460e9f4eba">offset</a>, *data);
<a name="l00248"></a>00248 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9eb9bf3059a1fb59a282c5b86ad10ce6"></a><!-- doxytag: member="IdeDisk::readControl" ref="a9eb9bf3059a1fb59a282c5b86ad10ce6" args="(const Addr offset, int size, uint8_t *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void readControl </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a>&nbsp;</td>
          <td class="paramname"> <em>offset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00252"></a>00252 {
<a name="l00253"></a>00253     assert(size == <span class="keyword">sizeof</span>(uint8_t));
<a name="l00254"></a>00254     *data = <a class="code" href="classIdeDisk.html#ade818037fd6c985038ff29656089758d">status</a>;
<a name="l00255"></a>00255     <span class="keywordflow">if</span> (<a class="code" href="namespaceArmISA.html#a87b7a740701cddafb930a9460e9f4eba">offset</a> != <a class="code" href="ide__disk_8hh.html#ae0878ccca45f58e9438fd4b05593042b">ALTSTAT_OFFSET</a>)
<a name="l00256"></a>00256         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Invalid IDE control register offset: %#x\n&quot;</span>, <a class="code" href="namespaceArmISA.html#a87b7a740701cddafb930a9460e9f4eba">offset</a>);
<a name="l00257"></a>00257     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classIdeDisk.html">IdeDisk</a>, <span class="stringliteral">&quot;Read to disk at offset: %#x data %#x\n&quot;</span>, <a class="code" href="namespaceArmISA.html#a87b7a740701cddafb930a9460e9f4eba">offset</a>, *data);
<a name="l00258"></a>00258 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8df41040225176356e649c3d35e11c62"></a><!-- doxytag: member="IdeDisk::readDisk" ref="a8df41040225176356e649c3d35e11c62" args="(uint32_t sector, uint8_t *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void readDisk </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&nbsp;</td>
          <td class="paramname"> <em>sector</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00567"></a>00567 {
<a name="l00568"></a>00568     <a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> bytesRead = <a class="code" href="classIdeDisk.html#a86d47120637a95e3a6876c774d768030">image</a>-&gt;<a class="code" href="classDiskImage.html#afcf02c1fffcb16ed79ac38bb87fb572c">read</a>(data, sector);
<a name="l00569"></a>00569 
<a name="l00570"></a>00570     <span class="keywordflow">if</span> (bytesRead != <a class="code" href="disk__image_8hh.html#ac729b32bca4535899ef2ee58b6a13d68">SectorSize</a>)
<a name="l00571"></a>00571         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Can&apos;t read from %s. Only %d of %d read. errno=%d\n&quot;</span>,
<a name="l00572"></a>00572               <a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>(), bytesRead, <a class="code" href="disk__image_8hh.html#ac729b32bca4535899ef2ee58b6a13d68">SectorSize</a>, errno);
<a name="l00573"></a>00573 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4dc637449366fcdfc4e764cdf12d9b11"></a><!-- doxytag: member="IdeDisk::regStats" ref="a4dc637449366fcdfc4e764cdf12d9b11" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void regStats </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p><a class="el" href="classRegister.html">Register</a> Statistics </p>

<p><a class="el" href="classSimObject.html#a4dc637449366fcdfc4e764cdf12d9b11">SimObject</a>を再定義しています。</p>

<p><div class="fragment"><pre class="fragment"><a name="l00391"></a>00391 {
<a name="l00392"></a>00392     <span class="keyword">using namespace </span>Stats;
<a name="l00393"></a>00393     <a class="code" href="classIdeDisk.html#abab6bdef4c30741f3ec4b69e44e9d7c6">dmaReadFullPages</a>
<a name="l00394"></a>00394         .<a class="code" href="classStats_1_1DataWrap.html#a8eaf5c2b92132dfcacd7d9b10afb1726">name</a>(<a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>() + <span class="stringliteral">&quot;.dma_read_full_pages&quot;</span>)
<a name="l00395"></a>00395         .desc(<span class="stringliteral">&quot;Number of full page size DMA reads (not PRD).&quot;</span>)
<a name="l00396"></a>00396         ;
<a name="l00397"></a>00397     <a class="code" href="classIdeDisk.html#a01f4e9b11f3b49ac1cb6cbb6d51674c2">dmaReadBytes</a>
<a name="l00398"></a>00398         .<a class="code" href="classStats_1_1DataWrap.html#a8eaf5c2b92132dfcacd7d9b10afb1726">name</a>(<a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>() + <span class="stringliteral">&quot;.dma_read_bytes&quot;</span>)
<a name="l00399"></a>00399         .desc(<span class="stringliteral">&quot;Number of bytes transfered via DMA reads (not PRD).&quot;</span>)
<a name="l00400"></a>00400         ;
<a name="l00401"></a>00401     <a class="code" href="classIdeDisk.html#a4310d460e8c2b5db635c0b2d1f1887a1">dmaReadTxs</a>
<a name="l00402"></a>00402         .<a class="code" href="classStats_1_1DataWrap.html#a8eaf5c2b92132dfcacd7d9b10afb1726">name</a>(<a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>() + <span class="stringliteral">&quot;.dma_read_txs&quot;</span>)
<a name="l00403"></a>00403         .desc(<span class="stringliteral">&quot;Number of DMA read transactions (not PRD).&quot;</span>)
<a name="l00404"></a>00404         ;
<a name="l00405"></a>00405 
<a name="l00406"></a>00406     <a class="code" href="classIdeDisk.html#adca0399abe696c769a268759b7823090">dmaWriteFullPages</a>
<a name="l00407"></a>00407         .<a class="code" href="classStats_1_1DataWrap.html#a8eaf5c2b92132dfcacd7d9b10afb1726">name</a>(<a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>() + <span class="stringliteral">&quot;.dma_write_full_pages&quot;</span>)
<a name="l00408"></a>00408         .desc(<span class="stringliteral">&quot;Number of full page size DMA writes.&quot;</span>)
<a name="l00409"></a>00409         ;
<a name="l00410"></a>00410     <a class="code" href="classIdeDisk.html#a59676f0552c89ab5f75ed2e6d8fca378">dmaWriteBytes</a>
<a name="l00411"></a>00411         .<a class="code" href="classStats_1_1DataWrap.html#a8eaf5c2b92132dfcacd7d9b10afb1726">name</a>(<a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>() + <span class="stringliteral">&quot;.dma_write_bytes&quot;</span>)
<a name="l00412"></a>00412         .desc(<span class="stringliteral">&quot;Number of bytes transfered via DMA writes.&quot;</span>)
<a name="l00413"></a>00413         ;
<a name="l00414"></a>00414     <a class="code" href="classIdeDisk.html#a2bb232dff5f135210d3350a21d1c9ccf">dmaWriteTxs</a>
<a name="l00415"></a>00415         .<a class="code" href="classStats_1_1DataWrap.html#a8eaf5c2b92132dfcacd7d9b10afb1726">name</a>(<a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>() + <span class="stringliteral">&quot;.dma_write_txs&quot;</span>)
<a name="l00416"></a>00416         .desc(<span class="stringliteral">&quot;Number of DMA write transactions.&quot;</span>)
<a name="l00417"></a>00417         ;
<a name="l00418"></a>00418 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a28f0332a5e13753c3f831ce1772b50c7"></a><!-- doxytag: member="IdeDisk::reset" ref="a28f0332a5e13753c3f831ce1772b50c7" args="(int id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void reset </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>id</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Reset the device state </p>

<p><div class="fragment"><pre class="fragment"><a name="l00143"></a>00143 {
<a name="l00144"></a>00144     <span class="comment">// initialize the data buffer and shadow registers</span>
<a name="l00145"></a>00145     <a class="code" href="classIdeDisk.html#a54aefba7f330b07a06f4c9447e582f09">dataBuffer</a> = <span class="keyword">new</span> uint8_t[<a class="code" href="ide__disk_8hh.html#a941d6074126345e6acdf3d91ee305b11">MAX_DMA_SIZE</a>];
<a name="l00146"></a>00146 
<a name="l00147"></a>00147     memset(<a class="code" href="classIdeDisk.html#a54aefba7f330b07a06f4c9447e582f09">dataBuffer</a>, 0, <a class="code" href="ide__disk_8hh.html#a941d6074126345e6acdf3d91ee305b11">MAX_DMA_SIZE</a>);
<a name="l00148"></a>00148     memset(&amp;<a class="code" href="classIdeDisk.html#a2d468138409fc099c81da8d9b62f1f0f">cmdReg</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="structCommandReg.html">CommandReg_t</a>));
<a name="l00149"></a>00149     memset(&amp;<a class="code" href="classIdeDisk.html#a550dda68894801d065c57391335a8590">curPrd</a>.<a class="code" href="classPrdTableEntry.html#a367da4f281ab033aae067ee206649f04">entry</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="structPrdEntry.html">PrdEntry_t</a>));
<a name="l00150"></a>00150 
<a name="l00151"></a>00151     <a class="code" href="classIdeDisk.html#a13b6a0a9519069583d8648b3eafa0448">curPrdAddr</a> = 0;
<a name="l00152"></a>00152     <a class="code" href="classIdeDisk.html#af7d6af3e55b20feac31aac92469e56f3">curSector</a> = 0;
<a name="l00153"></a>00153     <a class="code" href="classIdeDisk.html#a732862da3f80cd2b8eaba9425c8415f5">cmdBytes</a> = 0;
<a name="l00154"></a>00154     <a class="code" href="classIdeDisk.html#a70940fc29adad666da15b3d4c11ac2ff">cmdBytesLeft</a> = 0;
<a name="l00155"></a>00155     <a class="code" href="classIdeDisk.html#a93e2e2892d126eac3ce8dbb514d44c31">drqBytesLeft</a> = 0;
<a name="l00156"></a>00156     <a class="code" href="classIdeDisk.html#a3f1cf4317e46c3c845d144c5e0334096">dmaRead</a> = <span class="keyword">false</span>;
<a name="l00157"></a>00157     <a class="code" href="classIdeDisk.html#aabb849037e6d1c429d270d7fd20e958f">intrPending</a> = <span class="keyword">false</span>;
<a name="l00158"></a>00158     <a class="code" href="classIdeDisk.html#aedff89f76b12103a29d22ef4de302236">dmaAborted</a> = <span class="keyword">false</span>;
<a name="l00159"></a>00159 
<a name="l00160"></a>00160     <span class="comment">// set the device state to idle</span>
<a name="l00161"></a>00161     <a class="code" href="classIdeDisk.html#acdefad9ebc91ac85f00ff92347b944d7">dmaState</a> = <a class="code" href="ide__disk_8hh.html#a8adb9656d6ea50580adaf9c8e7d9eebfa98b4f39d2f8dca680f8b1ac92943966c">Dma_Idle</a>;
<a name="l00162"></a>00162 
<a name="l00163"></a>00163     <span class="keywordflow">if</span> (<span class="keywordtype">id</span> == <a class="code" href="ide__disk_8hh.html#a23bd1221f53dd9ccc84c6afd59bde187">DEV0</a>) {
<a name="l00164"></a>00164         <a class="code" href="classIdeDisk.html#a5fb52a264b2cccb6ccad92493dff5deb">devState</a> = <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6a24221ccc1bb4a323bc12d64883208c11">Device_Idle_S</a>;
<a name="l00165"></a>00165         <a class="code" href="classIdeDisk.html#a5f20adde61bc73f1275a1a35481a011d">devID</a> = <a class="code" href="ide__disk_8hh.html#a23bd1221f53dd9ccc84c6afd59bde187">DEV0</a>;
<a name="l00166"></a>00166     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keywordtype">id</span> == <a class="code" href="ide__disk_8hh.html#a5bb415eb7788e538901aa11bbe583094">DEV1</a>) {
<a name="l00167"></a>00167         <a class="code" href="classIdeDisk.html#a5fb52a264b2cccb6ccad92493dff5deb">devState</a> = <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6ae8a630d79f6da7a97bcae438a9bfd1db">Device_Idle_NS</a>;
<a name="l00168"></a>00168         <a class="code" href="classIdeDisk.html#a5f20adde61bc73f1275a1a35481a011d">devID</a> = <a class="code" href="ide__disk_8hh.html#a5bb415eb7788e538901aa11bbe583094">DEV1</a>;
<a name="l00169"></a>00169     } <span class="keywordflow">else</span> {
<a name="l00170"></a>00170         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Invalid device ID: %#x\n&quot;</span>, <span class="keywordtype">id</span>);
<a name="l00171"></a>00171     }
<a name="l00172"></a>00172 
<a name="l00173"></a>00173     <span class="comment">// set the device ready bit</span>
<a name="l00174"></a>00174     <a class="code" href="classIdeDisk.html#ade818037fd6c985038ff29656089758d">status</a> = <a class="code" href="ide__disk_8hh.html#ab8255d1245e66901dbf984fcb88b39b2">STATUS_DRDY_BIT</a>;
<a name="l00175"></a>00175 
<a name="l00176"></a>00176     <span class="comment">/* The error register must be set to 0x1 on start-up to</span>
<a name="l00177"></a>00177 <span class="comment">       indicate that no diagnostic error was detected */</span>
<a name="l00178"></a>00178     <a class="code" href="classIdeDisk.html#a2d468138409fc099c81da8d9b62f1f0f">cmdReg</a>.<a class="code" href="structCommandReg.html#adc64ccb7538429fe78e3fe0139267370">error</a> = 0x1;
<a name="l00179"></a>00179 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a53e036786d17361be4c7320d39c99b84"></a><!-- doxytag: member="IdeDisk::serialize" ref="a53e036786d17361be4c7320d39c99b84" args="(std::ostream &amp;os)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void serialize </td>
          <td>(</td>
          <td class="paramtype">std::ostream &amp;&nbsp;</td>
          <td class="paramname"> <em>os</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Serialize this object to the given output stream. </p>
<dl><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>os</em>&nbsp;</td><td>The stream to serialize to. </td></tr>
  </table>
  </dd>
</dl>

<p><a class="el" href="classSerializable.html#ad6272f80ae37e8331e3969b3f072a801">Serializable</a>を再定義しています。</p>

</div>
</div>
<a class="anchor" id="a57e01c0e3593bc187fa343f761ec895a"></a><!-- doxytag: member="IdeDisk::setComplete" ref="a57e01c0e3593bc187fa343f761ec895a" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void setComplete </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00351"></a>00351     {
<a name="l00352"></a>00352         <span class="comment">// clear out the status byte</span>
<a name="l00353"></a>00353         <a class="code" href="classIdeDisk.html#ade818037fd6c985038ff29656089758d">status</a> = 0;
<a name="l00354"></a>00354         <span class="comment">// set the DRDY bit</span>
<a name="l00355"></a>00355         <a class="code" href="classIdeDisk.html#ade818037fd6c985038ff29656089758d">status</a> |= <a class="code" href="ide__disk_8hh.html#ab8255d1245e66901dbf984fcb88b39b2">STATUS_DRDY_BIT</a>;
<a name="l00356"></a>00356         <span class="comment">// set the SEEK bit</span>
<a name="l00357"></a>00357         <a class="code" href="classIdeDisk.html#ade818037fd6c985038ff29656089758d">status</a> |= <a class="code" href="ide__disk_8hh.html#a6d24123c25308f8d0b135602dca13b8d">STATUS_SEEK_BIT</a>;
<a name="l00358"></a>00358     }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2ffee462d2d9876fd5b3c6afc9a491bb"></a><!-- doxytag: member="IdeDisk::setController" ref="a2ffee462d2d9876fd5b3c6afc9a491bb" args="(IdeController *c)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void setController </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classIdeController.html">IdeController</a> *&nbsp;</td>
          <td class="paramname"> <em>c</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p><a class="el" href="classSet.html">Set</a> the controller for this device </p>
<dl><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>c</em>&nbsp;</td><td>The IDE controller </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l00285"></a>00285                                          {
<a name="l00286"></a>00286         <span class="keywordflow">if</span> (<a class="code" href="classIdeDisk.html#a15da11d9f856cf2edfc6ed93e24ad0ea">ctrl</a>) <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Cannot change the controller once set!\n&quot;</span>);
<a name="l00287"></a>00287         <a class="code" href="classIdeDisk.html#a15da11d9f856cf2edfc6ed93e24ad0ea">ctrl</a> = c;
<a name="l00288"></a>00288     }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a64f80702e39e45d2a65869911928c8ca"></a><!-- doxytag: member="IdeDisk::startCommand" ref="a64f80702e39e45d2a65869911928c8ca" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void startCommand </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><dl class="todo"><dt><b><a class="el" href="todo.html#_todo000059">TODO:</a></b></dt><dd>make this a scheduled event to simulate disk delay </dd></dl>
</p>

<p><div class="fragment"><pre class="fragment"><a name="l00621"></a>00621 {
<a name="l00622"></a>00622     <a class="code" href="ide__disk_8hh.html#ab9a7252f05d40d629a2b3e780862846c">DevAction_t</a> action = <a class="code" href="ide__disk_8hh.html#a3bae184d288bce92398b814aa118c15caf1ee39018887e21bccccb4d0ddf0ac50">ACT_NONE</a>;
<a name="l00623"></a>00623     <a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> size = 0;
<a name="l00624"></a>00624     <a class="code" href="classIdeDisk.html#a3f1cf4317e46c3c845d144c5e0334096">dmaRead</a> = <span class="keyword">false</span>;
<a name="l00625"></a>00625 
<a name="l00626"></a>00626     <span class="comment">// Decode commands</span>
<a name="l00627"></a>00627     <span class="keywordflow">switch</span> (<a class="code" href="classIdeDisk.html#a2d468138409fc099c81da8d9b62f1f0f">cmdReg</a>.<a class="code" href="structCommandReg.html#a1a5aaa930940857f68f245eeb89506b5">command</a>) {
<a name="l00628"></a>00628         <span class="comment">// Supported non-data commands</span>
<a name="l00629"></a>00629       <span class="keywordflow">case</span> <a class="code" href="ide__wdcreg_8h.html#a073cff2051ca586072e346e7d0579f2b">WDSF_READ_NATIVE_MAX</a>:
<a name="l00630"></a>00630         size = (<a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>)<a class="code" href="classIdeDisk.html#a86d47120637a95e3a6876c774d768030">image</a>-&gt;<a class="code" href="classDiskImage.html#a0e772d58951a6696fce770bd4c390e9f">size</a>() - 1;
<a name="l00631"></a>00631         <a class="code" href="classIdeDisk.html#a2d468138409fc099c81da8d9b62f1f0f">cmdReg</a>.<a class="code" href="structCommandReg.html#a3940c6ebbd3db04528668419e3569c78">sec_num</a> = (size &amp; 0xff);
<a name="l00632"></a>00632         <a class="code" href="classIdeDisk.html#a2d468138409fc099c81da8d9b62f1f0f">cmdReg</a>.<a class="code" href="structCommandReg.html#ab766960269178a004098748902b2b456">cyl_low</a> = ((size &amp; 0xff00) &gt;&gt; 8);
<a name="l00633"></a>00633         <a class="code" href="classIdeDisk.html#a2d468138409fc099c81da8d9b62f1f0f">cmdReg</a>.<a class="code" href="structCommandReg.html#a0b9715d01f574b6b31ac724f2039f8db">cyl_high</a> = ((size &amp; 0xff0000) &gt;&gt; 16);
<a name="l00634"></a>00634         <a class="code" href="classIdeDisk.html#a2d468138409fc099c81da8d9b62f1f0f">cmdReg</a>.<a class="code" href="structCommandReg.html#a9794c0e61506b826b49b458708ae2489">head</a> = ((size &amp; 0xf000000) &gt;&gt; 24);
<a name="l00635"></a>00635 
<a name="l00636"></a>00636         <a class="code" href="classIdeDisk.html#a5fb52a264b2cccb6ccad92493dff5deb">devState</a> = <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6ab0c139f4bbab430ab7b877aa8e211217">Command_Execution</a>;
<a name="l00637"></a>00637         action = <a class="code" href="ide__disk_8hh.html#a3bae184d288bce92398b814aa118c15ca264757d803e500a0e811725ecdd896f1">ACT_CMD_COMPLETE</a>;
<a name="l00638"></a>00638         <span class="keywordflow">break</span>;
<a name="l00639"></a>00639 
<a name="l00640"></a>00640       <span class="keywordflow">case</span> <a class="code" href="ide__wdcreg_8h.html#a26b5fe1b5cc08772bc205c57fdf9fa85">WDCC_RECAL</a>:
<a name="l00641"></a>00641       <span class="keywordflow">case</span> <a class="code" href="ide__wdcreg_8h.html#a54e76d5ae6bee80e20b716eea92cb9c0">WDCC_IDP</a>:
<a name="l00642"></a>00642       <span class="keywordflow">case</span> <a class="code" href="ide__wdcreg_8h.html#a3d91178e9327aea47f15e85d5a0b75a3">WDCC_STANDBY_IMMED</a>:
<a name="l00643"></a>00643       <span class="keywordflow">case</span> <a class="code" href="ide__wdcreg_8h.html#a85dc152b679c3fd8be5e087347ec14ea">WDCC_FLUSHCACHE</a>:
<a name="l00644"></a>00644       <span class="keywordflow">case</span> <a class="code" href="ide__wdcreg_8h.html#a0b413d360a633759135a265e31d5c90c">WDSF_VERIFY</a>:
<a name="l00645"></a>00645       <span class="keywordflow">case</span> <a class="code" href="ide__wdcreg_8h.html#a4ad9bd2847e495212a253ebd5aab1221">WDSF_SEEK</a>:
<a name="l00646"></a>00646       <span class="keywordflow">case</span> <a class="code" href="ide__wdcreg_8h.html#adc8288b7b273c10c0c44231fb8a35236">SET_FEATURES</a>:
<a name="l00647"></a>00647       <span class="keywordflow">case</span> <a class="code" href="ide__wdcreg_8h.html#acd790193b9261c0f92aa8ffe0ea934c1">WDCC_SETMULTI</a>:
<a name="l00648"></a>00648         <a class="code" href="classIdeDisk.html#a5fb52a264b2cccb6ccad92493dff5deb">devState</a> = <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6ab0c139f4bbab430ab7b877aa8e211217">Command_Execution</a>;
<a name="l00649"></a>00649         action = <a class="code" href="ide__disk_8hh.html#a3bae184d288bce92398b814aa118c15ca264757d803e500a0e811725ecdd896f1">ACT_CMD_COMPLETE</a>;
<a name="l00650"></a>00650         <span class="keywordflow">break</span>;
<a name="l00651"></a>00651 
<a name="l00652"></a>00652         <span class="comment">// Supported PIO data-in commands</span>
<a name="l00653"></a>00653       <span class="keywordflow">case</span> <a class="code" href="ide__wdcreg_8h.html#a6861fb2443b2f73f98542b367dd45ec7">WDCC_IDENTIFY</a>:
<a name="l00654"></a>00654         <a class="code" href="classIdeDisk.html#a732862da3f80cd2b8eaba9425c8415f5">cmdBytes</a> = <a class="code" href="classIdeDisk.html#a70940fc29adad666da15b3d4c11ac2ff">cmdBytesLeft</a> = <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="structataparams.html">ataparams</a>);
<a name="l00655"></a>00655         <a class="code" href="classIdeDisk.html#a5fb52a264b2cccb6ccad92493dff5deb">devState</a> = <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6a963c5e183f934c0552bab67315ef0901">Prepare_Data_In</a>;
<a name="l00656"></a>00656         action = <a class="code" href="ide__disk_8hh.html#a3bae184d288bce92398b814aa118c15ca040e963d0aeed73747b1a0cf0631aa6d">ACT_DATA_READY</a>;
<a name="l00657"></a>00657         <span class="keywordflow">break</span>;
<a name="l00658"></a>00658 
<a name="l00659"></a>00659       <span class="keywordflow">case</span> <a class="code" href="ide__wdcreg_8h.html#aefdce95322df2345b53b4b408f59542d">WDCC_READMULTI</a>:
<a name="l00660"></a>00660       <span class="keywordflow">case</span> <a class="code" href="ide__wdcreg_8h.html#a995f75aa9086c9fa656d501e4e74b913">WDCC_READ</a>:
<a name="l00661"></a>00661         <span class="keywordflow">if</span> (!(<a class="code" href="classIdeDisk.html#a2d468138409fc099c81da8d9b62f1f0f">cmdReg</a>.<a class="code" href="structCommandReg.html#a3f7026e41497f11cac6febb94464474c">drive</a> &amp; <a class="code" href="ide__disk_8hh.html#ad88dd68f3f134fbb039bc89e99db0e64">DRIVE_LBA_BIT</a>))
<a name="l00662"></a>00662             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Attempt to perform CHS access, only supports LBA\n&quot;</span>);
<a name="l00663"></a>00663 
<a name="l00664"></a>00664         <span class="keywordflow">if</span> (<a class="code" href="classIdeDisk.html#a2d468138409fc099c81da8d9b62f1f0f">cmdReg</a>.<a class="code" href="structCommandReg.html#a2b7ca3bc768d3d472ebf8dcc6d7b5588">sec_count</a> == 0)
<a name="l00665"></a>00665             <a class="code" href="classIdeDisk.html#a732862da3f80cd2b8eaba9425c8415f5">cmdBytes</a> = <a class="code" href="classIdeDisk.html#a70940fc29adad666da15b3d4c11ac2ff">cmdBytesLeft</a> = (256 * <a class="code" href="disk__image_8hh.html#ac729b32bca4535899ef2ee58b6a13d68">SectorSize</a>);
<a name="l00666"></a>00666         <span class="keywordflow">else</span>
<a name="l00667"></a>00667             <a class="code" href="classIdeDisk.html#a732862da3f80cd2b8eaba9425c8415f5">cmdBytes</a> = <a class="code" href="classIdeDisk.html#a70940fc29adad666da15b3d4c11ac2ff">cmdBytesLeft</a> = (<a class="code" href="classIdeDisk.html#a2d468138409fc099c81da8d9b62f1f0f">cmdReg</a>.<a class="code" href="structCommandReg.html#a2b7ca3bc768d3d472ebf8dcc6d7b5588">sec_count</a> * <a class="code" href="disk__image_8hh.html#ac729b32bca4535899ef2ee58b6a13d68">SectorSize</a>);
<a name="l00668"></a>00668 
<a name="l00669"></a>00669         <a class="code" href="classIdeDisk.html#af7d6af3e55b20feac31aac92469e56f3">curSector</a> = <a class="code" href="classIdeDisk.html#af02a88c6960b020d71b0d6b95e41bab1">getLBABase</a>();
<a name="l00670"></a>00670 
<a name="l00672"></a>00672         <a class="code" href="classIdeDisk.html#a5fb52a264b2cccb6ccad92493dff5deb">devState</a> = <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6a963c5e183f934c0552bab67315ef0901">Prepare_Data_In</a>;
<a name="l00673"></a>00673         action = <a class="code" href="ide__disk_8hh.html#a3bae184d288bce92398b814aa118c15ca040e963d0aeed73747b1a0cf0631aa6d">ACT_DATA_READY</a>;
<a name="l00674"></a>00674         <span class="keywordflow">break</span>;
<a name="l00675"></a>00675 
<a name="l00676"></a>00676         <span class="comment">// Supported PIO data-out commands</span>
<a name="l00677"></a>00677       <span class="keywordflow">case</span> <a class="code" href="ide__wdcreg_8h.html#a8211713a46df435f588690f789b85c09">WDCC_WRITEMULTI</a>:
<a name="l00678"></a>00678       <span class="keywordflow">case</span> <a class="code" href="ide__wdcreg_8h.html#a68d5e6a88abaa0bb9dbbdd23602d5093">WDCC_WRITE</a>:
<a name="l00679"></a>00679         <span class="keywordflow">if</span> (!(<a class="code" href="classIdeDisk.html#a2d468138409fc099c81da8d9b62f1f0f">cmdReg</a>.<a class="code" href="structCommandReg.html#a3f7026e41497f11cac6febb94464474c">drive</a> &amp; <a class="code" href="ide__disk_8hh.html#ad88dd68f3f134fbb039bc89e99db0e64">DRIVE_LBA_BIT</a>))
<a name="l00680"></a>00680             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Attempt to perform CHS access, only supports LBA\n&quot;</span>);
<a name="l00681"></a>00681 
<a name="l00682"></a>00682         <span class="keywordflow">if</span> (<a class="code" href="classIdeDisk.html#a2d468138409fc099c81da8d9b62f1f0f">cmdReg</a>.<a class="code" href="structCommandReg.html#a2b7ca3bc768d3d472ebf8dcc6d7b5588">sec_count</a> == 0)
<a name="l00683"></a>00683             <a class="code" href="classIdeDisk.html#a732862da3f80cd2b8eaba9425c8415f5">cmdBytes</a> = <a class="code" href="classIdeDisk.html#a70940fc29adad666da15b3d4c11ac2ff">cmdBytesLeft</a> = (256 * <a class="code" href="disk__image_8hh.html#ac729b32bca4535899ef2ee58b6a13d68">SectorSize</a>);
<a name="l00684"></a>00684         <span class="keywordflow">else</span>
<a name="l00685"></a>00685             <a class="code" href="classIdeDisk.html#a732862da3f80cd2b8eaba9425c8415f5">cmdBytes</a> = <a class="code" href="classIdeDisk.html#a70940fc29adad666da15b3d4c11ac2ff">cmdBytesLeft</a> = (<a class="code" href="classIdeDisk.html#a2d468138409fc099c81da8d9b62f1f0f">cmdReg</a>.<a class="code" href="structCommandReg.html#a2b7ca3bc768d3d472ebf8dcc6d7b5588">sec_count</a> * <a class="code" href="disk__image_8hh.html#ac729b32bca4535899ef2ee58b6a13d68">SectorSize</a>);
<a name="l00686"></a>00686         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classIdeDisk.html">IdeDisk</a>, <span class="stringliteral">&quot;Setting cmdBytesLeft to %d\n&quot;</span>, <a class="code" href="classIdeDisk.html#a70940fc29adad666da15b3d4c11ac2ff">cmdBytesLeft</a>);
<a name="l00687"></a>00687         <a class="code" href="classIdeDisk.html#af7d6af3e55b20feac31aac92469e56f3">curSector</a> = <a class="code" href="classIdeDisk.html#af02a88c6960b020d71b0d6b95e41bab1">getLBABase</a>();
<a name="l00688"></a>00688 
<a name="l00689"></a>00689         <a class="code" href="classIdeDisk.html#a5fb52a264b2cccb6ccad92493dff5deb">devState</a> = <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6ad03435c752fd718ef93cc2988775da64">Prepare_Data_Out</a>;
<a name="l00690"></a>00690         action = <a class="code" href="ide__disk_8hh.html#a3bae184d288bce92398b814aa118c15ca040e963d0aeed73747b1a0cf0631aa6d">ACT_DATA_READY</a>;
<a name="l00691"></a>00691         <span class="keywordflow">break</span>;
<a name="l00692"></a>00692 
<a name="l00693"></a>00693         <span class="comment">// Supported DMA commands</span>
<a name="l00694"></a>00694       <span class="keywordflow">case</span> <a class="code" href="ide__wdcreg_8h.html#a14148616f852bb79667168028c336b9b">WDCC_WRITEDMA</a>:
<a name="l00695"></a>00695         <a class="code" href="classIdeDisk.html#a3f1cf4317e46c3c845d144c5e0334096">dmaRead</a> = <span class="keyword">true</span>;  <span class="comment">// a write to the disk is a DMA read from memory</span>
<a name="l00696"></a>00696       <span class="keywordflow">case</span> <a class="code" href="ide__wdcreg_8h.html#a64e87b43178f69142266774d1a9c8720">WDCC_READDMA</a>:
<a name="l00697"></a>00697         <span class="keywordflow">if</span> (!(<a class="code" href="classIdeDisk.html#a2d468138409fc099c81da8d9b62f1f0f">cmdReg</a>.<a class="code" href="structCommandReg.html#a3f7026e41497f11cac6febb94464474c">drive</a> &amp; <a class="code" href="ide__disk_8hh.html#ad88dd68f3f134fbb039bc89e99db0e64">DRIVE_LBA_BIT</a>))
<a name="l00698"></a>00698             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Attempt to perform CHS access, only supports LBA\n&quot;</span>);
<a name="l00699"></a>00699 
<a name="l00700"></a>00700         <span class="keywordflow">if</span> (<a class="code" href="classIdeDisk.html#a2d468138409fc099c81da8d9b62f1f0f">cmdReg</a>.<a class="code" href="structCommandReg.html#a2b7ca3bc768d3d472ebf8dcc6d7b5588">sec_count</a> == 0)
<a name="l00701"></a>00701             <a class="code" href="classIdeDisk.html#a732862da3f80cd2b8eaba9425c8415f5">cmdBytes</a> = <a class="code" href="classIdeDisk.html#a70940fc29adad666da15b3d4c11ac2ff">cmdBytesLeft</a> = (256 * <a class="code" href="disk__image_8hh.html#ac729b32bca4535899ef2ee58b6a13d68">SectorSize</a>);
<a name="l00702"></a>00702         <span class="keywordflow">else</span>
<a name="l00703"></a>00703             <a class="code" href="classIdeDisk.html#a732862da3f80cd2b8eaba9425c8415f5">cmdBytes</a> = <a class="code" href="classIdeDisk.html#a70940fc29adad666da15b3d4c11ac2ff">cmdBytesLeft</a> = (<a class="code" href="classIdeDisk.html#a2d468138409fc099c81da8d9b62f1f0f">cmdReg</a>.<a class="code" href="structCommandReg.html#a2b7ca3bc768d3d472ebf8dcc6d7b5588">sec_count</a> * <a class="code" href="disk__image_8hh.html#ac729b32bca4535899ef2ee58b6a13d68">SectorSize</a>);
<a name="l00704"></a>00704         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classIdeDisk.html">IdeDisk</a>, <span class="stringliteral">&quot;Setting cmdBytesLeft to %d in readdma\n&quot;</span>, <a class="code" href="classIdeDisk.html#a70940fc29adad666da15b3d4c11ac2ff">cmdBytesLeft</a>);
<a name="l00705"></a>00705 
<a name="l00706"></a>00706         <a class="code" href="classIdeDisk.html#af7d6af3e55b20feac31aac92469e56f3">curSector</a> = <a class="code" href="classIdeDisk.html#af02a88c6960b020d71b0d6b95e41bab1">getLBABase</a>();
<a name="l00707"></a>00707 
<a name="l00708"></a>00708         <a class="code" href="classIdeDisk.html#a5fb52a264b2cccb6ccad92493dff5deb">devState</a> = <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6aed547cd1619ef3146a31732b777681ee">Prepare_Data_Dma</a>;
<a name="l00709"></a>00709         action = <a class="code" href="ide__disk_8hh.html#a3bae184d288bce92398b814aa118c15ca6c282bf261ebd28f1d87398129882dee">ACT_DMA_READY</a>;
<a name="l00710"></a>00710         <span class="keywordflow">break</span>;
<a name="l00711"></a>00711 
<a name="l00712"></a>00712       <span class="keywordflow">default</span>:
<a name="l00713"></a>00713         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Unsupported ATA command: %#x\n&quot;</span>, <a class="code" href="classIdeDisk.html#a2d468138409fc099c81da8d9b62f1f0f">cmdReg</a>.<a class="code" href="structCommandReg.html#a1a5aaa930940857f68f245eeb89506b5">command</a>);
<a name="l00714"></a>00714     }
<a name="l00715"></a>00715 
<a name="l00716"></a>00716     <span class="keywordflow">if</span> (action != <a class="code" href="ide__disk_8hh.html#a3bae184d288bce92398b814aa118c15caf1ee39018887e21bccccb4d0ddf0ac50">ACT_NONE</a>) {
<a name="l00717"></a>00717         <span class="comment">// set the BSY bit</span>
<a name="l00718"></a>00718         <a class="code" href="classIdeDisk.html#ade818037fd6c985038ff29656089758d">status</a> |= <a class="code" href="ide__disk_8hh.html#a3d03a0c27c2a175009ae7cb5f1a5b5e1">STATUS_BSY_BIT</a>;
<a name="l00719"></a>00719         <span class="comment">// clear the DRQ bit</span>
<a name="l00720"></a>00720         <a class="code" href="classIdeDisk.html#ade818037fd6c985038ff29656089758d">status</a> &amp;= ~<a class="code" href="ide__disk_8hh.html#a6dc9ea6abc0948e38e3716456d711267">STATUS_DRQ_BIT</a>;
<a name="l00721"></a>00721         <span class="comment">// clear the DF bit</span>
<a name="l00722"></a>00722         <a class="code" href="classIdeDisk.html#ade818037fd6c985038ff29656089758d">status</a> &amp;= ~<a class="code" href="ide__disk_8hh.html#a723478546687fa887ff111c2aa99983b">STATUS_DF_BIT</a>;
<a name="l00723"></a>00723 
<a name="l00724"></a>00724         <a class="code" href="classIdeDisk.html#a24fb6794cfae6f84b380080e7501959e">updateState</a>(action);
<a name="l00725"></a>00725     }
<a name="l00726"></a>00726 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5f7be8f129b212ec5a0f25ce5c65dbd7"></a><!-- doxytag: member="IdeDisk::startDma" ref="a5f7be8f129b212ec5a0f25ce5c65dbd7" args="(const uint32_t &amp;prdTableBase)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void startDma </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>prdTableBase</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00591"></a>00591 {
<a name="l00592"></a>00592     <span class="keywordflow">if</span> (<a class="code" href="classIdeDisk.html#acdefad9ebc91ac85f00ff92347b944d7">dmaState</a> != <a class="code" href="ide__disk_8hh.html#a8adb9656d6ea50580adaf9c8e7d9eebfae35abb19ade6161b3817f6dd498ca711">Dma_Start</a>)
<a name="l00593"></a>00593         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Inconsistent DMA state, should be in Dma_Start!\n&quot;</span>);
<a name="l00594"></a>00594 
<a name="l00595"></a>00595     <span class="keywordflow">if</span> (<a class="code" href="classIdeDisk.html#a5fb52a264b2cccb6ccad92493dff5deb">devState</a> != <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6a64d0d40fb6f851777564c89760787a96">Transfer_Data_Dma</a>)
<a name="l00596"></a>00596         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Inconsistent device state for DMA start!\n&quot;</span>);
<a name="l00597"></a>00597 
<a name="l00598"></a>00598     <span class="comment">// PRD base address is given by bits 31:2</span>
<a name="l00599"></a>00599     <a class="code" href="classIdeDisk.html#a13b6a0a9519069583d8648b3eafa0448">curPrdAddr</a> = <a class="code" href="classIdeDisk.html#a8f2f46748053f3f3686a295cb3552ecd">pciToDma</a>((<a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a>)(prdTableBase &amp; ~<a class="code" href="base_2types_8hh.html#adcc3cf526a71c0dfaae020d432c78b83">ULL</a>(0x3)));
<a name="l00600"></a>00600 
<a name="l00601"></a>00601     <a class="code" href="classIdeDisk.html#acdefad9ebc91ac85f00ff92347b944d7">dmaState</a> = <a class="code" href="ide__disk_8hh.html#a8adb9656d6ea50580adaf9c8e7d9eebfa1479e31de2b235a422d366215ade33d4">Dma_Transfer</a>;
<a name="l00602"></a>00602 
<a name="l00603"></a>00603     <span class="comment">// schedule dma transfer (doDmaTransfer)</span>
<a name="l00604"></a>00604     <a class="code" href="classEventManager.html#a4ddebbfe9a12b95be6fb993ce892dcd3">schedule</a>(<a class="code" href="classIdeDisk.html#aa90327d610dcc75173d1cd63671c6d31">dmaTransferEvent</a>, <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22" title="The universal simulation clock.">curTick</a>() + 1);
<a name="l00605"></a>00605 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af22e5d6d660b97db37003ac61ac4ee49"></a><!-- doxytag: member="IdeDisk::unserialize" ref="af22e5d6d660b97db37003ac61ac4ee49" args="(Checkpoint *cp, const std::string &amp;section)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void unserialize </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classCheckpoint.html">Checkpoint</a> *&nbsp;</td>
          <td class="paramname"> <em>cp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&nbsp;</td>
          <td class="paramname"> <em>section</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [private, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Reconstruct the state of this object from a checkpoint. </p>
<dl><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="namespacecp.html">cp</a></em>&nbsp;</td><td>The checkpoint to use. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>section</em>&nbsp;</td><td>The section name describing this object. </td></tr>
  </table>
  </dd>
</dl>

<p><a class="el" href="classSerializable.html#af100c4e9feabf3cd918619c88c718387">Serializable</a>を再定義しています。</p>

</div>
</div>
<a class="anchor" id="a24fb6794cfae6f84b380080e7501959e"></a><!-- doxytag: member="IdeDisk::updateState" ref="a24fb6794cfae6f84b380080e7501959e" args="(DevAction_t action)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void updateState </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ide__disk_8hh.html#ab9a7252f05d40d629a2b3e780862846c">DevAction_t</a>&nbsp;</td>
          <td class="paramname"> <em>action</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><dl class="todo"><dt><b><a class="el" href="todo.html#_todo000060">TODO:</a></b></dt><dd>change this to a scheduled event to simulate disk delay </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000061">TODO:</a></b></dt><dd>change this to a scheduled event to simulate disk delay </dd></dl>
</p>

<p><div class="fragment"><pre class="fragment"><a name="l00767"></a>00767 {
<a name="l00768"></a>00768     <span class="keywordflow">switch</span> (<a class="code" href="classIdeDisk.html#a5fb52a264b2cccb6ccad92493dff5deb">devState</a>) {
<a name="l00769"></a>00769       <span class="keywordflow">case</span> <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6ac88c15837f00c88c0dbda9f774a9f689">Device_Srst</a>:
<a name="l00770"></a>00770         <span class="keywordflow">if</span> (action == <a class="code" href="ide__disk_8hh.html#a3bae184d288bce92398b814aa118c15ca2c18dc37b9298471dec71104f1d46fff">ACT_SRST_SET</a>) {
<a name="l00771"></a>00771             <span class="comment">// set the BSY bit</span>
<a name="l00772"></a>00772             <a class="code" href="classIdeDisk.html#ade818037fd6c985038ff29656089758d">status</a> |= <a class="code" href="ide__disk_8hh.html#a3d03a0c27c2a175009ae7cb5f1a5b5e1">STATUS_BSY_BIT</a>;
<a name="l00773"></a>00773         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (action == <a class="code" href="ide__disk_8hh.html#a3bae184d288bce92398b814aa118c15ca8a6e319f6c3971a39132513d188576fd">ACT_SRST_CLEAR</a>) {
<a name="l00774"></a>00774             <span class="comment">// clear the BSY bit</span>
<a name="l00775"></a>00775             <a class="code" href="classIdeDisk.html#ade818037fd6c985038ff29656089758d">status</a> &amp;= ~<a class="code" href="ide__disk_8hh.html#a3d03a0c27c2a175009ae7cb5f1a5b5e1">STATUS_BSY_BIT</a>;
<a name="l00776"></a>00776 
<a name="l00777"></a>00777             <span class="comment">// reset the device state</span>
<a name="l00778"></a>00778             <a class="code" href="classIdeDisk.html#a28f0332a5e13753c3f831ce1772b50c7">reset</a>(<a class="code" href="classIdeDisk.html#a5f20adde61bc73f1275a1a35481a011d">devID</a>);
<a name="l00779"></a>00779         }
<a name="l00780"></a>00780         <span class="keywordflow">break</span>;
<a name="l00781"></a>00781 
<a name="l00782"></a>00782       <span class="keywordflow">case</span> <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6a24221ccc1bb4a323bc12d64883208c11">Device_Idle_S</a>:
<a name="l00783"></a>00783         <span class="keywordflow">if</span> (action == <a class="code" href="ide__disk_8hh.html#a3bae184d288bce92398b814aa118c15ca6610e6fb837bbd223db1436df81ef3d7">ACT_SELECT_WRITE</a> &amp;&amp; !<a class="code" href="classIdeDisk.html#a910d3c770ea864b505ae99ee7e674640">isDEVSelect</a>()) {
<a name="l00784"></a>00784             <a class="code" href="classIdeDisk.html#a5fb52a264b2cccb6ccad92493dff5deb">devState</a> = <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6ae8a630d79f6da7a97bcae438a9bfd1db">Device_Idle_NS</a>;
<a name="l00785"></a>00785         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (action == <a class="code" href="ide__disk_8hh.html#a3bae184d288bce92398b814aa118c15cae1dd7a3a517c2f858845012756768591">ACT_CMD_WRITE</a>) {
<a name="l00786"></a>00786             <a class="code" href="classIdeDisk.html#a64f80702e39e45d2a65869911928c8ca">startCommand</a>();
<a name="l00787"></a>00787         }
<a name="l00788"></a>00788 
<a name="l00789"></a>00789         <span class="keywordflow">break</span>;
<a name="l00790"></a>00790 
<a name="l00791"></a>00791       <span class="keywordflow">case</span> <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6ac4673e63774c8b75b7b7aad4588b1aad">Device_Idle_SI</a>:
<a name="l00792"></a>00792         <span class="keywordflow">if</span> (action == <a class="code" href="ide__disk_8hh.html#a3bae184d288bce92398b814aa118c15ca6610e6fb837bbd223db1436df81ef3d7">ACT_SELECT_WRITE</a> &amp;&amp; !<a class="code" href="classIdeDisk.html#a910d3c770ea864b505ae99ee7e674640">isDEVSelect</a>()) {
<a name="l00793"></a>00793             <a class="code" href="classIdeDisk.html#a5fb52a264b2cccb6ccad92493dff5deb">devState</a> = <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6ae8a630d79f6da7a97bcae438a9bfd1db">Device_Idle_NS</a>;
<a name="l00794"></a>00794             <a class="code" href="classIdeDisk.html#ac02b8a3b8685eca8bb4b237b29dfc762">intrClear</a>();
<a name="l00795"></a>00795         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (action == <a class="code" href="ide__disk_8hh.html#a3bae184d288bce92398b814aa118c15caf826d1740bb55069b77c41dcda84b26a">ACT_STAT_READ</a> || <a class="code" href="classIdeDisk.html#a3e0ad2d309fc4a7aaa7a8af8b09d2cc0">isIENSet</a>()) {
<a name="l00796"></a>00796             <a class="code" href="classIdeDisk.html#a5fb52a264b2cccb6ccad92493dff5deb">devState</a> = <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6a24221ccc1bb4a323bc12d64883208c11">Device_Idle_S</a>;
<a name="l00797"></a>00797             <a class="code" href="classIdeDisk.html#ac02b8a3b8685eca8bb4b237b29dfc762">intrClear</a>();
<a name="l00798"></a>00798         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (action == <a class="code" href="ide__disk_8hh.html#a3bae184d288bce92398b814aa118c15cae1dd7a3a517c2f858845012756768591">ACT_CMD_WRITE</a>) {
<a name="l00799"></a>00799             <a class="code" href="classIdeDisk.html#ac02b8a3b8685eca8bb4b237b29dfc762">intrClear</a>();
<a name="l00800"></a>00800             <a class="code" href="classIdeDisk.html#a64f80702e39e45d2a65869911928c8ca">startCommand</a>();
<a name="l00801"></a>00801         }
<a name="l00802"></a>00802 
<a name="l00803"></a>00803         <span class="keywordflow">break</span>;
<a name="l00804"></a>00804 
<a name="l00805"></a>00805       <span class="keywordflow">case</span> <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6ae8a630d79f6da7a97bcae438a9bfd1db">Device_Idle_NS</a>:
<a name="l00806"></a>00806         <span class="keywordflow">if</span> (action == <a class="code" href="ide__disk_8hh.html#a3bae184d288bce92398b814aa118c15ca6610e6fb837bbd223db1436df81ef3d7">ACT_SELECT_WRITE</a> &amp;&amp; <a class="code" href="classIdeDisk.html#a910d3c770ea864b505ae99ee7e674640">isDEVSelect</a>()) {
<a name="l00807"></a>00807             <span class="keywordflow">if</span> (!<a class="code" href="classIdeDisk.html#a3e0ad2d309fc4a7aaa7a8af8b09d2cc0">isIENSet</a>() &amp;&amp; <a class="code" href="classIdeDisk.html#aabb849037e6d1c429d270d7fd20e958f">intrPending</a>) {
<a name="l00808"></a>00808                 <a class="code" href="classIdeDisk.html#a5fb52a264b2cccb6ccad92493dff5deb">devState</a> = <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6ac4673e63774c8b75b7b7aad4588b1aad">Device_Idle_SI</a>;
<a name="l00809"></a>00809                 <a class="code" href="classIdeDisk.html#aba6fa755ca152cedafeb4150da6a2493">intrPost</a>();
<a name="l00810"></a>00810             }
<a name="l00811"></a>00811             <span class="keywordflow">if</span> (<a class="code" href="classIdeDisk.html#a3e0ad2d309fc4a7aaa7a8af8b09d2cc0">isIENSet</a>() || !<a class="code" href="classIdeDisk.html#aabb849037e6d1c429d270d7fd20e958f">intrPending</a>) {
<a name="l00812"></a>00812                 <a class="code" href="classIdeDisk.html#a5fb52a264b2cccb6ccad92493dff5deb">devState</a> = <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6a24221ccc1bb4a323bc12d64883208c11">Device_Idle_S</a>;
<a name="l00813"></a>00813             }
<a name="l00814"></a>00814         }
<a name="l00815"></a>00815         <span class="keywordflow">break</span>;
<a name="l00816"></a>00816 
<a name="l00817"></a>00817       <span class="keywordflow">case</span> <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6ab0c139f4bbab430ab7b877aa8e211217">Command_Execution</a>:
<a name="l00818"></a>00818         <span class="keywordflow">if</span> (action == <a class="code" href="ide__disk_8hh.html#a3bae184d288bce92398b814aa118c15ca264757d803e500a0e811725ecdd896f1">ACT_CMD_COMPLETE</a>) {
<a name="l00819"></a>00819             <span class="comment">// clear the BSY bit</span>
<a name="l00820"></a>00820             <a class="code" href="classIdeDisk.html#a57e01c0e3593bc187fa343f761ec895a">setComplete</a>();
<a name="l00821"></a>00821 
<a name="l00822"></a>00822             <span class="keywordflow">if</span> (!<a class="code" href="classIdeDisk.html#a3e0ad2d309fc4a7aaa7a8af8b09d2cc0">isIENSet</a>()) {
<a name="l00823"></a>00823                 <a class="code" href="classIdeDisk.html#a5fb52a264b2cccb6ccad92493dff5deb">devState</a> = <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6ac4673e63774c8b75b7b7aad4588b1aad">Device_Idle_SI</a>;
<a name="l00824"></a>00824                 <a class="code" href="classIdeDisk.html#aba6fa755ca152cedafeb4150da6a2493">intrPost</a>();
<a name="l00825"></a>00825             } <span class="keywordflow">else</span> {
<a name="l00826"></a>00826                 <a class="code" href="classIdeDisk.html#a5fb52a264b2cccb6ccad92493dff5deb">devState</a> = <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6a24221ccc1bb4a323bc12d64883208c11">Device_Idle_S</a>;
<a name="l00827"></a>00827             }
<a name="l00828"></a>00828         }
<a name="l00829"></a>00829         <span class="keywordflow">break</span>;
<a name="l00830"></a>00830 
<a name="l00831"></a>00831       <span class="keywordflow">case</span> <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6a963c5e183f934c0552bab67315ef0901">Prepare_Data_In</a>:
<a name="l00832"></a>00832         <span class="keywordflow">if</span> (action == <a class="code" href="ide__disk_8hh.html#a3bae184d288bce92398b814aa118c15ca564e5d0c9a0d03e4e0d901a18100c6fd">ACT_CMD_ERROR</a>) {
<a name="l00833"></a>00833             <span class="comment">// clear the BSY bit</span>
<a name="l00834"></a>00834             <a class="code" href="classIdeDisk.html#a57e01c0e3593bc187fa343f761ec895a">setComplete</a>();
<a name="l00835"></a>00835 
<a name="l00836"></a>00836             <span class="keywordflow">if</span> (!<a class="code" href="classIdeDisk.html#a3e0ad2d309fc4a7aaa7a8af8b09d2cc0">isIENSet</a>()) {
<a name="l00837"></a>00837                 <a class="code" href="classIdeDisk.html#a5fb52a264b2cccb6ccad92493dff5deb">devState</a> = <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6ac4673e63774c8b75b7b7aad4588b1aad">Device_Idle_SI</a>;
<a name="l00838"></a>00838                 <a class="code" href="classIdeDisk.html#aba6fa755ca152cedafeb4150da6a2493">intrPost</a>();
<a name="l00839"></a>00839             } <span class="keywordflow">else</span> {
<a name="l00840"></a>00840                 <a class="code" href="classIdeDisk.html#a5fb52a264b2cccb6ccad92493dff5deb">devState</a> = <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6a24221ccc1bb4a323bc12d64883208c11">Device_Idle_S</a>;
<a name="l00841"></a>00841             }
<a name="l00842"></a>00842         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (action == <a class="code" href="ide__disk_8hh.html#a3bae184d288bce92398b814aa118c15ca040e963d0aeed73747b1a0cf0631aa6d">ACT_DATA_READY</a>) {
<a name="l00843"></a>00843             <span class="comment">// clear the BSY bit</span>
<a name="l00844"></a>00844             <a class="code" href="classIdeDisk.html#ade818037fd6c985038ff29656089758d">status</a> &amp;= ~<a class="code" href="ide__disk_8hh.html#a3d03a0c27c2a175009ae7cb5f1a5b5e1">STATUS_BSY_BIT</a>;
<a name="l00845"></a>00845             <span class="comment">// set the DRQ bit</span>
<a name="l00846"></a>00846             <a class="code" href="classIdeDisk.html#ade818037fd6c985038ff29656089758d">status</a> |= <a class="code" href="ide__disk_8hh.html#a6dc9ea6abc0948e38e3716456d711267">STATUS_DRQ_BIT</a>;
<a name="l00847"></a>00847 
<a name="l00848"></a>00848             <span class="comment">// copy the data into the data buffer</span>
<a name="l00849"></a>00849             <span class="keywordflow">if</span> (<a class="code" href="classIdeDisk.html#a2d468138409fc099c81da8d9b62f1f0f">cmdReg</a>.<a class="code" href="structCommandReg.html#a1a5aaa930940857f68f245eeb89506b5">command</a> == <a class="code" href="ide__wdcreg_8h.html#a6861fb2443b2f73f98542b367dd45ec7">WDCC_IDENTIFY</a>) {
<a name="l00850"></a>00850                 <span class="comment">// Reset the drqBytes for this block</span>
<a name="l00851"></a>00851                 <a class="code" href="classIdeDisk.html#a93e2e2892d126eac3ce8dbb514d44c31">drqBytesLeft</a> = <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="structataparams.html">ataparams</a>);
<a name="l00852"></a>00852 
<a name="l00853"></a>00853                 memcpy((<span class="keywordtype">void</span> *)<a class="code" href="classIdeDisk.html#a54aefba7f330b07a06f4c9447e582f09">dataBuffer</a>, (<span class="keywordtype">void</span> *)&amp;<a class="code" href="classIdeDisk.html#ae8a5371b95892db84d2b7ecef320d8a9">driveID</a>,
<a name="l00854"></a>00854                        <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structataparams.html">ataparams</a>));
<a name="l00855"></a>00855             } <span class="keywordflow">else</span> {
<a name="l00856"></a>00856                 <span class="comment">// Reset the drqBytes for this block</span>
<a name="l00857"></a>00857                 <a class="code" href="classIdeDisk.html#a93e2e2892d126eac3ce8dbb514d44c31">drqBytesLeft</a> = <a class="code" href="disk__image_8hh.html#ac729b32bca4535899ef2ee58b6a13d68">SectorSize</a>;
<a name="l00858"></a>00858 
<a name="l00859"></a>00859                 <a class="code" href="classIdeDisk.html#a8df41040225176356e649c3d35e11c62">readDisk</a>(<a class="code" href="classIdeDisk.html#af7d6af3e55b20feac31aac92469e56f3">curSector</a>++, dataBuffer);
<a name="l00860"></a>00860             }
<a name="l00861"></a>00861 
<a name="l00862"></a>00862             <span class="comment">// put the first two bytes into the data register</span>
<a name="l00863"></a>00863             memcpy((<span class="keywordtype">void</span> *)&amp;<a class="code" href="classIdeDisk.html#a2d468138409fc099c81da8d9b62f1f0f">cmdReg</a>.<a class="code" href="structCommandReg.html#aa6e451eccf9519b0809baad41f5ab241">data</a>, (<span class="keywordtype">void</span> *)dataBuffer,
<a name="l00864"></a>00864                    <span class="keyword">sizeof</span>(uint16_t));
<a name="l00865"></a>00865 
<a name="l00866"></a>00866             <span class="keywordflow">if</span> (!<a class="code" href="classIdeDisk.html#a3e0ad2d309fc4a7aaa7a8af8b09d2cc0">isIENSet</a>()) {
<a name="l00867"></a>00867                 <a class="code" href="classIdeDisk.html#a5fb52a264b2cccb6ccad92493dff5deb">devState</a> = <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6a9aa9d424633dc557b88576993e7a413c">Data_Ready_INTRQ_In</a>;
<a name="l00868"></a>00868                 <a class="code" href="classIdeDisk.html#aba6fa755ca152cedafeb4150da6a2493">intrPost</a>();
<a name="l00869"></a>00869             } <span class="keywordflow">else</span> {
<a name="l00870"></a>00870                 <a class="code" href="classIdeDisk.html#a5fb52a264b2cccb6ccad92493dff5deb">devState</a> = <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6afcd577c08925582e323f8916f1ec0d9d">Transfer_Data_In</a>;
<a name="l00871"></a>00871             }
<a name="l00872"></a>00872         }
<a name="l00873"></a>00873         <span class="keywordflow">break</span>;
<a name="l00874"></a>00874 
<a name="l00875"></a>00875       <span class="keywordflow">case</span> <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6a9aa9d424633dc557b88576993e7a413c">Data_Ready_INTRQ_In</a>:
<a name="l00876"></a>00876         <span class="keywordflow">if</span> (action == <a class="code" href="ide__disk_8hh.html#a3bae184d288bce92398b814aa118c15caf826d1740bb55069b77c41dcda84b26a">ACT_STAT_READ</a>) {
<a name="l00877"></a>00877             <a class="code" href="classIdeDisk.html#a5fb52a264b2cccb6ccad92493dff5deb">devState</a> = <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6afcd577c08925582e323f8916f1ec0d9d">Transfer_Data_In</a>;
<a name="l00878"></a>00878             <a class="code" href="classIdeDisk.html#ac02b8a3b8685eca8bb4b237b29dfc762">intrClear</a>();
<a name="l00879"></a>00879         }
<a name="l00880"></a>00880         <span class="keywordflow">break</span>;
<a name="l00881"></a>00881 
<a name="l00882"></a>00882       <span class="keywordflow">case</span> <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6afcd577c08925582e323f8916f1ec0d9d">Transfer_Data_In</a>:
<a name="l00883"></a>00883         <span class="keywordflow">if</span> (action == <a class="code" href="ide__disk_8hh.html#a3bae184d288bce92398b814aa118c15caba3b6986bd4622c3227ff958da2f6778">ACT_DATA_READ_BYTE</a> || action == <a class="code" href="ide__disk_8hh.html#a3bae184d288bce92398b814aa118c15ca569047ea4f8599fd76feb7ad76b1e0dc">ACT_DATA_READ_SHORT</a>) {
<a name="l00884"></a>00884             <span class="keywordflow">if</span> (action == <a class="code" href="ide__disk_8hh.html#a3bae184d288bce92398b814aa118c15caba3b6986bd4622c3227ff958da2f6778">ACT_DATA_READ_BYTE</a>) {
<a name="l00885"></a>00885                 <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;DEBUG: READING DATA ONE BYTE AT A TIME!\n&quot;</span>);
<a name="l00886"></a>00886             } <span class="keywordflow">else</span> {
<a name="l00887"></a>00887                 <a class="code" href="classIdeDisk.html#a93e2e2892d126eac3ce8dbb514d44c31">drqBytesLeft</a> -= 2;
<a name="l00888"></a>00888                 <a class="code" href="classIdeDisk.html#a70940fc29adad666da15b3d4c11ac2ff">cmdBytesLeft</a> -= 2;
<a name="l00889"></a>00889 
<a name="l00890"></a>00890                 <span class="comment">// copy next short into data registers</span>
<a name="l00891"></a>00891                 <span class="keywordflow">if</span> (<a class="code" href="classIdeDisk.html#a93e2e2892d126eac3ce8dbb514d44c31">drqBytesLeft</a>)
<a name="l00892"></a>00892                     memcpy((<span class="keywordtype">void</span> *)&amp;<a class="code" href="classIdeDisk.html#a2d468138409fc099c81da8d9b62f1f0f">cmdReg</a>.<a class="code" href="structCommandReg.html#aa6e451eccf9519b0809baad41f5ab241">data</a>,
<a name="l00893"></a>00893                            (<span class="keywordtype">void</span> *)&amp;dataBuffer[<a class="code" href="disk__image_8hh.html#ac729b32bca4535899ef2ee58b6a13d68">SectorSize</a> - <a class="code" href="classIdeDisk.html#a93e2e2892d126eac3ce8dbb514d44c31">drqBytesLeft</a>],
<a name="l00894"></a>00894                            <span class="keyword">sizeof</span>(uint16_t));
<a name="l00895"></a>00895             }
<a name="l00896"></a>00896 
<a name="l00897"></a>00897             <span class="keywordflow">if</span> (<a class="code" href="classIdeDisk.html#a93e2e2892d126eac3ce8dbb514d44c31">drqBytesLeft</a> == 0) {
<a name="l00898"></a>00898                 <span class="keywordflow">if</span> (<a class="code" href="classIdeDisk.html#a70940fc29adad666da15b3d4c11ac2ff">cmdBytesLeft</a> == 0) {
<a name="l00899"></a>00899                     <span class="comment">// Clear the BSY bit</span>
<a name="l00900"></a>00900                     <a class="code" href="classIdeDisk.html#a57e01c0e3593bc187fa343f761ec895a">setComplete</a>();
<a name="l00901"></a>00901                     <a class="code" href="classIdeDisk.html#a5fb52a264b2cccb6ccad92493dff5deb">devState</a> = <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6a24221ccc1bb4a323bc12d64883208c11">Device_Idle_S</a>;
<a name="l00902"></a>00902                 } <span class="keywordflow">else</span> {
<a name="l00903"></a>00903                     <a class="code" href="classIdeDisk.html#a5fb52a264b2cccb6ccad92493dff5deb">devState</a> = <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6a963c5e183f934c0552bab67315ef0901">Prepare_Data_In</a>;
<a name="l00904"></a>00904                     <span class="comment">// set the BSY_BIT</span>
<a name="l00905"></a>00905                     <a class="code" href="classIdeDisk.html#ade818037fd6c985038ff29656089758d">status</a> |= <a class="code" href="ide__disk_8hh.html#a3d03a0c27c2a175009ae7cb5f1a5b5e1">STATUS_BSY_BIT</a>;
<a name="l00906"></a>00906                     <span class="comment">// clear the DRQ_BIT</span>
<a name="l00907"></a>00907                     <a class="code" href="classIdeDisk.html#ade818037fd6c985038ff29656089758d">status</a> &amp;= ~<a class="code" href="ide__disk_8hh.html#a6dc9ea6abc0948e38e3716456d711267">STATUS_DRQ_BIT</a>;
<a name="l00908"></a>00908 
<a name="l00911"></a>00911                     <a class="code" href="classIdeDisk.html#a24fb6794cfae6f84b380080e7501959e">updateState</a>(<a class="code" href="ide__disk_8hh.html#a3bae184d288bce92398b814aa118c15ca040e963d0aeed73747b1a0cf0631aa6d">ACT_DATA_READY</a>);
<a name="l00912"></a>00912                 }
<a name="l00913"></a>00913             }
<a name="l00914"></a>00914         }
<a name="l00915"></a>00915         <span class="keywordflow">break</span>;
<a name="l00916"></a>00916 
<a name="l00917"></a>00917       <span class="keywordflow">case</span> <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6ad03435c752fd718ef93cc2988775da64">Prepare_Data_Out</a>:
<a name="l00918"></a>00918         <span class="keywordflow">if</span> (action == <a class="code" href="ide__disk_8hh.html#a3bae184d288bce92398b814aa118c15ca564e5d0c9a0d03e4e0d901a18100c6fd">ACT_CMD_ERROR</a> || <a class="code" href="classIdeDisk.html#a70940fc29adad666da15b3d4c11ac2ff">cmdBytesLeft</a> == 0) {
<a name="l00919"></a>00919             <span class="comment">// clear the BSY bit</span>
<a name="l00920"></a>00920             <a class="code" href="classIdeDisk.html#a57e01c0e3593bc187fa343f761ec895a">setComplete</a>();
<a name="l00921"></a>00921 
<a name="l00922"></a>00922             <span class="keywordflow">if</span> (!<a class="code" href="classIdeDisk.html#a3e0ad2d309fc4a7aaa7a8af8b09d2cc0">isIENSet</a>()) {
<a name="l00923"></a>00923                 <a class="code" href="classIdeDisk.html#a5fb52a264b2cccb6ccad92493dff5deb">devState</a> = <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6ac4673e63774c8b75b7b7aad4588b1aad">Device_Idle_SI</a>;
<a name="l00924"></a>00924                 <a class="code" href="classIdeDisk.html#aba6fa755ca152cedafeb4150da6a2493">intrPost</a>();
<a name="l00925"></a>00925             } <span class="keywordflow">else</span> {
<a name="l00926"></a>00926                 <a class="code" href="classIdeDisk.html#a5fb52a264b2cccb6ccad92493dff5deb">devState</a> = <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6a24221ccc1bb4a323bc12d64883208c11">Device_Idle_S</a>;
<a name="l00927"></a>00927             }
<a name="l00928"></a>00928         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (action == <a class="code" href="ide__disk_8hh.html#a3bae184d288bce92398b814aa118c15ca040e963d0aeed73747b1a0cf0631aa6d">ACT_DATA_READY</a> &amp;&amp; <a class="code" href="classIdeDisk.html#a70940fc29adad666da15b3d4c11ac2ff">cmdBytesLeft</a> != 0) {
<a name="l00929"></a>00929             <span class="comment">// clear the BSY bit</span>
<a name="l00930"></a>00930             <a class="code" href="classIdeDisk.html#ade818037fd6c985038ff29656089758d">status</a> &amp;= ~<a class="code" href="ide__disk_8hh.html#a3d03a0c27c2a175009ae7cb5f1a5b5e1">STATUS_BSY_BIT</a>;
<a name="l00931"></a>00931             <span class="comment">// set the DRQ bit</span>
<a name="l00932"></a>00932             <a class="code" href="classIdeDisk.html#ade818037fd6c985038ff29656089758d">status</a> |= <a class="code" href="ide__disk_8hh.html#a6dc9ea6abc0948e38e3716456d711267">STATUS_DRQ_BIT</a>;
<a name="l00933"></a>00933 
<a name="l00934"></a>00934             <span class="comment">// clear the data buffer to get it ready for writes</span>
<a name="l00935"></a>00935             memset(dataBuffer, 0, <a class="code" href="ide__disk_8hh.html#a941d6074126345e6acdf3d91ee305b11">MAX_DMA_SIZE</a>);
<a name="l00936"></a>00936 
<a name="l00937"></a>00937             <span class="comment">// reset the drqBytes for this block</span>
<a name="l00938"></a>00938             <a class="code" href="classIdeDisk.html#a93e2e2892d126eac3ce8dbb514d44c31">drqBytesLeft</a> = <a class="code" href="disk__image_8hh.html#ac729b32bca4535899ef2ee58b6a13d68">SectorSize</a>;
<a name="l00939"></a>00939 
<a name="l00940"></a>00940             <span class="keywordflow">if</span> (<a class="code" href="classIdeDisk.html#a70940fc29adad666da15b3d4c11ac2ff">cmdBytesLeft</a> == <a class="code" href="classIdeDisk.html#a732862da3f80cd2b8eaba9425c8415f5">cmdBytes</a> || <a class="code" href="classIdeDisk.html#a3e0ad2d309fc4a7aaa7a8af8b09d2cc0">isIENSet</a>()) {
<a name="l00941"></a>00941                 <a class="code" href="classIdeDisk.html#a5fb52a264b2cccb6ccad92493dff5deb">devState</a> = <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6a16561636b0602f9e542694a66d69e36a">Transfer_Data_Out</a>;
<a name="l00942"></a>00942             } <span class="keywordflow">else</span> {
<a name="l00943"></a>00943                 <a class="code" href="classIdeDisk.html#a5fb52a264b2cccb6ccad92493dff5deb">devState</a> = <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6a132a29467ed2679d80bc8119545df28f">Data_Ready_INTRQ_Out</a>;
<a name="l00944"></a>00944                 <a class="code" href="classIdeDisk.html#aba6fa755ca152cedafeb4150da6a2493">intrPost</a>();
<a name="l00945"></a>00945             }
<a name="l00946"></a>00946         }
<a name="l00947"></a>00947         <span class="keywordflow">break</span>;
<a name="l00948"></a>00948 
<a name="l00949"></a>00949       <span class="keywordflow">case</span> <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6a132a29467ed2679d80bc8119545df28f">Data_Ready_INTRQ_Out</a>:
<a name="l00950"></a>00950         <span class="keywordflow">if</span> (action == <a class="code" href="ide__disk_8hh.html#a3bae184d288bce92398b814aa118c15caf826d1740bb55069b77c41dcda84b26a">ACT_STAT_READ</a>) {
<a name="l00951"></a>00951             <a class="code" href="classIdeDisk.html#a5fb52a264b2cccb6ccad92493dff5deb">devState</a> = <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6a16561636b0602f9e542694a66d69e36a">Transfer_Data_Out</a>;
<a name="l00952"></a>00952             <a class="code" href="classIdeDisk.html#ac02b8a3b8685eca8bb4b237b29dfc762">intrClear</a>();
<a name="l00953"></a>00953         }
<a name="l00954"></a>00954         <span class="keywordflow">break</span>;
<a name="l00955"></a>00955 
<a name="l00956"></a>00956       <span class="keywordflow">case</span> <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6a16561636b0602f9e542694a66d69e36a">Transfer_Data_Out</a>:
<a name="l00957"></a>00957         <span class="keywordflow">if</span> (action == <a class="code" href="ide__disk_8hh.html#a3bae184d288bce92398b814aa118c15ca0481ac27625f7b14bcee1eacb2c9153c">ACT_DATA_WRITE_BYTE</a> ||
<a name="l00958"></a>00958             action == <a class="code" href="ide__disk_8hh.html#a3bae184d288bce92398b814aa118c15ca3af5a74985a6671feb0d9bb3bff9a543">ACT_DATA_WRITE_SHORT</a>) {
<a name="l00959"></a>00959 
<a name="l00960"></a>00960             <span class="keywordflow">if</span> (action == <a class="code" href="ide__disk_8hh.html#a3bae184d288bce92398b814aa118c15caba3b6986bd4622c3227ff958da2f6778">ACT_DATA_READ_BYTE</a>) {
<a name="l00961"></a>00961                 <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;DEBUG: WRITING DATA ONE BYTE AT A TIME!\n&quot;</span>);
<a name="l00962"></a>00962             } <span class="keywordflow">else</span> {
<a name="l00963"></a>00963                 <span class="comment">// copy the latest short into the data buffer</span>
<a name="l00964"></a>00964                 memcpy((<span class="keywordtype">void</span> *)&amp;dataBuffer[<a class="code" href="disk__image_8hh.html#ac729b32bca4535899ef2ee58b6a13d68">SectorSize</a> - <a class="code" href="classIdeDisk.html#a93e2e2892d126eac3ce8dbb514d44c31">drqBytesLeft</a>],
<a name="l00965"></a>00965                        (<span class="keywordtype">void</span> *)&amp;<a class="code" href="classIdeDisk.html#a2d468138409fc099c81da8d9b62f1f0f">cmdReg</a>.<a class="code" href="structCommandReg.html#aa6e451eccf9519b0809baad41f5ab241">data</a>,
<a name="l00966"></a>00966                        <span class="keyword">sizeof</span>(uint16_t));
<a name="l00967"></a>00967 
<a name="l00968"></a>00968                 <a class="code" href="classIdeDisk.html#a93e2e2892d126eac3ce8dbb514d44c31">drqBytesLeft</a> -= 2;
<a name="l00969"></a>00969                 <a class="code" href="classIdeDisk.html#a70940fc29adad666da15b3d4c11ac2ff">cmdBytesLeft</a> -= 2;
<a name="l00970"></a>00970             }
<a name="l00971"></a>00971 
<a name="l00972"></a>00972             <span class="keywordflow">if</span> (<a class="code" href="classIdeDisk.html#a93e2e2892d126eac3ce8dbb514d44c31">drqBytesLeft</a> == 0) {
<a name="l00973"></a>00973                 <span class="comment">// copy the block to the disk</span>
<a name="l00974"></a>00974                 <a class="code" href="classIdeDisk.html#aaf5688ef23ac188d55decc9021229d43">writeDisk</a>(<a class="code" href="classIdeDisk.html#af7d6af3e55b20feac31aac92469e56f3">curSector</a>++, dataBuffer);
<a name="l00975"></a>00975 
<a name="l00976"></a>00976                 <span class="comment">// set the BSY bit</span>
<a name="l00977"></a>00977                 <a class="code" href="classIdeDisk.html#ade818037fd6c985038ff29656089758d">status</a> |= <a class="code" href="ide__disk_8hh.html#a3d03a0c27c2a175009ae7cb5f1a5b5e1">STATUS_BSY_BIT</a>;
<a name="l00978"></a>00978                 <span class="comment">// set the seek bit</span>
<a name="l00979"></a>00979                 <a class="code" href="classIdeDisk.html#ade818037fd6c985038ff29656089758d">status</a> |= <a class="code" href="ide__disk_8hh.html#a6d24123c25308f8d0b135602dca13b8d">STATUS_SEEK_BIT</a>;
<a name="l00980"></a>00980                 <span class="comment">// clear the DRQ bit</span>
<a name="l00981"></a>00981                 <a class="code" href="classIdeDisk.html#ade818037fd6c985038ff29656089758d">status</a> &amp;= ~<a class="code" href="ide__disk_8hh.html#a6dc9ea6abc0948e38e3716456d711267">STATUS_DRQ_BIT</a>;
<a name="l00982"></a>00982 
<a name="l00983"></a>00983                 <a class="code" href="classIdeDisk.html#a5fb52a264b2cccb6ccad92493dff5deb">devState</a> = <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6ad03435c752fd718ef93cc2988775da64">Prepare_Data_Out</a>;
<a name="l00984"></a>00984 
<a name="l00987"></a>00987                 <a class="code" href="classIdeDisk.html#a24fb6794cfae6f84b380080e7501959e">updateState</a>(<a class="code" href="ide__disk_8hh.html#a3bae184d288bce92398b814aa118c15ca040e963d0aeed73747b1a0cf0631aa6d">ACT_DATA_READY</a>);
<a name="l00988"></a>00988             }
<a name="l00989"></a>00989         }
<a name="l00990"></a>00990         <span class="keywordflow">break</span>;
<a name="l00991"></a>00991 
<a name="l00992"></a>00992       <span class="keywordflow">case</span> <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6aed547cd1619ef3146a31732b777681ee">Prepare_Data_Dma</a>:
<a name="l00993"></a>00993         <span class="keywordflow">if</span> (action == <a class="code" href="ide__disk_8hh.html#a3bae184d288bce92398b814aa118c15ca564e5d0c9a0d03e4e0d901a18100c6fd">ACT_CMD_ERROR</a>) {
<a name="l00994"></a>00994             <span class="comment">// clear the BSY bit</span>
<a name="l00995"></a>00995             <a class="code" href="classIdeDisk.html#a57e01c0e3593bc187fa343f761ec895a">setComplete</a>();
<a name="l00996"></a>00996 
<a name="l00997"></a>00997             <span class="keywordflow">if</span> (!<a class="code" href="classIdeDisk.html#a3e0ad2d309fc4a7aaa7a8af8b09d2cc0">isIENSet</a>()) {
<a name="l00998"></a>00998                 <a class="code" href="classIdeDisk.html#a5fb52a264b2cccb6ccad92493dff5deb">devState</a> = <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6ac4673e63774c8b75b7b7aad4588b1aad">Device_Idle_SI</a>;
<a name="l00999"></a>00999                 <a class="code" href="classIdeDisk.html#aba6fa755ca152cedafeb4150da6a2493">intrPost</a>();
<a name="l01000"></a>01000             } <span class="keywordflow">else</span> {
<a name="l01001"></a>01001                 <a class="code" href="classIdeDisk.html#a5fb52a264b2cccb6ccad92493dff5deb">devState</a> = <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6a24221ccc1bb4a323bc12d64883208c11">Device_Idle_S</a>;
<a name="l01002"></a>01002             }
<a name="l01003"></a>01003         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (action == <a class="code" href="ide__disk_8hh.html#a3bae184d288bce92398b814aa118c15ca6c282bf261ebd28f1d87398129882dee">ACT_DMA_READY</a>) {
<a name="l01004"></a>01004             <span class="comment">// clear the BSY bit</span>
<a name="l01005"></a>01005             <a class="code" href="classIdeDisk.html#ade818037fd6c985038ff29656089758d">status</a> &amp;= ~<a class="code" href="ide__disk_8hh.html#a3d03a0c27c2a175009ae7cb5f1a5b5e1">STATUS_BSY_BIT</a>;
<a name="l01006"></a>01006             <span class="comment">// set the DRQ bit</span>
<a name="l01007"></a>01007             <a class="code" href="classIdeDisk.html#ade818037fd6c985038ff29656089758d">status</a> |= <a class="code" href="ide__disk_8hh.html#a6dc9ea6abc0948e38e3716456d711267">STATUS_DRQ_BIT</a>;
<a name="l01008"></a>01008 
<a name="l01009"></a>01009             <a class="code" href="classIdeDisk.html#a5fb52a264b2cccb6ccad92493dff5deb">devState</a> = <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6a64d0d40fb6f851777564c89760787a96">Transfer_Data_Dma</a>;
<a name="l01010"></a>01010 
<a name="l01011"></a>01011             <span class="keywordflow">if</span> (<a class="code" href="classIdeDisk.html#acdefad9ebc91ac85f00ff92347b944d7">dmaState</a> != <a class="code" href="ide__disk_8hh.html#a8adb9656d6ea50580adaf9c8e7d9eebfa98b4f39d2f8dca680f8b1ac92943966c">Dma_Idle</a>)
<a name="l01012"></a>01012                 <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Inconsistent DMA state, should be Dma_Idle\n&quot;</span>);
<a name="l01013"></a>01013 
<a name="l01014"></a>01014             <a class="code" href="classIdeDisk.html#acdefad9ebc91ac85f00ff92347b944d7">dmaState</a> = <a class="code" href="ide__disk_8hh.html#a8adb9656d6ea50580adaf9c8e7d9eebfae35abb19ade6161b3817f6dd498ca711">Dma_Start</a>;
<a name="l01015"></a>01015             <span class="comment">// wait for the write to the DMA start bit</span>
<a name="l01016"></a>01016         }
<a name="l01017"></a>01017         <span class="keywordflow">break</span>;
<a name="l01018"></a>01018 
<a name="l01019"></a>01019       <span class="keywordflow">case</span> <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6a64d0d40fb6f851777564c89760787a96">Transfer_Data_Dma</a>:
<a name="l01020"></a>01020         <span class="keywordflow">if</span> (action == <a class="code" href="ide__disk_8hh.html#a3bae184d288bce92398b814aa118c15ca564e5d0c9a0d03e4e0d901a18100c6fd">ACT_CMD_ERROR</a>) {
<a name="l01021"></a>01021             <a class="code" href="classIdeDisk.html#aedff89f76b12103a29d22ef4de302236">dmaAborted</a> = <span class="keyword">true</span>;
<a name="l01022"></a>01022             <a class="code" href="classIdeDisk.html#a5fb52a264b2cccb6ccad92493dff5deb">devState</a> = <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6ab38004dd5047db164833d19ff9abc91d">Device_Dma_Abort</a>;
<a name="l01023"></a>01023         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (action == <a class="code" href="ide__disk_8hh.html#a3bae184d288bce92398b814aa118c15cacce8d2685977821326c313a603e35f7a">ACT_DMA_DONE</a>) {
<a name="l01024"></a>01024             <span class="comment">// clear the BSY bit</span>
<a name="l01025"></a>01025             <a class="code" href="classIdeDisk.html#a57e01c0e3593bc187fa343f761ec895a">setComplete</a>();
<a name="l01026"></a>01026             <span class="comment">// set the seek bit</span>
<a name="l01027"></a>01027             <a class="code" href="classIdeDisk.html#ade818037fd6c985038ff29656089758d">status</a> |= <a class="code" href="ide__disk_8hh.html#a6d24123c25308f8d0b135602dca13b8d">STATUS_SEEK_BIT</a>;
<a name="l01028"></a>01028             <span class="comment">// clear the controller state for DMA transfer</span>
<a name="l01029"></a>01029             <a class="code" href="classIdeDisk.html#a15da11d9f856cf2edfc6ed93e24ad0ea">ctrl</a>-&gt;<a class="code" href="classIdeController.html#ab3f8a4d9fa9f33c71d23a803142e9faa">setDmaComplete</a>(<span class="keyword">this</span>);
<a name="l01030"></a>01030 
<a name="l01031"></a>01031             <span class="keywordflow">if</span> (!<a class="code" href="classIdeDisk.html#a3e0ad2d309fc4a7aaa7a8af8b09d2cc0">isIENSet</a>()) {
<a name="l01032"></a>01032                 <a class="code" href="classIdeDisk.html#a5fb52a264b2cccb6ccad92493dff5deb">devState</a> = <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6ac4673e63774c8b75b7b7aad4588b1aad">Device_Idle_SI</a>;
<a name="l01033"></a>01033                 <a class="code" href="classIdeDisk.html#aba6fa755ca152cedafeb4150da6a2493">intrPost</a>();
<a name="l01034"></a>01034             } <span class="keywordflow">else</span> {
<a name="l01035"></a>01035                 <a class="code" href="classIdeDisk.html#a5fb52a264b2cccb6ccad92493dff5deb">devState</a> = <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6a24221ccc1bb4a323bc12d64883208c11">Device_Idle_S</a>;
<a name="l01036"></a>01036             }
<a name="l01037"></a>01037         }
<a name="l01038"></a>01038         <span class="keywordflow">break</span>;
<a name="l01039"></a>01039 
<a name="l01040"></a>01040       <span class="keywordflow">case</span> <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6ab38004dd5047db164833d19ff9abc91d">Device_Dma_Abort</a>:
<a name="l01041"></a>01041         <span class="keywordflow">if</span> (action == <a class="code" href="ide__disk_8hh.html#a3bae184d288bce92398b814aa118c15ca564e5d0c9a0d03e4e0d901a18100c6fd">ACT_CMD_ERROR</a>) {
<a name="l01042"></a>01042             <a class="code" href="classIdeDisk.html#a57e01c0e3593bc187fa343f761ec895a">setComplete</a>();
<a name="l01043"></a>01043             <a class="code" href="classIdeDisk.html#ade818037fd6c985038ff29656089758d">status</a> |= <a class="code" href="ide__disk_8hh.html#a6d24123c25308f8d0b135602dca13b8d">STATUS_SEEK_BIT</a>;
<a name="l01044"></a>01044             <a class="code" href="classIdeDisk.html#a15da11d9f856cf2edfc6ed93e24ad0ea">ctrl</a>-&gt;<a class="code" href="classIdeController.html#ab3f8a4d9fa9f33c71d23a803142e9faa">setDmaComplete</a>(<span class="keyword">this</span>);
<a name="l01045"></a>01045             <a class="code" href="classIdeDisk.html#aedff89f76b12103a29d22ef4de302236">dmaAborted</a> = <span class="keyword">false</span>;
<a name="l01046"></a>01046             <a class="code" href="classIdeDisk.html#acdefad9ebc91ac85f00ff92347b944d7">dmaState</a> = <a class="code" href="ide__disk_8hh.html#a8adb9656d6ea50580adaf9c8e7d9eebfa98b4f39d2f8dca680f8b1ac92943966c">Dma_Idle</a>;
<a name="l01047"></a>01047 
<a name="l01048"></a>01048             <span class="keywordflow">if</span> (!<a class="code" href="classIdeDisk.html#a3e0ad2d309fc4a7aaa7a8af8b09d2cc0">isIENSet</a>()) {
<a name="l01049"></a>01049                 <a class="code" href="classIdeDisk.html#a5fb52a264b2cccb6ccad92493dff5deb">devState</a> = <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6ac4673e63774c8b75b7b7aad4588b1aad">Device_Idle_SI</a>;
<a name="l01050"></a>01050                 <a class="code" href="classIdeDisk.html#aba6fa755ca152cedafeb4150da6a2493">intrPost</a>();
<a name="l01051"></a>01051             } <span class="keywordflow">else</span> {
<a name="l01052"></a>01052                 <a class="code" href="classIdeDisk.html#a5fb52a264b2cccb6ccad92493dff5deb">devState</a> = <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6a24221ccc1bb4a323bc12d64883208c11">Device_Idle_S</a>;
<a name="l01053"></a>01053             }
<a name="l01054"></a>01054         } <span class="keywordflow">else</span> {
<a name="l01055"></a>01055             <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classIdeDisk.html">IdeDisk</a>, <span class="stringliteral">&quot;Disk still busy aborting previous DMA command\n&quot;</span>);
<a name="l01056"></a>01056         }
<a name="l01057"></a>01057         <span class="keywordflow">break</span>;
<a name="l01058"></a>01058 
<a name="l01059"></a>01059       <span class="keywordflow">default</span>:
<a name="l01060"></a>01060         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Unknown IDE device state: %#x\n&quot;</span>, <a class="code" href="classIdeDisk.html#a5fb52a264b2cccb6ccad92493dff5deb">devState</a>);
<a name="l01061"></a>01061     }
<a name="l01062"></a>01062 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af940c7b6408a2bb34bdd3580e8415da6"></a><!-- doxytag: member="IdeDisk::writeCommand" ref="af940c7b6408a2bb34bdd3580e8415da6" args="(const Addr offset, int size, const uint8_t *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void writeCommand </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a>&nbsp;</td>
          <td class="paramname"> <em>offset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00262"></a>00262 {
<a name="l00263"></a>00263     <span class="keywordflow">if</span> (<a class="code" href="namespaceArmISA.html#a87b7a740701cddafb930a9460e9f4eba">offset</a> == <a class="code" href="ide__disk_8hh.html#a11faa4c105a137b8edaa096de5063835">DATA_OFFSET</a>) {
<a name="l00264"></a>00264         <span class="keywordflow">if</span> (size == <span class="keyword">sizeof</span>(uint16_t)) {
<a name="l00265"></a>00265             <a class="code" href="classIdeDisk.html#a2d468138409fc099c81da8d9b62f1f0f">cmdReg</a>.<a class="code" href="structCommandReg.html#aa6e451eccf9519b0809baad41f5ab241">data</a> = *(<span class="keyword">const</span> uint16_t *)data;
<a name="l00266"></a>00266         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (size == <span class="keyword">sizeof</span>(<a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>)) {
<a name="l00267"></a>00267             <a class="code" href="classIdeDisk.html#a2d468138409fc099c81da8d9b62f1f0f">cmdReg</a>.<a class="code" href="structCommandReg.html#aa6e451eccf9519b0809baad41f5ab241">data</a> = *(<span class="keyword">const</span> uint16_t *)data;
<a name="l00268"></a>00268             <a class="code" href="classIdeDisk.html#a24fb6794cfae6f84b380080e7501959e">updateState</a>(<a class="code" href="ide__disk_8hh.html#a3bae184d288bce92398b814aa118c15ca3af5a74985a6671feb0d9bb3bff9a543">ACT_DATA_WRITE_SHORT</a>);
<a name="l00269"></a>00269             <a class="code" href="classIdeDisk.html#a2d468138409fc099c81da8d9b62f1f0f">cmdReg</a>.<a class="code" href="structCommandReg.html#aa6e451eccf9519b0809baad41f5ab241">data</a> = *((<span class="keyword">const</span> uint16_t *)data + 1);
<a name="l00270"></a>00270         } <span class="keywordflow">else</span> {
<a name="l00271"></a>00271             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Data write of unsupported size %d.\n&quot;</span>, size);
<a name="l00272"></a>00272         }
<a name="l00273"></a>00273         <a class="code" href="classIdeDisk.html#a24fb6794cfae6f84b380080e7501959e">updateState</a>(<a class="code" href="ide__disk_8hh.html#a3bae184d288bce92398b814aa118c15ca3af5a74985a6671feb0d9bb3bff9a543">ACT_DATA_WRITE_SHORT</a>);
<a name="l00274"></a>00274         <span class="keywordflow">return</span>;
<a name="l00275"></a>00275     }
<a name="l00276"></a>00276 
<a name="l00277"></a>00277     assert(size == <span class="keyword">sizeof</span>(uint8_t));
<a name="l00278"></a>00278     <span class="keywordflow">switch</span> (<a class="code" href="namespaceArmISA.html#a87b7a740701cddafb930a9460e9f4eba">offset</a>) {
<a name="l00279"></a>00279       <span class="keywordflow">case</span> <a class="code" href="ide__disk_8hh.html#aa9c9d2fc107ac643f0a4b591955beaa9">FEATURES_OFFSET</a>:
<a name="l00280"></a>00280         <span class="keywordflow">break</span>;
<a name="l00281"></a>00281       <span class="keywordflow">case</span> <a class="code" href="ide__disk_8hh.html#a3c028923d4dbc280c75f2d05a07af561">NSECTOR_OFFSET</a>:
<a name="l00282"></a>00282         <a class="code" href="classIdeDisk.html#a2d468138409fc099c81da8d9b62f1f0f">cmdReg</a>.<a class="code" href="structCommandReg.html#a2b7ca3bc768d3d472ebf8dcc6d7b5588">sec_count</a> = *data;
<a name="l00283"></a>00283         <span class="keywordflow">break</span>;
<a name="l00284"></a>00284       <span class="keywordflow">case</span> <a class="code" href="ide__disk_8hh.html#afe1c25cd3dcc7137056f351bb4bae70a">SECTOR_OFFSET</a>:
<a name="l00285"></a>00285         <a class="code" href="classIdeDisk.html#a2d468138409fc099c81da8d9b62f1f0f">cmdReg</a>.<a class="code" href="structCommandReg.html#a3940c6ebbd3db04528668419e3569c78">sec_num</a> = *data;
<a name="l00286"></a>00286         <span class="keywordflow">break</span>;
<a name="l00287"></a>00287       <span class="keywordflow">case</span> <a class="code" href="ide__disk_8hh.html#a3c15c23524c451211d9eb469b602bb80">LCYL_OFFSET</a>:
<a name="l00288"></a>00288         <a class="code" href="classIdeDisk.html#a2d468138409fc099c81da8d9b62f1f0f">cmdReg</a>.<a class="code" href="structCommandReg.html#ab766960269178a004098748902b2b456">cyl_low</a> = *data;
<a name="l00289"></a>00289         <span class="keywordflow">break</span>;
<a name="l00290"></a>00290       <span class="keywordflow">case</span> <a class="code" href="ide__disk_8hh.html#af4211242794af5adce364ae3025bbd58">HCYL_OFFSET</a>:
<a name="l00291"></a>00291         <a class="code" href="classIdeDisk.html#a2d468138409fc099c81da8d9b62f1f0f">cmdReg</a>.<a class="code" href="structCommandReg.html#a0b9715d01f574b6b31ac724f2039f8db">cyl_high</a> = *data;
<a name="l00292"></a>00292         <span class="keywordflow">break</span>;
<a name="l00293"></a>00293       <span class="keywordflow">case</span> <a class="code" href="ide__disk_8hh.html#ab15fd72af5d7f9b9cb8c06f0d2e40b45">DRIVE_OFFSET</a>:
<a name="l00294"></a>00294         <a class="code" href="classIdeDisk.html#a2d468138409fc099c81da8d9b62f1f0f">cmdReg</a>.<a class="code" href="structCommandReg.html#a3f7026e41497f11cac6febb94464474c">drive</a> = *data;
<a name="l00295"></a>00295         <a class="code" href="classIdeDisk.html#a24fb6794cfae6f84b380080e7501959e">updateState</a>(<a class="code" href="ide__disk_8hh.html#a3bae184d288bce92398b814aa118c15ca6610e6fb837bbd223db1436df81ef3d7">ACT_SELECT_WRITE</a>);
<a name="l00296"></a>00296         <span class="keywordflow">break</span>;
<a name="l00297"></a>00297       <span class="keywordflow">case</span> <a class="code" href="ide__disk_8hh.html#adb83c033ee492824badb77fa8ebd5c5d">COMMAND_OFFSET</a>:
<a name="l00298"></a>00298         <a class="code" href="classIdeDisk.html#a2d468138409fc099c81da8d9b62f1f0f">cmdReg</a>.<a class="code" href="structCommandReg.html#a1a5aaa930940857f68f245eeb89506b5">command</a> = *data;
<a name="l00299"></a>00299         <a class="code" href="classIdeDisk.html#a24fb6794cfae6f84b380080e7501959e">updateState</a>(<a class="code" href="ide__disk_8hh.html#a3bae184d288bce92398b814aa118c15cae1dd7a3a517c2f858845012756768591">ACT_CMD_WRITE</a>);
<a name="l00300"></a>00300         <span class="keywordflow">break</span>;
<a name="l00301"></a>00301       <span class="keywordflow">default</span>:
<a name="l00302"></a>00302         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Invalid IDE command register offset: %#x\n&quot;</span>, <a class="code" href="namespaceArmISA.html#a87b7a740701cddafb930a9460e9f4eba">offset</a>);
<a name="l00303"></a>00303     }
<a name="l00304"></a>00304     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classIdeDisk.html">IdeDisk</a>, <span class="stringliteral">&quot;Write to disk at offset: %#x data %#x\n&quot;</span>, <a class="code" href="namespaceArmISA.html#a87b7a740701cddafb930a9460e9f4eba">offset</a>,
<a name="l00305"></a>00305             (<a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>)*data);
<a name="l00306"></a>00306 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af8e7a0d1414a2f9b03e2e001e036e87b"></a><!-- doxytag: member="IdeDisk::writeControl" ref="af8e7a0d1414a2f9b03e2e001e036e87b" args="(const Addr offset, int size, const uint8_t *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void writeControl </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a>&nbsp;</td>
          <td class="paramname"> <em>offset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00310"></a>00310 {
<a name="l00311"></a>00311     <span class="keywordflow">if</span> (<a class="code" href="namespaceArmISA.html#a87b7a740701cddafb930a9460e9f4eba">offset</a> != <a class="code" href="ide__disk_8hh.html#ae15f861f15f995e6655f24ababa373b0">CONTROL_OFFSET</a>)
<a name="l00312"></a>00312         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Invalid IDE control register offset: %#x\n&quot;</span>, <a class="code" href="namespaceArmISA.html#a87b7a740701cddafb930a9460e9f4eba">offset</a>);
<a name="l00313"></a>00313 
<a name="l00314"></a>00314     <span class="keywordflow">if</span> (*data &amp; <a class="code" href="ide__disk_8hh.html#a8156819b43430caea117fda9179f6b92">CONTROL_RST_BIT</a>) {
<a name="l00315"></a>00315         <span class="comment">// force the device into the reset state</span>
<a name="l00316"></a>00316         <a class="code" href="classIdeDisk.html#a5fb52a264b2cccb6ccad92493dff5deb">devState</a> = <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6ac88c15837f00c88c0dbda9f774a9f689">Device_Srst</a>;
<a name="l00317"></a>00317         <a class="code" href="classIdeDisk.html#a24fb6794cfae6f84b380080e7501959e">updateState</a>(<a class="code" href="ide__disk_8hh.html#a3bae184d288bce92398b814aa118c15ca2c18dc37b9298471dec71104f1d46fff">ACT_SRST_SET</a>);
<a name="l00318"></a>00318     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classIdeDisk.html#a5fb52a264b2cccb6ccad92493dff5deb">devState</a> == <a class="code" href="ide__disk_8hh.html#a11f4d653b474b99bf5796f4be62f72c6ac88c15837f00c88c0dbda9f774a9f689">Device_Srst</a> &amp;&amp; !(*data &amp; CONTROL_RST_BIT)) {
<a name="l00319"></a>00319         <a class="code" href="classIdeDisk.html#a24fb6794cfae6f84b380080e7501959e">updateState</a>(<a class="code" href="ide__disk_8hh.html#a3bae184d288bce92398b814aa118c15ca8a6e319f6c3971a39132513d188576fd">ACT_SRST_CLEAR</a>);
<a name="l00320"></a>00320     }
<a name="l00321"></a>00321 
<a name="l00322"></a>00322     <a class="code" href="classIdeDisk.html#ad58649fd94c5f762267f1d7bf682f6ca">nIENBit</a> = *data &amp; <a class="code" href="ide__disk_8hh.html#ae9920e68c1f940e29dee8f47c5b0da54">CONTROL_IEN_BIT</a>;
<a name="l00323"></a>00323 
<a name="l00324"></a>00324     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classIdeDisk.html">IdeDisk</a>, <span class="stringliteral">&quot;Write to disk at offset: %#x data %#x\n&quot;</span>, <a class="code" href="namespaceArmISA.html#a87b7a740701cddafb930a9460e9f4eba">offset</a>,
<a name="l00325"></a>00325             (<a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>)*data);
<a name="l00326"></a>00326 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aaf5688ef23ac188d55decc9021229d43"></a><!-- doxytag: member="IdeDisk::writeDisk" ref="aaf5688ef23ac188d55decc9021229d43" args="(uint32_t sector, uint8_t *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void writeDisk </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&nbsp;</td>
          <td class="paramname"> <em>sector</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00577"></a>00577 {
<a name="l00578"></a>00578     <a class="code" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> bytesWritten = <a class="code" href="classIdeDisk.html#a86d47120637a95e3a6876c774d768030">image</a>-&gt;<a class="code" href="classDiskImage.html#a42c90a80133a988d65ab33cc4d31d168">write</a>(data, sector);
<a name="l00579"></a>00579 
<a name="l00580"></a>00580     <span class="keywordflow">if</span> (bytesWritten != <a class="code" href="disk__image_8hh.html#ac729b32bca4535899ef2ee58b6a13d68">SectorSize</a>)
<a name="l00581"></a>00581         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Can&apos;t write to %s. Only %d of %d written. errno=%d\n&quot;</span>,
<a name="l00582"></a>00582               <a class="code" href="classSimObject.html#adbcff144e5e199d332a1352af1798148">name</a>(), bytesWritten, <a class="code" href="disk__image_8hh.html#ac729b32bca4535899ef2ee58b6a13d68">SectorSize</a>, errno);
<a name="l00583"></a>00583 }
</pre></div></p>

</div>
</div>
<hr/><h2>フレンドと関連する関数</h2>
<a class="anchor" id="a576a5609a96330636252b99a5d689e36"></a><!-- doxytag: member="IdeDisk::EventWrapper&lt; IdeDisk,&amp;IdeDisk::dmaPrdReadDone &gt;" ref="a576a5609a96330636252b99a5d689e36" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">friend class <a class="el" href="classEventWrapper.html">EventWrapper</a>&lt; <a class="el" href="classIdeDisk.html">IdeDisk</a>,&amp;IdeDisk::dmaPrdReadDone &gt;<code> [friend]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a6de24ef3cf489b4e2419c1ce290ea10f"></a><!-- doxytag: member="IdeDisk::EventWrapper&lt; IdeDisk,&amp;IdeDisk::dmaReadDone &gt;" ref="a6de24ef3cf489b4e2419c1ce290ea10f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">friend class <a class="el" href="classEventWrapper.html">EventWrapper</a>&lt; <a class="el" href="classIdeDisk.html">IdeDisk</a>,&amp;IdeDisk::dmaReadDone &gt;<code> [friend]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ad39ee160ecba74f2b017af931eec8c6c"></a><!-- doxytag: member="IdeDisk::EventWrapper&lt; IdeDisk,&amp;IdeDisk::dmaWriteDone &gt;" ref="ad39ee160ecba74f2b017af931eec8c6c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">friend class <a class="el" href="classEventWrapper.html">EventWrapper</a>&lt; <a class="el" href="classIdeDisk.html">IdeDisk</a>,&amp;IdeDisk::dmaWriteDone &gt;<code> [friend]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="accdc7f0b6fabdd3d77c1b559d5145f1e"></a><!-- doxytag: member="IdeDisk::EventWrapper&lt; IdeDisk,&amp;IdeDisk::doDmaRead &gt;" ref="accdc7f0b6fabdd3d77c1b559d5145f1e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">friend class <a class="el" href="classEventWrapper.html">EventWrapper</a>&lt; <a class="el" href="classIdeDisk.html">IdeDisk</a>,&amp;IdeDisk::doDmaRead &gt;<code> [friend]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a07dd701b52fa01c73a9a70a11490190f"></a><!-- doxytag: member="IdeDisk::EventWrapper&lt; IdeDisk,&amp;IdeDisk::doDmaTransfer &gt;" ref="a07dd701b52fa01c73a9a70a11490190f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">friend class <a class="el" href="classEventWrapper.html">EventWrapper</a>&lt; <a class="el" href="classIdeDisk.html">IdeDisk</a>,&amp;IdeDisk::doDmaTransfer &gt;<code> [friend]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ab5b4eef2a93f5c96df001eac024301e2"></a><!-- doxytag: member="IdeDisk::EventWrapper&lt; IdeDisk,&amp;IdeDisk::doDmaWrite &gt;" ref="ab5b4eef2a93f5c96df001eac024301e2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">friend class <a class="el" href="classEventWrapper.html">EventWrapper</a>&lt; <a class="el" href="classIdeDisk.html">IdeDisk</a>,&amp;IdeDisk::doDmaWrite &gt;<code> [friend]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/><h2>変数</h2>
<a class="anchor" id="a732862da3f80cd2b8eaba9425c8415f5"></a><!-- doxytag: member="IdeDisk::cmdBytes" ref="a732862da3f80cd2b8eaba9425c8415f5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> <a class="el" href="classIdeDisk.html#a732862da3f80cd2b8eaba9425c8415f5">cmdBytes</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Number of bytes in command data transfer </p>

</div>
</div>
<a class="anchor" id="a70940fc29adad666da15b3d4c11ac2ff"></a><!-- doxytag: member="IdeDisk::cmdBytesLeft" ref="a70940fc29adad666da15b3d4c11ac2ff" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> <a class="el" href="classIdeDisk.html#a70940fc29adad666da15b3d4c11ac2ff">cmdBytesLeft</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Number of bytes left in command data transfer </p>

</div>
</div>
<a class="anchor" id="a2d468138409fc099c81da8d9b62f1f0f"></a><!-- doxytag: member="IdeDisk::cmdReg" ref="a2d468138409fc099c81da8d9b62f1f0f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structCommandReg.html">CommandReg_t</a> <a class="el" href="classIdeDisk.html#a2d468138409fc099c81da8d9b62f1f0f">cmdReg</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Command block registers </p>

</div>
</div>
<a class="anchor" id="a15da11d9f856cf2edfc6ed93e24ad0ea"></a><!-- doxytag: member="IdeDisk::ctrl" ref="a15da11d9f856cf2edfc6ed93e24ad0ea" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classIdeController.html">IdeController</a>* <a class="el" href="classIdeDisk.html#a15da11d9f856cf2edfc6ed93e24ad0ea">ctrl</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>The IDE controller for this disk. </p>

</div>
</div>
<a class="anchor" id="a550dda68894801d065c57391335a8590"></a><!-- doxytag: member="IdeDisk::curPrd" ref="a550dda68894801d065c57391335a8590" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classPrdTableEntry.html">PrdTableEntry</a> <a class="el" href="classIdeDisk.html#a550dda68894801d065c57391335a8590">curPrd</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>PRD entry </p>

</div>
</div>
<a class="anchor" id="a13b6a0a9519069583d8648b3eafa0448"></a><!-- doxytag: member="IdeDisk::curPrdAddr" ref="a13b6a0a9519069583d8648b3eafa0448" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> <a class="el" href="classIdeDisk.html#a13b6a0a9519069583d8648b3eafa0448">curPrdAddr</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>PRD table base address </p>

</div>
</div>
<a class="anchor" id="af7d6af3e55b20feac31aac92469e56f3"></a><!-- doxytag: member="IdeDisk::curSector" ref="af7d6af3e55b20feac31aac92469e56f3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> <a class="el" href="classIdeDisk.html#af7d6af3e55b20feac31aac92469e56f3">curSector</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Current sector in access </p>

</div>
</div>
<a class="anchor" id="a54aefba7f330b07a06f4c9447e582f09"></a><!-- doxytag: member="IdeDisk::dataBuffer" ref="a54aefba7f330b07a06f4c9447e582f09" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t* <a class="el" href="classIdeDisk.html#a54aefba7f330b07a06f4c9447e582f09">dataBuffer</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Data buffer for transfers </p>

</div>
</div>
<a class="anchor" id="a5f20adde61bc73f1275a1a35481a011d"></a><!-- doxytag: member="IdeDisk::devID" ref="a5f20adde61bc73f1275a1a35481a011d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classIdeDisk.html#a5f20adde61bc73f1275a1a35481a011d">devID</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p><a class="el" href="namespaceDevice.html">Device</a> ID (master=0/slave=1) </p>

</div>
</div>
<a class="anchor" id="a5fb52a264b2cccb6ccad92493dff5deb"></a><!-- doxytag: member="IdeDisk::devState" ref="a5fb52a264b2cccb6ccad92493dff5deb" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ide__disk_8hh.html#abe49db4804c1744e30c8df026681eaf0">DevState_t</a> <a class="el" href="classIdeDisk.html#a5fb52a264b2cccb6ccad92493dff5deb">devState</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p><a class="el" href="namespaceDevice.html">Device</a> state </p>

</div>
</div>
<a class="anchor" id="af49c4a1e28104d83429a5ae73e388143"></a><!-- doxytag: member="IdeDisk::diskDelay" ref="af49c4a1e28104d83429a5ae73e388143" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classIdeDisk.html#af49c4a1e28104d83429a5ae73e388143">diskDelay</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>The disk delay in microseconds. </p>

</div>
</div>
<a class="anchor" id="aedff89f76b12103a29d22ef4de302236"></a><!-- doxytag: member="IdeDisk::dmaAborted" ref="aedff89f76b12103a29d22ef4de302236" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classIdeDisk.html#aedff89f76b12103a29d22ef4de302236">dmaAborted</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>DMA Aborted </p>

</div>
</div>
<a class="anchor" id="aee6a35e547d828db5c3f993da6179be0"></a><!-- doxytag: member="IdeDisk::dmaPrdReadEvent" ref="aee6a35e547d828db5c3f993da6179be0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classEventWrapper.html">EventWrapper</a>&lt;<a class="el" href="classIdeDisk.html">IdeDisk</a>, &amp;IdeDisk::dmaPrdReadDone&gt; <a class="el" href="classIdeDisk.html#aee6a35e547d828db5c3f993da6179be0">dmaPrdReadEvent</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a3f1cf4317e46c3c845d144c5e0334096"></a><!-- doxytag: member="IdeDisk::dmaRead" ref="a3f1cf4317e46c3c845d144c5e0334096" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classIdeDisk.html#a3f1cf4317e46c3c845d144c5e0334096">dmaRead</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Dma transaction is a read </p>

</div>
</div>
<a class="anchor" id="a01f4e9b11f3b49ac1cb6cbb6d51674c2"></a><!-- doxytag: member="IdeDisk::dmaReadBytes" ref="a01f4e9b11f3b49ac1cb6cbb6d51674c2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classStats_1_1Scalar.html">Stats::Scalar</a> <a class="el" href="classIdeDisk.html#a01f4e9b11f3b49ac1cb6cbb6d51674c2">dmaReadBytes</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="aafb836a34095616e67256a58e31ca604"></a><!-- doxytag: member="IdeDisk::dmaReadCG" ref="aafb836a34095616e67256a58e31ca604" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classChunkGenerator.html">ChunkGenerator</a>* <a class="el" href="classIdeDisk.html#aafb836a34095616e67256a58e31ca604">dmaReadCG</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a7c5e1828543bec774a42b971376bb618"></a><!-- doxytag: member="IdeDisk::dmaReadEvent" ref="a7c5e1828543bec774a42b971376bb618" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classEventWrapper.html">EventWrapper</a>&lt;<a class="el" href="classIdeDisk.html">IdeDisk</a>, &amp;IdeDisk::dmaReadDone&gt; <a class="el" href="classIdeDisk.html#a7c5e1828543bec774a42b971376bb618">dmaReadEvent</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="abab6bdef4c30741f3ec4b69e44e9d7c6"></a><!-- doxytag: member="IdeDisk::dmaReadFullPages" ref="abab6bdef4c30741f3ec4b69e44e9d7c6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classStats_1_1Scalar.html">Stats::Scalar</a> <a class="el" href="classIdeDisk.html#abab6bdef4c30741f3ec4b69e44e9d7c6">dmaReadFullPages</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a4310d460e8c2b5db635c0b2d1f1887a1"></a><!-- doxytag: member="IdeDisk::dmaReadTxs" ref="a4310d460e8c2b5db635c0b2d1f1887a1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classStats_1_1Scalar.html">Stats::Scalar</a> <a class="el" href="classIdeDisk.html#a4310d460e8c2b5db635c0b2d1f1887a1">dmaReadTxs</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a163b3ebdf005a99628b313b535697fb4"></a><!-- doxytag: member="IdeDisk::dmaReadWaitEvent" ref="a163b3ebdf005a99628b313b535697fb4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classEventWrapper.html">EventWrapper</a>&lt;<a class="el" href="classIdeDisk.html">IdeDisk</a>, &amp;IdeDisk::doDmaRead&gt; <a class="el" href="classIdeDisk.html#a163b3ebdf005a99628b313b535697fb4">dmaReadWaitEvent</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="acdefad9ebc91ac85f00ff92347b944d7"></a><!-- doxytag: member="IdeDisk::dmaState" ref="acdefad9ebc91ac85f00ff92347b944d7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ide__disk_8hh.html#a398a1d251e78562f1eccfb43ad5fdf49">DmaState_t</a> <a class="el" href="classIdeDisk.html#acdefad9ebc91ac85f00ff92347b944d7">dmaState</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Dma state </p>

</div>
</div>
<a class="anchor" id="aa90327d610dcc75173d1cd63671c6d31"></a><!-- doxytag: member="IdeDisk::dmaTransferEvent" ref="aa90327d610dcc75173d1cd63671c6d31" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classEventWrapper.html">EventWrapper</a>&lt;<a class="el" href="classIdeDisk.html">IdeDisk</a>, &amp;IdeDisk::doDmaTransfer&gt; <a class="el" href="classIdeDisk.html#aa90327d610dcc75173d1cd63671c6d31">dmaTransferEvent</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a59676f0552c89ab5f75ed2e6d8fca378"></a><!-- doxytag: member="IdeDisk::dmaWriteBytes" ref="a59676f0552c89ab5f75ed2e6d8fca378" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classStats_1_1Scalar.html">Stats::Scalar</a> <a class="el" href="classIdeDisk.html#a59676f0552c89ab5f75ed2e6d8fca378">dmaWriteBytes</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a9efaedbad52401a1b8ac2b8f1dffd28e"></a><!-- doxytag: member="IdeDisk::dmaWriteCG" ref="a9efaedbad52401a1b8ac2b8f1dffd28e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classChunkGenerator.html">ChunkGenerator</a>* <a class="el" href="classIdeDisk.html#a9efaedbad52401a1b8ac2b8f1dffd28e">dmaWriteCG</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a6c721e441022d80574b109229351326a"></a><!-- doxytag: member="IdeDisk::dmaWriteEvent" ref="a6c721e441022d80574b109229351326a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classEventWrapper.html">EventWrapper</a>&lt;<a class="el" href="classIdeDisk.html">IdeDisk</a>, &amp;IdeDisk::dmaWriteDone&gt; <a class="el" href="classIdeDisk.html#a6c721e441022d80574b109229351326a">dmaWriteEvent</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="adca0399abe696c769a268759b7823090"></a><!-- doxytag: member="IdeDisk::dmaWriteFullPages" ref="adca0399abe696c769a268759b7823090" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classStats_1_1Scalar.html">Stats::Scalar</a> <a class="el" href="classIdeDisk.html#adca0399abe696c769a268759b7823090">dmaWriteFullPages</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a2bb232dff5f135210d3350a21d1c9ccf"></a><!-- doxytag: member="IdeDisk::dmaWriteTxs" ref="a2bb232dff5f135210d3350a21d1c9ccf" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classStats_1_1Scalar.html">Stats::Scalar</a> <a class="el" href="classIdeDisk.html#a2bb232dff5f135210d3350a21d1c9ccf">dmaWriteTxs</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ad35ded50a6e608571cb80f1ad9741514"></a><!-- doxytag: member="IdeDisk::dmaWriteWaitEvent" ref="ad35ded50a6e608571cb80f1ad9741514" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classEventWrapper.html">EventWrapper</a>&lt;<a class="el" href="classIdeDisk.html">IdeDisk</a>, &amp;IdeDisk::doDmaWrite&gt; <a class="el" href="classIdeDisk.html#ad35ded50a6e608571cb80f1ad9741514">dmaWriteWaitEvent</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ae8a5371b95892db84d2b7ecef320d8a9"></a><!-- doxytag: member="IdeDisk::driveID" ref="ae8a5371b95892db84d2b7ecef320d8a9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structataparams.html">ataparams</a> <a class="el" href="classIdeDisk.html#ae8a5371b95892db84d2b7ecef320d8a9">driveID</a><code> [read, private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Drive identification structure for this disk </p>

</div>
</div>
<a class="anchor" id="a93e2e2892d126eac3ce8dbb514d44c31"></a><!-- doxytag: member="IdeDisk::drqBytesLeft" ref="a93e2e2892d126eac3ce8dbb514d44c31" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="Type_8hh.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> <a class="el" href="classIdeDisk.html#a93e2e2892d126eac3ce8dbb514d44c31">drqBytesLeft</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Number of bytes left in DRQ block </p>

</div>
</div>
<a class="anchor" id="a86d47120637a95e3a6876c774d768030"></a><!-- doxytag: member="IdeDisk::image" ref="a86d47120637a95e3a6876c774d768030" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classDiskImage.html">DiskImage</a>* <a class="el" href="classIdeDisk.html#a86d47120637a95e3a6876c774d768030">image</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>The image that contains the data of this disk. </p>

</div>
</div>
<a class="anchor" id="aabb849037e6d1c429d270d7fd20e958f"></a><!-- doxytag: member="IdeDisk::intrPending" ref="aabb849037e6d1c429d270d7fd20e958f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classIdeDisk.html#aabb849037e6d1c429d270d7fd20e958f">intrPending</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Interrupt pending </p>

</div>
</div>
<a class="anchor" id="ad58649fd94c5f762267f1d7bf682f6ca"></a><!-- doxytag: member="IdeDisk::nIENBit" ref="ad58649fd94c5f762267f1d7bf682f6ca" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classIdeDisk.html#ad58649fd94c5f762267f1d7bf682f6ca">nIENBit</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Interrupt enable bit </p>

</div>
</div>
<a class="anchor" id="ade818037fd6c985038ff29656089758d"></a><!-- doxytag: member="IdeDisk::status" ref="ade818037fd6c985038ff29656089758d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t <a class="el" href="classIdeDisk.html#ade818037fd6c985038ff29656089758d">status</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Status register </p>

</div>
</div>
<hr/>このクラスの説明は次のファイルから生成されました:<ul>
<li>dev/<a class="el" href="ide__disk_8hh_source.html">ide_disk.hh</a></li>
<li>dev/<a class="el" href="ide__disk_8cc.html">ide_disk.cc</a></li>
</ul>
</div>
<hr size="1"/><address style="text-align: right;"><small>File&nbsp;GEM5&nbsp;Wrapperに対して25 May 2015に生成されました。&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
