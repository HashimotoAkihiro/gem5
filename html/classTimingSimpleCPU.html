<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>File&nbsp;GEM5&nbsp;Wrapper: クラス TimingSimpleCPU</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- 作成： Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>メインページ</span></a></li>
      <li><a href="pages.html"><span>関連ページ</span></a></li>
      <li><a href="modules.html"><span>モジュール</span></a></li>
      <li><a href="namespaces.html"><span>ネームスペース</span></a></li>
      <li class="current"><a href="annotated.html"><span>クラス</span></a></li>
      <li><a href="files.html"><span>ファイル</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>構成</span></a></li>
      <li><a href="classes.html"><span>構成索引</span></a></li>
      <li><a href="hierarchy.html"><span>クラス階層</span></a></li>
      <li><a href="functions.html"><span>構成メンバ</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>クラス TimingSimpleCPU</h1><!-- doxytag: class="TimingSimpleCPU" --><!-- doxytag: inherits="BaseSimpleCPU" -->
<p><code>#include &lt;<a class="el" href="timing_8hh_source.html">timing.hh</a>&gt;</code></p>
<div class="dynheader">
TimingSimpleCPUに対する継承グラフ</div>
<div class="dynsection">
 <div class="center">
  <img src="classTimingSimpleCPU.gif" usemap="#TimingSimpleCPU_map" alt=""/>
  <map id="TimingSimpleCPU_map" name="TimingSimpleCPU_map">
<area href="classBaseSimpleCPU.html" alt="BaseSimpleCPU" shape="rect" coords="0,56,110,80"/>
<area href="classBaseCPU.html" alt="BaseCPU" shape="rect" coords="0,0,110,24"/>
</map>
 </div>
</div>

<p><a href="classTimingSimpleCPU-members.html">すべてのメンバ一覧</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>構成</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU_1_1DcachePort.html">DcachePort</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU_1_1FetchTranslation.html">FetchTranslation</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU_1_1IcachePort.html">IcachePort</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structTimingSimpleCPU_1_1IprEvent.html">IprEvent</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU_1_1SplitFragmentSenderState.html">SplitFragmentSenderState</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU_1_1SplitMainSenderState.html">SplitMainSenderState</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU_1_1TimingCPUPort.html">TimingCPUPort</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU_1_1TimingSimpleCPU.html">TimingSimpleCPU</a></td></tr>
<tr><td colspan="2"><h2>Public メソッド</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU.html#a6d8b5c088e0456abaaf000e46e346319">TimingSimpleCPU</a> (TimingSimpleCPUParams *params)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU.html#a637e8aedb9fa159bd5480f48e6574832">~TimingSimpleCPU</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU.html#a02fd73d861ef2e4aabb38c0c9ff82947">init</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU.html#a4e932bfc8aa6dfb998b8496a0f04ace3">drain</a> (<a class="el" href="classDrainManager.html">DrainManager</a> *drain_manager)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU.html#a8f020d3237536fe007fc488c4125c5d8">drainResume</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU.html#a05f299b443f8cc73a93d61572edc0218">switchOut</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU.html#ac82d2b8d331b2e8e6854a95d2917dfa2">takeOverFrom</a> (<a class="el" href="classBaseCPU_1_1BaseCPU.html">BaseCPU</a> *oldCPU)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU.html#ae2e1ccebe596a180f8105d57f9a93645">verifyMemoryMode</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU.html#ad7a501b28bdbe8b3e708cd1ef69ac191">activateContext</a> (<a class="el" href="base_2types_8hh.html#ab39b1a4f9dad884694c7a74ed69e6a6b">ThreadID</a> thread_num, <a class="el" href="classCycles.html">Cycles</a> delay)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU.html#a1dad4c4d2c3df4ef367e14fcc973ce74">suspendContext</a> (<a class="el" href="base_2types_8hh.html#ab39b1a4f9dad884694c7a74ed69e6a6b">ThreadID</a> thread_num)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classRefCountingPtr.html">Fault</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU.html#a66191b2d8a45050b7df3c3efa7bb07c6">readMem</a> (<a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a> addr, uint8_t *data, unsigned size, unsigned flags)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classRefCountingPtr.html">Fault</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU.html#ad46c5edeb1ee9b60445f3e26364e2c5e">writeMem</a> (uint8_t *data, unsigned size, <a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a> addr, unsigned flags, uint64_t *res)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU.html#a3865f8ea93e31d9b5d2726a80c0de966">fetch</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU.html#a9c1e81509746ac06253e334c436e1a75">sendFetch</a> (<a class="el" href="classRefCountingPtr.html">Fault</a> fault, <a class="el" href="classRequest.html">RequestPtr</a> req, <a class="el" href="classThreadContext.html">ThreadContext</a> *<a class="el" href="classBaseSimpleCPU.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU.html#a20b41c38922ef954c7e338f67bba971f">completeIfetch</a> (<a class="el" href="classPacket.html">PacketPtr</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU.html#a0f7f0d3412bbf494cd3d0c0f48e5fcf2">completeDataAccess</a> (<a class="el" href="classPacket.html">PacketPtr</a> pkt)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU.html#ab1a431d7af8dd2bbc95d09bd71be13ca">advanceInst</a> (<a class="el" href="classRefCountingPtr.html">Fault</a> fault)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU.html#add8df091bd836cf92c6987990d130b83">isSquashed</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU.html#a88aa41e2693dd0091afae2604eba9bed">printAddr</a> (<a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a> a)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU.html#a36c2a28eca3086b67fc7168a37367e98">finishTranslation</a> (<a class="el" href="classWholeTranslationState.html">WholeTranslationState</a> *state)</td></tr>
<tr><td colspan="2"><h2>Protected メソッド</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="classMasterPort.html">MasterPort</a> &amp;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU.html#aeea6b55ae1c4be53c21dbee434b221d4">getDataPort</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="classMasterPort.html">MasterPort</a> &amp;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU.html#a40da530cb5dd380fd7fc0d786e94d5eb">getInstPort</a> ()</td></tr>
<tr><td colspan="2"><h2>Private 型</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef <a class="el" href="classEventWrapper.html">EventWrapper</a><br class="typebreak"/>
&lt; <a class="el" href="classTimingSimpleCPU_1_1TimingSimpleCPU.html">TimingSimpleCPU</a>,&amp;TimingSimpleCPU::fetch &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU.html#a270bc6f239eb2eb58adf45357010a894">FetchEvent</a></td></tr>
<tr><td colspan="2"><h2>Private メソッド</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU.html#ad6486c2f7c95532e093a31f013b36fe5">sendData</a> (<a class="el" href="classRequest.html">RequestPtr</a> req, uint8_t *data, uint64_t *res, bool read)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU.html#a0894ae25efe60dc7855c057cab1684f9">sendSplitData</a> (<a class="el" href="classRequest.html">RequestPtr</a> req1, <a class="el" href="classRequest.html">RequestPtr</a> req2, <a class="el" href="classRequest.html">RequestPtr</a> req, uint8_t *data, bool read)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU.html#a5f6223adc354c36cc8773251dd7e0f4d">translationFault</a> (<a class="el" href="classRefCountingPtr.html">Fault</a> fault)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU.html#aefe7c644107e54e9aa677838cd1a947f">buildPacket</a> (<a class="el" href="classPacket.html">PacketPtr</a> &amp;pkt, <a class="el" href="classRequest.html">RequestPtr</a> req, bool read)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU.html#a1a7d0ff7c4efb80ffd4f53439b2291f8">buildSplitPacket</a> (<a class="el" href="classPacket.html">PacketPtr</a> &amp;pkt1, <a class="el" href="classPacket.html">PacketPtr</a> &amp;pkt2, <a class="el" href="classRequest.html">RequestPtr</a> req1, <a class="el" href="classRequest.html">RequestPtr</a> req2, <a class="el" href="classRequest.html">RequestPtr</a> req, uint8_t *data, bool read)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU.html#a9a8beb0dcad34e8759794cea6639f715">handleReadPacket</a> (<a class="el" href="classPacket.html">PacketPtr</a> pkt)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU.html#a8d70b3b102cd0f4949ae31e84ee2eb98">handleWritePacket</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU.html#ac166e5bc3ddf730beb1282cf821096ae">isDrained</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU.html#abfea8f75a7a7480716801affeebbe87b">tryCompleteDrain</a> ()</td></tr>
<tr><td colspan="2"><h2>Private 変数</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classTimingSimpleCPU_1_1FetchTranslation.html">FetchTranslation</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU.html#abc9a320383d8f8241113fe01f333d5ca">fetchTranslation</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classTimingSimpleCPU_1_1IcachePort.html">IcachePort</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU.html#a290723656a84b9cc90dfce377af9aad0">icachePort</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classTimingSimpleCPU_1_1DcachePort.html">DcachePort</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU.html#a38b03978ad7720fdc910ff6a8b44585f">dcachePort</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classPacket.html">PacketPtr</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU.html#a82097539e30887f0ad11d7a218c5bcca">ifetch_pkt</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classPacket.html">PacketPtr</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU.html#a8cdf6dfb358a155d5422c09f961297fe">dcache_pkt</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU.html#acb8e08ce453c8db11437d6cf9b0167bf">previousCycle</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classEventWrapper.html">FetchEvent</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU.html#a17e7c383c8fb3d4dc450d79c15dd1061">fetchEvent</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classDrainManager.html">DrainManager</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTimingSimpleCPU.html#a329b71fb934a93312ca0aacbf5a3f982">drainManager</a></td></tr>
</table>
<hr/><h2>型定義</h2>
<a class="anchor" id="a270bc6f239eb2eb58adf45357010a894"></a><!-- doxytag: member="TimingSimpleCPU::FetchEvent" ref="a270bc6f239eb2eb58adf45357010a894" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="classEventWrapper.html">EventWrapper</a>&lt;<a class="el" href="classTimingSimpleCPU_1_1TimingSimpleCPU.html">TimingSimpleCPU</a>, &amp;TimingSimpleCPU::fetch&gt; <a class="el" href="classEventWrapper.html">FetchEvent</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/><h2>コンストラクタとデストラクタ</h2>
<a class="anchor" id="a6d8b5c088e0456abaaf000e46e346319"></a><!-- doxytag: member="TimingSimpleCPU::TimingSimpleCPU" ref="a6d8b5c088e0456abaaf000e46e346319" args="(TimingSimpleCPUParams *params)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classTimingSimpleCPU_1_1TimingSimpleCPU.html">TimingSimpleCPU</a> </td>
          <td>(</td>
          <td class="paramtype">TimingSimpleCPUParams *&nbsp;</td>
          <td class="paramname"> <em>params</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00089"></a>00089     : <a class="code" href="classBaseSimpleCPU.html#a71551db7d052136dcf3e0ff87f935568">BaseSimpleCPU</a>(<a class="code" href="namespaceMipsISA.html#a37d3f683959086eac7bcf24a002a9fb8">p</a>), <a class="code" href="classTimingSimpleCPU.html#abc9a320383d8f8241113fe01f333d5ca">fetchTranslation</a>(<span class="keyword">this</span>), <a class="code" href="classTimingSimpleCPU.html#a290723656a84b9cc90dfce377af9aad0">icachePort</a>(<span class="keyword">this</span>),
<a name="l00090"></a>00090       <a class="code" href="classTimingSimpleCPU.html#a38b03978ad7720fdc910ff6a8b44585f">dcachePort</a>(<span class="keyword">this</span>), <a class="code" href="classTimingSimpleCPU.html#a82097539e30887f0ad11d7a218c5bcca">ifetch_pkt</a>(<a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>), <a class="code" href="classTimingSimpleCPU.html#a8cdf6dfb358a155d5422c09f961297fe">dcache_pkt</a>(<a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>), <a class="code" href="classTimingSimpleCPU.html#acb8e08ce453c8db11437d6cf9b0167bf">previousCycle</a>(0),
<a name="l00091"></a>00091       <a class="code" href="classTimingSimpleCPU.html#a17e7c383c8fb3d4dc450d79c15dd1061">fetchEvent</a>(<span class="keyword">this</span>), <a class="code" href="classTimingSimpleCPU.html#a329b71fb934a93312ca0aacbf5a3f982">drainManager</a>(<a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>)
<a name="l00092"></a>00092 {
<a name="l00093"></a>00093     <a class="code" href="classBaseSimpleCPU.html#a6cdf6e6db875a442f3ab6db542bd2bb5">_status</a> = <a class="code" href="classBaseSimpleCPU.html#a67a0db04d321a74b7e7fcfd3f1a3f70bad3fa9ae9431d6cb1772f9d9df48cab19">Idle</a>;
<a name="l00094"></a>00094 
<a name="l00095"></a>00095     <a class="code" href="classBaseCPU.html#ab737471139f5a296e5b26e8a0e1b0744" title="initialize section">system</a>-&gt;totalNumInsts = 0;
<a name="l00096"></a>00096 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a637e8aedb9fa159bd5480f48e6574832"></a><!-- doxytag: member="TimingSimpleCPU::~TimingSimpleCPU" ref="a637e8aedb9fa159bd5480f48e6574832" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">~<a class="el" href="classTimingSimpleCPU_1_1TimingSimpleCPU.html">TimingSimpleCPU</a> </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00101"></a>00101 {
<a name="l00102"></a>00102 }
</pre></div></p>

</div>
</div>
<hr/><h2>関数</h2>
<a class="anchor" id="ad7a501b28bdbe8b3e708cd1ef69ac191"></a><!-- doxytag: member="TimingSimpleCPU::activateContext" ref="ad7a501b28bdbe8b3e708cd1ef69ac191" args="(ThreadID thread_num, Cycles delay)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void activateContext </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="base_2types_8hh.html#ab39b1a4f9dad884694c7a74ed69e6a6b">ThreadID</a>&nbsp;</td>
          <td class="paramname"> <em>thread_num</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classCycles.html">Cycles</a>&nbsp;</td>
          <td class="paramname"> <em>delay</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00204"></a>00204 {
<a name="l00205"></a>00205     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(SimpleCPU, <span class="stringliteral">&quot;ActivateContext %d (%d cycles)\n&quot;</span>, thread_num, delay);
<a name="l00206"></a>00206 
<a name="l00207"></a>00207     assert(thread_num == 0);
<a name="l00208"></a>00208     assert(<a class="code" href="classBaseSimpleCPU.html#af9572fa907cd21b54cb14bd626010d39">thread</a>);
<a name="l00209"></a>00209 
<a name="l00210"></a>00210     assert(<a class="code" href="classBaseSimpleCPU.html#a6cdf6e6db875a442f3ab6db542bd2bb5">_status</a> == <a class="code" href="classBaseSimpleCPU.html#a67a0db04d321a74b7e7fcfd3f1a3f70bad3fa9ae9431d6cb1772f9d9df48cab19">Idle</a>);
<a name="l00211"></a>00211 
<a name="l00212"></a>00212     <a class="code" href="classBaseSimpleCPU.html#a40be38a691cf502b6ba46aaefd86dc77">notIdleFraction</a> = 1;
<a name="l00213"></a>00213     <a class="code" href="classBaseSimpleCPU.html#a6cdf6e6db875a442f3ab6db542bd2bb5">_status</a> = <a class="code" href="classDrainable.html#a5d74787dedbc4e11c1ab15bf487e61f8a2f5f2c4a8c4f4f0519d503dcdfbf55cb">BaseSimpleCPU::Running</a>;
<a name="l00214"></a>00214 
<a name="l00215"></a>00215     <span class="comment">// kick things off by initiating the fetch of the next instruction</span>
<a name="l00216"></a>00216     schedule(<a class="code" href="classTimingSimpleCPU.html#a17e7c383c8fb3d4dc450d79c15dd1061">fetchEvent</a>, clockEdge(delay));
<a name="l00217"></a>00217 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab1a431d7af8dd2bbc95d09bd71be13ca"></a><!-- doxytag: member="TimingSimpleCPU::advanceInst" ref="ab1a431d7af8dd2bbc95d09bd71be13ca" args="(Fault fault)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void advanceInst </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classRefCountingPtr.html">Fault</a>&nbsp;</td>
          <td class="paramname"> <em>fault</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00625"></a>00625 {
<a name="l00626"></a>00626     <span class="keywordflow">if</span> (<a class="code" href="classBaseSimpleCPU.html#a6cdf6e6db875a442f3ab6db542bd2bb5">_status</a> == <a class="code" href="classBaseSimpleCPU.html#a67a0db04d321a74b7e7fcfd3f1a3f70bab5c34d467d56d4c58a5be9aa5dbb03e2">Faulting</a>)
<a name="l00627"></a>00627         <span class="keywordflow">return</span>;
<a name="l00628"></a>00628 
<a name="l00629"></a>00629     <span class="keywordflow">if</span> (fault != <a class="code" href="fault__fwd_8hh.html#ab8ce3b69a6737f63fcdcf99910feb153">NoFault</a>) {
<a name="l00630"></a>00630         <a class="code" href="classBaseSimpleCPU.html#a9ff8fd374877c2ff6c10178aaad00852">advancePC</a>(fault);
<a name="l00631"></a>00631         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(SimpleCPU, <span class="stringliteral">&quot;Fault occured, scheduling fetch event\n&quot;</span>);
<a name="l00632"></a>00632         reschedule(<a class="code" href="classTimingSimpleCPU.html#a17e7c383c8fb3d4dc450d79c15dd1061">fetchEvent</a>, clockEdge(), <span class="keyword">true</span>);
<a name="l00633"></a>00633         <a class="code" href="classBaseSimpleCPU.html#a6cdf6e6db875a442f3ab6db542bd2bb5">_status</a> = <a class="code" href="classBaseSimpleCPU.html#a67a0db04d321a74b7e7fcfd3f1a3f70bab5c34d467d56d4c58a5be9aa5dbb03e2">Faulting</a>;
<a name="l00634"></a>00634         <span class="keywordflow">return</span>;
<a name="l00635"></a>00635     }
<a name="l00636"></a>00636 
<a name="l00637"></a>00637 
<a name="l00638"></a>00638     <span class="keywordflow">if</span> (!<a class="code" href="classBaseSimpleCPU.html#ae91a837c03d66c9c15de3da2fc76e811">stayAtPC</a>)
<a name="l00639"></a>00639         <a class="code" href="classBaseSimpleCPU.html#a9ff8fd374877c2ff6c10178aaad00852">advancePC</a>(fault);
<a name="l00640"></a>00640 
<a name="l00641"></a>00641     <span class="keywordflow">if</span> (<a class="code" href="classTimingSimpleCPU.html#abfea8f75a7a7480716801affeebbe87b">tryCompleteDrain</a>())
<a name="l00642"></a>00642             <span class="keywordflow">return</span>;
<a name="l00643"></a>00643 
<a name="l00644"></a>00644     <span class="keywordflow">if</span> (<a class="code" href="classBaseSimpleCPU.html#a6cdf6e6db875a442f3ab6db542bd2bb5">_status</a> == <a class="code" href="classDrainable.html#a5d74787dedbc4e11c1ab15bf487e61f8a2f5f2c4a8c4f4f0519d503dcdfbf55cb">BaseSimpleCPU::Running</a>) {
<a name="l00645"></a>00645         <span class="comment">// kick off fetch of next instruction... callback from icache</span>
<a name="l00646"></a>00646         <span class="comment">// response will cause that instruction to be executed,</span>
<a name="l00647"></a>00647         <span class="comment">// keeping the CPU running.</span>
<a name="l00648"></a>00648         <a class="code" href="classTimingSimpleCPU.html#a3865f8ea93e31d9b5d2726a80c0de966">fetch</a>();
<a name="l00649"></a>00649     }
<a name="l00650"></a>00650 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aefe7c644107e54e9aa677838cd1a947f"></a><!-- doxytag: member="TimingSimpleCPU::buildPacket" ref="aefe7c644107e54e9aa677838cd1a947f" args="(PacketPtr &amp;pkt, RequestPtr req, bool read)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void buildPacket </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classPacket.html">PacketPtr</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>pkt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classRequest.html">RequestPtr</a>&nbsp;</td>
          <td class="paramname"> <em>req</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>read</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00351"></a>00351 {
<a name="l00352"></a>00352     <a class="code" href="classMemCmd.html">MemCmd</a> cmd;
<a name="l00353"></a>00353     <span class="keywordflow">if</span> (read) {
<a name="l00354"></a>00354         cmd = <a class="code" href="classMemCmd.html#a2afce0a47a93eee73a314d53e4890153a96120c772a9cb695fe62ca81ec93a53b">MemCmd::ReadReq</a>;
<a name="l00355"></a>00355         <span class="keywordflow">if</span> (req-&gt;<a class="code" href="classRequest.html#a8965874e960faf91ad4b6af8dbf31875">isLLSC</a>())
<a name="l00356"></a>00356             cmd = <a class="code" href="classMemCmd.html#a2afce0a47a93eee73a314d53e4890153a1c703221ee751b9d3d635fe33ea8e350">MemCmd::LoadLockedReq</a>;
<a name="l00357"></a>00357     } <span class="keywordflow">else</span> {
<a name="l00358"></a>00358         cmd = <a class="code" href="classMemCmd.html#a2afce0a47a93eee73a314d53e4890153aa5ec34a7e56b23ff12c9b819519d168a">MemCmd::WriteReq</a>;
<a name="l00359"></a>00359         <span class="keywordflow">if</span> (req-&gt;<a class="code" href="classRequest.html#a8965874e960faf91ad4b6af8dbf31875">isLLSC</a>()) {
<a name="l00360"></a>00360             cmd = <a class="code" href="classMemCmd.html#a2afce0a47a93eee73a314d53e4890153a10ce12df51611216e2e8c4cb9b5d4047">MemCmd::StoreCondReq</a>;
<a name="l00361"></a>00361         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (req-&gt;<a class="code" href="classRequest.html#a6ec455c5a36403d3a8319bcfbf356bc1">isSwap</a>()) {
<a name="l00362"></a>00362             cmd = <a class="code" href="classMemCmd.html#a2afce0a47a93eee73a314d53e4890153a544e456dc06d65a6998a7df182d247d3">MemCmd::SwapReq</a>;
<a name="l00363"></a>00363         }
<a name="l00364"></a>00364     }
<a name="l00365"></a>00365     pkt = <span class="keyword">new</span> <a class="code" href="classPacket.html">Packet</a>(req, cmd);
<a name="l00366"></a>00366 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1a7d0ff7c4efb80ffd4f53439b2291f8"></a><!-- doxytag: member="TimingSimpleCPU::buildSplitPacket" ref="a1a7d0ff7c4efb80ffd4f53439b2291f8" args="(PacketPtr &amp;pkt1, PacketPtr &amp;pkt2, RequestPtr req1, RequestPtr req2, RequestPtr req, uint8_t *data, bool read)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void buildSplitPacket </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classPacket.html">PacketPtr</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>pkt1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classPacket.html">PacketPtr</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>pkt2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classRequest.html">RequestPtr</a>&nbsp;</td>
          <td class="paramname"> <em>req1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classRequest.html">RequestPtr</a>&nbsp;</td>
          <td class="paramname"> <em>req2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classRequest.html">RequestPtr</a>&nbsp;</td>
          <td class="paramname"> <em>req</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>read</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00372"></a>00372 {
<a name="l00373"></a>00373     pkt1 = pkt2 = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00374"></a>00374 
<a name="l00375"></a>00375     assert(!req1-&gt;<a class="code" href="classRequest.html#aad621c262e009350dd86ad5715c50f7a">isMmappedIpr</a>() &amp;&amp; !req2-&gt;<a class="code" href="classRequest.html#aad621c262e009350dd86ad5715c50f7a">isMmappedIpr</a>());
<a name="l00376"></a>00376 
<a name="l00377"></a>00377     <span class="keywordflow">if</span> (req-&gt;<a class="code" href="classRequest.html#a8552aa8d45c9ba10449d51ac08e7d490">getFlags</a>().<a class="code" href="classFlags.html#ac976964169b81aaba1d4cbb422f559ca">isSet</a>(<a class="code" href="classRequest.html#ab305c2952b5ae966870f325f2bef006c">Request::NO_ACCESS</a>)) {
<a name="l00378"></a>00378         <a class="code" href="classTimingSimpleCPU.html#aefe7c644107e54e9aa677838cd1a947f">buildPacket</a>(pkt1, req, read);
<a name="l00379"></a>00379         <span class="keywordflow">return</span>;
<a name="l00380"></a>00380     }
<a name="l00381"></a>00381 
<a name="l00382"></a>00382     <a class="code" href="classTimingSimpleCPU.html#aefe7c644107e54e9aa677838cd1a947f">buildPacket</a>(pkt1, req1, read);
<a name="l00383"></a>00383     <a class="code" href="classTimingSimpleCPU.html#aefe7c644107e54e9aa677838cd1a947f">buildPacket</a>(pkt2, req2, read);
<a name="l00384"></a>00384 
<a name="l00385"></a>00385     req-&gt;<a class="code" href="classRequest.html#aeefca2329f8f252cd5c17463dc7f8fda">setPhys</a>(req1-&gt;<a class="code" href="classRequest.html#a744ef11a5afe9d3651ce5f954259cb43">getPaddr</a>(), req-&gt;<a class="code" href="classRequest.html#a3c4029b904a61a9873e6d12785ce19a1">getSize</a>(), req1-&gt;<a class="code" href="classRequest.html#a8552aa8d45c9ba10449d51ac08e7d490">getFlags</a>(), dataMasterId());
<a name="l00386"></a>00386     <a class="code" href="classPacket.html">PacketPtr</a> pkt = <span class="keyword">new</span> <a class="code" href="classPacket.html">Packet</a>(req, pkt1-&gt;<a class="code" href="classPacket.html#af88eb56d484b750933cd2ea86594f001" title="The command field of the packet.">cmd</a>.<a class="code" href="classMemCmd.html#af4ef28145838bba6a01783aa0c919399">responseCommand</a>());
<a name="l00387"></a>00387 
<a name="l00388"></a>00388     pkt-&gt;<a class="code" href="classPacket.html#ae02c6b2e23b2a5b138c85fcf91fd818d">dataDynamicArray</a>&lt;uint8_t&gt;(data);
<a name="l00389"></a>00389     pkt1-&gt;<a class="code" href="classPacket.html#a60621b00d6ecd49b3e336087aca2eda0">dataStatic</a>&lt;uint8_t&gt;(data);
<a name="l00390"></a>00390     pkt2-&gt;<a class="code" href="classPacket.html#a60621b00d6ecd49b3e336087aca2eda0">dataStatic</a>&lt;uint8_t&gt;(data + req1-&gt;<a class="code" href="classRequest.html#a3c4029b904a61a9873e6d12785ce19a1">getSize</a>());
<a name="l00391"></a>00391 
<a name="l00392"></a>00392     SplitMainSenderState * main_send_state = <span class="keyword">new</span> SplitMainSenderState;
<a name="l00393"></a>00393     pkt-&gt;<a class="code" href="classPacket.html#a983ade0479f946c813284dcc65073367">senderState</a> = main_send_state;
<a name="l00394"></a>00394     main_send_state-&gt;fragments[0] = pkt1;
<a name="l00395"></a>00395     main_send_state-&gt;fragments[1] = pkt2;
<a name="l00396"></a>00396     main_send_state-&gt;outstanding = 2;
<a name="l00397"></a>00397     pkt1-&gt;<a class="code" href="classPacket.html#a983ade0479f946c813284dcc65073367">senderState</a> = <span class="keyword">new</span> SplitFragmentSenderState(pkt, 0);
<a name="l00398"></a>00398     pkt2-&gt;<a class="code" href="classPacket.html#a983ade0479f946c813284dcc65073367">senderState</a> = <span class="keyword">new</span> SplitFragmentSenderState(pkt, 1);
<a name="l00399"></a>00399 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0f7f0d3412bbf494cd3d0c0f48e5fcf2"></a><!-- doxytag: member="TimingSimpleCPU::completeDataAccess" ref="a0f7f0d3412bbf494cd3d0c0f48e5fcf2" args="(PacketPtr pkt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void completeDataAccess </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classPacket.html">PacketPtr</a>&nbsp;</td>
          <td class="paramname"> <em>pkt</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00760"></a>00760 {
<a name="l00761"></a>00761     <span class="comment">// received a response from the dcache: complete the load or store</span>
<a name="l00762"></a>00762     <span class="comment">// instruction</span>
<a name="l00763"></a>00763     assert(!pkt-&gt;<a class="code" href="classPacket.html#a32759931a1b2d6380407c6a18abd46e3">isError</a>());
<a name="l00764"></a>00764     assert(<a class="code" href="classBaseSimpleCPU.html#a6cdf6e6db875a442f3ab6db542bd2bb5">_status</a> == <a class="code" href="classBaseSimpleCPU.html#a67a0db04d321a74b7e7fcfd3f1a3f70ba62a98c3fd8f706eefc06ffbf0e657c7b">DcacheWaitResponse</a> || <a class="code" href="classBaseSimpleCPU.html#a6cdf6e6db875a442f3ab6db542bd2bb5">_status</a> == <a class="code" href="classBaseSimpleCPU.html#a67a0db04d321a74b7e7fcfd3f1a3f70baa9c3fe4ed9cc00350965e1fc87f2353c">DTBWaitResponse</a> ||
<a name="l00765"></a>00765            pkt-&gt;<a class="code" href="classPacket.html#a956cd41d82347558b9c0a5b0474903f2" title="A pointer to the original request.">req</a>-&gt;<a class="code" href="classRequest.html#a8552aa8d45c9ba10449d51ac08e7d490">getFlags</a>().<a class="code" href="classFlags.html#ac976964169b81aaba1d4cbb422f559ca">isSet</a>(<a class="code" href="classRequest.html#ab305c2952b5ae966870f325f2bef006c">Request::NO_ACCESS</a>));
<a name="l00766"></a>00766 
<a name="l00767"></a>00767     pkt-&gt;<a class="code" href="classPacket.html#a956cd41d82347558b9c0a5b0474903f2" title="A pointer to the original request.">req</a>-&gt;<a class="code" href="classRequest.html#ae10871c545a9288b0b1cf05f43d49e19">setAccessLatency</a>();
<a name="l00768"></a>00768     numCycles += curCycle() - <a class="code" href="classTimingSimpleCPU.html#acb8e08ce453c8db11437d6cf9b0167bf">previousCycle</a>;
<a name="l00769"></a>00769     <a class="code" href="classTimingSimpleCPU.html#acb8e08ce453c8db11437d6cf9b0167bf">previousCycle</a> = curCycle();
<a name="l00770"></a>00770 
<a name="l00771"></a>00771     <span class="keywordflow">if</span> (pkt-&gt;<a class="code" href="classPacket.html#a983ade0479f946c813284dcc65073367">senderState</a>) {
<a name="l00772"></a>00772         SplitFragmentSenderState * send_state =
<a name="l00773"></a>00773             <span class="keyword">dynamic_cast&lt;</span>SplitFragmentSenderState *<span class="keyword">&gt;</span>(pkt-&gt;<a class="code" href="classPacket.html#a983ade0479f946c813284dcc65073367">senderState</a>);
<a name="l00774"></a>00774         assert(send_state);
<a name="l00775"></a>00775         <span class="keyword">delete</span> pkt-&gt;<a class="code" href="classPacket.html#a956cd41d82347558b9c0a5b0474903f2" title="A pointer to the original request.">req</a>;
<a name="l00776"></a>00776         <span class="keyword">delete</span> pkt;
<a name="l00777"></a>00777         <a class="code" href="classPacket.html">PacketPtr</a> big_pkt = send_state-&gt;bigPkt;
<a name="l00778"></a>00778         <span class="keyword">delete</span> send_state;
<a name="l00779"></a>00779         
<a name="l00780"></a>00780         SplitMainSenderState * main_send_state =
<a name="l00781"></a>00781             <span class="keyword">dynamic_cast&lt;</span>SplitMainSenderState *<span class="keyword">&gt;</span>(big_pkt-&gt;<a class="code" href="classPacket.html#a983ade0479f946c813284dcc65073367">senderState</a>);
<a name="l00782"></a>00782         assert(main_send_state);
<a name="l00783"></a>00783         <span class="comment">// Record the fact that this packet is no longer outstanding.</span>
<a name="l00784"></a>00784         assert(main_send_state-&gt;outstanding != 0);
<a name="l00785"></a>00785         main_send_state-&gt;outstanding--;
<a name="l00786"></a>00786 
<a name="l00787"></a>00787         <span class="keywordflow">if</span> (main_send_state-&gt;outstanding) {
<a name="l00788"></a>00788             <span class="keywordflow">return</span>;
<a name="l00789"></a>00789         } <span class="keywordflow">else</span> {
<a name="l00790"></a>00790             <span class="keyword">delete</span> main_send_state;
<a name="l00791"></a>00791             big_pkt-&gt;<a class="code" href="classPacket.html#a983ade0479f946c813284dcc65073367">senderState</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00792"></a>00792             pkt = big_pkt;
<a name="l00793"></a>00793         }
<a name="l00794"></a>00794     }
<a name="l00795"></a>00795 
<a name="l00796"></a>00796     <a class="code" href="classBaseSimpleCPU.html#a6cdf6e6db875a442f3ab6db542bd2bb5">_status</a> = <a class="code" href="classDrainable.html#a5d74787dedbc4e11c1ab15bf487e61f8a2f5f2c4a8c4f4f0519d503dcdfbf55cb">BaseSimpleCPU::Running</a>;
<a name="l00797"></a>00797 
<a name="l00798"></a>00798     <a class="code" href="classRefCountingPtr.html">Fault</a> fault = <a class="code" href="classBaseSimpleCPU.html#abd80e0d70258dae9a743c9930a385163">curStaticInst</a>-&gt;completeAcc(pkt, <span class="keyword">this</span>, <a class="code" href="classBaseSimpleCPU.html#acbcf6d90551f8d3a598a70caae74d1ef">traceData</a>);
<a name="l00799"></a>00799 
<a name="l00800"></a>00800     <span class="comment">// keep an instruction count</span>
<a name="l00801"></a>00801     <span class="keywordflow">if</span> (fault == <a class="code" href="fault__fwd_8hh.html#ab8ce3b69a6737f63fcdcf99910feb153">NoFault</a>)
<a name="l00802"></a>00802         <a class="code" href="classBaseSimpleCPU.html#ae14e8c918d9e0fa1f09581af157369e2">countInst</a>();
<a name="l00803"></a>00803     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classBaseSimpleCPU.html#acbcf6d90551f8d3a598a70caae74d1ef">traceData</a>) {
<a name="l00804"></a>00804         <span class="comment">// If there was a fault, we shouldn&apos;t trace this instruction.</span>
<a name="l00805"></a>00805         <span class="keyword">delete</span> <a class="code" href="classBaseSimpleCPU.html#acbcf6d90551f8d3a598a70caae74d1ef">traceData</a>;
<a name="l00806"></a>00806         <a class="code" href="classBaseSimpleCPU.html#acbcf6d90551f8d3a598a70caae74d1ef">traceData</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00807"></a>00807     }
<a name="l00808"></a>00808 
<a name="l00809"></a>00809     <span class="comment">// the locked flag may be cleared on the response packet, so check</span>
<a name="l00810"></a>00810     <span class="comment">// pkt-&gt;req and not pkt to see if it was a load-locked</span>
<a name="l00811"></a>00811     <span class="keywordflow">if</span> (pkt-&gt;<a class="code" href="classPacket.html#adc47901747fc3c447db3abddaf01491a">isRead</a>() &amp;&amp; pkt-&gt;<a class="code" href="classPacket.html#a956cd41d82347558b9c0a5b0474903f2" title="A pointer to the original request.">req</a>-&gt;<a class="code" href="classRequest.html#a8965874e960faf91ad4b6af8dbf31875">isLLSC</a>()) {
<a name="l00812"></a>00812         <a class="code" href="namespaceAlphaISA.html#a00333a272d42606a01cc33c81999a58b">TheISA::handleLockedRead</a>(<a class="code" href="classBaseSimpleCPU.html#af9572fa907cd21b54cb14bd626010d39">thread</a>, pkt-&gt;<a class="code" href="classPacket.html#a956cd41d82347558b9c0a5b0474903f2" title="A pointer to the original request.">req</a>);
<a name="l00813"></a>00813     }
<a name="l00814"></a>00814 
<a name="l00815"></a>00815     <span class="keyword">delete</span> pkt-&gt;<a class="code" href="classPacket.html#a956cd41d82347558b9c0a5b0474903f2" title="A pointer to the original request.">req</a>;
<a name="l00816"></a>00816     <span class="keyword">delete</span> pkt;
<a name="l00817"></a>00817 
<a name="l00818"></a>00818     <a class="code" href="classBaseSimpleCPU.html#a86cfcf0bbf35e6f79ccf03bd9436f633">postExecute</a>();
<a name="l00819"></a>00819 
<a name="l00820"></a>00820     <a class="code" href="classTimingSimpleCPU.html#ab1a431d7af8dd2bbc95d09bd71be13ca">advanceInst</a>(fault);
<a name="l00821"></a>00821 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a20b41c38922ef954c7e338f67bba971f"></a><!-- doxytag: member="TimingSimpleCPU::completeIfetch" ref="a20b41c38922ef954c7e338f67bba971f" args="(PacketPtr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void completeIfetch </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classPacket.html">PacketPtr</a>&nbsp;</td>
          <td class="paramname"> <em>pkt</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00655"></a>00655 {
<a name="l00656"></a>00656     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(SimpleCPU, <span class="stringliteral">&quot;Complete ICache Fetch for addr %#x\n&quot;</span>, pkt ?
<a name="l00657"></a>00657             pkt-&gt;<a class="code" href="classPacket.html#afca9af4d83a57836baba87603463a6e0">getAddr</a>() : 0);
<a name="l00658"></a>00658 
<a name="l00659"></a>00659     <span class="comment">// received a response from the icache: execute the received</span>
<a name="l00660"></a>00660     <span class="comment">// instruction</span>
<a name="l00661"></a>00661     assert(!pkt || !pkt-&gt;<a class="code" href="classPacket.html#a32759931a1b2d6380407c6a18abd46e3">isError</a>());
<a name="l00662"></a>00662     assert(<a class="code" href="classBaseSimpleCPU.html#a6cdf6e6db875a442f3ab6db542bd2bb5">_status</a> == <a class="code" href="classBaseSimpleCPU.html#a67a0db04d321a74b7e7fcfd3f1a3f70baa694766f134e9cd81f5ad5b91dedf852">IcacheWaitResponse</a>);
<a name="l00663"></a>00663 
<a name="l00664"></a>00664     <a class="code" href="classBaseSimpleCPU.html#a6cdf6e6db875a442f3ab6db542bd2bb5">_status</a> = <a class="code" href="classDrainable.html#a5d74787dedbc4e11c1ab15bf487e61f8a2f5f2c4a8c4f4f0519d503dcdfbf55cb">BaseSimpleCPU::Running</a>;
<a name="l00665"></a>00665 
<a name="l00666"></a>00666     numCycles += curCycle() - <a class="code" href="classTimingSimpleCPU.html#acb8e08ce453c8db11437d6cf9b0167bf">previousCycle</a>;
<a name="l00667"></a>00667     <a class="code" href="classTimingSimpleCPU.html#acb8e08ce453c8db11437d6cf9b0167bf">previousCycle</a> = curCycle();
<a name="l00668"></a>00668 
<a name="l00669"></a>00669     <span class="keywordflow">if</span> (pkt)
<a name="l00670"></a>00670         pkt-&gt;<a class="code" href="classPacket.html#a956cd41d82347558b9c0a5b0474903f2" title="A pointer to the original request.">req</a>-&gt;<a class="code" href="classRequest.html#ae10871c545a9288b0b1cf05f43d49e19">setAccessLatency</a>();
<a name="l00671"></a>00671 
<a name="l00672"></a>00672 
<a name="l00673"></a>00673     <a class="code" href="classBaseSimpleCPU.html#ad341f256f4b26b20980f548e42ea79c4">preExecute</a>();
<a name="l00674"></a>00674     <span class="keywordflow">if</span> (<a class="code" href="classBaseSimpleCPU.html#abd80e0d70258dae9a743c9930a385163">curStaticInst</a> &amp;&amp; <a class="code" href="classBaseSimpleCPU.html#abd80e0d70258dae9a743c9930a385163">curStaticInst</a>-&gt;isMemRef()) {
<a name="l00675"></a>00675         <span class="comment">// load or store: just send to dcache</span>
<a name="l00676"></a>00676         <a class="code" href="classRefCountingPtr.html">Fault</a> fault = <a class="code" href="classBaseSimpleCPU.html#abd80e0d70258dae9a743c9930a385163">curStaticInst</a>-&gt;initiateAcc(<span class="keyword">this</span>, <a class="code" href="classBaseSimpleCPU.html#acbcf6d90551f8d3a598a70caae74d1ef">traceData</a>);
<a name="l00677"></a>00677 
<a name="l00678"></a>00678         <span class="comment">// If we&apos;re not running now the instruction will complete in a dcache</span>
<a name="l00679"></a>00679         <span class="comment">// response callback or the instruction faulted and has started an</span>
<a name="l00680"></a>00680         <span class="comment">// ifetch</span>
<a name="l00681"></a>00681         <span class="keywordflow">if</span> (<a class="code" href="classBaseSimpleCPU.html#a6cdf6e6db875a442f3ab6db542bd2bb5">_status</a> == <a class="code" href="classDrainable.html#a5d74787dedbc4e11c1ab15bf487e61f8a2f5f2c4a8c4f4f0519d503dcdfbf55cb">BaseSimpleCPU::Running</a>) {
<a name="l00682"></a>00682             <span class="keywordflow">if</span> (fault != <a class="code" href="fault__fwd_8hh.html#ab8ce3b69a6737f63fcdcf99910feb153">NoFault</a> &amp;&amp; <a class="code" href="classBaseSimpleCPU.html#acbcf6d90551f8d3a598a70caae74d1ef">traceData</a>) {
<a name="l00683"></a>00683                 <span class="comment">// If there was a fault, we shouldn&apos;t trace this instruction.</span>
<a name="l00684"></a>00684                 <span class="keyword">delete</span> <a class="code" href="classBaseSimpleCPU.html#acbcf6d90551f8d3a598a70caae74d1ef">traceData</a>;
<a name="l00685"></a>00685                 <a class="code" href="classBaseSimpleCPU.html#acbcf6d90551f8d3a598a70caae74d1ef">traceData</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00686"></a>00686             }
<a name="l00687"></a>00687 
<a name="l00688"></a>00688             <a class="code" href="classBaseSimpleCPU.html#a86cfcf0bbf35e6f79ccf03bd9436f633">postExecute</a>();
<a name="l00689"></a>00689             <span class="comment">// @todo remove me after debugging with legion done</span>
<a name="l00690"></a>00690             <span class="keywordflow">if</span> (<a class="code" href="classBaseSimpleCPU.html#abd80e0d70258dae9a743c9930a385163">curStaticInst</a> &amp;&amp; (!<a class="code" href="classBaseSimpleCPU.html#abd80e0d70258dae9a743c9930a385163">curStaticInst</a>-&gt;isMicroop() ||
<a name="l00691"></a>00691                         <a class="code" href="classBaseSimpleCPU.html#abd80e0d70258dae9a743c9930a385163">curStaticInst</a>-&gt;isFirstMicroop()))
<a name="l00692"></a>00692                 instCnt++;
<a name="l00693"></a>00693             <a class="code" href="classTimingSimpleCPU.html#ab1a431d7af8dd2bbc95d09bd71be13ca">advanceInst</a>(fault);
<a name="l00694"></a>00694         }
<a name="l00695"></a>00695     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classBaseSimpleCPU.html#abd80e0d70258dae9a743c9930a385163">curStaticInst</a>) {
<a name="l00696"></a>00696         <span class="comment">// non-memory instruction: execute completely now</span>
<a name="l00697"></a>00697         <a class="code" href="classRefCountingPtr.html">Fault</a> fault = <a class="code" href="classBaseSimpleCPU.html#abd80e0d70258dae9a743c9930a385163">curStaticInst</a>-&gt;execute(<span class="keyword">this</span>, <a class="code" href="classBaseSimpleCPU.html#acbcf6d90551f8d3a598a70caae74d1ef">traceData</a>);
<a name="l00698"></a>00698 
<a name="l00699"></a>00699         <span class="comment">// keep an instruction count</span>
<a name="l00700"></a>00700         <span class="keywordflow">if</span> (fault == <a class="code" href="fault__fwd_8hh.html#ab8ce3b69a6737f63fcdcf99910feb153">NoFault</a>)
<a name="l00701"></a>00701             <a class="code" href="classBaseSimpleCPU.html#ae14e8c918d9e0fa1f09581af157369e2">countInst</a>();
<a name="l00702"></a>00702         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classBaseSimpleCPU.html#acbcf6d90551f8d3a598a70caae74d1ef">traceData</a> &amp;&amp; !<a class="code" href="trace_8hh.html#af76c9f7776aade1bf9d7dfa8a0c6b341">DTRACE</a>(ExecFaulting)) {
<a name="l00703"></a>00703             <span class="keyword">delete</span> <a class="code" href="classBaseSimpleCPU.html#acbcf6d90551f8d3a598a70caae74d1ef">traceData</a>;
<a name="l00704"></a>00704             <a class="code" href="classBaseSimpleCPU.html#acbcf6d90551f8d3a598a70caae74d1ef">traceData</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00705"></a>00705         }
<a name="l00706"></a>00706 
<a name="l00707"></a>00707         <a class="code" href="classBaseSimpleCPU.html#a86cfcf0bbf35e6f79ccf03bd9436f633">postExecute</a>();
<a name="l00708"></a>00708         <span class="comment">// @todo remove me after debugging with legion done</span>
<a name="l00709"></a>00709         <span class="keywordflow">if</span> (<a class="code" href="classBaseSimpleCPU.html#abd80e0d70258dae9a743c9930a385163">curStaticInst</a> &amp;&amp; (!<a class="code" href="classBaseSimpleCPU.html#abd80e0d70258dae9a743c9930a385163">curStaticInst</a>-&gt;isMicroop() ||
<a name="l00710"></a>00710                     <a class="code" href="classBaseSimpleCPU.html#abd80e0d70258dae9a743c9930a385163">curStaticInst</a>-&gt;isFirstMicroop()))
<a name="l00711"></a>00711             instCnt++;
<a name="l00712"></a>00712         <a class="code" href="classTimingSimpleCPU.html#ab1a431d7af8dd2bbc95d09bd71be13ca">advanceInst</a>(fault);
<a name="l00713"></a>00713     } <span class="keywordflow">else</span> {
<a name="l00714"></a>00714         <a class="code" href="classTimingSimpleCPU.html#ab1a431d7af8dd2bbc95d09bd71be13ca">advanceInst</a>(<a class="code" href="fault__fwd_8hh.html#ab8ce3b69a6737f63fcdcf99910feb153">NoFault</a>);
<a name="l00715"></a>00715     }
<a name="l00716"></a>00716 
<a name="l00717"></a>00717     <span class="keywordflow">if</span> (pkt) {
<a name="l00718"></a>00718         <span class="keyword">delete</span> pkt-&gt;<a class="code" href="classPacket.html#a956cd41d82347558b9c0a5b0474903f2" title="A pointer to the original request.">req</a>;
<a name="l00719"></a>00719         <span class="keyword">delete</span> pkt;
<a name="l00720"></a>00720     }
<a name="l00721"></a>00721 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4e932bfc8aa6dfb998b8496a0f04ace3"></a><!-- doxytag: member="TimingSimpleCPU::drain" ref="a4e932bfc8aa6dfb998b8496a0f04ace3" args="(DrainManager *drain_manager)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int drain </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classDrainManager.html">DrainManager</a> *&nbsp;</td>
          <td class="paramname"> <em>drain_manager</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00106"></a>00106 {
<a name="l00107"></a>00107     assert(!<a class="code" href="classTimingSimpleCPU.html#a329b71fb934a93312ca0aacbf5a3f982">drainManager</a>);
<a name="l00108"></a>00108     <span class="keywordflow">if</span> (switchedOut())
<a name="l00109"></a>00109         <span class="keywordflow">return</span> 0;
<a name="l00110"></a>00110 
<a name="l00111"></a>00111     <span class="keywordflow">if</span> (<a class="code" href="classBaseSimpleCPU.html#a6cdf6e6db875a442f3ab6db542bd2bb5">_status</a> == <a class="code" href="classBaseSimpleCPU.html#a67a0db04d321a74b7e7fcfd3f1a3f70bad3fa9ae9431d6cb1772f9d9df48cab19">Idle</a> ||
<a name="l00112"></a>00112         (<a class="code" href="classBaseSimpleCPU.html#a6cdf6e6db875a442f3ab6db542bd2bb5">_status</a> == <a class="code" href="classDrainable.html#a5d74787dedbc4e11c1ab15bf487e61f8a2f5f2c4a8c4f4f0519d503dcdfbf55cb">BaseSimpleCPU::Running</a> &amp;&amp; <a class="code" href="classTimingSimpleCPU.html#ac166e5bc3ddf730beb1282cf821096ae">isDrained</a>())) {
<a name="l00113"></a>00113         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Drain, <span class="stringliteral">&quot;No need to drain.\n&quot;</span>);
<a name="l00114"></a>00114         <span class="keywordflow">return</span> 0;
<a name="l00115"></a>00115     } <span class="keywordflow">else</span> {
<a name="l00116"></a>00116         <a class="code" href="classTimingSimpleCPU.html#a329b71fb934a93312ca0aacbf5a3f982">drainManager</a> = drain_manager;
<a name="l00117"></a>00117         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Drain, <span class="stringliteral">&quot;Requesting drain: %s\n&quot;</span>, <a class="code" href="classBaseSimpleCPU.html#a827fb3454585cf4c620f4fd341966317">pcState</a>());
<a name="l00118"></a>00118 
<a name="l00119"></a>00119         <span class="comment">// The fetch event can become descheduled if a drain didn&apos;t</span>
<a name="l00120"></a>00120         <span class="comment">// succeed on the first attempt. We need to reschedule it if</span>
<a name="l00121"></a>00121         <span class="comment">// the CPU is waiting for a microcode routine to complete.</span>
<a name="l00122"></a>00122         <span class="keywordflow">if</span> (<a class="code" href="classBaseSimpleCPU.html#a6cdf6e6db875a442f3ab6db542bd2bb5">_status</a> == <a class="code" href="classDrainable.html#a5d74787dedbc4e11c1ab15bf487e61f8a2f5f2c4a8c4f4f0519d503dcdfbf55cb">BaseSimpleCPU::Running</a> &amp;&amp; !<a class="code" href="classTimingSimpleCPU.html#a17e7c383c8fb3d4dc450d79c15dd1061">fetchEvent</a>.<a class="code" href="classEvent.html#a9cd69a6b10cb037550943f177a0da688" title="Determine if the current event is scheduled.">scheduled</a>())
<a name="l00123"></a>00123             schedule(<a class="code" href="classTimingSimpleCPU.html#a17e7c383c8fb3d4dc450d79c15dd1061">fetchEvent</a>, clockEdge());
<a name="l00124"></a>00124 
<a name="l00125"></a>00125         <span class="keywordflow">return</span> 1;
<a name="l00126"></a>00126     }
<a name="l00127"></a>00127 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8f020d3237536fe007fc488c4125c5d8"></a><!-- doxytag: member="TimingSimpleCPU::drainResume" ref="a8f020d3237536fe007fc488c4125c5d8" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void drainResume </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00131"></a>00131 {
<a name="l00132"></a>00132     assert(!<a class="code" href="classTimingSimpleCPU.html#a17e7c383c8fb3d4dc450d79c15dd1061">fetchEvent</a>.<a class="code" href="classEvent.html#a9cd69a6b10cb037550943f177a0da688" title="Determine if the current event is scheduled.">scheduled</a>());
<a name="l00133"></a>00133     assert(!<a class="code" href="classTimingSimpleCPU.html#a329b71fb934a93312ca0aacbf5a3f982">drainManager</a>);
<a name="l00134"></a>00134     <span class="keywordflow">if</span> (switchedOut())
<a name="l00135"></a>00135         <span class="keywordflow">return</span>;
<a name="l00136"></a>00136 
<a name="l00137"></a>00137     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(SimpleCPU, <span class="stringliteral">&quot;Resume\n&quot;</span>);
<a name="l00138"></a>00138     <a class="code" href="classTimingSimpleCPU.html#ae2e1ccebe596a180f8105d57f9a93645">verifyMemoryMode</a>();
<a name="l00139"></a>00139 
<a name="l00140"></a>00140     assert(!threadContexts.empty());
<a name="l00141"></a>00141     <span class="keywordflow">if</span> (threadContexts.size() &gt; 1)
<a name="l00142"></a>00142         <a class="code" href="base_2misc_8hh.html#acad519418dbfdd70c1208711e609c80e">fatal</a>(<span class="stringliteral">&quot;The timing CPU only supports one thread.\n&quot;</span>);
<a name="l00143"></a>00143 
<a name="l00144"></a>00144     <span class="keywordflow">if</span> (<a class="code" href="classBaseSimpleCPU.html#af9572fa907cd21b54cb14bd626010d39">thread</a>-&gt;<a class="code" href="classSimpleThread.html#a2ad9e92a82d6f783b3061584729c2f4a">status</a>() == <a class="code" href="classThreadContext.html#a67a0db04d321a74b7e7fcfd3f1a3f70ba26bd8444261cc58df7a86753c79d2520">ThreadContext::Active</a>) {
<a name="l00145"></a>00145         schedule(<a class="code" href="classTimingSimpleCPU.html#a17e7c383c8fb3d4dc450d79c15dd1061">fetchEvent</a>, nextCycle());
<a name="l00146"></a>00146         <a class="code" href="classBaseSimpleCPU.html#a6cdf6e6db875a442f3ab6db542bd2bb5">_status</a> = <a class="code" href="classDrainable.html#a5d74787dedbc4e11c1ab15bf487e61f8a2f5f2c4a8c4f4f0519d503dcdfbf55cb">BaseSimpleCPU::Running</a>;
<a name="l00147"></a>00147         <a class="code" href="classBaseSimpleCPU.html#a40be38a691cf502b6ba46aaefd86dc77">notIdleFraction</a> = 1;
<a name="l00148"></a>00148     } <span class="keywordflow">else</span> {
<a name="l00149"></a>00149         <a class="code" href="classBaseSimpleCPU.html#a6cdf6e6db875a442f3ab6db542bd2bb5">_status</a> = <a class="code" href="classBaseSimpleCPU.html#a67a0db04d321a74b7e7fcfd3f1a3f70bad3fa9ae9431d6cb1772f9d9df48cab19">BaseSimpleCPU::Idle</a>;
<a name="l00150"></a>00150         <a class="code" href="classBaseSimpleCPU.html#a40be38a691cf502b6ba46aaefd86dc77">notIdleFraction</a> = 0;
<a name="l00151"></a>00151     }
<a name="l00152"></a>00152 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3865f8ea93e31d9b5d2726a80c0de966"></a><!-- doxytag: member="TimingSimpleCPU::fetch" ref="a3865f8ea93e31d9b5d2726a80c0de966" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fetch </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00557"></a>00557 {
<a name="l00558"></a>00558     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(SimpleCPU, <span class="stringliteral">&quot;Fetch\n&quot;</span>);
<a name="l00559"></a>00559 
<a name="l00560"></a>00560     <span class="keywordflow">if</span> (!<a class="code" href="classBaseSimpleCPU.html#abd80e0d70258dae9a743c9930a385163">curStaticInst</a> || !<a class="code" href="classBaseSimpleCPU.html#abd80e0d70258dae9a743c9930a385163">curStaticInst</a>-&gt;isDelayedCommit())
<a name="l00561"></a>00561         <a class="code" href="classBaseSimpleCPU.html#afc6b0526014df091373ec2c850508a55">checkForInterrupts</a>();
<a name="l00562"></a>00562 
<a name="l00563"></a>00563     <a class="code" href="classBaseSimpleCPU.html#a925a66fd31bbc43fa4bc4a90d5b316cb">checkPcEventQueue</a>();
<a name="l00564"></a>00564 
<a name="l00565"></a>00565     <span class="comment">// We must have just got suspended by a PC event</span>
<a name="l00566"></a>00566     <span class="keywordflow">if</span> (<a class="code" href="classBaseSimpleCPU.html#a6cdf6e6db875a442f3ab6db542bd2bb5">_status</a> == <a class="code" href="classBaseSimpleCPU.html#a67a0db04d321a74b7e7fcfd3f1a3f70bad3fa9ae9431d6cb1772f9d9df48cab19">Idle</a>)
<a name="l00567"></a>00567         <span class="keywordflow">return</span>;
<a name="l00568"></a>00568 
<a name="l00569"></a>00569     <a class="code" href="namespaceAlphaISA.html#af780de49982ecf691215cac9b9dfc615">TheISA::PCState</a> <a class="code" href="classBaseSimpleCPU.html#a827fb3454585cf4c620f4fd341966317">pcState</a> = <a class="code" href="classBaseSimpleCPU.html#af9572fa907cd21b54cb14bd626010d39">thread</a>-&gt;<a class="code" href="classSimpleThread.html#a827fb3454585cf4c620f4fd341966317">pcState</a>();
<a name="l00570"></a>00570     <span class="keywordtype">bool</span> needToFetch = !<a class="code" href="base_2types_8hh.html#a01ec7071d9749218cc83949b3f93cd9b">isRomMicroPC</a>(pcState.microPC()) &amp;&amp; !<a class="code" href="classBaseSimpleCPU.html#a52d6d2514fb5ccecad4788d57738f544">curMacroStaticInst</a>;
<a name="l00571"></a>00571 
<a name="l00572"></a>00572     <span class="keywordflow">if</span> (needToFetch) {
<a name="l00573"></a>00573         <a class="code" href="classBaseSimpleCPU.html#a6cdf6e6db875a442f3ab6db542bd2bb5">_status</a> = <a class="code" href="classDrainable.html#a5d74787dedbc4e11c1ab15bf487e61f8a2f5f2c4a8c4f4f0519d503dcdfbf55cb">BaseSimpleCPU::Running</a>;
<a name="l00574"></a>00574         <a class="code" href="classRequest.html">Request</a> *ifetch_req = <span class="keyword">new</span> <a class="code" href="classRequest.html">Request</a>();
<a name="l00575"></a>00575         ifetch_req-&gt;<a class="code" href="classRequest.html#a7abf15d67b3fbd53236fde58eecb3f34">taskId</a>(taskId());
<a name="l00576"></a>00576         ifetch_req-&gt;<a class="code" href="classRequest.html#a40574dadf22fb92b4966eb9815da7575">setThreadContext</a>(_cpuId, <span class="comment">/* thread ID */</span> 0);
<a name="l00577"></a>00577         <a class="code" href="classBaseSimpleCPU.html#a06bcbb6a9e9cbcf60796a0843cdf9a35">setupFetchRequest</a>(ifetch_req);
<a name="l00578"></a>00578         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(SimpleCPU, <span class="stringliteral">&quot;Translating address %#x\n&quot;</span>, ifetch_req-&gt;<a class="code" href="classRequest.html#a68d2230b37b30d25462093fefdd813ac">getVaddr</a>());
<a name="l00579"></a>00579         <a class="code" href="classBaseSimpleCPU.html#af9572fa907cd21b54cb14bd626010d39">thread</a>-&gt;<a class="code" href="classSimpleThread.html#abcb37ddc11515555d8484702697bc4bb">itb</a>-&gt;translateTiming(ifetch_req, <a class="code" href="classBaseSimpleCPU.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>, &amp;<a class="code" href="classTimingSimpleCPU.html#abc9a320383d8f8241113fe01f333d5ca">fetchTranslation</a>,
<a name="l00580"></a>00580                 <a class="code" href="classBaseTLB.html#a46c8a310cf4c094f8c80e1cb8dc1f911a31b7313c05d32519f3869a3de8be95e6">BaseTLB::Execute</a>);
<a name="l00581"></a>00581     } <span class="keywordflow">else</span> {
<a name="l00582"></a>00582         <a class="code" href="classBaseSimpleCPU.html#a6cdf6e6db875a442f3ab6db542bd2bb5">_status</a> = <a class="code" href="classBaseSimpleCPU.html#a67a0db04d321a74b7e7fcfd3f1a3f70baa694766f134e9cd81f5ad5b91dedf852">IcacheWaitResponse</a>;
<a name="l00583"></a>00583         <a class="code" href="classTimingSimpleCPU.html#a20b41c38922ef954c7e338f67bba971f">completeIfetch</a>(<a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>);
<a name="l00584"></a>00584 
<a name="l00585"></a>00585         numCycles += curCycle() - <a class="code" href="classTimingSimpleCPU.html#acb8e08ce453c8db11437d6cf9b0167bf">previousCycle</a>;
<a name="l00586"></a>00586         <a class="code" href="classTimingSimpleCPU.html#acb8e08ce453c8db11437d6cf9b0167bf">previousCycle</a> = curCycle();
<a name="l00587"></a>00587     }
<a name="l00588"></a>00588 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a36c2a28eca3086b67fc7168a37367e98"></a><!-- doxytag: member="TimingSimpleCPU::finishTranslation" ref="a36c2a28eca3086b67fc7168a37367e98" args="(WholeTranslationState *state)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void finishTranslation </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classWholeTranslationState.html">WholeTranslationState</a> *&nbsp;</td>
          <td class="paramname"> <em>state</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Finish a DTB translation. </p>
<dl><dt><b>引数:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>state</em>&nbsp;</td><td>The DTB translation state. </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l00531"></a>00531 {
<a name="l00532"></a>00532     <a class="code" href="classBaseSimpleCPU.html#a6cdf6e6db875a442f3ab6db542bd2bb5">_status</a> = <a class="code" href="classDrainable.html#a5d74787dedbc4e11c1ab15bf487e61f8a2f5f2c4a8c4f4f0519d503dcdfbf55cb">BaseSimpleCPU::Running</a>;
<a name="l00533"></a>00533 
<a name="l00534"></a>00534     <span class="keywordflow">if</span> (state-&gt;<a class="code" href="classWholeTranslationState.html#a1ac977937b0a3cf64e58ba7141e4cc11">getFault</a>() != <a class="code" href="fault__fwd_8hh.html#ab8ce3b69a6737f63fcdcf99910feb153">NoFault</a>) {
<a name="l00535"></a>00535         <span class="keywordflow">if</span> (state-&gt;<a class="code" href="classWholeTranslationState.html#a1eef1bb814a1f77346aba1648fb6d1c9">isPrefetch</a>()) {
<a name="l00536"></a>00536             state-&gt;<a class="code" href="classWholeTranslationState.html#a29ac402ee48ba100554ef01f2c8790c9">setNoFault</a>();
<a name="l00537"></a>00537         }
<a name="l00538"></a>00538         <span class="keyword">delete</span> [] state-&gt;<a class="code" href="classWholeTranslationState.html#abe222f6d3581e7920dcad5306cc906a8">data</a>;
<a name="l00539"></a>00539         state-&gt;<a class="code" href="classWholeTranslationState.html#a6dc2cbc61a85f942f081c1a136dd3585">deleteReqs</a>();
<a name="l00540"></a>00540         <a class="code" href="classTimingSimpleCPU.html#a5f6223adc354c36cc8773251dd7e0f4d">translationFault</a>(state-&gt;<a class="code" href="classWholeTranslationState.html#a1ac977937b0a3cf64e58ba7141e4cc11">getFault</a>());
<a name="l00541"></a>00541     } <span class="keywordflow">else</span> {
<a name="l00542"></a>00542         <span class="keywordflow">if</span> (!state-&gt;<a class="code" href="classWholeTranslationState.html#afd8e5886f3bd5827ade12fcaf8ea2a47">isSplit</a>) {
<a name="l00543"></a>00543             <a class="code" href="classTimingSimpleCPU.html#ad6486c2f7c95532e093a31f013b36fe5">sendData</a>(state-&gt;<a class="code" href="classWholeTranslationState.html#ae9cdcf9160e22de981af332c3f02a209">mainReq</a>, state-&gt;<a class="code" href="classWholeTranslationState.html#abe222f6d3581e7920dcad5306cc906a8">data</a>, state-&gt;<a class="code" href="classWholeTranslationState.html#afd8a8bcfa588184183684cc5a1deeb5a">res</a>,
<a name="l00544"></a>00544                      state-&gt;<a class="code" href="classWholeTranslationState.html#ae9b5adf8be89a72128708c7e621e7211">mode</a> == <a class="code" href="classBaseTLB.html#a46c8a310cf4c094f8c80e1cb8dc1f911a809abe96853e69894bbf8e5730b31348">BaseTLB::Read</a>);
<a name="l00545"></a>00545         } <span class="keywordflow">else</span> {
<a name="l00546"></a>00546             <a class="code" href="classTimingSimpleCPU.html#a0894ae25efe60dc7855c057cab1684f9">sendSplitData</a>(state-&gt;<a class="code" href="classWholeTranslationState.html#a8c06ecd03202f5de1fc60cf6194ff285">sreqLow</a>, state-&gt;<a class="code" href="classWholeTranslationState.html#a1464e1dd7de6d5752d05938f0b3bc171">sreqHigh</a>, state-&gt;<a class="code" href="classWholeTranslationState.html#ae9cdcf9160e22de981af332c3f02a209">mainReq</a>,
<a name="l00547"></a>00547                           state-&gt;<a class="code" href="classWholeTranslationState.html#abe222f6d3581e7920dcad5306cc906a8">data</a>, state-&gt;<a class="code" href="classWholeTranslationState.html#ae9b5adf8be89a72128708c7e621e7211">mode</a> == <a class="code" href="classBaseTLB.html#a46c8a310cf4c094f8c80e1cb8dc1f911a809abe96853e69894bbf8e5730b31348">BaseTLB::Read</a>);
<a name="l00548"></a>00548         }
<a name="l00549"></a>00549     }
<a name="l00550"></a>00550 
<a name="l00551"></a>00551     <span class="keyword">delete</span> state;
<a name="l00552"></a>00552 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aeea6b55ae1c4be53c21dbee434b221d4"></a><!-- doxytag: member="TimingSimpleCPU::getDataPort" ref="aeea6b55ae1c4be53c21dbee434b221d4" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual <a class="el" href="classMasterPort.html">MasterPort</a>&amp; getDataPort </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Return a reference to the data port. </p>

<p><div class="fragment"><pre class="fragment"><a name="l00259"></a>00259 { <span class="keywordflow">return</span> <a class="code" href="classTimingSimpleCPU.html#a38b03978ad7720fdc910ff6a8b44585f">dcachePort</a>; }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a40da530cb5dd380fd7fc0d786e94d5eb"></a><!-- doxytag: member="TimingSimpleCPU::getInstPort" ref="a40da530cb5dd380fd7fc0d786e94d5eb" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual <a class="el" href="classMasterPort.html">MasterPort</a>&amp; getInstPort </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Return a reference to the instruction port. </p>

<p><div class="fragment"><pre class="fragment"><a name="l00262"></a>00262 { <span class="keywordflow">return</span> <a class="code" href="classTimingSimpleCPU.html#a290723656a84b9cc90dfce377af9aad0">icachePort</a>; }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9a8beb0dcad34e8759794cea6639f715"></a><!-- doxytag: member="TimingSimpleCPU::handleReadPacket" ref="a9a8beb0dcad34e8759794cea6639f715" args="(PacketPtr pkt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool handleReadPacket </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classPacket.html">PacketPtr</a>&nbsp;</td>
          <td class="paramname"> <em>pkt</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00242"></a>00242 {
<a name="l00243"></a>00243     <a class="code" href="classRequest.html">RequestPtr</a> req = pkt-&gt;<a class="code" href="classPacket.html#a956cd41d82347558b9c0a5b0474903f2" title="A pointer to the original request.">req</a>;
<a name="l00244"></a>00244     <span class="keywordflow">if</span> (req-&gt;<a class="code" href="classRequest.html#aad621c262e009350dd86ad5715c50f7a">isMmappedIpr</a>()) {
<a name="l00245"></a>00245         <a class="code" href="classCycles.html">Cycles</a> delay = <a class="code" href="namespaceGenericISA.html#a0b95fcdc1e1fe57dbb4fcad449a6efd8">TheISA::handleIprRead</a>(<a class="code" href="classBaseSimpleCPU.html#af9572fa907cd21b54cb14bd626010d39">thread</a>-&gt;<a class="code" href="classSimpleThread.html#a81894d15db5190d5364449a4915b76f5">getTC</a>(), pkt);
<a name="l00246"></a>00246         <span class="keyword">new</span> IprEvent(pkt, <span class="keyword">this</span>, clockEdge(delay));
<a name="l00247"></a>00247         <a class="code" href="classBaseSimpleCPU.html#a6cdf6e6db875a442f3ab6db542bd2bb5">_status</a> = <a class="code" href="classBaseSimpleCPU.html#a67a0db04d321a74b7e7fcfd3f1a3f70ba62a98c3fd8f706eefc06ffbf0e657c7b">DcacheWaitResponse</a>;
<a name="l00248"></a>00248         <a class="code" href="classTimingSimpleCPU.html#a8cdf6dfb358a155d5422c09f961297fe">dcache_pkt</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00249"></a>00249     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="classTimingSimpleCPU.html#a38b03978ad7720fdc910ff6a8b44585f">dcachePort</a>.<a class="code" href="classMasterPort.html#aafaf979005392447714384794f1a8610">sendTimingReq</a>(pkt)) {
<a name="l00250"></a>00250         <a class="code" href="classBaseSimpleCPU.html#a6cdf6e6db875a442f3ab6db542bd2bb5">_status</a> = <a class="code" href="classBaseSimpleCPU.html#a67a0db04d321a74b7e7fcfd3f1a3f70ba0faf54129de01a1d6f0ba1c929e0fa40">DcacheRetry</a>;
<a name="l00251"></a>00251         <a class="code" href="classTimingSimpleCPU.html#a8cdf6dfb358a155d5422c09f961297fe">dcache_pkt</a> = pkt;
<a name="l00252"></a>00252     } <span class="keywordflow">else</span> {
<a name="l00253"></a>00253         <a class="code" href="classBaseSimpleCPU.html#a6cdf6e6db875a442f3ab6db542bd2bb5">_status</a> = <a class="code" href="classBaseSimpleCPU.html#a67a0db04d321a74b7e7fcfd3f1a3f70ba62a98c3fd8f706eefc06ffbf0e657c7b">DcacheWaitResponse</a>;
<a name="l00254"></a>00254         <span class="comment">// memory system takes ownership of packet</span>
<a name="l00255"></a>00255         <a class="code" href="classTimingSimpleCPU.html#a8cdf6dfb358a155d5422c09f961297fe">dcache_pkt</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00256"></a>00256     }
<a name="l00257"></a>00257     <span class="keywordflow">return</span> <a class="code" href="classTimingSimpleCPU.html#a8cdf6dfb358a155d5422c09f961297fe">dcache_pkt</a> == <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00258"></a>00258 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8d70b3b102cd0f4949ae31e84ee2eb98"></a><!-- doxytag: member="TimingSimpleCPU::handleWritePacket" ref="a8d70b3b102cd0f4949ae31e84ee2eb98" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool handleWritePacket </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00453"></a>00453 {
<a name="l00454"></a>00454     <a class="code" href="classRequest.html">RequestPtr</a> req = <a class="code" href="classTimingSimpleCPU.html#a8cdf6dfb358a155d5422c09f961297fe">dcache_pkt</a>-&gt;<a class="code" href="classPacket.html#a956cd41d82347558b9c0a5b0474903f2" title="A pointer to the original request.">req</a>;
<a name="l00455"></a>00455     <span class="keywordflow">if</span> (req-&gt;<a class="code" href="classRequest.html#aad621c262e009350dd86ad5715c50f7a">isMmappedIpr</a>()) {
<a name="l00456"></a>00456         <a class="code" href="classCycles.html">Cycles</a> delay = <a class="code" href="namespaceGenericISA.html#a31c83a2af3232333d9a399a2878dc729">TheISA::handleIprWrite</a>(<a class="code" href="classBaseSimpleCPU.html#af9572fa907cd21b54cb14bd626010d39">thread</a>-&gt;<a class="code" href="classSimpleThread.html#a81894d15db5190d5364449a4915b76f5">getTC</a>(), <a class="code" href="classTimingSimpleCPU.html#a8cdf6dfb358a155d5422c09f961297fe">dcache_pkt</a>);
<a name="l00457"></a>00457         <span class="keyword">new</span> IprEvent(<a class="code" href="classTimingSimpleCPU.html#a8cdf6dfb358a155d5422c09f961297fe">dcache_pkt</a>, <span class="keyword">this</span>, clockEdge(delay));
<a name="l00458"></a>00458         <a class="code" href="classBaseSimpleCPU.html#a6cdf6e6db875a442f3ab6db542bd2bb5">_status</a> = <a class="code" href="classBaseSimpleCPU.html#a67a0db04d321a74b7e7fcfd3f1a3f70ba62a98c3fd8f706eefc06ffbf0e657c7b">DcacheWaitResponse</a>;
<a name="l00459"></a>00459         <a class="code" href="classTimingSimpleCPU.html#a8cdf6dfb358a155d5422c09f961297fe">dcache_pkt</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00460"></a>00460     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="classTimingSimpleCPU.html#a38b03978ad7720fdc910ff6a8b44585f">dcachePort</a>.<a class="code" href="classMasterPort.html#aafaf979005392447714384794f1a8610">sendTimingReq</a>(<a class="code" href="classTimingSimpleCPU.html#a8cdf6dfb358a155d5422c09f961297fe">dcache_pkt</a>)) {
<a name="l00461"></a>00461         <a class="code" href="classBaseSimpleCPU.html#a6cdf6e6db875a442f3ab6db542bd2bb5">_status</a> = <a class="code" href="classBaseSimpleCPU.html#a67a0db04d321a74b7e7fcfd3f1a3f70ba0faf54129de01a1d6f0ba1c929e0fa40">DcacheRetry</a>;
<a name="l00462"></a>00462     } <span class="keywordflow">else</span> {
<a name="l00463"></a>00463         <a class="code" href="classBaseSimpleCPU.html#a6cdf6e6db875a442f3ab6db542bd2bb5">_status</a> = <a class="code" href="classBaseSimpleCPU.html#a67a0db04d321a74b7e7fcfd3f1a3f70ba62a98c3fd8f706eefc06ffbf0e657c7b">DcacheWaitResponse</a>;
<a name="l00464"></a>00464         <span class="comment">// memory system takes ownership of packet</span>
<a name="l00465"></a>00465         <a class="code" href="classTimingSimpleCPU.html#a8cdf6dfb358a155d5422c09f961297fe">dcache_pkt</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00466"></a>00466     }
<a name="l00467"></a>00467     <span class="keywordflow">return</span> <a class="code" href="classTimingSimpleCPU.html#a8cdf6dfb358a155d5422c09f961297fe">dcache_pkt</a> == <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00468"></a>00468 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a02fd73d861ef2e4aabb38c0c9ff82947"></a><!-- doxytag: member="TimingSimpleCPU::init" ref="a02fd73d861ef2e4aabb38c0c9ff82947" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void init </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00066"></a>00066 {
<a name="l00067"></a>00067     <a class="code" href="classSimObject.html#a02fd73d861ef2e4aabb38c0c9ff82947">BaseCPU::init</a>();
<a name="l00068"></a>00068 
<a name="l00069"></a>00069     <span class="comment">// Initialise the ThreadContext&apos;s memory proxies</span>
<a name="l00070"></a>00070     <a class="code" href="classBaseSimpleCPU.html#ad33756f3e96ee445dca8d69b1dd8709c">tcBase</a>()-&gt;<a class="code" href="classThreadContext.html#a6657d03bdea324a6ada2e4450307262c">initMemProxies</a>(<a class="code" href="classBaseSimpleCPU.html#ad33756f3e96ee445dca8d69b1dd8709c">tcBase</a>());
<a name="l00071"></a>00071 
<a name="l00072"></a>00072     <span class="keywordflow">if</span> (<a class="code" href="full__system_8hh.html#af929576af6f85c8849704b66d04b8370">FullSystem</a> &amp;&amp; !params()-&gt;<a class="code" href="classBaseCPU.html#a121f751814e1a758b12f22303623a3f2">switched_out</a>) {
<a name="l00073"></a>00073         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> = 0; <a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a> &lt; threadContexts.size(); ++<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>) {
<a name="l00074"></a>00074             <a class="code" href="classThreadContext.html">ThreadContext</a> *<a class="code" href="classBaseSimpleCPU.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a> = threadContexts[<a class="code" href="namespaceArmISA.html#aca8175497376fbb9f0e71fefa122cef7">i</a>];
<a name="l00075"></a>00075             <span class="comment">// initialize CPU, including PC</span>
<a name="l00076"></a>00076             <a class="code" href="namespaceAlphaISA.html#aded557a1e716c6f849b0e0b05fc77676">TheISA::initCPU</a>(tc, _cpuId);
<a name="l00077"></a>00077         }
<a name="l00078"></a>00078     }
<a name="l00079"></a>00079 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac166e5bc3ddf730beb1282cf821096ae"></a><!-- doxytag: member="TimingSimpleCPU::isDrained" ref="ac166e5bc3ddf730beb1282cf821096ae" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool isDrained </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p><a class="el" href="classCheck.html">Check</a> if a system is in a drained state.</p>
<p>We need to drain if: </p>
<ul>
<li>
<p class="startli">We are in the middle of a microcode sequence as some CPUs (e.g., HW accelerated CPUs) can't be started in the middle of a gem5 microcode sequence.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Stay at PC is true.</p>
<p class="endli"></p>
</li>
<li>
A fetch event is scheduled. Normally this would never be the case with <a class="el" href="classBaseSimpleCPU.html#a1a21696f33a7d38f251687ae0b5e9718">microPC()</a> == 0, but right after a context is activated it can happen. </li>
</ul>

<p><div class="fragment"><pre class="fragment"><a name="l00337"></a>00337                      {
<a name="l00338"></a>00338         <span class="keywordflow">return</span> <a class="code" href="classBaseSimpleCPU.html#a1a21696f33a7d38f251687ae0b5e9718">microPC</a>() == 0 &amp;&amp; !<a class="code" href="classBaseSimpleCPU.html#ae91a837c03d66c9c15de3da2fc76e811">stayAtPC</a> &amp;&amp; !<a class="code" href="classTimingSimpleCPU.html#a17e7c383c8fb3d4dc450d79c15dd1061">fetchEvent</a>.<a class="code" href="classEvent.html#a9cd69a6b10cb037550943f177a0da688" title="Determine if the current event is scheduled.">scheduled</a>();
<a name="l00339"></a>00339     }
</pre></div></p>

</div>
</div>
<a class="anchor" id="add8df091bd836cf92c6987990d130b83"></a><!-- doxytag: member="TimingSimpleCPU::isSquashed" ref="add8df091bd836cf92c6987990d130b83" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool isSquashed </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function is used by the page table walker to determine if it could translate the a pending request or if the underlying request has been squashed. This always returns false for the simple timing CPU as it never executes any instructions speculatively. @ return Is the current instruction squashed? </p>

<p><div class="fragment"><pre class="fragment"><a name="l00294"></a>00294 { <span class="keywordflow">return</span> <span class="keyword">false</span>; }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a88aa41e2693dd0091afae2604eba9bed"></a><!-- doxytag: member="TimingSimpleCPU::printAddr" ref="a88aa41e2693dd0091afae2604eba9bed" args="(Addr a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void printAddr </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a>&nbsp;</td>
          <td class="paramname"> <em>a</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Print state of address in memory system via PrintReq (for debugging). </p>

<p><div class="fragment"><pre class="fragment"><a name="l00926"></a>00926 {
<a name="l00927"></a>00927     <a class="code" href="classTimingSimpleCPU.html#a38b03978ad7720fdc910ff6a8b44585f">dcachePort</a>.<a class="code" href="classMasterPort.html#a88aa41e2693dd0091afae2604eba9bed">printAddr</a>(<a class="code" href="namespaceArmISA.html#a468da4d7330577ee8746df2acfa40959">a</a>);
<a name="l00928"></a>00928 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a66191b2d8a45050b7df3c3efa7bb07c6"></a><!-- doxytag: member="TimingSimpleCPU::readMem" ref="a66191b2d8a45050b7df3c3efa7bb07c6" args="(Addr addr, uint8_t *data, unsigned size, unsigned flags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classRefCountingPtr.html">Fault</a> readMem </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a>&nbsp;</td>
          <td class="paramname"> <em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned&nbsp;</td>
          <td class="paramname"> <em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned&nbsp;</td>
          <td class="paramname"> <em>flags</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00404"></a>00404 {
<a name="l00405"></a>00405     <a class="code" href="classRefCountingPtr.html">Fault</a> fault;
<a name="l00406"></a>00406     <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="namespaceArmISA.html#a92720268bdaf1e0e53fc66152af0ff18">asid</a> = 0;
<a name="l00407"></a>00407     <span class="keyword">const</span> <a class="code" href="base_2types_8hh.html#ab39b1a4f9dad884694c7a74ed69e6a6b">ThreadID</a> tid = 0;
<a name="l00408"></a>00408     <span class="keyword">const</span> <a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a> <a class="code" href="inorder__dyn__inst_8cc.html#a0c864f905330c0fe3ecc683b7bf8b793">pc</a> = <a class="code" href="classBaseSimpleCPU.html#af9572fa907cd21b54cb14bd626010d39">thread</a>-&gt;<a class="code" href="classSimpleThread.html#a53c92716db281ae16ffb693c6d7803c7">instAddr</a>();
<a name="l00409"></a>00409     <span class="keywordtype">unsigned</span> block_size = cacheLineSize();
<a name="l00410"></a>00410     <a class="code" href="classBaseTLB.html#a46c8a310cf4c094f8c80e1cb8dc1f911">BaseTLB::Mode</a> <a class="code" href="namespaceArmISA.html#a5f3b9b97eb2dfa29d33e74878455f90d">mode</a> = <a class="code" href="classBaseTLB.html#a46c8a310cf4c094f8c80e1cb8dc1f911a809abe96853e69894bbf8e5730b31348">BaseTLB::Read</a>;
<a name="l00411"></a>00411 
<a name="l00412"></a>00412     <span class="keywordflow">if</span> (<a class="code" href="classBaseSimpleCPU.html#acbcf6d90551f8d3a598a70caae74d1ef">traceData</a>) {
<a name="l00413"></a>00413         <a class="code" href="classBaseSimpleCPU.html#acbcf6d90551f8d3a598a70caae74d1ef">traceData</a>-&gt;<a class="code" href="classTrace_1_1InstRecord.html#a0086c298c7423d3f7e571e9f63a1c09f">setAddr</a>(<a class="code" href="namespaceX86ISA.html#ab705917f60c5566f9ce56a93f798b2e2">addr</a>);
<a name="l00414"></a>00414     }
<a name="l00415"></a>00415 
<a name="l00416"></a>00416     <a class="code" href="classRequest.html">RequestPtr</a> req  = <span class="keyword">new</span> <a class="code" href="classRequest.html">Request</a>(asid, <a class="code" href="namespaceX86ISA.html#ab705917f60c5566f9ce56a93f798b2e2">addr</a>, size,
<a name="l00417"></a>00417                                   <a class="code" href="namespacem5_1_1debug.html#a9ceb38153d5c0f156fbeada6dc00ff4f">flags</a>, dataMasterId(), pc, _cpuId, tid);
<a name="l00418"></a>00418 
<a name="l00419"></a>00419     req-&gt;<a class="code" href="classRequest.html#a7abf15d67b3fbd53236fde58eecb3f34">taskId</a>(taskId());
<a name="l00420"></a>00420 
<a name="l00421"></a>00421     <a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a> split_addr = <a class="code" href="intmath_8hh.html#a343c19b0ae885d5f3c7960987096e9d5">roundDown</a>(<a class="code" href="namespaceX86ISA.html#ab705917f60c5566f9ce56a93f798b2e2">addr</a> + size - 1, block_size);
<a name="l00422"></a>00422     assert(split_addr &lt;= <a class="code" href="namespaceX86ISA.html#ab705917f60c5566f9ce56a93f798b2e2">addr</a> || split_addr - <a class="code" href="namespaceX86ISA.html#ab705917f60c5566f9ce56a93f798b2e2">addr</a> &lt; block_size);
<a name="l00423"></a>00423 
<a name="l00424"></a>00424     <a class="code" href="classBaseSimpleCPU.html#a6cdf6e6db875a442f3ab6db542bd2bb5">_status</a> = <a class="code" href="classBaseSimpleCPU.html#a67a0db04d321a74b7e7fcfd3f1a3f70baa9c3fe4ed9cc00350965e1fc87f2353c">DTBWaitResponse</a>;
<a name="l00425"></a>00425     <span class="keywordflow">if</span> (split_addr &gt; <a class="code" href="namespaceX86ISA.html#ab705917f60c5566f9ce56a93f798b2e2">addr</a>) {
<a name="l00426"></a>00426         <a class="code" href="classRequest.html">RequestPtr</a> req1, req2;
<a name="l00427"></a>00427         assert(!req-&gt;<a class="code" href="classRequest.html#a8965874e960faf91ad4b6af8dbf31875">isLLSC</a>() &amp;&amp; !req-&gt;<a class="code" href="classRequest.html#a6ec455c5a36403d3a8319bcfbf356bc1">isSwap</a>());
<a name="l00428"></a>00428         req-&gt;<a class="code" href="classRequest.html#ae170370b8e735017a61a913b767f0d9d">splitOnVaddr</a>(split_addr, req1, req2);
<a name="l00429"></a>00429 
<a name="l00430"></a>00430         <a class="code" href="classWholeTranslationState.html">WholeTranslationState</a> *state =
<a name="l00431"></a>00431             <span class="keyword">new</span> <a class="code" href="classWholeTranslationState.html">WholeTranslationState</a>(req, req1, req2, <span class="keyword">new</span> uint8_t[size],
<a name="l00432"></a>00432                                       <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>, mode);
<a name="l00433"></a>00433         <a class="code" href="classDataTranslation.html">DataTranslation&lt;TimingSimpleCPU *&gt;</a> *trans1 =
<a name="l00434"></a>00434             <span class="keyword">new</span> <a class="code" href="classDataTranslation.html">DataTranslation&lt;TimingSimpleCPU *&gt;</a>(<span class="keyword">this</span>, state, 0);
<a name="l00435"></a>00435         <a class="code" href="classDataTranslation.html">DataTranslation&lt;TimingSimpleCPU *&gt;</a> *trans2 =
<a name="l00436"></a>00436             <span class="keyword">new</span> <a class="code" href="classDataTranslation.html">DataTranslation&lt;TimingSimpleCPU *&gt;</a>(<span class="keyword">this</span>, state, 1);
<a name="l00437"></a>00437 
<a name="l00438"></a>00438         <a class="code" href="classBaseSimpleCPU.html#af9572fa907cd21b54cb14bd626010d39">thread</a>-&gt;<a class="code" href="classSimpleThread.html#ad2fd039621f87592c4b344d4f8948e78">dtb</a>-&gt;translateTiming(req1, <a class="code" href="classBaseSimpleCPU.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>, trans1, mode);
<a name="l00439"></a>00439         <a class="code" href="classBaseSimpleCPU.html#af9572fa907cd21b54cb14bd626010d39">thread</a>-&gt;<a class="code" href="classSimpleThread.html#ad2fd039621f87592c4b344d4f8948e78">dtb</a>-&gt;translateTiming(req2, <a class="code" href="classBaseSimpleCPU.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>, trans2, mode);
<a name="l00440"></a>00440     } <span class="keywordflow">else</span> {
<a name="l00441"></a>00441         <a class="code" href="classWholeTranslationState.html">WholeTranslationState</a> *state =
<a name="l00442"></a>00442             <span class="keyword">new</span> <a class="code" href="classWholeTranslationState.html">WholeTranslationState</a>(req, <span class="keyword">new</span> uint8_t[size], <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>, mode);
<a name="l00443"></a>00443         <a class="code" href="classDataTranslation.html">DataTranslation&lt;TimingSimpleCPU *&gt;</a> *translation
<a name="l00444"></a>00444             = <span class="keyword">new</span> <a class="code" href="classDataTranslation.html">DataTranslation&lt;TimingSimpleCPU *&gt;</a>(<span class="keyword">this</span>, state);
<a name="l00445"></a>00445         <a class="code" href="classBaseSimpleCPU.html#af9572fa907cd21b54cb14bd626010d39">thread</a>-&gt;<a class="code" href="classSimpleThread.html#ad2fd039621f87592c4b344d4f8948e78">dtb</a>-&gt;translateTiming(req, <a class="code" href="classBaseSimpleCPU.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>, translation, mode);
<a name="l00446"></a>00446     }
<a name="l00447"></a>00447 
<a name="l00448"></a>00448     <span class="keywordflow">return</span> <a class="code" href="fault__fwd_8hh.html#ab8ce3b69a6737f63fcdcf99910feb153">NoFault</a>;
<a name="l00449"></a>00449 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad6486c2f7c95532e093a31f013b36fe5"></a><!-- doxytag: member="TimingSimpleCPU::sendData" ref="ad6486c2f7c95532e093a31f013b36fe5" args="(RequestPtr req, uint8_t *data, uint64_t *res, bool read)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sendData </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classRequest.html">RequestPtr</a>&nbsp;</td>
          <td class="paramname"> <em>req</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t *&nbsp;</td>
          <td class="paramname"> <em>res</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>read</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00263"></a>00263 {
<a name="l00264"></a>00264     <a class="code" href="classPacket.html">PacketPtr</a> pkt;
<a name="l00265"></a>00265     <a class="code" href="classTimingSimpleCPU.html#aefe7c644107e54e9aa677838cd1a947f">buildPacket</a>(pkt, req, read);
<a name="l00266"></a>00266     pkt-&gt;<a class="code" href="classPacket.html#ae02c6b2e23b2a5b138c85fcf91fd818d">dataDynamicArray</a>&lt;uint8_t&gt;(data);
<a name="l00267"></a>00267     <span class="keywordflow">if</span> (req-&gt;<a class="code" href="classRequest.html#a8552aa8d45c9ba10449d51ac08e7d490">getFlags</a>().<a class="code" href="classFlags.html#ac976964169b81aaba1d4cbb422f559ca">isSet</a>(<a class="code" href="classRequest.html#ab305c2952b5ae966870f325f2bef006c">Request::NO_ACCESS</a>)) {
<a name="l00268"></a>00268         assert(!<a class="code" href="classTimingSimpleCPU.html#a8cdf6dfb358a155d5422c09f961297fe">dcache_pkt</a>);
<a name="l00269"></a>00269         pkt-&gt;<a class="code" href="classPacket.html#a9330bf4cbbc7e25bbfc9626182df27e5">makeResponse</a>();
<a name="l00270"></a>00270         <a class="code" href="classTimingSimpleCPU.html#a0f7f0d3412bbf494cd3d0c0f48e5fcf2">completeDataAccess</a>(pkt);
<a name="l00271"></a>00271     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (read) {
<a name="l00272"></a>00272         <a class="code" href="classTimingSimpleCPU.html#a9a8beb0dcad34e8759794cea6639f715">handleReadPacket</a>(pkt);
<a name="l00273"></a>00273     } <span class="keywordflow">else</span> {
<a name="l00274"></a>00274         <span class="keywordtype">bool</span> do_access = <span class="keyword">true</span>;  <span class="comment">// flag to suppress cache access</span>
<a name="l00275"></a>00275 
<a name="l00276"></a>00276         <span class="keywordflow">if</span> (req-&gt;<a class="code" href="classRequest.html#a8965874e960faf91ad4b6af8dbf31875">isLLSC</a>()) {
<a name="l00277"></a>00277             do_access = <a class="code" href="namespaceAlphaISA.html#a1087208351cf56657581daf8f2f918c8">TheISA::handleLockedWrite</a>(<a class="code" href="classBaseSimpleCPU.html#af9572fa907cd21b54cb14bd626010d39">thread</a>, req, <a class="code" href="classTimingSimpleCPU.html#a38b03978ad7720fdc910ff6a8b44585f">dcachePort</a>.<a class="code" href="classTimingSimpleCPU_1_1DcachePort.html#af4264b12b32db39099b579e1ed670312">cacheBlockMask</a>);
<a name="l00278"></a>00278         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (req-&gt;<a class="code" href="classRequest.html#a086ef1e55d60089d0aa0232ff797eaef">isCondSwap</a>()) {
<a name="l00279"></a>00279             assert(res);
<a name="l00280"></a>00280             req-&gt;<a class="code" href="classRequest.html#ac73800a0bae4776befb9d416e95ea6d9">setExtraData</a>(*res);
<a name="l00281"></a>00281         }
<a name="l00282"></a>00282 
<a name="l00283"></a>00283         <span class="keywordflow">if</span> (do_access) {
<a name="l00284"></a>00284             <a class="code" href="classTimingSimpleCPU.html#a8cdf6dfb358a155d5422c09f961297fe">dcache_pkt</a> = pkt;
<a name="l00285"></a>00285             <a class="code" href="classTimingSimpleCPU.html#a8d70b3b102cd0f4949ae31e84ee2eb98">handleWritePacket</a>();
<a name="l00286"></a>00286         } <span class="keywordflow">else</span> {
<a name="l00287"></a>00287             <a class="code" href="classBaseSimpleCPU.html#a6cdf6e6db875a442f3ab6db542bd2bb5">_status</a> = <a class="code" href="classBaseSimpleCPU.html#a67a0db04d321a74b7e7fcfd3f1a3f70ba62a98c3fd8f706eefc06ffbf0e657c7b">DcacheWaitResponse</a>;
<a name="l00288"></a>00288             <a class="code" href="classTimingSimpleCPU.html#a0f7f0d3412bbf494cd3d0c0f48e5fcf2">completeDataAccess</a>(pkt);
<a name="l00289"></a>00289         }
<a name="l00290"></a>00290     }
<a name="l00291"></a>00291 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9c1e81509746ac06253e334c436e1a75"></a><!-- doxytag: member="TimingSimpleCPU::sendFetch" ref="a9c1e81509746ac06253e334c436e1a75" args="(Fault fault, RequestPtr req, ThreadContext *tc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sendFetch </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classRefCountingPtr.html">Fault</a>&nbsp;</td>
          <td class="paramname"> <em>fault</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classRequest.html">RequestPtr</a>&nbsp;</td>
          <td class="paramname"> <em>req</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classThreadContext.html">ThreadContext</a> *&nbsp;</td>
          <td class="paramname"> <em>tc</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00593"></a>00593 {
<a name="l00594"></a>00594     <span class="keywordflow">if</span> (fault == <a class="code" href="fault__fwd_8hh.html#ab8ce3b69a6737f63fcdcf99910feb153">NoFault</a>) {
<a name="l00595"></a>00595         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(SimpleCPU, <span class="stringliteral">&quot;Sending fetch for addr %#x(pa: %#x)\n&quot;</span>,
<a name="l00596"></a>00596                 req-&gt;<a class="code" href="classRequest.html#a68d2230b37b30d25462093fefdd813ac">getVaddr</a>(), req-&gt;<a class="code" href="classRequest.html#a744ef11a5afe9d3651ce5f954259cb43">getPaddr</a>());
<a name="l00597"></a>00597         <a class="code" href="classTimingSimpleCPU.html#a82097539e30887f0ad11d7a218c5bcca">ifetch_pkt</a> = <span class="keyword">new</span> <a class="code" href="classPacket.html">Packet</a>(req, <a class="code" href="classMemCmd.html#a2afce0a47a93eee73a314d53e4890153a96120c772a9cb695fe62ca81ec93a53b">MemCmd::ReadReq</a>);
<a name="l00598"></a>00598         ifetch_pkt-&gt;dataStatic(&amp;<a class="code" href="classBaseSimpleCPU.html#a3fb19fcd9c09cfac7357af074b301868">inst</a>);
<a name="l00599"></a>00599         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(SimpleCPU, <span class="stringliteral">&quot; -- pkt addr: %#x\n&quot;</span>, ifetch_pkt-&gt;getAddr());
<a name="l00600"></a>00600 
<a name="l00601"></a>00601         <span class="keywordflow">if</span> (!<a class="code" href="classTimingSimpleCPU.html#a290723656a84b9cc90dfce377af9aad0">icachePort</a>.<a class="code" href="classMasterPort.html#aafaf979005392447714384794f1a8610">sendTimingReq</a>(ifetch_pkt)) {
<a name="l00602"></a>00602             <span class="comment">// Need to wait for retry</span>
<a name="l00603"></a>00603             <a class="code" href="classBaseSimpleCPU.html#a6cdf6e6db875a442f3ab6db542bd2bb5">_status</a> = <a class="code" href="classBaseSimpleCPU.html#a67a0db04d321a74b7e7fcfd3f1a3f70baad09d918aed86399df0c327ea3418b15">IcacheRetry</a>;
<a name="l00604"></a>00604         } <span class="keywordflow">else</span> {
<a name="l00605"></a>00605             <span class="comment">// Need to wait for cache to respond</span>
<a name="l00606"></a>00606             <a class="code" href="classBaseSimpleCPU.html#a6cdf6e6db875a442f3ab6db542bd2bb5">_status</a> = <a class="code" href="classBaseSimpleCPU.html#a67a0db04d321a74b7e7fcfd3f1a3f70baa694766f134e9cd81f5ad5b91dedf852">IcacheWaitResponse</a>;
<a name="l00607"></a>00607             <span class="comment">// ownership of packet transferred to memory system</span>
<a name="l00608"></a>00608             ifetch_pkt = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00609"></a>00609         }
<a name="l00610"></a>00610     } <span class="keywordflow">else</span> {
<a name="l00611"></a>00611         <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(SimpleCPU, <span class="stringliteral">&quot;Translation of addr %#x faulted\n&quot;</span>, req-&gt;<a class="code" href="classRequest.html#a68d2230b37b30d25462093fefdd813ac">getVaddr</a>());
<a name="l00612"></a>00612         <span class="keyword">delete</span> req;
<a name="l00613"></a>00613         <span class="comment">// fetch fault: advance directly to next instruction (fault handler)</span>
<a name="l00614"></a>00614         <a class="code" href="classBaseSimpleCPU.html#a6cdf6e6db875a442f3ab6db542bd2bb5">_status</a> = <a class="code" href="classDrainable.html#a5d74787dedbc4e11c1ab15bf487e61f8a2f5f2c4a8c4f4f0519d503dcdfbf55cb">BaseSimpleCPU::Running</a>;
<a name="l00615"></a>00615         <a class="code" href="classTimingSimpleCPU.html#ab1a431d7af8dd2bbc95d09bd71be13ca">advanceInst</a>(fault);
<a name="l00616"></a>00616     }
<a name="l00617"></a>00617 
<a name="l00618"></a>00618     numCycles += curCycle() - <a class="code" href="classTimingSimpleCPU.html#acb8e08ce453c8db11437d6cf9b0167bf">previousCycle</a>;
<a name="l00619"></a>00619     <a class="code" href="classTimingSimpleCPU.html#acb8e08ce453c8db11437d6cf9b0167bf">previousCycle</a> = curCycle();
<a name="l00620"></a>00620 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0894ae25efe60dc7855c057cab1684f9"></a><!-- doxytag: member="TimingSimpleCPU::sendSplitData" ref="a0894ae25efe60dc7855c057cab1684f9" args="(RequestPtr req1, RequestPtr req2, RequestPtr req, uint8_t *data, bool read)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sendSplitData </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classRequest.html">RequestPtr</a>&nbsp;</td>
          <td class="paramname"> <em>req1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classRequest.html">RequestPtr</a>&nbsp;</td>
          <td class="paramname"> <em>req2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classRequest.html">RequestPtr</a>&nbsp;</td>
          <td class="paramname"> <em>req</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>read</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00296"></a>00296 {
<a name="l00297"></a>00297     <a class="code" href="classPacket.html">PacketPtr</a> pkt1, pkt2;
<a name="l00298"></a>00298     <a class="code" href="classTimingSimpleCPU.html#a1a7d0ff7c4efb80ffd4f53439b2291f8">buildSplitPacket</a>(pkt1, pkt2, req1, req2, req, data, read);
<a name="l00299"></a>00299     <span class="keywordflow">if</span> (req-&gt;<a class="code" href="classRequest.html#a8552aa8d45c9ba10449d51ac08e7d490">getFlags</a>().<a class="code" href="classFlags.html#ac976964169b81aaba1d4cbb422f559ca">isSet</a>(<a class="code" href="classRequest.html#ab305c2952b5ae966870f325f2bef006c">Request::NO_ACCESS</a>)) {
<a name="l00300"></a>00300         assert(!<a class="code" href="classTimingSimpleCPU.html#a8cdf6dfb358a155d5422c09f961297fe">dcache_pkt</a>);
<a name="l00301"></a>00301         pkt1-&gt;<a class="code" href="classPacket.html#a9330bf4cbbc7e25bbfc9626182df27e5">makeResponse</a>();
<a name="l00302"></a>00302         <a class="code" href="classTimingSimpleCPU.html#a0f7f0d3412bbf494cd3d0c0f48e5fcf2">completeDataAccess</a>(pkt1);
<a name="l00303"></a>00303     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (read) {
<a name="l00304"></a>00304         SplitFragmentSenderState * send_state =
<a name="l00305"></a>00305             <span class="keyword">dynamic_cast&lt;</span>SplitFragmentSenderState *<span class="keyword">&gt;</span>(pkt1-&gt;<a class="code" href="classPacket.html#a983ade0479f946c813284dcc65073367">senderState</a>);
<a name="l00306"></a>00306         <span class="keywordflow">if</span> (<a class="code" href="classTimingSimpleCPU.html#a9a8beb0dcad34e8759794cea6639f715">handleReadPacket</a>(pkt1)) {
<a name="l00307"></a>00307             send_state-&gt;clearFromParent();
<a name="l00308"></a>00308             send_state = <span class="keyword">dynamic_cast&lt;</span>SplitFragmentSenderState *<span class="keyword">&gt;</span>(
<a name="l00309"></a>00309                     pkt2-&gt;<a class="code" href="classPacket.html#a983ade0479f946c813284dcc65073367">senderState</a>);
<a name="l00310"></a>00310             <span class="keywordflow">if</span> (<a class="code" href="classTimingSimpleCPU.html#a9a8beb0dcad34e8759794cea6639f715">handleReadPacket</a>(pkt2)) {
<a name="l00311"></a>00311                 send_state-&gt;clearFromParent();
<a name="l00312"></a>00312             }
<a name="l00313"></a>00313         }
<a name="l00314"></a>00314     } <span class="keywordflow">else</span> {
<a name="l00315"></a>00315         <a class="code" href="classTimingSimpleCPU.html#a8cdf6dfb358a155d5422c09f961297fe">dcache_pkt</a> = pkt1;
<a name="l00316"></a>00316         SplitFragmentSenderState * send_state =
<a name="l00317"></a>00317             <span class="keyword">dynamic_cast&lt;</span>SplitFragmentSenderState *<span class="keyword">&gt;</span>(pkt1-&gt;<a class="code" href="classPacket.html#a983ade0479f946c813284dcc65073367">senderState</a>);
<a name="l00318"></a>00318         <span class="keywordflow">if</span> (<a class="code" href="classTimingSimpleCPU.html#a8d70b3b102cd0f4949ae31e84ee2eb98">handleWritePacket</a>()) {
<a name="l00319"></a>00319             send_state-&gt;clearFromParent();
<a name="l00320"></a>00320             <a class="code" href="classTimingSimpleCPU.html#a8cdf6dfb358a155d5422c09f961297fe">dcache_pkt</a> = pkt2;
<a name="l00321"></a>00321             send_state = <span class="keyword">dynamic_cast&lt;</span>SplitFragmentSenderState *<span class="keyword">&gt;</span>(
<a name="l00322"></a>00322                     pkt2-&gt;<a class="code" href="classPacket.html#a983ade0479f946c813284dcc65073367">senderState</a>);
<a name="l00323"></a>00323             <span class="keywordflow">if</span> (<a class="code" href="classTimingSimpleCPU.html#a8d70b3b102cd0f4949ae31e84ee2eb98">handleWritePacket</a>()) {
<a name="l00324"></a>00324                 send_state-&gt;clearFromParent();
<a name="l00325"></a>00325             }
<a name="l00326"></a>00326         }
<a name="l00327"></a>00327     }
<a name="l00328"></a>00328 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1dad4c4d2c3df4ef367e14fcc973ce74"></a><!-- doxytag: member="TimingSimpleCPU::suspendContext" ref="a1dad4c4d2c3df4ef367e14fcc973ce74" args="(ThreadID thread_num)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void suspendContext </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="base_2types_8hh.html#ab39b1a4f9dad884694c7a74ed69e6a6b">ThreadID</a>&nbsp;</td>
          <td class="paramname"> <em>thread_num</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00222"></a>00222 {
<a name="l00223"></a>00223     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(SimpleCPU, <span class="stringliteral">&quot;SuspendContext %d\n&quot;</span>, thread_num);
<a name="l00224"></a>00224 
<a name="l00225"></a>00225     assert(thread_num == 0);
<a name="l00226"></a>00226     assert(<a class="code" href="classBaseSimpleCPU.html#af9572fa907cd21b54cb14bd626010d39">thread</a>);
<a name="l00227"></a>00227 
<a name="l00228"></a>00228     <span class="keywordflow">if</span> (<a class="code" href="classBaseSimpleCPU.html#a6cdf6e6db875a442f3ab6db542bd2bb5">_status</a> == <a class="code" href="classBaseSimpleCPU.html#a67a0db04d321a74b7e7fcfd3f1a3f70bad3fa9ae9431d6cb1772f9d9df48cab19">Idle</a>)
<a name="l00229"></a>00229         <span class="keywordflow">return</span>;
<a name="l00230"></a>00230 
<a name="l00231"></a>00231     assert(<a class="code" href="classBaseSimpleCPU.html#a6cdf6e6db875a442f3ab6db542bd2bb5">_status</a> == <a class="code" href="classDrainable.html#a5d74787dedbc4e11c1ab15bf487e61f8a2f5f2c4a8c4f4f0519d503dcdfbf55cb">BaseSimpleCPU::Running</a>);
<a name="l00232"></a>00232 
<a name="l00233"></a>00233     <span class="comment">// just change status to Idle... if status != Running,</span>
<a name="l00234"></a>00234     <span class="comment">// completeInst() will not initiate fetch of next instruction.</span>
<a name="l00235"></a>00235 
<a name="l00236"></a>00236     <a class="code" href="classBaseSimpleCPU.html#a40be38a691cf502b6ba46aaefd86dc77">notIdleFraction</a> = 0;
<a name="l00237"></a>00237     <a class="code" href="classBaseSimpleCPU.html#a6cdf6e6db875a442f3ab6db542bd2bb5">_status</a> = <a class="code" href="classBaseSimpleCPU.html#a67a0db04d321a74b7e7fcfd3f1a3f70bad3fa9ae9431d6cb1772f9d9df48cab19">Idle</a>;
<a name="l00238"></a>00238 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a05f299b443f8cc73a93d61572edc0218"></a><!-- doxytag: member="TimingSimpleCPU::switchOut" ref="a05f299b443f8cc73a93d61572edc0218" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void switchOut </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00173"></a>00173 {
<a name="l00174"></a>00174     <a class="code" href="classTimingSimpleCPU.html#a05f299b443f8cc73a93d61572edc0218">BaseSimpleCPU::switchOut</a>();
<a name="l00175"></a>00175 
<a name="l00176"></a>00176     assert(!<a class="code" href="classTimingSimpleCPU.html#a17e7c383c8fb3d4dc450d79c15dd1061">fetchEvent</a>.<a class="code" href="classEvent.html#a9cd69a6b10cb037550943f177a0da688" title="Determine if the current event is scheduled.">scheduled</a>());
<a name="l00177"></a>00177     assert(<a class="code" href="classBaseSimpleCPU.html#a6cdf6e6db875a442f3ab6db542bd2bb5">_status</a> == <a class="code" href="classDrainable.html#a5d74787dedbc4e11c1ab15bf487e61f8a2f5f2c4a8c4f4f0519d503dcdfbf55cb">BaseSimpleCPU::Running</a> || <a class="code" href="classBaseSimpleCPU.html#a6cdf6e6db875a442f3ab6db542bd2bb5">_status</a> == <a class="code" href="classBaseSimpleCPU.html#a67a0db04d321a74b7e7fcfd3f1a3f70bad3fa9ae9431d6cb1772f9d9df48cab19">Idle</a>);
<a name="l00178"></a>00178     assert(!<a class="code" href="classBaseSimpleCPU.html#ae91a837c03d66c9c15de3da2fc76e811">stayAtPC</a>);
<a name="l00179"></a>00179     assert(<a class="code" href="classBaseSimpleCPU.html#a1a21696f33a7d38f251687ae0b5e9718">microPC</a>() == 0);
<a name="l00180"></a>00180 
<a name="l00181"></a>00181     numCycles += curCycle() - <a class="code" href="classTimingSimpleCPU.html#acb8e08ce453c8db11437d6cf9b0167bf">previousCycle</a>;
<a name="l00182"></a>00182 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac82d2b8d331b2e8e6854a95d2917dfa2"></a><!-- doxytag: member="TimingSimpleCPU::takeOverFrom" ref="ac82d2b8d331b2e8e6854a95d2917dfa2" args="(BaseCPU *oldCPU)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void takeOverFrom </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classBaseCPU_1_1BaseCPU.html">BaseCPU</a> *&nbsp;</td>
          <td class="paramname"> <em>oldCPU</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00187"></a>00187 {
<a name="l00188"></a>00188     <a class="code" href="classBaseCPU_1_1BaseCPU.html#ab5272c636861eb61b25aa639a46cfb77">BaseSimpleCPU::takeOverFrom</a>(oldCPU);
<a name="l00189"></a>00189 
<a name="l00190"></a>00190     <a class="code" href="classTimingSimpleCPU.html#acb8e08ce453c8db11437d6cf9b0167bf">previousCycle</a> = curCycle();
<a name="l00191"></a>00191 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5f6223adc354c36cc8773251dd7e0f4d"></a><!-- doxytag: member="TimingSimpleCPU::translationFault" ref="a5f6223adc354c36cc8773251dd7e0f4d" args="(Fault fault)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void translationFault </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classRefCountingPtr.html">Fault</a>&nbsp;</td>
          <td class="paramname"> <em>fault</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00332"></a>00332 {
<a name="l00333"></a>00333     <span class="comment">// fault may be NoFault in cases where a fault is suppressed,</span>
<a name="l00334"></a>00334     <span class="comment">// for instance prefetches.</span>
<a name="l00335"></a>00335     numCycles += curCycle() - <a class="code" href="classTimingSimpleCPU.html#acb8e08ce453c8db11437d6cf9b0167bf">previousCycle</a>;
<a name="l00336"></a>00336     <a class="code" href="classTimingSimpleCPU.html#acb8e08ce453c8db11437d6cf9b0167bf">previousCycle</a> = curCycle();
<a name="l00337"></a>00337 
<a name="l00338"></a>00338     <span class="keywordflow">if</span> (<a class="code" href="classBaseSimpleCPU.html#acbcf6d90551f8d3a598a70caae74d1ef">traceData</a>) {
<a name="l00339"></a>00339         <span class="comment">// Since there was a fault, we shouldn&apos;t trace this instruction.</span>
<a name="l00340"></a>00340         <span class="keyword">delete</span> <a class="code" href="classBaseSimpleCPU.html#acbcf6d90551f8d3a598a70caae74d1ef">traceData</a>;
<a name="l00341"></a>00341         <a class="code" href="classBaseSimpleCPU.html#acbcf6d90551f8d3a598a70caae74d1ef">traceData</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00342"></a>00342     }
<a name="l00343"></a>00343 
<a name="l00344"></a>00344     <a class="code" href="classBaseSimpleCPU.html#a86cfcf0bbf35e6f79ccf03bd9436f633">postExecute</a>();
<a name="l00345"></a>00345 
<a name="l00346"></a>00346     <a class="code" href="classTimingSimpleCPU.html#ab1a431d7af8dd2bbc95d09bd71be13ca">advanceInst</a>(fault);
<a name="l00347"></a>00347 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="abfea8f75a7a7480716801affeebbe87b"></a><!-- doxytag: member="TimingSimpleCPU::tryCompleteDrain" ref="abfea8f75a7a7480716801affeebbe87b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool tryCompleteDrain </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Try to complete a drain request.</p>
<dl class="return"><dt><b>戻り値:</b></dt><dd>true if the CPU is drained, false otherwise. </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00156"></a>00156 {
<a name="l00157"></a>00157     <span class="keywordflow">if</span> (!<a class="code" href="classTimingSimpleCPU.html#a329b71fb934a93312ca0aacbf5a3f982">drainManager</a>)
<a name="l00158"></a>00158         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00159"></a>00159 
<a name="l00160"></a>00160     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Drain, <span class="stringliteral">&quot;tryCompleteDrain: %s\n&quot;</span>, <a class="code" href="classBaseSimpleCPU.html#a827fb3454585cf4c620f4fd341966317">pcState</a>());
<a name="l00161"></a>00161     <span class="keywordflow">if</span> (!<a class="code" href="classTimingSimpleCPU.html#ac166e5bc3ddf730beb1282cf821096ae">isDrained</a>())
<a name="l00162"></a>00162         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00163"></a>00163 
<a name="l00164"></a>00164     <a class="code" href="trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Drain, <span class="stringliteral">&quot;CPU done draining, processing drain event\n&quot;</span>);
<a name="l00165"></a>00165     <a class="code" href="classTimingSimpleCPU.html#a329b71fb934a93312ca0aacbf5a3f982">drainManager</a>-&gt;<a class="code" href="classDrainManager.html#ab89d10e368d2e82061eddb9e40022382">signalDrainDone</a>();
<a name="l00166"></a>00166     <a class="code" href="classTimingSimpleCPU.html#a329b71fb934a93312ca0aacbf5a3f982">drainManager</a> = <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>;
<a name="l00167"></a>00167 
<a name="l00168"></a>00168     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00169"></a>00169 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae2e1ccebe596a180f8105d57f9a93645"></a><!-- doxytag: member="TimingSimpleCPU::verifyMemoryMode" ref="ae2e1ccebe596a180f8105d57f9a93645" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void verifyMemoryMode </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td> const</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00195"></a>00195 {
<a name="l00196"></a>00196     <span class="keywordflow">if</span> (!<a class="code" href="classBaseCPU.html#ab737471139f5a296e5b26e8a0e1b0744" title="initialize section">system</a>-&gt;isTimingMode()) {
<a name="l00197"></a>00197         <a class="code" href="base_2misc_8hh.html#acad519418dbfdd70c1208711e609c80e">fatal</a>(<span class="stringliteral">&quot;The timing CPU requires the memory system to be in &quot;</span>
<a name="l00198"></a>00198               <span class="stringliteral">&quot;&apos;timing&apos; mode.\n&quot;</span>);
<a name="l00199"></a>00199     }
<a name="l00200"></a>00200 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad46c5edeb1ee9b60445f3e26364e2c5e"></a><!-- doxytag: member="TimingSimpleCPU::writeMem" ref="ad46c5edeb1ee9b60445f3e26364e2c5e" args="(uint8_t *data, unsigned size, Addr addr, unsigned flags, uint64_t *res)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classRefCountingPtr.html">Fault</a> writeMem </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned&nbsp;</td>
          <td class="paramname"> <em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a>&nbsp;</td>
          <td class="paramname"> <em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned&nbsp;</td>
          <td class="paramname"> <em>flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t *&nbsp;</td>
          <td class="paramname"> <em>res</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00473"></a>00473 {
<a name="l00474"></a>00474     uint8_t *newData = <span class="keyword">new</span> uint8_t[size];
<a name="l00475"></a>00475     <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="namespaceArmISA.html#a92720268bdaf1e0e53fc66152af0ff18">asid</a> = 0;
<a name="l00476"></a>00476     <span class="keyword">const</span> <a class="code" href="base_2types_8hh.html#ab39b1a4f9dad884694c7a74ed69e6a6b">ThreadID</a> tid = 0;
<a name="l00477"></a>00477     <span class="keyword">const</span> <a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a> <a class="code" href="inorder__dyn__inst_8cc.html#a0c864f905330c0fe3ecc683b7bf8b793">pc</a> = <a class="code" href="classBaseSimpleCPU.html#af9572fa907cd21b54cb14bd626010d39">thread</a>-&gt;<a class="code" href="classSimpleThread.html#a53c92716db281ae16ffb693c6d7803c7">instAddr</a>();
<a name="l00478"></a>00478     <span class="keywordtype">unsigned</span> block_size = cacheLineSize();
<a name="l00479"></a>00479     <a class="code" href="classBaseTLB.html#a46c8a310cf4c094f8c80e1cb8dc1f911">BaseTLB::Mode</a> <a class="code" href="namespaceArmISA.html#a5f3b9b97eb2dfa29d33e74878455f90d">mode</a> = <a class="code" href="classBaseTLB.html#a46c8a310cf4c094f8c80e1cb8dc1f911aa56670174817e3fed92bfd8182d7c0d1">BaseTLB::Write</a>;
<a name="l00480"></a>00480 
<a name="l00481"></a>00481     <span class="keywordflow">if</span> (data == <a class="code" href="namespacem5_1_1params.html#a1e2e219ac4e913a2c59019be3094d3ca">NULL</a>) {
<a name="l00482"></a>00482         assert(<a class="code" href="namespacem5_1_1debug.html#a9ceb38153d5c0f156fbeada6dc00ff4f">flags</a> &amp; <a class="code" href="classRequest.html#a4c22f8a3275a06b136b28f633beeee03">Request::CACHE_BLOCK_ZERO</a>);
<a name="l00483"></a>00483         <span class="comment">// This must be a cache block cleaning request</span>
<a name="l00484"></a>00484         memset(newData, 0, size);
<a name="l00485"></a>00485     } <span class="keywordflow">else</span> {
<a name="l00486"></a>00486         memcpy(newData, data, size);
<a name="l00487"></a>00487     }
<a name="l00488"></a>00488 
<a name="l00489"></a>00489     <span class="keywordflow">if</span> (<a class="code" href="classBaseSimpleCPU.html#acbcf6d90551f8d3a598a70caae74d1ef">traceData</a>) {
<a name="l00490"></a>00490         <a class="code" href="classBaseSimpleCPU.html#acbcf6d90551f8d3a598a70caae74d1ef">traceData</a>-&gt;<a class="code" href="classTrace_1_1InstRecord.html#a0086c298c7423d3f7e571e9f63a1c09f">setAddr</a>(<a class="code" href="namespaceX86ISA.html#ab705917f60c5566f9ce56a93f798b2e2">addr</a>);
<a name="l00491"></a>00491     }
<a name="l00492"></a>00492 
<a name="l00493"></a>00493     <a class="code" href="classRequest.html">RequestPtr</a> req = <span class="keyword">new</span> <a class="code" href="classRequest.html">Request</a>(asid, <a class="code" href="namespaceX86ISA.html#ab705917f60c5566f9ce56a93f798b2e2">addr</a>, size,
<a name="l00494"></a>00494                                  <a class="code" href="namespacem5_1_1debug.html#a9ceb38153d5c0f156fbeada6dc00ff4f">flags</a>, dataMasterId(), pc, _cpuId, tid);
<a name="l00495"></a>00495 
<a name="l00496"></a>00496     req-&gt;<a class="code" href="classRequest.html#a7abf15d67b3fbd53236fde58eecb3f34">taskId</a>(taskId());
<a name="l00497"></a>00497 
<a name="l00498"></a>00498     <a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a> split_addr = <a class="code" href="intmath_8hh.html#a343c19b0ae885d5f3c7960987096e9d5">roundDown</a>(<a class="code" href="namespaceX86ISA.html#ab705917f60c5566f9ce56a93f798b2e2">addr</a> + size - 1, block_size);
<a name="l00499"></a>00499     assert(split_addr &lt;= <a class="code" href="namespaceX86ISA.html#ab705917f60c5566f9ce56a93f798b2e2">addr</a> || split_addr - <a class="code" href="namespaceX86ISA.html#ab705917f60c5566f9ce56a93f798b2e2">addr</a> &lt; block_size);
<a name="l00500"></a>00500 
<a name="l00501"></a>00501     <a class="code" href="classBaseSimpleCPU.html#a6cdf6e6db875a442f3ab6db542bd2bb5">_status</a> = <a class="code" href="classBaseSimpleCPU.html#a67a0db04d321a74b7e7fcfd3f1a3f70baa9c3fe4ed9cc00350965e1fc87f2353c">DTBWaitResponse</a>;
<a name="l00502"></a>00502     <span class="keywordflow">if</span> (split_addr &gt; <a class="code" href="namespaceX86ISA.html#ab705917f60c5566f9ce56a93f798b2e2">addr</a>) {
<a name="l00503"></a>00503         <a class="code" href="classRequest.html">RequestPtr</a> req1, req2;
<a name="l00504"></a>00504         assert(!req-&gt;<a class="code" href="classRequest.html#a8965874e960faf91ad4b6af8dbf31875">isLLSC</a>() &amp;&amp; !req-&gt;<a class="code" href="classRequest.html#a6ec455c5a36403d3a8319bcfbf356bc1">isSwap</a>());
<a name="l00505"></a>00505         req-&gt;<a class="code" href="classRequest.html#ae170370b8e735017a61a913b767f0d9d">splitOnVaddr</a>(split_addr, req1, req2);
<a name="l00506"></a>00506 
<a name="l00507"></a>00507         <a class="code" href="classWholeTranslationState.html">WholeTranslationState</a> *state =
<a name="l00508"></a>00508             <span class="keyword">new</span> <a class="code" href="classWholeTranslationState.html">WholeTranslationState</a>(req, req1, req2, newData, res, mode);
<a name="l00509"></a>00509         <a class="code" href="classDataTranslation.html">DataTranslation&lt;TimingSimpleCPU *&gt;</a> *trans1 =
<a name="l00510"></a>00510             <span class="keyword">new</span> <a class="code" href="classDataTranslation.html">DataTranslation&lt;TimingSimpleCPU *&gt;</a>(<span class="keyword">this</span>, state, 0);
<a name="l00511"></a>00511         <a class="code" href="classDataTranslation.html">DataTranslation&lt;TimingSimpleCPU *&gt;</a> *trans2 =
<a name="l00512"></a>00512             <span class="keyword">new</span> <a class="code" href="classDataTranslation.html">DataTranslation&lt;TimingSimpleCPU *&gt;</a>(<span class="keyword">this</span>, state, 1);
<a name="l00513"></a>00513 
<a name="l00514"></a>00514         <a class="code" href="classBaseSimpleCPU.html#af9572fa907cd21b54cb14bd626010d39">thread</a>-&gt;<a class="code" href="classSimpleThread.html#ad2fd039621f87592c4b344d4f8948e78">dtb</a>-&gt;translateTiming(req1, <a class="code" href="classBaseSimpleCPU.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>, trans1, mode);
<a name="l00515"></a>00515         <a class="code" href="classBaseSimpleCPU.html#af9572fa907cd21b54cb14bd626010d39">thread</a>-&gt;<a class="code" href="classSimpleThread.html#ad2fd039621f87592c4b344d4f8948e78">dtb</a>-&gt;translateTiming(req2, <a class="code" href="classBaseSimpleCPU.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>, trans2, mode);
<a name="l00516"></a>00516     } <span class="keywordflow">else</span> {
<a name="l00517"></a>00517         <a class="code" href="classWholeTranslationState.html">WholeTranslationState</a> *state =
<a name="l00518"></a>00518             <span class="keyword">new</span> <a class="code" href="classWholeTranslationState.html">WholeTranslationState</a>(req, newData, res, mode);
<a name="l00519"></a>00519         <a class="code" href="classDataTranslation.html">DataTranslation&lt;TimingSimpleCPU *&gt;</a> *translation =
<a name="l00520"></a>00520             <span class="keyword">new</span> <a class="code" href="classDataTranslation.html">DataTranslation&lt;TimingSimpleCPU *&gt;</a>(<span class="keyword">this</span>, state);
<a name="l00521"></a>00521         <a class="code" href="classBaseSimpleCPU.html#af9572fa907cd21b54cb14bd626010d39">thread</a>-&gt;<a class="code" href="classSimpleThread.html#ad2fd039621f87592c4b344d4f8948e78">dtb</a>-&gt;translateTiming(req, <a class="code" href="classBaseSimpleCPU.html#a4455a4759e69e5ebe68ae7298cbcc37d">tc</a>, translation, mode);
<a name="l00522"></a>00522     }
<a name="l00523"></a>00523 
<a name="l00524"></a>00524     <span class="comment">// Translation faults will be returned via finishTranslation()</span>
<a name="l00525"></a>00525     <span class="keywordflow">return</span> <a class="code" href="fault__fwd_8hh.html#ab8ce3b69a6737f63fcdcf99910feb153">NoFault</a>;
<a name="l00526"></a>00526 }
</pre></div></p>

</div>
</div>
<hr/><h2>変数</h2>
<a class="anchor" id="a8cdf6dfb358a155d5422c09f961297fe"></a><!-- doxytag: member="TimingSimpleCPU::dcache_pkt" ref="a8cdf6dfb358a155d5422c09f961297fe" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classPacket.html">PacketPtr</a> <a class="el" href="classTimingSimpleCPU.html#a8cdf6dfb358a155d5422c09f961297fe">dcache_pkt</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a38b03978ad7720fdc910ff6a8b44585f"></a><!-- doxytag: member="TimingSimpleCPU::dcachePort" ref="a38b03978ad7720fdc910ff6a8b44585f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classTimingSimpleCPU_1_1DcachePort.html">DcachePort</a> <a class="el" href="classTimingSimpleCPU.html#a38b03978ad7720fdc910ff6a8b44585f">dcachePort</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a329b71fb934a93312ca0aacbf5a3f982"></a><!-- doxytag: member="TimingSimpleCPU::drainManager" ref="a329b71fb934a93312ca0aacbf5a3f982" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classDrainManager.html">DrainManager</a>* <a class="el" href="classTimingSimpleCPU.html#a329b71fb934a93312ca0aacbf5a3f982">drainManager</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Drain manager to use when signaling drain completion</p>
<p>This pointer is non-NULL when draining and NULL otherwise. </p>

</div>
</div>
<a class="anchor" id="a17e7c383c8fb3d4dc450d79c15dd1061"></a><!-- doxytag: member="TimingSimpleCPU::fetchEvent" ref="a17e7c383c8fb3d4dc450d79c15dd1061" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classEventWrapper.html">FetchEvent</a> <a class="el" href="classTimingSimpleCPU.html#a17e7c383c8fb3d4dc450d79c15dd1061">fetchEvent</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="abc9a320383d8f8241113fe01f333d5ca"></a><!-- doxytag: member="TimingSimpleCPU::fetchTranslation" ref="abc9a320383d8f8241113fe01f333d5ca" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classTimingSimpleCPU_1_1FetchTranslation.html">FetchTranslation</a> <a class="el" href="classTimingSimpleCPU.html#abc9a320383d8f8241113fe01f333d5ca">fetchTranslation</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a290723656a84b9cc90dfce377af9aad0"></a><!-- doxytag: member="TimingSimpleCPU::icachePort" ref="a290723656a84b9cc90dfce377af9aad0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classTimingSimpleCPU_1_1IcachePort.html">IcachePort</a> <a class="el" href="classTimingSimpleCPU.html#a290723656a84b9cc90dfce377af9aad0">icachePort</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a82097539e30887f0ad11d7a218c5bcca"></a><!-- doxytag: member="TimingSimpleCPU::ifetch_pkt" ref="a82097539e30887f0ad11d7a218c5bcca" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classPacket.html">PacketPtr</a> <a class="el" href="classTimingSimpleCPU.html#a82097539e30887f0ad11d7a218c5bcca">ifetch_pkt</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="acb8e08ce453c8db11437d6cf9b0167bf"></a><!-- doxytag: member="TimingSimpleCPU::previousCycle" ref="acb8e08ce453c8db11437d6cf9b0167bf" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> <a class="el" href="classTimingSimpleCPU.html#acb8e08ce453c8db11437d6cf9b0167bf">previousCycle</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/>このクラスの説明は次のファイルから生成されました:<ul>
<li>cpu/simple/<a class="el" href="timing_8hh_source.html">timing.hh</a></li>
<li>cpu/simple/<a class="el" href="timing_8cc.html">timing.cc</a></li>
</ul>
</div>
<hr size="1"/><address style="text-align: right;"><small>File&nbsp;GEM5&nbsp;Wrapperに対して25 May 2015に生成されました。&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
