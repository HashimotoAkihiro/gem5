\hypertarget{classPerfKvmCounter}{
\section{クラス PerfKvmCounter}
\label{classPerfKvmCounter}\index{PerfKvmCounter@{PerfKvmCounter}}
}


{\ttfamily \#include $<$perfevent.hh$>$}\subsection*{Public メソッド}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classPerfKvmCounter_a3efef81d1d840ff948b8fd501310c981}{PerfKvmCounter} (\hyperlink{classPerfKvmCounterConfig}{PerfKvmCounterConfig} \&config, pid\_\-t tid)
\item 
\hyperlink{classPerfKvmCounter_a6e10b934e1d000c59742d748b42824bd}{PerfKvmCounter} (\hyperlink{classPerfKvmCounterConfig}{PerfKvmCounterConfig} \&config, pid\_\-t tid, const \hyperlink{classPerfKvmCounter}{PerfKvmCounter} \&parent)
\item 
\hyperlink{classPerfKvmCounter_a48fc3925e8430dcead140f4c27a1e4ce}{PerfKvmCounter} ()
\item 
\hyperlink{classPerfKvmCounter_afadd01640b4cbc3b749f702d60e7a04b}{$\sim$PerfKvmCounter} ()
\item 
void \hyperlink{classPerfKvmCounter_a162e5b205959ecba29def7e7e0bf92dd}{attach} (\hyperlink{classPerfKvmCounterConfig}{PerfKvmCounterConfig} \&config, pid\_\-t tid)
\item 
void \hyperlink{classPerfKvmCounter_aff7cff5a84dcc4e3155c42b9b3f35574}{attach} (\hyperlink{classPerfKvmCounterConfig}{PerfKvmCounterConfig} \&config, pid\_\-t tid, const \hyperlink{classPerfKvmCounter}{PerfKvmCounter} \&parent)
\item 
void \hyperlink{classPerfKvmCounter_ac295bade8aee589f6718dfa79edc2a34}{detach} ()
\item 
bool \hyperlink{classPerfKvmCounter_aa828991b44e099ad372a7833c34d3e24}{attached} () const 
\item 
void \hyperlink{classPerfKvmCounter_a60de64d75454385b23995437f1d72669}{start} ()
\item 
void \hyperlink{classPerfKvmCounter_a8c528baf37154d347366083f0f816846}{stop} ()
\item 
void \hyperlink{classPerfKvmCounter_a08ec1e452f32c7b0e573d63f126a2bbf}{period} (uint64\_\-t period)
\item 
void \hyperlink{classPerfKvmCounter_a6af1a045627841dd5b66f15c28cb48e7}{refresh} (int refresh)
\item 
uint64\_\-t \hyperlink{classPerfKvmCounter_af2c9c37fc5a5bcdac6d97825066ce801}{read} () const 
\item 
void \hyperlink{classPerfKvmCounter_adcb1192220b2f38f9e05b5c8a0f3ab30}{enableSignals} (pid\_\-t tid, int signal)
\item 
void \hyperlink{classPerfKvmCounter_ab176640bca1358eda4cd412c3be7d746}{enableSignals} (int signal)
\end{DoxyCompactItemize}
\subsection*{Private メソッド}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classPerfKvmCounter_a68c89e9e7ce1cbe5b5b7111307f16b61}{PerfKvmCounter} (const \hyperlink{classPerfKvmCounter}{PerfKvmCounter} \&that)
\item 
\hyperlink{classPerfKvmCounter}{PerfKvmCounter} \& \hyperlink{classPerfKvmCounter_a11a80ba1c558b286f8459d8bbe60fe3f}{operator=} (const \hyperlink{classPerfKvmCounter}{PerfKvmCounter} \&that)
\item 
void \hyperlink{classPerfKvmCounter_a82b3eaa20dc8f83c4ea69352954c2e7d}{attach} (\hyperlink{classPerfKvmCounterConfig}{PerfKvmCounterConfig} \&config, pid\_\-t tid, int group\_\-fd)
\item 
pid\_\-t \hyperlink{classPerfKvmCounter_af0449193b7cded86e600f052d0aabd39}{gettid} ()
\item 
void \hyperlink{classPerfKvmCounter_a32358ddbb202e0319d138e8cb3749ed9}{mmapPerf} (int pages)
\item 
void \hyperlink{classPerfKvmCounter_a382308644478e0220390350cc53c1a4a}{read} (void $\ast$buf, size\_\-t size) const 
\end{DoxyCompactItemize}
\begin{Indent}{\bf }\par
{\em \label{_amgrpd41d8cd98f00b204e9800998ecf8427e}
 }\begin{DoxyCompactItemize}
\item 
int \hyperlink{classPerfKvmCounter_a59e734a4d9a204be38f0af7d82091648}{fcntl} (int cmd, long p1)
\item 
int \hyperlink{classPerfKvmCounter_a801e1d8b832b7d2ea829411655d3d001}{fcntl} (int cmd, void $\ast$p1)
\item 
int \hyperlink{classPerfKvmCounter_a5b8772915b1f8991ad9f3f9afcd681b8}{ioctl} (int request, long p1)
\item 
int \hyperlink{classPerfKvmCounter_aa59d1d5b429119949c0a1e386cb760e4}{ioctl} (int request, void $\ast$p1)
\item 
int \hyperlink{classPerfKvmCounter_af07e229bfb88ad702cdbc617b3b46578}{ioctl} (int request)
\end{DoxyCompactItemize}
\end{Indent}
\subsection*{Private 変数}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{classPerfKvmCounter_a6f8059414f0228f0256115e024eeed4b}{fd}
\item 
struct perf\_\-event\_\-mmap\_\-page $\ast$ \hyperlink{classPerfKvmCounter_ab87c9aa7bfe943c16292c643bf6ceb58}{ringBuffer}
\item 
int \hyperlink{classPerfKvmCounter_ab445fb16e36d61f54c9c6ca0a9d8c8db}{ringNumPages}
\item 
long \hyperlink{classPerfKvmCounter_a055d35409d0ddd7689a36c45a8d9b89b}{pageSize}
\end{DoxyCompactItemize}


\subsection{説明}
An instance of a performance counter. 

\subsection{コンストラクタとデストラクタ}
\hypertarget{classPerfKvmCounter_a3efef81d1d840ff948b8fd501310c981}{
\index{PerfKvmCounter@{PerfKvmCounter}!PerfKvmCounter@{PerfKvmCounter}}
\index{PerfKvmCounter@{PerfKvmCounter}!PerfKvmCounter@{PerfKvmCounter}}
\subsubsection[{PerfKvmCounter}]{\setlength{\rightskip}{0pt plus 5cm}{\bf PerfKvmCounter} ({\bf PerfKvmCounterConfig} \& {\em config}, \/  pid\_\-t {\em tid})}}
\label{classPerfKvmCounter_a3efef81d1d840ff948b8fd501310c981}
Create and attach a new counter group.


\begin{DoxyParams}{引数}
\item[{\em config}]Counter configuration \item[{\em tid}]Thread to sample (0 indicates current thread) \end{DoxyParams}



\begin{DoxyCode}
71     : fd(-1), ringBuffer(NULL), pageSize(-1)
72 {
73     attach(config, tid, -1);
74 }
\end{DoxyCode}
\hypertarget{classPerfKvmCounter_a6e10b934e1d000c59742d748b42824bd}{
\index{PerfKvmCounter@{PerfKvmCounter}!PerfKvmCounter@{PerfKvmCounter}}
\index{PerfKvmCounter@{PerfKvmCounter}!PerfKvmCounter@{PerfKvmCounter}}
\subsubsection[{PerfKvmCounter}]{\setlength{\rightskip}{0pt plus 5cm}{\bf PerfKvmCounter} ({\bf PerfKvmCounterConfig} \& {\em config}, \/  pid\_\-t {\em tid}, \/  const {\bf PerfKvmCounter} \& {\em parent})}}
\label{classPerfKvmCounter_a6e10b934e1d000c59742d748b42824bd}
Create and attach a new counter and make it a member of an exist counter group.


\begin{DoxyParams}{引数}
\item[{\em config}]Counter configuration \item[{\em tid}]Thread to sample (0 indicates current thread) \item[{\em parent}]Group leader \end{DoxyParams}



\begin{DoxyCode}
78     : fd(-1), ringBuffer(NULL), pageSize(-1)
79 {
80     attach(config, tid, parent);
81 }
\end{DoxyCode}
\hypertarget{classPerfKvmCounter_a48fc3925e8430dcead140f4c27a1e4ce}{
\index{PerfKvmCounter@{PerfKvmCounter}!PerfKvmCounter@{PerfKvmCounter}}
\index{PerfKvmCounter@{PerfKvmCounter}!PerfKvmCounter@{PerfKvmCounter}}
\subsubsection[{PerfKvmCounter}]{\setlength{\rightskip}{0pt plus 5cm}{\bf PerfKvmCounter} ()}}
\label{classPerfKvmCounter_a48fc3925e8430dcead140f4c27a1e4ce}
Create a new counter, but don't attach it. 


\begin{DoxyCode}
84     : fd(-1), ringBuffer(NULL), pageSize(-1)
85 {
86 }
\end{DoxyCode}
\hypertarget{classPerfKvmCounter_afadd01640b4cbc3b749f702d60e7a04b}{
\index{PerfKvmCounter@{PerfKvmCounter}!$\sim$PerfKvmCounter@{$\sim$PerfKvmCounter}}
\index{$\sim$PerfKvmCounter@{$\sim$PerfKvmCounter}!PerfKvmCounter@{PerfKvmCounter}}
\subsubsection[{$\sim$PerfKvmCounter}]{\setlength{\rightskip}{0pt plus 5cm}$\sim${\bf PerfKvmCounter} ()}}
\label{classPerfKvmCounter_afadd01640b4cbc3b749f702d60e7a04b}



\begin{DoxyCode}
89 {
90     if (attached())
91         detach();
92 }
\end{DoxyCode}
\hypertarget{classPerfKvmCounter_a68c89e9e7ce1cbe5b5b7111307f16b61}{
\index{PerfKvmCounter@{PerfKvmCounter}!PerfKvmCounter@{PerfKvmCounter}}
\index{PerfKvmCounter@{PerfKvmCounter}!PerfKvmCounter@{PerfKvmCounter}}
\subsubsection[{PerfKvmCounter}]{\setlength{\rightskip}{0pt plus 5cm}{\bf PerfKvmCounter} (const {\bf PerfKvmCounter} \& {\em that})\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classPerfKvmCounter_a68c89e9e7ce1cbe5b5b7111307f16b61}


\subsection{関数}
\hypertarget{classPerfKvmCounter_a82b3eaa20dc8f83c4ea69352954c2e7d}{
\index{PerfKvmCounter@{PerfKvmCounter}!attach@{attach}}
\index{attach@{attach}!PerfKvmCounter@{PerfKvmCounter}}
\subsubsection[{attach}]{\setlength{\rightskip}{0pt plus 5cm}void attach ({\bf PerfKvmCounterConfig} \& {\em config}, \/  pid\_\-t {\em tid}, \/  int {\em group\_\-fd})\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classPerfKvmCounter_a82b3eaa20dc8f83c4ea69352954c2e7d}



\begin{DoxyCode}
163 {
164     assert(!attached());
165 
166     fd = syscall(__NR_perf_event_open,
167                  &config.attr, tid,
168                  -1, // CPU (-1 => Any CPU that the task happens to run on)
169                  group_fd,
170                  0); // Flags
171     if (fd == -1)
172         panic("PerfKvmCounter::open failed (%i)\n", errno);
173 
174     mmapPerf(1);
175 }
\end{DoxyCode}
\hypertarget{classPerfKvmCounter_aff7cff5a84dcc4e3155c42b9b3f35574}{
\index{PerfKvmCounter@{PerfKvmCounter}!attach@{attach}}
\index{attach@{attach}!PerfKvmCounter@{PerfKvmCounter}}
\subsubsection[{attach}]{\setlength{\rightskip}{0pt plus 5cm}void attach ({\bf PerfKvmCounterConfig} \& {\em config}, \/  pid\_\-t {\em tid}, \/  const {\bf PerfKvmCounter} \& {\em parent})\hspace{0.3cm}{\ttfamily  \mbox{[}inline\mbox{]}}}}
\label{classPerfKvmCounter_aff7cff5a84dcc4e3155c42b9b3f35574}
Attach a counter and make it a member of an existing counter group.

\begin{DoxyNote}{覚え書き}
This operation is only supported if the counter isn't already attached.
\end{DoxyNote}

\begin{DoxyParams}{引数}
\item[{\em config}]Counter configuration \item[{\em tid}]Thread to sample (0 indicates current thread) \item[{\em parent}]Group leader \end{DoxyParams}



\begin{DoxyCode}
222                                                          {
223         attach(config, tid, parent.fd);
224     }
\end{DoxyCode}
\hypertarget{classPerfKvmCounter_a162e5b205959ecba29def7e7e0bf92dd}{
\index{PerfKvmCounter@{PerfKvmCounter}!attach@{attach}}
\index{attach@{attach}!PerfKvmCounter@{PerfKvmCounter}}
\subsubsection[{attach}]{\setlength{\rightskip}{0pt plus 5cm}void attach ({\bf PerfKvmCounterConfig} \& {\em config}, \/  pid\_\-t {\em tid})\hspace{0.3cm}{\ttfamily  \mbox{[}inline\mbox{]}}}}
\label{classPerfKvmCounter_a162e5b205959ecba29def7e7e0bf92dd}
Attach a counter.

\begin{DoxyNote}{覚え書き}
This operation is only supported if the counter isn't already attached.
\end{DoxyNote}

\begin{DoxyParams}{引数}
\item[{\em config}]Counter configuration \item[{\em tid}]Thread to sample (0 indicates current thread) \end{DoxyParams}



\begin{DoxyCode}
206                                                          {
207         attach(config, tid, -1);
208     }
\end{DoxyCode}
\hypertarget{classPerfKvmCounter_aa828991b44e099ad372a7833c34d3e24}{
\index{PerfKvmCounter@{PerfKvmCounter}!attached@{attached}}
\index{attached@{attached}!PerfKvmCounter@{PerfKvmCounter}}
\subsubsection[{attached}]{\setlength{\rightskip}{0pt plus 5cm}bool attached () const\hspace{0.3cm}{\ttfamily  \mbox{[}inline\mbox{]}}}}
\label{classPerfKvmCounter_aa828991b44e099ad372a7833c34d3e24}
\hyperlink{classCheck}{Check} if a counter is attached. 


\begin{DoxyCode}
230 { return fd != -1; }
\end{DoxyCode}
\hypertarget{classPerfKvmCounter_ac295bade8aee589f6718dfa79edc2a34}{
\index{PerfKvmCounter@{PerfKvmCounter}!detach@{detach}}
\index{detach@{detach}!PerfKvmCounter@{PerfKvmCounter}}
\subsubsection[{detach}]{\setlength{\rightskip}{0pt plus 5cm}void detach ()}}
\label{classPerfKvmCounter_ac295bade8aee589f6718dfa79edc2a34}
Detach a counter from PerfEvent. 


\begin{DoxyCode}
96 {
97     assert(attached());
98 
99     if (munmap(ringBuffer, ringNumPages * pageSize) == -1)
100         warn("PerfKvmCounter: Failed to unmap ring buffer (%i)\n",
101              errno);
102     close(fd);
103 
104     fd = -1;
105     ringBuffer = NULL;
106 }
\end{DoxyCode}
\hypertarget{classPerfKvmCounter_ab176640bca1358eda4cd412c3be7d746}{
\index{PerfKvmCounter@{PerfKvmCounter}!enableSignals@{enableSignals}}
\index{enableSignals@{enableSignals}!PerfKvmCounter@{PerfKvmCounter}}
\subsubsection[{enableSignals}]{\setlength{\rightskip}{0pt plus 5cm}void enableSignals (int {\em signal})\hspace{0.3cm}{\ttfamily  \mbox{[}inline\mbox{]}}}}
\label{classPerfKvmCounter_ab176640bca1358eda4cd412c3be7d746}
Enable signal delivery on counter overflow. Identical to enableSignals(pid\_\-t) when called with the current TID as its parameter.


\begin{DoxyParams}{引数}
\item[{\em signal}]Signal to send upon overflow \end{DoxyParams}



\begin{DoxyCode}
300 { enableSignals(gettid(), signal); }
\end{DoxyCode}
\hypertarget{classPerfKvmCounter_adcb1192220b2f38f9e05b5c8a0f3ab30}{
\index{PerfKvmCounter@{PerfKvmCounter}!enableSignals@{enableSignals}}
\index{enableSignals@{enableSignals}!PerfKvmCounter@{PerfKvmCounter}}
\subsubsection[{enableSignals}]{\setlength{\rightskip}{0pt plus 5cm}void enableSignals (pid\_\-t {\em tid}, \/  int {\em signal})}}
\label{classPerfKvmCounter_adcb1192220b2f38f9e05b5c8a0f3ab30}
Enable signal delivery to a thread on counter overflow.


\begin{DoxyParams}{引数}
\item[{\em tid}]Thread to deliver signal to \item[{\em signal}]Signal to send upon overflow \end{DoxyParams}



\begin{DoxyCode}
147 {
148     struct f_owner_ex sigowner;
149 
150     sigowner.type = F_OWNER_TID;
151     sigowner.pid = tid;
152 
153     if (fcntl(F_SETOWN_EX, &sigowner) == -1 ||
154         fcntl(F_SETSIG, signal) == -1 ||
155         fcntl(F_SETFL, O_ASYNC) == -1)
156         panic("PerfKvmCounter: Failed to enable signals for counter (%i)\n",
157               errno);
158 }
\end{DoxyCode}
\hypertarget{classPerfKvmCounter_a801e1d8b832b7d2ea829411655d3d001}{
\index{PerfKvmCounter@{PerfKvmCounter}!fcntl@{fcntl}}
\index{fcntl@{fcntl}!PerfKvmCounter@{PerfKvmCounter}}
\subsubsection[{fcntl}]{\setlength{\rightskip}{0pt plus 5cm}int fcntl (int {\em cmd}, \/  void $\ast$ {\em p1})\hspace{0.3cm}{\ttfamily  \mbox{[}inline, private\mbox{]}}}}
\label{classPerfKvmCounter_a801e1d8b832b7d2ea829411655d3d001}



\begin{DoxyCode}
342 { return fcntl(cmd, (long)p1); }
\end{DoxyCode}
\hypertarget{classPerfKvmCounter_a59e734a4d9a204be38f0af7d82091648}{
\index{PerfKvmCounter@{PerfKvmCounter}!fcntl@{fcntl}}
\index{fcntl@{fcntl}!PerfKvmCounter@{PerfKvmCounter}}
\subsubsection[{fcntl}]{\setlength{\rightskip}{0pt plus 5cm}int fcntl (int {\em cmd}, \/  long {\em p1})\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classPerfKvmCounter_a59e734a4d9a204be38f0af7d82091648}
PerfEvent fnctl interface.


\begin{DoxyParams}{引数}
\item[{\em cmd}]fcntl command \item[{\em p1}]\hyperlink{classRequest}{Request} parameter\end{DoxyParams}
\begin{DoxyReturn}{戻り値}
-\/1 on error (error number in errno), ioctl dependent value otherwise. 
\end{DoxyReturn}



\begin{DoxyCode}
208 {
209     assert(attached());
210     return ::fcntl(fd, cmd, p1);
211 }
\end{DoxyCode}
\hypertarget{classPerfKvmCounter_af0449193b7cded86e600f052d0aabd39}{
\index{PerfKvmCounter@{PerfKvmCounter}!gettid@{gettid}}
\index{gettid@{gettid}!PerfKvmCounter@{PerfKvmCounter}}
\subsubsection[{gettid}]{\setlength{\rightskip}{0pt plus 5cm}pid\_\-t gettid ()\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classPerfKvmCounter_af0449193b7cded86e600f052d0aabd39}
Get the TID of the current thread.

\begin{DoxyReturn}{戻り値}
Current thread's TID 
\end{DoxyReturn}



\begin{DoxyCode}
179 {
180     return syscall(__NR_gettid);
181 }
\end{DoxyCode}
\hypertarget{classPerfKvmCounter_af07e229bfb88ad702cdbc617b3b46578}{
\index{PerfKvmCounter@{PerfKvmCounter}!ioctl@{ioctl}}
\index{ioctl@{ioctl}!PerfKvmCounter@{PerfKvmCounter}}
\subsubsection[{ioctl}]{\setlength{\rightskip}{0pt plus 5cm}int ioctl (int {\em request})\hspace{0.3cm}{\ttfamily  \mbox{[}inline, private\mbox{]}}}}
\label{classPerfKvmCounter_af07e229bfb88ad702cdbc617b3b46578}



\begin{DoxyCode}
357 { return ioctl(request, 0L); }
\end{DoxyCode}
\hypertarget{classPerfKvmCounter_aa59d1d5b429119949c0a1e386cb760e4}{
\index{PerfKvmCounter@{PerfKvmCounter}!ioctl@{ioctl}}
\index{ioctl@{ioctl}!PerfKvmCounter@{PerfKvmCounter}}
\subsubsection[{ioctl}]{\setlength{\rightskip}{0pt plus 5cm}int ioctl (int {\em request}, \/  void $\ast$ {\em p1})\hspace{0.3cm}{\ttfamily  \mbox{[}inline, private\mbox{]}}}}
\label{classPerfKvmCounter_aa59d1d5b429119949c0a1e386cb760e4}



\begin{DoxyCode}
356 { return ioctl(request, (long)p1); }
\end{DoxyCode}
\hypertarget{classPerfKvmCounter_a5b8772915b1f8991ad9f3f9afcd681b8}{
\index{PerfKvmCounter@{PerfKvmCounter}!ioctl@{ioctl}}
\index{ioctl@{ioctl}!PerfKvmCounter@{PerfKvmCounter}}
\subsubsection[{ioctl}]{\setlength{\rightskip}{0pt plus 5cm}int ioctl (int {\em request}, \/  long {\em p1})\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classPerfKvmCounter_a5b8772915b1f8991ad9f3f9afcd681b8}
PerfEvent ioctl interface.


\begin{DoxyParams}{引数}
\item[{\em request}]PerfEvent request \item[{\em p1}]Optional request parameter\end{DoxyParams}
\begin{DoxyReturn}{戻り値}
-\/1 on error (error number in errno), ioctl dependent value otherwise. 
\end{DoxyReturn}



\begin{DoxyCode}
215 {
216     assert(attached());
217     return ::ioctl(fd, request, p1);
218 }
\end{DoxyCode}
\hypertarget{classPerfKvmCounter_a32358ddbb202e0319d138e8cb3749ed9}{
\index{PerfKvmCounter@{PerfKvmCounter}!mmapPerf@{mmapPerf}}
\index{mmapPerf@{mmapPerf}!PerfKvmCounter@{PerfKvmCounter}}
\subsubsection[{mmapPerf}]{\setlength{\rightskip}{0pt plus 5cm}void mmapPerf (int {\em pages})\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classPerfKvmCounter_a32358ddbb202e0319d138e8cb3749ed9}
MMAP the PerfEvent file descriptor.

\begin{DoxyNote}{覚え書き}
We currently don't use the ring buffer, but PerfEvent requires this to be mapped for overflow handling to work.

Overflow handling requires at least one buf\_\-page to be mapped.
\end{DoxyNote}

\begin{DoxyParams}{引数}
\item[{\em pages}]number of pages in circular sample buffer. Must be an even power of 2. \end{DoxyParams}



\begin{DoxyCode}
185 {
186     assert(attached());
187     assert(ringBuffer == NULL);
188 
189     if (pageSize == -1) {
190         pageSize = sysconf(_SC_PAGE_SIZE);
191         if (pageSize == -1)
192             panic("PerfKvmCounter: Failed to determine page size (%i)\n",
193                   errno);
194     }
195 
196     ringNumPages = pages + 1;
197     ringBuffer = (struct perf_event_mmap_page *)mmap(
198         NULL, ringNumPages * 4096,
199         PROT_READ | PROT_WRITE, MAP_SHARED,
200         fd, 0);
201     if (ringBuffer == MAP_FAILED)
202         panic("PerfKvmCounter: MMAP failed (%i)\n",
203               errno);
204 }
\end{DoxyCode}
\hypertarget{classPerfKvmCounter_a11a80ba1c558b286f8459d8bbe60fe3f}{
\index{PerfKvmCounter@{PerfKvmCounter}!operator=@{operator=}}
\index{operator=@{operator=}!PerfKvmCounter@{PerfKvmCounter}}
\subsubsection[{operator=}]{\setlength{\rightskip}{0pt plus 5cm}{\bf PerfKvmCounter}\& operator= (const {\bf PerfKvmCounter} \& {\em that})\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classPerfKvmCounter_a11a80ba1c558b286f8459d8bbe60fe3f}
\hypertarget{classPerfKvmCounter_a08ec1e452f32c7b0e573d63f126a2bbf}{
\index{PerfKvmCounter@{PerfKvmCounter}!period@{period}}
\index{period@{period}!PerfKvmCounter@{PerfKvmCounter}}
\subsubsection[{period}]{\setlength{\rightskip}{0pt plus 5cm}void period (uint64\_\-t {\em period})}}
\label{classPerfKvmCounter_a08ec1e452f32c7b0e573d63f126a2bbf}
Update the period of an overflow counter.

\begin{DoxyWarning}{警告}
This ioctl has some pretty bizarre semantics. It seems like the new period isn't effective until after the next counter overflow. If you use this method to change the sample period, you will see one sample with the old period and then start sampling with the new period. This problem was fixed for ARM in version 3.7 of the kernel.

This method doesn't work at all on some 2.6.3x kernels since it has inverted check for the return value when copying parameters from userspace.
\end{DoxyWarning}

\begin{DoxyParams}{引数}
\item[{\em period}]Overflow period in events \end{DoxyParams}



\begin{DoxyCode}
124 {
125     if (ioctl(PERF_EVENT_IOC_PERIOD, &period) == -1)
126         panic("KVM: Failed to set period of performance counter (%i)\n", errno);
127 }
\end{DoxyCode}
\hypertarget{classPerfKvmCounter_a382308644478e0220390350cc53c1a4a}{
\index{PerfKvmCounter@{PerfKvmCounter}!read@{read}}
\index{read@{read}!PerfKvmCounter@{PerfKvmCounter}}
\subsubsection[{read}]{\setlength{\rightskip}{0pt plus 5cm}void read (void $\ast$ {\em buf}, \/  size\_\-t {\em size}) const\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classPerfKvmCounter_a382308644478e0220390350cc53c1a4a}
Perform a read from the counter file descriptor.


\begin{DoxyParams}{引数}
\item[{\em buf}]Destination buffer \item[{\em size}]Amount of data to read \end{DoxyParams}



\begin{DoxyCode}
222 {
223     char *_buf = (char *)buf;
224     size_t _size = size;
225 
226     assert(attached());
227 
228     do {
229         ssize_t ret;
230         ret = ::read(fd, _buf, _size);
231         switch (ret) {
232           case -1:
233             if (errno != EAGAIN)
234                 panic("PerfKvmCounter::read failed (%i)\n", errno);
235             break;
236 
237           case 0:
238             panic("PerfKvmCounter::read unexpected EOF.\n");
239 
240           default:
241             _size -= ret;
242             _buf += ret;
243             break;
244         }
245     } while(_size);
246 }
\end{DoxyCode}
\hypertarget{classPerfKvmCounter_af2c9c37fc5a5bcdac6d97825066ce801}{
\index{PerfKvmCounter@{PerfKvmCounter}!read@{read}}
\index{read@{read}!PerfKvmCounter@{PerfKvmCounter}}
\subsubsection[{read}]{\setlength{\rightskip}{0pt plus 5cm}uint64\_\-t read () const}}
\label{classPerfKvmCounter_af2c9c37fc5a5bcdac6d97825066ce801}
Read the current value of a counter. 


\begin{DoxyCode}
138 {
139     uint64_t value;
140 
141     read(&value, sizeof(uint64_t));
142     return value;
143 }
\end{DoxyCode}
\hypertarget{classPerfKvmCounter_a6af1a045627841dd5b66f15c28cb48e7}{
\index{PerfKvmCounter@{PerfKvmCounter}!refresh@{refresh}}
\index{refresh@{refresh}!PerfKvmCounter@{PerfKvmCounter}}
\subsubsection[{refresh}]{\setlength{\rightskip}{0pt plus 5cm}void refresh (int {\em refresh})}}
\label{classPerfKvmCounter_a6af1a045627841dd5b66f15c28cb48e7}
Enable a counter for a fixed number of events.

When this method is called, perf event enables the counter if it was disabled. It then leaves the counter enabled until it has overflowed a refresh times.

\begin{DoxyNote}{覚え書き}
This does not update the period of the counter.
\end{DoxyNote}

\begin{DoxyParams}{引数}
\item[{\em refresh}]Number of overflows before disabling the counter. \end{DoxyParams}



\begin{DoxyCode}
131 {
132     if (ioctl(PERF_EVENT_IOC_REFRESH, refresh) == -1)
133         panic("KVM: Failed to refresh performance counter (%i)\n", errno);
134 }
\end{DoxyCode}
\hypertarget{classPerfKvmCounter_a60de64d75454385b23995437f1d72669}{
\index{PerfKvmCounter@{PerfKvmCounter}!start@{start}}
\index{start@{start}!PerfKvmCounter@{PerfKvmCounter}}
\subsubsection[{start}]{\setlength{\rightskip}{0pt plus 5cm}void start ()}}
\label{classPerfKvmCounter_a60de64d75454385b23995437f1d72669}
Start counting.

\begin{DoxyNote}{覚え書き}
If this counter is a group leader, it will start the entire group. 
\end{DoxyNote}



\begin{DoxyCode}
110 {
111     if (ioctl(PERF_EVENT_IOC_ENABLE, PERF_IOC_FLAG_GROUP) == -1)
112         panic("KVM: Failed to enable performance counters (%i)\n", errno);
113 }
\end{DoxyCode}
\hypertarget{classPerfKvmCounter_a8c528baf37154d347366083f0f816846}{
\index{PerfKvmCounter@{PerfKvmCounter}!stop@{stop}}
\index{stop@{stop}!PerfKvmCounter@{PerfKvmCounter}}
\subsubsection[{stop}]{\setlength{\rightskip}{0pt plus 5cm}void stop ()}}
\label{classPerfKvmCounter_a8c528baf37154d347366083f0f816846}
Stop counting.

\begin{DoxyNote}{覚え書き}
If this counter is a group leader, it will stop the entire group. 
\end{DoxyNote}



\begin{DoxyCode}
117 {
118     if (ioctl(PERF_EVENT_IOC_DISABLE, PERF_IOC_FLAG_GROUP) == -1)
119         panic("KVM: Failed to disable performance counters (%i)\n", errno);
120 }
\end{DoxyCode}


\subsection{変数}
\hypertarget{classPerfKvmCounter_a6f8059414f0228f0256115e024eeed4b}{
\index{PerfKvmCounter@{PerfKvmCounter}!fd@{fd}}
\index{fd@{fd}!PerfKvmCounter@{PerfKvmCounter}}
\subsubsection[{fd}]{\setlength{\rightskip}{0pt plus 5cm}int {\bf fd}\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classPerfKvmCounter_a6f8059414f0228f0256115e024eeed4b}
PerfEvent file descriptor associated with counter. -\/1 if not attached to PerfEvent. \hypertarget{classPerfKvmCounter_a055d35409d0ddd7689a36c45a8d9b89b}{
\index{PerfKvmCounter@{PerfKvmCounter}!pageSize@{pageSize}}
\index{pageSize@{pageSize}!PerfKvmCounter@{PerfKvmCounter}}
\subsubsection[{pageSize}]{\setlength{\rightskip}{0pt plus 5cm}long {\bf pageSize}\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classPerfKvmCounter_a055d35409d0ddd7689a36c45a8d9b89b}
Cached host page size \hypertarget{classPerfKvmCounter_ab87c9aa7bfe943c16292c643bf6ceb58}{
\index{PerfKvmCounter@{PerfKvmCounter}!ringBuffer@{ringBuffer}}
\index{ringBuffer@{ringBuffer}!PerfKvmCounter@{PerfKvmCounter}}
\subsubsection[{ringBuffer}]{\setlength{\rightskip}{0pt plus 5cm}struct perf\_\-event\_\-mmap\_\-page$\ast$ {\bf ringBuffer}\hspace{0.3cm}{\ttfamily  \mbox{[}read, private\mbox{]}}}}
\label{classPerfKvmCounter_ab87c9aa7bfe943c16292c643bf6ceb58}
Memory mapped PerfEvent sample ring buffer \hypertarget{classPerfKvmCounter_ab445fb16e36d61f54c9c6ca0a9d8c8db}{
\index{PerfKvmCounter@{PerfKvmCounter}!ringNumPages@{ringNumPages}}
\index{ringNumPages@{ringNumPages}!PerfKvmCounter@{PerfKvmCounter}}
\subsubsection[{ringNumPages}]{\setlength{\rightskip}{0pt plus 5cm}int {\bf ringNumPages}\hspace{0.3cm}{\ttfamily  \mbox{[}private\mbox{]}}}}
\label{classPerfKvmCounter_ab445fb16e36d61f54c9c6ca0a9d8c8db}
Total number of pages in ring buffer 

このクラスの説明は次のファイルから生成されました:\begin{DoxyCompactItemize}
\item 
cpu/kvm/\hyperlink{perfevent_8hh}{perfevent.hh}\item 
cpu/kvm/\hyperlink{perfevent_8cc}{perfevent.cc}\end{DoxyCompactItemize}
