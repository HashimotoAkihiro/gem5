<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>File&nbsp;GEM5&nbsp;Wrapper: ネームスペース m5::util::dot_writer</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- 作成： Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>メインページ</span></a></li>
      <li><a href="pages.html"><span>関連ページ</span></a></li>
      <li><a href="modules.html"><span>モジュール</span></a></li>
      <li class="current"><a href="namespaces.html"><span>ネームスペース</span></a></li>
      <li><a href="annotated.html"><span>クラス</span></a></li>
      <li><a href="files.html"><span>ファイル</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="namespaces.html"><span>ネームスペース一覧</span></a></li>
      <li><a href="namespacemembers.html"><span>ネームスペースメンバ</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="namespacem5.html">m5</a>::<a class="el" href="namespacem5_1_1util.html">util</a>::<a class="el" href="namespacem5_1_1util_1_1dot__writer.html">dot_writer</a>
  </div>
</div>
<div class="contents">
<h1>ネームスペース m5::util::dot_writer</h1><table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>構成</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classm5_1_1util_1_1dot__writer_1_1NodeType.html">NodeType</a></td></tr>
<tr><td colspan="2"><h2>関数</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">def&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacem5_1_1util_1_1dot__writer.html#add31984cb8657529c3421202a51a7dc0">dot_create_nodes</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">def&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacem5_1_1util_1_1dot__writer.html#a6f29e1e4547e1ba7ec5fe675dfb1a079">dot_create_edges</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">def&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacem5_1_1util_1_1dot__writer.html#a1fff52253a51b807eca402644554e628">dot_add_edge</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">def&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacem5_1_1util_1_1dot__writer.html#a2444e15cbf160c23ba843c38960063b5">dot_create_cluster</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">def&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacem5_1_1util_1_1dot__writer.html#ad6620c2cbb99013162bcbc566c5b0378">dot_create_node</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">def&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacem5_1_1util_1_1dot__writer.html#a498b4029e58b118de7ca1b994d70234c">get_node_type</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">def&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacem5_1_1util_1_1dot__writer.html#a7bba31405ed25bdf7a33744c7e90b502">get_type_colour</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">def&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacem5_1_1util_1_1dot__writer.html#a61d8e0385c2049fd69ddf1bc7b944b7d">dot_gen_colour</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">def&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacem5_1_1util_1_1dot__writer.html#a7583ad2189f2e3cdd087d9d5e62ce1af">dot_rgb_to_html</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">def&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacem5_1_1util_1_1dot__writer.html#ae1c22e483b943c09e1d17ebc09c4b5f2">do_dot</a></td></tr>
<tr><td colspan="2"><h2>変数</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacem5_1_1util_1_1dot__writer.html#a31241ceacc46b6932a85d676d5a4ab8a">pydot</a> = False</td></tr>
</table>
<hr/><h2>関数</h2>
<a class="anchor" id="ae1c22e483b943c09e1d17ebc09c4b5f2"></a><!-- doxytag: member="m5::util::dot_writer::do_dot" ref="ae1c22e483b943c09e1d17ebc09c4b5f2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def m5::util::dot_writer::do_dot </td>
          <td>(</td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname"> <em>root</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname"> <em>outdir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname"> <em>dotFilename</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00259"></a><a class="code" href="namespacem5_1_1util_1_1dot__writer.html#ae1c22e483b943c09e1d17ebc09c4b5f2">00259</a>                                      :
<a name="l00260"></a>00260     <span class="keywordflow">if</span> <span class="keywordflow">not</span> pydot:
<a name="l00261"></a>00261         <span class="keywordflow">return</span>
<a name="l00262"></a>00262     <span class="comment"># * use ranksep &gt; 1.0 for for vertical separation between nodes</span>
<a name="l00263"></a>00263     <span class="comment"># especially useful if you need to annotate edges using e.g. visio</span>
<a name="l00264"></a>00264     <span class="comment"># which accepts svg format</span>
<a name="l00265"></a>00265     <span class="comment"># * no need for hoizontal separation as nothing moves horizonally</span>
<a name="l00266"></a>00266     callgraph = pydot.Dot(graph_type=<span class="stringliteral">&apos;digraph&apos;</span>, ranksep=<span class="stringliteral">&apos;1.3&apos;</span>)
<a name="l00267"></a>00267     dot_create_nodes(root, callgraph)
<a name="l00268"></a>00268     dot_create_edges(root, callgraph)
<a name="l00269"></a>00269     dot_filename = os.path.join(outdir, dotFilename)
<a name="l00270"></a>00270     callgraph.write(dot_filename)
<a name="l00271"></a>00271     <span class="keywordflow">try</span>:
<a name="l00272"></a>00272         <span class="comment"># dot crashes if the figure is extremely wide.</span>
<a name="l00273"></a>00273         <span class="comment"># So avoid terminating simulation unnecessarily</span>
<a name="l00274"></a>00274         callgraph.write_svg(dot_filename + <span class="stringliteral">&quot;.svg&quot;</span>)
<a name="l00275"></a>00275         callgraph.write_pdf(dot_filename + <span class="stringliteral">&quot;.pdf&quot;</span>)
<a name="l00276"></a>00276     <span class="keywordflow">except</span>:
<a name="l00277"></a>00277         warn(<span class="stringliteral">&quot;failed to generate dot output from %s&quot;</span>, dot_filename)
        warn(<span class="stringliteral">&quot;failed to generate dot output from %s&quot;</span>, dot_filename)
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1fff52253a51b807eca402644554e628"></a><!-- doxytag: member="m5::util::dot_writer::dot_add_edge" ref="a1fff52253a51b807eca402644554e628" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def m5::util::dot_writer::dot_add_edge </td>
          <td>(</td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname"> <em>simNode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname"> <em>callgraph</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname"> <em>full_port_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname"> <em>peerPort</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00126"></a><a class="code" href="namespacem5_1_1util_1_1dot__writer.html#a1fff52253a51b807eca402644554e628">00126</a>                                                               :
<a name="l00127"></a>00127     <span class="keywordflow">if</span> peerPort.role == <span class="stringliteral">&quot;MASTER&quot;</span>:
<a name="l00128"></a>00128         peer_port_name = re.sub(<span class="stringliteral">&apos;\.&apos;</span>, <span class="stringliteral">&apos;_&apos;</span>, peerPort.peer.simobj.path() \
<a name="l00129"></a>00129                 + <span class="stringliteral">&quot;.&quot;</span> + peerPort.peer.name)
<a name="l00130"></a>00130         callgraph.add_edge(pydot.Edge(full_port_name, peer_port_name))
<a name="l00131"></a>00131 
<span class="keyword">def </span><a class="code" href="namespacem5_1_1util_1_1dot__writer.html#a2444e15cbf160c23ba843c38960063b5">dot_create_cluster</a>(simNode, full_path, label):
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2444e15cbf160c23ba843c38960063b5"></a><!-- doxytag: member="m5::util::dot_writer::dot_create_cluster" ref="a2444e15cbf160c23ba843c38960063b5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def m5::util::dot_writer::dot_create_cluster </td>
          <td>(</td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname"> <em>simNode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname"> <em>full_path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname"> <em>label</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00132"></a><a class="code" href="namespacem5_1_1util_1_1dot__writer.html#a2444e15cbf160c23ba843c38960063b5">00132</a>                                                  :
<a name="l00133"></a>00133     <span class="comment"># get the parameter values of the node and use them as a tooltip</span>
<a name="l00134"></a>00134     ini_strings = []
<a name="l00135"></a>00135     <span class="keywordflow">for</span> param <span class="keywordflow">in</span> sorted(simNode._params.keys()):
<a name="l00136"></a>00136         value = simNode._values.get(param)
<a name="l00137"></a>00137         <span class="keywordflow">if</span> value != <span class="keywordtype">None</span>:
<a name="l00138"></a>00138             <span class="comment"># parameter name = value in HTML friendly format</span>
<a name="l00139"></a>00139             ini_strings.append(str(param) + <span class="stringliteral">&quot;&amp;#61;&quot;</span> +
<a name="l00140"></a>00140                                simNode._values[param].ini_str())
<a name="l00141"></a>00141     <span class="comment"># join all the parameters with an HTML newline</span>
<a name="l00142"></a>00142     tooltip = <span class="stringliteral">&quot;&amp;#10;&quot;</span>.join(ini_strings)
<a name="l00143"></a>00143 
<a name="l00144"></a>00144     <span class="keywordflow">return</span> pydot.Cluster( \
<a name="l00145"></a>00145                          full_path, \
<a name="l00146"></a>00146                          shape = <span class="stringliteral">&quot;Mrecord&quot;</span>, \
<a name="l00147"></a>00147                          label = label, \
<a name="l00148"></a>00148                          tooltip = <span class="stringliteral">&quot;\&quot;&quot;</span> + tooltip + <span class="stringliteral">&quot;\&quot;&quot;</span>, \
<a name="l00149"></a>00149                          style = <span class="stringliteral">&quot;\&quot;rounded, filled\&quot;&quot;</span>, \
<a name="l00150"></a>00150                          color = <span class="stringliteral">&quot;#000000&quot;</span>, \
<a name="l00151"></a>00151                          fillcolor = dot_gen_colour(simNode), \
<a name="l00152"></a>00152                          fontname = <span class="stringliteral">&quot;Arial&quot;</span>, \
<a name="l00153"></a>00153                          fontsize = <span class="stringliteral">&quot;14&quot;</span>, \
<a name="l00154"></a>00154                          fontcolor = <span class="stringliteral">&quot;#000000&quot;</span> \
<a name="l00155"></a>00155                          )
<a name="l00156"></a>00156 
<span class="keyword">def </span><a class="code" href="namespacem5_1_1util_1_1dot__writer.html#ad6620c2cbb99013162bcbc566c5b0378">dot_create_node</a>(simNode, full_path, label):
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6f29e1e4547e1ba7ec5fe675dfb1a079"></a><!-- doxytag: member="m5::util::dot_writer::dot_create_edges" ref="a6f29e1e4547e1ba7ec5fe675dfb1a079" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def m5::util::dot_writer::dot_create_edges </td>
          <td>(</td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname"> <em>simNode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname"> <em>callgraph</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00102"></a><a class="code" href="namespacem5_1_1util_1_1dot__writer.html#a6f29e1e4547e1ba7ec5fe675dfb1a079">00102</a>                                         :
<a name="l00103"></a>00103     <span class="keywordflow">for</span> port_name <span class="keywordflow">in</span> simNode._ports.keys():
<a name="l00104"></a>00104         port = simNode._port_refs.get(port_name, <span class="keywordtype">None</span>)
<a name="l00105"></a>00105         <span class="keywordflow">if</span> port != <span class="keywordtype">None</span>:
<a name="l00106"></a>00106             full_path = re.sub(<span class="stringliteral">&apos;\.&apos;</span>, <span class="stringliteral">&apos;_&apos;</span>, simNode.path())
<a name="l00107"></a>00107             full_port_name = full_path + <span class="stringliteral">&quot;_&quot;</span> + port_name
<a name="l00108"></a>00108             port_node = dot_create_node(simNode, full_port_name, port_name)
<a name="l00109"></a>00109             <span class="comment"># create edges</span>
<a name="l00110"></a>00110             <span class="keywordflow">if</span> isinstance(port, PortRef):
<a name="l00111"></a>00111                 dot_add_edge(simNode, callgraph, full_port_name, port)
<a name="l00112"></a>00112             <span class="keywordflow">else</span>:
<a name="l00113"></a>00113                 <span class="keywordflow">for</span> p <span class="keywordflow">in</span> port.elements:
<a name="l00114"></a>00114                     dot_add_edge(simNode, callgraph, full_port_name, p)
<a name="l00115"></a>00115 
<a name="l00116"></a>00116     <span class="comment"># recurse to children</span>
<a name="l00117"></a>00117     <span class="keywordflow">if</span> simNode._children:
<a name="l00118"></a>00118         <span class="keywordflow">for</span> c <span class="keywordflow">in</span> simNode._children:
<a name="l00119"></a>00119             child = simNode._children[c]
<a name="l00120"></a>00120             <span class="keywordflow">if</span> isSimObjectVector(child):
<a name="l00121"></a>00121                 <span class="keywordflow">for</span> obj <span class="keywordflow">in</span> child:
<a name="l00122"></a>00122                     dot_create_edges(obj, callgraph)
<a name="l00123"></a>00123             <span class="keywordflow">else</span>:
<a name="l00124"></a>00124                 dot_create_edges(child, callgraph)
<a name="l00125"></a>00125 
<span class="keyword">def </span><a class="code" href="namespacem5_1_1util_1_1dot__writer.html#a1fff52253a51b807eca402644554e628">dot_add_edge</a>(simNode, callgraph, full_port_name, peerPort):
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad6620c2cbb99013162bcbc566c5b0378"></a><!-- doxytag: member="m5::util::dot_writer::dot_create_node" ref="ad6620c2cbb99013162bcbc566c5b0378" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def m5::util::dot_writer::dot_create_node </td>
          <td>(</td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname"> <em>simNode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname"> <em>full_path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname"> <em>label</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00157"></a><a class="code" href="namespacem5_1_1util_1_1dot__writer.html#ad6620c2cbb99013162bcbc566c5b0378">00157</a>                                               :
<a name="l00158"></a>00158     <span class="keywordflow">return</span> pydot.Node( \
<a name="l00159"></a>00159                          full_path, \
<a name="l00160"></a>00160                          shape = <span class="stringliteral">&quot;Mrecord&quot;</span>, \
<a name="l00161"></a>00161                          label = label, \
<a name="l00162"></a>00162                          style = <span class="stringliteral">&quot;\&quot;rounded, filled\&quot;&quot;</span>, \
<a name="l00163"></a>00163                          color = <span class="stringliteral">&quot;#000000&quot;</span>, \
<a name="l00164"></a>00164                          fillcolor = dot_gen_colour(simNode, <span class="keyword">True</span>), \
<a name="l00165"></a>00165                          fontname = <span class="stringliteral">&quot;Arial&quot;</span>, \
<a name="l00166"></a>00166                          fontsize = <span class="stringliteral">&quot;14&quot;</span>, \
<a name="l00167"></a>00167                          fontcolor = <span class="stringliteral">&quot;#000000&quot;</span> \
<a name="l00168"></a>00168                          )
<a name="l00169"></a>00169 
<a name="l00170"></a>00170 <span class="comment"># an enumerator for different kinds of node types, at the moment we</span>
<a name="l00171"></a>00171 <span class="comment"># discern the majority of node types, with the caches being the</span>
<a name="l00172"></a>00172 <span class="comment"># notable exception</span>
<span class="keyword">class </span><a class="code" href="classm5_1_1util_1_1dot__writer_1_1NodeType.html">NodeType</a>:
</pre></div></p>

</div>
</div>
<a class="anchor" id="add31984cb8657529c3421202a51a7dc0"></a><!-- doxytag: member="m5::util::dot_writer::dot_create_nodes" ref="add31984cb8657529c3421202a51a7dc0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def m5::util::dot_writer::dot_create_nodes </td>
          <td>(</td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname"> <em>simNode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname"> <em>callgraph</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00069"></a><a class="code" href="namespacem5_1_1util_1_1dot__writer.html#add31984cb8657529c3421202a51a7dc0">00069</a>                                         :
<a name="l00070"></a>00070     <span class="keywordflow">if</span> isRoot(simNode):
<a name="l00071"></a>00071         label = <span class="stringliteral">&quot;root&quot;</span>
<a name="l00072"></a>00072     <span class="keywordflow">else</span>:
<a name="l00073"></a>00073         label = simNode._name
<a name="l00074"></a>00074     full_path = re.sub(<span class="stringliteral">&apos;\.&apos;</span>, <span class="stringliteral">&apos;_&apos;</span>, simNode.path())
<a name="l00075"></a>00075     <span class="comment"># add class name under the label</span>
<a name="l00076"></a>00076     label = <span class="stringliteral">&quot;\&quot;&quot;</span> + label + <span class="stringliteral">&quot; \\n: &quot;</span> + simNode.__class__.__name__ + <span class="stringliteral">&quot;\&quot;&quot;</span>
<a name="l00077"></a>00077 
<a name="l00078"></a>00078     <span class="comment"># each component is a sub-graph (cluster)</span>
<a name="l00079"></a>00079     cluster = dot_create_cluster(simNode, full_path, label)
<a name="l00080"></a>00080 
<a name="l00081"></a>00081     <span class="comment"># create nodes per port</span>
<a name="l00082"></a>00082     <span class="keywordflow">for</span> port_name <span class="keywordflow">in</span> simNode._ports.keys():
<a name="l00083"></a>00083         port = simNode._port_refs.get(port_name, <span class="keywordtype">None</span>)
<a name="l00084"></a>00084         <span class="keywordflow">if</span> port != <span class="keywordtype">None</span>:
<a name="l00085"></a>00085             full_port_name = full_path + <span class="stringliteral">&quot;_&quot;</span> + port_name
<a name="l00086"></a>00086             port_node = dot_create_node(simNode, full_port_name, port_name)
<a name="l00087"></a>00087             cluster.add_node(port_node)
<a name="l00088"></a>00088 
<a name="l00089"></a>00089     <span class="comment"># recurse to children</span>
<a name="l00090"></a>00090     <span class="keywordflow">if</span> simNode._children:
<a name="l00091"></a>00091         <span class="keywordflow">for</span> c <span class="keywordflow">in</span> simNode._children:
<a name="l00092"></a>00092             child = simNode._children[c]
<a name="l00093"></a>00093             <span class="keywordflow">if</span> isSimObjectVector(child):
<a name="l00094"></a>00094                 <span class="keywordflow">for</span> obj <span class="keywordflow">in</span> child:
<a name="l00095"></a>00095                     dot_create_nodes(obj, cluster)
<a name="l00096"></a>00096             <span class="keywordflow">else</span>:
<a name="l00097"></a>00097                 dot_create_nodes(child, cluster)
<a name="l00098"></a>00098 
<a name="l00099"></a>00099     callgraph.add_subgraph(cluster)
<a name="l00100"></a>00100 
<a name="l00101"></a>00101 <span class="comment"># create all edges according to memory hierarchy</span>
<span class="keyword">def </span><a class="code" href="namespacem5_1_1util_1_1dot__writer.html#a6f29e1e4547e1ba7ec5fe675dfb1a079">dot_create_edges</a>(simNode, callgraph):
</pre></div></p>

</div>
</div>
<a class="anchor" id="a61d8e0385c2049fd69ddf1bc7b944b7d"></a><!-- doxytag: member="m5::util::dot_writer::dot_gen_colour" ref="a61d8e0385c2049fd69ddf1bc7b944b7d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def m5::util::dot_writer::dot_gen_colour </td>
          <td>(</td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname"> <em>simNode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname"> <em>isPort</em> = <code>False</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00220"></a><a class="code" href="namespacem5_1_1util_1_1dot__writer.html#a61d8e0385c2049fd69ddf1bc7b944b7d">00220</a>                                            :
<a name="l00221"></a>00221     <span class="comment"># determine the type of the current node, and also its parent, if</span>
<a name="l00222"></a>00222     <span class="comment"># the node is not the same type as the parent then we use the base</span>
<a name="l00223"></a>00223     <span class="comment"># colour for its type</span>
<a name="l00224"></a>00224     node_type = get_node_type(simNode)
<a name="l00225"></a>00225     <span class="keywordflow">if</span> simNode._parent:
<a name="l00226"></a>00226         parent_type = get_node_type(simNode._parent)
<a name="l00227"></a>00227     <span class="keywordflow">else</span>:
<a name="l00228"></a>00228         parent_type = NodeType.OTHER
<a name="l00229"></a>00229 
<a name="l00230"></a>00230     <span class="comment"># if this node is the same type as the parent, then scale the</span>
<a name="l00231"></a>00231     <span class="comment"># colour based on the depth such that the deeper levels in the</span>
<a name="l00232"></a>00232     <span class="comment"># hierarchy get darker colours</span>
<a name="l00233"></a>00233     <span class="keywordflow">if</span> node_type == parent_type:
<a name="l00234"></a>00234         <span class="comment"># start out with a depth of zero</span>
<a name="l00235"></a>00235         depth = 0
<a name="l00236"></a>00236         parent = simNode._parent
<a name="l00237"></a>00237         <span class="comment"># find the closes parent that is not the same type</span>
<a name="l00238"></a>00238         <span class="keywordflow">while</span> parent <span class="keywordflow">and</span> get_node_type(parent) == parent_type:
<a name="l00239"></a>00239             depth = depth + 1
<a name="l00240"></a>00240             parent = parent._parent
<a name="l00241"></a>00241         node_colour = get_type_colour(parent_type)
<a name="l00242"></a>00242         <span class="comment"># slightly arbitrary, but assume that the depth is less than</span>
<a name="l00243"></a>00243         <span class="comment"># five levels</span>
<a name="l00244"></a>00244         r, g, b = map(<span class="keyword">lambda</span> x: x * max(1 - depth / 7.0, 0.3), node_colour)
<a name="l00245"></a>00245     <span class="keywordflow">else</span>:
<a name="l00246"></a>00246         node_colour = get_type_colour(node_type)
<a name="l00247"></a>00247         r, g, b = node_colour
<a name="l00248"></a>00248 
<a name="l00249"></a>00249     <span class="comment"># if we are colouring a port, then make it a slightly darker shade</span>
<a name="l00250"></a>00250     <span class="comment"># than the node that encapsulates it, once again use a magic constant</span>
<a name="l00251"></a>00251     <span class="keywordflow">if</span> isPort:
<a name="l00252"></a>00252         r, g, b = map(<span class="keyword">lambda</span> x: 0.8 * x, (r, g, b))
<a name="l00253"></a>00253 
<a name="l00254"></a>00254     <span class="keywordflow">return</span> dot_rgb_to_html(r, g, b)
<a name="l00255"></a>00255 
<span class="keyword">def </span><a class="code" href="namespacem5_1_1util_1_1dot__writer.html#a7583ad2189f2e3cdd087d9d5e62ce1af">dot_rgb_to_html</a>(r, g, b):
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7583ad2189f2e3cdd087d9d5e62ce1af"></a><!-- doxytag: member="m5::util::dot_writer::dot_rgb_to_html" ref="a7583ad2189f2e3cdd087d9d5e62ce1af" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def m5::util::dot_writer::dot_rgb_to_html </td>
          <td>(</td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname"> <em>r</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname"> <em>g</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname"> <em>b</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00256"></a><a class="code" href="namespacem5_1_1util_1_1dot__writer.html#a7583ad2189f2e3cdd087d9d5e62ce1af">00256</a>                             :
<a name="l00257"></a>00257     <span class="keywordflow">return</span> <span class="stringliteral">&quot;#%.2x%.2x%.2x&quot;</span> % (r, g, b)
<a name="l00258"></a>00258 
<span class="keyword">def </span><a class="code" href="namespacem5_1_1util_1_1dot__writer.html#ae1c22e483b943c09e1d17ebc09c4b5f2">do_dot</a>(root, outdir, dotFilename):
</pre></div></p>

</div>
</div>
<a class="anchor" id="a498b4029e58b118de7ca1b994d70234c"></a><!-- doxytag: member="m5::util::dot_writer::get_node_type" ref="a498b4029e58b118de7ca1b994d70234c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def m5::util::dot_writer::get_node_type </td>
          <td>(</td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname"> <em>simNode</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00182"></a><a class="code" href="namespacem5_1_1util_1_1dot__writer.html#a498b4029e58b118de7ca1b994d70234c">00182</a>                           :
<a name="l00183"></a>00183     <span class="keywordflow">if</span> isinstance(simNode, m5.objects.System):
<a name="l00184"></a>00184         <span class="keywordflow">return</span> NodeType.SYS
<a name="l00185"></a>00185     <span class="comment"># NULL ISA has no BaseCPU or PioDevice, so check if these names</span>
<a name="l00186"></a>00186     <span class="comment"># exists before using them</span>
<a name="l00187"></a>00187     <span class="keywordflow">elif</span> <span class="stringliteral">&apos;BaseCPU&apos;</span> <span class="keywordflow">in</span> dir(m5.objects) <span class="keywordflow">and</span> \
<a name="l00188"></a>00188             isinstance(simNode, m5.objects.BaseCPU):
<a name="l00189"></a>00189         <span class="keywordflow">return</span> NodeType.CPU
<a name="l00190"></a>00190     <span class="keywordflow">elif</span> <span class="stringliteral">&apos;PioDevice&apos;</span> <span class="keywordflow">in</span> dir(m5.objects) <span class="keywordflow">and</span> \
<a name="l00191"></a>00191             isinstance(simNode, m5.objects.PioDevice):
<a name="l00192"></a>00192         <span class="keywordflow">return</span> NodeType.DEV
<a name="l00193"></a>00193     <span class="keywordflow">elif</span> isinstance(simNode, m5.objects.BaseBus):
<a name="l00194"></a>00194         <span class="keywordflow">return</span> NodeType.BUS
<a name="l00195"></a>00195     <span class="keywordflow">elif</span> isinstance(simNode, m5.objects.AbstractMemory):
<a name="l00196"></a>00196         <span class="keywordflow">return</span> NodeType.MEM
<a name="l00197"></a>00197     <span class="keywordflow">else</span>:
<a name="l00198"></a>00198         <span class="keywordflow">return</span> NodeType.OTHER
<a name="l00199"></a>00199 
<a name="l00200"></a>00200 <span class="comment"># based on the node type, determine the colour as an RGB tuple, the</span>
<a name="l00201"></a>00201 <span class="comment"># palette is rather arbitrary at this point (some coherent natural</span>
<a name="l00202"></a>00202 <span class="comment"># tones), and someone that feels artistic should probably have a look</span>
<span class="keyword">def </span><a class="code" href="namespacem5_1_1util_1_1dot__writer.html#a7bba31405ed25bdf7a33744c7e90b502">get_type_colour</a>(nodeType):
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7bba31405ed25bdf7a33744c7e90b502"></a><!-- doxytag: member="m5::util::dot_writer::get_type_colour" ref="a7bba31405ed25bdf7a33744c7e90b502" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def m5::util::dot_writer::get_type_colour </td>
          <td>(</td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname"> <em>nodeType</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00203"></a><a class="code" href="namespacem5_1_1util_1_1dot__writer.html#a7bba31405ed25bdf7a33744c7e90b502">00203</a>                              :
<a name="l00204"></a>00204     <span class="keywordflow">if</span> nodeType == NodeType.SYS:
<a name="l00205"></a>00205         <span class="keywordflow">return</span> (228, 231, 235)
<a name="l00206"></a>00206     <span class="keywordflow">elif</span> nodeType == NodeType.CPU:
<a name="l00207"></a>00207         <span class="keywordflow">return</span> (187, 198, 217)
<a name="l00208"></a>00208     <span class="keywordflow">elif</span> nodeType == NodeType.BUS:
<a name="l00209"></a>00209         <span class="keywordflow">return</span> (111, 121, 140)
<a name="l00210"></a>00210     <span class="keywordflow">elif</span> nodeType == NodeType.MEM:
<a name="l00211"></a>00211         <span class="keywordflow">return</span> (94, 89, 88)
<a name="l00212"></a>00212     <span class="keywordflow">elif</span> nodeType == NodeType.DEV:
<a name="l00213"></a>00213         <span class="keywordflow">return</span> (199, 167, 147)
<a name="l00214"></a>00214     <span class="keywordflow">elif</span> nodeType == NodeType.OTHER:
<a name="l00215"></a>00215         <span class="comment"># use a relatively gray shade</span>
<a name="l00216"></a>00216         <span class="keywordflow">return</span> (186, 182, 174)
<a name="l00217"></a>00217 
<a name="l00218"></a>00218 <span class="comment"># generate colour for a node, either corresponding to a sim object or a</span>
<a name="l00219"></a>00219 <span class="comment"># port</span>
<span class="keyword">def </span><a class="code" href="namespacem5_1_1util_1_1dot__writer.html#a61d8e0385c2049fd69ddf1bc7b944b7d">dot_gen_colour</a>(simNode, isPort = False):
</pre></div></p>

</div>
</div>
<hr/><h2>変数</h2>
<a class="anchor" id="a31241ceacc46b6932a85d676d5a4ab8a"></a><!-- doxytag: member="m5::util::dot_writer::pydot" ref="a31241ceacc46b6932a85d676d5a4ab8a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacem5_1_1util_1_1dot__writer.html#a31241ceacc46b6932a85d676d5a4ab8a">pydot</a> = False</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>File&nbsp;GEM5&nbsp;Wrapperに対して25 May 2015に生成されました。&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
